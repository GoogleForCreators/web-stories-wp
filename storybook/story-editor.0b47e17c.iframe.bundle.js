(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[5280],{"./packages/design-system/src/images/desert_bw.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _path,_path2,_circle,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const SvgDesertBw=({title,titleId,...props})=>react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 274 118","aria-labelledby":titleId},props),title?react__WEBPACK_IMPORTED_MODULE_0__.createElement("title",{id:titleId},title):null,_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"#767E80",d:"M59.68 117.706 8.551 106.934C2.505 105.66-.951 99.261 1.3 93.506l1.18-3.019a10 10 0 0 1 7.987-6.268l78.795-10.544a10 10 0 0 0 2.524-.683l82.061-34.244a10 10 0 0 1 8.263.255l56.296 27.675q.654.323 1.349.545l26.84 8.637c9.132 2.939 9.287 15.804.228 18.962l-26.529 9.248c-.819.285-1.671.463-2.536.529L62.497 117.892a10 10 0 0 1-2.818-.186"})),_path2||(_path2=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"#ADB1B3",fillRule:"evenodd",d:"M224 26a4 4 0 0 1 4-4h2a4 4 0 0 1 4 4v31h4V44a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-7v17h-10V49h-7a2 2 0 0 1-2-2V31a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v13h4zM120.857 53.179a2.143 2.143 0 0 1 4.286 0v14.25h1.714V62.07a1.072 1.072 0 0 1 2.143 0V68.5a1.2 1.2 0 0 1-.048.319 1.07 1.07 0 0 1-1.023.753h-2.786v5.892h-4.286v-7.892h-2.786A1.073 1.073 0 0 1 117 66.5v-6.429a1.072 1.072 0 0 1 2.143 0v5.358h1.714zM64.786 8a8 8 0 0 1 8-8h.428a8 8 0 0 1 8 8v34.643h6.572V22a4 4 0 0 1 4-4H92a4 4 0 0 1 4 4v24.857a4 4 0 0 1-4 4H81.214v42.786H64.786V78.857H54a3.99 3.99 0 0 1-2.828-1.171A4 4 0 0 1 50 74.857V50a4 4 0 0 1 4-4h.214a4 4 0 0 1 4 4v20.643h6.572z",clipRule:"evenodd"})),_circle||(_circle=react__WEBPACK_IMPORTED_MODULE_0__.createElement("circle",{cx:213,cy:72,r:13,fill:"#E4E5E6"}))),__WEBPACK_DEFAULT_EXPORT__=(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(SvgDesertBw)},"./.storybook/stories/playground/story-editor/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>LOCAL_STORAGE_PREVIEW_MARKUP_KEY,c:()=>LOCAL_STORAGE_CONTENT_KEY});const LOCAL_STORAGE_CONTENT_KEY="web_stories_json_content",LOCAL_STORAGE_PREVIEW_MARKUP_KEY="web_stories_preview_markup"},"./.storybook/stories/playground/story-editor/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{_default:()=>_default,default:()=>story_editor});var react=__webpack_require__("./node_modules/react/index.js"),dialog=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js"),__webpack_require__("./node_modules/core-js/modules/esnext.json.parse.js"),__webpack_require__("./packages/story-editor/src/components/dialog/index.js")),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),stylis_rtl=__webpack_require__("./node_modules/stylis-plugin-rtl/dist/stylis-rtl.js"),deepMerge=__webpack_require__("./packages/design-system/src/utils/deepMerge.ts"),snackbarProvider=__webpack_require__("./packages/design-system/src/contexts/snackbar/snackbarProvider.tsx"),popupProvider=__webpack_require__("./packages/design-system/src/contexts/popup/popupProvider.ts"),styles=__webpack_require__("./packages/design-system/src/components/modal/styles.ts"),flagged_esm=__webpack_require__("./packages/story-editor/node_modules/flagged/dist/flagged.esm.js"),src=__webpack_require__("./packages/transform/src/index.ts"),moveable_src=__webpack_require__("./packages/moveable/src/index.ts"),theme=__webpack_require__("./packages/design-system/src/theme/theme.ts"),scrollbar=__webpack_require__("./packages/design-system/src/theme/helpers/scrollbar.ts"),react_src=__webpack_require__("./packages/react/src/index.ts");const GlobalStyle=(0,styled_components_browser_esm.DU)(["ul#adminmenu a.wp-has-current-submenu::after{border-right-color:",";}.web-stories-content b,.web-stories-content strong{font-weight:bold;}body.edit-story #wpbody *{",";}"],theme.w.colors.bg.secondary,scrollbar.W);const src_theme=theme.w;var tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),app_story=__webpack_require__("./packages/story-editor/src/app/story/index.ts");const copyStoryDataToClipboard=function CopyStoryDataToClipboard(){const{pages,current,selection,story}=(0,app_story.P3)((({internal})=>({pages:internal.reducerState.pages,current:internal.reducerState.current,selection:internal.reducerState.selection,story:internal.reducerState.story}))),copyToClipboard=(0,react_src.hb)((async()=>{const jsonStr=JSON.stringify({pages,current,selection,story},null,2);try{await navigator.clipboard.writeText(jsonStr),alert((0,i18n.__)("Copied to clipboard","web-stories"))}catch(err){alert((0,i18n.__)("Failed to copy story data","web-stories"))}}),[pages,current,selection,story]);return pages&&current&&selection&&story?react.createElement(button_button.$,{onClick:copyToClipboard,variant:constants.Ak.Rectangle,type:constants.VQ.Quaternary,size:constants.Mp.Small},(0,i18n.__)("Copy story data","web-stories")):null},Message=styled_components_browser_esm.Ay.div.withConfig({displayName:"errorActions__Message",componentId:"sc-mspoll-0"})(["color:#fff;font-size:16px;font-weight:300;line-height:1.6;padding:20px;button{margin-right:6px;}"]),TextArea=styled_components_browser_esm.Ay.textarea.withConfig({displayName:"errorActions__TextArea",componentId:"sc-mspoll-1"})(["width:100%;min-height:200px;"]),P=styled_components_browser_esm.Ay.p.withConfig({displayName:"errorActions__P",componentId:"sc-mspoll-2"})(["margin:0 0 8px 0;"]),Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"errorActions__Wrapper",componentId:"sc-mspoll-3"})(["display:flex;"]);const errorActions=function ErrorActions({error,errorInfo}){const textAreaContent=`${error}\n${errorInfo.componentStack}`;return react.createElement(Message,null,react.createElement(P,null,(0,i18n.__)("Something went wrong!","web-stories")),react.createElement(P,null,(0,i18n.__)("The editor has crashed. Please try reloading the page and report the error using the button below.","web-stories")),react.createElement(P,null,(0,i18n.__)("Apologies for the inconvenience.","web-stories")),react.createElement(P,null,react.createElement(TextArea,{readOnly:!0,value:textAreaContent,onFocus:e=>e.target.setSelectionRange(0,textAreaContent.length)})),react.createElement(Wrapper,null,react.createElement(button_button.$,{variant:constants.Ak.Rectangle,type:constants.VQ.Quaternary,size:constants.Mp.Small,onClick:()=>{window.location.reload(!0)}},(0,i18n.__)("Reload","web-stories")),react.createElement(copyStoryDataToClipboard,null),react.createElement(button_button.x,{variant:constants.Ak.Rectangle,type:constants.VQ.Primary,size:constants.Mp.Small,href:"https://wordpress.org/support/plugin/web-stories/#new-topic-0",target:"_blank",rel:"noreferrer"},(0,i18n.__)("Report Error","web-stories"))))};class ErrorBoundary extends react_src.uA{state={error:null,errorInfo:null};componentDidCatch(error,errorInfo){this.setState({error,errorInfo});const msg=errorInfo?`${error.message}\n\n${errorInfo.componentName}\n${errorInfo.componentStack}`:error.message;(0,tracking_src.Oz)("editor_error_boundary",msg,!0)}render(){const{error,errorInfo}=this.state;return error?react.createElement(errorActions,{error,errorInfo}):this.props.children}}const errorBoundary=ErrorBoundary;var app_config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),api=__webpack_require__("./packages/story-editor/src/app/api/index.ts"),media3p_api=__webpack_require__("./packages/story-editor/src/app/media/media3p/api/index.js"),app_history=__webpack_require__("./packages/story-editor/src/app/history/index.ts"),font=__webpack_require__("./packages/story-editor/src/app/font/index.ts"),app_media=__webpack_require__("./packages/story-editor/src/app/media/index.js"),currentUser=__webpack_require__("./packages/story-editor/src/app/currentUser/index.ts"),taxonomy=__webpack_require__("./packages/story-editor/src/app/taxonomy/index.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),utils_useIsUploadingToStory=__webpack_require__("./packages/story-editor/src/utils/useIsUploadingToStory.js");const autoSaveHandler=function AutoSaveHandler(){const{autoSaveInterval}=(0,app.UK)(),{state:{hasNewChanges}}=(0,app.W6)(),{autoSave,isSaving}=(0,app.P3)((({actions,state})=>({isSaving:state.meta.isSaving,autoSave:actions.autoSave}))),isUploading=(0,utils_useIsUploadingToStory.A)(),cachedSaveStory=(0,react_src.li)(autoSave);return(0,react_src.vJ)((()=>{cachedSaveStory.current=autoSave}),[autoSave]),(0,react_src.vJ)((()=>{if(!hasNewChanges||!autoSaveInterval||isUploading||isSaving)return;const timeout=setTimeout((()=>cachedSaveStory.current()),1e3*autoSaveInterval);return()=>clearTimeout(timeout)}),[autoSaveInterval,hasNewChanges,isUploading,isSaving]),null};var sessionStore=__webpack_require__("./packages/design-system/src/utils/sessionStore.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),getSessionStorageKey=__webpack_require__("./packages/story-editor/src/utils/getSessionStorageKey.ts");const localAutoSave=function LocalAutoSave(){const{localAutoSaveInterval=15}=(0,app.UK)(),{state:{hasNewChanges}}=(0,app.W6)(),isUploading=(0,utils_useIsUploadingToStory.A)(),{isAutoSavingStory}=(0,app.P3)((({state})=>({isAutoSavingStory:state.meta.isAutoSavingStory}))),{story,pages,restoreLocalAutoSave}=(0,app.P3)((({state,actions})=>({story:state.story,pages:state.pages,restoreLocalAutoSave:actions.restoreLocalAutoSave}))),{storyId,status}=story,isNew="auto-draft"===status,[backup,setBackup]=(0,react_src.J0)(null),storyRef=(0,react_src.li)(),pagesRef=(0,react_src.li)();(0,react_src.vJ)((()=>{storyRef.current=story,pagesRef.current=pages}),[story,pages]),(0,react_src.vJ)((()=>{if(!hasNewChanges||!localAutoSaveInterval||isUploading||isAutoSavingStory)return;const timeout=setTimeout((()=>sessionStore.eA.setItemByKey((0,getSessionStorageKey.A)(storyId,isNew),{story,pages})),1e3*localAutoSaveInterval);return()=>clearTimeout(timeout)}),[localAutoSaveInterval,hasNewChanges,isUploading,pages,story,storyId,isNew,isAutoSavingStory]);const onClose=()=>{sessionStore.eA.deleteItemByKey((0,getSessionStorageKey.A)(storyId,isNew)),setBackup(null)},didAutoSaveTracker=(0,react_src.li)(isAutoSavingStory);(0,react_src.vJ)((()=>{isAutoSavingStory?didAutoSaveTracker.current=!0:didAutoSaveTracker.current&&!backup&&(sessionStore.eA.deleteItemByKey((0,getSessionStorageKey.A)(storyId,!1)),didAutoSaveTracker.current=!1)}),[isAutoSavingStory,backup,storyId]);const hadNewChangesTracker=(0,react_src.li)(!1),wasNewTracker=(0,react_src.li)(isNew);return(0,react_src.vJ)((()=>{hasNewChanges?hadNewChangesTracker.current=!0:hadNewChangesTracker.current&&!backup&&(wasNewTracker.current?sessionStore.eA.deleteItemByKey((0,getSessionStorageKey.A)(null,!0)):sessionStore.eA.deleteItemByKey((0,getSessionStorageKey.A)(storyId,!1)),hadNewChangesTracker.current=!1,wasNewTracker.current=isNew)}),[hasNewChanges,backup,storyId,isNew]),(0,react_src.vJ)((()=>{const existingAutoSave=sessionStore.eA.getItemByKey((0,getSessionStorageKey.A)(storyId,isNew));if(!existingAutoSave)return;JSON.stringify(existingAutoSave.pages)!==JSON.stringify(pagesRef.current)&&JSON.stringify(existingAutoSave.story)!==JSON.stringify(storyRef.current)?setBackup(existingAutoSave):sessionStore.eA.deleteItemByKey((0,getSessionStorageKey.A)(storyId,isNew))}),[setBackup,isNew,storyId]),backup?react.createElement(dialog.A,{isOpen:!0,secondaryText:(0,i18n.__)("Dismiss","web-stories"),onClose,actions:react.createElement(react.Fragment,null,react.createElement(button_button.$,{type:constants.VQ.Tertiary,size:constants.Mp.Small,onClick:onClose},(0,i18n.__)("Dismiss","web-stories")),react.createElement(button_button.$,{type:constants.VQ.Primary,size:constants.Mp.Small,onClick:()=>{restoreLocalAutoSave(),sessionStore.eA.deleteItemByKey((0,getSessionStorageKey.A)(storyId,isNew)),setBackup(null)}},(0,i18n.__)("Restore Backup","web-stories")))},react.createElement(typography_text.E.Paragraph,{size:types.$.Small},(0,i18n.__)("The backup of this story in your browser is different from the current version.","web-stories"))):null};var dropTargets=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),helpCenter=__webpack_require__("./packages/story-editor/src/app/helpCenter/index.ts"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const context=(0,react_src.q6)({state:{dataUrls:{}},actions:{queuePageImageGeneration:noop.l}});const pageDataUrls_usePageDataUrls=function usePageDataUrls(selector=react_src.D_){return(0,react_src.i7)(context,selector)};var useIdleTaskQueue=__webpack_require__("./packages/story-editor/src/utils/useIdleTaskQueue.ts"),src_constants=__webpack_require__("./packages/units/src/constants.ts"),storyPageToNode=__webpack_require__("./packages/story-editor/src/app/pageCanvas/utils/storyPageToNode.tsx");const utils_storyPageToDataUrl=async function storyPageToDataUrl(page,{width=400,...options}){const htmlToImage=await __webpack_require__.e(4622).then(__webpack_require__.bind(__webpack_require__,"./node_modules/html-to-image/es/index.js")),[node,cleanup]=await(0,storyPageToNode.A)(page,width),dataUrl=await htmlToImage.toJpeg(node,{...options,width,height:width*(1/src_constants.iZ),canvasHeight:width*(1/src_constants.iZ),canvasWidth:width});return cleanup(),dataUrl};const pageDataUrlsProvider=function PageDataUrlProvider({children}){const[dataUrls,setDataUrls]=(0,react_src.J0)({}),queueIdleTask=(0,useIdleTaskQueue.A)(),queuePageImageGeneration=(0,react_src.hb)((storyPage=>{const idleTaskUid=storyPage.id,clearQueueOfPageTask=queueIdleTask({taskId:idleTaskUid,task:async()=>{try{const dataUrl=await utils_storyPageToDataUrl(storyPage,{});setDataUrls((state=>({...state,[storyPage?.id]:dataUrl})))}catch{}}});return()=>{clearQueueOfPageTask()}}),[queueIdleTask]),value=(0,react_src.Kr)((()=>({state:{dataUrls},actions:{queuePageImageGeneration}})),[queuePageImageGeneration,dataUrls]);return react.createElement(context.Provider,{value},children)};var pageCanvas=__webpack_require__("./packages/story-editor/src/app/pageCanvas/index.ts"),migration_src=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-exception.stack.js"),__webpack_require__("./packages/migration/src/index.ts")),useSnackbar=__webpack_require__("./packages/design-system/src/contexts/snackbar/useSnackbar.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),dummyData=__webpack_require__("./packages/story-editor/src/components/devTools/dummyData.js");const Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"devTools__Container",componentId:"sc-1mo3vwv-0"})(["position:fixed;z-index:2147483646;bottom:0;left:0;display:flex;flex-direction:column;width:35%;height:50%;border:6px solid ",";background:",";color:",";"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.bg.primary),(({theme})=>theme.colors.fg.secondary)),Textarea=styled_components_browser_esm.Ay.textarea.withConfig({displayName:"devTools__Textarea",componentId:"sc-1mo3vwv-1"})(["flex:1;border:0;background:",";color:",";white-space:nowrap;overflow:auto;"],(({theme})=>theme.colors.bg.primary),(({theme})=>theme.colors.fg.secondary)),Options=styled_components_browser_esm.Ay.div.withConfig({displayName:"devTools__Options",componentId:"sc-1mo3vwv-2"})(["display:flex;justify-content:space-between;padding:6px;"]),Label=styled_components_browser_esm.Ay.label.withConfig({displayName:"devTools__Label",componentId:"sc-1mo3vwv-3"})(["margin-right:6px;"]),devTools_Button=styled_components_browser_esm.Ay.button.withConfig({displayName:"devTools__Button",componentId:"sc-1mo3vwv-4"})(["margin-left:6px;"]),replaceResourcesWithDummy=state=>{const videosToReload=[];return[{...state,pages:state.pages.map((page=>({...page,elements:page.elements.map((element=>{const newElement={...element};return"resource"in element&&(newElement.resource={...element.resource},"video"===element.type&&(newElement.resource.mimeType="video/mp4",newElement.resource.src=dummyData.g,newElement.resource.poster=dummyData.w,videosToReload.push(newElement.id)),"image"===element.type&&(newElement.resource.mimeType="image/png",newElement.resource.src=dummyData.w)),newElement}))})))},videosToReload]},getResourceFileName=src=>{if(!src.length)return src;const matchedPaths=src.match(/\/([^/?#]+)[^/]*$/);return matchedPaths.length>1?`__WEB_STORIES_TEMPLATE_BASE_URL__/images/templates/%%templateName%%/${matchedPaths[1]}`:src};const devTools=function DevTools(){const[isVisible,setIsVisible]=(0,react_src.J0)(!1),[isBase64,setIsBase64]=(0,react_src.J0)(!1),[isDummyResources,setIsDummyResources]=(0,react_src.J0)(!1),[isTemplate,setIsTemplate]=(0,react_src.J0)(!1),{showSnackbar}=(0,useSnackbar.d)(),textareaRef=(0,react_src.li)(),{reducerState,restore}=(0,app_story.P3)((({internal})=>({reducerState:internal.reducerState,restore:internal.restore}))),{pages,current,selection,story:{globalStoryStyles}}=reducerState,reducerStateSlice={current,selection,story:{globalStoryStyles},version:migration_src.I,pages},storyData=isDummyResources?replaceResourcesWithDummy(reducerStateSlice)[0]:isTemplate?(state=reducerStateSlice,{...state,pages:state.pages.map((page=>({...page,elements:page.elements.map((element=>{const newElement={...element};return"resource"in element&&(newElement.resource={...element.resource},"video"===element.type&&(newElement.resource.id=0,newElement.resource.posterId=0,newElement.resource.src=getResourceFileName(newElement.resource.src),newElement.resource.poster=getResourceFileName(newElement.resource.poster)),"image"===element.type&&(newElement.resource.id=0,newElement.resource.sizes=[],newElement.resource.src=getResourceFileName(newElement.resource.src))),newElement})),pageTemplateType:page?.pageTemplateType??""})))}):reducerStateSlice;var state;const toggleVisible=()=>setIsVisible((v=>!v));(0,keyboard.pP)({key:"mod+shift+alt+j",editable:!0},toggleVisible);const jsonStr=JSON.stringify(storyData,null,2),defaultOutput=isBase64?window.btoa(jsonStr):jsonStr,[output,setOutput]=(0,react_src.J0)(defaultOutput);return(0,react_src.vJ)((()=>setOutput(defaultOutput)),[defaultOutput]),isVisible?react.createElement(Container,null,react.createElement(Options,null,react.createElement("div",null,react.createElement(Label,{title:"For easier sharing thru various channels"},react.createElement("input",{type:"checkbox",checked:isBase64,onChange:()=>setIsBase64((v=>!v))}),"Base64"),react.createElement(Label,{title:"Replace resources with dummy resources"},react.createElement("input",{type:"checkbox",checked:isDummyResources,onChange:()=>setIsDummyResources((v=>!v))}),"Dummy resources"),react.createElement(Label,{title:"Export as Template"},react.createElement("input",{type:"checkbox",checked:isTemplate,onChange:()=>setIsTemplate((v=>!v))}),"Template")),react.createElement("div",null,react.createElement(devTools_Button,{"aria-label":"Load data from input",onClick:()=>{let input=output;try{input=window.atob(input)}catch(e){}const inputState=JSON.parse(input),stateToRestore={...inputState,story:{...reducerState.story,...inputState.story},capabilities:reducerState.capabilities},[stateWithDummyResources,videosToReload]=isDummyResources?replaceResourcesWithDummy(stateToRestore):[stateToRestore,[]];restore(stateWithDummyResources),videosToReload.length>0&&videosToReload.forEach((videoId=>{const videoEl=document.getElementById(`video-${videoId}`);videoEl&&videoEl.load()})),showSnackbar({message:"Story restored from input",timeout:1200})}},"Load"),react.createElement(devTools_Button,{"aria-label":"Copy data to clipboard",onClick:()=>{textareaRef.current.select(),document.execCommand("copy"),textareaRef.current.setSelectionRange(0,0),showSnackbar({message:"Copied to clipboard",timeout:1200})}},"Copy"),react.createElement(devTools_Button,{"aria-label":"Close DevTools",onClick:toggleVisible},"X"))),react.createElement(Textarea,{ref:textareaRef,className:"mousetrap",value:output,onChange:evt=>setOutput(evt.target.value)})):null};var keyboardOnlyOutline=__webpack_require__("./packages/story-editor/src/utils/keyboardOnlyOutline.js");const src_getDefaultConfig=()=>({locale:{locale:"en-US",dateFormat:"F j, Y",timeFormat:"g:i a",gmtOffset:"0",timezone:"",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysInitials:["S","M","T","W","T","F","S"],weekStartsOn:1},allowedMimeTypes:{audio:["audio/mpeg","audio/aac","audio/wav","audio/ogg"],image:["image/png","image/jpeg","image/jpg","image/gif","image/webp"],caption:["text/vtt"],vector:["image/svg+xml"],video:["video/mp4","video/webm"]},isRTL:!1,storyId:1,cdnURL:"https://wp.stories.google/static/main/",maxUpload:314572800,capabilities:{hasUploadMediaAction:!1,canManageSettings:!1},metadata:{publisher:""},canViewDefaultTemplates:!0,showMedia3p:!0,encodeMarkup:!0,ffmpegCoreUrl:"https://wp.stories.google/static/main/js/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js",apiCallbacks:{},MediaUpload:()=>null,styleConstants:{topOffset:0,leftOffset:0}});Object.defineProperty(stylis_rtl.Ay,"name",{value:"stylisRTLPlugin"});const storyEditor=function StoryEditor({config,initialEdits,children}){const _config=(0,deepMerge.A)(src_getDefaultConfig(),config),{storyId,isRTL,flags,styleConstants:{leftOffset,topOffset}={}}=_config;return react.createElement(flagged_esm.nT,{features:flags},react.createElement(styled_components_browser_esm.ID,{stylisPlugins:isRTL?[stylis_rtl.Ay]:[]},react.createElement(styled_components_browser_esm.NP,{theme:src_theme},react.createElement(errorBoundary,null,react.createElement(app_config.sG,{config:_config},react.createElement(api.c4,null,react.createElement(media3p_api.b,null,react.createElement(app_history.os,{size:50},react.createElement(snackbarProvider.A,null,react.createElement(app_story.Zx,{storyId,initialEdits},react.createElement(taxonomy.r,null,react.createElement(currentUser.Qd,null,react.createElement(font.pK,null,react.createElement(app_media.YE,null,react.createElement(localAutoSave,null),react.createElement(autoSaveHandler,null),react.createElement(src.gS,null,react.createElement(dropTargets.l,null,react.createElement(helpCenter.i,null,react.createElement(pageCanvas.Vz,null,react.createElement(pageDataUrlsProvider,null,react.createElement(popupProvider.A,{value:{isRTL,leftOffset,topOffset}},react.createElement(GlobalStyle,null),react.createElement(devTools,null),react.createElement(moveable_src.$v,null),react.createElement(moveable_src.sK,null),react.createElement(styles.E,null),react.createElement(keyboardOnlyOutline.Ay,null),children))))))))))))))))))))};var prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),generatePatternStyles=__webpack_require__("./packages/patterns/src/generatePatternStyles.ts"),animation_src=__webpack_require__("./packages/animation/src/index.ts"),propTypes=__webpack_require__("./packages/story-editor/src/propTypes.js"),displayElement=__webpack_require__("./packages/story-editor/src/components/canvas/displayElement.js");const previewPageElements=(0,react_src.ph)((function PreviewPageElements({page}){return page.elements.map((element=>react.createElement(displayElement.A,{previewMode:!0,key:element.id,page,element,isAnimatable:!0})))})),FullBleedPreviewWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"previewPage__FullBleedPreviewWrapper",componentId:"sc-1r5t7dq-0"})(["height:",";width:100%;overflow:hidden;position:relative;display:flex;align-items:center;background-color:white;",";"],(({pageSize})=>`${pageSize.containerHeight}px`),(({background})=>(0,generatePatternStyles.A)(background))),PreviewSafeZone=styled_components_browser_esm.Ay.div.withConfig({displayName:"previewPage__PreviewSafeZone",componentId:"sc-1r5t7dq-1"})(["width:100%;height:",";overflow:visible;position:absolute;margin:0;"],(({pageSize})=>`${pageSize.height}px`));function PreviewPageAnimationController({animationState}){const WAAPIAnimationMethods=(0,animation_src.oB)((({actions})=>actions.WAAPIAnimationMethods));return(0,react_src.vJ)((()=>{switch(animationState){case animation_src.TR.Playing:return WAAPIAnimationMethods.play(),noop.l;case animation_src.TR.Reset:return WAAPIAnimationMethods.reset(),noop.l;case animation_src.TR.Scrubbing:case animation_src.TR.Paused:return WAAPIAnimationMethods.pause(),noop.l;default:return noop.l}}),[animationState,WAAPIAnimationMethods]),(0,react_src.vJ)((()=>()=>WAAPIAnimationMethods.reset()),[WAAPIAnimationMethods]),null}const PreviewPageDisplay=(0,react_src.ph)((0,react_src.Rf)((function PreviewPageDisplay({page,pageSize},ref){return react.createElement(FullBleedPreviewWrapper,{ref,pageSize,background:page.backgroundColor},react.createElement(PreviewSafeZone,{pageSize},react.createElement(previewPageElements,{page})))})));(0,react_src.Rf)((function PreviewPage({page,pageSize,animationState=animation_src.TR.Reset,onAnimationComplete},ref){return react.createElement(styled_components_browser_esm.ID,{stylisPlugins:[]},react.createElement(animation_src.S,{animations:page.animations,elements:page.elements,onWAAPIFinish:onAnimationComplete},react.createElement(PreviewPageDisplay,{ref,page,pageSize}),react.createElement(PreviewPageAnimationController,{animationState})))}));PreviewPageAnimationController.propTypes={animationState:prop_types_default().oneOf(Object.values(animation_src.TR))};var components_tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js");var dom_src=__webpack_require__("./packages/dom/src/index.ts");__webpack_require__("./packages/date/src/index.ts"),__webpack_require__("./packages/story-editor/src/utils/useRefreshPostEditURL.ts");var checklist=__webpack_require__("./packages/story-editor/src/components/checklist/index.js");__webpack_require__("./packages/story-editor/src/components/publishModal/publishModal.js"),__webpack_require__("./packages/story-editor/src/components/header/buttons/buttonWithChecklistWarning.js");var expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),storyUpdates=__webpack_require__("./packages/story-editor/src/utils/storyUpdates.ts"),highlights=__webpack_require__("./packages/story-editor/src/app/highlights/index.ts"),highlights_styles=__webpack_require__("./packages/story-editor/src/app/highlights/styles.js");const Input=styled_components_browser_esm.Ay.input.withConfig({displayName:"title__Input",componentId:"sc-jcmnyx-0"})(["color:",";margin:0;"," background:",";border:none !important;text-align:start;min-width:60%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-radius:",";",";",""],(({theme})=>`${theme.colors.fg.primary} !important`),expandPresetStyles.x((({paragraph},{Medium})=>paragraph[Medium])),(({isHighlighted})=>!isHighlighted&&"none !important"),(({theme})=>theme.borders.radius.small),outline.Q,(({isHighlighted})=>isHighlighted&&(0,styled_components_browser_esm.AH)([""," ",""],highlights_styles.A.OUTLINE,highlights_styles.A.FLASH)));const title=function HeaderTitle(){const{title,slug,updateStory}=(0,app_story.P3)((({state:{story:{title,slug}},actions:{updateStory}})=>({title,slug,updateStory}))),{highlight,resetHighlight,cancelHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.StoryTitle],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),handleChange=(0,react_src.hb)((evt=>updateStory({properties:{title:evt.target.value}})),[updateStory]),handleBlur=(0,react_src.hb)((()=>{(0,storyUpdates.H)({currentSlug:slug,currentTitle:title,updateStory})}),[slug,title,updateStory]);return"string"!=typeof title?null:react.createElement(Input,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},value:title,type:"text",onBlur:handleBlur,onChange:handleChange,placeholder:(0,i18n.__)("Add title","web-stories"),"aria-label":(0,i18n.__)("Story title","web-stories"),isHighlighted:highlight?.showEffect,onAnimationEnd:()=>resetHighlight()})};__webpack_require__("./packages/story-editor/src/components/panels/document/index.js");var components_form=__webpack_require__("./packages/story-editor/src/components/form/index.js"),panel=__webpack_require__("./packages/story-editor/src/components/panels/panel/index.js"),shared=__webpack_require__("./packages/story-editor/src/components/panels/shared/index.js"),shared_styles=(__webpack_require__("./packages/story-editor/src/components/fontPicker/index.js"),__webpack_require__("./packages/story-editor/src/components/panels/shared/styles.js")),snackbarContainer=(__webpack_require__("./packages/story-editor/src/components/checklistCard/index.js"),__webpack_require__("./packages/story-editor/src/app/story/utils/getStoryPropsToSave.ts"),__webpack_require__("./packages/story-editor/src/app/font/context.ts"),__webpack_require__("./packages/story-editor/src/app/font/actions/useLoadFontFiles.ts"),__webpack_require__("./packages/design-system/src/components/snackbar/snackbarContainer.tsx")),rich_text_src=__webpack_require__("./packages/rich-text/src/index.ts"),uploadDropTarget=__webpack_require__("./packages/story-editor/src/components/uploadDropTarget/index.js"),tabview=__webpack_require__("./packages/story-editor/src/components/tabview/index.js"),useHighlights=__webpack_require__("./packages/story-editor/src/app/highlights/useHighlights.ts"),useSidebar=__webpack_require__("./packages/story-editor/src/components/sidebar/useSidebar.js");const getTabId=id=>`sidebar-tab-${id}`,SidebarPane=styled_components_browser_esm.Ay.div.attrs({role:"tabpanel"}).withConfig({displayName:"sidebarContent__SidebarPane",componentId:"sc-1f2hu7i-0"})(["height:100%;overflow:overlay;"]),SidebarPanes=styled_components_browser_esm.Ay.section.withConfig({displayName:"sidebarContent__SidebarPanes",componentId:"sc-1f2hu7i-1"})(["height:100%;"]);const sidebarContent=function Sidebar(){const{tab,tabs}=(0,useSidebar.A)((({state:{tab},data:{tabs}})=>({tab,tabs})));return react.createElement(SidebarPanes,null,tabs.map((({id,Pane})=>react.createElement(SidebarPane,{"aria-labelledby":id,id:getTabId(id),key:id,hidden:id!==tab},id===tab&&react.createElement(Pane,null)))))},Layout=styled_components_browser_esm.Ay.section.attrs({"aria-label":(0,i18n.__)("Sidebar","web-stories")}).withConfig({displayName:"sidebarLayout__Layout",componentId:"sc-hpe4no-0"})(["height:100%;display:flex;flex-direction:column;background-color:",";color:",";"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.fg.secondary)),SidebarContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"sidebarLayout__SidebarContainer",componentId:"sc-hpe4no-1"})(["height:100%;padding:0;overflow:auto;"]),UnjustifiedTabView=(0,styled_components_browser_esm.Ay)(tabview.Ay).withConfig({displayName:"sidebarLayout__UnjustifiedTabView",componentId:"sc-hpe4no-2"})(["justify-content:center;"]);const sidebarLayout=function SidebarLayout(){const{tab,tabRefs,setSidebarContentNode,setTab,sidebar,tabs}=(0,useSidebar.A)((({state:{tab,tabRefs},actions:{setSidebarContentNode,setTab},refs:{sidebar},data:{tabs}})=>({tab,tabRefs,setSidebarContentNode,setTab,sidebar,tabs}))),{resetHighlight}=(0,useHighlights.A)((state=>({resetHighlight:state.onFocusOut}))),onTabChange=(0,react_src.hb)((id=>{setTab(id),resetHighlight(),(0,tracking_src.sx)("inspector_tab_change",{name:id})}),[setTab,resetHighlight]);return(0,keyboard.A0)(sidebar),react.createElement(Layout,{ref:sidebar},react.createElement(UnjustifiedTabView,{label:(0,i18n.__)("Sidebar Selection","web-stories"),tabs,tab,tabRefs,onTabChange,getAriaControlsId:getTabId,shortcut:"mod+option+3"}),react.createElement(SidebarContainer,{ref:setSidebarContentNode},react.createElement(sidebarContent,null)))};const sidebar=function sidebar_Sidebar(){return react.createElement(uploadDropTarget._G,{disabled:!0},react.createElement(sidebarLayout,null))};var canvas=__webpack_require__("./packages/story-editor/src/components/canvas/index.js"),getVideoLengthDisplay=__webpack_require__("./packages/media/src/getVideoLengthDisplay.ts"),formatMsToHMS=__webpack_require__("./packages/media/src/formatMsToHMS.ts"),videoTrimContext=__webpack_require__("./packages/story-editor/src/components/videoTrim/videoTrimContext.js");const src_getMsFromHMS=function getMsFromHMS(time){if(!time)return 0;const parts=time.split(":");if(3!==parts.length)return 0;const seconds=Number.parseFloat(parts[2])+60*Number.parseInt(parts[1])+3600*Number.parseInt(parts[0]);return Math.round(1e3*seconds)};var useFFmpeg=__webpack_require__("./packages/story-editor/src/app/media/utils/useFFmpeg.ts");const videoTrim_useVideoTrimMode=function useVideoTrimMode(){const{isEditing,isTrimMode,setEditingElementWithState,clearEditing}=(0,app.yu)((({state:{isEditing,editingElementState:{isTrimMode}={}},actions:{setEditingElementWithState,clearEditing}})=>({isEditing,isTrimMode,setEditingElementWithState,clearEditing}))),{selectedElement}=(0,app.P3)((({state:{selectedElements}})=>({selectedElement:1===selectedElements.length?selectedElements[0]:null}))),{actions:{getMediaById}}=(0,app.M1)(),[videoData,setVideoData]=(0,react_src.J0)(null),{isCurrentResourceUploading}=(0,app.HZ)((({state:{isCurrentResourceUploading}})=>({isCurrentResourceUploading}))),getVideoData=(0,react_src.hb)((()=>{const{resource}=selectedElement,{trimData}=resource,defaultVideoData={element:selectedElement,resource,start:0,end:null};getMediaById&&trimData?.original?(setVideoData(null),getMediaById(trimData.original).then((originalResource=>({element:selectedElement,resource:originalResource,start:src_getMsFromHMS(trimData.start),end:src_getMsFromHMS(trimData.end)})),(()=>defaultVideoData)).then((data=>setVideoData(data)))):setVideoData(defaultVideoData)}),[getMediaById,selectedElement]),toggleTrimMode=(0,react_src.hb)((()=>{isEditing?clearEditing():(setEditingElementWithState(selectedElement.id,{isTrimMode:!0,hasEditMenu:!0,showOverflow:!1}),getVideoData()),(0,tracking_src.sx)("video_trim_mode_toggled",{status:isEditing?"closed":"open"})}),[isEditing,clearEditing,setEditingElementWithState,selectedElement,getVideoData]),{isTranscodingEnabled}=(0,useFFmpeg.A)(),hasTrimMode=(0,react_src.Kr)((()=>{if("video"!==selectedElement?.type||!selectedElement?.resource)return!1;const{id,isExternal}=selectedElement.resource;return isTranscodingEnabled&&!isExternal&&!isCurrentResourceUploading(id)}),[selectedElement,isTranscodingEnabled,isCurrentResourceUploading]);return{isTrimMode:Boolean(isEditing&&isTrimMode),hasTrimMode,toggleTrimMode,videoData}};var useVideoNode=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoNode.js");const provider=function VideoTrimProvider({children}){const{trimExistingVideo}=(0,app.HZ)((({actions:{trimExistingVideo}})=>({trimExistingVideo}))),{isTrimMode,hasTrimMode,toggleTrimMode,videoData}=videoTrim_useVideoTrimMode(),{hasChanged,currentTime,startOffset,endOffset,maxOffset,videoNode,setStartOffset,setEndOffset,setVideoNode,setIsDraggingHandles}=(0,useVideoNode.A)(videoData),performTrim=(0,react_src.hb)((()=>{const{resource,element}=videoData;if(!resource)return;const lengthInSeconds=Math.round(endOffset/1e3-startOffset/1e3);trimExistingVideo({resource:{...resource,length:lengthInSeconds,lengthFormatted:(0,getVideoLengthDisplay.A)(lengthInSeconds)},canvasResourceId:element.resource.id,elementId:element.id,start:(0,formatMsToHMS.A)(startOffset),end:(0,formatMsToHMS.A)(endOffset)}),(0,tracking_src.sx)("video_trim",{original_length:resource.length,new_length:lengthInSeconds,start_offset:startOffset,end_offset:endOffset}),toggleTrimMode()}),[endOffset,startOffset,trimExistingVideo,toggleTrimMode,videoData]),value={state:{videoData,hasChanged,isTrimMode,hasTrimMode,currentTime,startOffset,endOffset,maxOffset,videoNode},actions:{performTrim,toggleTrimMode,setVideoNode,setStartOffset,setEndOffset,setIsDraggingHandles}};return react.createElement(videoTrimContext.A.Provider,{value},children)},Area=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__Area",componentId:"sc-1encx56-0"})(["grid-area:",";position:relative;overflow:hidden;z-index:",";"],(({area})=>area),(({zIndex})=>zIndex)),CanvasArea=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"canv",zIndex:1}).withConfig({displayName:"layout__CanvasArea",componentId:"sc-1encx56-1"})([""]),SidebarArea=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"sidebar",zIndex:2}).withConfig({displayName:"layout__SidebarArea",componentId:"sc-1encx56-2"})([""]);const workspace=function Workspace({header,footer}){const{editingElementState}=(0,app.yu)((state=>({editingElementState:state.state.editingElementState})));return react.createElement(provider,null,react.createElement(rich_text_src.LB,{editingState:editingElementState},react.createElement(SidebarArea,null,react.createElement(errorBoundary,null,react.createElement(sidebar,null))),react.createElement(CanvasArea,null,react.createElement(errorBoundary,null,react.createElement(canvas.Ay,{header,footer})))))};var story_editor_src_constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),app_canvas=__webpack_require__("./packages/story-editor/src/app/canvas/index.ts"),layoutProvider=__webpack_require__("./packages/story-editor/src/app/layout/layoutProvider.tsx"),useRightClickMenu=__webpack_require__("./packages/story-editor/src/app/rightClickMenu/useRightClickMenu.js"),rightClickMenu_context=__webpack_require__("./packages/story-editor/src/app/rightClickMenu/context.js");const ACTION_TYPES_OPEN_MENU="OPEN_MENU",ACTION_TYPES_CLOSE_MENU="CLOSE_MENU",ACTION_TYPES_RESET="RESET",DEFAULT_RIGHT_CLICK_MENU_STATE={isMenuOpen:!1,menuPosition:{x:0,y:0}};const reducer=function rightClickMenuReducer(state,action){switch(action.type){case ACTION_TYPES_CLOSE_MENU:return{...state,isMenuOpen:!1,menuPosition:DEFAULT_RIGHT_CLICK_MENU_STATE.menuPosition};case ACTION_TYPES_OPEN_MENU:return{...state,isMenuOpen:!0,menuPosition:action.payload};case ACTION_TYPES_RESET:return{...DEFAULT_RIGHT_CLICK_MENU_STATE};default:return state}};var v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),updateProperties=__webpack_require__("./packages/story-editor/src/components/style/updateProperties.js"),useRichTextFormatting=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/useRichTextFormatting.js"),getUpdatedSizeAndPosition=__webpack_require__("./packages/story-editor/src/utils/getUpdatedSizeAndPosition.js");const styleManager_useApplyStyle=function useApplyStyle({pushUpdate}){(0,components_form.jm)(getUpdatedSizeAndPosition.A,[]);const selectedTextElements=(0,app.P3)((({state:{selectedElements}})=>selectedElements?selectedElements?.filter((({type})=>"text"===type)):story_editor_src_constants.qW)),extraPropsToAdd=(0,react_src.li)(null),push=(0,react_src.hb)((updater=>{const extraProps=extraPropsToAdd.current||{};extraPropsToAdd.current=null,pushUpdate((oldProps=>({...updater(oldProps),...extraProps})),!0)}),[pushUpdate]),{handlers:{handleSetColor,handleSetLetterSpacing,handleClickUnderline,handleClickItalic,handleSelectFontWeight}}=(0,useRichTextFormatting.A)(selectedTextElements,push),handleApplyStyle=(0,react_src.hb)((preset=>{const{color,fontWeight,isItalic,isUnderline,letterSpacing,...rest}=preset;extraPropsToAdd.current=rest,handleSetColor(color),handleSetLetterSpacing(letterSpacing),handleSelectFontWeight(fontWeight),handleClickUnderline(isUnderline),handleClickItalic(isItalic)}),[handleSetColor,handleSetLetterSpacing,handleClickUnderline,handleClickItalic,handleSelectFontWeight]);return handleApplyStyle};var presetUtils=__webpack_require__("./packages/story-editor/src/utils/presetUtils.js"),utils=__webpack_require__("./packages/design-system/src/components/keyboard/utils.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts");const UNDO_HELP_TEXT=(0,sprintf.A)((0,i18n.__)("Press %s to undo the last change","web-stories"),(0,utils.KV)("mod+z"));const hooks_useCopyPasteActions=()=>{const undo=(0,app.W6)((({actions})=>actions.undo)),{addAnimations,copySelectedElement,copiedElementState,selectedElement,selectedElementType,selectedElementAnimations,updateSelectedElements,isSelectedElementBackground}=(0,app.P3)((({state,actions})=>({addAnimations:actions.addAnimations,copiedElementState:state.copiedElementState,copySelectedElement:actions.copySelectedElement,selectedElement:state.selectedElements?.[0],selectedElementType:state.selectedElements?.[0]?.type,isSelectedElementBackground:state.selectedElements?.[0]?.isBackground,selectedElementAnimations:state.selectedElementAnimations,updateSelectedElements:actions.updateSelectedElements}))),showSnackbar=(0,useSnackbar.d)((value=>value.showSnackbar)),undoRef=(0,react_src.li)(undo);undoRef.current=undo;const handleCopyStyles=(0,react_src.hb)((()=>{copySelectedElement(),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Copied style.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.sx)("context_menu_action",{name:"undo_copy_styles",element:selectedElementType,isBackground:isSelectedElementBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.sx)("context_menu_action",{name:"copy_styles",element:selectedElementType,isBackground:isSelectedElementBackground})}),[copySelectedElement,showSnackbar,selectedElementType,isSelectedElementBackground]),pushUpdate=(0,react_src.hb)(((update,commitValues)=>{updateSelectedElements({properties:element=>{const updates=(0,updateProperties.A)(element,update,commitValues),sizeUpdates=(0,getUpdatedSizeAndPosition.A)({...element,...updates});return{...updates,...sizeUpdates}}})}),[updateSelectedElements]),handleApplyStyle=styleManager_useApplyStyle({pushUpdate}),handlePasteStyles=(0,react_src.hb)((()=>{const id=selectedElement?.id;if(!id||selectedElementType!==copiedElementState.type)return;const oldAnimationToDelete=selectedElementAnimations.length?{...selectedElementAnimations[0],delete:!0}:void 0,newAnimations=copiedElementState.animations.map((animation=>({...animation,id:(0,v4.A)(),targets:[selectedElement.id]})));if(addAnimations({animations:newAnimations}),"text"===copiedElementState.type&&copiedElementState.styles.content){const updatedElementStyles=function getTextElementStyles(element,animation){const{textStyles}=(0,presetUtils.mi)([element.styles],{textStyles:[],colors:[]},story_editor_src_constants.aS.STYLE),{colors}=(0,presetUtils.mi)([element.styles],{textStyles:[],colors:[]},story_editor_src_constants.aS.COLOR),{content,...copiedElementStyles}=element.styles;return{...copiedElementStyles,...textStyles[0],...colors[0].color,animation,border:copiedElementStyles.border||null}}(copiedElementState,oldAnimationToDelete);handleApplyStyle(updatedElementStyles)}else updateSelectedElements({properties:currentProperties=>(0,updateProperties.A)(currentProperties,{...copiedElementState.styles,animation:oldAnimationToDelete},!0)});showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Pasted style.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.sx)("context_menu_action",{name:"undo_paste_styles",element:selectedElementType,isBackground:isSelectedElementBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.sx)("context_menu_action",{name:"paste_styles",element:selectedElementType,isBackground:isSelectedElementBackground})}),[addAnimations,copiedElementState,handleApplyStyle,selectedElement,selectedElementAnimations,showSnackbar,updateSelectedElements,selectedElementType,isSelectedElementBackground]);return{copiedElementType:copiedElementState?.type,handleCopyStyles,handlePasteStyles}};var generateGroupName=__webpack_require__("./packages/story-editor/src/utils/generateGroupName.ts");const hooks_useElementActions=()=>{const{clearBackgroundElement,duplicateElementsById,selectedElements,setBackgroundElement,updateElementsById,deleteGroupById,addGroup,groups,elements,arrangeElement}=(0,app.P3)((({state,actions})=>({clearBackgroundElement:actions.clearBackgroundElement,duplicateElementsById:actions.duplicateElementsById,selectedElements:state.selectedElements,setBackgroundElement:actions.setBackgroundElement,updateElementsById:actions.updateElementsById,addGroup:actions.addGroup,deleteGroupById:actions.deleteGroupById,groups:state.currentPage.groups,elements:state.currentPage?.elements||[],arrangeElement:actions.arrangeElement}))),showSnackbar=(0,useSnackbar.d)((value=>value.showSnackbar)),setEditingElement=(0,app.yu)((({actions})=>actions.setEditingElement)),undo=(0,app.W6)((({actions})=>actions.undo)),undoRef=(0,react_src.li)(undo);undoRef.current=undo;return{handleDuplicateSelectedElements:(0,react_src.hb)((()=>{selectedElements.length&&(duplicateElementsById({elementIds:selectedElements.map((({id})=>id))}),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Duplicated elements.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.sx)("context_menu_action",{name:"undo_duplicate_elements",elements:selectedElements.map((element=>element.type))})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.sx)("context_menu_action",{name:"duplicate_elements",elements:selectedElements.map((element=>element.type))}))}),[duplicateElementsById,selectedElements,showSnackbar]),handleGroupSelectedElements:(0,react_src.hb)((()=>{if(!selectedElements.length)return;const groupId=(0,v4.A)(),name=(0,generateGroupName.A)(groups);addGroup({groupId,name}),updateElementsById({elementIds:selectedElements.map((({id})=>id)),properties:currentProperties=>(0,updateProperties.A)(currentProperties,{groupId},!0)});const elementFromGroupWithHighestPosition=Math.max(...selectedElements.map((el=>elements.findIndex((({id})=>id===el?.id)))));for(const[index,element]of selectedElements.reverse().entries()){if(elements.findIndex((({id})=>id===element?.id))!==elementFromGroupWithHighestPosition){const newPosition=elementFromGroupWithHighestPosition-index;arrangeElement({elementId:element.id,position:newPosition})}}}),[selectedElements,updateElementsById,addGroup,groups,arrangeElement,elements]),handleUngroupSelectedElements:(0,react_src.hb)((()=>{selectedElements.length&&(deleteGroupById({groupId:selectedElements[0]?.groupId}),updateElementsById({elementIds:selectedElements.map((({id})=>id)),properties:currentProperties=>(0,updateProperties.A)(currentProperties,{groupId:null},!0)}))}),[selectedElements,updateElementsById,deleteGroupById]),handleOpenScaleAndCrop:(0,react_src.hb)((evt=>{const selectedElement=selectedElements?.[0];selectedElement&&(setEditingElement(selectedElement.id,evt),(0,tracking_src.sx)("context_menu_action",{name:"open_scale_and_crop",element:selectedElement.type,isBackground:selectedElement.isBackground}))}),[selectedElements,setEditingElement]),handleSetPageBackground:(0,react_src.hb)((()=>{const selectedElement=selectedElements?.[0];selectedElement&&!selectedElement.isBackground&&(setBackgroundElement({elementId:selectedElement.id}),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Set page background.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.sx)("context_menu_action",{name:"undo_set_page_background",element:selectedElement.type,isBackground:selectedElement.isBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.sx)("context_menu_action",{name:"set_as_page_background",element:selectedElement.type,isBackground:selectedElement.isBackground}))}),[selectedElements,setBackgroundElement,showSnackbar]),handleRemovePageBackground:(0,react_src.hb)((()=>{const selectedElement=selectedElements?.[0];selectedElement&&selectedElement.isBackground&&(updateElementsById({elementIds:[selectedElement.id],properties:currentProperties=>(0,updateProperties.A)(currentProperties,{isBackground:!1,opacity:100,overlay:null},!0)}),clearBackgroundElement(),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Removed page background.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.sx)("context_menu_action",{name:"undo_remove_page_background",elements:selectedElement.type,isBackground:selectedElement.isBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.sx)("context_menu_action",{name:"remove_media_from_background",element:selectedElement.type,isBackground:selectedElement.isBackground}))}),[clearBackgroundElement,selectedElements,showSnackbar,updateElementsById])}};function isOffCanvas(selectedElement){const{x,y,width,height}=selectedElement;let offCanvas=!1,offCanvasTop=0,offCanvasRight=0,offCanvasBottom=0,offCanvasLeft=0;x<0&&(offCanvasLeft=Math.abs(x));const adjustedY=y+src_constants.vT;if(adjustedY<0&&(offCanvasTop=Math.abs(adjustedY)),x>0)x+width>src_constants.bj&&(offCanvasRight=x+width-src_constants.bj);else{const r=width-Math.abs(x)-src_constants.bj;offCanvasRight=r>0?r:0}if(adjustedY>0){if(y+height>src_constants.WY){const b=Math.floor(y+height-(src_constants.WY+src_constants.vT));offCanvasBottom=b>0?b:0}}else{const b=height-Math.abs(y)-src_constants.WY;offCanvasBottom=b>0?b:0}return(offCanvasTop>0||offCanvasRight>0||offCanvasBottom>0||offCanvasLeft>0)&&(offCanvas=!0),{offCanvas,offCanvasTop,offCanvasRight,offCanvasBottom,offCanvasLeft}}const hooks_useLayerActions=()=>{const{cropExistingVideo}=(0,app_media.HZ)((({actions:{cropExistingVideo}})=>({cropExistingVideo}))),{arrangeElement,elements,selectedElement}=(0,app.P3)((({state,actions})=>({arrangeElement:actions.arrangeElement,elements:state.currentPage?.elements||[],selectedElement:state.selectedElements?.[0]}))),elementPosition=elements.findIndex((({id})=>id===selectedElement?.id)),canElementMoveBackwards=selectedElement&&!selectedElement.isBackground&&elementPosition>1,canElementMoveForwards=selectedElement&&!selectedElement.isBackground&&elementPosition<elements.length-1,handleSendBackward=(0,react_src.hb)((()=>{if(!canElementMoveBackwards)return;const backwardPositionSkipGroups=elements.findLastIndex(((el,position)=>position<elementPosition&&!el.groupId)),newPosition=1===elementPosition?elementPosition:backwardPositionSkipGroups;arrangeElement({elementId:selectedElement.id,position:newPosition}),(0,tracking_src.sx)("context_menu_action",{name:"send_backward",element:selectedElement.type,isBackground:selectedElement.isBackground})}),[arrangeElement,canElementMoveBackwards,elementPosition,selectedElement,elements]),handleSendToBack=(0,react_src.hb)((()=>{canElementMoveBackwards&&(arrangeElement({elementId:selectedElement.id,position:1}),(0,tracking_src.sx)("context_menu_action",{name:"send_to_back",element:selectedElement.type}))}),[arrangeElement,canElementMoveBackwards,selectedElement]),handleBringForward=(0,react_src.hb)((()=>{if(!canElementMoveForwards)return;const forwardPositionSkipGroups=elements.findIndex(((el,position)=>position>elementPosition&&!el.groupId||position===elements.length-1)),newPosition=elementPosition>=elements.length-1?elementPosition:forwardPositionSkipGroups;arrangeElement({elementId:selectedElement.id,position:newPosition}),(0,tracking_src.sx)("context_menu_action",{name:"bring_forward",element:selectedElement.type})}),[arrangeElement,canElementMoveForwards,elementPosition,elements,selectedElement]),handleBringToFront=(0,react_src.hb)((()=>{canElementMoveForwards&&(arrangeElement({elementId:selectedElement.id,position:elements.length-1}),(0,tracking_src.sx)("context_menu_action",{name:"bring_to_front",element:selectedElement.type}))}),[arrangeElement,canElementMoveForwards,elements,selectedElement]),handleCropOffScreenVideo=(0,react_src.hb)((()=>{cropExistingVideo(selectedElement,function getCropParams({x,y,width,height,rotationAngle,resource}){const{offCanvasLeft,offCanvasRight,offCanvasTop,offCanvasBottom}=isOffCanvas({x,y,width,height,rotationAngle}),multiplier=100/(width/resource.width*100),offCanvasX=Math.floor((offCanvasLeft+offCanvasRight)*multiplier),offCanvasY=Math.floor((offCanvasTop+offCanvasBottom)*multiplier);return{cropElement:{x,y},cropWidth:resource.width-offCanvasX,cropHeight:resource.height-offCanvasY,cropX:Math.floor(offCanvasLeft*multiplier),cropY:Math.floor(offCanvasTop*multiplier),newWidth:width-offCanvasLeft-offCanvasRight,newHeight:height-offCanvasTop-offCanvasBottom}}(selectedElement))}),[selectedElement,cropExistingVideo]);return{canElementMoveBackwards,canElementMoveForwards,handleBringForward,handleBringToFront,handleSendBackward,handleSendToBack,handleCropOffScreenVideo}};var elements_src=__webpack_require__("./packages/elements/src/index.ts");const hooks_usePageActions=()=>{const{addPageAt,currentPage,deleteCurrentPage,isSelectedElementBackground,pageLength,selectedElementType}=(0,app.P3)((({state,actions})=>({addPageAt:actions.addPageAt,currentPage:state.currentPage,deleteCurrentPage:actions.deleteCurrentPage,isSelectedElementBackground:state.selectedElements?.[0]?.background||!1,pageLength:state.pages?.length||1,selectedElementType:state.selectedElements?.[0]?.type||null})));return{handleAddPageAtPosition:(0,react_src.hb)((index=>{let position=Boolean(index)||0===index?index:pageLength-1;position=position>pageLength?pageLength-1:position,position=position<0?0:position,addPageAt({page:(0,elements_src.a3)(),position}),(0,tracking_src.sx)("context_menu_action",{name:"page_added",element:selectedElementType,isBackground:isSelectedElementBackground})}),[addPageAt,isSelectedElementBackground,pageLength,selectedElementType]),handleDuplicatePage:(0,react_src.hb)((()=>{addPageAt({page:(0,elements_src.hi)(currentPage),position:null})}),[addPageAt,currentPage]),handleDeletePage:(0,react_src.hb)((()=>{deleteCurrentPage(),(0,tracking_src.sx)("context_menu_action",{name:"page_deleted",element:selectedElementType,isBackground:isSelectedElementBackground})}),[deleteCurrentPage,isSelectedElementBackground,selectedElementType])}};var useDeleteColor=__webpack_require__("./packages/story-editor/src/components/colorPicker/useDeleteColor.js");__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js");const useDeleteStyle=function useDeletePreset({onEmpty}){const{globalStoryStyles,updateStory}=(0,app.P3)((({state:{story:{globalStoryStyles}},actions:{updateStory}})=>({globalStoryStyles,updateStory}))),{textStyles}=globalStoryStyles||{},deleteGlobalPreset=(0,react_src.hb)((toDelete=>{const updatedStyles=textStyles.filter((style=>style!==toDelete));updateStory({properties:{globalStoryStyles:{...globalStoryStyles,textStyles:updatedStyles}}}),0===updatedStyles.length&&onEmpty()}),[textStyles,updateStory,globalStoryStyles,onEmpty]);return deleteGlobalPreset};var useAddPreset=__webpack_require__("./packages/story-editor/src/utils/useAddPreset.js");const hooks_usePresetActions=()=>{const{addGlobalPreset:addGlobalTextPreset}=(0,useAddPreset.A)({presetType:story_editor_src_constants.aS.STYLE}),{addGlobalPreset:addGlobalColorPreset}=(0,useAddPreset.A)({presetType:story_editor_src_constants.aS.COLOR}),deleteGlobalTextPreset=useDeleteStyle({onEmpty:noop.l}),{deleteGlobalColor:deleteGlobalColorPreset}=(0,useDeleteColor.A)({onEmpty:noop.l}),selectedElement=(0,app.P3)((({state})=>state.selectedElements?.[0])),showSnackbar=(0,useSnackbar.d)((value=>value.showSnackbar)),undo=(0,app.W6)((({actions})=>actions.undo));(0,react_src.li)(undo).current=undo;return{handleAddTextPreset:(0,react_src.hb)((evt=>{const preset=addGlobalTextPreset(evt);showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)('Saved style to "Saved Styles".',"web-stories"),onAction:()=>{deleteGlobalTextPreset(preset),(0,tracking_src.sx)("context_menu_action",{name:"remove_text_preset",element:selectedElement?.type})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.sx)("context_menu_action",{name:"add_text_preset",element:selectedElement?.type})}),[addGlobalTextPreset,deleteGlobalTextPreset,selectedElement?.type,showSnackbar]),handleAddColorPreset:(0,react_src.hb)((evt=>{const preset=addGlobalColorPreset(evt);showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)('Added color to "Saved Colors".',"web-stories"),onAction:()=>{deleteGlobalColorPreset(preset),(0,tracking_src.sx)("context_menu_action",{name:"remove_color_preset",element:selectedElement?.type})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.sx)("context_menu_action",{name:"add_color_preset",element:selectedElement?.type})}),[addGlobalColorPreset,deleteGlobalColorPreset,selectedElement?.type,showSnackbar])}};const rightClickMenu_provider=function RightClickMenuProvider({children}){const[{isMenuOpen,menuPosition},dispatch]=(0,react_src.WO)(reducer,DEFAULT_RIGHT_CLICK_MENU_STATE),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),handleOpenMenu=(0,react_src.hb)((evt=>{evt.preventDefault(),evt.stopPropagation();let x=evt?.clientX,y=evt?.clientY;if(!x&&!y){const dims=evt.target.getBoundingClientRect();x=dims.x,y=dims.y}dispatch({type:ACTION_TYPES_OPEN_MENU,payload:{x,y}}),(0,tracking_src.sx)("context_menu_action",{name:"context_menu_opened"})}),[]),handleCloseMenu=(0,react_src.hb)((()=>{isMenuOpen&&dispatch({type:ACTION_TYPES_CLOSE_MENU})}),[isMenuOpen]);(0,keyboard.pP)({key:["mod+alt+o"]},(evt=>{evt.preventDefault(),handleCopyStyles()}),[handleCopyStyles]),(0,keyboard.pP)({key:["mod+alt+p"]},(evt=>{evt.preventDefault(),handlePasteStyles()}),[handlePasteStyles]);const value=(0,react_src.Kr)((()=>({isMenuOpen,menuPosition,onCloseMenu:handleCloseMenu,onOpenMenu:handleOpenMenu})),[handleCloseMenu,handleOpenMenu,isMenuOpen,menuPosition]);return react.createElement(rightClickMenu_context.A.Provider,{value},children)};var subMenuTrigger=__webpack_require__("./packages/design-system/src/components/contextMenu/components/subMenuTrigger.tsx"),contextMenu=__webpack_require__("./packages/design-system/src/components/contextMenu/contextMenu.tsx"),item=__webpack_require__("./packages/design-system/src/components/contextMenu/components/item.tsx"),separator=__webpack_require__("./packages/design-system/src/components/contextMenu/components/separator.tsx"),components_button=__webpack_require__("./packages/design-system/src/components/contextMenu/components/button.tsx"),shortcut=__webpack_require__("./packages/design-system/src/components/contextMenu/components/shortcut.ts");const constants_RIGHT_CLICK_MENU_LABELS={ADD_NEW_PAGE_AFTER:(0,i18n.__)("Add New Page After","web-stories"),ADD_NEW_PAGE_BEFORE:(0,i18n.__)("Add New Page Before","web-stories"),ADD_TO_COLOR_PRESETS:(0,i18n.__)("Add Color to Saved Colors","web-stories"),ADD_TO_TEXT_PRESETS:(0,i18n.__)("Add Style to Saved Styles","web-stories"),BRING_FORWARD:(0,i18n.__)("Bring Forward","web-stories"),BRING_TO_FRONT:(0,i18n.__)("Bring to Front","web-stories"),BROWSE_STOCK_IMAGES_AND_VIDEO:(0,i18n.__)("Browse Stock Images and Video","web-stories"),BROWSE_PAGE_TEMPLATES:(0,i18n.__)("Browse Page Templates","web-stories"),CLEAR_IMAGE_STYLES:(0,i18n.__)("Clear Image Styles","web-stories"),CLEAR_SHAPE_STYLES:(0,i18n.__)("Clear Shape Styles","web-stories"),CLEAR_VIDEO_STYLES:(0,i18n.__)("Clear Video Styles","web-stories"),CHOOSE_IMAGE_OR_VIDEO:(0,i18n.__)("Choose Image or Video","web-stories"),COPY_IMAGE_STYLES:(0,i18n.__)("Copy Image Styles","web-stories"),COPY_SHAPE_STYLES:(0,i18n.__)("Copy Shape Styles","web-stories"),COPY_VIDEO_STYLES:(0,i18n.__)("Copy Video Styles","web-stories"),COPY_STYLES:(0,i18n.__)("Copy Style","web-stories"),DELETE_PAGE:(0,i18n.__)("Delete Page","web-stories"),DETACH_IMAGE_FROM_BACKGROUND:(0,i18n.__)("Detach Image From Background","web-stories"),DETACH_VIDEO_FROM_BACKGROUND:(0,i18n.__)("Detach Video From Background","web-stories"),DUPLICATE_PAGE:(0,i18n.__)("Duplicate Page","web-stories"),DUPLICATE_ELEMENTS:(numElements=1)=>(0,i18n._n)("Duplicate Element","Duplicate Elements",numElements,"web-stories"),GROUP_LAYERS:(0,i18n.__)("Group Layers","web-stories"),UNGROUP_LAYERS:(0,i18n.__)("Ungroup Layers","web-stories"),UNGROUP_LAYER:(0,i18n.__)("Remove from Group","web-stories"),LOCK_UNLOCK:(0,i18n.__)("Lock/Unlock","web-stories"),HIDE_SHOW:(0,i18n.__)("Hide/Show","web-stories"),RENAME_LAYER:(0,i18n.__)("Rename Layer","web-stories"),PASTE_IMAGE_STYLES:(0,i18n.__)("Paste Image Styles","web-stories"),PASTE_SHAPE_STYLES:(0,i18n.__)("Paste Shape Styles","web-stories"),PASTE_VIDEO_STYLES:(0,i18n.__)("Paste Video Styles","web-stories"),PASTE_STYLES:(0,i18n.__)("Paste Style","web-stories"),SCALE_AND_CROP_BACKGROUND_IMAGE:(0,i18n.__)("Scale & Crop Background Image","web-stories"),SCALE_AND_CROP_BACKGROUND_VIDEO:(0,i18n.__)("Scale & Crop Background Video","web-stories"),SCALE_AND_CROP_IMAGE:(0,i18n.__)("Scale & Crop Image","web-stories"),SCALE_AND_CROP_VIDEO:(0,i18n.__)("Scale & Crop Video","web-stories"),CROP_OFF_SCREEN_VIDEO:(0,i18n.__)("Crop Off-Screen Video","web-stories"),SEND_BACKWARD:(0,i18n.__)("Send Backward","web-stories"),SEND_TO_BACK:(0,i18n.__)("Send to Back","web-stories"),SET_AS_PAGE_BACKGROUND:(0,i18n.__)("Set as Page Background","web-stories"),TRIM_VIDEO:(0,i18n.__)("Trim Video","web-stories"),UPLOAD_IMAGE_OR_VIDEO:(0,i18n.__)("Upload Image or Video","web-stories"),USE_SHAPE_AS_MASK:(0,i18n.__)("Use Shape as a Mask","web-stories"),REMOVE_MASK:(0,i18n.__)("Unmask","web-stories"),RECORD_VIDEO:(0,i18n.__)("Record Video","web-stories"),HEADING_LEVEL:(0,i18n.__)("Heading Level","web-stories")},StyledKbd=(0,styled_components_browser_esm.Ay)(typography_text.E.Kbd).attrs({size:types.$.Small}).withConfig({displayName:"constants__StyledKbd",componentId:"sc-m1qol5-0"})(["color:inherit;:not(:last-child){margin-right:4px;}"]),RIGHT_CLICK_MENU_SHORTCUTS={SEND_BACKWARD:{display:react.createElement(keyboard.rm,{shortcut:"mod down",component:StyledKbd}),title:(0,utils._M)("mod down")},SEND_TO_BACK:{display:react.createElement(keyboard.rm,{shortcut:"mod shift down",component:StyledKbd}),title:(0,utils._M)("mod shift down")},BRING_FORWARD:{display:react.createElement(keyboard.rm,{shortcut:"mod up",component:StyledKbd}),title:(0,utils._M)("mod up")},BRING_TO_FRONT:{display:react.createElement(keyboard.rm,{shortcut:"mod shift up",component:StyledKbd}),title:(0,utils._M)("mod shift up")},DELETE:{display:react.createElement(keyboard.rm,{shortcut:"delete",component:StyledKbd}),title:(0,utils._M)("delete")},COPY_STYLES:{display:react.createElement(keyboard.rm,{shortcut:"alt mod O",component:StyledKbd}),title:(0,utils._M)("alt mod O")},PASTE_STYLES:{display:react.createElement(keyboard.rm,{shortcut:"alt mod P",component:StyledKbd}),title:(0,utils._M)("alt mod P")}};var useShapeMask=__webpack_require__("./packages/story-editor/src/utils/useShapeMask.js"),useVideoTrim=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoTrim.js"),SAT=__webpack_require__("./node_modules/sat/SAT.js"),SAT_default=__webpack_require__.n(SAT),chevron_right_small=__webpack_require__("./packages/design-system/src/icons/chevron_right_small.svg"),checkmark_small=__webpack_require__("./packages/design-system/src/icons/checkmark_small.svg"),story_useStory=__webpack_require__("./packages/story-editor/src/app/story/useStory.ts"),useElementPolygon=__webpack_require__("./packages/story-editor/src/utils/useElementPolygon.js");const ReversedIcon=(0,styled_components_browser_esm.Ay)(chevron_right_small.A).withConfig({displayName:"useLayerSelect__ReversedIcon",componentId:"sc-169lxcx-0"})(["transform:rotate(180deg);"]);const rightClickMenu_useLayerSelect=function useLayerSelect({menuItemProps,menuPosition,isMenuOpen}){const{isRTL}=(0,app_config.UK)(),[isSubMenuOpen,setIsSubMenuOpen]=(0,react_src.J0)(!1),nodesById=(0,app_canvas.yu)((({state:{nodesById}})=>nodesById)),{currentPage,selectedElements,setSelectedElementsById}=(0,story_useStory.A)((({state:{currentPage,selectedElements},actions:{setSelectedElementsById}})=>({currentPage,selectedElements,setSelectedElementsById}))),getElementPolygon=(0,useElementPolygon.A)();(0,react_src.vJ)((()=>{isMenuOpen||setIsSubMenuOpen(!1)}),[isMenuOpen]);const{x,y}=menuPosition,getIntersectingElements=(0,react_src.hb)((()=>{if(!currentPage?.elements?.length||!Object.keys(nodesById)?.length)return[];const clickedPoint=new(SAT_default().Vector)(x,y),intersectingElements=currentPage.elements.map((element=>({element,polygon:getElementPolygon(element)}))).map((({element,polygon})=>SAT_default().pointInPolygon(clickedPoint,polygon)?element:null)).filter(Boolean);return intersectingElements.reverse(),intersectingElements}),[currentPage,x,y,nodesById,getElementPolygon]),subMenuItems=(0,react_src.Kr)((()=>{if(!isMenuOpen||0===selectedElements.length)return[];const intersectingElements=getIntersectingElements();return 1===intersectingElements.length&&intersectingElements[0].id===selectedElements[0].id?[]:intersectingElements.map((element=>{const{id,isBackground,type}=element;return{key:id,supportsIcon:!0,icon:selectedElements[0].id===id?react.createElement(checkmark_small.A,null):null,label:react.createElement("span",null,(0,elements_src.Hi)(element)),onClick:()=>{setSelectedElementsById({elementIds:[id]}),(0,tracking_src.sx)("context_menu_action",{name:"layer_selected",element:type,isBackground})},...menuItemProps}}))}),[getIntersectingElements,isMenuOpen,menuItemProps,setSelectedElementsById,selectedElements]);return subMenuItems.length>0?{label:(0,i18n.__)("Select Layer","web-stories"),openSubMenu:()=>setIsSubMenuOpen(!0),closeSubMenu:()=>setIsSubMenuOpen(!1),isSubMenuOpen,subMenuItems:isSubMenuOpen?subMenuItems:[],SuffixIcon:isRTL?ReversedIcon:chevron_right_small.A,...menuItemProps}:null};const layerHide=function LayerHide(){const updateSelectedElements=(0,app.P3)((ctx=>ctx.actions.updateSelectedElements)),toggleLayerHide=(0,react_src.hb)((()=>updateSelectedElements({properties:oldElement=>({...oldElement,isHidden:!oldElement.isHidden})})),[updateSelectedElements]);return react.createElement(components_button.A,{onClick:toggleLayerHide},constants_RIGHT_CLICK_MENU_LABELS.HIDE_SHOW)};const layerLock=function LayerLock(){const updateSelectedElements=(0,app.P3)((ctx=>ctx.actions.updateSelectedElements)),toggleLayerLock=(0,react_src.hb)((()=>updateSelectedElements({properties:oldElement=>({...oldElement,isLocked:!oldElement.isLocked})})),[updateSelectedElements]);return react.createElement(components_button.A,{onClick:toggleLayerLock},constants_RIGHT_CLICK_MENU_LABELS.LOCK_UNLOCK)};const layerName=function LayerName(){const{selectedElementIds}=(0,app.P3)((({state})=>({selectedElementIds:state.selectedElementIds}))),{setRenamableLayer}=(0,app.yu)((({state,actions})=>({setRenamableLayer:actions.setRenamableLayer,renamableLayer:state.renamableLayer}))),enableLayerNaming=(0,react_src.hb)((()=>{setRenamableLayer({elementId:selectedElementIds[0]})}),[setRenamableLayer,selectedElementIds]);return react.createElement(react.Fragment,null,react.createElement(separator.A,null),react.createElement(components_button.A,{onClick:enableLayerNaming},constants_RIGHT_CLICK_MENU_LABELS.RENAME_LAYER))};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.some.js");const layerUngroup=function LayerUngroup(){const{selectedElements,removeElementFromGroup}=(0,app.P3)((({state,actions})=>({selectedElements:state.selectedElements,removeElementFromGroup:actions.removeElementFromGroup}))),handleLayerUngroup=(0,react_src.hb)((()=>{removeElementFromGroup({elementId:selectedElements[0].id,groupId:selectedElements[0].groupId})}),[selectedElements,removeElementFromGroup]);return selectedElements.some((el=>el.groupId))?react.createElement(components_button.A,{onClick:handleLayerUngroup},constants_RIGHT_CLICK_MENU_LABELS.UNGROUP_LAYER):null},SubMenuContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"shared__SubMenuContainer",componentId:"sc-anftx6-0"})(["position:absolute;top:","px;left:","px;z-index:9999;"],(({position})=>position?.y??0),(({position})=>position?.x??0));SubMenuContainer.propTypes={position:prop_types_default().shape({x:prop_types_default().number,y:prop_types_default().number})};const SUB_MENU_ARIA_LABEL=(0,i18n.__)("Select a layer","web-stories");prop_types_default().oneOfType([prop_types_default().func,prop_types_default().shape({current:prop_types_default().instanceOf(Element)})]).isRequired;function foregroundMediaMenu_extends(){return foregroundMediaMenu_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},foregroundMediaMenu_extends.apply(null,arguments)}const foregroundMediaMenu=function ForegroundMediaMenu({parentMenuRef}){const{copiedElementType,selectedElement}=(0,app.P3)((({state})=>({copiedElementType:state.copiedElementState.type,selectedElement:state.selectedElements?.[0]}))),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),{handleDuplicateSelectedElements,handleOpenScaleAndCrop,handleSetPageBackground}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront,handleCropOffScreenVideo}=hooks_useLayerActions(),{hasShapeMask,removeShapeMask}=(0,useShapeMask.A)(selectedElement),{offCanvas}=(0,react_src.Kr)((()=>isOffCanvas(selectedElement)),[selectedElement]),offScreenVideoCropping=(0,flagged_esm.iT)("offScreenVideoCropping"),canTranscodeResource=(0,app.HZ)((value=>value.state.canTranscodeResource)),{hasTrimMode,toggleTrimMode}=(0,useVideoTrim.A)((({state,actions})=>({hasTrimMode:state.hasTrimMode,toggleTrimMode:actions.toggleTrimMode}))),subMenuRef=(0,react_src.li)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.A)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{},isVideo="video"===selectedElement?.type,scaleLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_VIDEO:constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_IMAGE,copyLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.COPY_VIDEO_STYLES:constants_RIGHT_CLICK_MENU_LABELS.COPY_IMAGE_STYLES,pasteLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.PASTE_VIDEO_STYLES:constants_RIGHT_CLICK_MENU_LABELS.PASTE_IMAGE_STYLES,showToggleTrimMode=isVideo&&hasTrimMode;return react.createElement(react.Fragment,null,layerSelectProps&&react.createElement(react.Fragment,null,react.createElement(subMenuTrigger.A,foregroundMediaMenu_extends({closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen},subMenuTriggerProps)),react.createElement(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0}},react.createElement(contextMenu.A,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef},subMenuItems.map((({key,...menuItemProps})=>react.createElement(item.A,foregroundMediaMenu_extends({key},menuItemProps)))))),react.createElement(separator.A,null)),react.createElement(components_button.A,{onClick:handleDuplicateSelectedElements},constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)),hasShapeMask&&react.createElement(components_button.A,{onClick:removeShapeMask},constants_RIGHT_CLICK_MENU_LABELS.REMOVE_MASK),react.createElement(separator.A,null),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendBackward},constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendToBack},constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringForward},constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringToFront},constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display)),react.createElement(layerName,null),react.createElement(layerLock,null),react.createElement(layerHide,null),react.createElement(layerUngroup,null),react.createElement(separator.A,null),react.createElement(components_button.A,{onClick:handleSetPageBackground},constants_RIGHT_CLICK_MENU_LABELS.SET_AS_PAGE_BACKGROUND),react.createElement(components_button.A,{onClick:handleOpenScaleAndCrop},scaleLabel),offScreenVideoCropping&&isVideo&&offCanvas&&react.createElement(components_button.A,{onClick:handleCropOffScreenVideo},constants_RIGHT_CLICK_MENU_LABELS.CROP_OFF_SCREEN_VIDEO),showToggleTrimMode&&react.createElement(components_button.A,{disabled:!canTranscodeResource(selectedElement?.resource),onClick:toggleTrimMode},constants_RIGHT_CLICK_MENU_LABELS.TRIM_VIDEO),react.createElement(components_button.A,{onClick:handleCopyStyles},copyLabel,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.COPY_STYLES.display)),react.createElement(components_button.A,{disabled:copiedElementType!==selectedElement?.type,onClick:handlePasteStyles},pasteLabel,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.PASTE_STYLES.display)))};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.every.js");const utils_useShapeMaskElements=()=>{const{selectedElements,combineElements}=(0,app.P3)((({state,actions})=>({selectedElements:state.selectedElements,combineElements:actions.combineElements}))),[shapeMaskElements,setShapeMaskElements]=(0,react_src.J0)({}),[canMergeIntoMask,setCanMergeIntoMask]=(0,react_src.J0)(!1);(0,react_src.vJ)((()=>{if(selectedElements?.length>2)return void setCanMergeIntoMask(!1);let target,shape;if(selectedElements.forEach((element=>{const{isMedia}=(0,elements_src.zh)(element.type);"shape"===element.type&&(shape=element),isMedia&&(target=element)})),shape&&target)return setCanMergeIntoMask(!0),void setShapeMaskElements({shape,target});setCanMergeIntoMask(!1)}),[selectedElements]);return{canMergeIntoMask,mergeIntoMask:()=>{const{target,shape}=shapeMaskElements;target&&shape&&combineElements({firstElement:target,secondId:shape.id})}}};const multipleElementsMenu=function MultipleElementsMenu(){const{handleDuplicateSelectedElements,handleGroupSelectedElements,handleUngroupSelectedElements}=hooks_useElementActions(),{canMergeIntoMask,mergeIntoMask}=utils_useShapeMaskElements(),{selectedElements}=(0,app.P3)((({state})=>({selectedElements:state.selectedElements}))),isGroupSelected=selectedElements.some((el=>el.groupId)),isOnlyGroupSelected=selectedElements.every((el=>el.groupId&&el.groupId===selectedElements[0].groupId));return react.createElement(react.Fragment,null,react.createElement(components_button.A,{onClick:handleDuplicateSelectedElements},constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(2)),canMergeIntoMask&&react.createElement(components_button.A,{onClick:mergeIntoMask},constants_RIGHT_CLICK_MENU_LABELS.USE_SHAPE_AS_MASK),!isOnlyGroupSelected&&react.createElement(components_button.A,{onClick:handleGroupSelectedElements},constants_RIGHT_CLICK_MENU_LABELS.GROUP_LAYERS),isGroupSelected&&react.createElement(components_button.A,{onClick:handleUngroupSelectedElements},constants_RIGHT_CLICK_MENU_LABELS.UNGROUP_LAYERS))};function pageMenu_extends(){return pageMenu_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},pageMenu_extends.apply(null,arguments)}const pageMenu=function PageMenu({parentMenuRef}){const{currentPageIndex,canDeletePage,selectedElement}=(0,app.P3)((({state})=>({currentPageIndex:state.currentPageIndex,canDeletePage:state.pages.length>1,selectedElement:state.selectedElements?.[0]}))),{handleOpenScaleAndCrop,handleRemovePageBackground}=hooks_useElementActions(),{handleAddPageAtPosition,handleDeletePage,handleDuplicatePage}=hooks_usePageActions(),canTranscodeResource=(0,app.HZ)((value=>value.state.canTranscodeResource)),{hasTrimMode,toggleTrimMode}=(0,useVideoTrim.A)((({state,actions})=>({hasTrimMode:state.hasTrimMode,toggleTrimMode:actions.toggleTrimMode}))),subMenuRef=(0,react_src.li)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.A)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{},disableBackgroundMediaActions=selectedElement?.isDefaultBackground,isVideo="video"===selectedElement?.type,detachLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.DETACH_VIDEO_FROM_BACKGROUND:constants_RIGHT_CLICK_MENU_LABELS.DETACH_IMAGE_FROM_BACKGROUND,scaleLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_BACKGROUND_VIDEO:constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_BACKGROUND_IMAGE,showTrimModeAction=isVideo&&hasTrimMode;return react.createElement(react.Fragment,null,layerSelectProps&&react.createElement(react.Fragment,null,react.createElement(subMenuTrigger.A,pageMenu_extends({closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen},subMenuTriggerProps)),react.createElement(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0}},react.createElement(contextMenu.A,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef},subMenuItems.map((({key,...menuItemProps})=>react.createElement(item.A,pageMenu_extends({key},menuItemProps)))))),react.createElement(separator.A,null)),react.createElement(components_button.A,{disabled:disableBackgroundMediaActions,onClick:handleRemovePageBackground},detachLabel),react.createElement(components_button.A,{disabled:disableBackgroundMediaActions,onClick:handleOpenScaleAndCrop},scaleLabel),react.createElement(separator.A,null),showTrimModeAction&&react.createElement(react.Fragment,null,react.createElement(components_button.A,{disabled:!canTranscodeResource(selectedElement?.resource),onClick:toggleTrimMode},detachLabel),react.createElement(separator.A,null)),react.createElement(components_button.A,{onClick:()=>handleAddPageAtPosition(currentPageIndex+1)},constants_RIGHT_CLICK_MENU_LABELS.ADD_NEW_PAGE_AFTER),react.createElement(components_button.A,{onClick:()=>handleAddPageAtPosition(currentPageIndex)},constants_RIGHT_CLICK_MENU_LABELS.ADD_NEW_PAGE_BEFORE),react.createElement(components_button.A,{onClick:handleDuplicatePage},constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_PAGE),react.createElement(components_button.A,{disabled:!canDeletePage,onClick:handleDeletePage},constants_RIGHT_CLICK_MENU_LABELS.DELETE_PAGE))};function shapeMenu_extends(){return shapeMenu_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},shapeMenu_extends.apply(null,arguments)}const shapeMenu=function ShapeMenu({parentMenuRef}){const{copiedElementType,selectedElementType}=(0,app.P3)((({state})=>({copiedElementType:state.copiedElementState.type,selectedElementType:state.selectedElements?.[0].type}))),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),{handleDuplicateSelectedElements}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),{handleAddColorPreset}=hooks_usePresetActions(),subMenuRef=(0,react_src.li)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.A)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{};return react.createElement(react.Fragment,null,layerSelectProps&&react.createElement(react.Fragment,null,react.createElement(subMenuTrigger.A,shapeMenu_extends({closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen},subMenuTriggerProps)),react.createElement(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0}},react.createElement(contextMenu.A,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef},subMenuItems.map((({key,...menuItemProps})=>react.createElement(item.A,shapeMenu_extends({key},menuItemProps)))))),react.createElement(separator.A,null)),react.createElement(components_button.A,{onClick:handleDuplicateSelectedElements},constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)),react.createElement(separator.A,null),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendBackward},constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendToBack},constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringForward},constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringToFront},constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display)),react.createElement(layerName,null),react.createElement(layerLock,null),react.createElement(layerHide,null),react.createElement(layerUngroup,null),react.createElement(separator.A,null),react.createElement(components_button.A,{onClick:handleCopyStyles},constants_RIGHT_CLICK_MENU_LABELS.COPY_SHAPE_STYLES,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.COPY_STYLES.display)),react.createElement(components_button.A,{disabled:copiedElementType!==selectedElementType,onClick:handlePasteStyles},constants_RIGHT_CLICK_MENU_LABELS.PASTE_SHAPE_STYLES,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.PASTE_STYLES.display)),react.createElement(components_button.A,{onClick:handleAddColorPreset},constants_RIGHT_CLICK_MENU_LABELS.ADD_TO_COLOR_PRESETS))};function stickerMenu_extends(){return stickerMenu_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},stickerMenu_extends.apply(null,arguments)}const stickerMenu=function StickerMenu({parentMenuRef}){const{handleDuplicateSelectedElements}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),subMenuRef=(0,react_src.li)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.A)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{};return react.createElement(react.Fragment,null,layerSelectProps&&react.createElement(react.Fragment,null,react.createElement(subMenuTrigger.A,stickerMenu_extends({closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen},subMenuTriggerProps)),react.createElement(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0}},react.createElement(contextMenu.A,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef},subMenuItems.map((({key,...menuItemProps})=>react.createElement(item.A,stickerMenu_extends({key},menuItemProps)))))),react.createElement(separator.A,null)),react.createElement(components_button.A,{onClick:handleDuplicateSelectedElements},constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)),react.createElement(separator.A,null),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendBackward},constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendToBack},constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringForward},constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringToFront},constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display)),react.createElement(layerName,null),react.createElement(layerLock,null),react.createElement(layerHide,null),react.createElement(layerUngroup,null))};var output_src=__webpack_require__("./packages/output/src/index.ts");const useHeadingSelect_ReversedIcon=(0,styled_components_browser_esm.Ay)(chevron_right_small.A).withConfig({displayName:"useHeadingSelect__ReversedIcon",componentId:"sc-1xwrfrm-0"})(["transform:rotate(180deg);"]);const hooks_useHeadingSelect=function useHeadingSelect({menuItemProps,isMenuOpen}){const{isRTL}=(0,app_config.UK)(),[isSubMenuOpen,setIsSubMenuOpen]=(0,react_src.J0)(!1),{textElements}=(0,story_useStory.A)((({state})=>({textElements:state.currentPage?.elements?.filter((({type})=>"text"===type))}))),tagNamesMap=(0,output_src.iG)(textElements),{selectedElements,updateSelectedElements}=(0,story_useStory.A)((({state:{selectedElements},actions:{updateSelectedElements}})=>({selectedElements,updateSelectedElements}))),selectedElementsWithTagNames=selectedElements.map((element=>({...element,tagName:tagNamesMap.get(element.id),defaultTagName:element.tagName||"auto"}))),selectedTagName=(0,shared.Bl)(selectedElementsWithTagNames,"defaultTagName","auto"),uniqueTagNames=[...new Set(selectedElementsWithTagNames.map((({tagName})=>tagName||"auto")))],computedTagName=uniqueTagNames?.length?uniqueTagNames[0]:"auto",selectedValue="auto"===selectedTagName?"auto":computedTagName;(0,react_src.vJ)((()=>{isMenuOpen||setIsSubMenuOpen(!1)}),[isMenuOpen]);const subMenuItems=(0,react_src.Kr)((()=>{if(!isMenuOpen||0===selectedElements.length)return[];return[{value:"auto",label:"auto"===selectedValue&&story_editor_src_constants.Dh[computedTagName]?(0,sprintf.A)((0,i18n.__)("Automatic (%s)","web-stories"),story_editor_src_constants.Dh[computedTagName]):(0,i18n.__)("Automatic","web-stories")},{value:"h1",label:story_editor_src_constants.Dh.h1},{value:"h2",label:story_editor_src_constants.Dh.h2},{value:"h3",label:story_editor_src_constants.Dh.h3},{value:"p",label:story_editor_src_constants.Dh.p}].map((element=>{const{value}=element;return{key:value,supportsIcon:!0,icon:selectedValue===value?react.createElement(checkmark_small.A,null):null,label:react.createElement("span",null,element.label),onClick:()=>{updateSelectedElements({properties:oldElement=>({...oldElement,tagName:value})})},...menuItemProps}}))}),[isMenuOpen,menuItemProps,updateSelectedElements,selectedValue,selectedElements,computedTagName]);return subMenuItems.length>0?{label:constants_RIGHT_CLICK_MENU_LABELS.HEADING_LEVEL,openSubMenu:()=>setIsSubMenuOpen(!0),closeSubMenu:()=>setIsSubMenuOpen(!1),isHeadingSubMenuOpen:isSubMenuOpen,headingSubMenuItems:isSubMenuOpen?subMenuItems:[],SuffixIcon:isRTL?useHeadingSelect_ReversedIcon:chevron_right_small.A,...menuItemProps}:null};function textMenu_extends(){return textMenu_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},textMenu_extends.apply(null,arguments)}const textMenu=function TextMenu({parentMenuRef}){const{copiedElementType,selectedElementType}=(0,app.P3)((({state})=>({copiedElementType:state.copiedElementState.type,selectedElementType:state.selectedElements?.[0].type}))),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),{handleDuplicateSelectedElements}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),{handleAddColorPreset,handleAddTextPreset}=hooks_usePresetActions(),subMenuRef=(0,react_src.li)(),headingSubMenuRef=(0,react_src.li)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.A)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{},headingSelectProps=hooks_useHeadingSelect({menuPosition,isMenuOpen:!0}),{closeHeadingSubMenu,isHeadingSubMenuOpen,headingSubMenuItems,...headingSubMenuTriggerProps}=headingSelectProps||{};return react.createElement(react.Fragment,null,layerSelectProps&&react.createElement(react.Fragment,null,react.createElement(subMenuTrigger.A,textMenu_extends({closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen},subMenuTriggerProps)),react.createElement(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0}},react.createElement(contextMenu.A,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef},subMenuItems.map((({key,...menuItemProps})=>react.createElement(item.A,textMenu_extends({key},menuItemProps)))))),react.createElement(separator.A,null)),headingSelectProps&&react.createElement(react.Fragment,null,react.createElement(subMenuTrigger.A,textMenu_extends({closeSubMenu:closeHeadingSubMenu,parentMenuRef,subMenuRef:headingSubMenuRef,isSubMenuOpen:isHeadingSubMenuOpen},headingSubMenuTriggerProps)),react.createElement(SubMenuContainer,{ref:headingSubMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:40}},react.createElement(contextMenu.A,{onDismiss:onCloseMenu,isOpen:isHeadingSubMenuOpen,onCloseSubMenu:closeHeadingSubMenu,"aria-label":constants_RIGHT_CLICK_MENU_LABELS.HEADING_LEVEL,isSubMenu:!0,parentMenuRef},headingSubMenuItems.map((({key,...menuItemProps})=>react.createElement(item.A,textMenu_extends({key},menuItemProps)))))),react.createElement(separator.A,null)),react.createElement(components_button.A,{onClick:handleDuplicateSelectedElements},constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)),react.createElement(separator.A,null),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendBackward},constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendToBack},constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringForward},constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringToFront},constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display)),react.createElement(layerName,null),react.createElement(layerLock,null),react.createElement(layerHide,null),react.createElement(layerUngroup,null),react.createElement(separator.A,null),react.createElement(components_button.A,{onClick:handleCopyStyles},constants_RIGHT_CLICK_MENU_LABELS.COPY_STYLES,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.COPY_STYLES.display)),react.createElement(components_button.A,{disabled:copiedElementType!==selectedElementType,onClick:handlePasteStyles},constants_RIGHT_CLICK_MENU_LABELS.PASTE_STYLES,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.PASTE_STYLES.display)),react.createElement(components_button.A,{onClick:handleAddTextPreset},constants_RIGHT_CLICK_MENU_LABELS.ADD_TO_TEXT_PRESETS),react.createElement(components_button.A,{onClick:handleAddColorPreset},constants_RIGHT_CLICK_MENU_LABELS.ADD_TO_COLOR_PRESETS))};function productMenu_extends(){return productMenu_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},productMenu_extends.apply(null,arguments)}const productMenu=function ProductMenu({parentMenuRef}){const{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),subMenuRef=(0,react_src.li)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.A)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{};return react.createElement(react.Fragment,null,layerSelectProps&&react.createElement(react.Fragment,null,react.createElement(subMenuTrigger.A,productMenu_extends({closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen},subMenuTriggerProps)),react.createElement(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0}},react.createElement(contextMenu.A,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef},subMenuItems.map((({key,...menuItemProps})=>react.createElement(item.A,productMenu_extends({key},menuItemProps)))))),react.createElement(separator.A,null)),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendBackward},constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveBackwards,onClick:handleSendToBack},constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringForward},constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display)),react.createElement(components_button.A,{disabled:!canElementMoveForwards,onClick:handleBringToFront},constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,react.createElement(shortcut.A,null,RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display)),react.createElement(layerName,null),react.createElement(layerLock,null),react.createElement(layerHide,null),react.createElement(layerUngroup,null))};var directionAware=__webpack_require__("./packages/story-editor/src/components/directionAware/index.js"),isEmptyStory=__webpack_require__("./packages/story-editor/src/app/story/utils/isEmptyStory.ts"),resourceList=__webpack_require__("./packages/media/src/resourceList.ts");const library_context=(0,react_src.q6)({tabs:{}});const library_useLibrary=function useLibrary(selector){return(0,react_src.i7)(library_context,selector??react_src.D_)};const local_useOnMediaSelect=function useOnMediaSelect(){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),insertMediaElement=(0,react_src.hb)(((resource,thumbnailURL)=>{resourceList.A.set(resource.id,{url:thumbnailURL,type:"cached"}),insertElement(resource.type,{resource})}),[insertElement]),onSelect=(0,react_src.hb)((resource=>{insertMediaElement(resource,resource.sizes?.medium?.source_url||resource.src)}),[insertMediaElement]);return{insertMediaElement,onSelect}};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.reduce.js");let TextSetType=function(TextSetType){return TextSetType.Cover="cover",TextSetType.Step="step",TextSetType.SectionHeader="section_header",TextSetType.Editorial="editorial",TextSetType.Contact="contact",TextSetType.Table="table",TextSetType.List="list",TextSetType.Quote="quote",TextSetType}({});async function loadTextSet(name){const data=await __webpack_require__("./packages/text-sets/src/raw lazy recursive ^\\.\\/.*\\.json$")(`./${name}.json`);return(0,migration_src._)(data,data.version).pages.reduce(((sets,page)=>{const minMax={minX:Number.POSITIVE_INFINITY,maxX:0,minY:Number.POSITIVE_INFINITY,maxY:0},textElements=page.elements.filter((({type})=>type===elements_src.RJ.Text));return textElements.forEach((element=>function updateMinMax(minMax,element){return minMax.minX=Math.min(minMax.minX,element.x),minMax.maxX=Math.max(minMax.maxX,element.x+element.width),minMax.minY=Math.min(minMax.minY,element.y),minMax.maxY=Math.max(minMax.maxY,element.y+element.height),minMax}(minMax,element))),[...sets,{textSetFonts:page.fonts,id:page.id,textSetCategory:name,elements:textElements.map((e=>({...e,normalizedOffsetX:e.x-minMax.minX,normalizedOffsetY:e.y-minMax.minY,textSetWidth:minMax.maxX-minMax.minX,textSetHeight:minMax.maxY-minMax.minY})))}]}),[])}var uniqueEntriesByKey=__webpack_require__("./packages/design-system/src/utils/uniqueEntriesByKey.ts"),popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),arrow_cloud=__webpack_require__("./packages/design-system/src/icons/arrow_cloud.svg"),input=__webpack_require__("./packages/design-system/src/components/search/input/input.tsx");const StyledSearchInput=(0,styled_components_browser_esm.Ay)(input.A).withConfig({displayName:"searchInput__StyledSearchInput",componentId:"sc-145nauf-0"})(["input{",";}"],shared_styles.Y);const searchInput=function WrappedSearchInput({initialValue,placeholder,onSearch,disabled=!1}){const[localValue,setLocalValue]=(0,react_src.J0)(initialValue),onChange=(0,react_src.hb)((evt=>{const newValue=evt.target.value;setLocalValue(newValue),""===newValue&&onSearch(newValue)}),[onSearch]),onClear=(0,react_src.hb)((()=>{setLocalValue(""),onSearch("")}),[onSearch]),onSubmit=(0,react_src.hb)((evt=>{evt.preventDefault(),onSearch(localValue)}),[localValue,onSearch]),hasContent=localValue.length>0;return react.createElement("form",{onSubmit},react.createElement(StyledSearchInput,{inputValue:localValue,placeholder,onChange,handleClearInput:onClear,disabled,ariaClearLabel:(0,i18n.__)("Clear Search","web-stories"),isOpen:hasContent,"aria-label":(0,i18n.__)("Search","web-stories")}))};var headline=__webpack_require__("./packages/design-system/src/components/typography/headline/index.ts");const section_Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"section__Container",componentId:"sc-emh1dh-0"})(["position:relative;margin-top:28px;margin-bottom:28px;&:first-child{margin-top:0px;}"]),Title=(0,styled_components_browser_esm.Ay)(headline.$).attrs({as:"h2",size:types.$.XXXSmall}).withConfig({displayName:"section__Title",componentId:"sc-emh1dh-1"})(["flex:1 1 auto;color:",";margin-bottom:28px;"],(({theme})=>theme.colors.fg.primary));function Section({title,children,...rest}){return react.createElement(section_Container,rest,react.createElement(Title,null,title),children)}styled_components_browser_esm.Ay.h3.withConfig({displayName:"common__Title",componentId:"sc-q5ifvb-0"})(["color:",";margin:0;font-size:19px;line-height:1.4;flex:3 0 0;display:flex;align-items:center;padding:2px 0;"],(({theme})=>theme.colors.fg.primary)),styled_components_browser_esm.Ay.div.withConfig({displayName:"common__Header",componentId:"sc-q5ifvb-1"})(["display:flex;margin:0 0 25px;"]);var common_styles=__webpack_require__("./packages/story-editor/src/components/library/panes/media/common/styles.js"),providerConfiguration=__webpack_require__("./packages/story-editor/src/app/media/media3p/providerConfiguration.js");const StyledText=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).withConfig({displayName:"paginatedMediaGallery__StyledText",componentId:"sc-1xn8t7i-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),MediaGallery=(0,react_src.RZ)((()=>Promise.all([__webpack_require__.e(9759),__webpack_require__.e(7748)]).then(__webpack_require__.bind(__webpack_require__,"./packages/story-editor/src/components/library/panes/media/common/mediaGallery.js"))));function LazyMediaGallery({providerType,canEditMedia,resources,uploadingResources,onInsert}){return react.createElement(react_src.tY,{fallback:react.createElement(common_styles.Wx,null,react.createElement(StyledText,{size:types.$.Small},(0,i18n.__)("Loading","web-stories")))},react.createElement(MediaGallery,{providerType,canEditMedia,resources,uploadingResources,onInsert}))}const paginatedMediaGallery=function PaginatedMediaGallery({providerType,resources,uploadingResources=[],searchTerm,selectedCategoryId,isMediaLoading,isMediaLoaded,hasMore,onInsert,setNextPage,canEditMedia=!1}){const refContainer=(0,react_src.li)(),isNextPageNeeded=(0,react_src.hb)((()=>refContainer.current.clientHeight===refContainer.current.scrollHeight?setNextPage():noop.l),[setNextPage]),debouncedSetNextPage=(0,react_src.YQ)(isNextPageNeeded,500),loadNextPageIfNeeded=(0,react_src.hb)((()=>{const node=refContainer.current;if(!resources.length||!node||0===node.clientHeight||!hasMore||!isMediaLoaded||isMediaLoading)return;if(node.clientHeight===node.scrollHeight)return void debouncedSetNextPage();node.scrollHeight-node.scrollTop<=node.clientHeight+300&&setNextPage()}),[resources.length,hasMore,isMediaLoaded,isMediaLoading,debouncedSetNextPage,setNextPage]);(0,react_src.vJ)((()=>{refContainer.current?.scrollTo?.(0,0)}),[searchTerm,selectedCategoryId]);const handleScrollOrResize=(0,react_src.YQ)(loadNextPageIfNeeded,500);(0,react_src.Nf)((()=>{!async function loadNextPageIfNeededAfterGalleryRendering(){var ms;await(ms=200,new Promise((resolve=>setTimeout(resolve,ms)))),loadNextPageIfNeeded()}()}),[loadNextPageIfNeeded]),(0,react_src.vJ)((()=>{const node=refContainer.current;if(node)return node.addEventListener("scroll",handleScrollOrResize),window.addEventListener("resize",handleScrollOrResize),()=>{node.removeEventListener("scroll",handleScrollOrResize),window.removeEventListener("resize",handleScrollOrResize)}}),[handleScrollOrResize]);const mediaGallery=!isMediaLoaded||resources.length||uploadingResources.length?react.createElement("div",{style:{marginBottom:15}},react.createElement(LazyMediaGallery,{providerType,canEditMedia,resources,uploadingResources,onInsert})):react.createElement(common_styles.aN,null,(0,i18n.__)("No media found.","web-stories")),[showLoadingPill,setShowLoadingPill]=(0,react_src.J0)(!1);(0,react_src.vJ)((()=>{if(isMediaLoading&&hasMore){const showLoadingTimeout=setTimeout((()=>{setShowLoadingPill(isMediaLoading)}),1e3);return()=>clearTimeout(showLoadingTimeout)}setShowLoadingPill(!1)}),[isMediaLoading,hasMore]);const attribution="local"!==providerType&&providerConfiguration.x[providerType].attributionComponent&&providerConfiguration.x[providerType].attributionComponent();return react.createElement(react.Fragment,null,react.createElement(common_styles.Yk,{"data-testid":"media-gallery-container",ref:refContainer},react.createElement(common_styles.m8,null,mediaGallery)),showLoadingPill&&react.createElement(common_styles.Wx,{"data-testid":"loading-pill"},react.createElement(StyledText,{size:types.$.Small},(0,i18n.__)("Loading","web-stories"))),!showLoadingPill&&attribution)};var panes_shared=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/index.js"),local_types=__webpack_require__("./packages/story-editor/src/app/media/local/types.js");const paneId=(0,panes_shared.kN)("media");var localStore=__webpack_require__("./packages/design-system/src/utils/localStore.ts");const storageKey=localStore.$.VIDEO_OPTIMIZATION_DIALOG_DISMISSED;const videoOptimizationDialog=function VideoOptimizationDialog(){const{isTranscoding}=(0,app_media.HZ)((({state:{isTranscoding}})=>({isTranscoding}))),[isDialogDismissed,setIsDialogDismissed]=(0,react_src.J0)(Boolean(localStore.x.getItemByKey(storageKey))),{updateCurrentUser}=(0,currentUser.iZ)((({actions})=>({updateCurrentUser:actions.updateCurrentUser}))),setIsDialogDismissedValue=(0,react_src.hb)((value=>{setIsDialogDismissed(value),localStore.x.setItemByKey(storageKey,value)}),[]),onDisable=(0,react_src.hb)((()=>{updateCurrentUser({mediaOptimization:!1}),setIsDialogDismissedValue(!0)}),[updateCurrentUser,setIsDialogDismissedValue]),onClose=(0,react_src.hb)((()=>{setIsDialogDismissedValue(!0)}),[setIsDialogDismissedValue]),dialogTitle=(0,i18n.__)("Video optimization in progress","web-stories"),dialogDescription=(0,i18n.__)("This process cant be stopped once it begins. Optimization is automatically enabled for all videos to ensure smooth playback. You can disable optimization any time in Settings.","web-stories");return react.createElement(dialog.A,{isOpen:isTranscoding&&!isDialogDismissed,onClose,title:dialogTitle,onSecondary:onDisable,secondaryText:(0,i18n.__)("Disable optimization","web-stories"),onPrimary:onClose,primaryText:(0,i18n.__)("Sounds good","web-stories")},react.createElement(typography_text.E.Paragraph,{size:types.$.Small},dialogDescription))};var icons_link=__webpack_require__("./packages/design-system/src/icons/link.svg"),hotlinkModal=__webpack_require__("./packages/story-editor/src/components/hotlinkModal/index.js"),src_mimeTypes=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.flat-map.js"),__webpack_require__("./packages/media/src/mimeTypes.ts")),preloadVideo=__webpack_require__("./packages/media/src/preloadVideo.ts"),seekVideo=__webpack_require__("./packages/media/src/seekVideo.ts"),getVideoLength=__webpack_require__("./packages/media/src/getVideoLength.ts"),hasVideoGotAudio=__webpack_require__("./packages/media/src/hasVideoGotAudio.ts"),getImageFromVideo=__webpack_require__("./packages/media/src/getImageFromVideo.ts"),blobToFile=__webpack_require__("./packages/media/src/blobToFile.ts"),useLocalMedia=__webpack_require__("./packages/story-editor/src/app/media/local/useLocalMedia.js"),getResourceFromUrl=__webpack_require__("./packages/story-editor/src/app/media/utils/getResourceFromUrl.ts"),media_utils=__webpack_require__("./packages/story-editor/src/app/media/utils/index.js"),useCORSProxy=__webpack_require__("./packages/story-editor/src/utils/useCORSProxy.ts");const hotlink_useInsert=function useInsert(){const[isOpen,setIsOpen]=(0,react_src.J0)(!1),{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{capabilities:{hasUploadMediaAction},allowedMimeTypes:{image:allowedImageMimeTypes,vector:allowedVectorMimeTypes,video:allowedVideoMimeTypes}}=(0,app_config.UK)(),{updateBaseColor}=(0,useLocalMedia.A)((({actions:{updateBaseColor}})=>({updateBaseColor}))),allowedMimeTypes=(0,react_src.Kr)((()=>[...allowedImageMimeTypes,...allowedVectorMimeTypes,...allowedVideoMimeTypes]),[allowedImageMimeTypes,allowedVectorMimeTypes,allowedVideoMimeTypes]),allowedFileTypes=(0,react_src.Kr)((()=>allowedMimeTypes.flatMap((type=>(0,src_mimeTypes.n)(type)))),[allowedMimeTypes]),{uploadVideoPoster}=(0,media_utils.R)({}),{getProxiedUrl}=(0,useCORSProxy.A)(),onSelect=(0,react_src.hb)((async({link,hotlinkInfo,needsProxy})=>{const{ext,type,mimeType,fileName:originalFileName}=hotlinkInfo,isVideo="video"===type;try{const proxiedUrl=needsProxy?getProxiedUrl({needsProxy},link):link,resourceLike={id:(0,v4.A)(),src:proxiedUrl,mimeType,needsProxy,alt:originalFileName};if(isVideo){const video=await(0,preloadVideo.A)(proxiedUrl);await(0,seekVideo.A)(video),resourceLike.width=video.videoWidth,resourceLike.height=video.videoHeight;const videoLength=(0,getVideoLength.A)(video);if(resourceLike.length=videoLength.length,resourceLike.lengthFormatted=videoLength.lengthFormatted,resourceLike.isMuted=!(0,hasVideoGotAudio.A)(video),hasUploadMediaAction)try{const fileName=(0,media_utils.nn)(originalFileName.replace(`.${ext}`,"")),blob=await(0,getImageFromVideo.A)(video),posterFile=(0,blobToFile.A)(blob,fileName,story_editor_src_constants.Ni),posterData=await uploadVideoPoster(0,posterFile);resourceLike.poster=posterData.poster,resourceLike.posterId=posterData.posterId}catch{}}const resource=await(0,getResourceFromUrl.A)(resourceLike);resource.src=link,insertElement(type,{resource}),updateBaseColor(resource),(0,tracking_src.sx)("hotlink_media",{event_label:link,file_size:hotlinkInfo.fileSize,file_type:hotlinkInfo.mimeType,needs_proxy:needsProxy}),setIsOpen(!1)}catch(e){}}),[getProxiedUrl,insertElement,updateBaseColor,hasUploadMediaAction,uploadVideoPoster]);return{action:{onSelect,onError:(0,react_src.hb)((err=>(0,tracking_src.Oz)("hotlink_media",err?.message)),[]),onClick:()=>setIsOpen(!0),onClose:()=>setIsOpen(!1)},state:{allowedFileTypes,isOpen}}},hotlink_Button=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"hotlink__Button",componentId:"sc-1njsgyy-0"})(["",";margin:0 10px 0 0;"],shared_styles.Y);const hotlink=function Hotlink(){const label=(0,i18n.__)("Insert by link","web-stories"),{action:{onSelect,onError,onClose,onClick},state:{allowedFileTypes,isOpen}}=hotlink_useInsert();return react.createElement(react.Fragment,null,react.createElement(components_tooltip.A,{title:label},react.createElement(hotlink_Button,{variant:constants.Ak.Square,type:constants.VQ.Secondary,size:constants.Mp.Small,onClick,"aria-label":label},react.createElement(icons_link.A,null))),react.createElement(hotlinkModal.A,{onClose,isOpen,onError,onSelect,allowedFileTypes,title:(0,i18n.__)("Insert external image or video","web-stories")}))};var camera=__webpack_require__("./packages/design-system/src/icons/camera.svg"),useMediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/useMediaRecording.js");const mediaRecording_Button=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"mediaRecording__Button",componentId:"sc-zpc7g2-0"})(["",";margin:0 10px 0 0;"],shared_styles.Y),Camera=(0,styled_components_browser_esm.Ay)(camera.A).withConfig({displayName:"mediaRecording__Camera",componentId:"sc-zpc7g2-1"})(["width:24px !important;height:24px !important;"]);const mediaRecording=function MediaRecording(){const{isInRecordingMode,toggleRecordingMode}=(0,useMediaRecording.A)((({state:{isInRecordingMode},actions:{toggleRecordingMode}})=>({isInRecordingMode,toggleRecordingMode}))),{isTranscodingEnabled}=(0,useFFmpeg.A)(),onClick=(0,react_src.hb)((()=>{(0,tracking_src.sx)("media_recording_toggled",{status:isInRecordingMode?"closed":"open"}),toggleRecordingMode()}),[isInRecordingMode,toggleRecordingMode]);if(!isTranscodingEnabled)return null;const label=(0,i18n.__)("Record Video/Audio","web-stories");return react.createElement(components_tooltip.A,{title:label},react.createElement(mediaRecording_Button,{variant:constants.Ak.Square,type:constants.VQ.Secondary,size:constants.Mp.Small,onClick,"aria-label":label,"aria-pressed":isInRecordingMode,isToggled:isInRecordingMode},react.createElement(Camera,null)))};function mediaPane_extends(){return mediaPane_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},mediaPane_extends.apply(null,arguments)}const mediaPane_Button=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"mediaPane__Button",componentId:"sc-usipec-0"})(["",";"],shared_styles.Y),FilterArea=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaPane__FilterArea",componentId:"sc-usipec-1"})(["display:flex;justify-content:space-between;margin-top:24px;padding:0 "," 0 ",";"],panes_shared.z7,panes_shared.z7),SearchCount=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Medium}).withConfig({displayName:"mediaPane__SearchCount",componentId:"sc-usipec-2"})(["display:flex;align-items:center;justify-content:center;flex-shrink:0;"]),ButtonsWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaPane__ButtonsWrapper",componentId:"sc-usipec-3"})(["display:flex;flex:1;justify-content:flex-end;"]),FILTER_NONE=local_types.eQ,FILTERS=[{value:FILTER_NONE,label:(0,i18n.__)("All Types","web-stories")},{value:"image",label:(0,i18n.__)("Images","web-stories")},{value:"video",label:(0,i18n.__)("Video","web-stories")}];const mediaPane=function MediaPane(props){const{hasMore,media,uploadingMedia,isMediaLoading,isMediaLoaded,mediaType,searchTerm,setNextPage,setMediaType,setSearchTerm,totalItems}=(0,app_media.HZ)((({state:{hasMore,media,uploadingMedia,isMediaLoading,isMediaLoaded,mediaType,searchTerm,totalItems},actions:{setNextPage,setMediaType,setSearchTerm}})=>({hasMore,media,uploadingMedia:!media.length&&isMediaLoading?[]:uploadingMedia,isMediaLoading,isMediaLoaded,mediaType,searchTerm,totalItems,setNextPage,setMediaType,setSearchTerm}))),{capabilities:{hasUploadMediaAction}}=(0,app_config.UK)(),isSearching=searchTerm.length>0,onFilter=(0,react_src.hb)(((evt,filter)=>{setMediaType({mediaType:filter})}),[setMediaType]),{onSelect,insertMediaElement}=local_useOnMediaSelect();(0,react_src.vJ)((()=>{searchTerm.length>0&&(0,tracking_src.sx)("search",{search_type:"media",search_term:searchTerm,search_filter:mediaType})}),[searchTerm,mediaType]);const renderUploadButtonIcon=(0,react_src.hb)((open=>react.createElement(mediaPane_Button,{variant:constants.Ak.Square,type:constants.VQ.Secondary,size:constants.Mp.Small,onClick:open,"aria-label":(0,i18n.__)("Upload","web-stories")},react.createElement(arrow_cloud.A,null))),[]);return react.createElement(common_styles.SM,mediaPane_extends({id:paneId},props),react.createElement(common_styles.HT,null,react.createElement(common_styles.QM,null,react.createElement(common_styles.oG,null,react.createElement(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch:value=>{const trimText=value.trim();trimText!==searchTerm&&setSearchTerm({searchTerm:trimText})}})),react.createElement(FilterArea,null,react.createElement(components_form.l6,{selectedValue:mediaType?.toString()||FILTER_NONE,onMenuItemClick:onFilter,options:FILTERS,placement:popup_constants.W.BottomStart}),isSearching&&media.length>0&&react.createElement(SearchCount,null,(0,sprintf.A)((0,i18n._n)("%s result found.","%s results found.",totalItems,"web-stories"),totalItems)),!isSearching&&react.createElement(ButtonsWrapper,null,react.createElement(mediaRecording,null),react.createElement(hotlink,null),hasUploadMediaAction&&react.createElement(components_tooltip.A,{title:(0,i18n.__)("Upload","web-stories")},react.createElement(components_form.c4,{renderButton:renderUploadButtonIcon,onInsert:onSelect}))))),!isMediaLoaded||media.length||uploadingMedia.length?react.createElement(paginatedMediaGallery,{providerType:"local",canEditMedia:hasUploadMediaAction,resources:media,uploadingResources:uploadingMedia,isMediaLoading,isMediaLoaded,hasMore,onInsert:insertMediaElement,setNextPage,searchTerm}):react.createElement(common_styles.aN,null,isSearching?(0,i18n.__)("No results found.","web-stories"):(0,i18n.__)("No media found.","web-stories")),react.createElement(videoOptimizationDialog,null)))};const mediaIcon=function MediaIcon(){return react.createElement(arrow_cloud.A,{title:(0,i18n.__)("Media Gallery","web-stories")})};var useMedia=__webpack_require__("./packages/story-editor/src/app/media/useMedia.js"),translateWithMarkup=__webpack_require__("./packages/i18n/src/translateWithMarkup.tsx"),typography_link=__webpack_require__("./packages/design-system/src/components/typography/link/index.tsx");const termsDialog=function TermsDialog(){const hasAcknowledgedTerms3p=localStore.x.getItemByKey(localStore.$.TERMS_MEDIA3P),[dialogOpen,setDialogOpen]=(0,react_src.J0)(!hasAcknowledgedTerms3p),acknowledgeTerms=(0,react_src.hb)((()=>{setDialogOpen(!1),localStore.x.setItemByKey(localStore.$.TERMS_MEDIA3P,!0),(0,tracking_src.sx)("media3p_terms_acknowledged")}),[]);(0,react_src.vJ)((()=>{setDialogOpen(!hasAcknowledgedTerms3p)}),[hasAcknowledgedTerms3p]);const onTermsClick=(0,react_src.hb)((evt=>{(0,tracking_src.MP)(evt,"click_terms_of_service")}),[]);return hasAcknowledgedTerms3p?null:react.createElement(dialog.A,{isOpen:dialogOpen,contentLabel:(0,i18n.__)("Third party stock content terms","web-stories"),onClose:acknowledgeTerms,ariaHideApp:!1,onPrimary:acknowledgeTerms,primaryText:(0,i18n.__)("Dismiss","web-stories")},react.createElement(typography_text.E.Paragraph,{size:types.$.Small},react.createElement(translateWithMarkup.A,{mapping:{a:react.createElement(typography_link.N,{size:types.$.Small,href:"https://wp.stories.google/docs/terms/",rel:"noreferrer",target:"_blank","aria-label":(0,i18n.__)("Learn more by visiting Web Stories for WordPress","web-stories"),onClick:onTermsClick})}},(0,i18n.__)("Your use of stock content is subject to third party terms. <a>Learn more.</a>","web-stories"))))},media3p_paneId=(0,panes_shared.kN)("media3p");function providerTab_extends(){return providerTab_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},providerTab_extends.apply(null,arguments)}const providerTab_StyledText=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).withConfig({displayName:"providerTab__StyledText",componentId:"sc-1muzdn0-0"})(["color:inherit;"]),Tab=styled_components_browser_esm.Ay.button.withConfig({displayName:"providerTab__Tab",componentId:"sc-1muzdn0-1"})(["padding:6px 16px;background:none;border:none;color:",";position:relative;cursor:pointer;:hover{color:",";}border-radius:",";",";",""],(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.colors.fg.primary),(({theme})=>theme.borders.radius.x_large),shared_styles.Y,(({$isActive,theme})=>$isActive&&(0,styled_components_browser_esm.AH)(["::after{content:'';position:absolute;background-color:",";height:2px;border-radius:1px;bottom:-17px;left:16px;right:16px;}"],theme.colors.border.selection)));const providerTab=function ProviderTab({name,isActive,...rest}){return react.createElement(Tab,providerTab_extends({$isActive:isActive},rest),react.createElement(providerTab_StyledText,{size:types.$.Small},name))},providerTabList_Section=styled_components_browser_esm.Ay.div.attrs({role:"tablist"}).withConfig({displayName:"providerTabList__Section",componentId:"sc-19jgogw-0"})(["display:flex;flex-wrap:wrap;margin-top:16px;margin-bottom:16px;padding:0 1em;"]);const providerTabList=function ProviderTabList({providers}){const{isRTL}=(0,app_config.UK)(),ref=(0,react_src.li)(),{selectedProvider,setSelectedProvider}=(0,useMedia.A)((({media3p:{state:{selectedProvider},actions:{setSelectedProvider}}})=>({selectedProvider,setSelectedProvider}))),[focusedIndex,setFocusedIndex]=(0,react_src.J0)(0),providerCount=providers.length;(0,react_src.vJ)((()=>setFocusedIndex(providers.indexOf(selectedProvider))),[providers,selectedProvider]);const focusByIndex=(0,react_src.hb)((newIndex=>{if(!ref.current)return;ref.current.children[newIndex].focus()}),[]),selectFocused=(0,react_src.hb)((()=>setSelectedProvider({provider:providers[focusedIndex]})),[focusedIndex,setSelectedProvider,providers]),dir=isRTL?-1:1;return(0,keyboard._h)(ref,"left",(()=>focusByIndex((focusedIndex-dir+providerCount)%providerCount)),[focusByIndex,focusedIndex,dir,providerCount]),(0,keyboard._h)(ref,"right",(()=>focusByIndex((focusedIndex+dir+providerCount)%providerCount)),[focusByIndex,focusedIndex,dir,providerCount]),(0,keyboard._h)(ref,"home",(()=>focusByIndex(0)),[focusByIndex]),(0,keyboard._h)(ref,"end",(()=>focusByIndex(providerCount-1)),[focusByIndex,providerCount]),(0,keyboard._h)(ref,["enter","space"],selectFocused,[selectFocused]),react.createElement(providerTabList_Section,{ref},providers.map(((providerType,index)=>react.createElement(providerTab,{key:providerType,index,name:providerConfiguration.x[providerType].displayName,isActive:selectedProvider===providerType,onClick:()=>setSelectedProvider({provider:providerType}),onFocus:()=>setFocusedIndex(index),tabIndex:selectedProvider===providerType?0:-1,role:"tab",id:`provider-tab-${providerType}`,"aria-controls":`provider-tabpanel-${providerType}`}))))};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.find.js");var useMedia3pApi=__webpack_require__("./packages/story-editor/src/app/media/media3p/api/useMedia3pApi.js");function providerPanel_extends(){return providerPanel_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},providerPanel_extends.apply(null,arguments)}const MediaSubheading=(0,styled_components_browser_esm.Ay)(headline.$).attrs((()=>({as:"h2",size:types.$.XXSmall}))).withConfig({displayName:"providerPanel__MediaSubheading",componentId:"sc-1c53rqi-0"})(["margin-top:24px;padding:0 24px;",""],(props=>props.shouldDisplay||"display: none;")),ProviderWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"providerPanel__ProviderWrapper",componentId:"sc-1c53rqi-1"})(["position:relative;display:flex;flex-direction:column;height:100%;min-height:100px;max-width:100%;top:0;left:0;",""],(({hidden})=>hidden&&(0,styled_components_browser_esm.AH)(["position:absolute;visibility:hidden;"])));const providerPanel=function ProviderPanel({providerType,isActive,searchTerm,...rest}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{actions:{registerUsage}}=(0,useMedia3pApi.A)(),{updateBaseColor}=(0,useLocalMedia.A)((({actions:{updateBaseColor}})=>({updateBaseColor}))),handleRegisterUsage=(0,react_src.hb)((resource=>{resource?.attribution?.registerUsageUrl&&registerUsage({registerUsageUrl:resource.attribution.registerUsageUrl})}),[registerUsage]),insertMediaElement=(0,react_src.hb)(((resource,thumbnailURL)=>{resourceList.A.set(resource.id,{url:thumbnailURL,type:"cached"}),insertElement(resource.type,{resource}),handleRegisterUsage(resource),resource.baseColor||updateBaseColor(resource)}),[insertElement,handleRegisterUsage,updateBaseColor]),{media3p}=(0,useMedia.A)((({media3p})=>({media3p})));if(!isActive)return react.createElement(ProviderWrapper,providerPanel_extends({},rest,{hidden:!0}));const state=media3p[providerType].state,actions=media3p[providerType].actions,displayName=state.categories.selectedCategoryId?state.categories.categories.find((e=>e.id===state.categories.selectedCategoryId)).label:(0,i18n.__)("Trending","web-stories"),shouldDisplayMediaSubheading=Boolean(state.media?.length||state.categories.selectedCategoryId),searchResultsLabel=(0,i18n.__)("Search Results","web-stories");return react.createElement(ProviderWrapper,rest,providerConfiguration.x[providerType].supportsCategories&&react.createElement(panes_shared.Iy,{items:state.categories.categories,selectedItemId:state.categories.selectedCategoryId,selectItem:actions.selectCategory,deselectItem:actions.deselectCategory}),react.createElement(MediaSubheading,{"data-testid":"media-subheading",shouldDisplay:shouldDisplayMediaSubheading},searchTerm.length&&!state.categories.selectedCategoryId?searchResultsLabel:displayName),react.createElement(paginatedMediaGallery,{providerType,resources:state.media,isMediaLoading:state.isMediaLoading,isMediaLoaded:state.isMediaLoaded,hasMore:state.hasMore,setNextPage:actions.setNextPage,onInsert:insertMediaElement,searchTerm,selectedCategoryId:state.categories.selectedCategoryId}))};function media3pPane_extends(){return media3pPane_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},media3pPane_extends.apply(null,arguments)}const PaneBottom=styled_components_browser_esm.Ay.div.withConfig({displayName:"media3pPane__PaneBottom",componentId:"sc-1hq1xk8-0"})(["position:relative;height:100%;flex:1 1 auto;min-height:0;"]);const media3pPane=function Media3pPane(props){const{isActive}=props,{searchTerm,selectedProvider,setSelectedProvider,setSearchTerm,media3p}=(0,useMedia.A)((({media3p:{state:{selectedProvider,searchTerm},actions:{setSelectedProvider,setSearchTerm}},media3p})=>({searchTerm,selectedProvider,setSelectedProvider,setSearchTerm,media3p})));(0,react_src.vJ)((()=>{isActive&&!selectedProvider&&setSelectedProvider({provider:Object.keys(providerConfiguration.x)[0]})}),[isActive,selectedProvider,setSelectedProvider]);const selectedCategoryId=media3p[selectedProvider]?.state?.categories?.selectedCategoryId;(0,react_src.vJ)((()=>{searchTerm.length&&(0,tracking_src.sx)("search",{search_type:"media3p",search_term:searchTerm,search_filter:selectedProvider,search_category:selectedCategoryId})}),[selectedProvider,searchTerm,selectedCategoryId]);const onSearch=(0,react_src.hb)((value=>{const trimText=value.trim();trimText!==searchTerm&&setSearchTerm({searchTerm:trimText})}),[searchTerm,setSearchTerm]),paneBottomRef=(0,react_src.li)(),features=(0,flagged_esm.Jr)(),providers=(0,react_src.Kr)((()=>Object.keys(providerConfiguration.x).filter((p=>!providerConfiguration.x[p].featureName||features[providerConfiguration.x[p].featureName]))),[features]);return react.createElement(react.Fragment,null,isActive&&react.createElement(termsDialog,null),react.createElement(common_styles.SM,media3pPane_extends({id:media3p_paneId},props),react.createElement(common_styles.HT,null,react.createElement(common_styles.QM,null,react.createElement(common_styles.oG,null,react.createElement(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch,disabled:Boolean(selectedProvider&&providerConfiguration.x[selectedProvider].supportsCategories&&media3p[selectedProvider]?.state.categories.selectedCategoryId)})),react.createElement(providerTabList,{providers})),react.createElement(PaneBottom,{ref:paneBottomRef},providers.map((providerType=>react.createElement(providerPanel,{key:providerType,providerType,isActive:providerType===selectedProvider,searchTerm,role:"tabpanel","aria-labelledby":`provider-tab-${providerType}`,id:`provider-tabpanel-${providerType}`})))))))};var picture=__webpack_require__("./packages/design-system/src/icons/picture.svg");const media3pIcon=function Media3pIcon(){return react.createElement(picture.A,{title:(0,i18n.__)("Explore Media","web-stories")})};var stickers_src=__webpack_require__("./packages/stickers/src/index.ts"),masks_src=__webpack_require__("./packages/masks/src/index.ts"),useRovingTabIndex=__webpack_require__("./packages/story-editor/src/utils/useRovingTabIndex/index.js"),createSolidFromString=__webpack_require__("./packages/patterns/src/createSolidFromString.ts"),useUnits=__webpack_require__("./packages/units/src/useUnits.ts"),libraryMoveable=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/libraryMoveable.js"),insertionOverlay=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/insertionOverlay.js");const DEFAULT_ELEMENT_WIDTH=src_constants.bj/3,Aspect=styled_components_browser_esm.Ay.button.withConfig({displayName:"shapePreview__Aspect",componentId:"sc-1pj9cm0-0"})(["background:transparent;outline:none;border:0;padding:0;position:relative;border-radius:",";background-color:",";&:focus-visible [role='presentation']{",";}"],(({theme})=>theme.borders.radius.small),(({theme})=>theme.colors.interactiveBg.previewOverlay),(({theme})=>outline.g(theme.colors.border.focus,theme.colors.bg.secondary))),AspectInner=styled_components_browser_esm.Ay.div.withConfig({displayName:"shapePreview__AspectInner",componentId:"sc-1pj9cm0-1"})(["position:relative;padding-bottom:95.5%;"]),ShapePreviewContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"shapePreview__ShapePreviewContainer",componentId:"sc-1pj9cm0-2"})(["position:absolute;top:0;left:0;height:100%;width:100%;border-radius:",";display:flex;justify-content:center;align-items:center;svg{display:inline-block;width:36px;height:36px;}"],(({theme})=>theme.borders.radius.small)),ShapeClone=styled_components_browser_esm.Ay.div.withConfig({displayName:"shapePreview__ShapeClone",componentId:"sc-1pj9cm0-3"})(["position:absolute;top:0;left:0;opacity:0;width:",";height:",";svg{display:inline-block;width:100%;height:100%;path{fill:#c4c4c4;}}"],(({width})=>`${width}px`),(({height})=>`${height}px`)),ShapePreviewSizer=styled_components_browser_esm.Ay.div.withConfig({displayName:"shapePreview__ShapePreviewSizer",componentId:"sc-1pj9cm0-4"})(["padding-top:100%;"]),Path=styled_components_browser_esm.Ay.path.withConfig({displayName:"shapePreview__Path",componentId:"sc-1pj9cm0-5"})(["fill:",";"],(({theme})=>theme.colors.fg.primary));const shapePreview=function ShapePreview({mask,isPreview,index}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{dataToEditorX,dataToEditorY}=(0,useUnits.A)((state=>({dataToEditorX:state.actions.dataToEditorX,dataToEditorY:state.actions.dataToEditorY}))),[active,setActive]=(0,react_src.J0)(!1),makeActive=()=>setActive(!0),makeInactive=()=>setActive(!1),ref=(0,react_src.li)(),pathRef=(0,react_src._3)(),shapeData=(0,react_src.Kr)((()=>({backgroundColor:(0,createSolidFromString.A)("#c4c4c4"),width:DEFAULT_ELEMENT_WIDTH*mask.ratio,height:DEFAULT_ELEMENT_WIDTH,mask:{type:mask.type},lockAspectRatio:masks_src.E_.RECTANGLE!==mask.type})),[mask.ratio,mask.type]),onClick=(0,react_src.hb)((()=>{insertElement("shape",shapeData),(0,tracking_src.sx)("insert_shape",{name:mask.type})}),[insertElement,shapeData,mask.type]),getSVG=(displayLabel=!0)=>react.createElement("svg",{viewBox:"0 0 1 "+1/(isPreview&&mask.iconRatio?mask.iconRatio:mask.ratio),width:36*(isPreview&&mask.iconRatio?mask.iconRatio:mask.ratio),height:36},displayLabel&&react.createElement("title",null,mask.name),react.createElement(Path,{d:isPreview&&mask.iconPath?mask.iconPath:mask.path,ref:pathRef}));return react.createElement(Aspect,{ref,onClick,tabIndex:0===index?0:-1,"aria-label":mask.name,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive},react.createElement(AspectInner,null,react.createElement(ShapePreviewContainer,{key:mask.type},react.createElement(ShapePreviewSizer,null),getSVG()),active&&react.createElement(insertionOverlay.A,null)),react.createElement(libraryMoveable.A,{type:"shape",elementProps:shapeData,cloneElement:ShapeClone,onClick,cloneProps:{width:dataToEditorX(DEFAULT_ELEMENT_WIDTH*mask.ratio),height:dataToEditorY(DEFAULT_ELEMENT_WIDTH),children:getSVG(!1)}}))},StickerButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({size:constants.Mp.Small}).withConfig({displayName:"stickerPreview__StickerButton",componentId:"sc-rjblwe-0"})(["position:relative;padding:0 0 95.5% 0;margin:0;height:60px;background-color:",";&:focus-visible{box-shadow:none;}&:focus-visible [role='presentation']{",";}"],(({theme})=>theme.colors.interactiveBg.previewOverlay),(({theme})=>outline.g(theme.colors.border.focus,theme.colors.bg.secondary))),StickerInner=styled_components_browser_esm.Ay.div.withConfig({displayName:"stickerPreview__StickerInner",componentId:"sc-rjblwe-1"})(["position:absolute;top:0;left:0;height:100%;width:100%;display:flex;align-items:center;justify-content:center;"]),StickerClone=styled_components_browser_esm.Ay.div.withConfig({displayName:"stickerPreview__StickerClone",componentId:"sc-rjblwe-2"})(["position:absolute;top:0;left:0;opacity:0;width:",";height:",";"],(({width})=>`${width}px`),(({height})=>`${height}px`));const stickerPreview=function StickerPreview({stickerType,index}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{dataToEditorX,dataToEditorY}=(0,useUnits.A)((state=>({dataToEditorX:state.actions.dataToEditorX,dataToEditorY:state.actions.dataToEditorY}))),sticker=stickers_src.A[stickerType],aspectRatio=sticker.aspectRatio,stickerData=(0,react_src.Kr)((()=>({width:DEFAULT_ELEMENT_WIDTH*aspectRatio,height:DEFAULT_ELEMENT_WIDTH,sticker:{type:stickerType}})),[aspectRatio,stickerType]),[isActive,setIsActive]=(0,react_src.J0)(!1),makeActive=()=>setIsActive(!0),makeInactive=()=>setIsActive(!1),onClick=()=>insertElement("sticker",{width:DEFAULT_ELEMENT_WIDTH,sticker:{type:stickerType}}),Svg=sticker.svg;return react.createElement(StickerButton,{"data-testid":`library-sticker-${stickerType}`,onClick,tabIndex:0===index?0:-1,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive},react.createElement(StickerInner,null,react.createElement(Svg,{style:{height:aspectRatio<.955?"60%":"auto",width:aspectRatio<.955?"auto":"60%"}}),isActive&&react.createElement(insertionOverlay.A,null),react.createElement(libraryMoveable.A,{type:"sticker",elementProps:stickerData,cloneElement:StickerClone,onClick,cloneProps:{width:dataToEditorX(DEFAULT_ELEMENT_WIDTH*(aspectRatio<1?aspectRatio:1)),height:dataToEditorY(DEFAULT_ELEMENT_WIDTH/(aspectRatio<1?1:aspectRatio)),children:react.createElement(Svg,{style:{height:"auto",width:"100%"}})}})))},shapes_paneId=(0,panes_shared.kN)("shapes");function shapesPane_extends(){return shapesPane_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},shapesPane_extends.apply(null,arguments)}const SectionContent=styled_components_browser_esm.Ay.div.withConfig({displayName:"shapesPane__SectionContent",componentId:"sc-ffcyax-0"})(["position:relative;display:grid;grid-column-gap:12px;grid-row-gap:24px;@media screen and (min-width:1220px){grid-template-columns:repeat(4,1fr);}@media screen and (min-width:1100px) and (max-width:1220px){grid-template-columns:repeat(3,1fr);}@media screen and (max-width:1100px){grid-template-columns:repeat(2,1fr);}"]),STICKER_TYPES=Object.keys(stickers_src.A);const shapesPane=function ShapesPane(props){const ref=(0,react_src.li)();(0,useRovingTabIndex.A)({ref});const stickersRef=(0,react_src.li)(null);return(0,useRovingTabIndex.A)({ref:stickersRef}),react.createElement(panes_shared.Zv,shapesPane_extends({id:shapes_paneId},props,{isOverflowScrollable:!0}),react.createElement(Section,{"data-testid":"shapes-library-pane",title:(0,i18n.__)("Shapes","web-stories")},react.createElement(SectionContent,{ref},masks_src.MU.filter((mask=>mask.showInLibrary)).map(((mask,i)=>react.createElement(shapePreview,{mask,key:mask.type,index:i,isPreview:!0}))))),react.createElement(Section,{"data-testid":"stickers-library-pane",title:(0,i18n.__)("Stickers","web-stories")},react.createElement(SectionContent,{ref:stickersRef},STICKER_TYPES.map(((stickerType,i)=>react.createElement(stickerPreview,{key:stickerType,index:i,stickerType}))))))};var shapes=__webpack_require__("./packages/design-system/src/icons/shapes.svg");const shapesIcon=function ShapesIcon(){return react.createElement(shapes.A,{title:(0,i18n.__)("Shapes library","web-stories")})};var toggle=__webpack_require__("./packages/design-system/src/components/toggle/toggle.tsx"),objectWithout=__webpack_require__("./packages/story-editor/src/utils/objectWithout.ts");function fontPreview_extends(){return fontPreview_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},fontPreview_extends.apply(null,arguments)}const Preview=styled_components_browser_esm.Ay.button.withConfig({displayName:"fontPreview__Preview",componentId:"sc-kfwh27-0"})(["position:relative;display:flex;align-items:center;background-color:",";padding:8px 0px;border-radius:",";width:100%;border:none;cursor:pointer;text-align:left;"," &:focus-visible [role='presentation']{",";}"],(({theme})=>theme.colors.interactiveBg.secondaryNormal),(({theme})=>theme.borders.radius.small),(({isTextSelected})=>isTextSelected?shared_styles.Y:"outline: none;"),(({theme})=>outline.g(theme.colors.border.focus,theme.colors.bg.secondary))),PreviewText=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).withConfig({displayName:"fontPreview__PreviewText",componentId:"sc-kfwh27-1"})(["color:",";font-size:","px;font-weight:",";font-family:",";line-height:normal;margin:",";"],(({theme,isClone})=>isClone?theme.colors.standard.black:theme.colors.fg.primary),(({fontSize})=>fontSize),(({fontWeight})=>fontWeight),(({fontFamily})=>fontFamily),(({isClone})=>isClone?0:"0px 16px")),DragContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"fontPreview__DragContainer",componentId:"sc-kfwh27-2"})(["position:absolute;opacity:0;background-color:",";width:","px;line-height:","px;"],(({theme})=>theme.colors.opacity.white24),(({width})=>width),(({lineHeight})=>lineHeight));const fontPreview=function FontPreview({title,element,insertPreset,getPosition,index}){const htmlFormatters=(0,rich_text_src.$d)(),{font,fontSize,content}=element,{fontWeight}=(0,presetUtils.bo)(content),{actions:{maybeEnqueueFontStyle}}=(0,app.Ln)(),{dataToEditorX,dataToEditorY}=(0,useUnits.A)((state=>({dataToEditorX:state.actions.dataToEditorX,dataToEditorY:state.actions.dataToEditorY}))),{shouldUseSmartColor}=library_useLibrary((state=>({shouldUseSmartColor:state.state.shouldUseSmartColor}))),calculateAccessibleTextColors=(0,pageCanvas.zN)(),{isTextSelected,updateSelectedElements}=(0,app.P3)((({state,actions})=>({isTextSelected:(0,presetUtils.ac)("text",state.selectedElements),updateSelectedElements:actions.updateSelectedElements}))),buttonRef=(0,react_src.li)(null);(0,react_src.vJ)((()=>{maybeEnqueueFontStyle([{font,fontWeight,content:(0,dom_src._e)(content)}])}),[font,fontWeight,content,maybeEnqueueFontStyle]);const applyStyleOnContent=(0,react_src.hb)((({fontWeight:newFontWeight,isItalic,isUnderline,letterSpacing},elContent)=>(elContent=htmlFormatters.setFontWeight(elContent,newFontWeight),elContent=htmlFormatters.toggleItalic(elContent,isItalic),elContent=htmlFormatters.toggleUnderline(elContent,isUnderline),elContent=htmlFormatters.setLetterSpacing(elContent,letterSpacing))),[htmlFormatters]),onClick=(0,react_src.hb)((async()=>{if(isTextSelected)return void updateSelectedElements({properties:oldElement=>{const newContent=applyStyleOnContent((0,presetUtils.bo)(element.content),oldElement.content),presetAtts=(0,objectWithout.A)(element,["x","y","content","width"]),sizeUpdates=(0,getUpdatedSizeAndPosition.A)({...oldElement,...presetAtts});return{...oldElement,...presetAtts,...sizeUpdates,content:newContent}}});let newElement=element;const insertOpts={isPositioned:!1};if(shouldUseSmartColor){const position=getPosition(element);insertOpts.isPositioned=!0,newElement={...element,...position},insertOpts.accessibleColors=await calculateAccessibleTextColors(newElement)}insertPreset(newElement,insertOpts),(0,tracking_src.sx)("insert_text_preset",{name:title})}),[isTextSelected,getPosition,element,shouldUseSmartColor,insertPreset,title,updateSelectedElements,applyStyleOnContent,calculateAccessibleTextColors]),getTextDisplay=(textProps={})=>{const{isClone}=textProps;return react.createElement(PreviewText,fontPreview_extends({font,fontSize,fontWeight},textProps),isClone?(0,dom_src._e)(content):title)};(0,keyboard._h)(buttonRef,{key:["enter","space"]},onClick,[onClick]),(0,useRovingTabIndex.A)({ref:buttonRef});const[active,setActive]=(0,react_src.J0)(!1),makeActive=()=>setActive(!0),makeInactive=()=>setActive(!1);return react.createElement(Preview,{ref:buttonRef,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,tabIndex:0===index?0:-1,isTextSelected,"aria-label":isTextSelected?(0,sprintf.A)((0,i18n.__)("Apply preset: %s","web-stories"),title):null},getTextDisplay(),active&&!isTextSelected&&react.createElement(insertionOverlay.A,null),react.createElement(libraryMoveable.A,{cloneElement:DragContainer,cloneProps:{children:getTextDisplay({fontSize:dataToEditorY(fontSize),isClone:!0}),width:dataToEditorX(element.width),lineHeight:Math.ceil(dataToEditorY(fontSize))},elementProps:element,type:"text",onClick}))},text_paneId=(0,panes_shared.kN)("text");var textPresets=__webpack_require__("./packages/story-editor/src/components/library/panes/text/textPresets.ts"),dimensions=__webpack_require__("./packages/units/src/dimensions.ts"),element_library_src=__webpack_require__("./packages/element-library/src/index.ts"),getInsertedElementSize=__webpack_require__("./packages/story-editor/src/utils/getInsertedElementSize.ts"),textStyle_utils=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/utils.js");const POSITION_MARGIN=(0,dimensions.Yy)(1);const text_useInsertPreset=function useInsertPreset({shouldUseSmartColor}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{state:{versionNumber}}=(0,app.W6)(),htmlFormatters=(0,rich_text_src.$d)(),{setColor}=htmlFormatters,[autoColor,setAutoColor]=(0,react_src.J0)(null),[presetAtts,setPresetAtts]=(0,react_src.J0)(null),lastPreset=(0,react_src.li)(null),calculateAccessibleTextColors=(0,pageCanvas.zN)();(0,react_src.vJ)((()=>{lastPreset.current?.element&&!lastPreset.current.versionNumber?lastPreset.current.versionNumber=versionNumber:lastPreset.current?.versionNumber&&(lastPreset.current=null)}),[versionNumber]);const getPosition=(0,react_src.hb)((element=>{const{y}=element;if(!lastPreset.current)return y;const{element:{height:lastHeight,y:lastY}}=lastPreset.current;let positionedY=lastY+lastHeight+POSITION_MARGIN;const{width,height}=(0,getInsertedElementSize.A)("text",element.width,element.height,{...element,y:positionedY});return positionedY+height>=src_constants.WY&&(positionedY=y),{width,height,y:positionedY}}),[]);(0,react_src.vJ)((()=>{if(autoColor&&presetAtts){const{content}=presetAtts,{color,backgroundColor}=autoColor,highlightProps=backgroundColor?{backgroundColor:{color:backgroundColor},backgroundTextMode:elements_src.xu.HIGHLIGHT,padding:(0,textStyle_utils.oB)(presetAtts)}:null,elementProps={...presetAtts,content:color?setColor(content,{color}):content,...highlightProps},addedElement=insertElement("text",{...elementProps,height:(0,element_library_src.ru)(elementProps,elementProps.width)});lastPreset.current={versionNumber:null,element:addedElement},setAutoColor(null),setPresetAtts(null)}}),[autoColor,presetAtts,insertElement,setColor]);const insertPreset=(0,react_src.hb)((async(element,presetProps={})=>{const{isPositioned,accessibleColors}=presetProps,atts=isPositioned?{}:getPosition(element);if(shouldUseSmartColor){if(setPresetAtts({...element,...atts}),accessibleColors)return void setAutoColor(accessibleColors);setAutoColor(await calculateAccessibleTextColors({...element,...atts}))}else{const addedElement=insertElement("text",{...element,...atts});lastPreset.current={versionNumber:null,element:addedElement}}}),[getPosition,calculateAccessibleTextColors,shouldUseSmartColor,insertElement]);return{getPosition,insertPreset}};const src_translateToInclusiveList=function translateToInclusiveList(options){switch(options.length){case 0:return"";case 1:return options[0];case 2:return(0,sprintf.A)((0,i18n.__)("%1$s and %2$s","web-stories"),options[0],options[1]);default:return(0,sprintf.A)((0,i18n.__)("%1$s, and %2$s","web-stories"),options.slice(0,options.length-1).join((0,i18n.__)(", ","web-stories")),options[options.length-1])}};var useLiveRegion=__webpack_require__("./packages/design-system/src/utils/useLiveRegion.ts");const FullWidthWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"common__FullWidthWrapper",componentId:"sc-10l2iqe-0"})(["margin-left:-",";margin-right:-",";"],panes_shared.z7,panes_shared.z7);const virtualPaneContainer=(0,styled_components_browser_esm.AH)(["margin-top:38px;padding-top:2px;width:100%;height:100%;"]),VirtualizedWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"virtualizedPanelGrid__VirtualizedWrapper",componentId:"sc-qhv222-0"})(["height:",";width:100%;position:relative;"],(({height})=>`${height}px`));VirtualizedWrapper.propTypes={height:prop_types_default().number.isRequired};const VirtualizedContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"virtualizedPanelGrid__VirtualizedContainer",componentId:"sc-qhv222-1"})(["position:absolute;top:0;left:",";display:grid;grid-template-columns:1fr 1fr;grid-template-columns:",";grid-template-rows:",";gap:","px;width:calc(100% - ",");height:100%;margin-top:4px;"],(({paneLeft=0})=>paneLeft),(({columnWidth})=>`\n    repeat(auto-fill, ${columnWidth}px)`),(({rowHeight})=>`minmax(${rowHeight}px, auto)`),(({rowGap=12})=>rowGap),(({paneLeft=0})=>paneLeft));VirtualizedContainer.propTypes={columnWidth:prop_types_default().number.isRequired,rowHeight:prop_types_default().number.isRequired,rowGap:prop_types_default().number,paneLeft:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().number])};var useFocusCanvas=__webpack_require__("./packages/story-editor/src/components/canvas/useFocusCanvas.ts");var desert_bw=__webpack_require__("./packages/design-system/src/images/desert_bw.svg");const emptyContentMessage_Message=styled_components_browser_esm.Ay.div.withConfig({displayName:"emptyContentMessage__Message",componentId:"sc-vwmhk4-0"})(["display:flex;flex-direction:column;align-items:center;max-width:400px;margin:8vh auto;text-align:center;*{text-align:center;margin:0 auto;}"]),EmptyImage=(0,styled_components_browser_esm.Ay)(desert_bw.A).withConfig({displayName:"emptyContentMessage__EmptyImage",componentId:"sc-vwmhk4-1"})(["margin-bottom:48px;"]);const components_emptyContentMessage=function EmptyContentMessage({children,...props}){return react.createElement(emptyContentMessage_Message,props,react.createElement(EmptyImage,{"aria-hidden":!0,width:274,height:118}),children)};var react_virtual=__webpack_require__("./node_modules/react-virtual/dist/react-virtual.mjs"),unitsProvider=__webpack_require__("./packages/units/src/unitsProvider.tsx"),layout=__webpack_require__("./packages/story-editor/src/app/layout/index.ts");function getElementContent(content,isForDisplay){return content?{content:isForDisplay?`<span style="color: #fff">${content}<span>`:content}:{}}function TextSetContainer({pageSize,children}){return pageSize?react.createElement(unitsProvider.A,{pageSize},children):children}const textSetElements=function TextSetElements({elements,isForDisplay,pageSize}){const{textSetHeight,textSetWidth}=elements[0],xOffset=isForDisplay?(src_constants.bj-textSetWidth)/2:0,yOffset=isForDisplay?(src_constants.bj-textSetHeight)/2:0;return react.createElement(TextSetContainer,{pageSize},elements.map((({id,content,normalizedOffsetX,normalizedOffsetY,...rest})=>react.createElement(displayElement.A,{previewMode:!0,key:id,element:{id,...getElementContent(content,isForDisplay),...rest,x:normalizedOffsetX+xOffset,y:normalizedOffsetY+yOffset}}))))};function textSet_extends(){return textSet_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},textSet_extends.apply(null,arguments)}const TextSetItem=styled_components_browser_esm.Ay.button.withConfig({displayName:"textSet__TextSetItem",componentId:"sc-1hor9ow-0"})(["border:0;background:none;position:absolute;top:0;height:","px;width:","px;display:flex;align-items:center;justify-content:center;flex-direction:column;transform:",";background-color:",";border-radius:",";cursor:pointer;transition:background-color ",";outline:none;&:focus-visible [role='presentation']{",";}"],story_editor_src_constants.jy,story_editor_src_constants.jy,(({translateX,translateY})=>`translateX(${translateX}px) translateY(${translateY}px)`),(({theme})=>theme.colors.interactiveBg.secondaryNormal),(({theme})=>theme.borders.radius.small),constants.QB,(({theme})=>outline.g(theme.colors.border.focus,theme.colors.bg.secondary))),TextSetImg=styled_components_browser_esm.Ay.img.withConfig({displayName:"textSet__TextSetImg",componentId:"sc-1hor9ow-1"})(["width:","px;height:","px;"],story_editor_src_constants.jy,story_editor_src_constants.jy),textSet_DragContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"textSet__DragContainer",componentId:"sc-1hor9ow-2"})(["position:absolute;opacity:0;width:","px;height:","px;background-color:",";"],(({width})=>width),(({height})=>height),(({theme})=>theme.colors.opacity.white24));function TextSet({id,elements,translateY,translateX,isActive,index,...rest},ref){const{insertTextSet}=library_useLibrary((state=>({insertTextSet:state.actions.insertTextSet}))),{cdnURL}=(0,app.UK)(),{pageWidth,pageHeight}=(0,layout.g)((({state:{pageWidth,pageHeight}})=>({pageWidth,pageHeight}))),onClick=(0,react_src.hb)((()=>{insertTextSet(elements),(0,tracking_src.sx)("insert_textset")}),[elements,insertTextSet]),handleKeyboardPageClick=(0,react_src.hb)((({code})=>{"Enter"!==code&&"Space"!==code||onClick()}),[onClick]);(0,useRovingTabIndex.A)({ref:ref.current});const[isHovering,setIsHovering]=(0,react_src.J0)(!1),{textSetHeight,textSetWidth}=elements[0],dragWidth=(0,dimensions.rs)(textSetWidth,pageWidth),dragHeight=(0,dimensions.y6)(textSetHeight,pageHeight);return react.createElement(TextSetItem,textSet_extends({translateX,translateY,ref,onKeyUp:handleKeyboardPageClick,onPointerEnter:()=>setIsHovering(!0),onPointerLeave:()=>setIsHovering(!1),tabIndex:0===index?0:-1},rest),react.createElement(TextSetImg,{src:`${cdnURL}images/text-sets/${id}.png`,alt:"",crossOrigin:"anonymous",decoding:"async"}),(isActive||isHovering)&&react.createElement(insertionOverlay.A,null),react.createElement(libraryMoveable.A,{type:"textSet",elements,elementProps:{},onClick,cloneElement:textSet_DragContainer,cloneProps:{width:dragWidth,height:dragHeight,children:react.createElement(textSetElements,{elements,pageSize:{width:pageWidth,height:pageHeight}})}}))}const TextSetWithRef=(0,react_src.Rf)(TextSet);TextSet.displayName="TextSet";const textSets_textSet=TextSetWithRef,CATEGORIES={contact:(0,i18n._x)("Contact","text set category","web-stories"),editorial:(0,i18n._x)("Editorial","text set category","web-stories"),list:(0,i18n._x)("List","text set category","web-stories"),cover:(0,i18n._x)("Cover","text set category","web-stories"),section_header:(0,i18n._x)("Header","text set category","web-stories"),step:(0,i18n._x)("Steps","text set category","web-stories"),table:(0,i18n._x)("Table","text set category","web-stories"),quote:(0,i18n._x)("Quote","text set category","web-stories")},PANE_TEXT={TITLE:(0,i18n.__)("Text Sets","web-stories"),SWITCH_LABEL:(0,i18n.__)("Match fonts from story","web-stories")},TEXT_SET_PAGE_SIZE={width:story_editor_src_constants.jy,height:story_editor_src_constants.jy/src_constants.iZ};const textSets_textSets=function TextSets({paneRef,filteredTextSets}){const containerRef=(0,react_src.li)(),textSetRefs=(0,react_src.li)({}),textSetIds=(0,react_src.Kr)((()=>filteredTextSets.map((textSet=>textSet.id))),[filteredTextSets]),rowVirtualizer=(0,react_virtual.z)({size:Math.ceil((filteredTextSets||[]).length/2),parentRef:paneRef,estimateSize:(0,react_src.hb)((()=>story_editor_src_constants.jy+12),[]),overscan:4}),columnVirtualizer=(0,react_virtual.z)({horizontal:!0,size:2,parentRef:paneRef,estimateSize:(0,react_src.hb)((()=>story_editor_src_constants.jy+12),[]),overscan:0}),{activeGridItemId,handleGridFocus,handleGridItemFocus,isGridFocused}=function useVirtualizedGridNavigation({containerRef,gridItemRefs,gridItemIds,rowVirtualizer}){const[activeGridItemId,setActiveGridItemId]=(0,react_src.J0)(),[isGridFocused,setIsGridFocused]=(0,react_src.J0)(!1),currentAvailableRows=(0,react_src.Kr)((()=>rowVirtualizer.virtualItems),[rowVirtualizer]),currentAvailableRowsRef=(0,react_src.li)();(0,react_src.vJ)((()=>{currentAvailableRows!==currentAvailableRowsRef?.current&&(currentAvailableRowsRef.current=currentAvailableRows),activeGridItemId&&isGridFocused&&gridItemRefs.current?.[activeGridItemId]?.focus()}),[activeGridItemId,currentAvailableRows,isGridFocused,gridItemRefs]),(0,useRovingTabIndex.A)({ref:containerRef});const handleGridFocus=(0,react_src.hb)((()=>{if(!isGridFocused){const newGridItemId=gridItemRefs.current?.[activeGridItemId]?activeGridItemId:gridItemIds?.[0];setActiveGridItemId(newGridItemId),setIsGridFocused(!0),gridItemRefs.current?.[newGridItemId]?.focus()}}),[activeGridItemId,isGridFocused,gridItemIds,gridItemRefs]),handleGridItemFocus=(0,react_src.hb)((itemId=>{activeGridItemId!==itemId&&setActiveGridItemId(itemId)}),[activeGridItemId]),focusCanvas=(0,useFocusCanvas.A)(),onTabKeyDown=(0,react_src.hb)((()=>{focusCanvas(),setIsGridFocused(!1)}),[focusCanvas]);return(0,keyboard._h)(containerRef,"tab",onTabKeyDown,[onTabKeyDown]),(0,react_src.g$)(containerRef,(()=>{setIsGridFocused(!1)}),[]),(0,react_src.Kr)((()=>({handleGridFocus,handleGridItemFocus,activeGridItemId,isGridFocused})),[activeGridItemId,isGridFocused,handleGridFocus,handleGridItemFocus])}({rowVirtualizer,containerRef,gridItemRefs:textSetRefs,gridItemIds:textSetIds});return react.createElement(unitsProvider.A,{pageSize:TEXT_SET_PAGE_SIZE},react.createElement(VirtualizedWrapper,{height:rowVirtualizer.totalSize},react.createElement(VirtualizedContainer,{height:rowVirtualizer.totalSize,ref:containerRef,columnWidth:story_editor_src_constants.jy,rowHeight:story_editor_src_constants.jy,onFocus:handleGridFocus,role:"group","aria-label":(0,i18n.__)("Text Set Options","web-stories")},rowVirtualizer.virtualItems.map((virtualRow=>columnVirtualizer.virtualItems.map((virtualColumn=>{const gridIndex=(({columnIndex,rowIndex})=>0===columnIndex?2*rowIndex:2*rowIndex+1)({columnIndex:virtualColumn.index,rowIndex:virtualRow.index}),textSet=filteredTextSets[gridIndex];if(!textSet?.elements)return null;const isActive=activeGridItemId===textSet.id&&isGridFocused;return react.createElement(textSets_textSet,{key:gridIndex,id:textSet.id,"data-testid":`text_set_${textSet.id}`,ref:el=>textSetRefs.current[textSet.id]=el,translateY:virtualRow.start,translateX:virtualColumn.start,"aria-label":textSet.title,isActive,onFocus:()=>handleGridItemFocus(textSet.id),elements:textSet.elements,index:gridIndex})})))))))},TitleBar=styled_components_browser_esm.Ay.div.withConfig({displayName:"textSetsPane__TitleBar",componentId:"sc-vycaev-0"})(["display:flex;justify-content:space-between;padding:20px 0;"]),TextSetsToggle=styled_components_browser_esm.Ay.div.withConfig({displayName:"textSetsPane__TextSetsToggle",componentId:"sc-vycaev-1"})(["display:flex;label{cursor:pointer;margin:auto 12px;color:",";}"],(({theme})=>theme.colors.fg.secondary)),TextSetsWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"textSetsPane__TextSetsWrapper",componentId:"sc-vycaev-2"})(["",";"],virtualPaneContainer);const textSetsPane=function TextSetsPane({paneRef}){const{areTextSetsLoading,textSets}=library_useLibrary((({state:{areTextSetsLoading,textSets}})=>({areTextSetsLoading,textSets}))),[showInUse,setShowInUse]=(0,react_src.J0)(!1),trackChange=(0,react_src.li)(!1),allTextSets=(0,react_src.Kr)((()=>Object.values(textSets).flat()),[textSets]),storyPages=(0,story_useStory.A)((({state:{pages}})=>pages)),[selectedCat,setSelectedCat]=(0,react_src.J0)(localStore.x.getItemByKey(localStore.$.TEXT_SET_SETTINGS)?.selectedCategory),getTextSetsForInUseFonts=(0,react_src.hb)((()=>{return function getTextSetsForFonts({fonts,textSets}){return textSets.map((currentTextSet=>currentTextSet.elements.reduce(((elementMemo,currentElement)=>elements_src.V7.text(currentElement)?elementMemo||-1!==fonts.indexOf(currentElement.font.family):elementMemo),!1)&&currentTextSet)).filter(Boolean)}({fonts:(pages=storyPages,Array.from(new Set(pages.flatMap((({elements=[]})=>elements.map((element=>elements_src.V7.text(element)?element.font.family:null)))).filter(Boolean)))||[]),textSets:selectedCat?textSets[selectedCat]:allTextSets});var pages}),[allTextSets,storyPages,selectedCat,textSets]),addIdToTextSets=(0,react_src.hb)(((textSetsArray=[])=>textSetsArray.map((({textSetFonts=[],textSetCategory,elements,id})=>({id,title:(0,sprintf.A)((0,i18n._n)("Text set %1$s with %2$s font","Text set %1$s with %2$s fonts",textSetFonts.length,"web-stories"),CATEGORIES[textSetCategory],src_translateToInclusiveList(textSetFonts)),elements})))),[]),filteredTextSets=(0,react_src.Kr)((()=>addIdToTextSets(showInUse?getTextSetsForInUseFonts():selectedCat?textSets?.[selectedCat]:allTextSets)),[selectedCat,textSets,allTextSets,addIdToTextSets,getTextSetsForInUseFonts,showInUse]),categories=(0,react_src.Kr)((()=>[{id:null,label:(0,i18n._x)("All","text sets","web-stories")},...Object.keys(textSets).map((category=>({id:category,label:CATEGORIES[category]??category})))]),[textSets]),speak=(0,useLiveRegion.A)(),handleSelectedCategory=(0,react_src.hb)((selectedCategory=>{setSelectedCat(selectedCategory),speak(null===selectedCategory?(0,i18n.__)("Show all text sets","web-stories"):(0,sprintf.A)((0,i18n.__)("Selected text set filter %s","web-stories"),CATEGORIES[selectedCategory])),localStore.x.setItemByKey(localStore.$.TEXT_SET_SETTINGS,{selectedCategory}),trackChange.current=!0}),[speak]),onChangeShowInUse=(0,react_src.hb)((()=>{requestAnimationFrame((()=>setShowInUse((prevVal=>!prevVal)))),trackChange.current=!0}),[setShowInUse]);(0,react_src.vJ)((()=>{trackChange.current&&(0,tracking_src.sx)("search",{search_type:"textsets",search_term:"",search_category:selectedCat,search_filter:showInUse?"show_in_use":void 0})}),[selectedCat,showInUse]);const sectionId=(0,react_src.Kr)((()=>`section-${(0,v4.A)()}`),[]),toggleId=(0,react_src.Kr)((()=>`toggle_text_sets_${(0,v4.A)()}`),[]),emptyContentMessage=(0,react_src.Kr)((()=>showInUse?(0,i18n.__)("No matching Text Sets available. Try adding text to your story.","web-stories"):(0,i18n.__)("No Text Sets available.","web-stories")),[showInUse]);return react.createElement(section_Container,{id:sectionId},react.createElement(TitleBar,null,react.createElement(headline.$,{as:"h2",size:types.$.XXXSmall},PANE_TEXT.TITLE),react.createElement(TextSetsToggle,null,react.createElement(typography_text.E.Label,{htmlFor:toggleId,size:types.$.Small},PANE_TEXT.SWITCH_LABEL),react.createElement(toggle.A,{id:toggleId,"aria-label":PANE_TEXT.SWITCH_LABEL,name:toggleId,checked:showInUse,onChange:onChangeShowInUse}))),react.createElement(FullWidthWrapper,null,react.createElement(panes_shared.Iy,{items:categories,selectedItemId:selectedCat,selectItem:handleSelectedCategory,deselectItem:()=>handleSelectedCategory(null),ariaLabel:(0,i18n.__)("Select filter for text sets list","web-stories")})),react.createElement(TextSetsWrapper,null,filteredTextSets?.length||areTextSetsLoading?react.createElement(textSets_textSets,{paneRef,filteredTextSets}):react.createElement(components_emptyContentMessage,null,emptyContentMessage)))};var plus=__webpack_require__("./packages/design-system/src/icons/plus.svg"),disclosure=__webpack_require__("./packages/design-system/src/components/disclosure/disclosure.tsx"),popup=__webpack_require__("./packages/design-system/src/components/popup/popup.tsx");const styleManager_useKeyboardNavigation=function useKeyboardNavigation({activeIndex,setActiveIndex,groupRef}){(0,keyboard._h)(groupRef,{key:["up","down","left","right"]},(({key})=>{if(groupRef.current){const diff=((key,rowLength)=>{switch(key){case"ArrowUp":return-rowLength;case"ArrowDown":return rowLength;case"ArrowLeft":return-1;case"ArrowRight":return 1;default:return 0}})(key,2),buttons=groupRef.current.querySelectorAll("button:not([disabled])"),maxIndex=buttons.length-1,val=(activeIndex??0)+diff,newIndex=Math.max(0,Math.min(maxIndex,val));setActiveIndex(newIndex),buttons[newIndex]&&buttons[newIndex].focus()}}),[activeIndex,setActiveIndex,groupRef])};var cross=__webpack_require__("./packages/design-system/src/icons/cross.svg");const PresetButton=styled_components_browser_esm.Ay.button.withConfig({displayName:"styleItem__PresetButton",componentId:"sc-157dmik-0"})(["background-color:",";border-color:transparent;position:relative;cursor:pointer;border-width:0;border-radius:4px;padding:3px;height:100%;width:100%;display:flex;justify-content:center;align-items:center;> svg{width:","px;height:","px;position:absolute;top:calc(50% - ","px);left:calc(50% - ","px);color:",";filter:drop-shadow(0px 0px 4px rgba(0,0,0,0.4));}",""],(({theme})=>theme.colors.interactiveBg.secondaryNormal),32,32,16,16,(({theme})=>theme.colors.fg.primary),shared_styles.Y),HighLight=styled_components_browser_esm.Ay.span.withConfig({displayName:"styleItem__HighLight",componentId:"sc-157dmik-1"})(["padding:0 2px;"," box-decoration-break:clone;"],(({background})=>(0,generatePatternStyles.A)(background))),TextWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleItem__TextWrapper",componentId:"sc-157dmik-2"})(["position:relative;display:inline-block;line-height:","px;max-height:","px;overflow:hidden;border-radius:4px;padding:3px;max-width:100%;"," font-size:12px;",""],20,43,(({styles})=>styles),(({background})=>background?(0,generatePatternStyles.A)(background):null));const styleItem=function StyleItem({style,i,activeIndex,handleOnClick,isEditMode,activeItemOverlay,applyLabel=(0,i18n.__)("Apply style","web-stories")}){const selectedElements=(0,app_story.P3)((({state})=>state.selectedElements)),[isActive,setIsActive]=(0,react_src.J0)(!1),makeActive=()=>{activeItemOverlay&&setIsActive(!0)},makeInactive=()=>{activeItemOverlay&&setIsActive(!1)};if(!style)return null;const textContent=selectedElements[0]?.content?(0,dom_src._e)(selectedElements[0].content):(0,i18n.__)("Lorem ipsum dolor sit amet","web-stories");return react.createElement(PresetButton,{tabIndex:activeIndex===i?0:-1,style,onClick:()=>handleOnClick(style),onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,"aria-label":isEditMode?(0,i18n.__)("Delete style","web-stories"):applyLabel},(()=>{const isHighLight=style.backgroundTextMode===elements_src.xu.HIGHLIGHT,isFill=style.backgroundTextMode===elements_src.xu.FILL;return react.createElement(TextWrapper,{styles:(0,presetUtils.uV)(style,!0),background:isFill?style.backgroundColor:null},isHighLight?react.createElement(HighLight,{background:style.backgroundColor},textContent):textContent)})(),isEditMode&&react.createElement(cross.A,null),!isEditMode&&isActive&&activeItemOverlay)};function styleGroup_extends(){return styleGroup_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},styleGroup_extends.apply(null,arguments)}const Group=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleGroup__Group",componentId:"sc-1cojpnq-0"})(["display:grid;grid-template-columns:repeat(2,1fr);grid-column-gap:20px;grid-row-gap:16px;"]),ButtonWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleGroup__ButtonWrapper",componentId:"sc-1cojpnq-1"})(["height:","px;width:","px;"],story_editor_src_constants.IX,(({width})=>width));const styleGroup=function StyleGroup({styles,isEditMode=!1,handleClick,buttonWidth=128,...rest}){const[activeIndex,setActiveIndex]=(0,react_src.J0)(0),groupRef=(0,react_src.li)(null);return styleManager_useKeyboardNavigation({activeIndex,setActiveIndex,groupRef,type:story_editor_src_constants.aS.STYLE}),react.createElement(Group,{ref:groupRef},styles.map(((style,i)=>react.createElement(ButtonWrapper,{key:JSON.stringify(style),width:buttonWidth},react.createElement(styleItem,styleGroup_extends({style,i,activeIndex,handleOnClick:handleClick,isEditMode},rest))))))};var CSSTransition=__webpack_require__("./node_modules/react-transition-group/esm/CSSTransition.js"),useFocusTrapping=__webpack_require__("./packages/story-editor/src/utils/useFocusTrapping.js"),pencil=__webpack_require__("./packages/design-system/src/icons/pencil.svg");function header_extends(){return header_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},header_extends.apply(null,arguments)}const header_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"header__Wrapper",componentId:"sc-10q8amw-0"})(["display:flex;justify-content:space-between;align-items:center;height:","px;padding:4px 8px 4px 8px;position:relative;border-bottom:1px solid ",";"],44,(({theme})=>theme.colors.divider.tertiary)),Actions=styled_components_browser_esm.Ay.div.withConfig({displayName:"header__Actions",componentId:"sc-10q8amw-1"})(["display:flex;margin-left:auto;"]),StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"header__StyledButton",componentId:"sc-10q8amw-2"})(["margin-left:8px;",";"],shared_styles.Y);const header=function header_Header({children,handleClose,isEditMode=!1,setIsEditMode=noop.l}){const ref=(0,react_src.li)();(0,react_src.vJ)((()=>{ref.current?.focus()}),[]);const buttonProps={type:constants.VQ.Tertiary,size:constants.Mp.Small,onClick:evt=>{evt.stopPropagation(),setIsEditMode(!isEditMode)},isEditMode};return react.createElement(header_Wrapper,null,children,react.createElement(Actions,null,isEditMode?react.createElement(StyledButton,header_extends({},buttonProps,{variant:constants.Ak.Rectangle,"aria-label":(0,i18n.__)("Exit edit mode","web-stories")}),(0,i18n.__)("Done","web-stories")):react.createElement(StyledButton,header_extends({},buttonProps,{variant:constants.Ak.Square,"aria-label":(0,i18n.__)("Edit style","web-stories")}),react.createElement(pencil.A,null)),react.createElement(StyledButton,{"aria-label":(0,i18n.__)("Close","web-stories"),onClick:handleClose,type:constants.VQ.Tertiary,size:constants.Mp.Small,variant:constants.Ak.Square,ref},react.createElement(cross.A,null))))};var checkbox_checkbox=__webpack_require__("./packages/design-system/src/components/checkbox/checkbox.tsx");const STORAGE_KEY="DELETE_STYLE_PRESET_DIALOG_DISMISSED",confirmationDialog_Label=styled_components_browser_esm.Ay.label.withConfig({displayName:"confirmationDialog__Label",componentId:"sc-ezab89-0"})(["margin-left:12px;"]),CheckboxWrapper=styled_components_browser_esm.Ay.footer.withConfig({displayName:"confirmationDialog__CheckboxWrapper",componentId:"sc-ezab89-1"})(["display:flex;margin-top:12px;padding:14px 0 0 9px;border-top:1px solid ",";"],(({theme})=>theme.colors.divider.primary));const confirmationDialog=function ConfirmationDialog({onClose,onPrimary}){const[isDialogDismissed,setIsDialogDismissed]=(0,react_src.J0)(localStore.x.getItemByKey(localStore.$[STORAGE_KEY])),dialogText=(0,i18n.__)("This is a global style. Deleting this style will remove it from the Saved Styles across all stories and the style will no longer be available to any other users on the site.","web-stories"),cbId=`cb-${(0,v4.A)()}`;return react.createElement(dialog.A,{isOpen:!0,onClose,secondaryText:(0,i18n.__)("Cancel","web-stories"),onPrimary,primaryText:(0,i18n.__)("Delete","web-stories")},react.createElement(typography_text.E.Paragraph,{size:types.$.Small},dialogText),react.createElement(CheckboxWrapper,null,react.createElement(checkbox_checkbox.A,{id:cbId,checked:isDialogDismissed,onChange:()=>{localStore.x.setItemByKey(localStore.$[STORAGE_KEY],!isDialogDismissed),setIsDialogDismissed(!isDialogDismissed)}}),react.createElement(confirmationDialog_Label,{htmlFor:cbId},react.createElement(typography_text.E.Span,{size:types.$.Small},(0,i18n.__)("Don't ask for confirmation again.","web-stories")))))};function styleManager_extends(){return styleManager_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},styleManager_extends.apply(null,arguments)}const styleManager_Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleManager__Container",componentId:"sc-4hlmhs-0"})(["border-radius:8px;background:",";width:256px;user-select:none;display:flex;flex-direction:column;align-items:stretch;overflow:hidden;&.style-manager-appear{opacity:0.01;margin-top:-10px;&.style-manager-appear-active{opacity:1;margin-top:0;transition:300ms ease-out;transition-property:opacity,margin-top;}}"],(({theme})=>theme.colors.bg.secondary)),Body=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleManager__Body",componentId:"sc-4hlmhs-1"})(["display:flex;margin:8px 12px 16px;"]),styleManager_StyledText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"styleManager__StyledText",componentId:"sc-4hlmhs-2"})(["margin:0 0 0 8px;color:",";"],(({theme})=>theme.colors.fg.primary));const styleManager=function StyleManager({styles,onClose,applyStyle,...rest}){const[isEditMode,setIsEditMode]=(0,react_src.J0)(!1),[showDialog,setShowDialog]=(0,react_src.J0)(!1),[toDelete,setToDelete]=(0,react_src.J0)(null),containerRef=(0,react_src.li)(null),previousFocus=(0,react_src.li)(document.activeElement),handleCloseAndRefocus=(0,react_src.hb)((evt=>{previousFocus.current&&previousFocus.current.focus(),onClose(evt)}),[onClose]);(0,keyboard._h)(containerRef,"esc",handleCloseAndRefocus);const deleteStyle=useDeleteStyle({onEmpty:handleCloseAndRefocus});return(0,react_src.g$)(containerRef,(()=>{showDialog||onClose()}),[showDialog]),(0,useFocusTrapping.A)({ref:containerRef}),react.createElement(CSSTransition.A,{nodeRef:containerRef,in:!0,appear:!0,classNames:"style-manager",timeout:300},react.createElement(styleManager_Container,{role:"dialog","aria-label":(0,i18n.__)("Style presets manager","web-stories"),ref:containerRef},react.createElement(header,{handleClose:handleCloseAndRefocus,isEditMode,setIsEditMode},react.createElement(styleManager_StyledText,null,(0,i18n.__)("Saved Styles","web-stories"))),react.createElement(Body,null,react.createElement(styleGroup,styleManager_extends({styles:[...styles].reverse(),handleClick:style=>{if(!isEditMode)return void applyStyle(style);localStore.x.getItemByKey(localStore.$[STORAGE_KEY])?deleteStyle(style):(setShowDialog(!0),setToDelete(style))},isEditMode,buttonWidth:106},rest))),showDialog&&react.createElement(confirmationDialog,{onClose:()=>setShowDialog(!1),onPrimary:()=>{deleteStyle(toDelete),setToDelete(null),setShowDialog(!1)}})))},NoStylesWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleManager__NoStylesWrapper",componentId:"sc-1u9p583-0"})(["display:flex;justify-content:center;align-items:center;width:calc(100% + 32px);margin:0 0 -8px -16px;background-color:",";height:64px;"],(({theme})=>theme.colors.opacity.black24)),MoreButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:constants.VQ.Plain,size:constants.Mp.Small,variant:constants.Ak.Rectangle}).withConfig({displayName:"styleManager__MoreButton",componentId:"sc-1u9p583-1"})(["",";margin:12px 0;padding:0 16px;justify-content:center;align-self:center;width:100%;svg{transform:rotate(-90deg);height:32px;width:32px;margin-left:-4px;}"],shared_styles.Y);function stylePresets_extends(){return stylePresets_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},stylePresets_extends.apply(null,arguments)}const SectionContainer=(0,styled_components_browser_esm.Ay)(section_Container).withConfig({displayName:"stylePresets__SectionContainer",componentId:"sc-bczcw0-0"})(["padding:16px 0;margin-bottom:-24px;border-top:1px solid ",";border-bottom:1px solid ",";"],(({theme})=>theme.colors.divider.tertiary),(({theme})=>theme.colors.divider.tertiary)),stylePresets_TitleBar=styled_components_browser_esm.Ay.div.withConfig({displayName:"stylePresets__TitleBar",componentId:"sc-bczcw0-1"})(["display:flex;padding-bottom:16px;justify-content:space-between;align-items:center;"]),StylesWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"stylePresets__StylesWrapper",componentId:"sc-bczcw0-2"})([""]),stylePresets_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"stylePresets__StyledButton",componentId:"sc-bczcw0-3"})(["margin-left:auto;"]),NoStylesText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"stylePresets__NoStylesText",componentId:"sc-bczcw0-4"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary)),SPACING={x:40};const stylePresets=(0,react_src.ph)((function PresetPanel(){const{textStyles,isText,updateSelectedElements}=(0,app.P3)((({state,actions})=>({isText:Boolean(state.selectedElements&&(0,presetUtils.ac)("text",state.selectedElements)),textStyles:state.story?.globalStoryStyles?.textStyles||[],updateSelectedElements:actions.updateSelectedElements}))),{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{setColor,setFontWeight,setLetterSpacing,toggleItalic,toggleUnderline}=(0,rich_text_src.$d)(),buttonRef=(0,react_src.li)(null),stylesRef=(0,react_src.li)(null),[isPopupOpen,setIsPopupOpen]=(0,react_src.J0)(!1),hasPresets=textStyles.length>0,pushUpdate=(0,react_src.hb)((update=>{updateSelectedElements({properties:element=>{const updates=(0,updateProperties.A)(element,update,!0),sizeUpdates=(0,getUpdatedSizeAndPosition.A)({...element,...updates});return{...updates,...sizeUpdates}}})}),[updateSelectedElements]),handleApplyStyle=styleManager_useApplyStyle({pushUpdate}),{addGlobalPreset}=(0,useAddPreset.A)({presetType:story_editor_src_constants.aS.STYLE}),handlePresetClick=preset=>{isText?handleApplyStyle(preset):((preset=>{const{color,fontWeight,isItalic,isUnderline,letterSpacing}=preset;let content=textPresets.C.content;content=setColor(content,color),content=setFontWeight(content,fontWeight),content=toggleItalic(content,isItalic),content=toggleUnderline(content,isUnderline),content=setLetterSpacing(content,letterSpacing),insertElement("text",{...textPresets.C,...preset,content})})(preset),setIsPopupOpen(!1))},styleItemProps=isText?{}:{activeItemOverlay:react.createElement(insertionOverlay.A,null),applyLabel:(0,i18n.__)("Add new text","web-stories")};return react.createElement(SectionContainer,null,react.createElement(stylePresets_TitleBar,null,react.createElement(headline.$,{as:"h2",size:types.$.XXXSmall},(0,i18n.__)("Saved Styles","web-stories")),react.createElement(stylePresets_StyledButton,{type:constants.VQ.Tertiary,size:constants.Mp.Small,variant:constants.Ak.Square,onClick:addGlobalPreset,"aria-label":(0,i18n.__)("Add style","web-stories"),disabled:!isText},react.createElement(plus.A,null))),hasPresets&&react.createElement(react.Fragment,null,react.createElement(StylesWrapper,{ref:stylesRef},react.createElement(styleGroup,stylePresets_extends({styles:[...textStyles].reverse().slice(0,2),handleClick:handlePresetClick,buttonWidth:150},styleItemProps))),react.createElement(MoreButton,{ref:buttonRef,onClick:()=>setIsPopupOpen(!0),"aria-haspopup":"dialog","aria-expanded":isPopupOpen},(0,i18n.__)("More styles","web-stories"),react.createElement(disclosure.A,{$isOpen:isPopupOpen})),react.createElement(popup.A,{anchor:buttonRef,isOpen:isPopupOpen,placement:popup_constants.W.RightStart,spacing:SPACING,renderContents:()=>react.createElement(styleManager,stylePresets_extends({styles:textStyles,applyStyle:handlePresetClick,onClose:()=>setIsPopupOpen(!1)},styleItemProps))})),!hasPresets&&react.createElement(NoStylesWrapper,null,react.createElement(NoStylesText,{size:types.$.Small},(0,i18n.__)("No Styles Saved","web-stories"))))}));function textPane_extends(){return textPane_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},textPane_extends.apply(null,arguments)}const Pane=(0,styled_components_browser_esm.Ay)(panes_shared.Zv).withConfig({displayName:"textPane__Pane",componentId:"sc-zvmbdp-0"})(["overflow-y:scroll;max-height:100%;position:relative;"]),GridContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"textPane__GridContainer",componentId:"sc-zvmbdp-1"})(["display:grid;grid-template-columns:1fr 1fr;gap:12px;"]),SmartColorToggle=styled_components_browser_esm.Ay.div.withConfig({displayName:"textPane__SmartColorToggle",componentId:"sc-zvmbdp-2"})(["display:flex;label{cursor:pointer;margin:auto 12px;color:",";}"],(({theme})=>theme.colors.fg.secondary));const textPane=function TextPane(props){const paneRef=(0,react_src.li)(),[,forceUpdate]=(0,react_src.J0)(),{shouldUseSmartColor,setShouldUseSmartColor}=library_useLibrary((state=>({shouldUseSmartColor:state.state.shouldUseSmartColor,setShouldUseSmartColor:state.actions.setShouldUseSmartColor}))),{getPosition,insertPreset}=text_useInsertPreset({shouldUseSmartColor}),generateDeferredCurrentPageCanvas=(0,pageCanvas.R5)((({actions})=>actions.generateDeferredCurrentPageCanvas));(0,react_src.pO)(paneRef,(()=>{forceUpdate(Date.now())}),[]);const handleToggleClick=(0,react_src.hb)((()=>setShouldUseSmartColor((currentValue=>!currentValue))),[setShouldUseSmartColor]),toggleId=(0,react_src.Kr)((()=>`toggle_auto_color_${(0,v4.A)()}`),[]);return react.createElement(Pane,textPane_extends({id:text_paneId},props,{ref:paneRef}),react.createElement(SmartColorToggle,null,react.createElement(typography_text.E.Label,{htmlFor:toggleId,size:types.$.Small},(0,i18n.__)("Adaptive text colors","web-stories")),react.createElement(components_tooltip.A,{title:(0,i18n.__)("May impact performance when inserting text","web-stories")},react.createElement(toggle.A,{id:toggleId,checked:shouldUseSmartColor,onChange:handleToggleClick}))),react.createElement(section_Container,{onPointerOver:()=>shouldUseSmartColor&&generateDeferredCurrentPageCanvas()},react.createElement(GridContainer,null,textPresets.f.map((({title,element},index)=>react.createElement(fontPreview,{key:title,title,element,insertPreset,getPosition,index}))))),react.createElement(stylePresets,null),paneRef.current&&react.createElement(textSetsPane,{paneRef}))};var letter_t=__webpack_require__("./packages/design-system/src/icons/letter_t.svg");const textIcon=function TextIcon(){return react.createElement(letter_t.A,{title:(0,i18n.__)("Text library","web-stories")})},pageTemplates_paneId=(0,panes_shared.kN)("pageTemplates");var loadingSpinner=__webpack_require__("./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx");const PAGE_TEMPLATE_TYPES={cover:{name:(0,i18n.__)("Cover","web-stories")},section:{name:(0,i18n.__)("Section","web-stories")},quote:{name:(0,i18n.__)("Quote","web-stories")},editorial:{name:(0,i18n.__)("Editorial","web-stories")},list:{name:(0,i18n.__)("List","web-stories")},table:{name:(0,i18n.__)("Table","web-stories")},steps:{name:(0,i18n.__)("Steps","web-stories")}};var useGridViewKeys=__webpack_require__("./packages/design-system/src/components/keyboard/gridview/useGridViewKeys.ts");function defaultPageTemplate_extends(){return defaultPageTemplate_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},defaultPageTemplate_extends.apply(null,arguments)}const PageTemplateWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"defaultPageTemplate__PageTemplateWrapper",componentId:"sc-kt5s68-0"})([""]),PageTemplateButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:constants.VQ.Plain}).withConfig({displayName:"defaultPageTemplate__PageTemplateButton",componentId:"sc-kt5s68-1"})(["position:relative;display:block;padding:0;border-radius:",";overflow:hidden;&:focus-visible{box-shadow:none;}&:focus-visible [role='presentation']{",";}"],(({theme})=>theme.borders.radius.small),(({theme})=>outline.g(theme.colors.border.focus,theme.colors.bg.secondary))),TemplateTitleContainer=(0,styled_components_browser_esm.Ay)(panes_shared.VC).withConfig({displayName:"defaultPageTemplate__TemplateTitleContainer",componentId:"sc-kt5s68-2"})(["",":hover &,",":focus &{opacity:1;}"],PageTemplateButton,PageTemplateButton),PosterImg=styled_components_browser_esm.Ay.img.withConfig({displayName:"defaultPageTemplate__PosterImg",componentId:"sc-kt5s68-3"})(["display:block;width:100%;"]),DefaultPageTemplate=(0,react_src.Rf)((({page,columnWidth,isActive,onFocus,...rest},ref)=>{const templateTitle=(0,sprintf.A)((0,i18n._x)("%1$s %2$s","page template title","web-stories"),page.title,PAGE_TEMPLATE_TYPES[page.type].name),[isFocused,setIsFocused]=(0,react_src.J0)(!1);return react.createElement(PageTemplateWrapper,{ref,role:"listitem"},react.createElement(PageTemplateButton,defaultPageTemplate_extends({columnWidth,tabIndex:isActive?0:-1,"aria-label":templateTitle,onPointerEnter:()=>setIsFocused(!0),onPointerLeave:()=>setIsFocused(!1),onFocus:()=>{setIsFocused(!0),onFocus?.()},onBlur:()=>setIsFocused(!1)},rest),page.png&&react.createElement(PosterImg,{src:page.png,alt:(0,sprintf.A)((0,i18n.__)("Snapshot of page template for %1$s","web-stories"),page.title),crossOrigin:"anonymous",decoding:"async",draggable:!1}),isFocused&&react.createElement(insertionOverlay.A,null),page.title&&react.createElement(TemplateTitleContainer,null,react.createElement(typography_text.E.Span,{size:types.$.Small},templateTitle))))}));DefaultPageTemplate.displayName="DefaultPageTemplate";const defaultPageTemplate=DefaultPageTemplate;var plus_filled_small=__webpack_require__("./packages/design-system/src/icons/plus_filled_small.svg"),fetchRemoteBlob=__webpack_require__("./packages/media/src/fetchRemoteBlob.ts"),uploader=__webpack_require__("./packages/story-editor/src/app/uploader/index.ts"),utils_noop=__webpack_require__("./packages/design-system/src/utils/noop.ts"),dots_fill_small=__webpack_require__("./packages/design-system/src/icons/dots_fill_small.svg"),menu=__webpack_require__("./packages/design-system/src/components/menu/menu.tsx"),dropDownKeyEvents=__webpack_require__("./packages/story-editor/src/components/panels/utils/dropDownKeyEvents.js");const deleteDialog=function DeleteDialog({onClose,onDelete}){return react.createElement(dialog.A,{isOpen:!0,onClose,title:(0,i18n.__)("Delete Page Template","web-stories"),secondaryText:(0,i18n.__)("Cancel","web-stories"),onPrimary:onDelete,primaryText:(0,i18n.__)("Delete","web-stories")},react.createElement(typography_text.E.Paragraph,{size:types.$.Small},(0,i18n.__)("Are you sure you want to delete this template? This action cannot be undone.","web-stories")))};var input_input=__webpack_require__("./packages/design-system/src/components/input/input.tsx");const InputWrapper=styled_components_browser_esm.Ay.form.withConfig({displayName:"nameDialog__InputWrapper",componentId:"sc-pqbhqw-0"})(["margin:16px 4px;width:470px;height:100px;"]);const nameDialog=function NameDialog({onClose,onSave,title,placeholder,previousInput}){const[templateName,setTemplateName]=(0,react_src.J0)(previousInput);return react.createElement(dialog.A,{isOpen:!0,title,primaryText:(0,i18n.__)("Save","web-stories"),onPrimary:()=>{onSave(templateName)},secondaryText:(0,i18n.__)("Cancel","web-stories"),onSecondary:onClose,onClose},react.createElement(InputWrapper,{onSubmit:e=>{e.preventDefault(),onSave(templateName)}},react.createElement(input_input.A,{onChange:e=>{setTemplateName(e.target.value)},value:templateName,label:(0,i18n.__)("Template name","web-stories"),placeholder,type:"text"})))},dropDownMenu_MoreButton=(0,styled_components_browser_esm.Ay)(panes_shared.rA).withConfig({displayName:"dropDownMenu__MoreButton",componentId:"sc-xiyx7c-0"})(["top:4px;right:4px;"]),DropDownContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"dropDownMenu__DropDownContainer",componentId:"sc-xiyx7c-1"})(["margin-top:10px;"]),MenuContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"dropDownMenu__MenuContainer",componentId:"sc-xiyx7c-2"})(["z-index:1;"]),menuStylesOverride=(0,styled_components_browser_esm.AH)(["min-width:160px;margin-top:0;li{display:block;}"]),MENU_OPTIONS_RENAME="rename",MENU_OPTIONS_DELETE="delete";const dropDownMenu=function DropDownMenu({display,isMenuOpen,onMenuOpen,onMenuCancelled,onMenuSelected,setParentActive=utils_noop.l,onDelete,onUpdateName,previousName}){const groups=[{options:[{label:(0,i18n.__)("Rename Template","web-stories"),value:MENU_OPTIONS_RENAME},{label:(0,i18n.__)("Delete Template","web-stories"),value:MENU_OPTIONS_DELETE}]}],[showDeleteDialog,setShowDeleteDialog]=(0,react_src.J0)(!1),[showRenameDialog,setShowRenameDialog]=(0,react_src.J0)(!1),moreButtonRef=(0,react_src.li)(),onClose=(0,react_src.hb)((()=>{onMenuCancelled(),moreButtonRef.current?.focus(),setParentActive()}),[onMenuCancelled,setParentActive]),onDeleteDialogClose=(0,react_src.hb)((()=>{setShowDeleteDialog(!1),onClose()}),[setShowDeleteDialog,onClose]),onRenameDialogClose=(0,react_src.hb)((()=>{setShowRenameDialog(!1),onClose()}),[setShowRenameDialog,onClose]),listId=(0,react_src.Kr)((()=>`list-${(0,v4.A)()}`),[]),buttonId=(0,react_src.Kr)((()=>`button-${(0,v4.A)()}`),[]);return react.createElement(MenuContainer,null,moreButtonRef.current&&react.createElement(dropDownKeyEvents.A,{target:moreButtonRef.current}),react.createElement(dropDownMenu_MoreButton,{ref:moreButtonRef,onClick:onMenuOpen,"aria-label":(0,i18n.__)("More","web-stories"),"aria-pressed":isMenuOpen,"aria-haspopup":!0,"aria-expanded":isMenuOpen,"aria-owns":isMenuOpen?listId:null,id:buttonId,$display:display,tabIndex:display||isMenuOpen?0:-1},react.createElement(dots_fill_small.A,null)),(display||isMenuOpen)&&react.createElement(popup.A,{anchor:moreButtonRef,placement:popup_constants.W.BottomStart,isOpen:isMenuOpen},react.createElement(DropDownContainer,null,react.createElement(menu.A,{parentId:buttonId,listId,handleMenuItemSelect:(evt,value)=>{switch(evt.stopPropagation(),onMenuSelected(),value){case MENU_OPTIONS_RENAME:setShowRenameDialog(!0);break;case MENU_OPTIONS_DELETE:setShowDeleteDialog(!0)}},groups,onDismissMenu:onClose,hasMenuRole:!0,menuStylesOverride}))),showDeleteDialog&&react.createElement(deleteDialog,{onClose:onDeleteDialogClose,onDelete}),showRenameDialog&&react.createElement(nameDialog,{onClose:onRenameDialogClose,onSave:name=>{onUpdateName(name),onRenameDialogClose()},title:(0,i18n.__)("Rename Page Template","web-stories"),placeholder:previousName||(0,i18n.__)("Untitled","web-stories"),previousInput:previousName||""}))},TemplateImage=styled_components_browser_esm.Ay.img.withConfig({displayName:"savedPageTemplate__TemplateImage",componentId:"sc-5hfe38-0"})(["width:100%;height:auto;"]),savedPageTemplate_PageTemplateWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"savedPageTemplate__PageTemplateWrapper",componentId:"sc-5hfe38-1"})(["position:relative;height:","px;width:","px;cursor:pointer;",";",";"],(({pageSize})=>pageSize.height),(({pageSize})=>pageSize.width),(({isHighlighted})=>isHighlighted&&outline.g),shared_styles.Y);savedPageTemplate_PageTemplateWrapper.propTypes={pageSize:propTypes.Gn.isRequired};const PreviewPageWrapper=styled_components_browser_esm.Ay.button.withConfig({displayName:"savedPageTemplate__PreviewPageWrapper",componentId:"sc-5hfe38-2"})(["position:relative;padding:0;border:0;height:100%;width:100%;background-color:",";border-radius:",";overflow:hidden;",""],(({theme})=>theme.colors.interactiveBg.secondary),(({theme})=>theme.borders.radius.small),(({background})=>(0,generatePatternStyles.A)(background)));PreviewPageWrapper.propTypes={pageSize:propTypes.Gn.isRequired};const ElementsWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"savedPageTemplate__ElementsWrapper",componentId:"sc-5hfe38-3"})(["z-index:10;"]),TemplateInsertionOverlay=(0,styled_components_browser_esm.Ay)(insertionOverlay.A).withConfig({displayName:"savedPageTemplate__TemplateInsertionOverlay",componentId:"sc-5hfe38-4"})(["z-index:11;"]),savedPageTemplate_TemplateTitleContainer=(0,styled_components_browser_esm.Ay)(panes_shared.VC).withConfig({displayName:"savedPageTemplate__TemplateTitleContainer",componentId:"sc-5hfe38-5"})(["opacity:",";"],(({isActive})=>isActive?1:0));function SavedPageTemplate({page,pageSize,handleDelete,index,title,highlightedTemplate,onClick},ref){const{capabilities:{hasUploadMediaAction}}=(0,app_config.UK)(),{actions:{updatePageTemplate}}=(0,api.M1)(),{actions:{uploadFile}}=(0,uploader.k)(),{showSnackbar}=(0,useSnackbar.d)(),{updateSavedTemplate}=library_useLibrary((state=>({updateSavedTemplate:state.actions.updateSavedTemplate}))),queuePageImageGeneration=pageDataUrls_usePageDataUrls((({actions})=>actions.queuePageImageGeneration)),pageDataUrl=pageDataUrls_usePageDataUrls((({state:{dataUrls}})=>dataUrls[page.id]))||page.pregeneratedPageDataUrl,[isActive,setIsActive]=(0,react_src.J0)(!1),[isMenuOpen,setIsMenuOpen]=(0,react_src.J0)(!1),onMenuOpen=(0,react_src.hb)((e=>{e.stopPropagation(),setIsMenuOpen(!0),setIsActive(!1)}),[]),onMenuCancelled=(0,react_src.hb)((()=>{setIsMenuOpen(!1),setIsActive(!1)}),[]),onMenuSelected=(0,react_src.hb)((()=>{setIsMenuOpen(!1),setIsActive(!1)}),[]);(0,react_src.g$)(ref,(()=>setIsActive(!1)),[]);const makeActive=(0,react_src.hb)((()=>setIsActive(!0)),[]),makeInactive=(0,react_src.hb)((()=>{setIsActive(!1)}),[]),updateTemplateName=(0,react_src.hb)((async newName=>{try{const res=await updatePageTemplate(page.templateId,{title:newName});updateSavedTemplate({templateId:page.templateId,title:res.title}),setIsMenuOpen(!1),setIsActive(!1),showSnackbar({message:(0,i18n.__)("Page Template renamed.","web-stories"),dismissible:!0})}catch{showSnackbar({message:(0,i18n.__)("Unable to rename the template. Please try again.","web-stories"),dismissible:!0})}}),[updatePageTemplate,updateSavedTemplate,page.templateId,showSnackbar]),imageUrl=page.image?.url||pageDataUrl,shouldPostBlob=hasUploadMediaAction&&pageDataUrl&&!page.image?.url;(0,react_src.vJ)((()=>{shouldPostBlob&&(async()=>{try{const blob=await(0,fetchRemoteBlob.A)(pageDataUrl),file=(0,blobToFile.A)(blob,`web-stories-page-template-${page.templateId}.jpg`,"image/jpeg"),resource=await uploadFile(file,{templateId:page.templateId,mediaSource:"page-template"});await updatePageTemplate(page.templateId,{featured_media:resource.id}),updateSavedTemplate({templateId:page.templateId,image:{id:resource.id,height:resource.height,width:resource.width,url:resource.src}})}catch(err){(0,tracking_src.Oz)("upload_generated_page_template_image",err?.message)}})()}),[pageDataUrl,uploadFile,updatePageTemplate,page.templateId,shouldPostBlob,updateSavedTemplate]),(0,react_src.vJ)((()=>{!imageUrl&&hasUploadMediaAction&&queuePageImageGeneration(page)}),[imageUrl,queuePageImageGeneration,page,hasUploadMediaAction]);const insertButtonRef=(0,react_src.li)();return(0,useRovingTabIndex.A)({ref:insertButtonRef},[],2),react.createElement(savedPageTemplate_PageTemplateWrapper,{pageSize,role:"listitem",ref,onPointerEnter:makeActive,onPointerLeave:makeInactive,"aria-label":title,isHighlighted:page.id===highlightedTemplate,onFocus:makeActive,onBlur:makeInactive},react.createElement(PreviewPageWrapper,{pageSize,background:page.backgroundColor,onClick},imageUrl?react.createElement(TemplateImage,{alt:page.image?.alt||(0,i18n.__)("Saved Page Template","web-stories"),src:imageUrl,crossOrigin:"anonymous",height:page.image?.height,width:page.image?.height,draggable:!1}):react.createElement(ElementsWrapper,null,react.createElement(unitsProvider.A,{pageSize:{height:pageSize.height,width:pageSize.width}},page.elements.map((element=>react.createElement(displayElement.A,{key:element.id,previewMode:!0,element}))))),isActive&&react.createElement(TemplateInsertionOverlay,{showIcon:!1}),react.createElement(savedPageTemplate_TemplateTitleContainer,{isActive},react.createElement(typography_text.E.Span,{size:types.$.Small},title||(0,i18n.__)("Untitled","web-stories")))),react.createElement(panes_shared.rA,{ref:insertButtonRef,onClick:e=>{e.stopPropagation(),onClick(e)},"aria-label":(0,i18n.__)("Use template","web-stories"),$display:isActive,tabIndex:0===index?0:-1},react.createElement(plus_filled_small.A,null)),react.createElement(dropDownMenu,{display:isActive,isMenuOpen,onMenuOpen,onMenuCancelled,onMenuSelected,onDelete:()=>{handleDelete(page.templateId)},previousName:title,onUpdateName:updateTemplateName}))}const PageTemplateWithRef=(0,react_src.Rf)(SavedPageTemplate);SavedPageTemplate.displayName="SavedPageTemplate";const savedPageTemplate=PageTemplateWithRef;function templateList_extends(){return templateList_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},templateList_extends.apply(null,arguments)}const WrapperGrid=styled_components_browser_esm.Ay.div.withConfig({displayName:"templateList__WrapperGrid",componentId:"sc-1ukppvz-0"})(["display:grid;width:100%;margin-left:",";margin-bottom:12px;gap:12px;grid-template-columns:",";grid-template-rows:",";"],panes_shared.z7,(({columnWidth})=>`repeat(auto-fit, ${columnWidth}px)`),(({rowHeight})=>`repeat(minmax(${rowHeight}px, 1fr))`));const templateList=function TemplateList({pages,parentRef,pageSize,handleDelete,fetchTemplates,...rest}){const{addPage}=(0,app_story.P3)((({actions})=>({addPage:actions.addPage}))),{isRTL}=(0,app_config.UK)(),{showSnackbar}=(0,useSnackbar.d)(),[currentPageId,setCurrentPageId]=(0,react_src.J0)(),containerRef=(0,react_src.li)(),pageRefs=(0,react_src.li)({}),handlePageClick=(0,react_src.hb)((({templateId,version,title,...page})=>{const duplicatedPage=(0,elements_src.hi)(page);addPage({page:duplicatedPage}),(0,tracking_src.sx)("insert_page_template",{name:title||"custom"}),showSnackbar({message:(0,i18n.__)("Page Template added.","web-stories"),dismissible:!0})}),[addPage,showSnackbar]),handleFocus=(0,react_src.hb)((id=>{setCurrentPageId(id)}),[]),isSavedTemplates=handleDelete||fetchTemplates;return(0,react_src.vJ)((()=>{pages.length>0&&(currentPageId&&pages.some((page=>page.id===currentPageId))||setCurrentPageId(pages[0].id))}),[currentPageId,pages]),(0,react_src.vJ)((()=>{fetchTemplates?.()}),[fetchTemplates]),(0,useGridViewKeys.A)({containerRef:parentRef,gridRef:containerRef,itemRefs:pageRefs,items:pages,currentItemId:currentPageId,isRTL}),react.createElement(WrapperGrid,{ref:containerRef,columnWidth:pageSize.width,rowHeight:pageSize.containerHeight,role:"list","aria-label":(0,i18n.__)("Page Template Options","web-stories")},isSavedTemplates?pages.map(((page,index)=>react.createElement(savedPageTemplate,templateList_extends({key:page.id,"data-testid":`page_template_${page.id}`,ref:el=>pageRefs.current[page.id]=el,page,pageSize,onClick:()=>handlePageClick(page),handleDelete,onFocus:()=>handleFocus(page.id),index,title:page?.title?.raw},rest)))):pages.map((page=>react.createElement(defaultPageTemplate,templateList_extends({ref:el=>pageRefs.current[page.id]=el,key:page.id,"data-testid":`page_template_${page.id}`,page,pageSize,onFocus:()=>handleFocus(page.id),isActive:currentPageId===page.id,onClick:()=>handlePageClick(page.story),columnWidth:pageSize.width},rest)))))},ActionRow=styled_components_browser_esm.Ay.div.withConfig({displayName:"defaultTemplates__ActionRow",componentId:"sc-14vj9wc-0"})(["display:flex;justify-content:space-between;margin:0px 16px 22px 16px;"]),PageTemplatesParentContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"defaultTemplates__PageTemplatesParentContainer",componentId:"sc-14vj9wc-1"})(["",";margin-top:26px;overflow-x:hidden;overflow-y:scroll;"],virtualPaneContainer),SearchInputContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"defaultTemplates__SearchInputContainer",componentId:"sc-14vj9wc-2"})(["padding:0 ",";margin-bottom:26px;"],panes_shared.z7),defaultTemplates_Message=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Medium}).withConfig({displayName:"defaultTemplates__Message",componentId:"sc-14vj9wc-3"})(["color:",";padding:1em;text-align:center;"],(({theme})=>theme.colors.fg.secondary));const defaultTemplates=function DefaultTemplates({pageSize}){const{actions:{getPageTemplates}}=(0,api.M1)(),[pageTemplates,setPageTemplates]=(0,react_src.J0)([]),[isLoading,setIsLoading]=(0,react_src.J0)(!1),[searchTerm,setSearchTerm]=(0,react_src.J0)("");(0,react_src.vJ)((()=>{!async function loadPageTemplates(){setIsLoading(!0);const trackTiming=(0,tracking_src.g6)("load_page_templates");setPageTemplates(await getPageTemplates(searchTerm)),setIsLoading(!1),trackTiming()}()}),[getPageTemplates,setPageTemplates,searchTerm]);const pageTemplatesParentRef=(0,react_src.li)(),[selectedPageTemplateType,setSelectedPageTemplateType]=(0,react_src.J0)(null),pills=(0,react_src.Kr)((()=>[{id:null,label:(0,i18n._x)("All","page templates","web-stories")},...Object.entries(PAGE_TEMPLATE_TYPES).map((([key,{name}])=>({id:key,label:name})))]),[]),filteredPages=(0,react_src.Kr)((()=>pageTemplates.reduce(((pages,template)=>[...pages,...Object.values(template.postersByPage).map(((poster,index)=>({id:`${template.slug}_${index}`,title:template.title,story:template.pages[index],...poster}))).reduce(((acc,posterByPage)=>!posterByPage.type||selectedPageTemplateType&&posterByPage.type!==selectedPageTemplateType?acc:[...acc,posterByPage]),[])]),[])),[pageTemplates,selectedPageTemplateType]),handleSelectPageTemplateType=(0,react_src.hb)((key=>{setSelectedPageTemplateType(key),(0,tracking_src.sx)("search",{search_type:"page_templates",search_term:"",search_category:key})}),[]);return react.createElement(react.Fragment,null,react.createElement(SearchInputContainer,null,react.createElement(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch:setSearchTerm,disabled:!1})),react.createElement(panes_shared.Iy,{items:pills,selectedItemId:selectedPageTemplateType,selectItem:handleSelectPageTemplateType,deselectItem:()=>handleSelectPageTemplateType(null)}),react.createElement(PageTemplatesParentContainer,{ref:pageTemplatesParentRef,tabIndex:-1},react.createElement(ActionRow,null,react.createElement(headline.$,{as:"h2",size:types.$.XXXSmall},(0,i18n.__)("Templates","web-stories"))),isLoading||!pageTemplatesParentRef.current?react.createElement(panes_shared.YM,null,react.createElement(loadingSpinner.A,{animationSize:64,numCircles:8})):0===pageTemplates.length?react.createElement(defaultTemplates_Message,null,(0,i18n.__)("No page templates found.","web-stories")):react.createElement(templateList,{pageSize,parentRef:pageTemplatesParentRef,pages:filteredPages})))};function savedTemplates_extends(){return savedTemplates_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},savedTemplates_extends.apply(null,arguments)}const savedTemplates_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"savedTemplates__Wrapper",componentId:"sc-1bm5y87-0"})(["height:100%;padding-top:5px;overflow-y:scroll;overflow-x:hidden;min-height:96px;"]);const pageTemplates_savedTemplates=function SavedTemplates({searchTerm,setSearchTerm,pageSize,loadTemplates,isLoading,...rest}){const{actions:{deletePageTemplate}}=(0,api.M1)(),{savedTemplates,setSavedTemplates,nextTemplatesToFetch}=library_useLibrary((state=>({savedTemplates:state.state.savedTemplates,nextTemplatesToFetch:state.state.nextTemplatesToFetch,setSavedTemplates:state.actions.setSavedTemplates}))),{showSnackbar}=(0,useSnackbar.d)(),ref=(0,react_src.li)(),[,update]=(0,react_src.J0)(null);(0,react_src.Nf)((()=>{update(!1)}),[]);const fetchTemplates=(0,react_src.hb)((()=>{nextTemplatesToFetch&&loadTemplates()}),[nextTemplatesToFetch,loadTemplates]),handleDelete=(0,react_src.hb)((async id=>{try{await deletePageTemplate(id),setSavedTemplates(savedTemplates.filter((({templateId})=>templateId!==id))),showSnackbar({message:(0,i18n.__)("Page Template deleted.","web-stories"),dismissable:!0})}catch{showSnackbar({message:(0,i18n.__)("Unable to delete the template. Please try again.","web-stories"),dismissible:!0})}}),[deletePageTemplate,savedTemplates,showSnackbar,setSavedTemplates]);return react.createElement(savedTemplates_Wrapper,{ref,tabIndex:-1},!isLoading&&ref.current?react.createElement(templateList,savedTemplates_extends({parentRef:ref,pageSize,pages:savedTemplates,handleDelete,fetchTemplates},rest)):react.createElement(panes_shared.YM,null,react.createElement(loadingSpinner.A,{animationSize:64,numCircles:8})))},utils_isDefaultPage=page=>{if(page.elements.length>1)return!1;const defaultPage=(0,elements_src.a3)();if("color"in page.backgroundColor&&"color"in defaultPage.backgroundColor&&!(0,react_src.bN)(page.backgroundColor.color,defaultPage.backgroundColor.color))return!1;const backgroundElement=page.elements.find((e=>elements_src.V7.backgroundable(e)&&e.isBackground));return!!(!backgroundElement||elements_src.V7.defaultBackground(backgroundElement)&&backgroundElement.isDefaultBackground)};const utils_createThumbnailCanvasFromFullbleedCanvas=function createThumbnailCanvasFromFullbleedCanvas(fullbleedCanvas){const thumbnailCanvas=document.createElement("canvas"),thumbnailContext=thumbnailCanvas.getContext("2d"),fullbleedHeight=Number(fullbleedCanvas.height),thumbnailHeight=Number(fullbleedCanvas.width)/src_constants.iZ,dy=(fullbleedHeight-thumbnailHeight)/2;return thumbnailCanvas.width=fullbleedCanvas.width,thumbnailCanvas.height=thumbnailHeight,thumbnailContext&&thumbnailContext.drawImage(fullbleedCanvas,0,-dy),thumbnailCanvas};var _path,_path2,_path3;function illustration_extends(){return illustration_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},illustration_extends.apply(null,arguments)}const SvgIllustration=({title,titleId,...props})=>react.createElement("svg",illustration_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 43","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,_path||(_path=react.createElement("path",{fill:"#767E80",d:"M21.903 0H4a4 4 0 0 0-4 4v34.4a4 4 0 0 0 4 4h24a4 4 0 0 0 4-4V10.03a4 4 0 0 0-1.187-2.844l-6.097-6.03A4 4 0 0 0 21.903 0"})),_path2||(_path2=react.createElement("path",{fill:"#ADB1B3",d:"m30.146 8.146-5.893-5.893a.5.5 0 0 0-.853.354V8.5a.5.5 0 0 0 .5.5h5.893a.5.5 0 0 0 .353-.854"})),_path3||(_path3=react.createElement("path",{fill:"#E4E5E6",fillRule:"evenodd",d:"M16 29a8 8 0 1 0 0-16 8 8 0 0 0 0 16m0-12.469c.535 0 .969.434.969.969v2.531H19.5a.969.969 0 0 1 0 1.938h-2.531V24.5a.969.969 0 0 1-1.938 0v-2.531H12.5a.969.969 0 0 1 0-1.938h2.531V17.5c0-.535.434-.969.969-.969",clipRule:"evenodd"}))),illustration=(0,react.memo)(SvgIllustration),templateSave_StyledText=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).withConfig({displayName:"templateSave__StyledText",componentId:"sc-vcrsmn-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),IconWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"templateSave__IconWrapper",componentId:"sc-vcrsmn-1"})(["width:32px;height:42px;margin-right:29px;"]),SaveButton=styled_components_browser_esm.Ay.button.withConfig({displayName:"templateSave__SaveButton",componentId:"sc-vcrsmn-2"})(["border:0;background:none;height:56px;width:100%;padding:7px;background-color:",";transition:background-color ",";border-radius:",";display:flex;flex-direction:row;align-items:center;cursor:pointer;&:hover{background-color:",";}"," ",";"],(({theme})=>theme.colors.interactiveBg.secondaryNormal),constants.QB,(({theme})=>theme.borders.radius.small),(({theme})=>theme.colors.interactiveBg.secondaryHover),(({$isDisabled,theme})=>$isDisabled&&`\n      cursor: default;\n      background-color: ${theme.colors.interactiveBg.disable};\n      &:hover {\n        background-color: ${theme.colors.interactiveBg.disable};\n      }\n\n      ${IconWrapper} svg {\n        path:nth-child(1): ${theme.colors.fg.disable};\n        path:nth-child(2) {\n          fill: ${theme.colors.fg.tertiary};\n        }\n        path:nth-child(3) {\n          fill: ${theme.colors.fg.secondary};\n        }\n      }\n\n      ${templateSave_StyledText} {\n        color: ${theme.colors.fg.disable};\n      }\n  `),shared_styles.Y);const templateSave=function TemplateSave({setShowDefaultTemplates,updateList}){const{actions:{addPageTemplate}}=(0,api.M1)(),{showSnackbar}=(0,useSnackbar.d)(),{currentPage}=(0,app_story.P3)((({state:{currentPage}})=>({currentPage}))),pageCanvasMap=(0,pageCanvas.R5)((({state})=>state.pageCanvasMap)),isDisabled=(0,react_src.Kr)((()=>currentPage&&utils_isDefaultPage(currentPage)),[currentPage]),[isDialogOpen,setIsDialogOpen]=(0,react_src.J0)(!1),handleSaveTemplate=(0,react_src.hb)((async templateName=>{if(isDisabled)return;let tmpPageDataUrl;const currentPageCanvas=pageCanvasMap[currentPage.id];if(currentPageCanvas){tmpPageDataUrl=utils_createThumbnailCanvasFromFullbleedCanvas(currentPageCanvas).toDataURL("image/jpeg")}try{const{templateId,...page}=currentPage,addedTemplate=await addPageTemplate({story_data:{...page,id:(0,v4.A)(),version:migration_src.I},featured_media:undefined,title:""!==templateName?templateName:(0,i18n.__)("Untitled","web-stories")});tmpPageDataUrl&&(addedTemplate.pregeneratedPageDataUrl=tmpPageDataUrl),updateList?.(addedTemplate),showSnackbar({message:(0,i18n.__)("Page Template saved.","web-stories"),dismissable:!0})}catch{showSnackbar({message:(0,i18n.__)("Unable to save the template. Please try again.","web-stories"),dismissable:!0})}setShowDefaultTemplates(!1),setIsDialogOpen(!1)}),[isDisabled,addPageTemplate,currentPage,setShowDefaultTemplates,showSnackbar,updateList,pageCanvasMap]);return react.createElement(react.Fragment,null,react.createElement(SaveButton,{"aria-disabled":isDisabled,onClick:()=>{isDisabled||setIsDialogOpen(!0)},$isDisabled:isDisabled},react.createElement(IconWrapper,null,react.createElement(illustration,{"aria-hidden":!0})),react.createElement(templateSave_StyledText,{size:types.$.Small},(0,i18n.__)("Save current page as template","web-stories"))),isDialogOpen&&react.createElement(nameDialog,{onClose:()=>{setIsDialogOpen(!1)},onSave:async templateName=>{await handleSaveTemplate(templateName),setIsDialogOpen(!1)},title:(0,i18n.__)("Save Page Template","web-stories"),placeholder:(0,i18n.__)("Untitled","web-stories"),previousInput:""}))};function pageTemplatesPane_extends(){return pageTemplatesPane_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},pageTemplatesPane_extends.apply(null,arguments)}const pageTemplatesPane_SearchInputContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageTemplatesPane__SearchInputContainer",componentId:"sc-hm7mfr-0"})(["padding:0 ",";margin-bottom:26px;"],panes_shared.z7),StyledPane=(0,styled_components_browser_esm.Ay)(panes_shared.Zv).withConfig({displayName:"pageTemplatesPane__StyledPane",componentId:"sc-hm7mfr-1"})(["height:100%;padding:0;overflow:hidden;"]),PaneInner=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageTemplatesPane__PaneInner",componentId:"sc-hm7mfr-2"})(["height:100%;display:flex;flex-direction:column;"]),DropDownWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageTemplatesPane__DropDownWrapper",componentId:"sc-hm7mfr-3"})(["text-align:left;margin:28px 16px 17px;"]),pageTemplatesPane_ButtonWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageTemplatesPane__ButtonWrapper",componentId:"sc-hm7mfr-4"})(["padding:0 1em;margin-top:24px;"]),LOCAL_STORAGE_KEY=localStore.$.DEFAULT_VIEW_PAGE_TEMPLATE_LAYOUT,DEFAULT_TEMPLATE_VIEW=localStore.x.getItemByKey(LOCAL_STORAGE_KEY);const pageTemplatesPane=function PageTemplatesPane(props){const{actions:{getCustomPageTemplates}}=(0,api.M1)(),{canViewDefaultTemplates}=(0,app_config.UK)(),supportsCustomTemplates=Boolean(getCustomPageTemplates),{savedTemplates,setSavedTemplates,nextTemplatesToFetch,setNextTemplatesToFetch}=library_useLibrary((state=>({savedTemplates:state.state.savedTemplates,nextTemplatesToFetch:state.state.nextTemplatesToFetch,setSavedTemplates:state.actions.setSavedTemplates,setNextTemplatesToFetch:state.actions.setNextTemplatesToFetch}))),[showDefaultTemplates,setShowDefaultTemplates]=(0,react_src.J0)(null===DEFAULT_TEMPLATE_VIEW?canViewDefaultTemplates:canViewDefaultTemplates&&DEFAULT_TEMPLATE_VIEW),[highlightedTemplate,setHighlightedTemplate]=(0,react_src.J0)(null),[searchTerm,setSearchTerm]=(0,react_src.J0)(""),[isLoading,setIsLoading]=(0,react_src.J0)(!1),updateTemplatesList=(0,react_src.hb)((page=>{setSavedTemplates((_savedTemplates=>[page,..._savedTemplates||[]])),setHighlightedTemplate(page.id),localStore.x.setItemByKey(LOCAL_STORAGE_KEY,!1)}),[setSavedTemplates]),loadTemplates=(0,react_src.hb)((async()=>{if(nextTemplatesToFetch){setIsLoading(!0);try{const{templates,hasMore}=await getCustomPageTemplates(nextTemplatesToFetch,searchTerm),updatedTemplates=templates.map((({version,templateId,...page})=>{const template={pages:[page]},migratedTemplate=(0,migration_src._)(template,version||25);return{templateId,version:migration_src.I,...migratedTemplate.pages[0]}}));setSavedTemplates((_savedTemplates=>[..._savedTemplates||[],...updatedTemplates])),setNextTemplatesToFetch(!!hasMore&&nextTemplatesToFetch+1)}catch(err){(0,tracking_src.Oz)("saved_templates",err.message),setNextTemplatesToFetch(!1),setSavedTemplates((_savedTemplates=>_savedTemplates??[]))}finally{setIsLoading(!1)}}}),[searchTerm,getCustomPageTemplates,nextTemplatesToFetch,setSavedTemplates,setNextTemplatesToFetch]);(0,react_src.vJ)((()=>{savedTemplates||showDefaultTemplates||loadTemplates()}),[loadTemplates,showDefaultTemplates,savedTemplates]),(0,react_src.vJ)((()=>{let timeout=null;return highlightedTemplate&&(timeout=setTimeout((()=>{setHighlightedTemplate(null)}),1e3)),()=>clearTimeout(timeout)}),[highlightedTemplate]);const options=[];canViewDefaultTemplates&&options.push({value:"default",label:(0,i18n.__)("Default templates","web-stories")}),supportsCustomTemplates&&options.push({value:"saved",label:(0,i18n.__)("Saved templates","web-stories")});const pageSize=(0,react_src.Kr)((()=>({width:158,height:Math.round(158/src_constants.iZ),containerHeight:Math.round(158/src_constants.yK)})),[]);return react.createElement(StyledPane,pageTemplatesPane_extends({id:pageTemplates_paneId},props),react.createElement(PaneInner,null,react.createElement(react.Fragment,null,supportsCustomTemplates&&react.createElement(pageTemplatesPane_ButtonWrapper,null,react.createElement(templateSave,{setShowDefaultTemplates,updateList:updateTemplatesList})),react.createElement(DropDownWrapper,null,options.length>1&&react.createElement(components_form.l6,{options,selectedValue:showDefaultTemplates?"default":"saved",onMenuItemClick:(_,menuItem)=>{const value="default"===menuItem;showDefaultTemplates!==value&&(setShowDefaultTemplates("default"===menuItem),localStore.x.setItemByKey(LOCAL_STORAGE_KEY,value))},"aria-label":(0,i18n.__)("Select templates type","web-stories")}))),showDefaultTemplates?react.createElement(defaultTemplates,{pageSize}):react.createElement(react.Fragment,null,react.createElement(pageTemplatesPane_SearchInputContainer,null,react.createElement(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch:str=>{setSavedTemplates([]),setNextTemplatesToFetch(1),setSearchTerm(str)},disabled:!1})),react.createElement(pageTemplates_savedTemplates,{pageSize,highlightedTemplate,loadTemplates,isLoading}))))};var box4_alternate=__webpack_require__("./packages/design-system/src/icons/box4_alternate.svg");const pageTemplatesIcon=function PageTemplatesIcon(){return react.createElement(box4_alternate.A,{title:(0,i18n.__)("Page templates library","web-stories")})};var infiniteScroller=__webpack_require__("./packages/design-system/src/components/infiniteScroller/infiniteScroller.tsx");const shopping_paneId=(0,panes_shared.kN)("shopping");var productList=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/productList.js"),sort=__webpack_require__("./packages/design-system/src/icons/sort.svg"),media_dropDownMenu=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/dropDownMenu.js");const StyledDropDownMenu=(0,styled_components_browser_esm.Ay)(media_dropDownMenu.A).withConfig({displayName:"productSort__StyledDropDownMenu",componentId:"sc-1apxa0h-0"})(["margin-left:12px;"]),StyledIcon=(0,styled_components_browser_esm.Ay)(sort.A).withConfig({displayName:"productSort__StyledIcon",componentId:"sc-1apxa0h-1"})(["width:28px !important;height:28px !important;"]),productSort_menuStylesOverride=(0,styled_components_browser_esm.AH)(["min-width:180px;margin-top:0;"]),options=[{value:"date-desc",orderby:"date",order:"desc",label:(0,i18n.__)("Recently Added","web-stories")},{value:"title-asc",orderby:"title",order:"asc",label:(0,i18n.__)("Alphabetical: A-Z","web-stories")},{value:"title-desc",orderby:"title",order:"desc",label:(0,i18n.__)("Alphabetical: Z-A","web-stories")},{value:"price-asc",orderby:"price",order:"asc",label:(0,i18n.__)("Lowest Price","web-stories")},{value:"price-desc",orderby:"price",order:"desc",label:(0,i18n.__)("Highest Price","web-stories")}];const productSort=function ProductSort({onChange,value="date-desc"}){const[isMenuOpen,setIsMenuOpen]=(0,react_src.J0)(!1),onMenuSelected=(0,react_src.hb)((newValue=>{setIsMenuOpen(!1),onChange(options.find((option=>option.value===newValue)))}),[onChange]),optionsWithGroup=[{options}];return react.createElement(StyledDropDownMenu,{onMenuOpen:()=>setIsMenuOpen(!0),isMenuOpen,onMenuSelected,display:!0,onMenuClose:()=>setIsMenuOpen(!1),groups:optionsWithGroup,ariaLabel:(0,i18n.__)("Product sort options","web-stories"),activeValue:value,dropDownHeight:340,menuStylesOverride:productSort_menuStylesOverride},react.createElement(components_tooltip.A,{title:(0,i18n.__)("Sort","web-stories")},react.createElement(StyledIcon,null)))};var shopping_constants=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/constants.js");function shoppingPane_extends(){return shoppingPane_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},shoppingPane_extends.apply(null,arguments)}const LoadingContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"shoppingPane__LoadingContainer",componentId:"sc-14o47kz-0"})(["display:flex;justify-content:center;"]),HelperText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"shoppingPane__HelperText",componentId:"sc-14o47kz-1"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),loadingSpinnerProps={animationSize:25,circleSize:3};const shoppingPane=function ShoppingPane(props){const{showSnackbar}=(0,useSnackbar.d)(),{shoppingProvider}=(0,app.UK)(),speak=(0,useLiveRegion.A)("assertive"),{actions:{getProducts}}=(0,app.M1)(),{currentPageProducts,deleteElementById,currentPageNumber}=(0,app_story.P3)((({actions,state:{currentPage,currentPageNumber}})=>({currentPageProducts:currentPage?.elements?.filter((({type})=>type===elements_src.bV.PRODUCT)).map((({id,product})=>({elementId:id,product}))),deleteElementById:actions.deleteElementById,currentPageNumber}))),{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),[loaded,setLoaded]=(0,react_src.J0)(!1),[isLoading,setIsLoading]=(0,react_src.J0)(!1),[canLoadMore,setCanLoadMore]=(0,react_src.J0)(!1),[searchTerm,setSearchTerm]=(0,react_src.J0)(""),[page,setPage]=(0,react_src.J0)(1),[orderby,setOrderby]=(0,react_src.J0)("date"),[order,setOrder]=(0,react_src.J0)("desc"),[isMenuFocused,setIsMenuFocused]=(0,react_src.J0)(!1),[products,setProducts]=(0,react_src.J0)([]),searchProducts=(0,react_src.hb)((async(value="",_page=1,sortBy,sortOrder)=>{setIsLoading(!0),setPage(_page),1===_page&&setLoaded(!1);try{const{products:_products,hasNextPage}=await getProducts(value,_page,sortBy,sortOrder),newProducts=1===_page?_products:[...products,..._products];setProducts(newProducts),setCanLoadMore(hasNextPage)}catch(err){(0,tracking_src.Oz)("search_products",err?.message),showSnackbar({message:err.message}),1===_page&&(setProducts([]),setPage(1)),setCanLoadMore(!1)}finally{setIsLoading(!1),setLoaded(!0)}}),[getProducts,products,showSnackbar]),searchProductsWithTelemetry=(0,react_src.hb)(((value="",_page,sortBy,sortOrder)=>{searchProducts(value,_page,sortBy,sortOrder),(0,tracking_src.sx)("search",{search_type:"products",search_term:value,search_order:sortOrder,search_orderby:sortBy,search_provider:shoppingProvider})}),[searchProducts,shoppingProvider]),debouncedProductsQuery=(0,react_src.YQ)(searchProductsWithTelemetry,300),onSearch=(0,react_src.hb)((evt=>{const value=evt.target.value;value!==searchTerm&&(setSearchTerm(value),debouncedProductsQuery(value,1,orderby,order))}),[debouncedProductsQuery,order,orderby,searchTerm]),isShoppingEnabled="none"!==shoppingProvider;(0,react_src.vJ)((()=>{isShoppingEnabled&&searchProducts(searchTerm,page,orderby,order)}),[isShoppingEnabled]);const numProducts=products.length;(0,react_src.vJ)((()=>{isShoppingEnabled||0!==numProducts||(setProducts(currentPageProducts?.map((({product})=>product))),setIsLoading(!1),setLoaded(!0))}),[currentPageProducts,isShoppingEnabled,numProducts]);const onSortBy=(0,react_src.hb)((option=>{setOrderby(option.orderby),setOrder(option.order),debouncedProductsQuery(searchTerm,1,option.orderby,option.order)}),[debouncedProductsQuery,searchTerm]),handleInputKeyPress=(0,react_src.hb)((event=>{const{key}=event;"ArrowDown"!==key&&"Tab"!==key||setIsMenuFocused(!0)}),[]),insertProduct=(0,react_src.hb)((product=>{insertElement(elements_src.bV.PRODUCT,{width:shopping_constants.x,height:shopping_constants.c,product}),(0,tracking_src.sx)("insert_product",{page:currentPageNumber,provider:shoppingProvider});const PRODUCT_ADDED_TEXT=(0,sprintf.A)((0,i18n.__)("%s added to page","web-stories"),product.productTitle);speak(PRODUCT_ADDED_TEXT)}),[insertElement,speak,currentPageNumber,shoppingProvider]),deleteProduct=(0,react_src.hb)((product=>{const element=currentPageProducts.find((item=>item.product.productId===product.productId));if(element){deleteElementById({elementId:element.elementId});const PRODUCT_REMOVED_TEXT=(0,sprintf.A)((0,i18n.__)("%s removed","web-stories"),product?.productTitle);speak(PRODUCT_REMOVED_TEXT)}}),[deleteElementById,currentPageProducts,speak]),onClick=(0,react_src.hb)(((product,onPage)=>onPage?deleteProduct(product):insertProduct(product)),[deleteProduct,insertProduct]),handleClearInput=(0,react_src.hb)((()=>{setSearchTerm(""),debouncedProductsQuery("",1,orderby,order)}),[debouncedProductsQuery,order,orderby]),onLoadMore=(0,react_src.hb)((()=>{canLoadMore&&searchProducts(searchTerm,page+1,orderby,order)}),[canLoadMore,searchProducts,order,orderby,page,searchTerm]),allDataLoadedMessage=page>1?(0,i18n.__)("No more products","web-stories"):"";return react.createElement(panes_shared.Zv,shoppingPane_extends({id:shopping_paneId},props),react.createElement(Section,{"data-testid":"products-library-pane",title:(0,i18n.__)("Products","web-stories")},react.createElement(components_form.fI,null,react.createElement(HelperText,null,(0,i18n.__)("This will add products as a tappable dot on your story.","web-stories"))),isShoppingEnabled&&react.createElement(components_form.fI,null,react.createElement(input.A,{"aria-label":(0,i18n.__)("Product search","web-stories"),inputValue:searchTerm,onChange:onSearch,placeholder:(0,i18n.__)("Search","web-stories"),onKeyDown:handleInputKeyPress,onFocus:()=>setIsMenuFocused(!1),isOpen:!0,ariaClearLabel:(0,i18n.__)("Clear product search","web-stories"),clearId:"clear-product-search",handleClearInput}),react.createElement(productSort,{onChange:onSortBy,value:`${orderby}-${order}`})),!loaded&&isLoading&&react.createElement(LoadingContainer,null,react.createElement(loadingSpinner.A,loadingSpinnerProps)),loaded&&products?.length>0&&react.createElement(react.Fragment,null,react.createElement(productList.A,{isMenuFocused,onClick,products,onPageProducts:currentPageProducts}),react.createElement(infiniteScroller.A,{allDataLoadedMessage,allDataLoadedAriaMessage:(0,i18n.__)("Products are loaded","web-stories"),onLoadMore,canLoadMore,isLoading,loadingSpinnerProps,loadingAriaMessage:(0,i18n.__)("Loading more products","web-stories")})),loaded&&!isLoading&&0===products?.length&&react.createElement(HelperText,null,(0,i18n.__)("No products found.","web-stories"))))};var shopping=__webpack_require__("./packages/design-system/src/icons/shopping.svg");const shoppingIcon=function ShoppingIcon(){return react.createElement(shopping.A,{title:(0,i18n.__)("Shopping library","web-stories")})};var paneIds=__webpack_require__("./packages/story-editor/src/components/library/paneIds.ts");const MEDIA={icon:mediaIcon,tooltip:(0,i18n.__)("Media","web-stories"),placement:popup_constants.W.BottomStart,Pane:mediaPane,id:paneIds.o.Media},MEDIA3P={icon:media3pIcon,tooltip:(0,i18n.__)("Third-party media","web-stories"),Pane:media3pPane,id:paneIds.o.Media3p},TEXT={icon:textIcon,tooltip:(0,i18n.__)("Text","web-stories"),Pane:textPane,id:paneIds.o.Text},SHAPES={icon:shapesIcon,tooltip:(0,i18n.__)("Shapes & Stickers","web-stories"),Pane:shapesPane,id:paneIds.o.Shapes},PAGE_TEMPLATES={icon:pageTemplatesIcon,tooltip:(0,i18n.__)("Page Templates","web-stories"),Pane:pageTemplatesPane,id:paneIds.o.PageTemplates},SHOPPING={icon:shoppingIcon,tooltip:(0,i18n.__)("Shopping","web-stories"),Pane:shoppingPane,id:paneIds.o.Shopping},LIBRARY_TAB_IDS=new Set([MEDIA,MEDIA3P,PAGE_TEMPLATES,SHAPES,TEXT,SHOPPING].map((tab=>tab.id)));const libraryProvider=function LibraryProvider({children}){const{showMedia3p,shoppingProvider,canViewDefaultTemplates}=(0,app.UK)(),{actions:{getMedia,getCustomPageTemplates}}=(0,app.M1)(),{hasProducts}=(0,app.P3)((({state:{currentPage}})=>({hasProducts:currentPage?.elements?.some((({type})=>type===elements_src.bV.PRODUCT))}))),isShoppingEnabled=shoppingProvider&&"none"!==shoppingProvider||hasProducts,supportsCustomTemplates=Boolean(getCustomPageTemplates),showPageTemplates=canViewDefaultTemplates||supportsCustomTemplates,showMedia=Boolean(getMedia),[textSets,setTextSets]=(0,react_src.J0)({}),[areTextSetsLoading,setAreTextSetsLoading]=(0,react_src.J0)({}),[savedTemplates,_setSavedTemplates]=(0,react_src.J0)(null),[nextTemplatesToFetch,setNextTemplatesToFetch]=(0,react_src.J0)(1),[shouldUseSmartColor,setShouldUseSmartColor]=(0,react_src.J0)(!1),setSavedTemplates=(0,react_src.hb)((t=>_setSavedTemplates((_savedTemplates=>(0,uniqueEntriesByKey.A)("function"==typeof t?t(_savedTemplates):t,"templateId")))),[]),updateSavedTemplate=(0,react_src.hb)((template=>{_setSavedTemplates((_savedTemplates=>_savedTemplates.map((t=>t.templateId===template.templateId?{...t,...template}:t))))}),[]),tabs=(0,react_src.Kr)((()=>[showMedia&&MEDIA,showMedia3p&&MEDIA3P,TEXT,SHAPES,isShoppingEnabled&&SHOPPING,showPageTemplates&&PAGE_TEMPLATES].filter(Boolean)),[showMedia3p,showMedia,showPageTemplates,isShoppingEnabled]),[tab,setTab]=(0,react_src.J0)(tabs[0].id),insertElement=(0,canvas.dr)(),{insertTextSet,insertTextSetByOffset}=(0,canvas.On)(shouldUseSmartColor),{highlightedTab}=(0,highlights.N)((({section:highlightedTab})=>({highlightedTab})));(0,react_src.vJ)((()=>{LIBRARY_TAB_IDS.has(highlightedTab)&&(setTab(highlightedTab),(0,tracking_src.sx)("quick_action_tab_change",{name:highlightedTab}))}),[highlightedTab]);const mediaTabRef=(0,react_src.li)(null),media3pTabRef=(0,react_src.li)(null),textTabRef=(0,react_src.li)(null),shapesTabRef=(0,react_src.li)(null),pageTemplatesTabRef=(0,react_src.li)(null),shoppingRef=(0,react_src.li)(null),tabRefs=(0,react_src.Kr)((()=>({[MEDIA.id]:mediaTabRef,[MEDIA3P.id]:media3pTabRef,[TEXT.id]:textTabRef,[SHAPES.id]:shapesTabRef,[PAGE_TEMPLATES.id]:pageTemplatesTabRef,[SHOPPING.id]:shoppingRef})),[]),state=(0,react_src.Kr)((()=>({state:{areTextSetsLoading,tab,tabRefs,textSets,savedTemplates,nextTemplatesToFetch,shouldUseSmartColor},actions:{setTab,insertElement,insertTextSet,insertTextSetByOffset,setSavedTemplates,updateSavedTemplate,setNextTemplatesToFetch,setShouldUseSmartColor},data:{tabs}})),[areTextSetsLoading,tab,tabRefs,textSets,savedTemplates,insertElement,insertTextSet,insertTextSetByOffset,tabs,nextTemplatesToFetch,setNextTemplatesToFetch,shouldUseSmartColor,setSavedTemplates,updateSavedTemplate]);return(0,react_src.vJ)((()=>{let mounted=!0;return tab!==TEXT.id||Object.keys(textSets).length||async function getTextSets(){const trackTiming=(0,tracking_src.g6)("load_text_sets");setAreTextSetsLoading(!0);const newTextSets=await async function loadTextSets(){const textSets={};return await Promise.all(Object.values(TextSetType).map((async name=>{textSets[name]=await loadTextSet(name)}))),textSets}();trackTiming(),mounted&&(setTextSets(newTextSets),setAreTextSetsLoading(!1))}(),()=>{mounted=!1}}),[tab,textSets]),(0,react_src.vJ)((()=>{tab!==SHOPPING.id||isShoppingEnabled||setTab(tabs[0].id)}),[isShoppingEnabled,tab,tabs]),react.createElement(library_context.Provider,{value:state},children)};var components_mediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/index.js");const MediaButton=()=>{const{onSelect}=local_useOnMediaSelect();return react.createElement(components_form.c4,{renderButton:open=>react.createElement(components_button.A,{onClick:open},constants_RIGHT_CLICK_MENU_LABELS.UPLOAD_IMAGE_OR_VIDEO),onInsert:onSelect})};const emptyStateMenu=function EmptyStateMenu(){const{setHighlights}=(0,highlights.N)((({setHighlights})=>({setHighlights}))),{toggleRecordingMode}=(0,components_mediaRecording.be)((({actions})=>({toggleRecordingMode:actions.toggleRecordingMode}))),{isTranscodingEnabled}=(0,useFFmpeg.A)();return react.createElement(react.Fragment,null,react.createElement(components_button.A,{onClick:()=>{setHighlights({highlight:highlights.xP.Media})}},constants_RIGHT_CLICK_MENU_LABELS.CHOOSE_IMAGE_OR_VIDEO),react.createElement(libraryProvider,null,react.createElement(MediaButton,null)),isTranscodingEnabled&&react.createElement(components_button.A,{onClick:toggleRecordingMode},constants_RIGHT_CLICK_MENU_LABELS.RECORD_VIDEO),react.createElement(components_button.A,{onClick:()=>{setHighlights({highlight:highlights.xP.PageTemplates})}},constants_RIGHT_CLICK_MENU_LABELS.BROWSE_PAGE_TEMPLATES),react.createElement(components_button.A,{onClick:()=>{setHighlights({highlight:highlights.xP.Media3p})}},constants_RIGHT_CLICK_MENU_LABELS.BROWSE_STOCK_IMAGES_AND_VIDEO))},RightClickMenuContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"rightClickMenu__RightClickMenuContainer",componentId:"sc-11e09ag-0"})(["position:absolute;top:","px;left:","px;z-index:9999;"],(({position})=>position?.y??0),(({position})=>position?.x??0)),rightClickMenu=()=>{const{isRTL}=(0,app.UK)(),{selectedElements,isThisEmptyStory}=(0,app_story.P3)((value=>({selectedElements:value.state.selectedElements,isThisEmptyStory:(0,isEmptyStory.A)(value.state.pages)}))),{isMenuOpen,menuPosition,onCloseMenu,maskRef}=(0,app.lS)(),ref=(0,react_src.li)(),preventAdditionalContext=evt=>{evt.preventDefault(),evt.stopPropagation()},Menu=(0,react_src.Kr)((()=>{if(isThisEmptyStory)return emptyStateMenu;if(selectedElements.length>1)return multipleElementsMenu;const selectedElement=selectedElements?.[0];if(selectedElement?.isDefaultBackground)return pageMenu;switch(selectedElement?.type){case elements_src.bV.IMAGE:case elements_src.bV.VIDEO:case elements_src.bV.GIF:return selectedElement?.isBackground?pageMenu:foregroundMediaMenu;case elements_src.bV.SHAPE:return shapeMenu;case elements_src.bV.TEXT:return textMenu;case elements_src.bV.STICKER:return stickerMenu;case elements_src.bV.PRODUCT:case elements_src.bV.AUDIO_STICKER:return productMenu;default:return pageMenu}}),[selectedElements,isThisEmptyStory]);return(0,react_src.vJ)((()=>{const node=ref.current;return node.addEventListener("contextmenu",preventAdditionalContext),()=>{node.removeEventListener("contextmenu",preventAdditionalContext)}}),[ref]),(0,react_src.d5)(react.createElement(styled_components_browser_esm.ID,{stylisPlugins:[]},react.createElement(RightClickMenuContainer,{position:menuPosition,ref},react.createElement(directionAware.A,null,react.createElement(contextMenu.A,{"data-testid":"right-click-context-menu",isOpen:isMenuOpen,onDismiss:onCloseMenu,"aria-label":(0,i18n.__)("Context Menu for the selected element","web-stories"),maskRef,onMouseDown:evt=>evt.stopPropagation(),isRTL},react.createElement(Menu,{parentMenuRef:ref}))))),document.body)};function libraryPanes_extends(){return libraryPanes_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},libraryPanes_extends.apply(null,arguments)}const libraryPanes=function LibraryPanes(){const{tab,tabs}=library_useLibrary((state=>({tab:state.state.tab,tabs:state.data.tabs}))),{actions:{getMedia}}=(0,app.M1)(),showMediaPane=Boolean(getMedia),highlighted=(0,highlights.N)((({...highlighted})=>highlighted)),mediaHighlights=highlighted[MEDIA.id],media3pHighlights=highlighted[MEDIA3P.id],textHighlights=highlighted[TEXT.id];return tabs.map((({id})=>{const isActive=id===tab,paneProps={key:id,isActive,"aria-labelledby":(0,panes_shared.vU)(id)};if(!isActive)return react.createElement(panes_shared.Zv,libraryPanes_extends({key:id},paneProps));switch(id){case MEDIA.id:return showMediaPane?react.createElement(_StyledMediaPane,libraryPanes_extends({key:id},paneProps,{$_css:mediaHighlights?.showEffect&&highlights_styles.A.FLASH})):null;case MEDIA3P.id:return react.createElement(_StyledMedia3pPane,libraryPanes_extends({key:id},paneProps,{$_css2:media3pHighlights?.showEffect&&highlights_styles.A.FLASH}));case SHAPES.id:return react.createElement(shapesPane,libraryPanes_extends({key:id},paneProps));case TEXT.id:return react.createElement(_StyledTextPane,libraryPanes_extends({key:id},paneProps,{$_css3:textHighlights?.showEffect&&highlights_styles.A.FLASH}));case PAGE_TEMPLATES.id:return react.createElement(pageTemplatesPane,libraryPanes_extends({key:id},paneProps));case SHOPPING.id:return react.createElement(shoppingPane,libraryPanes_extends({key:id},paneProps));default:return null}}))};var _StyledMediaPane=(0,styled_components_browser_esm.Ay)(mediaPane)`${p=>p.$_css}`,_StyledMedia3pPane=(0,styled_components_browser_esm.Ay)(media3pPane)`${p=>p.$_css2}`,_StyledTextPane=(0,styled_components_browser_esm.Ay)(textPane).withConfig({displayName:"libraryPanes___StyledTextPane",componentId:"sc-g5zq8j-0"})(["",""],(p=>p.$_css3));const libraryLayout_Layout=styled_components_browser_esm.Ay.section.attrs({"aria-label":(0,i18n.__)("Library","web-stories"),"data-testid":"libraryLayout"}).withConfig({displayName:"libraryLayout__Layout",componentId:"sc-6ze1kl-0"})(["height:100%;display:flex;flex-direction:column;background-color:",";color:",";max-height:100%;"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.fg.primary)),TabsArea=styled_components_browser_esm.Ay.nav.attrs({"aria-label":(0,i18n.__)("Library tabs","web-stories")}).withConfig({displayName:"libraryLayout__TabsArea",componentId:"sc-6ze1kl-1"})([""]),LibraryPaneContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"libraryLayout__LibraryPaneContainer",componentId:"sc-6ze1kl-2"})(["height:100%;min-height:0;"]);const libraryLayout=function LibraryLayout(){const{setTab,tab,tabRefs,tabs}=library_useLibrary((state=>({tab:state.state.tab,tabRefs:state.state.tabRefs,setTab:state.actions.setTab,tabs:state.data.tabs}))),{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:{[MEDIA.id]:state[highlights.xP.Media],[MEDIA3P.id]:state[highlights.xP.Media3p],[TEXT.id]:state[highlights.xP.TextSet],[PAGE_TEMPLATES.id]:state[highlights.xP.PageTemplates]},resetHighlight:state.onFocusOut}))),onTabChange=(0,react_src.hb)((id=>{setTab(id),resetHighlight(),(0,tracking_src.sx)("library_tab_change",{name:id})}),[setTab,resetHighlight]);return react.createElement(libraryLayout_Layout,null,react.createElement(TabsArea,null,react.createElement(tabview.Ay,{label:(0,i18n.__)("Element Library Selection","web-stories"),tabs,tabRefs,tab,onTabChange,onTabRefUpdated:(node,tabId)=>{const h=highlight[tabId];node&&h?.focus&&h?.showEffect&&node.focus()},getTabId:panes_shared.vU,getAriaControlsId:panes_shared.kN,shortcut:"mod+option+1"})),react.createElement(LibraryPaneContainer,null,react.createElement(libraryPanes,null)))},MESSAGE_ID="edit-story-library-upload-message";const libraryUploadDropTarget=function LibraryUploadDropTarget({children}){const{uploadMedia}=(0,app_media.HZ)((({actions:{uploadMedia}})=>({uploadMedia}))),onDropHandler=(0,react_src.hb)((files=>{uploadMedia(files)}),[uploadMedia]);return react.createElement(uploadDropTarget._G,{onDrop:onDropHandler,labelledBy:MESSAGE_ID},children,react.createElement(uploadDropTarget.X4,{id:MESSAGE_ID,message:(0,i18n.__)("Upload to media library","web-stories")}))};const library=function Library(){return react.createElement(libraryProvider,null,react.createElement(libraryUploadDropTarget,null,react.createElement(libraryLayout,null)))};var panelSections=__webpack_require__("./packages/design-system/src/utils/panelSections.ts"),box4=__webpack_require__("./packages/design-system/src/icons/box4.svg");const selectionIcon=function SelectionIcon(){return react.createElement(box4.A,{title:(0,i18n.__)("Selection","web-stories")})};const linkIcon=function LinkIcon(){return react.createElement(icons_link.A,{title:(0,i18n.__)("Link","web-stories")})};var circle_speed=__webpack_require__("./packages/design-system/src/icons/circle_speed.svg");const animationIcon=function AnimationIcon(){return react.createElement(circle_speed.A,{title:(0,i18n.__)("Animation","web-stories")})},SELECTION={id:panelSections.q.Selection,icon:selectionIcon,tooltip:(0,i18n.__)("Selection","web-stories")},LINK={id:panelSections.q.Link,icon:linkIcon,tooltip:(0,i18n.__)("Link","web-stories")},ANIMATION={id:panelSections.q.Animation,icon:animationIcon,tooltip:(0,i18n.__)("Animation","web-stories")},style_context=(0,react_src.q6)({state:{},actions:{},tabs:{},refs:{}});const textSelectionIcon=function TextSelectionIcon(){return react.createElement(letter_t.A,{title:(0,i18n.__)("Text selection","web-stories")})};const imageSelectionIcon=function ImageSelectionIcon(){return react.createElement(picture.A,{title:(0,i18n.__)("Image selection","web-stories")})};var video=__webpack_require__("./packages/design-system/src/icons/video.svg");const videoSelectionIcon=function VideoSelectionIcon(){return react.createElement(video.A,{title:(0,i18n.__)("Video selection","web-stories")})};const shapeSelectionIcon=function ShapeSelectionIcon(){return react.createElement(shapes.A,{title:(0,i18n.__)("Shape selection","web-stories")})};var dots=__webpack_require__("./packages/design-system/src/icons/dots.svg");const multiSelectionIcon=function MultiSelectionIcon(){return react.createElement(dots.A,{title:(0,i18n.__)("Multi selection","web-stories")})},productSelectionIcon_StyledIcon=(0,styled_components_browser_esm.Ay)(shopping.A).withConfig({displayName:"productSelectionIcon__StyledIcon",componentId:"sc-1jpxe2a-0"})(["width:32px !important;height:32px !important;"]);const productSelectionIcon=function ProductSelectionIcon(){return react.createElement(productSelectionIcon_StyledIcon,{title:(0,i18n.__)("Product selection","web-stories")})};var audio_stickers=__webpack_require__("./packages/design-system/src/icons/audio_stickers.svg");const audioStickerSelectionIcon=function AudioStickerSelectionIcon(){return react.createElement(audio_stickers.A,{title:(0,i18n.__)("Audio Sticker selection","web-stories")})},STYLE_TAB_IDS=new Set([SELECTION.id,LINK.id,ANIMATION.id]);const styleProvider=function StyleProvider({children}){const{selectedElements}=(0,app_story.P3)((({state})=>({selectedElements:state.selectedElements}))),{tab:highlightedTab}=(0,highlights.N)((state=>({tab:state.section})));(0,react_src.vJ)((()=>{STYLE_TAB_IDS.has(highlightedTab)&&setTab(highlightedTab)}),[highlightedTab]);const styleRef=(0,react_src.li)(null),[tab,setTab]=(0,react_src.J0)(SELECTION.id),selectionPaneRef=(0,react_src.li)(null),linkPaneRef=(0,react_src.li)(null),animationPaneRef=(0,react_src.li)(null),tabRefs=(0,react_src.Kr)((()=>({[SELECTION.id]:selectionPaneRef,[LINK.id]:linkPaneRef,[ANIMATION.id]:animationPaneRef})),[]);let selectionIcon=multiSelectionIcon;const icons=[...new Set(selectedElements.map((({type})=>type)))];1===icons.length?("text"===icons[0]&&(selectionIcon=textSelectionIcon),("image"===icons[0]||selectedElements[0].isBackground)&&(selectionIcon=imageSelectionIcon),"video"===icons[0]&&(selectionIcon=videoSelectionIcon),"shape"!==icons[0]&&"sticker"!==icons[0]||(selectionIcon=shapeSelectionIcon),"product"===icons[0]&&(selectionIcon=productSelectionIcon),"audioSticker"===icons[0]&&(selectionIcon=audioStickerSelectionIcon)):selectionIcon=multiSelectionIcon;const state={state:{tab},refs:{styleRef,tabRefs},actions:{setTab},data:{tabs:[{...SELECTION,icon:selectionIcon}]}},isBackgroundSelected=selectedElements[0]?.isBackground||selectedElements[0]?.isDefaultBackground,hasProductsSelected=selectedElements.some((({type})=>"product"===type)),hasAudioStickersSelected=selectedElements.some((({type})=>"audioSticker"===type));return isBackgroundSelected||hasProductsSelected||hasAudioStickersSelected||state.data.tabs.push(LINK),selectedElements[0]?.isDefaultBackground||hasProductsSelected||hasAudioStickersSelected||state.data.tabs.push(ANIMATION),(0,react_src.vJ)((()=>{state.data.tabs.find((t=>t.id===tab))||setTab(SELECTION.id)}),[state.data.tabs,tab]),react.createElement(style_context.Provider,{value:state},children)};const style_useStyle=function useStyle(selector){return(0,react_src.i7)(style_context,selector??react_src.D_)};var form_context=__webpack_require__("./packages/story-editor/src/components/form/context.js");const utils_useHandlers=function useHandlers(){const handlersRef=(0,react_src.li)([]),registerHandler=(0,react_src.hb)((handler=>{const handlerList=handlersRef.current;return handlerList.push(handler),()=>{handlerList.splice(handlerList.indexOf(handler),1)}}),[]);return(0,react_src.Kr)((()=>[handlersRef.current,registerHandler]),[registerHandler])};function designPanel_extends(){return designPanel_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},designPanel_extends.apply(null,arguments)}const Form=styled_components_browser_esm.Ay.form.withConfig({displayName:"designPanel__Form",componentId:"sc-14jgzfz-0"})(["padding:0;margin:0;"]),AutoSubmitButton=styled_components_browser_esm.Ay.input.attrs({type:"submit"}).withConfig({displayName:"designPanel__AutoSubmitButton",componentId:"sc-14jgzfz-1"})(["display:none;"]);const designPanel=function DesignPanel({panelType,selectedElements,selectedElementIds,onSetProperties,registerSubmitHandler,...rest}){const formRef=(0,react_src.li)(null),[presubmitHandlers,registerPresubmitHandler]=utils_useHandlers(),formContext=(0,react_src.Kr)((()=>({isMultiple:selectedElements.length>1,registerPresubmitHandler})),[selectedElements,registerPresubmitHandler]),[elementUpdates,setElementUpdates]=(0,react_src.J0)({}),updatedElements=(0,react_src.Kr)((()=>selectedElements.map((element=>({...element,...elementUpdates[element.id]})))),[selectedElements,elementUpdates]),internalSubmit=(0,react_src.hb)((updates=>{if(0===Object.keys(updates).length)return;const commitUpdates=updates;presubmitHandlers.length>0&&selectedElements.forEach((element=>{const precommitUpdate=(0,updateProperties.A)(element,updates[element.id],!0);let commitUpdate=precommitUpdate;presubmitHandlers.forEach((handler=>{const handlerUpdate=handler({...element,...commitUpdate},precommitUpdate,element);commitUpdate={...commitUpdate,...handlerUpdate}})),commitUpdates[element.id]=commitUpdate})),onSetProperties((element=>commitUpdates[element.id]))}),[presubmitHandlers,selectedElements,onSetProperties]),onSubmit=registerSubmitHandler((0,react_src.hb)((evt=>{evt&&(evt.preventDefault(),setElementUpdates({})),internalSubmit(elementUpdates)}),[internalSubmit,elementUpdates])),internalSubmitRef=(0,react_src.li)();(0,react_src.vJ)((()=>{internalSubmitRef.current=internalSubmit}),[internalSubmit]);const elementUpdatesRef=(0,react_src.li)();(0,react_src.vJ)((()=>{elementUpdatesRef.current=elementUpdates}),[elementUpdates]),(0,react_src.vJ)((()=>{setElementUpdates({}),internalSubmitRef.current(elementUpdatesRef.current)}),[]);const submit=(0,react_src.hb)((()=>{setTimeout((()=>{const form=formRef.current;form&&form.dispatchEvent(new window.Event("submit",{cancelable:!0,bubbles:!0}))}))}),[]),pushUpdate=(0,react_src.hb)(((update,submitArg=!1)=>{setElementUpdates((prevUpdates=>{const newUpdates={};return selectedElements.forEach((element=>{const prevUpdatedElement={...element,...prevUpdates[element.id]},newUpdate=(0,updateProperties.A)(prevUpdatedElement,update,!1);newUpdates[element.id]={...prevUpdates[element.id],...newUpdate}})),newUpdates})),submitArg&&submit()}),[selectedElements,submit]),pushUpdateForObject=(0,react_src.hb)(((propertyName,update,defaultObject,submitArg=!1)=>{pushUpdate((prevUpdatedElement=>{const prevObject=prevUpdatedElement[propertyName]||defaultObject;return{[propertyName]:update?{...prevObject,...(0,updateProperties.A)(prevObject,update,!1)}:null}}),submitArg)}),[pushUpdate]),Panel=panelType;return react.createElement(Form,{ref:formRef,onSubmit},react.createElement(AutoSubmitButton,null),react.createElement(form_context.A.Provider,{value:formContext},react.createElement(Panel,designPanel_extends({selectedElements:updatedElements,submittedSelectedElements:selectedElements,pushUpdate,pushUpdateForObject,submit},rest))))};var panelTypes=__webpack_require__("./packages/design-system/src/utils/panelTypes.ts"),range=__webpack_require__("./packages/units/src/range.ts"),exclamation_triangle=__webpack_require__("./packages/design-system/src/icons/exclamation_triangle.svg"),checklist_constants=__webpack_require__("./packages/story-editor/src/components/checklist/constants.js");const WarningContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"warning__WarningContainer",componentId:"sc-16blgsz-0"})(["display:flex;gap:8px;margin:14px auto;border:1px solid ",";border-radius:",";padding:8px;"],(({theme})=>theme.colors.border.defaultHover),(({theme})=>theme.borders.radius.small)),WarningIcon=(0,styled_components_browser_esm.Ay)(exclamation_triangle.A).withConfig({displayName:"warning__WarningIcon",componentId:"sc-16blgsz-1"})(["width:32px;height:100%;color:",";"],(({theme})=>theme.colors.status.warning)),warning_Message=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"warning__Message",componentId:"sc-16blgsz-2"})(["max-width:calc(100% - 40px);"]);const warning=function Warning({message}){const speak=(0,useLiveRegion.A)("assertive");return(0,react_src.vJ)((()=>{speak(message)}),[message,speak]),react.createElement(WarningContainer,{"data-testid":"warningContainer"},react.createElement(WarningIcon,{title:checklist_constants.br.lowContrast.warningIcon}),react.createElement(warning_Message,null,message))};var numericInput=__webpack_require__("./packages/design-system/src/components/input/numericInput.tsx"),dropdown=__webpack_require__("./packages/design-system/src/components/dropDown/dropdown.tsx"),arrow_up=__webpack_require__("./packages/design-system/src/icons/arrow_up.svg"),useRadioNavigation=__webpack_require__("./packages/story-editor/src/components/form/shared/useRadioNavigation.js");function directionRadioInput_extends(){return directionRadioInput_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},directionRadioInput_extends.apply(null,arguments)}const directionRadioInput_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"directionRadioInput__StyledButton",componentId:"sc-1g0wivz-0"})(["z-index:0;width:28px;height:28px;"," svg{transform-origin:50% 50%;transform:",";}"],(({selected,disabled,theme})=>selected&&!disabled&&(0,styled_components_browser_esm.AH)(["background-color:",";"],theme.colors.interactiveBg.secondaryPress)),(({direction})=>{switch(direction){case animation_src.m3.RightToLeft:return"rotate(270deg)";case animation_src.m3.TopToBottom:return"rotate(180deg)";case animation_src.m3.LeftToRight:return"rotate(90deg)";case animation_src.pL.CounterClockwise:return"rotateX(180deg) rotateZ(90deg)";case animation_src.ON.ScaleOutBottomLeft:return"rotate(-135deg)";case animation_src.ON.ScaleInTopLeft:return"rotate(135deg)";case animation_src.ON.ScaleOutTopRight:return"rotate(-315deg)";case animation_src.ON.ScaleInBottomRight:return"rotate(315deg)";default:return"rotate(0deg)"}})),DirectionIndicator=(0,styled_components_browser_esm.Ay)((({className,direction,...rest})=>react.createElement(directionRadioInput_StyledButton,directionRadioInput_extends({variant:constants.Ak.Square,type:constants.VQ.Tertiary,size:constants.Mp.Small,className,direction},rest),[...Object.values(animation_src.m3),...Object.values(animation_src.ON)].includes(direction)&&react.createElement(arrow_up.A,null)))).withConfig({displayName:"directionRadioInput__DirectionIndicator",componentId:"sc-1g0wivz-1"})([""]),Fieldset=styled_components_browser_esm.Ay.fieldset.withConfig({displayName:"directionRadioInput__Fieldset",componentId:"sc-1g0wivz-2"})(["position:relative;height:91px;width:88px;margin-top:1px;border-right:1px solid ",";"],(({theme})=>theme.colors.border.defaultNormal)),Figure=styled_components_browser_esm.Ay.div.withConfig({displayName:"directionRadioInput__Figure",componentId:"sc-1g0wivz-3"})(["position:absolute;top:50%;left:50%;width:8px;height:8px;background-color:",";border-radius:2px;transform:translate(-50%,-50%);"],(({theme})=>theme.colors.fg.primary)),directionRadioInput_Label=styled_components_browser_esm.Ay.label.withConfig({displayName:"directionRadioInput__Label",componentId:"sc-1g0wivz-4"})(["position:absolute;cursor:",";",""],(({disabled})=>disabled?"default":"pointer"),(({direction})=>{switch(direction){case animation_src.m3.RightToLeft:return(0,styled_components_browser_esm.AH)(["top:50%;right:","px;transform:translateY(-50%);"],3);case animation_src.m3.TopToBottom:return(0,styled_components_browser_esm.AH)(["top:","px;left:50%;transform:translateX(-50%);"],3);case animation_src.m3.LeftToRight:return(0,styled_components_browser_esm.AH)(["top:50%;left:","px;transform:translateY(-50%);"],3);case animation_src.pL.CounterClockwise:return(0,styled_components_browser_esm.AH)(["bottom:","px;right:","px;transform:translate(-10%,-10%);"],3,3);case animation_src.ON.ScaleOutBottomLeft:return(0,styled_components_browser_esm.AH)(["bottom:","px;left:","px;"],3,3);case animation_src.ON.ScaleInTopLeft:return(0,styled_components_browser_esm.AH)(["top:","px;left:","px;"],3,3);case animation_src.ON.ScaleOutTopRight:return(0,styled_components_browser_esm.AH)(["top:","px;right:","px;"],3,3);case animation_src.ON.ScaleInBottomRight:return(0,styled_components_browser_esm.AH)(["bottom:","px;right:","px;"],3,3);default:return(0,styled_components_browser_esm.AH)(["bottom:","px;left:50%;transform:translateX(-50%);"],3)}})),HiddenLegend=styled_components_browser_esm.Ay.legend.withConfig({displayName:"directionRadioInput__HiddenLegend",componentId:"sc-1g0wivz-5"})(["position:absolute;opacity:0;clip-path:polygon(0 0);cursor:pointer;"]),RadioGroup=styled_components_browser_esm.Ay.div.withConfig({displayName:"directionRadioInput__RadioGroup",componentId:"sc-1g0wivz-6"})(["position:absolute;top:0;right:0;bottom:0;left:0;"]),translations={[animation_src.m3.RightToLeft]:(0,i18n._x)("right to left","animation direction","web-stories"),[animation_src.m3.LeftToRight]:(0,i18n._x)("left to right","animation direction","web-stories"),[animation_src.m3.TopToBottom]:(0,i18n._x)("top to bottom","animation direction","web-stories"),[animation_src.m3.BottomToTop]:(0,i18n._x)("bottom to top","animation direction","web-stories"),[animation_src.pL.Clockwise]:(0,i18n._x)("clockwise","rotation direction","web-stories"),[animation_src.pL.CounterClockwise]:(0,i18n._x)("counterclockwise","rotation direction","web-stories"),[animation_src.ON.ScaleIn]:(0,i18n._x)("scale in","scale direction","web-stories"),[animation_src.ON.ScaleOut]:(0,i18n._x)("scale out","scale direction","web-stories")},valueForInternalValue=value=>{switch(value){case animation_src.ON.ScaleInTopLeft:case animation_src.ON.ScaleInBottomRight:return animation_src.ON.ScaleIn;case animation_src.ON.ScaleOutBottomLeft:case animation_src.ON.ScaleOutTopRight:return animation_src.ON.ScaleOut;default:return value}},isInternalScaleDirection=value=>[...animation_src.eC.IN,...animation_src.eC.OUT].includes(value),splitCamelCase=(camelCase="")=>camelCase?.replace(/([a-z])([A-Z])/g,"$1 $2")?.toLocaleLowerCase()?.split(" ")||[],getPrefixFromCamelCase=(camelCase="")=>splitCamelCase(camelCase)?.[0],getPostfixFromCamelCase=(camelCase="")=>{const split=splitCamelCase(camelCase);return split[split.length-1]},STANDARD_NAV_ORDER=[animation_src.m3.TopToBottom,animation_src.m3.RightToLeft,animation_src.m3.BottomToTop,animation_src.m3.LeftToRight],SCALE_NAV_ORDER=[animation_src.ON.ScaleInTopLeft,animation_src.ON.ScaleOutTopRight,animation_src.ON.ScaleInBottomRight,animation_src.ON.ScaleOutBottomLeft],sortInputOrderForKeyboardUsability=(directions,directionOrder,isRTL)=>{const referenceOrder=isRTL?directionOrder.reverse():directionOrder;return directions.sort(((a,b)=>referenceOrder.indexOf(a)-referenceOrder.indexOf(b)))},DirectionRadioInput=({value,directions=[],onChange,disabled=[],tooltip})=>{const inputRef=(0,react_src.li)(),{isRTL}=(0,app_config.UK)(),flattenedDirections=(0,react_src.Kr)((()=>{const dir=[];if(directions.includes(animation_src.ON.ScaleOut)||directions.includes(animation_src.ON.ScaleIn)){const scaleDir=[];directions.includes(animation_src.ON.ScaleOut)&&scaleDir.push(...animation_src.eC.OUT),directions.includes(animation_src.ON.ScaleIn)&&scaleDir.push(...animation_src.eC.IN),dir.push(...sortInputOrderForKeyboardUsability(scaleDir,SCALE_NAV_ORDER,isRTL))}else dir.push(...sortInputOrderForKeyboardUsability(directions,STANDARD_NAV_ORDER,isRTL));return dir}),[directions,isRTL]);return(0,useRadioNavigation.A)(inputRef),react.createElement(Fieldset,null,react.createElement(Figure,null),react.createElement(HiddenLegend,null,(0,i18n.__)("Which Direction?","web-stories")),react.createElement(RadioGroup,{ref:inputRef},flattenedDirections.map((direction=>{const isDisabled=disabled?.includes(valueForInternalValue(direction));return react.createElement(directionRadioInput_Label,{key:direction,"aria-label":translations[direction],htmlFor:direction,direction,disabled:isDisabled},react.createElement(components_tooltip.A,{title:isDisabled?tooltip:"",placement:isInternalScaleDirection(direction)?getPostfixFromCamelCase(direction):getPrefixFromCamelCase(direction)},react.createElement(DirectionIndicator,{direction,selected:value===direction||direction?.includes(value),disabled:isDisabled,onClick:()=>onChange(valueForInternalValue(direction))})))}))))},outerGridBordersCss=(0,styled_components_browser_esm.AH)(["border-radius:0;border-color:"," transparent transparent transparent;"],(({theme})=>theme.colors.border.defaultNormal)),StyledInput=(0,styled_components_browser_esm.Ay)(numericInput.A).withConfig({displayName:"effectInput__StyledInput",componentId:"sc-1gnssiy-0"})(["height:","px;div{height:calc(100% + 1px);"," &:focus-within{border-radius:",";}}"],45,outerGridBordersCss,(({theme})=>theme.borders.radius.small)),StyledDropDown=(0,styled_components_browser_esm.Ay)(dropdown.A).withConfig({displayName:"effectInput__StyledDropDown",componentId:"sc-1gnssiy-1"})(["button{height:46px;"," &:hover{","}&:focus-visible{border-radius:",";}}"],outerGridBordersCss,outerGridBordersCss,(({theme})=>theme.borders.radius.small)),allAnimations=[...Object.values(animation_src.m3),...Object.values(animation_src.pL),...Object.values(animation_src.ON)];const effectInput=function EffectInput({effectProps,effectConfig,field,onChange,disabledOptions,disabled=!1,tooltip}){const directionControlOnChange=(0,react_src.hb)((value=>onChange(value,!0)),[onChange]),_disabledOptions=(0,react_src.Kr)((()=>disabled?allAnimations:disabledOptions),[disabledOptions,disabled]),valueForField=effectConfig[field]??effectProps[field].defaultValue,isFloat=effectProps[field].type===animation_src.PU.Float;switch(effectProps[field].type){case animation_src.PU.Dropdown:return react.createElement(StyledDropDown,{options:(effectProps[field].values||[]).map((({name,...rest})=>({...rest,label:name,disabled:disabled||disabledOptions.includes(rest.value)}))),placeholder:(0,i18n.__)("Select a value","web-stories"),ariaLabel:(0,i18n.__)("Select effect value","web-stories"),isKeepMenuOpenOnSelection:!1,selectedValue:valueForField,onMenuItemClick:evt=>onChange(evt.target.value,!0),disabled});case animation_src.PU.DirectionPicker:return react.createElement(DirectionRadioInput,{value:valueForField,directions:effectProps[field].values,onChange:directionControlOnChange,disabled:_disabledOptions,tooltip});default:return react.createElement(StyledInput,{"aria-label":effectProps[field].label,suffix:effectProps[field].label,unit:effectProps[field].unit,value:valueForField,min:0,onChange:evt=>onChange(isFloat?Number.parseFloat(evt.target.value):Number.parseInt(evt.target.value),!0),isFloat,containerStyleOverride:shared_styles.t,disabled})}};function getEffectDirection(effect={}){return(!effect.zoomDirection||!effect.panDir)&&(effect.zoomDirection?effect.zoomDirection:effect.scaleDirection?effect.scaleDirection:effect.flyInDir?effect.flyInDir:effect.rotateInDir?effect.rotateInDir:effect.whooshInDir?effect.whooshInDir:!!effect.panDir&&effect.panDir)}const AnimationGrid=styled_components_browser_esm.Ay.div.withConfig({displayName:"effectPanel__AnimationGrid",componentId:"sc-s89nzp-0"})(["display:grid;grid-template-columns:auto auto;"]),AnimationGridField=styled_components_browser_esm.Ay.div.withConfig({displayName:"effectPanel__AnimationGridField",componentId:"sc-s89nzp-1"})((({isRotationComponent,isHalfWidthField})=>[{gridColumn:"1/3"},isRotationComponent&&{gridRow:"1/3",gridColumn:"auto"},isHalfWidthField&&{gridColumn:"auto"}]));const effectPanel=function EffectPanel({animation:{id,type,...config},onChange,disabledTypeOptionsMap,disabled=!1}){const fields=(0,animation_src.$G)(type),handleInputChange=(0,react_src.hb)(((updates,submitArg)=>{onChange({id,type,...config,...updates},submitArg)}),[id,type,config,onChange]),containsVisualPicker=(0,react_src.Kr)((()=>Object.keys(fields).reduce(((memo,current)=>fields[current].type===animation_src.PU.DirectionPicker||fields[current].type===animation_src.PU.RotationPicker||memo),!1)),[fields]),content=Object.keys(fields).map(((field,index)=>react.createElement(AnimationGridField,{key:field,isRotationComponent:containsVisualPicker&&0===index,isHalfWidthField:containsVisualPicker&&(1===index||2===index)},react.createElement(effectInput,{effectProps:fields,effectConfig:config,field,onChange:(value,submitArg)=>{const fittedValue="number"==typeof value?Math.max(value,0):value;handleInputChange({[field]:fittedValue},submitArg)},disabledOptions:disabledTypeOptionsMap[type]?.options||[],disabled,tooltip:disabledTypeOptionsMap[type]?.tooltip}))));return react.createElement(AnimationGrid,null,content)},BaseAnimationCell=styled_components_browser_esm.Ay.div.withConfig({displayName:"effectChooserElements__BaseAnimationCell",componentId:"sc-13qk6mh-0"})(["display:none;transform-origin:50% 50%;"]),dropKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateY(-100%);animation-timing-function:cubic-bezier(.75,.05,.86,.08);}15%{transform:translateY(0%);animation-timing-function:cubic-bezier(.22,.61,.35,1);}26%{transform:translateY(-62%);animation-timing-function:cubic-bezier(.75,.05,.86,.08);}37%{transform:translateY(-0%);animation-timing-function:cubic-bezier(.22,.61,.35,1);}41.5%{transform:translateY(-30%);animation-timing-function:cubic-bezier(.75,.05,.86,.08);}50%,100%{transform:translateY(0%);animation-timing-function:cubic-bezier(.22,.61,.35,1);}"]),DropAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__DropAnimation",componentId:"sc-13qk6mh-1"})(["animation:"," 3.2s linear infinite;"],dropKeyframes),fadeInKeyframes=(0,styled_components_browser_esm.i7)(["0%{opacity:0;}50%,100%{opacity:1;}"]),FadeInAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FadeInAnimation",componentId:"sc-13qk6mh-2"})(["animation:"," 2.5s linear infinite;"],fadeInKeyframes),flyInLeftKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(-100%);}50%,100%{transform:translateX(0%);}"]),FlyInLeftAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInLeftAnimation",componentId:"sc-13qk6mh-3"})(["animation:"," 2s linear infinite;"],flyInLeftKeyframes),flyInRightKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(100%);}50%,100%{transform:translateX(0%);}"]),FlyInRightAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInRightAnimation",componentId:"sc-13qk6mh-4"})(["animation:"," 2s linear infinite;"],flyInRightKeyframes),flyInTopKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateY(-100%);}50%,100%{transform:translateY(0%);}"]),FlyInTopAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInTopAnimation",componentId:"sc-13qk6mh-5"})(["animation:"," 2s linear infinite;"],flyInTopKeyframes),flyInBottomKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateY(100%);}50%,100%{transform:translateY(0%);}"]),FlyInBottomAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInBottomAnimation",componentId:"sc-13qk6mh-6"})(["animation:"," 2s linear infinite;"],flyInBottomKeyframes),pulseKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:scale(1);}12.5%{transform:scale(0.75);}37.5%{transform:scale(1.25);}50%,100%{transform:scale(1);}"]),PulseAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PulseAnimation",componentId:"sc-13qk6mh-7"})(["animation:"," 2s cubic-bezier(0.4,0,0.2,1) infinite;"],pulseKeyframes),rotateInLeftKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(-100%) rotate(-360deg);}50%,100%{transform:translateX(0%);}"]),RotateInLeftAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__RotateInLeftAnimation",componentId:"sc-13qk6mh-8"})(["animation:"," 2s linear infinite;"],rotateInLeftKeyframes),rotateInRightKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(100%) rotate(360deg);}50%,100%{transform:translateX(0%);}"]),RotateInRightAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__RotateInRightAnimation",componentId:"sc-13qk6mh-9"})(["animation:"," 2s linear infinite;"],rotateInRightKeyframes),twirlInKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:rotate(-540deg) scale(0.1);opacity:0;}50%,100%{transform:none;opacity:1;}"]),TwirlInAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__TwirlInAnimation",componentId:"sc-13qk6mh-10"})(["animation:"," 2s cubic-bezier(0.2,0.75,0.4,1) infinite;"],twirlInKeyframes),whooshInLeftKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(-100%);opacity:0;}50%,100%{transform:translateX(0%);opacity:1;}"]),WhooshInLeftAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__WhooshInLeftAnimation",componentId:"sc-13qk6mh-11"})(["animation:"," 2s cubic-bezier(0,0,0.2,1) infinite;"],whooshInLeftKeyframes),whooshInRightKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(100%);opacity:0;}50%,100%{transform:translateX(0%);opacity:1;}"]),WhooshInRightAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__WhooshInRightAnimation",componentId:"sc-13qk6mh-12"})(["animation:"," 2s cubic-bezier(0,0,0.2,1) infinite;"],whooshInRightKeyframes),panLeftKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(-100%) scale(1.5);}50%,100%{transform:translateX(200%) scale(1.5);}"]),PanLeftAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanLeftAnimation",componentId:"sc-13qk6mh-13"})(["animation:"," 3s linear infinite;"],panLeftKeyframes),panRightKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateX(100%) scale(1.5);}50%,100%{transform:translateX(-200%) scale(1.5);}"]),PanRightAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanRightAnimation",componentId:"sc-13qk6mh-14"})(["animation:"," 3s linear infinite;"],panRightKeyframes),panTopKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateY(-100%) scale(1.5);}50%,100%{transform:translateY(200%) scale(1.5);}"]),PanTopAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanTopAnimation",componentId:"sc-13qk6mh-15"})(["animation:"," 3s linear infinite;"],panTopKeyframes),panBottomKeyframes=(0,styled_components_browser_esm.i7)(["0%{transform:translateY(100%) scale(1.5);}50%,100%{transform:translateY(-200%) scale(1.5);}"]),PanBottomAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanBottomAnimation",componentId:"sc-13qk6mh-16"})(["animation:"," 3s linear infinite;"],panBottomKeyframes),zoomInKeyframes=(0,styled_components_browser_esm.i7)(["0%{opacity:0;transform:scale(0);}50%,100%{opacity:1;transform:scale(1);}"]),ZoomInAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__ZoomInAnimation",componentId:"sc-13qk6mh-17"})(["animation:"," 2s linear infinite;"],zoomInKeyframes),zoomOutKeyframes=(0,styled_components_browser_esm.i7)(["0%{opacity:0;transform:scale(2);}50%,100%{opacity:1;transform:scale(1);}"]),ZoomOutAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__ZoomOutAnimation",componentId:"sc-13qk6mh-18"})(["animation:"," 2s linear infinite;"],zoomOutKeyframes),panAndZoomKeyframes=(0,styled_components_browser_esm.i7)(["0%{opacity:0;transform:translate3d(-50%,0,0) scale(2);}50%,100%{opacity:1;transform:none;}"]),PanAndZoomAnimation=(0,styled_components_browser_esm.Ay)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanAndZoomAnimation",componentId:"sc-13qk6mh-19"})(["animation:"," 2s linear infinite;"],panAndZoomKeyframes),getDirectionalEffect=(effect,direction)=>effectValueExceptions.includes(effect)?effect:direction?`${effect} ${direction}`.trim():effect,GRID_SIZING={HALF:"half",QUARTER:"quarter"},effectValueExceptions=[animation_src.rd.PAN_AND_ZOOM.value],backgroundEffectOptions={NO_ANIMATION:{value:"none",label:(0,i18n._x)("None","animation effect","web-stories")},[getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.LeftToRight)]:{value:getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.LeftToRight),label:(0,i18n._x)("Pan Left","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Left","animation effect","web-stories")),value:animation_src.rd.PAN.value,panDirection:animation_src.m3.LeftToRight,gridSpace:GRID_SIZING.QUARTER,Effect:PanLeftAnimation,size:16}},[getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.RightToLeft)]:{value:getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.RightToLeft),label:(0,i18n._x)("Pan Right","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Right","animation effect","web-stories")),value:animation_src.rd.PAN.value,panDirection:animation_src.m3.RightToLeft,gridSpace:GRID_SIZING.QUARTER,Effect:PanRightAnimation,size:16}},[getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.BottomToTop)]:{value:getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.BottomToTop),label:(0,i18n._x)("Pan Up","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Up","animation effect","web-stories")),value:animation_src.rd.PAN.value,panDirection:animation_src.m3.BottomToTop,gridSpace:GRID_SIZING.QUARTER,Effect:PanBottomAnimation,size:16}},[getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.TopToBottom)]:{value:getDirectionalEffect(animation_src.rd.PAN.value,animation_src.m3.TopToBottom),label:(0,i18n._x)("Pan Down","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Down","animation effect","web-stories")),value:animation_src.rd.PAN.value,panDirection:animation_src.m3.TopToBottom,gridSpace:GRID_SIZING.QUARTER,Effect:PanTopAnimation,size:16}},[getDirectionalEffect(animation_src.rd.ZOOM.value,animation_src.ON.ScaleIn)]:{value:getDirectionalEffect(animation_src.rd.ZOOM.value,animation_src.ON.ScaleIn),label:(0,i18n._x)("Zoom In","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Zoom In","animation effect","web-stories")),value:animation_src.rd.ZOOM.value,zoomDirection:animation_src.ON.ScaleIn,gridSpace:GRID_SIZING.HALF,Effect:ZoomInAnimation,size:14}},[getDirectionalEffect(animation_src.rd.ZOOM.value,animation_src.ON.ScaleOut)]:{value:getDirectionalEffect(animation_src.rd.ZOOM.value,animation_src.ON.ScaleOut),label:(0,i18n._x)("Zoom Out","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Zoom Out","animation effect","web-stories")),value:animation_src.rd.ZOOM.value,zoomDirection:animation_src.ON.ScaleOut,gridSpace:GRID_SIZING.HALF,Effect:ZoomOutAnimation,size:20}},[animation_src.rd.PAN_AND_ZOOM.value]:{value:animation_src.rd.PAN_AND_ZOOM.value,label:animation_src.rd.PAN_AND_ZOOM.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.rd.PAN_AND_ZOOM.name),value:animation_src.rd.PAN_AND_ZOOM.value,zoomDirection:"dynamicPropertyValue",Effect:PanAndZoomAnimation,size:26}}},foregroundEffectOptions={NO_ANIMATION:{value:"none",label:(0,i18n._x)("None","animation effect","web-stories")},[animation_src.uw.DROP.value]:{value:animation_src.uw.DROP.value,label:animation_src.uw.DROP.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.uw.DROP.name),value:animation_src.uw.DROP.value,Effect:DropAnimation}},[animation_src.uw.FADE_IN.value]:{value:animation_src.uw.FADE_IN.value,label:animation_src.uw.FADE_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.uw.FADE_IN.name),value:animation_src.uw.FADE_IN.value,Effect:FadeInAnimation}},[getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.LeftToRight)]:{value:getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.LeftToRight),label:animation_src.uw.FLY_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Left","animation effect","web-stories")),value:animation_src.uw.FLY_IN.value,flyInDirection:animation_src.m3.LeftToRight,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInLeftAnimation,size:16}},[getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.TopToBottom)]:{value:getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.TopToBottom),label:animation_src.uw.FLY_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Top","animation effect","web-stories")),value:animation_src.uw.FLY_IN.value,flyInDirection:animation_src.m3.TopToBottom,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInTopAnimation,size:16}},[getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.BottomToTop)]:{value:getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.BottomToTop),label:animation_src.uw.FLY_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Bottom","animation effect","web-stories")),value:animation_src.uw.FLY_IN.value,flyInDirection:animation_src.m3.BottomToTop,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInBottomAnimation,size:16}},[getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.RightToLeft)]:{value:getDirectionalEffect(animation_src.uw.FLY_IN.value,animation_src.m3.RightToLeft),label:animation_src.uw.FLY_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Right","animation effect","web-stories")),value:animation_src.uw.FLY_IN.value,flyInDirection:animation_src.m3.RightToLeft,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInRightAnimation,size:16}},[animation_src.uw.PULSE.value]:{value:animation_src.uw.PULSE.value,label:animation_src.uw.PULSE.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.uw.PULSE.name),value:animation_src.uw.PULSE.value,Effect:PulseAnimation}},[getDirectionalEffect(animation_src.uw.ROTATE_IN.value,animation_src.m3.LeftToRight)]:{value:getDirectionalEffect(animation_src.uw.ROTATE_IN.value,animation_src.m3.LeftToRight),label:(0,i18n._x)("Rotate","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Rotate In from Left","animation effect","web-stories")),value:animation_src.uw.ROTATE_IN.value,rotateInDirection:animation_src.m3.LeftToRight,gridSpace:GRID_SIZING.HALF,Effect:RotateInLeftAnimation,size:18}},[getDirectionalEffect(animation_src.uw.ROTATE_IN.value,animation_src.m3.RightToLeft)]:{value:getDirectionalEffect(animation_src.uw.ROTATE_IN.value,animation_src.m3.RightToLeft),label:(0,i18n._x)("Rotate","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Rotate In from Right","animation effect","web-stories")),value:animation_src.uw.ROTATE_IN.value,rotateInDirection:animation_src.m3.RightToLeft,gridSpace:GRID_SIZING.HALF,Effect:RotateInRightAnimation,size:18}},[animation_src.uw.TWIRL_IN.value]:{value:animation_src.uw.TWIRL_IN.value,label:animation_src.uw.TWIRL_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.uw.TWIRL_IN.name),value:animation_src.uw.TWIRL_IN.value,Effect:TwirlInAnimation,size:26}},[getDirectionalEffect(animation_src.uw.WHOOSH_IN.value,animation_src.m3.LeftToRight)]:{value:getDirectionalEffect(animation_src.uw.WHOOSH_IN.value,animation_src.m3.LeftToRight),label:animation_src.uw.WHOOSH_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Whoosh In from Left","animation effect","web-stories")),value:animation_src.uw.WHOOSH_IN.value,whooshInDirection:animation_src.m3.LeftToRight,gridSpace:GRID_SIZING.HALF,Effect:WhooshInLeftAnimation,size:20}},[getDirectionalEffect(animation_src.uw.WHOOSH_IN.value,animation_src.m3.RightToLeft)]:{value:getDirectionalEffect(animation_src.uw.WHOOSH_IN.value,animation_src.m3.RightToLeft),label:animation_src.uw.WHOOSH_IN.name,animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Whoosh In from Right","animation effect","web-stories")),value:animation_src.uw.WHOOSH_IN.value,whooshInDirection:animation_src.m3.RightToLeft,gridSpace:GRID_SIZING.HALF,Effect:WhooshInRightAnimation,size:20}},[getDirectionalEffect(animation_src.uw.ZOOM.value,animation_src.ON.ScaleIn)]:{value:getDirectionalEffect(animation_src.uw.ZOOM.value,animation_src.ON.ScaleIn),label:(0,i18n._x)("Scale In","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Scale In","animation effect","web-stories")),value:animation_src.uw.ZOOM.value,scaleDirection:animation_src.ON.ScaleIn,gridSpace:GRID_SIZING.HALF,Effect:ZoomInAnimation,size:14}},[getDirectionalEffect(animation_src.uw.ZOOM.value,animation_src.ON.ScaleOut)]:{value:getDirectionalEffect(animation_src.uw.ZOOM.value,animation_src.ON.ScaleOut),label:(0,i18n.__)("Scale Out","web-stories"),animation:{ariaLabel:(0,sprintf.A)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Scale Out","animation effect","web-stories")),value:animation_src.uw.ZOOM.value,scaleDirection:animation_src.ON.ScaleOut,gridSpace:GRID_SIZING.HALF,Effect:ZoomOutAnimation,size:20}}},ANIMATION_OPTION_PROP_TYPE={ariaLabel:prop_types_default().string,value:prop_types_default().string.isRequired,Effect:prop_types_default().any,gridSpace:prop_types_default().oneOf(Object.values(GRID_SIZING)),size:prop_types_default().number,scaleDirection:prop_types_default().oneOf(Object.values(animation_src.ON)),panDirection:prop_types_default().oneOf(Object.values(animation_src.m3)),zoomDirection:prop_types_default().oneOf(Object.values(animation_src.ON)),flyInDirection:prop_types_default().oneOf(Object.values(animation_src.m3)),rotateInDirection:prop_types_default().oneOf(Object.values(animation_src.m3)),whooshInDirection:prop_types_default().oneOf(Object.values(animation_src.m3))},ANIMATION_DROPDOWN_OPTION_PROP_TYPE={value:prop_types_default().string.isRequired,label:prop_types_default().string.isRequired,animation:prop_types_default().shape(ANIMATION_OPTION_PROP_TYPE)},utils_getDisabledBackgroundEffects=(prop_types_default().oneOf([...Object.values(animation_src.m3),...Object.values(animation_src.ON),!1]),(backgroundEffectOptions,disabledTypeOptionsMap)=>{const disabledDirectionalEffects=Object.entries(disabledTypeOptionsMap).filter((([effect])=>-1===effectValueExceptions.indexOf(effect))).map((([effect,val])=>[effect,val.options])).reduce(((directionalEffects,[effect,directions])=>[...directionalEffects,...(directions||[]).map((dir=>getDirectionalEffect(effect,dir)))]),[]);return Object.keys(backgroundEffectOptions).filter((directionalEffect=>disabledDirectionalEffects.includes(directionalEffect)))}),utils_hasDynamicProperty=animation=>Object.values(animation).includes("dynamicPropertyValue"),utils_updateDynamicProps=({animation,disabledOptions=[]})=>{const panDirection=animation.panDirection&&!disabledOptions.includes(animation.panDirection)?animation.panDirection:Object.values(animation_src.m3).filter((direction=>!disabledOptions.includes(direction)))?.[0]||void 0;return animation.value===animation_src.rd.PAN_AND_ZOOM.value?{...animation,zoomDirection:disabledOptions.includes(animation_src.ON.ScaleIn)?animation_src.ON.ScaleOut:animation_src.ON.ScaleIn,panDirection}:animation},utils_generateDynamicProps=({animation,disabledTypeOptionsMap})=>utils_hasDynamicProperty(animation)?utils_updateDynamicProps({animation,disabledOptions:disabledTypeOptionsMap[animation.value]?.options}):animation,ContentWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"effectChooserDropdown__ContentWrapper",componentId:"sc-1d71y2l-0"})(["display:inline-block;"]),AnimationListItem=styled_components_browser_esm.Ay.li.withConfig({displayName:"effectChooserDropdown__AnimationListItem",componentId:"sc-1d71y2l-1"})(["border:none;background:",";border-radius:",";height:","px;position:relative;grid-column-start:",";overflow:hidden;font-family:'Teko',sans-serif;font-size:","px;line-height:1;color:",";text-transform:uppercase;transition:background 0.1s linear;margin:0;& > div{height:100%;display:flex;align-items:center;justify-content:center;text-align:center;}&[aria-disabled='true']{background:",";}&:hover:not([aria-disabled='true']){cursor:pointer;}&:hover:not([aria-disabled='true']),&:focus:not([aria-disabled='true']){background:",";","{display:inline-block;}","{display:none;}}"," ",";"],(({active,theme})=>active?theme.colors.interactiveBg.secondaryPress:theme.colors.interactiveBg.secondaryNormal),(({theme})=>theme.borders.radius.small),56,(({gridSpace})=>(gridSpace=>{switch(gridSpace){case GRID_SIZING.HALF:return"span 2";case GRID_SIZING.QUARTER:return"span 1";default:return"span 4"}})(gridSpace)),(({size=28})=>size),(({theme})=>theme.colors.fg.primary),(({theme})=>theme.colors.interactiveBg.disable),(({active,theme})=>active?theme.colors.interactiveBg.secondaryPress:theme.colors.interactiveBg.secondaryHover),BaseAnimationCell,ContentWrapper,(({noEffect})=>noEffect&&(0,styled_components_browser_esm.AH)(["height:36px;font-size:14px;text-transform:none;","{display:inline-block !important;}"],ContentWrapper)),shared_styles.Y),styleOverrideForAnimationEffectMenu=(0,styled_components_browser_esm.AH)(["display:inline-block;margin-top:0;padding:16px 4px 16px 16px;ul{display:grid;justify-content:center;gap:12px 4px;grid-template-columns:repeat(4,1fr);position:relative;}"]),styleOverrideForSelectButton=({theme})=>(0,styled_components_browser_esm.AH)(["margin:-1px -1px 0 -1px;width:calc(100% + 2px);border-color:transparent transparent "," transparent;height:","px;&:hover{border-color:transparent transparent "," transparent;}",""],theme.colors.border.defaultNormal,45,theme.colors.border.defaultNormal,shared_styles.Y);function dropdownItem_extends(){return dropdownItem_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},dropdownItem_extends.apply(null,arguments)}const DropDownItem=(0,react_src.Rf)((({option,...rest},ref)=>react.createElement(AnimationListItem,dropdownItem_extends({ref,"aria-label":option.animation?.ariaLabel||option.label,disabled:option.disabled,"aria-disabled":option.disabled,size:option.animation?.size,gridSpace:option.animation?.gridSpace,noEffect:!option.animation?.Effect},rest),react.createElement(components_tooltip.A,{title:option?.tooltip||""},react.createElement(ContentWrapper,null,option.label),option.animation?.Effect&&react.createElement(option.animation.Effect,null,option.label))))),dropdownItem=DropDownItem;DropDownItem.displayName="DropDownItem",DropDownItem.propTypes={option:prop_types_default().shape(ANIMATION_DROPDOWN_OPTION_PROP_TYPE)};const effectChooserDropdown=(0,react_src.Rf)((function EffectChooserDropdown({onAnimationSelected,onNoEffectSelected,isBackgroundEffects=!1,selectedEffectType,disabledTypeOptionsMap,direction,selectButtonStylesOverride,disabled=!1},ref){const selectedValue=(0,react_src.Kr)((()=>getDirectionalEffect(selectedEffectType,direction)),[selectedEffectType,direction]),disabledBackgroundEffects=(0,react_src.Kr)((()=>isBackgroundEffects&&utils_getDisabledBackgroundEffects(backgroundEffectOptions,disabledTypeOptionsMap)),[disabledTypeOptionsMap,isBackgroundEffects]),expandedPlacement=isBackgroundEffects?popup_constants.W.Bottom:popup_constants.W.Top,animationOptionsObject=isBackgroundEffects?backgroundEffectOptions:foregroundEffectOptions,availableAnimationOptions=Object.values(animationOptionsObject),assembledOptions=(0,react_src.Kr)((()=>availableAnimationOptions?.map((option=>{const isDisabled=isBackgroundEffects&&disabledBackgroundEffects.includes(option.value);return{...option,disabled:isDisabled,tooltip:isDisabled&&disabledTypeOptionsMap[option.animation?.value]?.tooltip}}))),[availableAnimationOptions,isBackgroundEffects,disabledBackgroundEffects,disabledTypeOptionsMap]),handleSelect=(0,react_src.hb)(((event,value)=>{if(event.preventDefault(),"none"===value)return void(Boolean(selectedValue)&&onNoEffectSelected());const selectedAnimation=animationOptionsObject[value]?.animation,animationWithDynamicProps=utils_generateDynamicProps({animation:selectedAnimation,disabledTypeOptionsMap});onAnimationSelected({animation:animationWithDynamicProps.value,panDir:animationWithDynamicProps?.panDirection,zoomDirection:animationWithDynamicProps?.zoomDirection,flyInDir:animationWithDynamicProps?.flyInDirection,rotateInDir:animationWithDynamicProps?.rotateInDirection,whooshInDir:animationWithDynamicProps?.whooshInDirection,scaleDirection:animationWithDynamicProps?.scaleDirection})}),[animationOptionsObject,disabledTypeOptionsMap,onAnimationSelected,selectedValue,onNoEffectSelected]),innerStyleOverrides=selectedValue&&"none"!==selectedValue?styleOverrideForSelectButton:shared_styles.Y,buttonStyleOverride=(0,styled_components_browser_esm.AH)([""," ",""],innerStyleOverrides,void 0!==selectButtonStylesOverride&&selectButtonStylesOverride);return react.createElement(dropdown.A,{ref,options:assembledOptions,placeholder:(0,i18n._x)("None","animation effect","web-stories"),selectedValue,ariaLabel:(0,i18n.__)("Animation: Effect Chooser","web-stories"),menuStylesOverride:styleOverrideForAnimationEffectMenu,renderItem:dropdownItem,onMenuItemClick:handleSelect,placement:expandedPlacement,isKeepMenuOpenOnSelection:!0,selectButtonStylesOverride:buttonStyleOverride,disabled})})),StyledRow=(0,styled_components_browser_esm.Ay)(components_form.fI).withConfig({displayName:"animation__StyledRow",componentId:"sc-1j3eshx-0"})(["margin-bottom:-1px;"]),GroupWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"animation__GroupWrapper",componentId:"sc-1j3eshx-1"})([""," margin-bottom:16px;"],(({hasAnimation,theme})=>hasAnimation&&`\n    border: 1px solid ${theme.colors.border.defaultNormal};\n    border-radius: ${theme.borders.radius.small};\n  `)),backgroundAnimationTooltip=(0,i18n.__)("The background image is too small to animate. Double click on the bg & scale the image before applying the animation.","web-stories");const animation=function AnimationPanel({selectedElements,selectedElementAnimations,pushUpdateForObject,updateAnimationState}){const isFirstPage=(0,app.P3)((({state:{currentPageNumber}})=>1===currentPageNumber)),playUpdatedAnimation=(0,react_src.li)(!1),{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.Animation],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),isBackground=1===selectedElements.length&&selectedElements[0].isBackground,updatedAnimations=(0,react_src.Kr)((()=>{const updated=selectedElements.map((element=>element.animation)).filter(Boolean);return selectedElementAnimations.map((anim=>({...updated.find((a=>a.id===anim.id))||anim}))).filter((a=>!a.delete))}),[selectedElements,selectedElementAnimations]),handlePanelChange=(0,react_src.hb)(((animation,submitArg=!1)=>{(0,react_src.bN)(animation,updatedAnimations[0])||(updateAnimationState({animationState:animation_src.TR.Reset}),pushUpdateForObject("animation",animation,null,submitArg),playUpdatedAnimation.current=!0)}),[pushUpdateForObject,updatedAnimations,updateAnimationState]),handleAddOrUpdateElementEffect=(0,react_src.hb)((({animation,...options})=>{if(!animation)return;const id=selectedElementAnimations[0]?.id||(0,v4.A)(),defaults=(0,animation_src.g9)(animation),persisted=selectedElementAnimations[0]?.type===animation?{duration:selectedElementAnimations[0]?.duration,delay:selectedElementAnimations[0]?.delay}:{};pushUpdateForObject("animation",{id,type:animation,...defaults,...persisted,...options},null,!0),playUpdatedAnimation.current=!0}),[selectedElementAnimations,pushUpdateForObject]),activeElement=document.activeElement,debouncedUpdateAnimationState=(0,react_src.YQ)((()=>{playUpdatedAnimation.current&&(updateAnimationState({animationState:animation_src.TR.PlayingSelected}),playUpdatedAnimation.current=!1)}),300);(0,react_src.vJ)(debouncedUpdateAnimationState,[selectedElementAnimations,updateAnimationState,activeElement,debouncedUpdateAnimationState]);const handleRemoveEffect=(0,react_src.hb)((()=>{pushUpdateForObject("animation",{...updatedAnimations[0],delete:!0},null,!0)}),[pushUpdateForObject,updatedAnimations]),selectedElement=selectedElements[0],disabledTypeOptionsMap=(0,react_src.Kr)((()=>{if(!selectedElement)return{};if(selectedElement.isBackground){const{isMedia}=(0,elements_src.zh)(selectedElement.type),hasOffset=isMedia?(0,animation_src.VS)(selectedElement):animation_src.kc,normalizedScale=(0,range.qB)(selectedElement.scale||0,{MIN:animation_src.UD,MAX:animation_src.oQ});return{[animation_src.rd.PAN.value]:{tooltip:backgroundAnimationTooltip,options:[!hasOffset.bottom&&animation_src.m3.TopToBottom,!hasOffset.left&&animation_src.m3.RightToLeft,!hasOffset.top&&animation_src.m3.BottomToTop,!hasOffset.right&&animation_src.m3.LeftToRight].filter(Boolean)},[animation_src.rd.ZOOM.value]:{tooltip:backgroundAnimationTooltip,options:[normalizedScale<=.01&&animation_src.ON.ScaleIn,normalizedScale>=.99&&animation_src.ON.ScaleOut].filter(Boolean)},[animation_src.rd.PAN_AND_ZOOM.value]:{tooltip:backgroundAnimationTooltip,options:[!hasOffset.bottom&&animation_src.m3.TopToBottom,!hasOffset.left&&animation_src.m3.RightToLeft,!hasOffset.top&&animation_src.m3.BottomToTop,!hasOffset.right&&animation_src.m3.LeftToRight,normalizedScale<=.01&&animation_src.ON.ScaleIn,normalizedScale>=.99&&animation_src.ON.ScaleOut].filter(Boolean)}}}return{}}),[selectedElement]),selectedEffectTitle=function getEffectName(type){return[...Object.values(animation_src.uw),...Object.values(animation_src.gb),...Object.values(animation_src.rd)].find((o=>o.value===type))?.name||""}(updatedAnimations[0]?.type);return selectedElements.length>1?null:react.createElement(_StyledSimplePanel,{name:"animation",title:(0,i18n.__)("Animation","web-stories"),onAnimationEnd:()=>resetHighlight(),isPersistable:!highlight,$_css:highlight?.showEffect&&highlights_styles.A.FLASH},react.createElement(GroupWrapper,{hasAnimation:selectedEffectTitle},react.createElement(StyledRow,null,react.createElement(effectChooserDropdown,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&node.focus()},onAnimationSelected:handleAddOrUpdateElementEffect,onNoEffectSelected:handleRemoveEffect,isBackgroundEffects:isBackground,disabledTypeOptionsMap,direction:getEffectDirection(updatedAnimations[0]),selectedEffectType:updatedAnimations[0]?.type,selectButtonStylesOverride:highlight?.focus&&highlights_styles.A.OUTLINE,disabled:isFirstPage})),updatedAnimations[0]&&react.createElement(effectPanel,{animation:updatedAnimations[0],onChange:handlePanelChange,disabledTypeOptionsMap,disabled:isFirstPage})),isFirstPage&&react.createElement(warning,{message:checklist.Bc.firstPageAnimation.animationPanel}))};var _StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"animation___StyledSimplePanel",componentId:"sc-1j3eshx-2"})(["",""],(p=>p.$_css));const stickerSize=function StickerSize({selectedElements,pushUpdate}){const stickerObj=selectedElements[0],size=stickerObj.size,type=stickerObj.sticker,{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.Style],resetHighlight:state.onFocusOut}))),onSizeChange=(0,react_src.hb)(((_,isSmall)=>{const stickerSize=isSmall?"small":"large",{width,height}=function getDimensionsForAudioSticker(type,size){let width,height;return"small"===size?(width=story_editor_src_constants.No.SMALL*story_editor_src_constants.Ti[type],height=story_editor_src_constants.No.SMALL):(width=story_editor_src_constants.No.LARGE*story_editor_src_constants.Ti[type],height=story_editor_src_constants.No.LARGE),{width,height}}(type,stickerSize);pushUpdate({width,height,size:stickerSize},!0)}),[pushUpdate,type]);return react.createElement(stickerSize_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"audioStickerSize",title:(0,i18n.__)("Size","web-stories"),isPersistable:!highlight,"aria-labelledby":null,"aria-label":(0,i18n.__)("Audio Sticker Size","web-stories"),$_css:highlight?.showEffect&&highlights_styles.A.FLASH},react.createElement(components_form.fI,null,react.createElement(components_form.dO,{groupLabel:(0,i18n.__)("Size","web-stories"),name:"audio-sticker-size-switch",value:"small"===size,onLabel:(0,i18n.__)("Small","web-stories"),offLabel:(0,i18n.__)("Large","web-stories"),onChange:onSizeChange})))};var stickerSize_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"stickerSize___StyledSimplePanel",componentId:"sc-txz5tm-0"})(["",""],(p=>p.$_css));const AudioStickerPreset={"headphone-cat":{label:(0,i18n.__)("Headphone Cat","web-stories")},"tape-player":{label:(0,i18n.__)("Tape Player","web-stories")},"loud-speaker":{label:(0,i18n.__)("Loud Speaker","web-stories")},"audio-cloud":{label:(0,i18n.__)("Audio Cloud","web-stories")}},StickerImage=styled_components_browser_esm.Ay.img`
  width: 100%;
`;const stickerType=function StickerType({selectedElements,pushUpdate}){const{cdnURL}=(0,app_config.UK)(),stickerObj=selectedElements[0],{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.Style],resetHighlight:state.onFocusOut}))),onStickerTypeChange=(0,react_src.hb)((stickerType=>{pushUpdate({sticker:stickerType},!0)}),[pushUpdate]);return react.createElement(stickerType_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"audioStickerType",title:(0,i18n.__)("Type","web-stories"),isPersistable:!highlight,"aria-labelledby":null,"aria-label":(0,i18n.__)("Audio Sticker Type","web-stories"),$_css:highlight?.showEffect&&highlights_styles.A.FLASH},react.createElement(components_form.fI,null,Object.keys(AudioStickerPreset).map((type=>{const{label}=AudioStickerPreset[type];return react.createElement(components_form.HG,{key:type,element:stickerObj,label,isToggled:type===stickerObj.sticker,onClick:()=>{onStickerTypeChange(type)},"aria-label":(0,sprintf.A)((0,i18n.__)("Sticker Type: %s","web-stories"),label)},react.createElement(StickerImage,{src:`${cdnURL}images/audio-sticker/${type}-pretap.png`,crossOrigin:"anonymous",alt:element_library_src.jD[type].label}))}))))};var stickerType_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"stickerType___StyledSimplePanel",componentId:"sc-1ys38h7-0"})(["",""],(p=>p.$_css));const AudioStickerStylePreset={none:{label:(0,i18n.__)("None","web-stories")},outline:{label:(0,i18n.__)("Outline","web-stories")},dropshadow:{label:(0,i18n.__)("Drop shadow","web-stories")}},stickerStyle_StickerImage=styled_components_browser_esm.Ay.img`
  width: 100%;
  ${({stickerStyle})=>element_library_src.i[stickerStyle]}
`;const stickerStyle=function StickerStyle({selectedElements,pushUpdate}){const{cdnURL}=(0,app_config.UK)(),stickerObj=selectedElements[0],style=stickerObj.style,type=stickerObj.sticker,{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.Style],resetHighlight:state.onFocusOut}))),onStickerStyleChange=(0,react_src.hb)((stickerStyle=>{pushUpdate({style:stickerStyle},!0)}),[pushUpdate]);return react.createElement(stickerStyle_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"audioStickerStyle",title:(0,i18n.__)("Style","web-stories"),isPersistable:!highlight,"aria-labelledby":null,"aria-label":(0,i18n.__)("Audio Sticker Style","web-stories"),$_css:highlight?.showEffect&&highlights_styles.A.FLASH},react.createElement(components_form.fI,{style:{alignItems:"flex-start"}},Object.keys(AudioStickerStylePreset).map((stickerStyle=>{const{label}=AudioStickerStylePreset[stickerStyle];return react.createElement(components_form.HG,{key:stickerStyle,element:selectedElements[0],label,isToggled:stickerStyle===style,onClick:()=>{onStickerStyleChange(stickerStyle)},"aria-label":(0,sprintf.A)((0,i18n.__)("Sticker Style: %s","web-stories"),label)},react.createElement(stickerStyle_StickerImage,{src:`${cdnURL}images/audio-sticker/${type}-pretap.png`,crossOrigin:"anonymous",alt:element_library_src.jD[type].label,stickerStyle}))}))))};var stickerStyle_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"stickerStyle___StyledSimplePanel",componentId:"sc-zhmwep-0"})(["",""],(p=>p.$_css));const audioStickerStyle=function AudioStickerStylePanel({selectedElements,pushUpdate}){return react.createElement(react.Fragment,null,react.createElement(stickerType,{selectedElements,pushUpdate}),react.createElement(stickerSize,{selectedElements,pushUpdate}),react.createElement(stickerStyle,{selectedElements,pushUpdate}))};var border_shared=__webpack_require__("./packages/story-editor/src/components/panels/design/border/shared.js"),toggleButton=__webpack_require__("./packages/design-system/src/components/button/toggleButton.tsx"),icons_border=__webpack_require__("./packages/design-system/src/icons/border.svg"),stackable=__webpack_require__("./packages/story-editor/src/components/form/stackable/index.js");function borderWidth_extends(){return borderWidth_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},borderWidth_extends.apply(null,arguments)}const BorderInputsFlexContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"borderWidth__BorderInputsFlexContainer",componentId:"sc-tay5fw-0"})(["display:flex;gap:7px;margin-bottom:16px;"]),StyledLockToggle=(0,styled_components_browser_esm.Ay)(toggleButton.m).withConfig({displayName:"borderWidth__StyledLockToggle",componentId:"sc-tay5fw-1"})(["",";"],shared_styles.Y),ToggleWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"borderWidth__ToggleWrapper",componentId:"sc-tay5fw-2"})(["padding-top:2px;"," align-self:stretch;"],(({locked})=>locked&&"\n    padding-left: 8px;\n  ")),BorderTop=(0,styled_components_browser_esm.Ay)(icons_border.A).withConfig({displayName:"borderWidth__BorderTop",componentId:"sc-tay5fw-3"})(["transform:rotate(90deg);"]),BorderBottom=(0,styled_components_browser_esm.Ay)(icons_border.A).withConfig({displayName:"borderWidth__BorderBottom",componentId:"sc-tay5fw-4"})(["transform:rotate(-90deg);"]),BorderRight=(0,styled_components_browser_esm.Ay)(icons_border.A).withConfig({displayName:"borderWidth__BorderRight",componentId:"sc-tay5fw-5"})(["transform:scaleX(-1);"]);const borderWidth=function WidthControls({selectedElements,pushUpdateForObject}){const border=(0,shared.dP)(selectedElements,"border",border_shared.$),hasMultiBorderSupport=selectedElements.every(masks_src.Fn),lockBorder=!0===border.lockedWidth||!hasMultiBorderSupport,handleChange=(0,react_src.hb)((name=>(evt,value)=>{pushUpdateForObject("border",lockBorder?{left:value,top:value,right:value,bottom:value}:{[name]:value},border_shared.$,!0)}),[pushUpdateForObject,lockBorder]),handleLockChange=(0,react_src.hb)((newBorder=>{pushUpdateForObject("border",newBorder,border_shared.$,!0)}),[pushUpdateForObject]),firstInputLabel=lockBorder?(0,i18n.__)("Border","web-stories"):(0,i18n.__)("Left border","web-stories"),getMixedValueProps=(0,react_src.hb)((value=>({isIndeterminate:story_editor_src_constants.jW===value,placeholder:story_editor_src_constants.jW===value?story_editor_src_constants.Q6:null})),[]);return react.createElement(BorderInputsFlexContainer,null,react.createElement(stackable.U,{locked:lockBorder},react.createElement(stackable.H,borderWidth_extends({value:border.left,onChange:handleChange("left"),"aria-label":firstInputLabel,suffix:!lockBorder&&react.createElement(icons_border.A,null),min:0},getMixedValueProps(border.left))),!lockBorder&&react.createElement(react.Fragment,null,react.createElement(stackable.H,borderWidth_extends({value:border.top,onChange:handleChange("top"),"aria-label":(0,i18n.__)("Top border","web-stories"),labelText:(0,i18n.__)("Top","web-stories"),suffix:react.createElement(BorderTop,null),min:0},getMixedValueProps(border.top))),react.createElement(stackable.H,borderWidth_extends({value:border.right,onChange:handleChange("right"),"aria-label":(0,i18n.__)("Right border","web-stories"),labelText:(0,i18n.__)("Right","web-stories"),suffix:react.createElement(BorderRight,null),min:0},getMixedValueProps(border.right))),react.createElement(stackable.H,borderWidth_extends({value:border.bottom,onChange:handleChange("bottom"),"aria-label":(0,i18n.__)("Bottom border","web-stories"),labelText:(0,i18n.__)("Bottom","web-stories"),suffix:react.createElement(BorderBottom,null),min:0},getMixedValueProps(border.bottom))))),hasMultiBorderSupport&&react.createElement(ToggleWrapper,{locked:lockBorder},react.createElement(components_tooltip.A,{title:(0,i18n.__)("Toggle consistent border","web-stories")},react.createElement(StyledLockToggle,{isLocked:lockBorder,onClick:()=>{let args={lockedWidth:!lockBorder};lockBorder||(args={...args,top:border.left,right:border.left,bottom:border.left}),handleLockChange(args)},"aria-label":(0,i18n.__)("Toggle consistent border","web-stories")}))))};const border=function BorderStylePanel(props){const{selectedElements,pushUpdate}=props,border=(0,shared.dP)(selectedElements,"border",border_shared.$),{color,left,top,right,bottom}=border,allSupportBorder=selectedElements.every((el=>(0,masks_src.r3)(el))),handleChange=(0,react_src.hb)(((value,name)=>pushUpdate({border:{...border,[name]:value}},!0)),[border,pushUpdate]);if(!allSupportBorder)return null;const hasMultiBorderSupport=selectedElements.every(masks_src.Fn),hasBorder=[left,top,right,bottom].some((value=>value>0));return react.createElement(panel.RV,{name:"borderStyle",title:(0,i18n.__)("Border","web-stories")},react.createElement(borderWidth,props),hasBorder&&react.createElement(components_form.fI,null,react.createElement(components_form.Q1,{value:color,onChange:value=>{handleChange(value,"color")},label:(0,i18n.__)("Border color","web-stories"),hasEyedropper:!0,allowsOpacity:hasMultiBorderSupport})))};var captionsPanelContent=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/captionsPanelContent.js");const captions_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"captions__StyledButton",componentId:"sc-17zds0n-0"})(["",";"],(({theme})=>outline.Q(theme.colors.border.focus,theme.colors.bg.secondary))),UploadButton=(0,styled_components_browser_esm.Ay)(captions_StyledButton).withConfig({displayName:"captions__UploadButton",componentId:"sc-17zds0n-1"})(["padding:12px 8px;"]);var _StyledUploadButton=(0,styled_components_browser_esm.Ay)(UploadButton).withConfig({displayName:"captions___StyledUploadButton",componentId:"sc-17zds0n-2"})(["",""],(p=>p.$_css));const MIN_MAX_ALT_TEXT={MAX:1e3};const captions=function CaptionsPanel({selectedElements,pushUpdate}){const tracks=(0,shared.Bl)(selectedElements,"tracks",[]),isIndeterminate=tracks===story_editor_src_constants.jW;(0,components_form.jm)((({resource:newResource})=>({resource:{...newResource,alt:newResource.alt?.slice(0,MIN_MAX_ALT_TEXT.MAX)}})),[]);const handleRemoveTrack=(0,react_src.hb)((idToDelete=>{let newTracks=[];if(idToDelete){const trackIndex=tracks.findIndex((({id})=>id===idToDelete));newTracks=[...tracks.slice(0,trackIndex),...tracks.slice(trackIndex+1)]}pushUpdate({tracks:newTracks},!0)}),[tracks,pushUpdate]),handleChangeTrack=(0,react_src.hb)((({src="",id,needsProxy=!1})=>{const newTrack={track:src,trackId:id,id:(0,v4.A)(),kind:"captions",srclang:"",label:"",needsProxy};pushUpdate({tracks:[newTrack]},!0)}),[pushUpdate]),{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.Captions],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),renderUploadButton=(0,react_src.hb)((open=>react.createElement(_StyledUploadButton,{onAnimationEnd:()=>resetHighlight(),ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&node.focus()},onClick:open,type:constants.VQ.Secondary,size:constants.Mp.Small,variant:constants.Ak.Rectangle,$_css:highlight?.showEffect&&highlights_styles.A.OUTLINE},(0,i18n.__)("Upload a file","web-stories"))),[resetHighlight,highlight?.focus,highlight?.showEffect]);return react.createElement(captions_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"caption",title:(0,i18n.__)("Caption and Subtitles","web-stories"),isPersistable:!highlight,$_css2:highlight?.showEffect&&highlights_styles.A.FLASH},react.createElement(captionsPanelContent.A,{isIndeterminate,tracks:isIndeterminate?[]:tracks,handleChangeTrack,handleRemoveTrack,renderUploadButton}))};var captions_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"captions___StyledSimplePanel",componentId:"sc-17zds0n-3"})(["",""],(p=>p.$_css2)),distribute_horizontal=__webpack_require__("./packages/design-system/src/icons/distribute_horizontal.svg"),distribute_vertical=__webpack_require__("./packages/design-system/src/icons/distribute_vertical.svg"),align_left=__webpack_require__("./packages/design-system/src/icons/align_left.svg"),align_center=__webpack_require__("./packages/design-system/src/icons/align_center.svg"),align_right=__webpack_require__("./packages/design-system/src/icons/align_right.svg"),align_top=__webpack_require__("./packages/design-system/src/icons/align_top.svg"),align_middle=__webpack_require__("./packages/design-system/src/icons/align_middle.svg"),align_bottom=__webpack_require__("./packages/design-system/src/icons/align_bottom.svg"),useAlignment=__webpack_require__("./packages/story-editor/src/components/panels/design/alignment/useAlignment.js");const ElementRow=styled_components_browser_esm.Ay.div.withConfig({displayName:"alignment__ElementRow",componentId:"sc-812g1l-0"})(["display:flex;flex-direction:row;justify-content:center;align-items:center;padding:16px;overflow:auto;overflow:overlay;"]),alignmentButtonIds=["distributeHorizontally","distributeVertically","alignLeft","alignCenter","alignRight","alignTop","alignMiddle","alignBottom"],AlignmentButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({variant:constants.Ak.Square,type:constants.VQ.Tertiary,size:constants.Mp.Small}).withConfig({displayName:"alignment__AlignmentButton",componentId:"sc-812g1l-1"})(["position:relative;:focus{z-index:1;}",";"],(({theme})=>outline.Q(theme.colors.border.focus,"#1d1f20"))),StyledPanel=(0,styled_components_browser_esm.Ay)(panel.Zk).withConfig({displayName:"alignment__StyledPanel",componentId:"sc-812g1l-2"})(["background-color:",";border-bottom:1px solid ",";"],(({theme})=>theme.colors.opacity.black24),(({theme})=>theme.colors.divider.secondary));const alignment=function ElementAlignmentPanel({selectedElements,pushUpdate}){const{isRTL}=(0,app.UK)(),{isDistributionEnabled,handleAlignLeft,handleAlignCenter,handleAlignRight,handleAlignTop,handleAlignMiddle,handleAlignBottom,handleHorizontalDistribution,handleVerticalDistribution}=(0,useAlignment.A)({selectedElements,updateElements:callback=>pushUpdate(callback,!0)}),ref=(0,react_src.li)(),[currentButton,setCurrentButton]=(0,react_src.J0)(null),handleNavigation=(0,react_src.hb)((direction=>()=>{const currentIndex=alignmentButtonIds.findIndex((id=>id===currentButton)),nextButtonId=alignmentButtonIds[currentIndex+direction];nextButtonId&&(setCurrentButton(nextButtonId),ref.current.querySelector(`#${nextButtonId}`).focus())}),[currentButton,setCurrentButton]),forward=isRTL?-1:1;return(0,keyboard._h)(ref,"left",(()=>handleNavigation(forward)),[handleNavigation,forward]),(0,keyboard._h)(ref,"right",(()=>handleNavigation(-forward)),[handleNavigation,forward]),react.createElement(StyledPanel,{name:"alignment",canCollapse:!1,ariaLabel:(0,i18n.__)("Alignment","web-stories")},react.createElement(ElementRow,{ref},react.createElement(components_tooltip.A,{title:(0,i18n.__)("Distribute horizontally","web-stories")},react.createElement(AlignmentButton,{disabled:!isDistributionEnabled,onClick:handleHorizontalDistribution,"aria-label":(0,i18n.__)("Distribute horizontally","web-stories"),id:alignmentButtonIds[0],onFocus:()=>setCurrentButton(alignmentButtonIds[0])},react.createElement(distribute_horizontal.A,null))),react.createElement(components_tooltip.A,{title:(0,i18n.__)("Distribute vertically","web-stories")},react.createElement(AlignmentButton,{disabled:!isDistributionEnabled,onClick:handleVerticalDistribution,"aria-label":(0,i18n.__)("Distribute vertically","web-stories"),id:alignmentButtonIds[1],onFocus:()=>setCurrentButton(alignmentButtonIds[1])},react.createElement(distribute_vertical.A,null))),react.createElement(components_tooltip.A,{title:(0,i18n.__)("Align left","web-stories")},react.createElement(AlignmentButton,{onClick:handleAlignLeft,"aria-label":(0,i18n.__)("Align left","web-stories"),id:alignmentButtonIds[2],onFocus:()=>setCurrentButton(alignmentButtonIds[2])},react.createElement(align_left.A,null))),react.createElement(components_tooltip.A,{title:(0,i18n.__)("Align center","web-stories")},react.createElement(AlignmentButton,{onClick:handleAlignCenter,"aria-label":(0,i18n.__)("Align center","web-stories"),id:alignmentButtonIds[3],onFocus:()=>setCurrentButton(alignmentButtonIds[3])},react.createElement(align_center.A,null))),react.createElement(components_tooltip.A,{title:(0,i18n.__)("Align right","web-stories")},react.createElement(AlignmentButton,{onClick:handleAlignRight,"aria-label":(0,i18n.__)("Align right","web-stories"),id:alignmentButtonIds[4],onFocus:()=>setCurrentButton(alignmentButtonIds[4])},react.createElement(align_right.A,null))),react.createElement(components_tooltip.A,{title:(0,i18n.__)("Align top","web-stories")},react.createElement(AlignmentButton,{onClick:handleAlignTop,"aria-label":(0,i18n.__)("Align top","web-stories"),id:alignmentButtonIds[5],onFocus:()=>setCurrentButton(alignmentButtonIds[5])},react.createElement(align_top.A,null))),react.createElement(components_tooltip.A,{title:(0,i18n.__)("Align vertical center","web-stories")},react.createElement(AlignmentButton,{onClick:handleAlignMiddle,"aria-label":(0,i18n.__)("Align vertical center","web-stories"),id:alignmentButtonIds[6],onFocus:()=>setCurrentButton(alignmentButtonIds[6])},react.createElement(align_middle.A,null))),react.createElement(components_tooltip.A,{title:(0,i18n.__)("Align bottom","web-stories")},react.createElement(AlignmentButton,{onClick:handleAlignBottom,"aria-label":(0,i18n.__)("Align bottom","web-stories"),id:alignmentButtonIds[7],onFocus:()=>setCurrentButton(alignmentButtonIds[7])},react.createElement(align_bottom.A,null)))))};const filter_convertOverlay=function convertOverlay(currentOverlay,currentType,newType){switch(newType){case elements_src.P8.NONE:return null;case elements_src.P8.SOLID:return function convertToSolid(currentOverlay,currentType){switch(currentType){case elements_src.P8.NONE:return{color:{r:0,g:0,b:0,a:.5}};case elements_src.P8.LINEAR:case elements_src.P8.RADIAL:{const{stops}=currentOverlay,stopsByAlpha=stops.slice().sort(((x,y)=>(y.color.a??1)-(x.color.a??1))),{color:{r,g,b}}=stopsByAlpha[0];return{color:{r,g,b,a:.5}}}default:return currentOverlay}}(currentOverlay,currentType);case elements_src.P8.LINEAR:return function convertToLinear(currentOverlay,currentType){switch(currentType){case elements_src.P8.NONE:return{type:"linear",rotation:0,stops:[{color:{r:0,g:0,b:0,a:0},position:0},{color:{r:0,g:0,b:0,a:1},position:1}],alpha:.7};case elements_src.P8.SOLID:{const{color:{r,g,b,a}}=currentOverlay;return{type:"linear",rotation:0,stops:[{color:{r,g,b,a:0},position:.4},{color:{r,g,b,a:1},position:1}],alpha:a}}case elements_src.P8.RADIAL:{const{stops,alpha}=currentOverlay;return{type:"linear",rotation:0,stops,alpha}}default:return currentOverlay}}(currentOverlay,currentType);case elements_src.P8.RADIAL:return function convertToRadial(currentOverlay,currentType){switch(currentType){case elements_src.P8.NONE:return{type:"radial",size:{w:.67,h:.67},stops:[{color:{r:0,g:0,b:0,a:0},position:0},{color:{r:0,g:0,b:0,a:1},position:1}],alpha:.7};case elements_src.P8.SOLID:{const{color:{r,g,b,a}}=currentOverlay;return{type:"radial",size:{w:.67,h:.67},stops:[{color:{r,g,b,a:0},position:0},{color:{r,g,b,a:1},position:1}],alpha:a}}case elements_src.P8.LINEAR:{const{stops,alpha}=currentOverlay;return{type:"radial",size:{w:.67,h:.67},stops,alpha}}default:return currentOverlay}}(currentOverlay,currentType);default:return currentOverlay}},OverlayPreset={[elements_src.P8.NONE]:{label:(0,i18n._x)("None","overlay","web-stories")},[elements_src.P8.SOLID]:{label:(0,i18n.__)("Tint","web-stories")},[elements_src.P8.LINEAR]:{label:(0,i18n.__)("Linear","web-stories")},[elements_src.P8.RADIAL]:{label:(0,i18n.__)("Vignette","web-stories")}};const filter=function FilterPanel({selectedElements,pushUpdate}){const overlay=(0,shared.VY)(selectedElements,"overlay"),isMultiple=overlay===story_editor_src_constants.jW,overlayType=overlay?overlay.type||elements_src.P8.SOLID:elements_src.P8.NONE,{getProxiedUrl}=(0,useCORSProxy.A)(),{isDefaultBackground}=selectedElements[0],currentPageBackgroundColor=(0,app.P3)((v=>!isDefaultBackground||v.state.currentPage?.backgroundColor)),updateOverlay=(0,react_src.hb)((value=>pushUpdate({overlay:value},!0)),[pushUpdate]),hasEyedropper=overlayType!==elements_src.P8.RADIAL&&overlayType!==elements_src.P8.LINEAR,{LayerIcon}=(0,elements_src.zh)(selectedElements[0].type);return react.createElement(panel.RV,{name:"filter",title:(0,i18n.__)("Filters","web-stories")},!isMultiple&&react.createElement(components_form.fI,null,Object.keys(OverlayPreset).map((type=>{const{label}=OverlayPreset[type];return react.createElement(components_form.HG,{key:type,element:selectedElements[0],label,isToggled:overlayType===type,onClick:()=>updateOverlay(filter_convertOverlay(overlay,overlayType,type)),filter:filter_convertOverlay(overlay,elements_src.P8.NONE,type),"aria-label":(0,sprintf.A)((0,i18n.__)("Filter: %s","web-stories"),label)},react.createElement(LayerIcon,{element:selectedElements[0],getProxiedUrl,currentPageBackgroundColor}))}))),overlayType!==elements_src.P8.NONE&&react.createElement(components_form.fI,null,react.createElement(components_form.Q1,{label:(0,i18n.__)("Color","web-stories"),value:overlay,onChange:updateOverlay,allowsGradient:!0,hasEyedropper})))},imageAccessibility_StyledText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"imageAccessibility__StyledText",componentId:"sc-147toy8-0"})(["color:",";margin-bottom:10px;"],(({theme})=>theme.colors.fg.secondary)),DEFAULT_RESOURCE={alt:null},imageAccessibility_MIN_MAX_ALT_TEXT={MAX:1e3};const imageAccessibility=function ImageAccessibilityPanel({selectedElements,pushUpdate}){const resource=(0,shared.dP)(selectedElements,"resource",DEFAULT_RESOURCE),alt=(0,shared.Bl)(selectedElements,"alt",resource.alt),{highlight,resetHighlight,cancelHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.AssistiveText],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));return react.createElement(imageAccessibility_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"imageAccessibility",title:(0,i18n.__)("Accessibility","web-stories"),isPersistable:!highlight,$_css:highlight&&highlights_styles.A.FLASH},react.createElement(imageAccessibility_StyledText,{size:types.$.Small},(0,i18n.__)("Add a brief description of the image.","web-stories")),react.createElement(components_form.fI,null,react.createElement(components_form.fs,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},placeholder:alt===story_editor_src_constants.jW?story_editor_src_constants.Q6:"",value:alt||"",onChange:evt=>pushUpdate({alt:evt?.target?.value?.trim()||null},!0),"aria-label":(0,i18n.__)("Assistive text","web-stories"),maxLength:imageAccessibility_MIN_MAX_ALT_TEXT.MAX,rows:2,isIndeterminate:alt===story_editor_src_constants.jW})))};var imageAccessibility_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"imageAccessibility___StyledSimplePanel",componentId:"sc-147toy8-1"})(["",""],(p=>p.$_css)),src_url=__webpack_require__("./packages/url/src/url.ts"),useElementsWithLinks=__webpack_require__("./packages/story-editor/src/utils/useElementsWithLinks.ts"),elementLink=__webpack_require__("./packages/story-editor/src/components/elementLink/index.js");const IconInfo=styled_components_browser_esm.Ay.div.withConfig({displayName:"link__IconInfo",componentId:"sc-niusn4-0"})(["display:flex;flex-direction:column;margin-left:20px;"]),IconText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"link__IconText",componentId:"sc-niusn4-1"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),link_Error=styled_components_browser_esm.Ay.span.withConfig({displayName:"link__Error",componentId:"sc-niusn4-2"})(["font-size:12px;line-height:16px;color:",";"],(({theme})=>theme.colors.fg.negative)),StyledSwitch=(0,styled_components_browser_esm.Ay)(components_form.dO).withConfig({displayName:"link__StyledSwitch",componentId:"sc-niusn4-3"})(["width:100%;"]);const link_link=function LinkPanel({selectedElements,pushUpdateForObject}){const{clearEditing,setDisplayLinkGuidelines,displayLinkGuidelines}=(0,app.yu)((state=>({clearEditing:state.actions.clearEditing,setDisplayLinkGuidelines:state.actions.setDisplayLinkGuidelines,displayLinkGuidelines:state.state.displayLinkGuidelines}))),{highlight,resetHighlight,cancelHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.Link],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),pages=(0,app.P3)((({state})=>state?.pages?.map((({id},index)=>({value:id,label:(0,sprintf.A)((0,i18n.__)("Page %s","web-stories"),index+1)}))).filter((({value})=>value!==state.currentPage?.id))||[])),{hasElementsInAttachmentArea}=(0,useElementsWithLinks.A)(),defaultLink=(0,react_src.Kr)((()=>(0,elementLink.d)({icon:null,desc:null})),[]),linkRaw=(0,shared.dP)(selectedElements,"link",defaultLink),link=(0,elementLink.d)(linkRaw),{url="",desc="",icon,rel=[],type:linkType=elements_src.J.Regular,pageId=null}=link,[fetchingMetadata,setFetchingMetadata]=(0,react_src.J0)(!1),[isLinkFocused,setIsLinkFocused]=(0,react_src.J0)(!1),{actions:{getLinkMetadata}}=(0,app.M1)(),{getProxiedUrl,checkResourceAccess}=(0,useCORSProxy.A)(),updateLinkFromMetadataApi=(0,react_src.T0)((({newUrl,newTitle,newIcon,needsProxy})=>pushUpdateForObject("link",(()=>newUrl?(0,elementLink.d)({url:newUrl,needsProxy,desc:newTitle||"",icon:newIcon?(0,src_url.oK)(newUrl,newIcon):""}):null),defaultLink,!0)),[pushUpdateForObject,defaultLink]),[isInvalidUrl,setIsInvalidUrl]=(0,react_src.J0)(!(0,src_url.AY)((0,src_url.x6)(url))),populateMetadata=(0,react_src.YQ)((0,react_src.hb)((async newUrl=>{if(newUrl.startsWith("http://")||newUrl.startsWith("https://")){setFetchingMetadata(!0);try{const{title:newTitle,image:newIcon}=getLinkMetadata?await getLinkMetadata(newUrl):{},needsProxy=!!newIcon&&await checkResourceAccess(newIcon);updateLinkFromMetadataApi({newUrl,newTitle,newIcon,needsProxy})}catch{setIsInvalidUrl(!0)}finally{setFetchingMetadata(!1)}}}),[checkResourceAccess,getLinkMetadata,updateLinkFromMetadataApi]),1200),handleChange=(0,react_src.hb)(((properties,submit)=>{if(clearEditing(),populateMetadata.cancel(),properties.url){if(story_editor_src_constants.jW===properties.url)return;const urlWithProtocol=(0,src_url.x6)(properties.url),valid=(0,src_url.AY)(urlWithProtocol);setIsInvalidUrl(!valid),valid&&populateMetadata(urlWithProtocol)}pushUpdateForObject("link",""!==properties.url?{...properties}:null,defaultLink,submit)}),[clearEditing,pushUpdateForObject,defaultLink,populateMetadata]),handleChangeIcon=(0,react_src.hb)((resource=>{handleChange({icon:resource?.src},!0)}),[handleChange]),hasLinkSet=Boolean(url?.length),displayMetaFields=hasLinkSet&&!isInvalidUrl||linkType===elements_src.J.Branching&&pageId;(0,react_src.vJ)((()=>{if(isLinkFocused){const hasLink=hasLinkSet&&url!==story_editor_src_constants.jW;setDisplayLinkGuidelines(hasElementsInAttachmentArea&&!hasLink)}}),[selectedElements,isLinkFocused,hasElementsInAttachmentArea,hasLinkSet,setDisplayLinkGuidelines,url]);const linkIcon=icon?getProxiedUrl(link,icon):null,isMultipleLinkType=story_editor_src_constants.jW===linkType,isMultiplePageId=story_editor_src_constants.jW===pageId,isMultipleUrl=story_editor_src_constants.jW===url,isMultipleDesc=story_editor_src_constants.jW===desc,isMultipleRel=story_editor_src_constants.jW===rel,onChangeRel=(0,react_src.hb)((newRel=>handleChange({rel:newRel},!0)),[handleChange]),onChangeLinkType=(0,react_src.hb)((()=>{handleChange({type:linkType===elements_src.J.Regular?elements_src.J.Branching:elements_src.J.Regular},!0)}),[handleChange,linkType]),onChangePageId=(0,react_src.hb)(((_event,value)=>{handleChange({pageId:value},!0)}),[handleChange]);return react.createElement(link_StyledSimplePanel,{name:"link",title:(0,i18n.__)("Link","web-stories"),onAnimationEnd:()=>resetHighlight(),isPersistable:!highlight,$_css:highlight?.showEffect&&highlights_styles.A.FLASH},react.createElement(components_form.fI,null,react.createElement(StyledSwitch,{groupLabel:(0,i18n.__)("Link Type","web-stories"),name:"link-type-switch",value:linkType===elements_src.J.Regular,onLabel:(0,i18n.__)("Link to website","web-stories"),offLabel:(0,i18n.__)("Link to story page","web-stories"),disabled:isMultipleLinkType,onChange:onChangeLinkType})),linkType===elements_src.J.Branching?react.createElement(components_form.fI,null,react.createElement(dropdown.A,{ariaLabel:(0,i18n.__)("Page","web-stories"),dropDownLabel:(0,i18n.__)("Page","web-stories"),placeholder:(0,i18n.__)("Select Page","web-stories"),options:pages,placement:popup_constants.W.TopStart,onMenuItemClick:onChangePageId,selectedValue:pageId,disabled:!pages.length||isMultiplePageId})):react.createElement(components_form.Z3,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},onChange:value=>!displayLinkGuidelines&&handleChange({url:value},!value),onBlur:()=>{setDisplayLinkGuidelines(!1),setIsLinkFocused(!1)},onFocus:()=>{setIsLinkFocused(!0)},value:url||"",placeholder:isMultipleUrl?story_editor_src_constants.Q6:(0,i18n.__)("Enter an address to apply a link","web-stories"),isIndeterminate:isMultipleUrl,"aria-label":(0,i18n.__)("Element link","web-stories"),hasError:displayLinkGuidelines}),displayLinkGuidelines&&react.createElement(components_form.fI,null,react.createElement(link_Error,null,(0,i18n.__)("Link can not reside below the dashed line when a page attachment is present","web-stories"))),displayMetaFields&&react.createElement(react.Fragment,null,react.createElement(components_form.fI,null,react.createElement(input_input.A,{placeholder:isMultipleDesc?story_editor_src_constants.Q6:(0,i18n.__)("Optional description","web-stories"),onChange:({target})=>handleChange({desc:target.value},!target.value),value:desc,"aria-label":(0,i18n.__)("Link description","web-stories"),isIndeterminate:isMultipleDesc,disabled:fetchingMetadata,containerStyleOverride:shared_styles.t})),react.createElement(components_form.fI,{spaceBetween:!1},react.createElement(components_form.qY,{handleChange:handleChangeIcon,icon:linkIcon,isLoading:fetchingMetadata,disabled:fetchingMetadata}),react.createElement(IconInfo,null,react.createElement(IconText,{size:types.$.Small},(0,i18n.__)("Optional brand icon","web-stories")))),!isMultipleRel&&linkType===elements_src.J.Regular&&react.createElement(shared.uF,{onChangeRel,rel})))};var link_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"link___StyledSimplePanel",componentId:"sc-niusn4-4"})(["",""],(p=>p.$_css)),generalPageAdvancement=__webpack_require__("./packages/story-editor/src/components/panels/shared/generalPageAdvancement.js");const customPageAdvancement=function CustomPageAdvancementPanel(){const{isOverridden,autoAdvance,pageDuration,updateCurrentPageProperties}=(0,app_story.P3)((({state:{story:{autoAdvance:defaultAutoAdvance,defaultPageDuration},currentPage:{advancement}},actions:{updateCurrentPageProperties}})=>({isOverridden:"object"==typeof advancement,autoAdvance:advancement?.autoAdvance??defaultAutoAdvance,pageDuration:advancement?.pageDuration??defaultPageDuration,updateCurrentPageProperties}))),onUpdate=(0,react_src.hb)((properties=>{if(!1===properties.override)updateCurrentPageProperties({properties:{advancement:void 0}});else{const{override,...rest}=properties,advancement={autoAdvance,pageDuration,...rest};updateCurrentPageProperties({properties:{advancement}})}}),[autoAdvance,pageDuration,updateCurrentPageProperties]);return react.createElement(generalPageAdvancement.A,{panelName:"customPageAdvancement",onUpdate,autoAdvance,pageDuration,hasOverrideEnabled:isOverridden,allowsOverride:!0,collapsedByDefault:!0},(0,i18n.__)("Control whether this page auto-advances to the next page, or whether the reader has to manually tap to advance.","web-stories"))},shared_Label=styled_components_browser_esm.Ay.label.withConfig({displayName:"shared__Label",componentId:"sc-zfap6q-0"})(["margin-left:12px;"]),StyledCheckbox=(0,styled_components_browser_esm.Ay)(checkbox_checkbox.A).withConfig({displayName:"shared__StyledCheckbox",componentId:"sc-zfap6q-1"})(["",""],(({theme})=>`\n    input[type='checkbox']:focus-visible ~ div, input[type='checkbox']:focus ~ div {\n      box-shadow: 0px 0px 0 2px ${theme.colors.bg.secondary}, 0px 0px 0 4px ${theme.colors.border.focus} !important;\n    }\n  `)),shared_StyledRow=(0,styled_components_browser_esm.Ay)(components_form.fI).withConfig({displayName:"shared__StyledRow",componentId:"sc-zfap6q-2"})(["justify-content:flex-start;"]),Space=styled_components_browser_esm.Ay.div.withConfig({displayName:"shared__Space",componentId:"sc-zfap6q-3"})(["width:20px;"]);function CallToActionText({value,defaultValue,onChange}){const[text,setText]=(0,react_src.J0)(value||defaultValue),debouncedUpdate=(0,react_src.YQ)(onChange,300),handleBlur=(0,react_src.hb)((({target})=>{target.value?(debouncedUpdate.cancel(),onChange({ctaText:text||void 0})):(onChange({ctaText:void 0}),setText(defaultValue))}),[text,debouncedUpdate,defaultValue,onChange]),handleChangeCta=(0,react_src.hb)((({target})=>{const{value:newText}=target;setText(newText),debouncedUpdate({ctaText:newText})}),[debouncedUpdate]),isDefault=value===defaultValue;return react.createElement(components_form.fI,null,react.createElement(input_input.A,{onChange:handleChangeCta,onBlur:handleBlur,value:text,"aria-label":(0,i18n.__)("Call to Action text","web-stories"),suffix:isDefault?(0,i18n.__)("Default","web-stories"):null}))}function Theme({theme,onChange}){const checkboxId=`cb-${(0,v4.A)()}`,handleChangeTheme=(0,react_src.hb)((evt=>{onChange({theme:evt.target.checked?story_editor_src_constants.RS.DARK:story_editor_src_constants.RS.LIGHT})}),[onChange]);return react.createElement(shared_StyledRow,null,react.createElement(StyledCheckbox,{id:checkboxId,checked:theme===story_editor_src_constants.RS.DARK,onChange:handleChangeTheme}),react.createElement(shared_Label,{htmlFor:checkboxId},react.createElement(typography_text.E.Span,{size:types.$.Small},(0,i18n.__)("Use dark theme","web-stories"))))}function Icon({icon,onChange,isFetching,needsProxy}){const{getProxiedUrl}=(0,useCORSProxy.A)(),handleChangeIcon=(0,react_src.hb)((resource=>{onChange({icon:resource?.src},!0)}),[onChange]),iconUrl=icon?getProxiedUrl({needsProxy},icon):null;return react.createElement(shared_StyledRow,null,react.createElement(components_form.qY,{handleChange:handleChangeIcon,icon:iconUrl,isLoading:isFetching,disabled:isFetching}),react.createElement(Space,null),react.createElement(typography_text.E.Span,{size:types.$.Small},(0,i18n.__)("Link icon","web-stories")))}function LinkUrl({value,onChange,setIsInvalidUrl,setIsFetching,onFocus,hint,hasError}){const{actions:{getLinkMetadata}}=(0,app.M1)(),[_url,_setUrl]=(0,react_src.J0)(value),debouncedUpdate=(0,react_src.YQ)(onChange,300),{checkResourceAccess}=(0,useCORSProxy.A)(),populateUrlData=(0,react_src.YQ)((0,react_src.hb)((async newValue=>{if(newValue.startsWith("http://")||newValue.startsWith("https://")){setIsFetching(!0);try{const{image}=getLinkMetadata?await getLinkMetadata(newValue):{},iconUrl=image?(0,src_url.oK)(newValue,image):"",needsProxy=!!iconUrl&&await checkResourceAccess(iconUrl);onChange({url:newValue,icon:iconUrl,needsProxy})}catch(e){onChange({url:newValue,icon:"",needsProxy:!1}),setIsInvalidUrl(!0)}finally{setIsFetching(!1)}}}),[checkResourceAccess,getLinkMetadata,onChange,setIsFetching,setIsInvalidUrl]),1200),handleChangeUrl=(0,react_src.hb)((newValue=>{populateUrlData.cancel(),_setUrl(newValue),setIsInvalidUrl(!1);const urlWithProtocol=(0,src_url.x6)(newValue.trim());(0,src_url.AY)(urlWithProtocol)&&populateUrlData(urlWithProtocol)}),[populateUrlData,setIsInvalidUrl]),onBlur=(0,react_src.hb)((()=>{debouncedUpdate.cancel(),onChange({url:_url?.trim().length?(0,src_url.x6)(_url.trim()):""})}),[_url,debouncedUpdate,onChange]);return react.createElement(components_form.Z3,{onChange:newValue=>handleChangeUrl(newValue?.trim()),onBlur,onFocus,value:_url,clear:!0,"aria-label":(0,i18n.__)("Type an address to add a page attachment link","web-stories"),hasError,hint})}const outlink=function Outlink({pageAttachment,updatePageAttachment}){const{setDisplayLinkGuidelines}=(0,app.yu)((state=>({setDisplayLinkGuidelines:state.actions.setDisplayLinkGuidelines}))),{url,ctaText,icon,theme,rel=[],needsProxy}=pageAttachment,[displayWarning,setDisplayWarning]=(0,react_src.J0)(!1),[isFetching,setIsFetching]=(0,react_src.J0)(!1),[isInvalidUrl,setIsInvalidUrl]=(0,react_src.J0)(url&&!(0,src_url.AY)((0,src_url.x6)(url).trim())),hasValidUrl=Boolean(url)&&!isInvalidUrl,{hasLinksInAttachmentArea}=(0,useElementsWithLinks.A)();(0,react_src.vJ)((()=>()=>{setDisplayLinkGuidelines(!1)}),[hasLinksInAttachmentArea,setDisplayLinkGuidelines,url]);const onFocus=(0,react_src.hb)((()=>{hasLinksInAttachmentArea&&!url?.length&&(setDisplayWarning(!0),setDisplayLinkGuidelines(!0))}),[hasLinksInAttachmentArea,setDisplayLinkGuidelines,url?.length]);(0,react_src.vJ)((()=>{displayWarning&&url?.length&&setDisplayWarning(!1)}),[url,displayWarning]);const onChangeRel=(0,react_src.hb)((newRel=>updatePageAttachment({rel:newRel},!0)),[updatePageAttachment]);let hint;const hasError=displayWarning||isInvalidUrl;return hasError&&(hint=displayWarning?(0,i18n.__)("Links cannot reside below the dashed line when a page attachment is present. If you add a page attachment, your viewers will not be able to click on the link.","web-stories"):(0,i18n.__)("Invalid link","web-stories")),react.createElement(react.Fragment,null,react.createElement(LinkUrl,{value:url,onChange:updatePageAttachment,isFetching,setIsFetching,setIsInvalidUrl,hint,onFocus,hasError}),hasValidUrl&&react.createElement(react.Fragment,null,react.createElement(CallToActionText,{value:ctaText,defaultValue:(0,i18n.__)("Learn more","web-stories"),onChange:updatePageAttachment}),react.createElement(Theme,{theme,onChange:updatePageAttachment})),hasValidUrl&&react.createElement(react.Fragment,null,react.createElement(Icon,{icon,isFetching,needsProxy,onChange:updatePageAttachment}),react.createElement(shared.uF,{onChangeRel,rel})))},shoppingAttachment_HelperText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"shoppingAttachment__HelperText",componentId:"sc-fsu1pn-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary));const pageAttachment_shoppingAttachment=function ShoppingAttachment({shoppingAttachment,updateShoppingAttachment}){const{ctaText,theme}=shoppingAttachment;return react.createElement(react.Fragment,null,react.createElement(components_form.fI,null,react.createElement(shoppingAttachment_HelperText,null,(0,i18n.__)("Since there are products on this page, you cannot add a regular page attachment, but only customize the appearance of the shopping call to action.","web-stories"))),react.createElement(CallToActionText,{value:ctaText,defaultValue:(0,i18n.__)("Shop Now","web-stories"),onChange:updateShoppingAttachment}),react.createElement(Theme,{theme,onChange:updateShoppingAttachment}))};const pageAttachment=function PageAttachmentPanel(){const{pageAttachment,shoppingAttachment,updateCurrentPageProperties,hasProducts}=(0,app.P3)((({state,actions})=>({updateCurrentPageProperties:actions.updateCurrentPageProperties,currentPage:state.currentPage,pageAttachment:state.currentPage.pageAttachment||{},shoppingAttachment:state.currentPage.shoppingAttachment||{},hasProducts:state.currentPage.elements?.some((({type,product})=>type===elements_src.bV.PRODUCT&&product?.productId))}))),updateShoppingAttachment=(0,react_src.hb)((value=>{updateCurrentPageProperties({properties:{shoppingAttachment:{...shoppingAttachment,...value}}})}),[updateCurrentPageProperties,shoppingAttachment]),updatePageAttachment=(0,react_src.hb)((value=>{updateCurrentPageProperties({properties:{pageAttachment:{...pageAttachment,...value}}})}),[updateCurrentPageProperties,pageAttachment]);return react.createElement(panel.RV,{name:"pageAttachment",title:(0,i18n.__)("Call to Action","web-stories"),collapsedByDefault:!1},hasProducts&&react.createElement(pageAttachment_shoppingAttachment,{shoppingAttachment,updateShoppingAttachment}),!hasProducts&&react.createElement(outlink,{pageAttachment,updatePageAttachment}))};var backgroundAudioPanelContent=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/backgroundAudioPanelContent.js");const backgroundAudio_HelperText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"backgroundAudio__HelperText",componentId:"sc-qyqy4a-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),HighlightRow=(0,styled_components_browser_esm.Ay)(components_form.fI).attrs({spaceBetween:!1}).withConfig({displayName:"backgroundAudio__HighlightRow",componentId:"sc-qyqy4a-1"})(["position:relative;&::after{content:'';position:absolute;top:-10px;bottom:-10px;left:-20px;right:-10px;"," pointer-events:none;}"],(({isHighlighted})=>isHighlighted&&highlights_styles.A.FLASH));const backgroundAudio=function PageBackgroundAudioPanel(){const{backgroundAudio,currentPageId,updateCurrentPageProperties}=(0,app.P3)((state=>({updateCurrentPageProperties:state.actions.updateCurrentPageProperties,backgroundAudio:state.state.currentPage?.backgroundAudio,currentPageId:state.state.currentPage?.id}))),{highlightBackgroundAudio,resetHighlight}=(0,useHighlights.A)((state=>({highlightBackgroundAudio:state[highlights.xP.PageBackgroundAudio],resetHighlight:state.onFocusOut}))),updateBackgroundAudio=(0,react_src.hb)((updatedBackgroundAudio=>{updateCurrentPageProperties({properties:{backgroundAudio:updatedBackgroundAudio}})}),[updateCurrentPageProperties]);return react.createElement(panel.RV,{name:"pageBackgroundAudio",title:(0,i18n.__)("Page Background Audio","web-stories"),collapsedByDefault:!1,isPersistable:!highlightBackgroundAudio},react.createElement(HighlightRow,{isHighlighted:highlightBackgroundAudio?.showEffect,onAnimationEnd:()=>resetHighlight()},react.createElement(backgroundAudio_HelperText,null,(0,i18n.__)("Select an audio file that plays while this page is in view.","web-stories"))),react.createElement(backgroundAudioPanelContent.A,{backgroundAudio,updateBackgroundAudio,showCaptions:!0,showLoopControl:!0,audioId:`page-${currentPageId}-background-audio`}))};var getElementProperties=__webpack_require__("./packages/story-editor/src/components/canvas/utils/getElementProperties.ts");const DEFAULT_FLIP={horizontal:!1,vertical:!1},Row=(0,styled_components_browser_esm.Ay)(components_form.fI).withConfig({displayName:"pageBackground__Row",componentId:"sc-1rac0x7-0"})(["justify-content:flex-start;"]),SelectedMedia=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageBackground__SelectedMedia",componentId:"sc-1rac0x7-1"})(["width:128px;height:36px;border-radius:4px;border:1px solid ",";display:flex;justify-content:space-between;margin-right:12px;"],(({theme})=>theme.colors.border.defaultNormal)),MediaWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageBackground__MediaWrapper",componentId:"sc-1rac0x7-2"})(["height:24px;width:24px;border-radius:4px;overflow:hidden;margin:5px;img{object-fit:cover;max-height:100%;max-width:100%;}"]),RemoveButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"pageBackground__RemoveButton",componentId:"sc-1rac0x7-3"})(["margin:1px;align-self:center;"]),ReplaceButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({size:constants.Mp.Small,variant:constants.Ak.Square,type:constants.VQ.Tertiary}).withConfig({displayName:"pageBackground__ReplaceButton",componentId:"sc-1rac0x7-4"})(["margin-right:8px;"]),pageBackground_Text=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"pageBackground__Text",componentId:"sc-1rac0x7-5"})(["align-self:center;width:55px;"]);const pageBackground=function PageBackgroundPanel({selectedElements,pushUpdate}){const{isDefaultBackground}=selectedElements[0],{combineElements,currentPage,clearBackgroundElement,updateCurrentPageProperties,currentPageBackgroundColor}=(0,app.P3)((({state,actions})=>({currentPage:state.currentPage,clearBackgroundElement:actions.clearBackgroundElement,combineElements:actions.combineElements,updateCurrentPageProperties:actions.updateCurrentPageProperties,currentPageBackgroundColor:!isDefaultBackground||state.currentPage?.backgroundColor}))),{getProxiedUrl}=(0,useCORSProxy.A)(),{capabilities:{hasUploadMediaAction}}=(0,app.UK)(),pageSize=(0,app.gK)((({state:{pageWidth,pageHeight}})=>({width:pageWidth,height:pageHeight}))),[failedContrast,setFailedContrast]=(0,react_src.J0)(!1),updateBackgroundColor=(0,react_src.hb)((value=>{updateCurrentPageProperties({properties:{backgroundColor:value}})}),[updateCurrentPageProperties]),removeAsBackground=(0,react_src.hb)((()=>{pushUpdate({isBackground:!1,opacity:100},!0),clearBackgroundElement()}),[pushUpdate,clearBackgroundElement]),onSelect=(0,react_src.hb)((resource=>{const element=(0,elements_src.N3)(resource.type,(0,getElementProperties.A)(resource.type,{resource}));combineElements({firstElement:element,secondId:selectedElements[0].id}),(0,tracking_src.sx)("replace_background_media")}),[combineElements,selectedElements]),renderReplaceButton=(0,react_src.hb)((open=>react.createElement(ReplaceButton,{onClick:open,"aria-label":(0,i18n.__)("Replace","web-stories")},react.createElement(arrow_cloud.A,null))),[]),{highlight,resetHighlight,cancelHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.PageBackground],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));(0,react_src.vJ)((()=>{(0,checklist.g4)([currentPage],pageSize).then((failedPages=>{const result=failedPages[0]?.result,isBackgroundElement=result?.some((({isBackground})=>isBackground));setFailedContrast(Boolean(isBackgroundElement))})).catch(noop.l)}),[currentPage,pageSize]);const backgroundEl=selectedElements[0];if(!backgroundEl||!backgroundEl.isBackground)return null;const isMedia=backgroundEl.isBackground&&!isDefaultBackground,{backgroundColor}=currentPage,{LayerIcon}=(0,elements_src.zh)(backgroundEl.type),flip=selectedElements[0]?.flip||DEFAULT_FLIP;return react.createElement(pageBackground_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"pageBackground",title:(0,i18n.__)("Page Background","web-stories"),isPersistable:!highlight,collapsedByDefault:!1,$_css:highlight?.showEffect&&highlights_styles.A.FLASH},isDefaultBackground&&react.createElement(Row,null,react.createElement(components_form.Q1,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},allowsGradient:!0,value:backgroundColor,onChange:updateBackgroundColor,label:(0,i18n.__)("Background color","web-stories"),allowsSavedColors:!0,allowsOpacity:!1})),isMedia&&react.createElement(Row,{expand:!1},react.createElement(SelectedMedia,null,react.createElement(MediaWrapper,null,react.createElement(LayerIcon,{element:backgroundEl,getProxiedUrl,currentPageBackgroundColor})),react.createElement(pageBackground_Text,{size:types.$.Small},(0,i18n.__)("Media","web-stories")),react.createElement(RemoveButton,{"aria-label":(0,i18n.__)("Detach background","web-stories"),onClick:removeAsBackground,size:constants.Mp.Small,variant:constants.Ak.Square,type:constants.VQ.Tertiary},react.createElement(cross.A,null))),hasUploadMediaAction&&react.createElement(components_tooltip.A,{title:(0,i18n.__)("Replace","web-stories")},react.createElement(components_form.c4,{buttonInsertText:(0,i18n.__)("Use as background","web-stories"),onInsert:onSelect,renderButton:renderReplaceButton})),react.createElement(shared.Yb,{onChange:value=>pushUpdate({flip:value},!0),value:flip})),failedContrast&&react.createElement(warning,{message:checklist.br.lowContrast.backgroundPanel}))};var pageBackground_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"pageBackground___StyledSimplePanel",componentId:"sc-1rac0x7-6"})(["",""],(p=>p.$_css)),productDropdown=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/productDropdown.js");const product=function ProductPanel({selectedElements,pushUpdate}){const isMultiple=(0,shared.Bl)(selectedElements,"product",[])===story_editor_src_constants.jW,setProduct=(0,react_src.hb)((newProduct=>pushUpdate({product:newProduct})),[pushUpdate]);return react.createElement(panel.RV,{name:"product",title:(0,i18n.__)("Product","web-stories"),collapsedByDefault:!1},react.createElement(components_form.fI,null,isMultiple&&react.createElement(input_input.A,{onChange:noop.l,disabled:!0,value:story_editor_src_constants.Q6,"aria-label":(0,i18n.__)("Product","web-stories")}),!isMultiple&&react.createElement(productDropdown.A,{product:selectedElements[0].product,setProduct})))};const shapeStyle=function ShapeStylePanel({selectedElements,pushUpdate}){const backgroundColor=(0,shared.Bl)(selectedElements,"backgroundColor"),onChange=(0,react_src.hb)((value=>{pushUpdate({backgroundColor:value},!0)}),[pushUpdate]),{highlight,resetHighlight,cancelHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.Style],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));return react.createElement(shapeStyle_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"shapeStyle",title:(0,i18n.__)("Color","web-stories"),isPersistable:!highlight,"aria-labelledby":null,"aria-label":(0,i18n.__)("Shape style","web-stories"),$_css:highlight?.showEffect&&highlights_styles.A.FLASH},react.createElement(components_form.fI,null,react.createElement(components_form.Q1,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},allowsGradient:!0,value:backgroundColor,isMultiple:""===backgroundColor,onChange,label:(0,i18n.__)("Background color","web-stories"),allowsSavedColors:!0})))};var shapeStyle_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"shapeStyle___StyledSimplePanel",componentId:"sc-1ekkvr9-0"})(["",""],(p=>p.$_css)),calcRotatedObjectPositionAndSize=__webpack_require__("./packages/units/src/calcRotatedObjectPositionAndSize.ts"),angle=__webpack_require__("./packages/design-system/src/icons/angle.svg"),flipControls=__webpack_require__("./packages/story-editor/src/components/panels/shared/flipControls.js"),usePerformanceTracking=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),usePresubmitHandler=__webpack_require__("./packages/story-editor/src/components/form/usePresubmitHandler.js");const constants_MIN_MAX_ROTATION={MIN:-360,MAX:360},constants_MIN_MAX_WIDTH={MIN:1,MAX:1e3},constants_MIN_MAX_HEIGHT={MIN:1,MAX:1e3},constants_MIN_MAX_X={MIN:1,MAX:src_constants.bj-1},constants_MIN_MAX_Y={MIN:1-Math.floor(src_constants.vT),MAX:src_constants.WY+Math.floor(src_constants.vT)-1},constants_DEFAULT_FLIP={horizontal:!1,vertical:!1};function isNum(v){return"number"==typeof v&&!isNaN(v)}const sizePosition_usePresubmitHandlers=function usePresubmitHandlers(lockAspectRatio,height,width){(0,usePresubmitHandler.A)(((newElement,{width:newWidth,height:newHeight},{width:oldWidth,height:oldHeight})=>{const{type}=newElement,isResizeWidth=Boolean(newWidth),isResizeHeight=Boolean(newHeight);if(!isResizeWidth&&!isResizeHeight)return null;const{updateForResizeEvent}=(0,elements_src.zh)(type);if(updateForResizeEvent){return updateForResizeEvent(newElement,[isResizeWidth?1:0,isResizeHeight?1:0],(0,range.qE)(newWidth,constants_MIN_MAX_WIDTH),(0,range.qE)(newHeight,constants_MIN_MAX_HEIGHT))}if(lockAspectRatio){const ratio=oldWidth/oldHeight;if(!isResizeWidth)return{width:(0,range.qE)((0,dimensions.GU)(newHeight*ratio),constants_MIN_MAX_WIDTH)};if(!isResizeHeight)return{height:(0,range.qE)((0,dimensions.GU)(newWidth/ratio),constants_MIN_MAX_HEIGHT)}}return null}),[lockAspectRatio]),(0,usePresubmitHandler.A)((({rotationAngle:newRotationAngle})=>({rotationAngle:newRotationAngle%360})),[]),(0,usePresubmitHandler.A)((({rotationAngle:na,x:nx,y:ny,width:nw,height:nh})=>{const newDims=(0,calcRotatedObjectPositionAndSize.A)(na,nx,ny,nw,nh),newXOffset=nx-newDims.x,newYOffset=ny-newDims.y;return{x:(0,range.qE)(nx,{MIN:constants_MIN_MAX_X.MIN+newXOffset-newDims.width,MAX:constants_MIN_MAX_X.MAX+newXOffset}),y:(0,range.qE)(ny,{MIN:constants_MIN_MAX_Y.MIN+newYOffset-newDims.height,MAX:constants_MIN_MAX_Y.MAX+newYOffset})}}),[]);const setDimensionMinMax=(0,react_src.hb)(((value,ratio,minmax)=>lockAspectRatio&&value>=minmax.MAX?(0,range.qE)(minmax.MAX*ratio,minmax):(0,range.qE)(value,minmax)),[lockAspectRatio]);(0,usePresubmitHandler.A)((({height:newHeight},{width:oldWidth,height:oldHeight})=>{const ratio=oldHeight/oldWidth;return newHeight=(0,range.qE)(newHeight,constants_MIN_MAX_HEIGHT),isNum(ratio)?{height:setDimensionMinMax((0,dimensions.GU)(newHeight),ratio,constants_MIN_MAX_HEIGHT)}:{height:(0,range.qE)(newHeight,constants_MIN_MAX_HEIGHT)}}),[height,lockAspectRatio]),(0,usePresubmitHandler.A)((({width:newWidth},{width:oldWidth,height:oldHeight})=>{const ratio=oldWidth/oldHeight;return newWidth=(0,range.qE)(newWidth,constants_MIN_MAX_WIDTH),isNum(ratio)?{width:setDimensionMinMax((0,dimensions.GU)(newWidth),ratio,constants_MIN_MAX_WIDTH)}:{width:(0,range.qE)(newWidth,constants_MIN_MAX_WIDTH)}}),[width,lockAspectRatio])};var opacity=__webpack_require__("./packages/story-editor/src/components/panels/design/sizePosition/opacity.js"),radius=__webpack_require__("./packages/story-editor/src/components/panels/design/sizePosition/radius.js");function sizePosition_extends(){return sizePosition_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},sizePosition_extends.apply(null,arguments)}const sizePosition_StyledLockToggle=(0,styled_components_browser_esm.Ay)(toggleButton.m).withConfig({displayName:"sizePosition__StyledLockToggle",componentId:"sc-7rw4xb-0"})(["",";"],shared_styles.Y),stackableGroupStyleOverride=(0,styled_components_browser_esm.AH)(["max-width:none;"]);function getStickerAspectRatio(element){return stickers_src.A?.[element?.sticker?.type].aspectRatio||1}const gridWithoutFlip=(0,styled_components_browser_esm.AH)(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . o . .' 'c c c c c c c';"],(({isSingleMedia})=>isSingleMedia?"'b b b b b . .'":null)),gridWithFlip=(0,styled_components_browser_esm.AH)(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . f . .' ",";"],(({isSingleMedia})=>isSingleMedia?"'b b b b b . .'":null),(({unlockedRadius})=>unlockedRadius?"\n  'o . . . . . .'\n  'c c c c c c c'\n":"'o . . . c c c'")),Grid=styled_components_browser_esm.Ay.div.withConfig({displayName:"sizePosition__Grid",componentId:"sc-7rw4xb-1"})(["display:grid;"," grid-template-columns:1fr 4px 8px 4px 1fr 8px 32px;grid-template-rows:repeat(4,36px);row-gap:16px;align-items:center;justify-items:start;margin-bottom:16px;"],(({canFlip})=>canFlip?gridWithFlip:gridWithoutFlip)),sizePosition_Area=styled_components_browser_esm.Ay.div.withConfig({displayName:"sizePosition__Area",componentId:"sc-7rw4xb-2"})(["grid-area:",";width:100%;"],(({area})=>area)),Dash=styled_components_browser_esm.Ay.div.withConfig({displayName:"sizePosition__Dash",componentId:"sc-7rw4xb-3"})(["height:1px;width:100%;background:",";"],(({theme})=>theme.colors.divider.primary)),sizePosition_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"sizePosition__StyledButton",componentId:"sc-7rw4xb-4"})(["padding:10px 16px;width:100%;",";"],shared_styles.Y);const sizePosition=function SizePositionPanel(props){const{selectedElements,submittedSelectedElements,pushUpdate,pushUpdateForObject}=props,x=(0,shared.Bl)(selectedElements,"x"),y=(0,shared.Bl)(selectedElements,"y"),width=(0,shared.Bl)(selectedElements,"width"),height=(0,shared.Bl)(selectedElements,"height"),rotationAngle=(0,shared.Bl)(selectedElements,"rotationAngle"),flip=(0,shared.dP)(selectedElements,"flip",constants_DEFAULT_FLIP),borderRadius=(0,shared.dP)(selectedElements,"borderRadius",{locked:!0}),origRatio=(0,react_src.Kr)((()=>(0,shared.Bl)(submittedSelectedElements,"width")/(0,shared.Bl)(submittedSelectedElements,"height")),[submittedSelectedElements]),rawLockAspectRatio=(0,shared.Bl)(selectedElements,"lockAspectRatio"),bgButtonRef=(0,react_src.li)(null);(0,usePerformanceTracking.A)({node:bgButtonRef.current,eventData:story_editor_src_constants.Zy.SET_BACKGROUND_MEDIA});const lockAspectRatio=rawLockAspectRatio===story_editor_src_constants.jW||rawLockAspectRatio,{currentPage,combineElements}=(0,story_useStory.A)((state=>({currentPage:state.state.currentPage,combineElements:state.actions.combineElements}))),currentBackgroundId=currentPage?.elements[0].id,isSingleElement=1===selectedElements.length,{isMedia}=(0,elements_src.zh)(selectedElements[0].type),canFlip=selectedElements.every((({type})=>(0,elements_src.zh)(type).canFlip)),isAspectAlwaysLocked=selectedElements.some((({type})=>(0,elements_src.zh)(type).isAspectAlwaysLocked)),hasText=selectedElements.some((({type})=>"text"===type)),actualDimensions=(0,react_src.Kr)((()=>isSingleElement?(0,calcRotatedObjectPositionAndSize.A)(rotationAngle,x,y,width,height):{}),[rotationAngle,x,y,width,height,isSingleElement]),xOffset=x-actualDimensions.x,yOffset=y-actualDimensions.y,minMaxXY=isSingleElement?{minX:constants_MIN_MAX_X.MIN+xOffset-actualDimensions.width,minY:constants_MIN_MAX_Y.MIN+yOffset-actualDimensions.height,maxX:constants_MIN_MAX_X.MAX+xOffset,maxY:constants_MIN_MAX_Y.MAX+yOffset}:function getMultiSelectionMinMaxXY(selectedElements){const allDimensions=selectedElements.map((element=>(0,calcRotatedObjectPositionAndSize.A)(element.rotationAngle,element.x,element.y,element.width,element.height)));return selectedElements.reduce(((values,element,i)=>{const actualDimensions=allDimensions[i],xOffset=element.x-actualDimensions.x,yOffset=element.y-actualDimensions.y,minX=constants_MIN_MAX_X.MIN+xOffset-actualDimensions.width,minY=constants_MIN_MAX_Y.MIN+yOffset-actualDimensions.height,maxX=constants_MIN_MAX_X.MAX+xOffset,maxY=constants_MIN_MAX_Y.MAX+yOffset;return{minX:values.minX?Math.max(values.minX,minX):minX,minY:values.minY?Math.max(values.minY,minY):minY,maxX:values.maxX?Math.min(values.maxX,maxX):maxX,maxY:values.maxY?Math.min(values.maxY,maxY):maxY}}),{})}(selectedElements),getUpdateObject=(nWidth,nHeight)=>rawLockAspectRatio===story_editor_src_constants.jW?{lockAspectRatio,height:nHeight,width:nWidth}:{height:nHeight,width:nWidth};sizePosition_usePresubmitHandlers(lockAspectRatio,height,width);const handleSetBackground=(0,react_src.hb)((()=>{combineElements({firstElement:selectedElements[0],secondId:currentBackgroundId})}),[selectedElements,combineElements,currentBackgroundId]),disableHeight=!lockAspectRatio&&hasText,enabledHeightPlaceholder=story_editor_src_constants.jW===height?story_editor_src_constants.Q6:null,heightPlaceholder=disableHeight?(0,i18n.__)("Auto","web-stories"):enabledHeightPlaceholder,getMixedValueProps=(0,react_src.hb)((value=>({isIndeterminate:story_editor_src_constants.jW===value,placeholder:story_editor_src_constants.jW===value?story_editor_src_constants.Q6:null})),[]);return react.createElement(panel.RV,{name:"size",title:(0,i18n.__)("Selection","web-stories")},react.createElement(Grid,{isSingleMedia:isMedia&&isSingleElement,canFlip,unlockedRadius:!borderRadius.locked},isMedia&&isSingleElement&&react.createElement(sizePosition_Area,{area:"b"},react.createElement(sizePosition_StyledButton,{ref:bgButtonRef,onClick:handleSetBackground,type:constants.VQ.Secondary,size:constants.Mp.Small,variant:constants.Ak.Rectangle},(0,i18n.__)("Set as background","web-stories"))),react.createElement(sizePosition_Area,{area:"x"},react.createElement(numericInput.A,sizePosition_extends({suffix:(0,i18n._x)("X","Position on X axis","web-stories"),value:x,min:minMaxXY.minX,max:minMaxXY.maxX,onChange:(evt,value)=>pushUpdate({x:value},!0),"aria-label":(0,i18n.__)("X position","web-stories"),canBeNegative:!0},getMixedValueProps(x),{containerStyleOverride:shared_styles.t}))),react.createElement(sizePosition_Area,{area:"y"},react.createElement(numericInput.A,sizePosition_extends({suffix:(0,i18n._x)("Y","Position on Y axis","web-stories"),value:y,min:minMaxXY.minY,max:minMaxXY.maxY,onChange:(evt,value)=>pushUpdate({y:value},!0),"aria-label":(0,i18n.__)("Y position","web-stories"),canBeNegative:!0},getMixedValueProps(y),{containerStyleOverride:shared_styles.t}))),react.createElement(sizePosition_Area,{area:"w"},react.createElement(numericInput.A,sizePosition_extends({suffix:(0,i18n._x)("W","The Width dimension","web-stories"),value:width,min:constants_MIN_MAX_WIDTH.MIN,max:constants_MIN_MAX_WIDTH.MAX,onChange:(evt,value)=>{const newWidth=value;let newHeight=height;lockAspectRatio&&(""===newWidth?newHeight="":isNum(newWidth/origRatio)&&(newHeight=(0,dimensions.GU)(newWidth/origRatio))),pushUpdate((element=>{if("sticker"===element?.type){const aspectRatio=getStickerAspectRatio(element);return getUpdateObject(newWidth,Math.floor(newWidth/aspectRatio))}return getUpdateObject(newWidth,newHeight)}),!0)},"aria-label":(0,i18n.__)("Width","web-stories")},getMixedValueProps(width),{containerStyleOverride:shared_styles.t}))),react.createElement(sizePosition_Area,{area:"d"},react.createElement(Dash,null)),react.createElement(sizePosition_Area,{area:"h"},react.createElement(numericInput.A,{allowEmpty:disableHeight,suffix:(0,i18n._x)("H","The Height dimension","web-stories"),value:disableHeight?"":height,disabled:disableHeight,min:constants_MIN_MAX_HEIGHT.MIN,max:constants_MIN_MAX_HEIGHT.MAX,onChange:(evt,value)=>{const newHeight=value;let newWidth=width;lockAspectRatio&&(""===newHeight?newWidth="":isNum(newHeight*origRatio)&&(newWidth=(0,dimensions.GU)(newHeight*origRatio))),pushUpdate((element=>{if("sticker"===element?.type){const aspectRatio=getStickerAspectRatio(element);return getUpdateObject(Math.floor(newHeight*aspectRatio),newHeight)}return getUpdateObject(newWidth,newHeight)}),!0)},"aria-label":(0,i18n.__)("Height","web-stories"),isIndeterminate:story_editor_src_constants.jW===height,placeholder:heightPlaceholder,containerStyleOverride:shared_styles.t})),react.createElement(sizePosition_Area,{area:"l"},react.createElement(components_tooltip.A,{title:(0,i18n.__)("Lock aspect ratio","web-stories")},react.createElement(sizePosition_StyledLockToggle,{"aria-label":(0,i18n.__)("Lock aspect ratio","web-stories"),isLocked:lockAspectRatio||isAspectAlwaysLocked,disabled:isAspectAlwaysLocked,onClick:()=>!isAspectAlwaysLocked&&pushUpdate({lockAspectRatio:!lockAspectRatio},!0)}))),react.createElement(sizePosition_Area,{area:"r"},react.createElement(numericInput.A,sizePosition_extends({suffix:react.createElement(angle.A,null),unit:(0,i18n._x)("","Degrees, 0 - 360.","web-stories"),value:rotationAngle,min:constants_MIN_MAX_ROTATION.MIN,max:constants_MIN_MAX_ROTATION.MAX,onChange:(evt,value)=>pushUpdate({rotationAngle:value},!0),"aria-label":(0,i18n.__)("Rotation","web-stories"),canBeNegative:!0},getMixedValueProps(rotationAngle),{containerStyleOverride:shared_styles.t}))),canFlip&&react.createElement(sizePosition_Area,{area:"f"},react.createElement(flipControls.A,{onChange:value=>pushUpdateForObject("flip",value,constants_DEFAULT_FLIP,!0),value:flip})),react.createElement(sizePosition_Area,{area:"o"},react.createElement(opacity.A,props)),react.createElement(sizePosition_Area,{area:"c"},react.createElement(radius.A,sizePosition_extends({stackableGroupStyleOverride},props)))))};const textAccessibility=function TextAccessibilityPanel({selectedElements,pushUpdate}){const[tagNamesOverrides,setTagNamesOverrides]=(0,react_src.J0)(),{textElements}=(0,app_story.P3)((({state})=>({textElements:state.currentPage?.elements?.filter((({type})=>"text"===type)).map((({id,tagName,...rest})=>({id,...rest,tagName:tagNamesOverrides?.get(id)||tagName})))}))),onLinkClick=(0,react_src.hb)((evt=>{(0,tracking_src.MP)(evt,"click_headings_docs")}),[]),handleChange=(0,react_src.hb)(((evt,value)=>{setTagNamesOverrides(new Map(selectedElements.map((({id})=>[id,value])))),selectedElements.forEach((()=>{pushUpdate({tagName:value},!0)}))}),[pushUpdate,selectedElements]),tagNamesMap=(0,output_src.iG)(textElements),selectedElementsWithTagNames=selectedElements.map((element=>({...element,tagName:tagNamesMap.get(element.id),defaultTagName:element.tagName||"auto"}))),uniqueTagNames=[...new Set(selectedElementsWithTagNames.map((({tagName})=>tagName||"auto")))],currentValue=1===uniqueTagNames.length?uniqueTagNames[0]:story_editor_src_constants.jW,tagName=(0,shared.Bl)(selectedElementsWithTagNames,"defaultTagName","auto"),isIndeterminate=story_editor_src_constants.jW===tagName,selectedValue="auto"===tagName?"auto":currentValue,options=[{label:"auto"===selectedValue?(0,sprintf.A)((0,i18n.__)("Automatic (%s)","web-stories"),story_editor_src_constants.Dh[currentValue]||story_editor_src_constants.Q6):(0,i18n.__)("Automatic","web-stories"),value:"auto"},{label:story_editor_src_constants.Dh.h1,value:"h1"},{label:story_editor_src_constants.Dh.h2,value:"h2"},{label:story_editor_src_constants.Dh.h3,value:"h3"},{label:story_editor_src_constants.Dh.p,value:"p"}];return react.createElement(panel.RV,{name:"textAccessibility",title:(0,i18n.__)("Accessibility","web-stories")},react.createElement(components_form.fI,null,react.createElement(dropdown.A,{"data-testid":"text-accessibility-dropdown",title:(0,i18n.__)("Heading Levels","web-stories"),dropdownButtonLabel:(0,i18n.__)("Heading Levels","web-stories"),options,selectedValue,placeholder:isIndeterminate?story_editor_src_constants.Q6:currentValue,onMenuItemClick:handleChange,dropDownLabel:(0,i18n.__)("Heading Level","web-stories")})),react.createElement(typography_text.E.Paragraph,{size:types.$.XSmall},react.createElement(translateWithMarkup.A,{mapping:{a:react.createElement(typography_link.N,{href:(0,i18n.__)("https://wp.stories.google/docs/seo/","web-stories"),rel:"noreferrer",target:"_blank",onClick:onLinkClick,size:types.$.XSmall})}},(0,i18n.__)("<a>Learn more</a> about using headings in stories.","web-stories"))))};var content=__webpack_require__("./packages/story-editor/src/components/panels/panel/shared/content.js"),panel_panel=__webpack_require__("./packages/story-editor/src/components/panels/panel/panel.js"),letter_a_height=__webpack_require__("./packages/design-system/src/icons/letter_a_height.svg"),letter_a_width=__webpack_require__("./packages/design-system/src/icons/letter_a_width.svg"),align_text_left=__webpack_require__("./packages/design-system/src/icons/align_text_left.svg"),align_text_center=__webpack_require__("./packages/design-system/src/icons/align_text_center.svg"),align_text_right=__webpack_require__("./packages/design-system/src/icons/align_text_right.svg"),align_text_justified=__webpack_require__("./packages/design-system/src/icons/align_text_justified.svg"),letter_b_bold=__webpack_require__("./packages/design-system/src/icons/letter_b_bold.svg"),letter_i_italic=__webpack_require__("./packages/design-system/src/icons/letter_i_italic.svg"),letter_u_underline=__webpack_require__("./packages/design-system/src/icons/letter_u_underline.svg"),letter_t_uppercase=__webpack_require__("./packages/design-system/src/icons/letter_t_uppercase.svg");function style_extends(){return style_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},style_extends.apply(null,arguments)}const style_MIN_MAX_LINE_HEIGHT={MIN:.5,MAX:10},style_MIN_MAX_LETTER_SPACING={MIN:0,MAX:300},StyledNumericInput=(0,styled_components_browser_esm.Ay)(numericInput.A).withConfig({displayName:"style__StyledNumericInput",componentId:"sc-9ups92-0"})(["flex-grow:1;"]),style_Space=styled_components_browser_esm.Ay.div.withConfig({displayName:"style__Space",componentId:"sc-9ups92-1"})(["flex:0 0 3px;"]),StyledToggle=(0,styled_components_browser_esm.Ay)(toggleButton.f).withConfig({displayName:"style__StyledToggle",componentId:"sc-9ups92-2"})(["",";"],shared_styles.Y);function Toggle(props){return react.createElement(StyledToggle,style_extends({size:constants.Mp.Small,variant:constants.Ak.Square},props))}const style=function StylePanel({selectedElements,pushUpdate}){const{actions:{maybeEnqueueFontStyle}}=(0,font.Ln)(),textAlign=(0,shared.Bl)(selectedElements,"textAlign"),lineHeight=(0,shared.Bl)(selectedElements,"lineHeight"),{textInfo:{isBold,isItalic,isUnderline,isUppercase,letterSpacing,fontWeight},handlers:{handleClickBold,handleClickItalic,handleClickUnderline,handleClickUppercase,handleSetLetterSpacing}}=(0,useRichTextFormatting.A)(selectedElements,pushUpdate),setLetterSpacingMinMax=(0,react_src.hb)(((evt,value)=>handleSetLetterSpacing((0,range.qE)(value,style_MIN_MAX_LETTER_SPACING))),[handleSetLetterSpacing]);(0,components_form.jm)((({lineHeight:newLineHeight})=>({lineHeight:(0,range.qE)(newLineHeight,style_MIN_MAX_LINE_HEIGHT)})),[]);const handleTextAlign=(0,react_src.hb)((alignment=>()=>{pushUpdate({textAlign:textAlign===alignment?"":alignment},!0)}),[pushUpdate,textAlign]),isTrulyBold=!0===isBold,isTrulyItalic=!0===isItalic,isTrulyUnderline=!0===isUnderline,isTrulyUppercase=!0===isUppercase;return react.createElement(react.Fragment,null,react.createElement(components_form.fI,null,react.createElement(StyledNumericInput,{"aria-label":(0,i18n.__)("Line-height","web-stories"),isFloat:!0,value:lineHeight,min:style_MIN_MAX_LINE_HEIGHT.MIN,max:style_MIN_MAX_LINE_HEIGHT.MAX,suffix:react.createElement(letter_a_height.A,null),onChange:(evt,value)=>pushUpdate({lineHeight:value},!0),allowEmpty:!0,isIndeterminate:story_editor_src_constants.jW===lineHeight,placeholder:story_editor_src_constants.jW===lineHeight?story_editor_src_constants.Q6:null,containerStyleOverride:shared_styles.t}),react.createElement(style_Space,null),react.createElement(StyledNumericInput,{"aria-label":(0,i18n.__)("Letter-spacing","web-stories"),value:letterSpacing,min:style_MIN_MAX_LETTER_SPACING.MIN,max:style_MIN_MAX_LETTER_SPACING.MAX,suffix:react.createElement(letter_a_width.A,null),unit:"%",onChange:setLetterSpacingMinMax,allowEmpty:!0,isIndeterminate:story_editor_src_constants.jW===letterSpacing,placeholder:story_editor_src_constants.jW===letterSpacing?story_editor_src_constants.Q6:null,containerStyleOverride:shared_styles.t})),react.createElement(components_form.fI,null,react.createElement(Toggle,{isToggled:"left"===textAlign,onClick:handleTextAlign("left"),"aria-label":(0,i18n.__)("Align text left","web-stories")},react.createElement(align_text_left.A,null)),react.createElement(Toggle,{isToggled:"center"===textAlign,onClick:handleTextAlign("center"),"aria-label":(0,i18n.__)("Align text center","web-stories")},react.createElement(align_text_center.A,null)),react.createElement(Toggle,{isToggled:"right"===textAlign,onClick:handleTextAlign("right"),"aria-label":(0,i18n.__)("Align text right","web-stories")},react.createElement(align_text_right.A,null)),react.createElement(Toggle,{isToggled:"justify"===textAlign,onClick:handleTextAlign("justify"),"aria-label":(0,i18n.__)("Align text justified","web-stories")},react.createElement(align_text_justified.A,null)),react.createElement(Toggle,{isToggled:isTrulyBold,onClick:()=>handleClickBold(!isTrulyBold),"aria-label":(0,i18n.__)("Bold","web-stories")},react.createElement(letter_b_bold.A,null)),react.createElement(Toggle,{isToggled:isTrulyItalic,onClick:async()=>{await maybeEnqueueFontStyle(selectedElements.map((({font,content})=>({font,fontStyle:isTrulyItalic?"normal":"italic",fontWeight,content:(0,dom_src._e)(content)})))),handleClickItalic(!isTrulyItalic)},"aria-label":(0,i18n.__)("Italic","web-stories")},react.createElement(letter_i_italic.A,null)),react.createElement(Toggle,{isToggled:isTrulyUnderline,onClick:()=>handleClickUnderline(!isTrulyUnderline),"aria-label":(0,i18n.__)("Underline","web-stories")},react.createElement(letter_u_underline.A,null)),react.createElement(Toggle,{isToggled:isTrulyUppercase,onClick:()=>handleClickUppercase(!isTrulyUppercase),"aria-label":(0,i18n.__)("Uppercase","web-stories")},react.createElement(letter_t_uppercase.A,null))))};var hasGradient=__webpack_require__("./packages/patterns/src/hasGradient.ts"),createSolid=__webpack_require__("./packages/patterns/src/createSolid.ts"),patterns_src_constants=__webpack_require__("./packages/patterns/src/constants.ts");const color=function ColorControls({selectedElements,pushUpdate,textColorRef}){const{textInfo:{color,gradientColor},handlers:{handleSetColor,handleSetGradientColor}}=(0,useRichTextFormatting.A)(selectedElements,pushUpdate),colorInputValue=gradientColor===story_editor_src_constants.jW?story_editor_src_constants.jW:(0,hasGradient.A)(gradientColor)?gradientColor:color;return react.createElement(components_form.fI,null,react.createElement(components_form.Q1,{"data-testid":"text.color",value:colorInputValue,onChange:colorValue=>{(0,hasGradient.A)(colorValue)?(handleSetColor((0,createSolid.A)(0,0,0)),handleSetGradientColor(colorValue)):(handleSetGradientColor(patterns_src_constants.vK),handleSetColor(colorValue))},allowsSavedColors:!0,label:(0,i18n.__)("Text color","web-stories"),labelId:"text-color-label",ref:textColorRef,hasEyedropper:!0,allowsGradient:!0}))};var textStyle_font=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/font.js"),pillGroup=__webpack_require__("./packages/design-system/src/components/pill/pillGroup.tsx"),useCommonColorValue=__webpack_require__("./packages/story-editor/src/components/panels/shared/useCommonColorValue.js"),getCommonValue=__webpack_require__("./packages/story-editor/src/components/panels/shared/getCommonValue.js");const FillRow=(0,styled_components_browser_esm.Ay)(components_form.fI).withConfig({displayName:"backgroundColor__FillRow",componentId:"sc-2oqmdd-0"})(["align-items:flex-start;justify-content:space-between;button{flex:1;z-index:1;}"]),FILL_OPTIONS=[{id:elements_src.xu.NONE,label:(0,i18n.__)("None","web-stories")},{id:elements_src.xu.FILL,label:(0,i18n.__)("Fill","web-stories")},{id:elements_src.xu.HIGHLIGHT,label:(0,i18n.__)("Highlight","web-stories")}];const backgroundColor=function BackgroundControls({selectedElements,pushUpdate}){const backgroundColor=(0,useCommonColorValue.A)(selectedElements,"backgroundColor"),backgroundTextMode=(0,getCommonValue.A)(selectedElements,"backgroundTextMode"),fillRow=(0,react_src.li)(),pushBackgroundTextMode=(0,react_src.hb)((mode=>{pushUpdate((element=>({backgroundTextMode:mode,padding:[elements_src.xu.FILL,elements_src.xu.HIGHLIGHT].includes(mode)?(0,textStyle_utils.oB)(element):(0,textStyle_utils.Ei)(element)})),!0)}),[pushUpdate]),onSelect=(0,react_src.hb)((mode=>{pushBackgroundTextMode(mode)}),[pushBackgroundTextMode]);return react.createElement(react.Fragment,null,react.createElement(FillRow,{ref:fillRow},react.createElement(pillGroup.A,{value:backgroundTextMode,onSelect,options:FILL_OPTIONS,pillStyleOverride:shared_styles.Y})),backgroundTextMode!==elements_src.xu.NONE&&react.createElement(components_form.fI,null,react.createElement(components_form.Q1,{"data-testid":"text.backgroundColor",allowsGradient:!0,allowsSavedColors:!0,value:backgroundColor,onChange:value=>pushUpdate({backgroundColor:value},!0),label:(0,i18n.__)("Background color","web-stories"),labelId:"background-color-label",changedStyle:"background",hasEyedropper:!0})))};var turning_line=__webpack_require__("./packages/design-system/src/icons/turning_line.svg");function padding_extends(){return padding_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},padding_extends.apply(null,arguments)}const DEFAULT_PADDING={horizontal:0,vertical:0,locked:!0,hasHiddenPadding:!1},padding_MIN_MAX_PADDING={MIN:0,MAX:300},padding_Space=styled_components_browser_esm.Ay.div.withConfig({displayName:"padding__Space",componentId:"sc-17x5rfj-0"})(["flex:0 0 8px;"]),LockToggle=(0,styled_components_browser_esm.Ay)(toggleButton.m).withConfig({displayName:"padding__LockToggle",componentId:"sc-17x5rfj-1"})([""," ",";"],(({isLocked})=>!isLocked&&"\n    position: absolute;\n    right: 0;\n    top: calc(100% - 8px);\n  "),shared_styles.Y),padding_Row=(0,styled_components_browser_esm.Ay)(components_form.fI).withConfig({displayName:"padding__Row",componentId:"sc-17x5rfj-2"})(["position:relative;"]),padding_IconWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"padding__IconWrapper",componentId:"sc-17x5rfj-3"})(["width:44px;margin-left:6px;color:",";"," svg{width:22px;}"],(({theme})=>theme.colors.divider.primary),(({reverse})=>reverse&&"transform: scaleY(-1);"));const padding=function PaddingControls({selectedElements,pushUpdateForObject,pushUpdate}){const displayedPadding=(0,shared.dP)(selectedElements.map((el=>({...el,padding:(0,textStyle_utils.Ei)(el)}))),"padding",DEFAULT_PADDING),lockPadding=!0===displayedPadding.locked,handleChange=(0,react_src.hb)((updater=>{pushUpdate((el=>{const{x,y,width,height}=el,newPadding=updater(el);return function metricsForTextPadding({currentPadding,newPadding,x,y,width,height}){const updates={};return"horizontal"in newPadding&&(updates.x=x-(newPadding.horizontal-(currentPadding.horizontal||0)),updates.width=width+2*(newPadding.horizontal-(currentPadding.horizontal||0))),"vertical"in newPadding&&(updates.y=y-(newPadding.vertical-(currentPadding.vertical||0)),updates.height=height+2*(newPadding.vertical-(currentPadding.vertical||0))),updates}({x,y,height,width,currentPadding:el.padding,newPadding})})),pushUpdateForObject("padding",(v=>updater({padding:v})),DEFAULT_PADDING,!0)}),[pushUpdate,pushUpdateForObject]);(0,components_form.jm)((({padding:{horizontal,vertical,...rest}})=>({padding:{...rest,horizontal:(0,range.qE)(horizontal,padding_MIN_MAX_PADDING),vertical:(0,range.qE)(vertical,padding_MIN_MAX_PADDING)}})),[]);const firstInputProperties=lockPadding?{suffix:(0,i18n.__)("Padding","web-stories"),"aria-label":(0,i18n.__)("Padding","web-stories"),onChange:(evt,value)=>{handleChange((el=>({horizontal:value+(0,textStyle_utils.io)(el,"horizontal"),vertical:value+(0,textStyle_utils.io)(el,"vertical")})))},stretch:!0}:{suffix:(0,i18n.__)("Horizontal padding","web-stories"),"aria-label":(0,i18n.__)("Horizontal padding","web-stories"),onChange:(evt,value)=>{handleChange((el=>({horizontal:value+(0,textStyle_utils.io)(el,"horizontal")})))}};return react.createElement(react.Fragment,null,react.createElement(padding_Row,null,react.createElement(numericInput.A,padding_extends({value:displayedPadding.horizontal,isIndeterminate:displayedPadding.horizontal===story_editor_src_constants.jW,placeholder:displayedPadding.horizontal===story_editor_src_constants.jW?story_editor_src_constants.Q6:null},firstInputProperties,{containerStyleOverride:shared_styles.t})),lockPadding&&react.createElement(padding_Space,null),react.createElement(LockToggle,{isLocked:lockPadding,onClick:()=>handleChange((el=>lockPadding?{locked:!1}:{locked:!0,horizontal:el.padding.horizontal,vertical:el.padding.horizontal+(0,textStyle_utils.io)(el,"vertical")-(0,textStyle_utils.io)(el,"horizontal")})),"aria-label":(0,i18n.__)("Toggle padding ratio lock","web-stories")}),!lockPadding&&react.createElement(padding_IconWrapper,{reverse:!0},react.createElement(turning_line.A,null))),!lockPadding&&react.createElement(padding_Row,null,react.createElement(numericInput.A,{isIndeterminate:displayedPadding.vertical===story_editor_src_constants.jW,placeholder:displayedPadding.vertical===story_editor_src_constants.jW?story_editor_src_constants.Q6:null,suffix:(0,i18n.__)("Vertical padding","web-stories"),value:displayedPadding.vertical,onChange:(evt,value)=>{handleChange((el=>({vertical:Number(value)+(0,textStyle_utils.io)(el,"vertical")})))},"aria-label":(0,i18n.__)("Vertical padding","web-stories"),containerStyleOverride:shared_styles.t}),react.createElement(padding_IconWrapper,null,react.createElement(turning_line.A,null))))};var color_bucket=__webpack_require__("./packages/design-system/src/icons/color_bucket.svg"),useApplyTextAutoStyle=__webpack_require__("./packages/story-editor/src/utils/useApplyTextAutoStyle.js"),shared_title=__webpack_require__("./packages/story-editor/src/components/panels/panel/shared/title.js"),panel_context=__webpack_require__("./packages/story-editor/src/components/panels/panel/context.js");const AutoStyleButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({variant:constants.Ak.Square,type:constants.VQ.Tertiary,size:constants.Mp.Small}).withConfig({displayName:"panelHeader__AutoStyleButton",componentId:"sc-1sprex4-0"})(["",";"],(({theme})=>outline.Q(theme.colors.border.focus,"#1d1f20")));const panelHeader=function PanelHeader({selectedElements,pushUpdate}){const{state:{isCollapsed}}=(0,react_src.NT)(panel_context.A),applyTextAutoStyle=(0,useApplyTextAutoStyle.A)(selectedElements[0],(textProps=>{pushUpdate(textProps,!0),(0,tracking_src.sx)("auto_style_text")})),panelTitle=(0,i18n.__)("Text","web-stories");return react.createElement(shared_title.A,{ariaLabel:panelTitle,secondaryAction:isCollapsed?null:react.createElement(components_tooltip.A,{title:(0,i18n.__)("Adaptive text colors","web-stories")},react.createElement(AutoStyleButton,{"aria-label":(0,i18n.__)("Adaptive text colors","web-stories"),onClick:applyTextAutoStyle,disabled:selectedElements?.length>1},react.createElement(color_bucket.A,null)))},panelTitle)},PresetsHeader=styled_components_browser_esm.Ay.div.withConfig({displayName:"stylePresets__PresetsHeader",componentId:"sc-8grd53-0"})(["display:flex;padding:8px 0;justify-content:space-between;"]),stylePresets_StylesWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"stylePresets__StylesWrapper",componentId:"sc-8grd53-1"})([""]),stylePresets_NoStylesWrapper=(0,styled_components_browser_esm.Ay)(NoStylesWrapper).withConfig({displayName:"stylePresets__NoStylesWrapper",componentId:"sc-8grd53-2"})(["width:calc(100% + 28px);"]),SubHeading=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"stylePresets__SubHeading",componentId:"sc-8grd53-3"})(["color:",";margin:6px 0;font-weight:",";"],(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.typography.weight.bold)),textStyle_stylePresets_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"stylePresets__StyledButton",componentId:"sc-8grd53-4"})(["margin-left:auto;"]),stylePresets_NoStylesText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"stylePresets__NoStylesText",componentId:"sc-8grd53-5"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary)),stylePresets_SPACING={x:12};const textStyle_stylePresets=function stylePresets_PresetPanel({pushUpdate}){const textStyles=(0,app.P3)((({state})=>state.story.globalStoryStyles.textStyles)),{refs:{sidebar}}=(0,useSidebar.A)(),buttonRef=(0,react_src.li)(null),[isPopupOpen,setIsPopupOpen]=(0,react_src.J0)(!1),hasPresets=textStyles.length>0,handleApplyStyle=styleManager_useApplyStyle({pushUpdate}),{addGlobalPreset}=(0,useAddPreset.A)({presetType:story_editor_src_constants.aS.STYLE}),handlePresetClick=preset=>{handleApplyStyle(preset)};return react.createElement(react.Fragment,null,react.createElement(PresetsHeader,null,react.createElement(SubHeading,{size:types.$.Small},(0,i18n.__)("Recently Saved Styles","web-stories")),react.createElement(textStyle_stylePresets_StyledButton,{type:constants.VQ.Tertiary,size:constants.Mp.Small,variant:constants.Ak.Square,onClick:addGlobalPreset,"aria-label":(0,i18n.__)("Add style","web-stories")},react.createElement(plus.A,null))),hasPresets&&react.createElement(react.Fragment,null,react.createElement(stylePresets_StylesWrapper,null,react.createElement(styleGroup,{styles:[...textStyles].reverse().slice(0,2),handleClick:handlePresetClick})),react.createElement(MoreButton,{ref:buttonRef,onClick:()=>setIsPopupOpen(!0),"aria-haspopup":"dialog","aria-expanded":isPopupOpen},(0,i18n.__)("More styles","web-stories"),react.createElement(disclosure.A,{$isOpen:isPopupOpen})),react.createElement(popup.A,{anchor:buttonRef,dock:sidebar,isOpen:isPopupOpen,placement:popup_constants.W.RightStart,spacing:stylePresets_SPACING,renderContents:()=>react.createElement(styleManager,{styles:textStyles,applyStyle:handlePresetClick,onClose:()=>setIsPopupOpen(!1)})})),!hasPresets&&react.createElement(stylePresets_NoStylesWrapper,null,react.createElement(stylePresets_NoStylesText,{size:types.$.Small},(0,i18n.__)("No Styles Saved","web-stories"))))};function textStyle_extends(){return textStyle_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},textStyle_extends.apply(null,arguments)}const SubSection=styled_components_browser_esm.Ay.section.withConfig({displayName:"textStyle__SubSection",componentId:"sc-1al6pl8-0"})(["border-top:1px solid ",";display:flex;flex-direction:column;"],(({theme})=>theme.colors.border.defaultNormal)),textStyle_SubHeading=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"textStyle__SubHeading",componentId:"sc-1al6pl8-1"})(["color:",";margin:14px 0;font-weight:",";"],(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.typography.weight.bold));const textStyle=function textStyle_StylePanel(props){const{dropdownHighlight,colorHighlight,resetHighlight,cancelHighlight}=(0,highlights.N)((state=>({dropdownHighlight:state[highlights.xP.Font],colorHighlight:state[highlights.xP.TextColor],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),[fontsFocused,setFontsFocused]=(0,react_src.J0)(!1),[failedElementIds,setFailedElementIds]=(0,react_src.J0)([]),{selectedElements}=props;(0,components_form.jm)(getUpdatedSizeAndPosition.A,[]);const{currentPage}=(0,app.P3)((({state:{currentPage}})=>({currentPage}))),pageSize=(0,app.gK)((({state:{pageWidth,pageHeight}})=>({width:pageWidth,height:pageHeight}))),selectedElementIds=selectedElements.map((({id})=>id)),showContrastWarning=failedElementIds?.some((({id})=>selectedElementIds.includes(id)));return(0,react_src.vJ)((()=>{(0,checklist.g4)([currentPage],pageSize).then((pages=>{const elementIds=pages[0]?.result;setFailedElementIds(elementIds)})).catch(noop.l)}),[currentPage,pageSize]),react.createElement(_StyledPanel,{name:"textStyle",onAnimationEnd:()=>resetHighlight(),isPersistable:!1,$_css:(dropdownHighlight?.showEffect||colorHighlight?.showEffect)&&highlights_styles.A.FLASH},react.createElement(panelHeader,props),react.createElement(content.A,null,react.createElement(textStyle_font.A,textStyle_extends({},props,{fontDropdownRef:node=>{node&&dropdownHighlight?.focus&&dropdownHighlight?.showEffect&&(node.focus(),setFontsFocused(!0))},highlightStylesOverride:fontsFocused?highlights_styles.A.OUTLINE:[]})),react.createElement(style,props),react.createElement(color,textStyle_extends({},props,{textColorRef:node=>{node&&colorHighlight?.focus&&colorHighlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus(),setFontsFocused(!1))}})),showContrastWarning&&react.createElement(warning,{message:checklist.br.lowContrast.textPanel}),react.createElement(SubSection,null,react.createElement(textStyle_SubHeading,{size:types.$.Small},(0,i18n.__)("Text Box","web-stories")),react.createElement(backgroundColor,props),react.createElement(padding,props)),react.createElement(SubSection,null,react.createElement(textStyle_stylePresets,props))))};var _StyledPanel=(0,styled_components_browser_esm.Ay)(panel_panel.Ay).withConfig({displayName:"textStyle___StyledPanel",componentId:"sc-1al6pl8-2"})(["",""],(p=>p.$_css)),translateToExclusiveList=__webpack_require__("./packages/i18n/src/translateToExclusiveList.ts");const videoAccessibility_DEFAULT_RESOURCE={alt:null,poster:null,height:0,width:0},videoAccessibility_MIN_MAX_ALT_TEXT={MAX:1e3},StyledMedia=(0,styled_components_browser_esm.Ay)(components_form.$U).withConfig({displayName:"videoAccessibility__StyledMedia",componentId:"sc-1uodz5m-0"})(["height:114px;width:64px;"]),InputsWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"videoAccessibility__InputsWrapper",componentId:"sc-1uodz5m-1"})(["align-self:flex-start;margin-left:16px;"]),videoAccessibility_StyledText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"videoAccessibility__StyledText",componentId:"sc-1uodz5m-2"})(["color:",";margin-bottom:10px;"],(({theme})=>theme.colors.fg.secondary));const videoAccessibility=function VideoAccessibilityPanel({selectedElements,pushUpdate}){const resource=(0,shared.dP)(selectedElements,"resource",videoAccessibility_DEFAULT_RESOURCE),alt=(0,shared.Bl)(selectedElements,"alt",resource.alt),{height,width}=resource,rawPoster=(0,shared.Bl)(selectedElements,"poster"),poster=(0,shared.Bl)(selectedElements,"poster",resource.poster),{allowedMimeTypes:{image:allowedImageMimeTypes},capabilities:{hasUploadMediaAction}}=(0,app_config.UK)(),options=[hasUploadMediaAction&&"upload",hasUploadMediaAction&&"edit","hotlink",poster!==resource.poster&&"reset"].filter(Boolean),allowedImageFileTypes=(0,react_src.Kr)((()=>allowedImageMimeTypes.flatMap((type=>(0,src_mimeTypes.n)(type)))),[allowedImageMimeTypes]),handleChangePoster=(0,react_src.hb)((newPoster=>{newPoster?.src!==rawPoster&&pushUpdate({poster:newPoster?.src},!0)}),[pushUpdate,rawPoster]),posterErrorMessage=(0,react_src.Kr)((()=>{let message=(0,i18n.__)("No file types are currently supported.","web-stories");return allowedImageFileTypes.length&&(message=(0,sprintf.A)((0,i18n.__)("Please choose only %s as a poster.","web-stories"),(0,translateToExclusiveList.A)(allowedImageFileTypes))),message}),[allowedImageFileTypes]),{highlightInput,highlightMediaPicker,resetHighlight,cancelHighlight}=(0,highlights.N)((state=>({highlightInput:state[highlights.xP.AssistiveText],highlightMediaPicker:state[highlights.xP.VideoA11yPoster],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));let cropParams=null;return height&&height!==story_editor_src_constants.jW&&width&&width!==story_editor_src_constants.jW&&(cropParams={height,width}),react.createElement(videoAccessibility_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"videoAccessibility",title:(0,i18n.__)("Accessibility","web-stories"),isPersistable:!highlightInput&&!highlightMediaPicker,$_css:(highlightInput||highlightMediaPicker)&&highlights_styles.A.FLASH},react.createElement(components_form.fI,null,react.createElement(StyledMedia,{ref:node=>{node&&highlightMediaPicker?.focus&&highlightMediaPicker?.showEffect&&node.focus()},value:poster,cropParams,onChange:handleChangePoster,onChangeErrorText:posterErrorMessage,title:(0,i18n.__)("Select as video poster","web-stories"),hotlinkTitle:(0,i18n.__)("Use external image as video poster","web-stories"),hotlinkInsertText:(0,i18n.__)("Use image as video poster","web-stories"),hotlinkInsertingText:(0,i18n.__)("Using image as video poster","web-stories"),buttonInsertText:(0,i18n.__)("Set as video poster","web-stories"),alt:(0,i18n.__)("Preview poster image","web-stories"),type:allowedImageMimeTypes,ariaLabel:(0,i18n.__)("Video poster","web-stories"),menuOptions:options,imgProps:cropParams,canUpload:0!==options.length}),react.createElement(InputsWrapper,null,react.createElement(videoAccessibility_StyledText,{size:types.$.Small},(0,i18n.__)("Add a brief description of the video.","web-stories")),react.createElement(components_form.fs,{ref:node=>{node&&highlightInput?.focus&&highlightInput?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},placeholder:alt===story_editor_src_constants.jW?story_editor_src_constants.Q6:"",value:alt||"",onChange:evt=>pushUpdate({alt:evt?.target?.value?.trim()||null},!0),"aria-label":(0,i18n.__)("Assistive text","web-stories"),maxLength:videoAccessibility_MIN_MAX_ALT_TEXT.MAX,rows:2,isIndeterminate:alt===story_editor_src_constants.jW}))))};var videoAccessibility_StyledSimplePanel=(0,styled_components_browser_esm.Ay)(panel.RV).withConfig({displayName:"videoAccessibility___StyledSimplePanel",componentId:"sc-1uodz5m-3"})(["",""],(p=>p.$_css)),slider=__webpack_require__("./packages/design-system/src/components/slider/slider.tsx"),circular=__webpack_require__("./packages/design-system/src/components/circularProgress/circular.tsx"),useVideoElementTranscoding=__webpack_require__("./packages/story-editor/src/app/media/utils/useVideoElementTranscoding.js"),loopPanelContent=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/loopPanelContent.js");const videoOptions_Row=(0,styled_components_browser_esm.Ay)(components_form.fI).withConfig({displayName:"videoOptions__Row",componentId:"sc-csxmtu-0"})(["margin-top:2px;"]),videoOptions_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"videoOptions__StyledButton",componentId:"sc-csxmtu-1"})(["padding:12px 8px;"]),TrimButton=(0,styled_components_browser_esm.Ay)(videoOptions_StyledButton).withConfig({displayName:"videoOptions__TrimButton",componentId:"sc-csxmtu-2"})(["margin-left:20px;"]),TrimWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"videoOptions__TrimWrapper",componentId:"sc-csxmtu-3"})(["position:relative;display:flex;"]),Spinner=styled_components_browser_esm.Ay.div.withConfig({displayName:"videoOptions__Spinner",componentId:"sc-csxmtu-4"})(["margin-left:4px;margin-top:4px;"]),StyledSlider=(0,styled_components_browser_esm.Ay)(slider.A).withConfig({displayName:"videoOptions__StyledSlider",componentId:"sc-csxmtu-5"})(["width:100%;"]),VolumeWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"videoOptions__VolumeWrapper",componentId:"sc-csxmtu-6"})(["margin-bottom:20px;"]),videoOptions_HelperText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.XSmall}).withConfig({displayName:"videoOptions__HelperText",componentId:"sc-csxmtu-7"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary));const videoOptions=function VideoOptionsPanel({selectedElements,pushUpdate}){const resource=(0,shared.Bl)(selectedElements,"resource"),elementId=(0,shared.Bl)(selectedElements,"id"),loop=(0,shared.Bl)(selectedElements,"loop"),volume=(0,shared.Bl)(selectedElements,"volume",1),isSingleElement=1===selectedElements.length,showVolumeControl=(0,flagged_esm.iT)("videoVolume")&&isSingleElement&&!resource?.isMuted,{state:{canTrim,canMute,isTrimming,isMuting,isDisabled},actions:{handleMute,handleTrim}}=(0,useVideoElementTranscoding.A)({resource,elementId,isSingleElement}),muteButtonText=isMuting?(0,i18n.__)("Removing audio","web-stories"):(0,i18n.__)("Remove audio","web-stories"),trimButtonText=isTrimming?(0,i18n.__)("Trimming","web-stories"):(0,i18n.__)("Trim","web-stories"),speak=(0,useLiveRegion.A)();(0,react_src.vJ)((()=>{isMuting&&speak(muteButtonText)}),[isMuting,muteButtonText,speak]),(0,react_src.vJ)((()=>{isTrimming&&speak(trimButtonText)}),[isTrimming,trimButtonText,speak]);const slideId=(0,react_src.FF)((()=>`slide-${(0,v4.A)()}`)),Processing=()=>react.createElement(Spinner,null,react.createElement(circular.A,{size:24}));return react.createElement(panel.RV,{name:"videoOptions",title:(0,i18n.__)("Video Settings","web-stories")},react.createElement(videoOptions_Row,{spaceBetween:!1},react.createElement(loopPanelContent.A,{loop,onChange:evt=>pushUpdate({loop:evt.target.checked},!0)}),canTrim&&react.createElement(TrimWrapper,null,react.createElement(TrimButton,{disabled:isDisabled,variant:constants.Ak.Rectangle,type:constants.VQ.Secondary,size:constants.Mp.Small,onClick:handleTrim},trimButtonText),isTrimming&&react.createElement(Processing,null))),showVolumeControl&&react.createElement(VolumeWrapper,null,react.createElement(typography_text.E.Label,{size:types.$.Small,htmlFor:slideId},(0,i18n.__)("Volume","web-stories")),react.createElement(StyledSlider,{value:Math.round(100*volume),handleChange:value=>{const newVolume=Math.max(.1,value/100);pushUpdate({volume:newVolume},!0)},minorStep:5,majorStep:10,min:0,max:100,id:slideId,"aria-label":(0,i18n.__)("Volume","web-stories")})),canMute&&react.createElement(react.Fragment,null,react.createElement(videoOptions_Row,{spaceBetween:!1},react.createElement(videoOptions_StyledButton,{disabled:isDisabled,variant:constants.Ak.Rectangle,type:constants.VQ.Secondary,size:constants.Mp.Small,onClick:handleMute},muteButtonText),isMuting&&react.createElement(Processing,null)),react.createElement(videoOptions_Row,null,react.createElement(videoOptions_HelperText,null,(0,i18n.__)("Removing the audio from this video will upload a new muted version of it to the media library. This might take a couple of seconds.","web-stories")))))},videoSegment_Row=(0,styled_components_browser_esm.Ay)(components_form.fI).withConfig({displayName:"videoSegment__Row",componentId:"sc-ohj8ek-0"})(["margin-top:2px;"]),videoSegment_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"videoSegment__StyledButton",componentId:"sc-ohj8ek-1"})(["padding:12px 8px;"]),SliderWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"videoSegment__SliderWrapper",componentId:"sc-ohj8ek-2"})(["flex:1;margin-right:20px;"]),videoSegment_StyledSlider=(0,styled_components_browser_esm.Ay)(slider.A).withConfig({displayName:"videoSegment__StyledSlider",componentId:"sc-ohj8ek-3"})(["width:100%;"]),videoSegment_HelperText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.XSmall}).withConfig({displayName:"videoSegment__HelperText",componentId:"sc-ohj8ek-4"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary));const videoSegment=function VideoSegmentPanel({pushUpdate,selectedElements}){const resource=(0,shared.Bl)(selectedElements,"resource"),elementId=(0,shared.Bl)(selectedElements,"id"),enableSegmentVideo=(0,flagged_esm.iT)("segmentVideo"),segmentTime=(0,shared.Bl)(selectedElements,"segmentTime",20),{pageIds,currentPageId,deleteElementById,addElementsAcrossPages}=(0,app_story.P3)((({state:{pages,currentPageId},actions:{deleteElementById,addElementsAcrossPages}})=>({pageIds:pages.map((({id})=>id)),currentPageId,deleteElementById,addElementsAcrossPages}))),{isBatchUploading,segmentVideo}=(0,app_media.HZ)((({state:{isBatchUploading},actions:{segmentVideo}})=>({segmentVideo,isBatchUploading}))),[batchId,setBatchId]=(0,react_src.J0)(),[isSegmenting,setIsSegmenting]=(0,react_src.J0)(),[segmentedFiles,setSegmentedFiles]=(0,react_src.J0)([]),[segmentElementId,setSegmentElementId]=(0,react_src.J0)(),[segmentPageId,setSegmentPageId]=(0,react_src.J0)(),isUploading=batchId&&isBatchUploading(batchId),showSnackbar=(0,useSnackbar.d)((({showSnackbar})=>showSnackbar)),segmentButtonText=isSegmenting?(0,i18n.__)("Segmenting","web-stories"):(0,i18n.__)("Segment","web-stories"),addElementsToPages=(0,react_src.hb)((()=>{if(!segmentPageId||!segmentElementId)return;showSnackbar({message:(0,i18n.__)("Inserting video segments","web-stories"),dismissible:!1});const elements=segmentedFiles.map((segmentedResource=>(0,elements_src.N3)(segmentedResource.type,(0,getElementProperties.A)(segmentedResource.type,{resource:segmentedResource})))),page=(0,elements_src.a3)(),position=pageIds.indexOf(segmentPageId);addElementsAcrossPages({elements,page,position}),deleteElementById({elementId:segmentElementId}),setSegmentedFiles([]),setIsSegmenting(!1),setBatchId(null)}),[segmentPageId,segmentElementId,showSnackbar,segmentedFiles,pageIds,addElementsAcrossPages,deleteElementById]),onClick=(0,react_src.hb)((async()=>{setIsSegmenting(!0),setSegmentElementId(elementId),setSegmentPageId(currentPageId),showSnackbar({message:(0,i18n.__)("Video segmentation in progress","web-stories"),dismissible:!0});const batchId_=await segmentVideo({resource,segmentTime},(({resource:newResource,batchPosition})=>{setSegmentedFiles((f=>(f[batchPosition]=newResource,f)))}));if(!batchId_)return showSnackbar({message:(0,i18n.__)("Segmentation failed","web-stories"),dismissible:!0}),void setIsSegmenting(!1);setBatchId(batchId_)}),[elementId,currentPageId,showSnackbar,segmentVideo,segmentTime,resource]);return(0,react_src.vJ)((()=>{!isUploading&&segmentedFiles.length>=1&&addElementsToPages()}),[isUploading,segmentedFiles,addElementsToPages]),!enableSegmentVideo||resource.length<=10?null:react.createElement(panel.RV,{name:"videoOptions",title:(0,i18n.__)("Video Segment Settings","web-stories")},react.createElement(videoSegment_Row,{spaceBetween:!0},react.createElement(SliderWrapper,null,react.createElement(videoSegment_StyledSlider,{value:segmentTime,handleChange:value=>{pushUpdate({segmentTime:value},!0)},minorStep:1,majorStep:5,min:10,max:Math.max(10,Math.min(resource.length,60)),"aria-label":(0,i18n.__)("Segment length","web-stories"),suffix:"s"})),react.createElement(videoSegment_StyledButton,{disabled:isSegmenting,variant:constants.Ak.Rectangle,type:constants.VQ.Secondary,size:constants.Mp.Small,onClick},segmentButtonText)),react.createElement(videoSegment_Row,null,react.createElement(videoSegment_HelperText,null,(0,i18n.__)("Segmenting your video will split the video across multiple pages","web-stories"))))},ALL=Object.values(panelTypes.A);const style_getDesignPanelsForSelection=function getDesignPanelsForSelection(elements){if(0===elements.length)return[];if(1===elements.length&&elements[0].isBackground){const panels=[];return!elements[0].isDefaultBackground&&(panels.push({type:panelTypes.A.PageBackground,Panel:pageBackground}),panels.push({type:panelTypes.A.Filter,Panel:filter}),panels.push({type:panelTypes.A.Animation,Panel:animation})),"video"===elements[0].type?(panels.push({type:panelTypes.A.VideoOptions,Panel:videoOptions}),panels.push({type:panelTypes.A.VideoSegment,Panel:videoSegment}),panels.push({type:panelTypes.A.Captions,Panel:captions}),panels.push({type:panelTypes.A.VideoAcessibility,Panel:videoAccessibility})):["gif","image"].includes(elements[0].type)?panels.push({type:panelTypes.A.ImageAccessibility,Panel:imageAccessibility}):panels.unshift({type:panelTypes.A.PageBackground,Panel:pageBackground}),panels.push({type:panelTypes.A.PageAttachment,Panel:pageAttachment}),panels.push({type:panelTypes.A.PageBackgroundAudio,Panel:backgroundAudio}),panels.push({type:panelTypes.A.PageAdvancement,Panel:customPageAdvancement}),panels}return elements.map((({type})=>elements_src.Wk[type].panels)).reduce(((commonPanels,panels)=>function intersect(a,b){return a.filter((v=>b.includes(v)))}(commonPanels,panels)),ALL).map((type=>{switch(type){case panelTypes.A.Animation:return{type,Panel:animation};case panelTypes.A.PageBackground:return null;case panelTypes.A.Filter:return{type,Panel:filter};case panelTypes.A.SizePosition:return{type,Panel:sizePosition};case panelTypes.A.Link:return{type,Panel:link_link};case panelTypes.A.TextStyle:return{type,Panel:textStyle};case panelTypes.A.TextAccessibility:return{type,Panel:textAccessibility};case panelTypes.A.ShapeStyle:return{type,Panel:shapeStyle};case panelTypes.A.Border:return{type,Panel:border};case panelTypes.A.VideoOptions:return{type,Panel:videoOptions};case panelTypes.A.VideoSegment:return{type,Panel:videoSegment};case panelTypes.A.Captions:return{type,Panel:captions};case panelTypes.A.VideoAcessibility:return{type,Panel:videoAccessibility};case panelTypes.A.ImageAccessibility:return{type,Panel:imageAccessibility};case panelTypes.A.ElementAlignment:return{type,Panel:alignment};case panelTypes.A.Product:return{type,Panel:product};case panelTypes.A.AudioSticker:return{type,Panel:audioStickerStyle};default:throw new Error(`Unknown panel: ${type}`)}})).filter((panel=>panel))};const style_useDesignPanels=function useDesignPanels(){const{selectedElementIds,selectedElements,selectedElementAnimations,deleteSelectedElements,updateElementsById,updateAnimationState}=(0,app.P3)((({state:{selectedElementIds,selectedElements,selectedElementAnimations},actions:{deleteSelectedElements,updateElementsById,updateAnimationState}})=>({selectedElementIds,selectedElements,selectedElementAnimations,deleteSelectedElements,updateElementsById,updateAnimationState}))),panels=(0,react_src.Kr)((()=>style_getDesignPanelsForSelection(selectedElements)),[selectedElements]),[submitHandlers,registerSubmitHandler]=utils_useHandlers(),onSetProperties=(0,react_src.hb)((newPropertiesOrUpdater=>{updateElementsById({elementIds:selectedElementIds,properties:element=>(0,updateProperties.A)(element,newPropertiesOrUpdater,!0)})}),[selectedElementIds,updateElementsById]),createSubmitHandlerForPanel=(0,react_src.hb)((panelId=>submit=>(submitHandlers.forEach((handler=>handler(onSetProperties,panelId,submit))),submit)),[onSetProperties,submitHandlers]);return(0,react_src.vJ)((()=>{const submits={},unregister=registerSubmitHandler(((onSetPropertiesArg,panelId,submit)=>{onSetProperties===onSetPropertiesArg&&(submits[panelId]=submit)}));return()=>{unregister(),Object.values(submits).forEach((submit=>submit()))}}),[onSetProperties,registerSubmitHandler]),(0,react_src.Kr)((()=>({panels,createSubmitHandlerForPanel,panelProperties:{onSetProperties,deleteSelectedElements,selectedElements,selectedElementIds,selectedElementAnimations,updateAnimationState}})),[panels,createSubmitHandlerForPanel,onSetProperties,deleteSelectedElements,selectedElements,selectedElementIds,selectedElementAnimations,updateAnimationState])};function stylePanes_extends(){return stylePanes_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},stylePanes_extends.apply(null,arguments)}const stylePanes_StyledPane=(0,styled_components_browser_esm.Ay)(panes_shared.Zv).withConfig({displayName:"stylePanes__StyledPane",componentId:"sc-18fi38s-0"})(["height:100%;padding:0;overflow-y:auto;"]);const stylePanes=function StylePanes(){const{tab,tabs}=style_useStyle((state=>({tab:state.state.tab,tabs:state.data.tabs}))),{panels,createSubmitHandlerForPanel,panelProperties}=style_useDesignPanels(),getPanelsByType=(0,react_src.hb)(((types,paneProps)=>{const panelsList=panels.filter((({type})=>types.includes(type))).map((({Panel,type})=>react.createElement(designPanel,stylePanes_extends({key:type,panelType:Panel,registerSubmitHandler:createSubmitHandlerForPanel(type)},panelProperties))));return react.createElement(stylePanes_StyledPane,stylePanes_extends({id:(0,panes_shared.kN)(paneProps.key)},paneProps),panelsList)}),[panels,createSubmitHandlerForPanel,panelProperties]);return tabs.map((({id})=>{const isActive=id===tab,paneProps={key:id,isActive,"aria-labelledby":(0,panes_shared.vU)(id)};if(!isActive)return react.createElement(panes_shared.Zv,stylePanes_extends({key:id},paneProps));switch(id){case SELECTION.id:case LINK.id:case ANIMATION.id:return getPanelsByType(panelSections.n[id],paneProps);default:return null}}))},styleLayout_Layout=styled_components_browser_esm.Ay.section.attrs({"aria-label":(0,i18n.__)("Style","web-stories"),"data-testid":"styleLayout"}).withConfig({displayName:"styleLayout__Layout",componentId:"sc-1ihuio6-0"})(["height:100%;display:flex;flex-direction:column;background-color:",";color:",";max-height:100%;"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.fg.primary)),styleLayout_TabsArea=styled_components_browser_esm.Ay.nav.attrs({"aria-label":(0,i18n.__)("Style tabs","web-stories")}).withConfig({displayName:"styleLayout__TabsArea",componentId:"sc-1ihuio6-1"})([""]),styleLayout_UnjustifiedTabView=(0,styled_components_browser_esm.Ay)(tabview.Ay).withConfig({displayName:"styleLayout__UnjustifiedTabView",componentId:"sc-1ihuio6-2"})(["justify-content:center;"]),StylePaneContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleLayout__StylePaneContainer",componentId:"sc-1ihuio6-3"})(["height:100%;overflow-y:auto;min-height:0;"]),NoSelection=styled_components_browser_esm.Ay.div.withConfig({displayName:"styleLayout__NoSelection",componentId:"sc-1ihuio6-4"})(["height:100%;display:flex;justify-content:center;align-items:center;"]),Note=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"styleLayout__Note",componentId:"sc-1ihuio6-5"})(["color:",";"],(({theme})=>theme.colors.fg.secondary));const styleLayout=function StyleLayout(){const{state:{tab},actions:{setTab},refs:{tabRefs},data:{tabs}}=style_useStyle(),{selectedElementIds}=(0,app_story.P3)((({state})=>({selectedElementIds:state.selectedElementIds}))),{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:{[SELECTION.id]:state[highlights.xP.Style],[LINK.id]:state[highlights.xP.Style],[ANIMATION.id]:state[highlights.xP.Style]},resetHighlight:state.onFocusOut}))),onTabChange=(0,react_src.hb)((id=>{setTab(id),resetHighlight(),(0,tracking_src.sx)("style_tab_change",{name:id})}),[setTab,resetHighlight]);return 0===selectedElementIds.length?react.createElement(NoSelection,null,react.createElement(Note,{size:types.$.Medium},(0,i18n.__)("Nothing selected","web-stories"))):react.createElement(styleLayout_Layout,null,react.createElement(styleLayout_TabsArea,null,react.createElement(styleLayout_UnjustifiedTabView,{label:(0,i18n.__)("Style Selection","web-stories"),tabs,tabRefs,tab,onTabChange,onTabRefUpdated:(node,tabId)=>{const h=highlight[tabId];node&&h?.focus&&h?.showEffect&&node.focus()},getTabId:panes_shared.vU,getAriaControlsId:panes_shared.kN})),react.createElement(StylePaneContainer,null,react.createElement(stylePanes,null)))};const style_style=function Style(){return react.createElement(styleProvider,null,react.createElement(styleLayout,null))};var sidebar_constants=__webpack_require__("./packages/story-editor/src/components/sidebar/constants.ts"),sidebar_context=__webpack_require__("./packages/story-editor/src/components/sidebar/context.js");const TABS=[{id:sidebar_constants.i,title:(0,i18n.__)("Insert","web-stories"),Pane:library},{id:sidebar_constants.Y,title:(0,i18n.__)("Style","web-stories"),Pane:style_style}],SIDEBAR_TAB_IDS=new Set([sidebar_constants.i,sidebar_constants.qQ,sidebar_constants.Y]);const sidebarProvider=function SidebarProvider({sidebarTabs,children}){const{actions:{getAuthors}}=(0,api.M1)(),{selectedElementIds,currentPage}=(0,app_story.P3)((({state})=>({selectedElementIds:state.selectedElementIds,currentPage:state.currentPage}))),{tab:highlightedTab,highlight}=(0,highlights.N)((state=>({tab:state.tab,highlight:state[highlights.xP.StylePane]})));(0,react_src.vJ)((()=>{SIDEBAR_TAB_IDS.has(highlightedTab)&&(setTab(highlightedTab),(0,tracking_src.sx)("quick_action_tab_change",{name:highlightedTab}))}),[highlightedTab]);const sidebarRef=(0,react_src.li)(null),[tab,setTab]=(0,react_src.J0)(sidebar_constants.i),[users,setUsers]=(0,react_src.J0)([]),[sidebarContentHeight,setSidebarContentHeight]=(0,react_src.J0)(null),sidebarContentRef=(0,react_src.li)(),tabRef=(0,react_src.li)(tab),insertPaneRef=(0,react_src.li)(null),designPaneRef=(0,react_src.li)(null),documentPaneRef=(0,react_src.li)(null),tabRefs=(0,react_src.Kr)((()=>({[sidebar_constants.i]:insertPaneRef,[sidebar_constants.Y]:designPaneRef,[sidebar_constants.qQ]:documentPaneRef})),[]),[usersLoadingState,setUsersLoadingState]=(0,react_src.J0)("idle"),setSidebarContentNode=(0,react_src.hb)((node=>{sidebarContentRef.current=node}),[]);(0,react_src.pO)(sidebarContentRef,(({height})=>setSidebarContentHeight(height)),[]),(0,react_src.vJ)((()=>{selectedElementIds.length>0&&tabRef.current===sidebar_constants.qQ&&setTab(sidebar_constants.Y)}),[selectedElementIds]),(0,react_src.vJ)((()=>{tabRef.current===sidebar_constants.qQ&&setTab(sidebar_constants.Y)}),[currentPage]),(0,react_src.vJ)((()=>{const node=designPaneRef.current;node&&highlight?.focus&&highlight?.showEffect&&node.focus()}),[highlight]);const loadUsers=(0,react_src.hb)((()=>{"finished"!==usersLoadingState&&"errored"!==usersLoadingState&&0===users.length&&(setUsersLoadingState("loading"),getAuthors().then((data=>{const saveData=data.map((({id,name})=>({id,name})));setUsers(saveData),setUsersLoadingState("finished")})).catch((()=>{setUsersLoadingState("errored")})))}),[usersLoadingState,users.length,getAuthors]),tabs=(0,react_src.Kr)((()=>[...TABS,sidebarTabs?.document&&{id:sidebar_constants.qQ,...sidebarTabs.document}].filter(Boolean)),[sidebarTabs]),data=(0,react_src.Kr)((()=>({tabs,modalSidebarTab:sidebarTabs?.publishModal&&{id:sidebar_constants.kS,...sidebarTabs.publishModal}})),[tabs,sidebarTabs]),state={state:{tab,tabRefs,users,sidebarContentHeight,usersLoadingState},refs:{sidebar:sidebarRef},actions:{setTab,loadUsers,setSidebarContentNode},data};return react.createElement(sidebar_context.A.Provider,{value:state},children)},Editor=(0,moveable_src.rs)(styled_components_browser_esm.Ay.section.attrs({"aria-label":(0,i18n.__)("Web Stories Editor","web-stories")}).withConfig({displayName:"layout__Editor",componentId:"sc-9gpyr-0"})([""," background-color:",";position:relative;max-height:100vh;height:100%;width:100%;display:grid;grid:'sidebar   canv          ' 1fr 'sidebar   supplementary ' auto / ","px minmax(","px,1fr);"],expandPresetStyles.x((({paragraph},{Medium})=>paragraph[Medium])),(({theme})=>theme.colors.bg.primary),story_editor_src_constants.gH,story_editor_src_constants.j5));const components_layout=function layout_Layout({header,footer={},sidebarTabs,children}){const snackbarState=(0,useSnackbar.d)((({removeSnack,currentSnacks,placement})=>({onRemove:removeSnack,notifications:currentSnacks,placement})));return react.createElement(react.Fragment,null,react.createElement(layoutProvider.A,null,react.createElement(checklist.mq,null,react.createElement(highlights.Z8,null,react.createElement(sidebarProvider,{sidebarTabs},react.createElement(Editor,{zIndex:3},react.createElement(app_canvas.wt,null,react.createElement(rightClickMenu_provider,null,react.createElement(components_mediaRecording.j0,null,react.createElement(workspace,{header,footer}),react.createElement(rightClickMenu,null)))),children))))),react.createElement(snackbarContainer.A,snackbarState))};async function getFonts(params){let{default:fonts}=await __webpack_require__.e(1699).then(__webpack_require__.t.bind(__webpack_require__,"./packages/fonts/src/fonts.json",19));if(fonts=fonts.map((font=>({id:font.family,name:font.family,value:font.family,...font}))),params.include){const include=params.include.split(",");fonts=fonts.filter((({family})=>include.includes(family)))}return params.search&&(fonts=fonts.filter((({family})=>family.toLowerCase().includes(params.search)))),fonts}var createResource=__webpack_require__("./packages/media/src/createResource.ts");function createDummyImageData({mimeType="image/jpeg",src,width,height,id,title}){return(0,createResource.A)({mimeType,creationDate:"2021-10-29T11:43:38",src,width,height,id,alt:title,sizes:{medium:{file:`${title}-300x84.jpeg`,width:300,height:84,mimeType,sourceUrl:src},large:{file:`${title}-1024x288.jpeg`,width:1024,height:288,mimeType,sourceUrl:src},thumbnail:{file:`${title}-150x150.jpeg`,width:150,height:150,mimeType,sourceUrl:src},medium_large:{file:`${title}-768x216.jpeg`,width:768,height:216,mimeType,sourceUrl:src},"1536x1536":{file:`${title}-1536x432.jpeg`,width:1536,height:432,mimeType,sourceUrl:src},"2048x2048":{file:`${title}-2048x576.jpeg`,width:2048,height:576,mimeType,sourceUrl:src},"post-thumbnail":{file:`${title}-1568x441.jpeg`,width:1568,height:441,mimeType,sourceUrl:src},"web-stories-poster-portrait":{file:`${title}-640x853.jpeg`,width:640,height:853,mimeType,sourceUrl:src},"web-stories-publisher-logo":{file:`${title}-96x96.jpeg`,width:96,height:96,mimeType,sourceUrl:src},"web-stories-thumbnail":{file:`${title}-150x42.jpeg`,width:150,height:42,mimeType,sourceUrl:src},full:{file:title,width,height,mimeType,sourceUrl:src}}})}function createDummyVideoData({mimeType="video/mp4",src,mediaDetails,id,title,poster}){return(0,createResource.A)({mimeType,creationDate:"2021-10-29T11:56:33",src,width:mediaDetails.width,height:mediaDetails.height,poster:poster.src,posterId:57,id,length:mediaDetails.length,bitsPerSample:mediaDetails.bitsPerSample,alt:title})}const getMedia=params=>{const dummyMedia=function getDummyMedia(){return[createDummyImageData({mimeType:"image/png",src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page1_bg-alt.png",width:412,height:732,id:1,title:"Fresh and Bright 1"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page3_figure.jpg",width:720,height:844,id:2,title:"Fresh and Bright 2"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page4_bg.png",width:750,height:1334,id:3,title:"Fresh and Bright 3"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page5_figure.jpg",width:750,height:1079,id:4,title:"Fresh and Bright 4"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page7_product1.jpg",width:720,height:900,id:5,title:"Fresh and Bright 5"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page8_figure.jpg",width:408,height:544,id:6,title:"Fresh and Bright 6"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page9_story1.jpg",width:720,height:405,id:7,title:"Fresh and Bright 7"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page9_story2.jpg",width:480,height:720,id:8,title:"Fresh and Bright 8"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page9_story3.jpg",width:480,height:720,id:9,title:"Fresh and Bright 9"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/food-and-stuff/page1_bg.jpg",width:1080,height:1620,id:10,title:"Fresh and Bright 10"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/food-and-stuff/page3_image1.jpg",width:1080,height:720,id:11,title:"Food and Stuff 1"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/food-and-stuff/page5_bg.jpg",width:731,height:1300,id:12,title:"Food and Stuff 2"}),createDummyVideoData({src:"https://stream.mux.com/OGTmBYTMkV7Ez601cRNpH6BP10102fQu9C00/high.mp4?token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InQ5UHZucm9ZY0hQNjhYSmlRQnRHTEVVSkVSSXJ0UXhKIn0.eyJleHAiOjE2MjYxNzgxMTIsImF1ZCI6InYiLCJzdWIiOiJPR1RtQllUTWtWN0V6NjAxY1JOcEg2QlAxMDEwMmZRdTlDMDAifQ.Jvddeah-XyF0AMmfYND-fFaIfgeDYW_cAuIVIXOrk2so_YalyMMAQ11YXHA1h11yKpLM-xa8xiNXazPqA0Suq1tfxHjJjEqiQOzSlPYd4visiPdTjUgT50FkwYdJrN0IldfXoS19yi3GyAd9McVFoSGCZ6qp8m_hgJ39y8FJJbOrvGtrzEvElpz1M8M1Dat3PF-BSLvFcTvCOlec9dipajxHG_2Xg-EE_vOqww6z81kC09evj5gu_A-Vz58Q-ebd08R47ybNejhE3rzMr1dCKgUikjkkQokPPQyrwVEy8zeZ68elax-ZRvDokZ2mTVPGvKIye6m_CQ-WVlG5XRjw7A",mediaDetails:{filesize:1867215,mimeType:"video/mp4",length:12,lengthFormatted:"0:12",width:720,height:406,fileformat:"mp4",dataformat:"quicktime",audio:{dataformat:"mp4",codec:"ISO/IEC 14496-3 AAC",sampleRate:48e3,channels:2,bitsPerSample:16,lossless:!1,channelmode:"stereo"},createdTimestamp:-2082844800,sizes:{}},id:13,title:"Story",poster:{src:"https://image.mux.com/OGTmBYTMkV7Ez601cRNpH6BP10102fQu9C00/thumbnail.jpg?token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InQ5UHZucm9ZY0hQNjhYSmlRQnRHTEVVSkVSSXJ0UXhKIn0.eyJ0aW1lIjowLCJleHAiOjMxNzE3MDYwNjg4MSwiYXVkIjoidCIsInN1YiI6Ik9HVG1CWVRNa1Y3RXo2MDFjUk5wSDZCUDEwMTAyZlF1OUMwMCJ9.WxHU2cpFdNqqiWF08KEv1g7barfbE_Nw4JDvVrtrQc9mVKiSZ6pEHpYl14NZeaBOf4Ep9MiomaegCVrD-UANhURlxWuHWFx5h7Msg74-q_ojjuZbLZtFPUdA0NA3_GTq5y0LDAeXijM7oENn_IkuDSY0fbRhRUVh-hYqCzw_OqMx7B1IxoOkkZUCHgkm9VnPdAMQRpmaanCHB8SHVRI_vIJo577DxLd88KBFP3UWK1XTvN5NYr0oPtwc82XMYUW4HrxZZTmxzLSZckxzwB7T5E6zAtXpo-xwd52yB1OUhoihlTqiOPWbntpvt9H4lFVRISLwsT39d1Tw80HF_X02eQ",width:1920,height:1080,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/PDolZIrwdONTFJd005VOT4qvFsyxVfB01N/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM0NDQzfQ._6LJb2Ad843im0xV4-2I2vVpDNoPiy8nPc3-3IkSSuw",mediaDetails:{filesize:1510877,mimeType:"video/quicktime",length:18,lengthFormatted:"0:18",width:640,height:360,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{}},id:14,title:"Low",poster:{src:"https://storage.coverr.co/p/PDolZIrwdONTFJd005VOT4qvFsyxVfB01N",width:2048,height:1152,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/qMc3OVOA8a6Q9j01T2L3pGfF029UA00OvZJ/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM3NDkwfQ.rHiHdTyik8sDuP8viRbC4ph-qjHHJ81I7kdawP2-1eQ",mediaDetails:{filesize:456538,mimeType:"video/mp4",length:15,lengthFormatted:"0:15",width:360,height:640,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{},audio:{bitsPerSample:16,channelmode:"stereo",channels:2,codec:"ISO/IEC 14496-3 AAC",dataformat:"mp4",lossless:!1,sampleRate:48e3}},id:15,title:"Mountain Video",poster:{src:"https://storage.coverr.co/p/qMc3OVOA8a6Q9j01T2L3pGfF029UA00OvZJ",width:1080,height:1920,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/XHtOLYGTnHiXVxofSdO8oTcA02vxasheL/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM3NDkwfQ.rHiHdTyik8sDuP8viRbC4ph-qjHHJ81I7kdawP2-1eQ",mediaDetails:{filesize:2536304,mimeType:"video/mp4",length:27,lengthFormatted:"0:27",width:640,height:360,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{},audio:{bitsPerSample:16,channelmode:"stereo",channels:2,codec:"ISO/IEC 14496-3 AAC",dataformat:"mp4",lossless:!1,sampleRate:48e3}},id:16,title:"Beautiful Cloud Video",poster:{src:"https://storage.coverr.co/p/XHtOLYGTnHiXVxofSdO8oTcA02vxasheL",width:1920,height:1080,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/X4pOA7IG76p95Gl3IcU3oX26S2sbGsc2/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM4Mjc3fQ.lIznWsYEFy3abrDbou1mKJivj6GzQnHO6gJ8jdisPW0",mediaDetails:{filesize:1029136,mimeType:"video/mp4",length:10,lengthFormatted:"0:10",width:640,height:360,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{},audio:{bitsPerSample:16,channelmode:"stereo",channels:2,codec:"ISO/IEC 14496-3 AAC",dataformat:"mp4",lossless:!1,sampleRate:48e3}},id:17,title:"Beautiful Fire Video",poster:{src:"https://storage.coverr.co/p/X4pOA7IG76p95Gl3IcU3oX26S2sbGsc2",width:1920,height:1080,generated:!1}})]}(),mediaResponse={data:dummyMedia,headers:{totalItems:dummyMedia.length,totalPages:1}};return params.searchTerm&&(mediaResponse.data=dummyMedia.filter((media=>media.alt.toLowerCase().includes(params.searchTerm.toLowerCase()))),mediaResponse.headers.totalItems=mediaResponse.data.length),Promise.resolve(mediaResponse)};var story_editor_constants=__webpack_require__("./.storybook/stories/playground/story-editor/constants.js");const saveStoryById=({pages,globalStoryStyles,autoAdvance,defaultPageDuration,currentStoryStyles,backgroundAudio,content,title,excerpt})=>{const storySaveData={title:{raw:title},excerpt:{raw:excerpt},storyData:{version:migration_src.I,pages,autoAdvance,defaultPageDuration,currentStoryStyles,backgroundAudio},author:{id:1,name:""},stylePresets:globalStoryStyles,permalinkTemplate:"https://example.org/web-stories/%pagename%/"};return window.localStorage.setItem(story_editor_constants.c,JSON.stringify(storySaveData)),window.localStorage.setItem(story_editor_constants.K,content),Promise.resolve({})};function saveButton_SaveButton(){const{isSaving,saveStory}=(0,app_story.P3)((({state:{meta:{isSaving}},actions:{saveStory}})=>({isSaving,saveStory}))),{showSnackbar}=(0,useSnackbar.d)();return react.createElement(button_button.$,{variant:constants.Ak.Rectangle,type:constants.VQ.Primary,size:constants.Mp.Small,onClick:()=>{saveStory().then((()=>{showSnackbar({message:"Story Saved"})}))},disabled:isSaving},"Save")}var dist=__webpack_require__("./node_modules/@storybook/addon-links/dist/index.mjs"),eye=__webpack_require__("./packages/design-system/src/icons/eye.svg");function preview_PreviewButton(){const{isSaving,saveStory}=(0,app_story.P3)((({state:{meta:{isSaving}},actions:{saveStory}})=>({isSaving,saveStory})));return react.createElement(components_tooltip.A,{title:"Preview",hasTail:!0},react.createElement(button_button.$,{variant:constants.Ak.Square,type:constants.VQ.Quaternary,size:constants.Mp.Small,onClick:async()=>{await saveStory();const previewLink=await(0,dist.Z)("Playground/preview","default");try{const popup=window.open("about:blank","story-preview");popup&&(popup.document.write("<!DOCTYPE html><html><head>"),popup.document.write("<title>"),popup.document.write("Generating the preview"),popup.document.write("</title>"),popup.document.write("</head><body>"),popup.document.write("Please wait. Generating the preview"),popup.document.write(`<script>\n            setTimeout(function() {\n              location.replace(${JSON.stringify(previewLink)});\n            }, 5000);\n          <\/script>`))}catch(e){}},disabled:isSaving},react.createElement(eye.A,null)))}const ButtonList=styled_components_browser_esm.Ay.nav.withConfig({displayName:"buttons__ButtonList",componentId:"sc-ds1kaw-0"})(["display:flex;justify-content:flex-end;padding:1em;height:100%;"]),List=styled_components_browser_esm.Ay.div.withConfig({displayName:"buttons__List",componentId:"sc-ds1kaw-1"})(["display:flex;align-items:center;"]),buttons_Space=styled_components_browser_esm.Ay.div.withConfig({displayName:"buttons__Space",componentId:"sc-ds1kaw-2"})(["width:8px;"]),buttons_Spinner=styled_components_browser_esm.Ay.div.withConfig({displayName:"buttons__Spinner",componentId:"sc-ds1kaw-3"})(["position:absolute;top:0;"]),IconWithSpinner=styled_components_browser_esm.Ay.div.withConfig({displayName:"buttons__IconWithSpinner",componentId:"sc-ds1kaw-4"})(["position:relative;"]);function Loading(){return react.createElement(buttons_Spinner,null,react.createElement(circular.A,{size:32}))}function Buttons(){const{isSaving}=(0,app_story.P3)((({state:{meta:{isSaving}}})=>({isSaving})));return react.createElement(ButtonList,null,react.createElement(List,null,react.createElement(IconWithSpinner,null,react.createElement(preview_PreviewButton,null),isSaving&&react.createElement(Loading,null)),react.createElement(buttons_Space,null),react.createElement(saveButton_SaveButton,null)))}const Background=styled_components_browser_esm.Ay.header.attrs({role:"group","aria-label":"Story canvas header"}).withConfig({displayName:"header__Background",componentId:"sc-1iw47x9-0"})(["display:flex;align-items:center;justify-content:space-between;background-color:",";"],(({theme})=>theme.colors.bg.primary)),Head=styled_components_browser_esm.Ay.div.withConfig({displayName:"header__Head",componentId:"sc-1iw47x9-1"})(["flex:1 1 auto;padding:1em;"]),ButtonCell=styled_components_browser_esm.Ay.div.withConfig({displayName:"header__ButtonCell",componentId:"sc-1iw47x9-2"})(["grid-area:buttons;"]);function HeaderLayout(){return react.createElement(Background,null,react.createElement(Head,null,react.createElement(title,null)),react.createElement(ButtonCell,null,react.createElement(Buttons,null)))}const story_editor={title:"Playground/Stories Editor"},_default={render:function Render(){const content=window.localStorage.getItem(story_editor_constants.c),story=content?JSON.parse(content):{},apiCallbacks={saveStoryById,getMedia,getFonts};return element_library_src.Wk.forEach(elements_src.Ut),react.createElement("div",{style:{height:"100vh"}},react.createElement(storyEditor,{config:{apiCallbacks},initialEdits:{story}},react.createElement(components_layout,{header:react.createElement(HeaderLayout,null)})))}}},"./packages/design-system/src/components/contextMenu/components/subMenuTrigger.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js"),__webpack_require__("./packages/react/src/index.ts")),_keyboard__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/utils/constants.ts"),_contextMenuProvider__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/design-system/src/components/contextMenu/contextMenuProvider/useContextMenu.ts"),_item__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/design-system/src/components/contextMenu/components/item.tsx");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const __WEBPACK_DEFAULT_EXPORT__=function SubMenuTrigger({openSubMenu,closeSubMenu,isSubMenuOpen,isRTL=!1,subMenuRef,parentMenuRef,...buttonProps}){const ref=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.li)(null),pointerTracker=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.li)({}),{setFocusedId}=(0,_contextMenuProvider__WEBPACK_IMPORTED_MODULE_5__.A)((({actions})=>({setFocusedId:actions.setFocusedId}))),pointerIsOutside=node=>{const{x,y,width,height}=node.getBoundingClientRect(),{x:pointerX,y:pointerY}=pointerTracker.current;if(void 0===pointerX||void 0===pointerY)return!0;return pointerX<x-2||pointerX>x+width+2||pointerY<y-2||pointerY>y+height+2},maybeCloseSubMenu=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.YQ)((()=>{ref.current&&subMenuRef.current?.firstChild&&subMenuRef.current.firstChild instanceof Element&&pointerIsOutside(ref.current)&&pointerIsOutside(subMenuRef.current.firstChild)&&closeSubMenu()}),200);(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.vJ)((()=>{if(isSubMenuOpen&&subMenuRef.current){const subMenuItems=function getFocusableChildren(parent){return Array.from(parent.querySelectorAll(_utils__WEBPACK_IMPORTED_MODULE_4__.E.join(", "))).filter((e=>e instanceof HTMLElement))}(subMenuRef.current);subMenuItems.length&&(subMenuItems[0].focus(),setFocusedId(subMenuItems[0].id))}}),[isSubMenuOpen,subMenuRef,setFocusedId]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.vJ)((()=>{const node=parentMenuRef.current?.querySelector('[role="dialog"]');if(!isSubMenuOpen||!node)return;const onPointerMove=e=>{e instanceof PointerEvent&&(pointerTracker.current.x=e.clientX,pointerTracker.current.y=e.clientY,maybeCloseSubMenu())};return node.addEventListener("pointermove",onPointerMove),()=>node.removeEventListener("pointermove",onPointerMove)}),[isSubMenuOpen,parentMenuRef,maybeCloseSubMenu]);const handleKeyboardEvents=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.hb)((evt=>{const{code}=evt;[_utils__WEBPACK_IMPORTED_MODULE_4__.R.SPACE,_utils__WEBPACK_IMPORTED_MODULE_4__.R.ENTER].includes(code)?isSubMenuOpen?closeSubMenu():openSubMenu():(!isRTL&&_utils__WEBPACK_IMPORTED_MODULE_4__.R.RIGHT===code||(isRTL&&_utils__WEBPACK_IMPORTED_MODULE_4__.R.LEFT)===code)&&(isSubMenuOpen||openSubMenu())}),[openSubMenu,closeSubMenu,isSubMenuOpen,isRTL]);return(0,_keyboard__WEBPACK_IMPORTED_MODULE_6__._h)(ref,{key:["enter","space","left","right"]},handleKeyboardEvents,[handleKeyboardEvents]),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_item__WEBPACK_IMPORTED_MODULE_7__.A,_extends({},buttonProps,{ref,onPointerEnter:openSubMenu,onPointerLeave:()=>{pointerTracker.current={},maybeCloseSubMenu()},onClick:e=>e.preventDefault(),"aria-haspopup":!0,"aria-expanded":isSubMenuOpen,dismissOnClick:!1}))}},"./packages/design-system/src/components/infiniteScroller/infiniteScroller.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js"),__webpack_require__("./packages/react/src/index.ts")),styled_components__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_theme__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/design-system/src/theme/helpers/visuallyHidden.ts"),_theme__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/design-system/src/theme/types.ts"),_loadingSpinner__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx"),_typography__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts");const ScrollMessage=styled_components__WEBPACK_IMPORTED_MODULE_4__.Ay.div.withConfig({displayName:"infiniteScroller__ScrollMessage",componentId:"sc-smx7an-0"})(["width:100%;padding:140px 0 40px;margin:-100px auto 0;text-align:center;p{color:",";}"],(({theme})=>theme.colors.fg.tertiary)),LoadingContainer=styled_components__WEBPACK_IMPORTED_MODULE_4__.Ay.div.withConfig({displayName:"infiniteScroller__LoadingContainer",componentId:"sc-smx7an-1"})(["display:flex;justify-content:center;"]),AriaOnlyAlert=styled_components__WEBPACK_IMPORTED_MODULE_4__.Ay.span.withConfig({displayName:"infiniteScroller__AriaOnlyAlert",componentId:"sc-smx7an-2"})(["",""],_theme__WEBPACK_IMPORTED_MODULE_5__.Q);var State=function(State){return State.Loadable="loadable",State.LoadingInternal="loading_internal",State.LoadingExternal="loading_external",State.Complete="complete",State}(State||{}),Action=function(Action){return Action.OnInternalLoad="internal on load",Action.OnExternalLoad="external on load",Action.OnAllLoaded="all loaded",Action.OnLoadSuccess="load success",Action.OnCanLoadMore="can load more",Action}(Action||{});const machine={[State.Loadable]:{[Action.OnInternalLoad]:State.LoadingInternal,[Action.OnExternalLoad]:State.LoadingExternal},[State.LoadingInternal]:{[Action.OnAllLoaded]:State.Complete,[Action.OnLoadSuccess]:State.Loadable},[State.LoadingExternal]:{[Action.OnAllLoaded]:State.Complete,[Action.OnLoadSuccess]:State.Loadable},[State.Complete]:{[Action.OnCanLoadMore]:State.Loadable}},loadReducer=(state,action)=>machine[state][action]||state;const __WEBPACK_DEFAULT_EXPORT__=function InfiniteScroller({allDataLoadedMessage,allDataLoadedAriaMessage,onLoadMore,canLoadMore,isLoading,loadingAriaMessage,loadingSpinnerProps={animationSize:50,circleSize:6}}){const loadingRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.li)(null),onLoadMoreRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.li)(onLoadMore);onLoadMoreRef.current=onLoadMore;const[loadState,dispatch]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.WO)(loadReducer,State.Loadable),loadingAlert=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.Kr)((()=>loadState===State.LoadingInternal?loadingAriaMessage:loadState===State.LoadingExternal||canLoadMore?null:allDataLoadedAriaMessage),[allDataLoadedAriaMessage,loadingAriaMessage,loadState,canLoadMore]);(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.vJ)((()=>{loadState===State.LoadingInternal&&onLoadMoreRef.current?.()}),[loadState]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.vJ)((()=>{isLoading&&dispatch(Action.OnExternalLoad)}),[isLoading]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.vJ)((()=>{isLoading||dispatch(canLoadMore?Action.OnLoadSuccess:Action.OnAllLoaded)}),[isLoading,canLoadMore]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.vJ)((()=>{canLoadMore&&dispatch(Action.OnCanLoadMore)}),[canLoadMore]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.vJ)((()=>{if(!loadingRef.current)return;const observer=new IntersectionObserver((entries=>{entries.forEach((entry=>{entry.isIntersecting&&dispatch(Action.OnInternalLoad)}))}),{rootMargin:"0px",threshold:0}),triggerEl=loadingRef.current;return observer.observe(triggerEl),()=>{observer.unobserve(triggerEl)}}),[]);const loadingContent=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.Kr)((()=>loadState===State.LoadingExternal?null:canLoadMore?react__WEBPACK_IMPORTED_MODULE_0__.createElement(LoadingContainer,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_loadingSpinner__WEBPACK_IMPORTED_MODULE_8__.A,loadingSpinnerProps)):allDataLoadedMessage?react__WEBPACK_IMPORTED_MODULE_0__.createElement(_typography__WEBPACK_IMPORTED_MODULE_6__.E.Paragraph,{size:_theme__WEBPACK_IMPORTED_MODULE_7__.$.Small},allDataLoadedMessage):null),[allDataLoadedMessage,canLoadMore,loadState,loadingSpinnerProps]);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(ScrollMessage,{"data-testid":"load-more-on-scroll",ref:loadingRef},loadingAlert&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(AriaOnlyAlert,{role:"status"},loadingAlert),loadingContent)}},"./packages/design-system/src/components/pill/pillGroup.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),styled_components__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js")),_pill__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/design-system/src/components/pill/pill.tsx");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const Container=styled_components__WEBPACK_IMPORTED_MODULE_2__.Ay.div.attrs({role:"listbox"}).withConfig({displayName:"pillGroup__Container",componentId:"sc-1iis7mb-0"})(["display:flex;flex:1;column-gap:4px;"]);const __WEBPACK_DEFAULT_EXPORT__=function PillGroup({options,value,onSelect,...rest}){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(Container,null,options.map((({id,label})=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(_pill__WEBPACK_IMPORTED_MODULE_3__.A,_extends({key:id,isActive:id===value,onClick:()=>onSelect(id),role:"option"},rest),label))))}},"./packages/design-system/src/components/search/constants.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{GW:()=>DEFAULT_PLACEHOLDER,KV:()=>DEFAULT_POPUP_FILL_WIDTH,Mu:()=>Z_INDEX,Zk:()=>DEFAULT_ARIA_CLEAR_LABEL,mu:()=>DEFAULT_ARIA_INPUT_LABEL});var _googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/i18n/src/i18n.ts");const DEFAULT_POPUP_FILL_WIDTH=276,DEFAULT_PLACEHOLDER=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__.__)("Search","web-stories"),DEFAULT_ARIA_CLEAR_LABEL=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__.__)("Clear Search","web-stories"),DEFAULT_ARIA_INPUT_LABEL=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__.__)("Search","web-stories"),Z_INDEX={CLEAR_BUTTON:5}},"./packages/design-system/src/components/search/input/input.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>input});var react=__webpack_require__("./node_modules/react/index.js"),src=__webpack_require__("./packages/react/src/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),cross_small=__webpack_require__("./packages/design-system/src/icons/cross_small.svg"),chevron_down_small=__webpack_require__("./packages/design-system/src/icons/chevron_down_small.svg"),magnifier=__webpack_require__("./packages/design-system/src/icons/magnifier.svg"),expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),constants=__webpack_require__("./packages/design-system/src/components/search/constants.ts");const InputContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"input__InputContainer",componentId:"sc-hhun7d-0"})((({theme})=>(0,styled_components_browser_esm.AH)(["display:flex;position:relative;height:36px;width:100%;max-width:400px;background-color:transparent;color:",";"],theme.colors.fg.primary))),Input=styled_components_browser_esm.Ay.input.withConfig({displayName:"input__Input",componentId:"sc-hhun7d-1"})((({theme,hasError})=>(0,styled_components_browser_esm.AH)(["position:absolute;height:100%;width:100%;background-color:transparent;outline:none;cursor:pointer;",";color:",";border:1px solid ",";padding:8px 20px 8px 40px;&::placeholder{color:",";}&[aria-expanded='true']{border-color:",";}border-radius:",";&::-ms-clear{display:none;}&::-webkit-search-decoration,&::-webkit-search-cancel-button,&::-webkit-search-results-button,&::-webkit-search-results-decoration{appearance:none;}&:hover{border-color:",";}",";"," &:disabled{pointer-events:none;border-color:",";color:",";&:hover{border-color:",";}}"],expandPresetStyles.s({preset:theme.typography.presets.paragraph[types.$.Small],theme}),theme.colors.fg.primary,theme.colors.border.defaultNormal,theme.colors.fg.tertiary,theme.colors.border.defaultActive,theme.borders.radius.small,theme.colors.border.defaultHover,outline.Q(theme.colors.border.focus),hasError&&(0,styled_components_browser_esm.AH)(["border-color:",";&:active,&:hover{border-color:",";}"],theme.colors.interactiveBg.negativeHover,theme.colors.interactiveBg.negativeHover),theme.colors.border.disable,theme.colors.fg.disable,theme.colors.border.disable))),BaseDecorationContainer=(0,styled_components_browser_esm.AH)(["display:flex;align-items:center;width:32px;background-color:transparent;color:",";border:0;margin:auto 1px auto auto;padding:0;align-self:flex-end;cursor:pointer;"],(({theme})=>theme.colors.fg.secondary)),ClearButton=styled_components_browser_esm.Ay.button.withConfig({displayName:"input__ClearButton",componentId:"sc-hhun7d-2"})(["",";display:",";outline:none;",";height:30px;z-index:",";"],BaseDecorationContainer,(({isVisible})=>isVisible?"flex":"none"),(({theme})=>outline.Q(theme.colors.border.focus)),constants.Mu.CLEAR_BUTTON),ClearIcon=(0,styled_components_browser_esm.Ay)(cross_small.A).withConfig({displayName:"input__ClearIcon",componentId:"sc-hhun7d-3"})(["width:32px;height:auto;margin:auto;"]),ChevronDecoration=styled_components_browser_esm.Ay.div.withConfig({displayName:"input__ChevronDecoration",componentId:"sc-hhun7d-4"})(["",";display:",";visibility:",";height:100%;",""],BaseDecorationContainer,(({isVisible})=>isVisible?"flex":"none"),(({isVisible})=>isVisible?"visible":"collapsed"),(({disabled,theme})=>disabled&&(0,styled_components_browser_esm.AH)(["pointer-events:none;color:",";"],theme.colors.fg.disable))),ChevronIcon=(0,styled_components_browser_esm.Ay)(chevron_down_small.A).withConfig({displayName:"input__ChevronIcon",componentId:"sc-hhun7d-5"})(["width:32px;height:auto;margin:auto;",""],(({$isMenuOpen})=>$isMenuOpen&&(0,styled_components_browser_esm.AH)(["transform:rotate(180deg);"]))),SearchDecoration=styled_components_browser_esm.Ay.div.withConfig({displayName:"input__SearchDecoration",componentId:"sc-hhun7d-6"})((({theme,activeSearch,disabled})=>(0,styled_components_browser_esm.AH)(["",";position:absolute;height:100%;margin:0;left:8px;color:",";pointer-events:none;",""],BaseDecorationContainer,activeSearch?theme.colors.fg.tertiary:theme.colors.fg.primary,disabled&&(0,styled_components_browser_esm.AH)(["color:",";"],theme.colors.fg.disable)))),SearchIcon=(0,styled_components_browser_esm.Ay)(magnifier.A).withConfig({displayName:"input__SearchIcon",componentId:"sc-hhun7d-7"})(["position:relative;width:32px;height:auto;margin:auto;"]);function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const input=(0,src.Rf)((({ariaClearLabel,clearId,disabled,handleClearInput=()=>{},handleTabClear,inputValue,isOpen,listId,className="",...rest},ref)=>{const[inputChanged,setInputChanged]=(0,src.J0)(!1),[isEmptyValue,setIsEmptyValue]=(0,src.J0)(!1),activeInput=(0,src.Kr)((()=>inputValue.length>0&&isOpen),[isOpen,inputValue]),alignInputCenter=(0,src.Kr)((()=>0===inputValue.length&&!isOpen),[isOpen,inputValue]),onClearButtonKeyDown=(0,src.hb)((({key})=>{"Tab"===key&&handleTabClear?.()}),[handleTabClear]),handleOnInput=(0,src.hb)((value=>{setIsEmptyValue(""===value),setInputChanged(isOpen)}),[isOpen]);return react.createElement(InputContainer,{className},react.createElement(Input,_extends({"aria-disabled":disabled,autoComplete:"off",disabled,onInput:event=>handleOnInput(event.currentTarget.value),ref,type:"search",value:inputValue},listId&&{role:"combobox","aria-expanded":isOpen,"aria-controls":listId,"aria-owns":listId,"aria-autocomplete":"list"},rest)),react.createElement(SearchDecoration,{activeSearch:alignInputCenter,"aria-hidden":!0,disabled},react.createElement(SearchIcon,{id:clearId})),react.createElement(ClearButton,{type:"button",isVisible:activeInput&&inputChanged,tabIndex:0,"aria-label":activeInput&&inputChanged?ariaClearLabel:"",onClick:handleClearInput,onKeyDown:onClearButtonKeyDown},react.createElement(ClearIcon,{id:clearId,"data-testid":"clear-search-icon"})),react.createElement(ChevronDecoration,{disabled,"aria-hidden":activeInput&&inputChanged||isEmptyValue,isVisible:(!activeInput||!inputChanged)&&!isEmptyValue&&inputValue.length>0},react.createElement(ChevronIcon,{$isMenuOpen:isOpen,"data-testid":"chevron-search-icon"})))}))},"./packages/design-system/src/contexts/snackbar/snackbarProvider.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.find.js"),__webpack_require__("./packages/react/src/index.ts")),uuid__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/design-system/node_modules/uuid/dist/esm-browser/v4.js"),_context__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/design-system/src/contexts/snackbar/context.ts");const __WEBPACK_DEFAULT_EXPORT__=function SnackbarProvider({children,placement="bottom"}){const[notifications,setNotifications]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.J0)([]),remove=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.hb)((toRemove=>{setNotifications((currentNotifications=>currentNotifications.filter((item=>Array.isArray(toRemove)?!toRemove.find((({id})=>id===item.id)):item.id!==toRemove.id))))}),[]),create=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.hb)((notification=>{const newNotification={id:(0,uuid__WEBPACK_IMPORTED_MODULE_5__.A)(),...notification};setNotifications((currentNotifications=>[...currentNotifications,newNotification]))}),[]),clear=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.hb)((()=>{setNotifications([])}),[]),state=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.Kr)((()=>({showSnackbar:create,clearSnackbar:clear,removeSnack:remove,currentSnacks:notifications,placement})),[create,clear,remove,notifications,placement]);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_context__WEBPACK_IMPORTED_MODULE_6__.A.Provider,{value:state},children)}},"./packages/story-editor/src/components/devTools/dummyData.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{g:()=>dummyVideo,w:()=>dummyImage});const dummyVideo="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAPEbW9vdgAAAGxtdmhkAAAAANrF/AXaxfwFAAAD6AAAB9AAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAABhpb2RzAAAAABCAgIAHAE///////wAAAzh0cmFrAAAAXHRraGQAAAAB2sX8BdrF/AUAAAABAAAAAAAAB9AAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAABQAAAAUAAAAAAKwbWRpYQAAACBtZGhkAAAAANrF/AXaxfwFAAAD6AAAB9BVxAAAAAAAIWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAAAAAAACZ21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAq3N0c2QAAAAAAAAAAQAAAJthdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAABQAFABIAAAASAAAAAAAAAABDkpWVC9BVkMgQ29kaW5nAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAM2F2Y0MBTUAK/+EAG2dNQArsxLzzzUBAQZAAAAMAEAAAAwFI8SJZoAEABWjpeyyAAAAAEmNvbHJuY2xjAAEAAQAGAAAAGHN0dHMAAAAAAAAAAQAAABQAAABkAAAAZHN0c3oAAAAAAAAAAAAAABQAAAC1AAAADAAAAAwAAAAMAAAADAAAAGcAAAAOAAAADQAAAAwAAADEAAAADwAAAA4AAAAMAAAAmgAAAA8AAAAMAAAADAAAABEAAAAOAAAADAAAABxzdHNjAAAAAAAAAAEAAAABAAAACgAAAAEAAAAgY282NAAAAAAAAAACAAAAAAAAA/QAAAAAAAAGKwAAAKhjdHRzAAAAAAAAABMAAAABAAAAyAAAAAEAAAH0AAAAAQAAAMgAAAABAAAAAAAAAAEAAABkAAAAAQAAAfQAAAABAAAAyAAAAAEAAAAAAAAAAQAAAGQAAAABAAAB9AAAAAEAAADIAAAAAQAAAAAAAAABAAAAZAAAAAEAAAH0AAAAAQAAAMgAAAABAAAAAAAAAAEAAABkAAAAAQAAAZAAAAACAAAAZAAAABRzdHNzAAAAAAAAAAEAAAABAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAH0AAAAMgAAQAAAAAAAW1kYXQAAAAAAAADXAAAALFliIQAIf8tERhKDUPN//6tPIlfMgqs2j4bf1chdW+++2VwQdh75gd9Y8UGeNAnhlaisT01Zs49a/0nV0aO/GLhqiGwvWR/s1K9W3zBx2od2cS1bT/kb2rz7FeHrWTqTLX6Gx65Y6i33pdJ/uLJd1nt76ybxnGFuPrIHacdB39MBmZsd4t/m7wPBzhrJIjUCiCUcSaxJPxvEH+6DID5TqxsXtv0RS9+hTuYECGa+YWdx4EAAAAIQZokbEMfi4AAAAAIQZ5COIc/0YEAAAAIAZ5hNEEH1YAAAAAIAZ5jakEH1YEAAABjQZpoSahBaJlMCM/eVhjnGE9A+AdJ7SwN5vlKUC/otPa/5jefanvcx5sQZ4c8/3tiMqvDgQF8rydFoFe3gcpkTP4xG9DP5oXTv1DTSsVi1O/u9fkq6BMYR61X6/n148wbBk3hAAAACkGehi5RMJfxO6sAAAAJAZ6lKRDn87czAAAACAGep25Cn8WAAAAAwEGarDUILakymAT/lvijvmpe6mLGpu6rJNoev4/97f/3/AViMdt7WMTLeGSxGKwsecwmz+Z5NTf4Lgky4aLbYBjw9pUtNg4bov9E4yT+OadpewkQxiWZZozDDf98P4PN72xr+rkQJcODW8z2LOkQVijjHcWSmTAvF7/ANFm8TO5l9vC/tz7FvEis+ba+dTueI87l9hdLXQfWqKN+J9j1fj5cguj08byzEmWnKbLlqG1uTZmu0LDedc3Ugo76bySHIAAAAAtBnspklERc3+sNqQAAAAoBnukpEZ/3fsMPAAAACAGe625N/6+AAAAAlkGa8DUILakymARfBGYe5snAbMic1iEEu9W/yugK09WdqQ1/7ftt/lUz4i6orQg+4cIz2nHYVKTXCJJbyOrz/tGL+TWtNtUBVK2kbTsfCYF8ddhk+qL5Jr82IUEUALXNsKpx1hhGIJnvqqlGTOyyOpmwbHhNUa2TaBkzzVzuaVnuHnaL3sjfLR0XEc/T6ntUXHacPLf94QAAAAtBnw5klERd//FEowAAAAgBny1pFf+ngQAAAAgBny9uf+yhJAAAAA1BmzM1CC2pMpgE/xwwAAAACkGfUWSURFz/kYEAAAAIAZ9ybkv/mIA=",dummyImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAGElEQVQYV2NkYGD4////fwZGEMnIyMgAAEvqB/6wfXLSAAAAAElFTkSuQmCC"},"./packages/story-editor/src/components/library/panes/media/common/styles.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{HT:()=>PaneInner,QM:()=>PaneHeader,SM:()=>StyledPane,WW:()=>GalleryContainer,Wx:()=>MediaGalleryLoadingPill,Yk:()=>MediaGalleryContainer,aN:()=>MediaGalleryMessage,m8:()=>MediaGalleryInnerContainer,oG:()=>SearchInputContainer});var styled_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),polished__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/design-system/src/theme/types.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),_shared__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/index.js");const PaneInner=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"common__PaneInner",componentId:"sc-18rwr03-0"})(["height:100%;display:flex;flex-direction:column;"]),PaneHeader=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"common__PaneHeader",componentId:"sc-18rwr03-1"})(["padding-top:24px;flex:0 1 auto;"]),GalleryContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"common__GalleryContainer",componentId:"sc-18rwr03-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;"]),MediaGalleryContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"common__MediaGalleryContainer",componentId:"sc-18rwr03-3"})(["overflow-y:scroll;overflow-x:hidden;padding:0 ",";margin-top:1em;position:relative;width:100%;flex:1 1 auto;min-height:100px;"],_shared__WEBPACK_IMPORTED_MODULE_0__.z7),MediaGalleryInnerContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"common__MediaGalleryInnerContainer",componentId:"sc-18rwr03-4"})(["width:calc(100% + ","px);"],_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.$.SCROLLBAR_WIDTH),MediaGalleryLoadingPill=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"common__MediaGalleryLoadingPill",componentId:"sc-18rwr03-5"})(["display:block;position:absolute;bottom:20px;left:60px;right:60px;width:240px;text-align:center;padding:8px 80px;background-color:",";border-radius:100px;"],(({theme})=>(0,polished__WEBPACK_IMPORTED_MODULE_3__.B3)(theme.colors.standard.black,.4))),MediaGalleryMessage=(0,styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_4__.E.Paragraph).attrs({size:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.$.Medium}).withConfig({displayName:"common__MediaGalleryMessage",componentId:"sc-18rwr03-6"})(["color:",";padding:1em;text-align:center;"],(({theme})=>theme.colors.fg.secondary)),StyledPane=(0,styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay)(_shared__WEBPACK_IMPORTED_MODULE_0__.Zv).withConfig({displayName:"common__StyledPane",componentId:"sc-18rwr03-7"})(["height:100%;padding:0;overflow:hidden;"]),SearchInputContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"common__SearchInputContainer",componentId:"sc-18rwr03-8"})(["padding:0 ",";"],_shared__WEBPACK_IMPORTED_MODULE_0__.z7)},"./packages/story-editor/src/components/library/panes/shared/chipGroup/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>chipGroup});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js")),src=__webpack_require__("./packages/react/src/index.ts"),v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),chip=__webpack_require__("./packages/design-system/src/components/chip/chip.tsx"),chevron_up=__webpack_require__("./packages/design-system/src/icons/chevron_up.svg"),useRovingTabIndex=__webpack_require__("./packages/story-editor/src/utils/useRovingTabIndex/index.js");const hooks_useExpandAnimation=function useExpandAnimation({sectionRef,innerContainerRef,isExpanded,setFocusedRowOffset,collapsedHeight,bottomMargin,topMargin}){(0,src.Nf)((()=>{if(!sectionRef.current||!innerContainerRef.current)return;let height;height=isExpanded?`${innerContainerRef.current.offsetHeight+topMargin+bottomMargin}px`:`${collapsedHeight}px`,sectionRef.current.style.height=height,sectionRef.current.style.minHeight=height,setFocusedRowOffset(0)}),[bottomMargin,collapsedHeight,innerContainerRef,isExpanded,sectionRef,setFocusedRowOffset,topMargin])};const hooks_useHandleRowVisibility=function useHandleRowVisibility({innerContainerRef,isExpanded,setFocusedRowOffset,selectedItemId,itemRefs,offsetSpacing=0}){(0,src.Nf)((()=>{if(!innerContainerRef.current)return;const selectedItem=itemRefs.current?.[selectedItemId]?itemRefs.current[selectedItemId]:null;!isExpanded&&selectedItem&&setFocusedRowOffset(selectedItem?.offsetTop-offsetSpacing||0)}),[innerContainerRef,isExpanded,itemRefs,offsetSpacing,selectedItemId,setFocusedRowOffset]),(0,src.Nf)((()=>{if(!innerContainerRef.current)return;const selectedItem=itemRefs.current?.[selectedItemId]?itemRefs.current[selectedItemId]:null,selectedItemOffsetTop=selectedItem?.offsetTop||0;for(const pill of itemRefs.current){if(!pill)continue;const isSameRow=selectedItem&&pill.offsetTop===selectedItemOffsetTop;!selectedItem||isSameRow||isExpanded?pill.classList.remove("invisible"):pill.classList.add("invisible")}}),[innerContainerRef,isExpanded,selectedItemId,itemRefs])},Section=styled_components_browser_esm.Ay.div.withConfig({displayName:"chipGroup__Section",componentId:"sc-emvo4b-0"})(["height:","px;min-height:","px;background-color:",";display:flex;flex-direction:column;align-items:flex-start;flex:0 1 auto;position:relative;transition:height 0.2s,min-height 0.2s;"],80,80,(({theme})=>theme.colors.divider.tertiary)),Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"chipGroup__Container",componentId:"sc-emvo4b-1"})(["overflow:hidden;margin:","px 12px ","px 24px;"],16,20),InnerContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"chipGroup__InnerContainer",componentId:"sc-emvo4b-2"})(["display:flex;justify-content:center;flex-wrap:wrap;position:relative;padding:4px 0;transition:transform 0.2s;column-gap:8px;row-gap:14px;"]),ExpandButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:constants.VQ.Tertiary,size:constants.Mp.Small,variant:constants.Ak.Circle}).withConfig({displayName:"chipGroup__ExpandButton",componentId:"sc-emvo4b-3"})(["display:flex;position:absolute;bottom:-24px;background:",";max-height:none;width:32px;height:32px;"," visibility:inherit;align-self:center;justify-content:center;align-items:center;"],(({theme})=>theme.colors.bg.tertiary),(({isExpanded})=>isExpanded&&"transform: scaleY(-1);")),chipGroup=({items,selectedItemId,selectItem,deselectItem,ariaLabel})=>{const[isExpanded,setIsExpanded]=(0,src.J0)(!1),sectionRef=(0,src.li)(),innerContainerRef=(0,src.li)(),itemRefs=(0,src.li)([]),[focusedRowOffset,setFocusedRowOffset]=(0,src.J0)(0),handleClick=(0,src.hb)(((selected,id)=>{selected&&null!==id?deselectItem():(setIsExpanded(!1),selectItem(id))}),[deselectItem,selectItem]),handleExpandClick=(0,src.hb)((()=>setIsExpanded((currentExpanded=>!currentExpanded))),[]);hooks_useExpandAnimation({sectionRef,innerContainerRef,isExpanded,setFocusedRowOffset,collapsedHeight:80,bottomMargin:20,topMargin:16}),hooks_useHandleRowVisibility({isExpanded,innerContainerRef,selectedItemId,setFocusedRowOffset,itemRefs,offsetSpacing:4});const hasItems=items.length>0;(0,useRovingTabIndex.A)({ref:sectionRef},[isExpanded]),(0,keyboard._h)(sectionRef,isExpanded?"":"down",(()=>hasItems&&setIsExpanded(!0)),[isExpanded,hasItems]);const containerId=(0,src.Kr)((()=>`pill-group-${(0,v4.A)()}`),[]);return react.createElement(Section,{ref:sectionRef},hasItems&&react.createElement(react.Fragment,null,react.createElement(Container,{id:containerId,isExpanded,role:"listbox","aria-label":ariaLabel||(0,i18n.__)("List of filtering options","web-stories")},react.createElement(InnerContainer,{role:"presentation",ref:innerContainerRef,style:{transform:`translateY(-${focusedRowOffset}px`}},items.map(((item,index)=>{const{id,label}=item,selected=id===selectedItemId,tabIndex=selected||!selected&&0===index?0:-1;return react.createElement(chip.A,{key:id,role:"option",ref:el=>{itemRefs.current[id]=el},active:selected,"aria-selected":selected,onClick:()=>handleClick(selected,id),tabIndex},label)})))),react.createElement(ExpandButton,{onClick:handleExpandClick,isExpanded,"aria-controls":containerId,"aria-expanded":isExpanded,"aria-label":(0,i18n.__)("Expand","web-stories")},react.createElement(chevron_up.A,null))))}},"./packages/story-editor/src/components/library/panes/shared/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Iy:()=>_chipGroup__WEBPACK_IMPORTED_MODULE_4__.A,VC:()=>PageTemplateTitleContainer,YM:()=>LoadingContainer,Zv:()=>Pane,kN:()=>getPaneId,rA:()=>ActionButton,vU:()=>getTabId,z7:()=>PANE_PADDING});var styled_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),_constants_zIndex__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/constants/zIndex.ts"),_chipGroup__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/chipGroup/index.js");const PANE_PADDING="1em",Pane=styled_components__WEBPACK_IMPORTED_MODULE_0__.Ay.section.attrs((({isActive})=>({role:"tabpanel","aria-expanded":isActive,hidden:!isActive}))).withConfig({displayName:"shared__Pane",componentId:"sc-10fhorr-0"})(["padding:1.5em ",";",""],PANE_PADDING,(({isOverflowScrollable=!1})=>isOverflowScrollable&&(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.AH)(["overflow-y:scroll;height:100%;"])));function getPaneId(tab){return`library-pane-${tab}`}function getTabId(tab){return`library-tab-${tab}`}const LoadingContainer=styled_components__WEBPACK_IMPORTED_MODULE_0__.Ay.div.withConfig({displayName:"shared__LoadingContainer",componentId:"sc-10fhorr-1"})(["display:flex;justify-content:center;margin-top:18px;"]),ActionButton=(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.Ay)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_1__.$).attrs({variant:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.Ak.Icon}).withConfig({displayName:"shared__ActionButton",componentId:"sc-10fhorr-2"})(["display:flex;align-items:center;position:absolute;top:calc(50% - ","px);right:calc(50% - ","px);color:",";border-radius:",";width:","px;height:","px;opacity:",";z-index:",";"],8,8,(({theme})=>theme.colors.fg.primary),(({theme})=>theme.borders.radius.round),16,16,(({$display})=>$display?"1":"0"),_constants_zIndex__WEBPACK_IMPORTED_MODULE_3__.qR),PageTemplateTitleContainer=styled_components__WEBPACK_IMPORTED_MODULE_0__.Ay.div.withConfig({displayName:"shared__PageTemplateTitleContainer",componentId:"sc-10fhorr-3"})(["position:absolute;bottom:0;width:100%;padding:8px;background-color:",";opacity:",";"],(({theme})=>theme.colors.opacity.black64),(({isActive})=>isActive?1:0))},"./packages/story-editor/src/components/library/panes/shared/insertionOverlay.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),styled_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/design-system/src/icons/plus_filled_small.svg"),polished__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/polished/dist/polished.esm.js");const IconContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"insertionOverlay__IconContainer",componentId:"sc-x3oxxu-0"})(["height:","px;width:","px;position:absolute;top:calc(50% - ","px);left:calc(50% - ","px);color:",";border-radius:",";pointer-events:none;svg{position:absolute;top:0;left:0;}"],16,16,8,8,(({theme})=>theme.colors.fg.primary),(({theme})=>theme.borders.radius.round)),Scrim=styled_components__WEBPACK_IMPORTED_MODULE_1__.Ay.div.withConfig({displayName:"insertionOverlay__Scrim",componentId:"sc-x3oxxu-1"})(["position:absolute;width:100%;height:100%;top:0;left:0;background-color:",";pointer-events:none;"],(({theme})=>(0,polished__WEBPACK_IMPORTED_MODULE_2__.B3)(theme.colors.standard.black,.5)));const __WEBPACK_DEFAULT_EXPORT__=function InsertionOverlay({showIcon=!0,className=""}){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(Scrim,{className},showIcon&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(IconContainer,{role:"presentation"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_3__.A,null)))}},"./packages/story-editor/src/components/tabview/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),styled_components__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js")),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./packages/design-system/src/components/typography/headline/index.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./packages/design-system/src/theme/types.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),_app__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/app/index.js"),_tooltip__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js"),_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),_constants__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/story-editor/src/constants/index.ts"),_utils_noop__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./packages/story-editor/src/utils/noop.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const Tabs=styled_components__WEBPACK_IMPORTED_MODULE_7__.Ay.ul.attrs({role:"tablist","aria-orientation":"horizontal"}).withConfig({displayName:"tabview__Tabs",componentId:"sc-10d408-0"})(["display:flex;flex-direction:row;align-items:stretch;width:100%;max-width:100%;justify-content:space-between;margin:0;padding:0;list-style:none;border-bottom:1px solid ",";"],(({theme})=>theme.colors.divider.secondary)),TabElement=styled_components__WEBPACK_IMPORTED_MODULE_7__.Ay.li.attrs((({isActive})=>({tabIndex:isActive?0:-1,role:"tab","aria-selected":isActive}))).withConfig({displayName:"tabview__TabElement",componentId:"sc-10d408-1"})(["cursor:pointer;border:none;background:none;padding:0 4px;margin:","px 12px 9px;height:","px;display:flex;align-items:center;justify-content:center;position:relative;transition:color 0.2s ease;color:",";border-radius:",";",";:hover{color:",";}"," svg{display:block;width:32px;height:32px;margin:0 -4px;transform-origin:center center;transition:transform 0.3s ease,color 0.2s ease;color:",";border-radius:",";pointer-events:none;}svg.alert{width:","px;margin-left:4px;color:",";}span,svg:not(.alert){",";}&:hover span,&:hover svg:not(.alert),&:active span,&:active svg:not(.alert){color:",";}&:focus-visible{svg:not(.alert){background-color:",";}}"],10,32,(({theme,isActive})=>isActive?theme.colors.fg.primary:theme.colors.fg.tertiary),(({theme})=>theme.borders.radius.small),(({theme})=>_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_8__.Q(theme.colors.border.focus,theme.colors.bg.secondary)),(({theme})=>theme.colors.fg.primary),(({isActive,theme})=>isActive&&(0,styled_components__WEBPACK_IMPORTED_MODULE_7__.AH)(["::after{content:'';position:absolute;background-color:",";height:2px;border-radius:1px;bottom:-10px;left:4px;right:4px;}"],theme.colors.border.selection)),(({theme})=>theme.colors.fg.tertiary),(({theme})=>theme.borders.radius.small),28,(({theme})=>theme.colors.fg.primary),(({isActive,theme})=>isActive&&`color: ${theme.colors.fg.primary}`),(({theme})=>theme.colors.fg.primary),(({theme})=>theme.colors.interactiveBg.tertiaryHover)),TabText=(0,styled_components__WEBPACK_IMPORTED_MODULE_7__.Ay)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_9__.$).attrs({as:"p",size:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_10__.$.XXXSmall}).withConfig({displayName:"tabview__TabText",componentId:"sc-10d408-2"})(["color:inherit;"]);const Tab=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.Rf)((function UnreffedTab({children,tooltip=null,placement,refId,tabRefs,...rest},ref){const{id}=rest,eventData=id.includes("library")?_constants__WEBPACK_IMPORTED_MODULE_6__.Zy.LIBRARY_PANEL_CLICK:_constants__WEBPACK_IMPORTED_MODULE_6__.Zy.DESIGN_PANEL_CLICK;(0,_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_5__.A)({node:tabRefs?.[refId]?.current,eventData:{...eventData,label:`${refId}_tab`}});const tab=react__WEBPACK_IMPORTED_MODULE_0__.createElement(TabElement,_extends({ref},rest),children);return null!==tooltip?react__WEBPACK_IMPORTED_MODULE_0__.createElement(_tooltip__WEBPACK_IMPORTED_MODULE_4__.A,{title:tooltip,placement,isDelayed:!0},tab):tab}));const __WEBPACK_DEFAULT_EXPORT__=function TabView({getTabId=id=>id,getAriaControlsId,onTabChange=_utils_noop__WEBPACK_IMPORTED_MODULE_11__.l,onTabRefUpdated=_utils_noop__WEBPACK_IMPORTED_MODULE_11__.l,tabs=[],label="",shortcut="",tab,tabRefs,...rest}){const{isRTL}=(0,_app__WEBPACK_IMPORTED_MODULE_3__.UK)(),ref=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.li)(),focused=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.li)(),internalTabRefs=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.li)({}),focusChanged=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.hb)((id=>{tabRefs?.[id]?.current?tabRefs[id].current?.focus():internalTabRefs?.current[id]&&internalTabRefs.current[id]?.focus(),focused.current=id}),[tabRefs]),selectTab=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.hb)((id=>{focusChanged(id),onTabChange(id)}),[focusChanged,onTabChange]);(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__.pP)({key:shortcut,editable:!0},(()=>selectTab(tab)),[selectTab,tab]);const focusTabByIndex=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.hb)((index=>{const nextTab=tabs[(index+tabs.length)%tabs.length];focusChanged(nextTab.id)}),[tabs,focusChanged]),handleNavigation=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.hb)((direction=>{const directionWithRTL=isRTL?-direction:direction,currentIndex=tabs.findIndex((({id})=>id===focused.current));focusTabByIndex(currentIndex+directionWithRTL)}),[isRTL,tabs,focusTabByIndex]);return(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__._h)(ref,"left",(()=>handleNavigation(-1)),[handleNavigation]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__._h)(ref,"right",(()=>handleNavigation(1)),[handleNavigation]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__._h)(ref,["up","down"],_utils_noop__WEBPACK_IMPORTED_MODULE_11__.l,[]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__._h)(ref,"home",(()=>focusTabByIndex(0)),[focusTabByIndex]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__._h)(ref,"end",(()=>focusTabByIndex(-1)),[focusTabByIndex]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_12__._h)(ref,{key:["enter","space"],allowDefault:!0},(evt=>{"tab"===evt.target.getAttribute("role")&&(selectTab(focused.current),evt.preventDefault())}),[selectTab],{}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(Tabs,_extends({"aria-label":label,ref},rest),tabs.map((({id,title,icon:Icon,...tabRest})=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(Tab,_extends({key:id,ref:node=>{tabRefs?.[id]?tabRefs[id].current=node:internalTabRefs.current[id]=node,onTabRefUpdated(node,id)},id:getTabId(id),isActive:tab===id,"aria-controls":getAriaControlsId?getAriaControlsId(id):null,"aria-selected":tab===id,onClick:()=>selectTab(id),onFocus:()=>{focused.current=tab},refId:id,tabRefs},tabRest),Boolean(title)&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(TabText,null,title),Boolean(Icon)&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(Icon,{isActive:id===tab})))))}},"./packages/text-sets/src/raw lazy recursive ^\\.\\/.*\\.json$":(module,__unused_webpack_exports,__webpack_require__)=>{var map={"./contact.json":["./packages/text-sets/src/raw/contact.json",9016],"./cover.json":["./packages/text-sets/src/raw/cover.json",1825],"./editorial.json":["./packages/text-sets/src/raw/editorial.json",6218],"./list.json":["./packages/text-sets/src/raw/list.json",5219],"./quote.json":["./packages/text-sets/src/raw/quote.json",8028],"./section_header.json":["./packages/text-sets/src/raw/section_header.json",2421],"./step.json":["./packages/text-sets/src/raw/step.json",5230],"./table.json":["./packages/text-sets/src/raw/table.json",8039]};function webpackAsyncContext(req){if(!__webpack_require__.o(map,req))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}));var ids=map[req],id=ids[0];return __webpack_require__.e(ids[1]).then((()=>__webpack_require__.t(id,19)))}webpackAsyncContext.keys=()=>Object.keys(map),webpackAsyncContext.id="./packages/text-sets/src/raw lazy recursive ^\\.\\/.*\\.json$",module.exports=webpackAsyncContext}}]);
//# sourceMappingURL=story-editor.0b47e17c.iframe.bundle.js.map