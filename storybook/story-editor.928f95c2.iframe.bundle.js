(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[3695],{"./packages/design-system/src/images/desert_bw.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _path,_path2,_circle,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const SvgDesertBw=({title,titleId,...props})=>react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 274 118","aria-labelledby":titleId},props),title?react__WEBPACK_IMPORTED_MODULE_0__.createElement("title",{id:titleId},title):null,_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"#767E80",d:"M59.68 117.706 8.551 106.934C2.505 105.66-.951 99.261 1.3 93.506l1.18-3.019a10 10 0 0 1 7.987-6.268l78.795-10.544a10 10 0 0 0 2.524-.683l82.061-34.244a10 10 0 0 1 8.263.255l56.296 27.675q.654.323 1.349.545l26.84 8.637c9.132 2.939 9.287 15.804.228 18.962l-26.529 9.248c-.819.285-1.671.463-2.536.529L62.497 117.892a10 10 0 0 1-2.818-.186"})),_path2||(_path2=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"#ADB1B3",fillRule:"evenodd",d:"M224 26a4 4 0 0 1 4-4h2a4 4 0 0 1 4 4v31h4V44a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-7v17h-10V49h-7a2 2 0 0 1-2-2V31a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v13h4zM120.857 53.179a2.143 2.143 0 0 1 4.286 0v14.25h1.714V62.07a1.072 1.072 0 0 1 2.143 0V68.5a1.2 1.2 0 0 1-.048.319 1.07 1.07 0 0 1-1.023.753h-2.786v5.892h-4.286v-7.892h-2.786A1.073 1.073 0 0 1 117 66.5v-6.429a1.072 1.072 0 0 1 2.143 0v5.358h1.714zM64.786 8a8 8 0 0 1 8-8h.428a8 8 0 0 1 8 8v34.643h6.572V22a4 4 0 0 1 4-4H92a4 4 0 0 1 4 4v24.857a4 4 0 0 1-4 4H81.214v42.786H64.786V78.857H54a3.99 3.99 0 0 1-2.828-1.171A4 4 0 0 1 50 74.857V50a4 4 0 0 1 4-4h.214a4 4 0 0 1 4 4v20.643h6.572z",clipRule:"evenodd"})),_circle||(_circle=react__WEBPACK_IMPORTED_MODULE_0__.createElement("circle",{cx:213,cy:72,r:13,fill:"#E4E5E6"}))),__WEBPACK_DEFAULT_EXPORT__=(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(SvgDesertBw)},"./.storybook/stories/playground/story-editor/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E:()=>LOCAL_STORAGE_CONTENT_KEY,F:()=>LOCAL_STORAGE_PREVIEW_MARKUP_KEY});const LOCAL_STORAGE_CONTENT_KEY="web_stories_json_content",LOCAL_STORAGE_PREVIEW_MARKUP_KEY="web_stories_preview_markup"},"./.storybook/stories/playground/story-editor/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{_default:()=>_default,default:()=>story_editor});var react=__webpack_require__("./node_modules/react/index.js"),dialog=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js"),__webpack_require__("./node_modules/core-js/modules/esnext.json.parse.js"),__webpack_require__("./packages/story-editor/src/components/dialog/index.js")),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),stylis_rtl=__webpack_require__("./node_modules/stylis-plugin-rtl/dist/stylis-rtl.js"),deepMerge=__webpack_require__("./packages/design-system/src/utils/deepMerge.ts"),snackbarProvider=__webpack_require__("./packages/design-system/src/contexts/snackbar/snackbarProvider.tsx"),popupProvider=__webpack_require__("./packages/design-system/src/contexts/popup/popupProvider.ts"),styles=__webpack_require__("./packages/design-system/src/components/modal/styles.ts"),flagged_esm=__webpack_require__("./packages/story-editor/node_modules/flagged/dist/flagged.esm.js"),src=__webpack_require__("./packages/transform/src/index.ts"),moveable_src=__webpack_require__("./packages/moveable/src/index.ts"),theme=__webpack_require__("./packages/design-system/src/theme/theme.ts"),scrollbar=__webpack_require__("./packages/design-system/src/theme/helpers/scrollbar.ts"),react_src=__webpack_require__("./packages/react/src/index.ts");const GlobalStyle=(0,styled_components_browser_esm.vJ)(["ul#adminmenu a.wp-has-current-submenu::after{border-right-color:",";}.web-stories-content b,.web-stories-content strong{font-weight:bold;}body.edit-story #wpbody *{",";}"],theme.r.colors.bg.secondary,scrollbar.d);const src_theme=theme.r;var tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),app_story=__webpack_require__("./packages/story-editor/src/app/story/index.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function CopyStoryDataToClipboard(){const{pages,current,selection,story}=(0,app_story.rB)((({internal})=>({pages:internal.reducerState.pages,current:internal.reducerState.current,selection:internal.reducerState.selection,story:internal.reducerState.story}))),copyToClipboard=(0,react_src.I4)((async()=>{const jsonStr=JSON.stringify({pages,current,selection,story},null,2);try{await navigator.clipboard.writeText(jsonStr),alert((0,i18n.__)("Copied to clipboard","web-stories"))}catch(err){alert((0,i18n.__)("Failed to copy story data","web-stories"))}}),[pages,current,selection,story]);return pages&&current&&selection&&story?(0,jsx_runtime.jsx)(button_button.z,{onClick:copyToClipboard,variant:constants.Wu.Rectangle,type:constants.L$.Quaternary,size:constants.qE.Small,children:(0,i18n.__)("Copy story data","web-stories")}):null}CopyStoryDataToClipboard.displayName="CopyStoryDataToClipboard";const copyStoryDataToClipboard=CopyStoryDataToClipboard,Message=styled_components_browser_esm.ZP.div.withConfig({displayName:"errorActions__Message",componentId:"sc-mspoll-0"})(["color:#fff;font-size:16px;font-weight:300;line-height:1.6;padding:20px;button{margin-right:6px;}"]),TextArea=styled_components_browser_esm.ZP.textarea.withConfig({displayName:"errorActions__TextArea",componentId:"sc-mspoll-1"})(["width:100%;min-height:200px;"]),P=styled_components_browser_esm.ZP.p.withConfig({displayName:"errorActions__P",componentId:"sc-mspoll-2"})(["margin:0 0 8px 0;"]),Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"errorActions__Wrapper",componentId:"sc-mspoll-3"})(["display:flex;"]);function ErrorActions({error,errorInfo}){const textAreaContent=`${error}\n${errorInfo.componentStack}`;return(0,jsx_runtime.jsxs)(Message,{children:[(0,jsx_runtime.jsx)(P,{children:(0,i18n.__)("Something went wrong!","web-stories")}),(0,jsx_runtime.jsx)(P,{children:(0,i18n.__)("The editor has crashed. Please try reloading the page and report the error using the button below.","web-stories")}),(0,jsx_runtime.jsx)(P,{children:(0,i18n.__)("Apologies for the inconvenience.","web-stories")}),(0,jsx_runtime.jsx)(P,{children:(0,jsx_runtime.jsx)(TextArea,{readOnly:!0,value:textAreaContent,onFocus:e=>e.target.setSelectionRange(0,textAreaContent.length)})}),(0,jsx_runtime.jsxs)(Wrapper,{children:[(0,jsx_runtime.jsx)(button_button.z,{variant:constants.Wu.Rectangle,type:constants.L$.Quaternary,size:constants.qE.Small,onClick:()=>{window.location.reload(!0)},children:(0,i18n.__)("Reload","web-stories")}),(0,jsx_runtime.jsx)(copyStoryDataToClipboard,{}),(0,jsx_runtime.jsx)(button_button.i,{variant:constants.Wu.Rectangle,type:constants.L$.Primary,size:constants.qE.Small,href:"https://wordpress.org/support/plugin/web-stories/#new-topic-0",target:"_blank",rel:"noreferrer",children:(0,i18n.__)("Report Error","web-stories")})]})]})}ErrorActions.displayName="ErrorActions";const errorActions=ErrorActions;class ErrorBoundary extends react_src.wA{state={error:null,errorInfo:null};componentDidCatch(error,errorInfo){this.setState({error,errorInfo});const msg=errorInfo?`${error.message}\n\n${errorInfo.componentName}\n${errorInfo.componentStack}`:error.message;(0,tracking_src.tz)("editor_error_boundary",msg,!0)}render(){const{error,errorInfo}=this.state;return error?(0,jsx_runtime.jsx)(errorActions,{error,errorInfo}):this.props.children}}ErrorBoundary.displayName="ErrorBoundary";const errorBoundary=ErrorBoundary;var app_config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),api=__webpack_require__("./packages/story-editor/src/app/api/index.ts"),media3p_api=__webpack_require__("./packages/story-editor/src/app/media/media3p/api/index.js"),app_history=__webpack_require__("./packages/story-editor/src/app/history/index.ts"),font=__webpack_require__("./packages/story-editor/src/app/font/index.ts"),app_media=__webpack_require__("./packages/story-editor/src/app/media/index.js"),currentUser=__webpack_require__("./packages/story-editor/src/app/currentUser/index.ts"),taxonomy=__webpack_require__("./packages/story-editor/src/app/taxonomy/index.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),utils_useIsUploadingToStory=__webpack_require__("./packages/story-editor/src/utils/useIsUploadingToStory.js");const autoSaveHandler=function AutoSaveHandler(){const{autoSaveInterval}=(0,app.ZR)(),{state:{hasNewChanges}}=(0,app.k6)(),{autoSave,isSaving}=(0,app.rB)((({actions,state})=>({isSaving:state.meta.isSaving,autoSave:actions.autoSave}))),isUploading=(0,utils_useIsUploadingToStory.Z)(),cachedSaveStory=(0,react_src.sO)(autoSave);return(0,react_src.d4)((()=>{cachedSaveStory.current=autoSave}),[autoSave]),(0,react_src.d4)((()=>{if(!hasNewChanges||!autoSaveInterval||isUploading||isSaving)return;const timeout=setTimeout((()=>cachedSaveStory.current()),1e3*autoSaveInterval);return()=>clearTimeout(timeout)}),[autoSaveInterval,hasNewChanges,isUploading,isSaving]),null};var sessionStore=__webpack_require__("./packages/design-system/src/utils/sessionStore.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),getSessionStorageKey=__webpack_require__("./packages/story-editor/src/utils/getSessionStorageKey.ts");function LocalAutoSave(){const{localAutoSaveInterval=15}=(0,app.ZR)(),{state:{hasNewChanges}}=(0,app.k6)(),isUploading=(0,utils_useIsUploadingToStory.Z)(),{isAutoSavingStory}=(0,app.rB)((({state})=>({isAutoSavingStory:state.meta.isAutoSavingStory}))),{story,pages,restoreLocalAutoSave}=(0,app.rB)((({state,actions})=>({story:state.story,pages:state.pages,restoreLocalAutoSave:actions.restoreLocalAutoSave}))),{storyId,status}=story,isNew="auto-draft"===status,[backup,setBackup]=(0,react_src.eJ)(null),storyRef=(0,react_src.sO)(),pagesRef=(0,react_src.sO)();(0,react_src.d4)((()=>{storyRef.current=story,pagesRef.current=pages}),[story,pages]),(0,react_src.d4)((()=>{if(!hasNewChanges||!localAutoSaveInterval||isUploading||isAutoSavingStory)return;const timeout=setTimeout((()=>sessionStore.Qf.setItemByKey((0,getSessionStorageKey.Z)(storyId,isNew),{story,pages})),1e3*localAutoSaveInterval);return()=>clearTimeout(timeout)}),[localAutoSaveInterval,hasNewChanges,isUploading,pages,story,storyId,isNew,isAutoSavingStory]);const onClose=()=>{sessionStore.Qf.deleteItemByKey((0,getSessionStorageKey.Z)(storyId,isNew)),setBackup(null)},didAutoSaveTracker=(0,react_src.sO)(isAutoSavingStory);(0,react_src.d4)((()=>{isAutoSavingStory?didAutoSaveTracker.current=!0:didAutoSaveTracker.current&&!backup&&(sessionStore.Qf.deleteItemByKey((0,getSessionStorageKey.Z)(storyId,!1)),didAutoSaveTracker.current=!1)}),[isAutoSavingStory,backup,storyId]);const hadNewChangesTracker=(0,react_src.sO)(!1),wasNewTracker=(0,react_src.sO)(isNew);if((0,react_src.d4)((()=>{hasNewChanges?hadNewChangesTracker.current=!0:hadNewChangesTracker.current&&!backup&&(wasNewTracker.current?sessionStore.Qf.deleteItemByKey((0,getSessionStorageKey.Z)(null,!0)):sessionStore.Qf.deleteItemByKey((0,getSessionStorageKey.Z)(storyId,!1)),hadNewChangesTracker.current=!1,wasNewTracker.current=isNew)}),[hasNewChanges,backup,storyId,isNew]),(0,react_src.d4)((()=>{const existingAutoSave=sessionStore.Qf.getItemByKey((0,getSessionStorageKey.Z)(storyId,isNew));if(!existingAutoSave)return;JSON.stringify(existingAutoSave.pages)!==JSON.stringify(pagesRef.current)&&JSON.stringify(existingAutoSave.story)!==JSON.stringify(storyRef.current)?setBackup(existingAutoSave):sessionStore.Qf.deleteItemByKey((0,getSessionStorageKey.Z)(storyId,isNew))}),[setBackup,isNew,storyId]),!backup)return null;return(0,jsx_runtime.jsx)(dialog.Z,{isOpen:!0,secondaryText:(0,i18n.__)("Dismiss","web-stories"),onClose,actions:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(button_button.z,{type:constants.L$.Tertiary,size:constants.qE.Small,onClick:onClose,children:(0,i18n.__)("Dismiss","web-stories")}),(0,jsx_runtime.jsx)(button_button.z,{type:constants.L$.Primary,size:constants.qE.Small,onClick:()=>{restoreLocalAutoSave(),sessionStore.Qf.deleteItemByKey((0,getSessionStorageKey.Z)(storyId,isNew)),setBackup(null)},children:(0,i18n.__)("Restore Backup","web-stories")})]}),children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.Small,children:(0,i18n.__)("The backup of this story in your browser is different from the current version.","web-stories")})})}LocalAutoSave.displayName="LocalAutoSave";const localAutoSave=LocalAutoSave;var dropTargets=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),helpCenter=__webpack_require__("./packages/story-editor/src/app/helpCenter/index.ts"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const context=(0,react_src.kr)({state:{dataUrls:{}},actions:{queuePageImageGeneration:noop.Z}});const pageDataUrls_usePageDataUrls=function usePageDataUrls(selector=react_src.yR){return(0,react_src.Sz)(context,selector)};var useIdleTaskQueue=__webpack_require__("./packages/story-editor/src/utils/useIdleTaskQueue.ts"),src_constants=__webpack_require__("./packages/units/src/constants.ts"),storyPageToNode=__webpack_require__("./packages/story-editor/src/app/pageCanvas/utils/storyPageToNode.tsx");const utils_storyPageToDataUrl=async function storyPageToDataUrl(page,{width=400,...options}){const htmlToImage=await __webpack_require__.e(3182).then(__webpack_require__.bind(__webpack_require__,"./node_modules/html-to-image/es/index.js")),[node,cleanup]=await(0,storyPageToNode.Z)(page,width),dataUrl=await htmlToImage.toJpeg(node,{...options,width,height:width*(1/src_constants.O1),canvasHeight:width*(1/src_constants.O1),canvasWidth:width});return cleanup(),dataUrl};function PageDataUrlProvider({children}){const[dataUrls,setDataUrls]=(0,react_src.eJ)({}),queueIdleTask=(0,useIdleTaskQueue.Z)(),queuePageImageGeneration=(0,react_src.I4)((storyPage=>{const idleTaskUid=storyPage.id,clearQueueOfPageTask=queueIdleTask({taskId:idleTaskUid,task:async()=>{try{const dataUrl=await utils_storyPageToDataUrl(storyPage,{});setDataUrls((state=>({...state,[storyPage?.id]:dataUrl})))}catch{}}});return()=>{clearQueueOfPageTask()}}),[queueIdleTask]),value=(0,react_src.Ye)((()=>({state:{dataUrls},actions:{queuePageImageGeneration}})),[queuePageImageGeneration,dataUrls]);return(0,jsx_runtime.jsx)(context.Provider,{value,children})}PageDataUrlProvider.displayName="PageDataUrlProvider";const pageDataUrlsProvider=PageDataUrlProvider;var pageCanvas=__webpack_require__("./packages/story-editor/src/app/pageCanvas/index.ts"),migration_src=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-exception.stack.js"),__webpack_require__("./packages/migration/src/index.ts")),useSnackbar=__webpack_require__("./packages/design-system/src/contexts/snackbar/useSnackbar.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),dummyData=__webpack_require__("./packages/story-editor/src/components/devTools/dummyData.js");const Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"devTools__Container",componentId:"sc-1mo3vwv-0"})(["position:fixed;z-index:2147483646;bottom:0;left:0;display:flex;flex-direction:column;width:35%;height:50%;border:6px solid ",";background:",";color:",";"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.bg.primary),(({theme})=>theme.colors.fg.secondary)),Textarea=styled_components_browser_esm.ZP.textarea.withConfig({displayName:"devTools__Textarea",componentId:"sc-1mo3vwv-1"})(["flex:1;border:0;background:",";color:",";white-space:nowrap;overflow:auto;"],(({theme})=>theme.colors.bg.primary),(({theme})=>theme.colors.fg.secondary)),Options=styled_components_browser_esm.ZP.div.withConfig({displayName:"devTools__Options",componentId:"sc-1mo3vwv-2"})(["display:flex;justify-content:space-between;padding:6px;"]),Label=styled_components_browser_esm.ZP.label.withConfig({displayName:"devTools__Label",componentId:"sc-1mo3vwv-3"})(["margin-right:6px;"]),devTools_Button=styled_components_browser_esm.ZP.button.withConfig({displayName:"devTools__Button",componentId:"sc-1mo3vwv-4"})(["margin-left:6px;"]),replaceResourcesWithDummy=state=>{const videosToReload=[];return[{...state,pages:state.pages.map((page=>({...page,elements:page.elements.map((element=>{const newElement={...element};return"resource"in element&&(newElement.resource={...element.resource},"video"===element.type&&(newElement.resource.mimeType="video/mp4",newElement.resource.src=dummyData.k,newElement.resource.poster=dummyData.r,videosToReload.push(newElement.id)),"image"===element.type&&(newElement.resource.mimeType="image/png",newElement.resource.src=dummyData.r)),newElement}))})))},videosToReload]},getResourceFileName=src=>{if(!src.length)return src;const matchedPaths=src.match(/\/([^/?#]+)[^/]*$/);return matchedPaths.length>1?`__WEB_STORIES_TEMPLATE_BASE_URL__/images/templates/%%templateName%%/${matchedPaths[1]}`:src};const devTools=function DevTools(){const[isVisible,setIsVisible]=(0,react_src.eJ)(!1),[isBase64,setIsBase64]=(0,react_src.eJ)(!1),[isDummyResources,setIsDummyResources]=(0,react_src.eJ)(!1),[isTemplate,setIsTemplate]=(0,react_src.eJ)(!1),{showSnackbar}=(0,useSnackbar.D)(),textareaRef=(0,react_src.sO)(),{reducerState,restore}=(0,app_story.rB)((({internal})=>({reducerState:internal.reducerState,restore:internal.restore}))),{pages,current,selection,story:{globalStoryStyles}}=reducerState,reducerStateSlice={current,selection,story:{globalStoryStyles},version:migration_src.n,pages},storyData=isDummyResources?replaceResourcesWithDummy(reducerStateSlice)[0]:isTemplate?(state=reducerStateSlice,{...state,pages:state.pages.map((page=>({...page,elements:page.elements.map((element=>{const newElement={...element};return"resource"in element&&(newElement.resource={...element.resource},"video"===element.type&&(newElement.resource.id=0,newElement.resource.posterId=0,newElement.resource.src=getResourceFileName(newElement.resource.src),newElement.resource.poster=getResourceFileName(newElement.resource.poster)),"image"===element.type&&(newElement.resource.id=0,newElement.resource.sizes=[],newElement.resource.src=getResourceFileName(newElement.resource.src))),newElement})),pageTemplateType:page?.pageTemplateType??""})))}):reducerStateSlice;var state;const toggleVisible=()=>setIsVisible((v=>!v));(0,keyboard.xb)({key:"mod+shift+alt+j",editable:!0},toggleVisible);const jsonStr=JSON.stringify(storyData,null,2),defaultOutput=isBase64?window.btoa(jsonStr):jsonStr,[output,setOutput]=(0,react_src.eJ)(defaultOutput);return(0,react_src.d4)((()=>setOutput(defaultOutput)),[defaultOutput]),isVisible?(0,jsx_runtime.jsxs)(Container,{children:[(0,jsx_runtime.jsxs)(Options,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)(Label,{title:"For easier sharing thru various channels",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:isBase64,onChange:()=>setIsBase64((v=>!v))}),"Base64"]}),(0,jsx_runtime.jsxs)(Label,{title:"Replace resources with dummy resources",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:isDummyResources,onChange:()=>setIsDummyResources((v=>!v))}),"Dummy resources"]}),(0,jsx_runtime.jsxs)(Label,{title:"Export as Template",children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:isTemplate,onChange:()=>setIsTemplate((v=>!v))}),"Template"]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(devTools_Button,{"aria-label":"Load data from input",onClick:()=>{let input=output;try{input=window.atob(input)}catch(e){}const inputState=JSON.parse(input),stateToRestore={...inputState,story:{...reducerState.story,...inputState.story},capabilities:reducerState.capabilities},[stateWithDummyResources,videosToReload]=isDummyResources?replaceResourcesWithDummy(stateToRestore):[stateToRestore,[]];restore(stateWithDummyResources),videosToReload.length>0&&videosToReload.forEach((videoId=>{const videoEl=document.getElementById(`video-${videoId}`);videoEl&&videoEl.load()})),showSnackbar({message:"Story restored from input",timeout:1200})},children:"Load"}),(0,jsx_runtime.jsx)(devTools_Button,{"aria-label":"Copy data to clipboard",onClick:()=>{textareaRef.current.select(),document.execCommand("copy"),textareaRef.current.setSelectionRange(0,0),showSnackbar({message:"Copied to clipboard",timeout:1200})},children:"Copy"}),(0,jsx_runtime.jsx)(devTools_Button,{"aria-label":"Close DevTools",onClick:toggleVisible,children:"X"})]})]}),(0,jsx_runtime.jsx)(Textarea,{ref:textareaRef,className:"mousetrap",value:output,onChange:evt=>setOutput(evt.target.value)})]}):null};var keyboardOnlyOutline=__webpack_require__("./packages/story-editor/src/utils/keyboardOnlyOutline.js");const src_getDefaultConfig=()=>({locale:{locale:"en-US",dateFormat:"F j, Y",timeFormat:"g:i a",gmtOffset:"0",timezone:"",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysInitials:["S","M","T","W","T","F","S"],weekStartsOn:1},allowedMimeTypes:{audio:["audio/mpeg","audio/aac","audio/wav","audio/ogg"],image:["image/png","image/jpeg","image/jpg","image/gif","image/webp"],caption:["text/vtt"],vector:["image/svg+xml"],video:["video/mp4","video/webm"]},isRTL:!1,storyId:1,cdnURL:"https://wp.stories.google/static/main/",maxUpload:314572800,capabilities:{hasUploadMediaAction:!1,canManageSettings:!1},metadata:{publisher:""},canViewDefaultTemplates:!0,showMedia3p:!0,encodeMarkup:!0,ffmpegCoreUrl:"https://wp.stories.google/static/main/js/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js",apiCallbacks:{},MediaUpload:()=>null,styleConstants:{topOffset:0,leftOffset:0}});function StoryEditor({config,initialEdits,children}){const _config=(0,deepMerge.Z)(src_getDefaultConfig(),config),{storyId,isRTL,flags,styleConstants:{leftOffset,topOffset}={}}=_config;return(0,jsx_runtime.jsx)(flagged_esm.Q_,{features:flags,children:(0,jsx_runtime.jsx)(styled_components_browser_esm.LC,{stylisPlugins:isRTL?[stylis_rtl.ZP]:[],children:(0,jsx_runtime.jsx)(styled_components_browser_esm.f6,{theme:src_theme,children:(0,jsx_runtime.jsx)(errorBoundary,{children:(0,jsx_runtime.jsx)(app_config.iV,{config:_config,children:(0,jsx_runtime.jsx)(api.un,{children:(0,jsx_runtime.jsx)(media3p_api.z,{children:(0,jsx_runtime.jsx)(app_history.f6,{size:50,children:(0,jsx_runtime.jsx)(snackbarProvider.Z,{children:(0,jsx_runtime.jsx)(app_story.FR,{storyId,initialEdits,children:(0,jsx_runtime.jsx)(taxonomy.L,{children:(0,jsx_runtime.jsx)(currentUser.MF,{children:(0,jsx_runtime.jsx)(font.jv,{children:(0,jsx_runtime.jsxs)(app_media.ZN,{children:[(0,jsx_runtime.jsx)(localAutoSave,{}),(0,jsx_runtime.jsx)(autoSaveHandler,{}),(0,jsx_runtime.jsx)(src.c8,{children:(0,jsx_runtime.jsx)(dropTargets.i,{children:(0,jsx_runtime.jsx)(helpCenter.z,{children:(0,jsx_runtime.jsx)(pageCanvas.O6,{children:(0,jsx_runtime.jsx)(pageDataUrlsProvider,{children:(0,jsx_runtime.jsxs)(popupProvider.Z,{value:{isRTL,leftOffset,topOffset},children:[(0,jsx_runtime.jsx)(GlobalStyle,{}),(0,jsx_runtime.jsx)(devTools,{}),(0,jsx_runtime.jsx)(moveable_src.O5,{}),(0,jsx_runtime.jsx)(moveable_src.hj,{}),(0,jsx_runtime.jsx)(styles.H,{}),(0,jsx_runtime.jsx)(keyboardOnlyOutline.ZP,{}),children]})})})})})})]})})})})})})})})})})})})})})}Object.defineProperty(stylis_rtl.ZP,"name",{value:"stylisRTLPlugin"}),StoryEditor.displayName="StoryEditor";const storyEditor=StoryEditor;var prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),generatePatternStyles=__webpack_require__("./packages/patterns/src/generatePatternStyles.ts"),animation_src=__webpack_require__("./packages/animation/src/index.ts"),propTypes=__webpack_require__("./packages/story-editor/src/propTypes.js"),displayElement=__webpack_require__("./packages/story-editor/src/components/canvas/displayElement.js");const previewPageElements=(0,react_src.X$)((function PreviewPageElements({page}){return page.elements.map((element=>(0,jsx_runtime.jsx)(displayElement.Z,{previewMode:!0,page,element,isAnimatable:!0},element.id)))})),FullBleedPreviewWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"previewPage__FullBleedPreviewWrapper",componentId:"sc-1r5t7dq-0"})(["height:",";width:100%;overflow:hidden;position:relative;display:flex;align-items:center;background-color:white;",";"],(({pageSize})=>`${pageSize.containerHeight}px`),(({background})=>(0,generatePatternStyles.Z)(background))),PreviewSafeZone=styled_components_browser_esm.ZP.div.withConfig({displayName:"previewPage__PreviewSafeZone",componentId:"sc-1r5t7dq-1"})(["width:100%;height:",";overflow:visible;position:absolute;margin:0;"],(({pageSize})=>`${pageSize.height}px`));function PreviewPageAnimationController({animationState}){const WAAPIAnimationMethods=(0,animation_src.JK)((({actions})=>actions.WAAPIAnimationMethods));return(0,react_src.d4)((()=>{switch(animationState){case animation_src.pG.Playing:return WAAPIAnimationMethods.play(),noop.Z;case animation_src.pG.Reset:return WAAPIAnimationMethods.reset(),noop.Z;case animation_src.pG.Scrubbing:case animation_src.pG.Paused:return WAAPIAnimationMethods.pause(),noop.Z;default:return noop.Z}}),[animationState,WAAPIAnimationMethods]),(0,react_src.d4)((()=>()=>WAAPIAnimationMethods.reset()),[WAAPIAnimationMethods]),null}const PreviewPageDisplay=(0,react_src.X$)((0,react_src.Gp)((function PreviewPageDisplay({page,pageSize},ref){return(0,jsx_runtime.jsx)(FullBleedPreviewWrapper,{ref,pageSize,background:page.backgroundColor,children:(0,jsx_runtime.jsx)(PreviewSafeZone,{pageSize,children:(0,jsx_runtime.jsx)(previewPageElements,{page})})})})));(0,react_src.Gp)((function PreviewPage({page,pageSize,animationState=animation_src.pG.Reset,onAnimationComplete},ref){return(0,jsx_runtime.jsx)(styled_components_browser_esm.LC,{stylisPlugins:[],children:(0,jsx_runtime.jsxs)(animation_src.bu,{animations:page.animations,elements:page.elements,onWAAPIFinish:onAnimationComplete,children:[(0,jsx_runtime.jsx)(PreviewPageDisplay,{ref,page,pageSize}),(0,jsx_runtime.jsx)(PreviewPageAnimationController,{animationState})]})})}));PreviewPageAnimationController.propTypes={animationState:prop_types_default().oneOf(Object.values(animation_src.pG))};class PreviewErrorBoundary extends react_src.wA{state={hasError:!1};static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(error,errorInfo){console.error(error,errorInfo)}render(){return this.state.hasError?(0,jsx_runtime.jsx)("div",{}):this.props.children}}PreviewErrorBoundary.displayName="PreviewErrorBoundary";__webpack_require__("./packages/design-system/src/icons/arrow_down_left_curved.svg"),__webpack_require__("./packages/design-system/src/icons/arrow_down_right_curved.svg");var components_tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js");function HistoryButton({title,shortcut,children,...rest}){return(0,jsx_runtime.jsx)(components_tooltip.Z,{title,shortcut,hasTail:!0,children:(0,jsx_runtime.jsx)(button_button.z,{variant:constants.Wu.Square,type:constants.L$.Quaternary,size:constants.qE.Small,...rest,children})})}HistoryButton.displayName="HistoryButton";var dom_src=__webpack_require__("./packages/dom/src/index.ts");function previewErrorDialog_PreviewErrorDialog({isOpen,onClose,onRetry}){return(0,jsx_runtime.jsx)(dialog.Z,{isOpen,onClose,title:(0,i18n.__)("Open preview","web-stories"),secondaryText:(0,i18n.__)("Cancel","web-stories"),onPrimary:onRetry,primaryText:(0,i18n.__)("Try again","web-stories"),children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.Small,children:(0,i18n.__)("The preview window failed to open.","web-stories")})})}previewErrorDialog_PreviewErrorDialog.displayName="PreviewErrorDialog";var date_src=__webpack_require__("./packages/date/src/index.ts"),checklist=(__webpack_require__("./packages/story-editor/src/utils/useRefreshPostEditURL.ts"),__webpack_require__("./packages/story-editor/src/components/checklist/index.js")),buttonWithChecklistWarning=(__webpack_require__("./packages/story-editor/src/components/publishModal/publishModal.js"),__webpack_require__("./packages/story-editor/src/components/header/buttons/buttonWithChecklistWarning.js"));var page_swap=__webpack_require__("./packages/design-system/src/icons/page_swap.svg");function SwitchToDraftButton({forceIsSaving=!1}){const{isSaving,saveStory}=(0,app.rB)((({state:{meta:{isSaving}},actions:{saveStory}})=>({isSaving,saveStory}))),isUploading=(0,utils_useIsUploadingToStory.Z)(),handleUnPublish=(0,react_src.I4)((()=>{saveStory({status:"draft"})}),[saveStory]),label=(0,i18n.__)("Switch to Draft","web-stories");return(0,jsx_runtime.jsx)(components_tooltip.Z,{title:label,hasTail:!0,children:(0,jsx_runtime.jsx)(button_button.z,{variant:constants.Wu.Square,type:constants.L$.Quaternary,size:constants.qE.Small,onClick:handleUnPublish,disabled:isSaving||forceIsSaving||isUploading,"aria-label":label,children:(0,jsx_runtime.jsx)(page_swap.Z,{})})})}SwitchToDraftButton.displayName="SwitchToDraftButton";var floppy_disk=__webpack_require__("./packages/design-system/src/icons/floppy_disk.svg");function PlainButton({text,onClick,disabled}){return(0,jsx_runtime.jsx)(components_tooltip.Z,{title:text,hasTail:!0,children:(0,jsx_runtime.jsx)(button_button.z,{variant:constants.Wu.Square,type:constants.L$.Quaternary,size:constants.qE.Small,onClick,disabled,"aria-label":text,children:(0,jsx_runtime.jsx)(floppy_disk.Z,{})})})}function UpdateButton({hasUpdates=!1,forceIsSaving=!1}){const{isSaving:_isSaving,status,date,saveStory,canPublish}=(0,app.rB)((({state:{meta:{isSaving},story:{status,date},capabilities},actions:{saveStory}})=>({isSaving,status,date,saveStory,canPublish:Boolean(capabilities?.publish)}))),isSaving=_isSaving||forceIsSaving,isUploading=(0,utils_useIsUploadingToStory.Z)(),{state:{hasNewChanges}}=(0,app.k6)();(0,keyboard.xb)({key:["mod+s"]},(event=>{event.preventDefault(),isSaving||isUploading||saveStory()}),[saveStory,isSaving,isUploading]);const isEnabled=!isSaving&&!isUploading&&(hasNewChanges||hasUpdates),isPending="pending"===status,isDraft=["draft","auto-draft"].includes(status)||!status;if(isPending)return(0,jsx_runtime.jsx)(PlainButton,{text:(0,i18n.__)("Save as pending","web-stories"),disabled:!isEnabled,onClick:()=>saveStory()});if(isDraft)return(0,jsx_runtime.jsx)(PlainButton,{text:(0,i18n.__)("Save draft","web-stories"),disabled:!isEnabled,onClick:()=>saveStory()});const text=(0,date_src.Ax)((0,date_src._5)((0,date_src.ZU)(date,(0,date_src.FW)()),1),(0,date_src.ZU)(new Date,(0,date_src.FW)()))&&"private"!==status?(0,i18n.__)("Schedule","web-stories"):(0,i18n.__)("Update","web-stories");return(0,jsx_runtime.jsx)(buttonWithChecklistWarning.Z,{text,onClick:()=>saveStory(),disabled:!isEnabled,isUploading,canPublish})}PlainButton.displayName="PlainButton",UpdateButton.displayName="UpdateButton";var expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),storyUpdates=__webpack_require__("./packages/story-editor/src/utils/storyUpdates.ts"),highlights=__webpack_require__("./packages/story-editor/src/app/highlights/index.ts"),highlights_styles=__webpack_require__("./packages/story-editor/src/app/highlights/styles.js");const Input=styled_components_browser_esm.ZP.input.withConfig({displayName:"title__Input",componentId:"sc-jcmnyx-0"})(["color:",";margin:0;"," background:",";border:none !important;text-align:start;min-width:60%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-radius:",";",";",""],(({theme})=>`${theme.colors.fg.primary} !important`),expandPresetStyles.K((({paragraph},{Medium})=>paragraph[Medium])),(({isHighlighted})=>!isHighlighted&&"none !important"),(({theme})=>theme.borders.radius.small),outline.L,(({isHighlighted})=>isHighlighted&&(0,styled_components_browser_esm.iv)([""," ",""],highlights_styles.Z.OUTLINE,highlights_styles.Z.FLASH)));function HeaderTitle(){const{title,slug,updateStory}=(0,app_story.rB)((({state:{story:{title,slug}},actions:{updateStory}})=>({title,slug,updateStory}))),{highlight,resetHighlight,cancelHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.StoryTitle],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),handleChange=(0,react_src.I4)((evt=>updateStory({properties:{title:evt.target.value}})),[updateStory]),handleBlur=(0,react_src.I4)((()=>{(0,storyUpdates.e)({currentSlug:slug,currentTitle:title,updateStory})}),[slug,title,updateStory]);return"string"!=typeof title?null:(0,jsx_runtime.jsx)(Input,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},value:title,type:"text",onBlur:handleBlur,onChange:handleChange,placeholder:(0,i18n.__)("Add title","web-stories"),"aria-label":(0,i18n.__)("Story title","web-stories"),isHighlighted:highlight?.showEffect,onAnimationEnd:()=>resetHighlight()})}HeaderTitle.displayName="HeaderTitle";const title=HeaderTitle;__webpack_require__("./packages/story-editor/src/components/panels/document/index.js");var components_form=__webpack_require__("./packages/story-editor/src/components/form/index.js"),panel=__webpack_require__("./packages/story-editor/src/components/panels/panel/index.js"),shared=__webpack_require__("./packages/story-editor/src/components/panels/shared/index.js"),shared_styles=(__webpack_require__("./packages/story-editor/src/components/fontPicker/index.js"),__webpack_require__("./packages/story-editor/src/components/panels/shared/styles.js")),snackbarContainer=(__webpack_require__("./packages/story-editor/src/components/checklistCard/index.js"),__webpack_require__("./packages/story-editor/src/app/story/utils/getStoryPropsToSave.ts"),__webpack_require__("./packages/story-editor/src/app/font/context.ts"),__webpack_require__("./packages/story-editor/src/app/font/actions/useLoadFontFiles.ts"),__webpack_require__("./packages/design-system/src/components/snackbar/snackbarContainer.tsx")),rich_text_src=__webpack_require__("./packages/rich-text/src/index.ts"),uploadDropTarget=__webpack_require__("./packages/story-editor/src/components/uploadDropTarget/index.js"),tabview=__webpack_require__("./packages/story-editor/src/components/tabview/index.js"),useHighlights=__webpack_require__("./packages/story-editor/src/app/highlights/useHighlights.ts"),useSidebar=__webpack_require__("./packages/story-editor/src/components/sidebar/useSidebar.js");const getTabId=id=>`sidebar-tab-${id}`,SidebarPane=styled_components_browser_esm.ZP.div.attrs({role:"tabpanel"}).withConfig({displayName:"sidebarContent__SidebarPane",componentId:"sc-1f2hu7i-0"})(["height:100%;overflow:overlay;"]),SidebarPanes=styled_components_browser_esm.ZP.section.withConfig({displayName:"sidebarContent__SidebarPanes",componentId:"sc-1f2hu7i-1"})(["height:100%;"]);function Sidebar(){const{tab,tabs}=(0,useSidebar.Z)((({state:{tab},data:{tabs}})=>({tab,tabs})));return(0,jsx_runtime.jsx)(SidebarPanes,{children:tabs.map((({id,Pane})=>(0,jsx_runtime.jsx)(SidebarPane,{"aria-labelledby":id,id:getTabId(id),hidden:id!==tab,children:id===tab&&(0,jsx_runtime.jsx)(Pane,{})},id)))})}Sidebar.displayName="Sidebar";const sidebarContent=Sidebar,Layout=styled_components_browser_esm.ZP.section.attrs({"aria-label":(0,i18n.__)("Sidebar","web-stories")}).withConfig({displayName:"sidebarLayout__Layout",componentId:"sc-hpe4no-0"})(["height:100%;display:flex;flex-direction:column;background-color:",";color:",";"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.fg.secondary)),SidebarContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"sidebarLayout__SidebarContainer",componentId:"sc-hpe4no-1"})(["height:100%;padding:0;overflow:auto;"]),UnjustifiedTabView=(0,styled_components_browser_esm.ZP)(tabview.ZP).withConfig({displayName:"sidebarLayout__UnjustifiedTabView",componentId:"sc-hpe4no-2"})(["justify-content:center;"]);function SidebarLayout(){const{tab,tabRefs,setSidebarContentNode,setTab,sidebar,tabs}=(0,useSidebar.Z)((({state:{tab,tabRefs},actions:{setSidebarContentNode,setTab},refs:{sidebar},data:{tabs}})=>({tab,tabRefs,setSidebarContentNode,setTab,sidebar,tabs}))),{resetHighlight}=(0,useHighlights.Z)((state=>({resetHighlight:state.onFocusOut}))),onTabChange=(0,react_src.I4)((id=>{setTab(id),resetHighlight(),(0,tracking_src.L9)("inspector_tab_change",{name:id})}),[setTab,resetHighlight]);return(0,keyboard.Xl)(sidebar),(0,jsx_runtime.jsxs)(Layout,{ref:sidebar,children:[(0,jsx_runtime.jsx)(UnjustifiedTabView,{label:(0,i18n.__)("Sidebar Selection","web-stories"),tabs,tab,tabRefs,onTabChange,getAriaControlsId:getTabId,shortcut:"mod+option+3"}),(0,jsx_runtime.jsx)(SidebarContainer,{ref:setSidebarContentNode,children:(0,jsx_runtime.jsx)(sidebarContent,{})})]})}SidebarLayout.displayName="SidebarLayout";const sidebarLayout=SidebarLayout;function sidebar_Sidebar(){return(0,jsx_runtime.jsx)(uploadDropTarget.YE,{disabled:!0,children:(0,jsx_runtime.jsx)(sidebarLayout,{})})}sidebar_Sidebar.displayName="Sidebar";const sidebar=sidebar_Sidebar;var canvas=__webpack_require__("./packages/story-editor/src/components/canvas/index.js"),getVideoLengthDisplay=__webpack_require__("./packages/media/src/getVideoLengthDisplay.ts"),formatMsToHMS=__webpack_require__("./packages/media/src/formatMsToHMS.ts"),videoTrimContext=__webpack_require__("./packages/story-editor/src/components/videoTrim/videoTrimContext.js");const src_getMsFromHMS=function getMsFromHMS(time){if(!time)return 0;const parts=time.split(":");if(3!==parts.length)return 0;const seconds=Number.parseFloat(parts[2])+60*Number.parseInt(parts[1])+3600*Number.parseInt(parts[0]);return Math.round(1e3*seconds)};var useFFmpeg=__webpack_require__("./packages/story-editor/src/app/media/utils/useFFmpeg.ts");const videoTrim_useVideoTrimMode=function useVideoTrimMode(){const{isEditing,isTrimMode,setEditingElementWithState,clearEditing}=(0,app.$P)((({state:{isEditing,editingElementState:{isTrimMode}={}},actions:{setEditingElementWithState,clearEditing}})=>({isEditing,isTrimMode,setEditingElementWithState,clearEditing}))),{selectedElement}=(0,app.rB)((({state:{selectedElements}})=>({selectedElement:1===selectedElements.length?selectedElements[0]:null}))),{actions:{getMediaById}}=(0,app.Ek)(),[videoData,setVideoData]=(0,react_src.eJ)(null),{isCurrentResourceUploading}=(0,app.EF)((({state:{isCurrentResourceUploading}})=>({isCurrentResourceUploading}))),getVideoData=(0,react_src.I4)((()=>{const{resource}=selectedElement,{trimData}=resource,defaultVideoData={element:selectedElement,resource,start:0,end:null};getMediaById&&trimData?.original?(setVideoData(null),getMediaById(trimData.original).then((originalResource=>({element:selectedElement,resource:originalResource,start:src_getMsFromHMS(trimData.start),end:src_getMsFromHMS(trimData.end)})),(()=>defaultVideoData)).then((data=>setVideoData(data)))):setVideoData(defaultVideoData)}),[getMediaById,selectedElement]),toggleTrimMode=(0,react_src.I4)((()=>{isEditing?clearEditing():(setEditingElementWithState(selectedElement.id,{isTrimMode:!0,hasEditMenu:!0,showOverflow:!1}),getVideoData()),(0,tracking_src.L9)("video_trim_mode_toggled",{status:isEditing?"closed":"open"})}),[isEditing,clearEditing,setEditingElementWithState,selectedElement,getVideoData]),{isTranscodingEnabled}=(0,useFFmpeg.Z)(),hasTrimMode=(0,react_src.Ye)((()=>{if("video"!==selectedElement?.type||!selectedElement?.resource)return!1;const{id,isExternal}=selectedElement.resource;return isTranscodingEnabled&&!isExternal&&!isCurrentResourceUploading(id)}),[selectedElement,isTranscodingEnabled,isCurrentResourceUploading]);return{isTrimMode:Boolean(isEditing&&isTrimMode),hasTrimMode,toggleTrimMode,videoData}};var useVideoNode=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoNode.js");function VideoTrimProvider({children}){const{trimExistingVideo}=(0,app.EF)((({actions:{trimExistingVideo}})=>({trimExistingVideo}))),{isTrimMode,hasTrimMode,toggleTrimMode,videoData}=videoTrim_useVideoTrimMode(),{hasChanged,currentTime,startOffset,endOffset,maxOffset,videoNode,setStartOffset,setEndOffset,setVideoNode,setIsDraggingHandles}=(0,useVideoNode.Z)(videoData),performTrim=(0,react_src.I4)((()=>{const{resource,element}=videoData;if(!resource)return;const lengthInSeconds=Math.round(endOffset/1e3-startOffset/1e3);trimExistingVideo({resource:{...resource,length:lengthInSeconds,lengthFormatted:(0,getVideoLengthDisplay.Z)(lengthInSeconds)},canvasResourceId:element.resource.id,elementId:element.id,start:(0,formatMsToHMS.Z)(startOffset),end:(0,formatMsToHMS.Z)(endOffset)}),(0,tracking_src.L9)("video_trim",{original_length:resource.length,new_length:lengthInSeconds,start_offset:startOffset,end_offset:endOffset}),toggleTrimMode()}),[endOffset,startOffset,trimExistingVideo,toggleTrimMode,videoData]),value={state:{videoData,hasChanged,isTrimMode,hasTrimMode,currentTime,startOffset,endOffset,maxOffset,videoNode},actions:{performTrim,toggleTrimMode,setVideoNode,setStartOffset,setEndOffset,setIsDraggingHandles}};return(0,jsx_runtime.jsx)(videoTrimContext.Z.Provider,{value,children})}VideoTrimProvider.displayName="VideoTrimProvider";const provider=VideoTrimProvider,Area=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__Area",componentId:"sc-1encx56-0"})(["grid-area:",";position:relative;overflow:hidden;z-index:",";"],(({area})=>area),(({zIndex})=>zIndex)),CanvasArea=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"canv",zIndex:1}).withConfig({displayName:"layout__CanvasArea",componentId:"sc-1encx56-1"})([""]),SidebarArea=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"sidebar",zIndex:2}).withConfig({displayName:"layout__SidebarArea",componentId:"sc-1encx56-2"})([""]);function Workspace({header,footer}){const{editingElementState}=(0,app.$P)((state=>({editingElementState:state.state.editingElementState})));return(0,jsx_runtime.jsx)(provider,{children:(0,jsx_runtime.jsxs)(rich_text_src.KQ,{editingState:editingElementState,children:[(0,jsx_runtime.jsx)(SidebarArea,{children:(0,jsx_runtime.jsx)(errorBoundary,{children:(0,jsx_runtime.jsx)(sidebar,{})})}),(0,jsx_runtime.jsx)(CanvasArea,{children:(0,jsx_runtime.jsx)(errorBoundary,{children:(0,jsx_runtime.jsx)(canvas.ZP,{header,footer})})})]})})}Workspace.displayName="Workspace";const workspace=Workspace;var story_editor_src_constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),app_canvas=__webpack_require__("./packages/story-editor/src/app/canvas/index.ts"),layoutProvider=__webpack_require__("./packages/story-editor/src/app/layout/layoutProvider.tsx"),useRightClickMenu=__webpack_require__("./packages/story-editor/src/app/rightClickMenu/useRightClickMenu.js"),rightClickMenu_context=__webpack_require__("./packages/story-editor/src/app/rightClickMenu/context.js");const ACTION_TYPES_OPEN_MENU="OPEN_MENU",ACTION_TYPES_CLOSE_MENU="CLOSE_MENU",ACTION_TYPES_RESET="RESET",DEFAULT_RIGHT_CLICK_MENU_STATE={isMenuOpen:!1,menuPosition:{x:0,y:0}};const reducer=function rightClickMenuReducer(state,action){switch(action.type){case ACTION_TYPES_CLOSE_MENU:return{...state,isMenuOpen:!1,menuPosition:DEFAULT_RIGHT_CLICK_MENU_STATE.menuPosition};case ACTION_TYPES_OPEN_MENU:return{...state,isMenuOpen:!0,menuPosition:action.payload};case ACTION_TYPES_RESET:return{...DEFAULT_RIGHT_CLICK_MENU_STATE};default:return state}};var v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),updateProperties=__webpack_require__("./packages/story-editor/src/components/style/updateProperties.js"),useRichTextFormatting=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/useRichTextFormatting.js"),getUpdatedSizeAndPosition=__webpack_require__("./packages/story-editor/src/utils/getUpdatedSizeAndPosition.js");const styleManager_useApplyStyle=function useApplyStyle({pushUpdate}){(0,components_form.pz)(getUpdatedSizeAndPosition.Z,[]);const selectedTextElements=(0,app.rB)((({state:{selectedElements}})=>selectedElements?selectedElements?.filter((({type})=>"text"===type)):story_editor_src_constants.Qw)),extraPropsToAdd=(0,react_src.sO)(null),push=(0,react_src.I4)((updater=>{const extraProps=extraPropsToAdd.current||{};extraPropsToAdd.current=null,pushUpdate((oldProps=>({...updater(oldProps),...extraProps})),!0)}),[pushUpdate]),{handlers:{handleSetColor,handleSetLetterSpacing,handleClickUnderline,handleClickItalic,handleSelectFontWeight}}=(0,useRichTextFormatting.Z)(selectedTextElements,push),handleApplyStyle=(0,react_src.I4)((preset=>{const{color,fontWeight,isItalic,isUnderline,letterSpacing,...rest}=preset;extraPropsToAdd.current=rest,handleSetColor(color),handleSetLetterSpacing(letterSpacing),handleSelectFontWeight(fontWeight),handleClickUnderline(isUnderline),handleClickItalic(isItalic)}),[handleSetColor,handleSetLetterSpacing,handleClickUnderline,handleClickItalic,handleSelectFontWeight]);return handleApplyStyle};var presetUtils=__webpack_require__("./packages/story-editor/src/utils/presetUtils.js"),utils=__webpack_require__("./packages/design-system/src/components/keyboard/utils.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts");const UNDO_HELP_TEXT=(0,sprintf.Z)((0,i18n.__)("Press %s to undo the last change","web-stories"),(0,utils.U2)("mod+z"));const hooks_useCopyPasteActions=()=>{const undo=(0,app.k6)((({actions})=>actions.undo)),{addAnimations,copySelectedElement,copiedElementState,selectedElement,selectedElementType,selectedElementAnimations,updateSelectedElements,isSelectedElementBackground}=(0,app.rB)((({state,actions})=>({addAnimations:actions.addAnimations,copiedElementState:state.copiedElementState,copySelectedElement:actions.copySelectedElement,selectedElement:state.selectedElements?.[0],selectedElementType:state.selectedElements?.[0]?.type,isSelectedElementBackground:state.selectedElements?.[0]?.isBackground,selectedElementAnimations:state.selectedElementAnimations,updateSelectedElements:actions.updateSelectedElements}))),showSnackbar=(0,useSnackbar.D)((value=>value.showSnackbar)),undoRef=(0,react_src.sO)(undo);undoRef.current=undo;const handleCopyStyles=(0,react_src.I4)((()=>{copySelectedElement(),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Copied style.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.L9)("context_menu_action",{name:"undo_copy_styles",element:selectedElementType,isBackground:isSelectedElementBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.L9)("context_menu_action",{name:"copy_styles",element:selectedElementType,isBackground:isSelectedElementBackground})}),[copySelectedElement,showSnackbar,selectedElementType,isSelectedElementBackground]),pushUpdate=(0,react_src.I4)(((update,commitValues)=>{updateSelectedElements({properties:element=>{const updates=(0,updateProperties.Z)(element,update,commitValues),sizeUpdates=(0,getUpdatedSizeAndPosition.Z)({...element,...updates});return{...updates,...sizeUpdates}}})}),[updateSelectedElements]),handleApplyStyle=styleManager_useApplyStyle({pushUpdate}),handlePasteStyles=(0,react_src.I4)((()=>{const id=selectedElement?.id;if(!id||selectedElementType!==copiedElementState.type)return;const oldAnimationToDelete=selectedElementAnimations.length?{...selectedElementAnimations[0],delete:!0}:void 0,newAnimations=copiedElementState.animations.map((animation=>({...animation,id:(0,v4.Z)(),targets:[selectedElement.id]})));if(addAnimations({animations:newAnimations}),"text"===copiedElementState.type&&copiedElementState.styles.content){const updatedElementStyles=function getTextElementStyles(element,animation){const{textStyles}=(0,presetUtils.Sc)([element.styles],{textStyles:[],colors:[]},story_editor_src_constants.SE.STYLE),{colors}=(0,presetUtils.Sc)([element.styles],{textStyles:[],colors:[]},story_editor_src_constants.SE.COLOR),{content,...copiedElementStyles}=element.styles;return{...copiedElementStyles,...textStyles[0],...colors[0].color,animation,border:copiedElementStyles.border||null}}(copiedElementState,oldAnimationToDelete);handleApplyStyle(updatedElementStyles)}else updateSelectedElements({properties:currentProperties=>(0,updateProperties.Z)(currentProperties,{...copiedElementState.styles,animation:oldAnimationToDelete},!0)});showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Pasted style.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.L9)("context_menu_action",{name:"undo_paste_styles",element:selectedElementType,isBackground:isSelectedElementBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.L9)("context_menu_action",{name:"paste_styles",element:selectedElementType,isBackground:isSelectedElementBackground})}),[addAnimations,copiedElementState,handleApplyStyle,selectedElement,selectedElementAnimations,showSnackbar,updateSelectedElements,selectedElementType,isSelectedElementBackground]);return{copiedElementType:copiedElementState?.type,handleCopyStyles,handlePasteStyles}};var generateGroupName=__webpack_require__("./packages/story-editor/src/utils/generateGroupName.ts");const hooks_useElementActions=()=>{const{clearBackgroundElement,duplicateElementsById,selectedElements,setBackgroundElement,updateElementsById,deleteGroupById,addGroup,groups,elements,arrangeElement}=(0,app.rB)((({state,actions})=>({clearBackgroundElement:actions.clearBackgroundElement,duplicateElementsById:actions.duplicateElementsById,selectedElements:state.selectedElements,setBackgroundElement:actions.setBackgroundElement,updateElementsById:actions.updateElementsById,addGroup:actions.addGroup,deleteGroupById:actions.deleteGroupById,groups:state.currentPage.groups,elements:state.currentPage?.elements||[],arrangeElement:actions.arrangeElement}))),showSnackbar=(0,useSnackbar.D)((value=>value.showSnackbar)),setEditingElement=(0,app.$P)((({actions})=>actions.setEditingElement)),undo=(0,app.k6)((({actions})=>actions.undo)),undoRef=(0,react_src.sO)(undo);undoRef.current=undo;return{handleDuplicateSelectedElements:(0,react_src.I4)((()=>{selectedElements.length&&(duplicateElementsById({elementIds:selectedElements.map((({id})=>id))}),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Duplicated elements.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.L9)("context_menu_action",{name:"undo_duplicate_elements",elements:selectedElements.map((element=>element.type))})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.L9)("context_menu_action",{name:"duplicate_elements",elements:selectedElements.map((element=>element.type))}))}),[duplicateElementsById,selectedElements,showSnackbar]),handleGroupSelectedElements:(0,react_src.I4)((()=>{if(!selectedElements.length)return;const groupId=(0,v4.Z)(),name=(0,generateGroupName.Z)(groups);addGroup({groupId,name}),updateElementsById({elementIds:selectedElements.map((({id})=>id)),properties:currentProperties=>(0,updateProperties.Z)(currentProperties,{groupId},!0)});const elementFromGroupWithHighestPosition=Math.max(...selectedElements.map((el=>elements.findIndex((({id})=>id===el?.id)))));for(const[index,element]of selectedElements.reverse().entries()){if(elements.findIndex((({id})=>id===element?.id))!==elementFromGroupWithHighestPosition){const newPosition=elementFromGroupWithHighestPosition-index;arrangeElement({elementId:element.id,position:newPosition})}}}),[selectedElements,updateElementsById,addGroup,groups,arrangeElement,elements]),handleUngroupSelectedElements:(0,react_src.I4)((()=>{selectedElements.length&&(deleteGroupById({groupId:selectedElements[0]?.groupId}),updateElementsById({elementIds:selectedElements.map((({id})=>id)),properties:currentProperties=>(0,updateProperties.Z)(currentProperties,{groupId:null},!0)}))}),[selectedElements,updateElementsById,deleteGroupById]),handleOpenScaleAndCrop:(0,react_src.I4)((evt=>{const selectedElement=selectedElements?.[0];selectedElement&&(setEditingElement(selectedElement.id,evt),(0,tracking_src.L9)("context_menu_action",{name:"open_scale_and_crop",element:selectedElement.type,isBackground:selectedElement.isBackground}))}),[selectedElements,setEditingElement]),handleSetPageBackground:(0,react_src.I4)((()=>{const selectedElement=selectedElements?.[0];selectedElement&&!selectedElement.isBackground&&(setBackgroundElement({elementId:selectedElement.id}),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Set page background.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.L9)("context_menu_action",{name:"undo_set_page_background",element:selectedElement.type,isBackground:selectedElement.isBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.L9)("context_menu_action",{name:"set_as_page_background",element:selectedElement.type,isBackground:selectedElement.isBackground}))}),[selectedElements,setBackgroundElement,showSnackbar]),handleRemovePageBackground:(0,react_src.I4)((()=>{const selectedElement=selectedElements?.[0];selectedElement&&selectedElement.isBackground&&(updateElementsById({elementIds:[selectedElement.id],properties:currentProperties=>(0,updateProperties.Z)(currentProperties,{isBackground:!1,opacity:100,overlay:null},!0)}),clearBackgroundElement(),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Removed page background.","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.L9)("context_menu_action",{name:"undo_remove_page_background",elements:selectedElement.type,isBackground:selectedElement.isBackground})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.L9)("context_menu_action",{name:"remove_media_from_background",element:selectedElement.type,isBackground:selectedElement.isBackground}))}),[clearBackgroundElement,selectedElements,showSnackbar,updateElementsById])}};function isOffCanvas(selectedElement){const{x,y,width,height}=selectedElement;let offCanvas=!1,offCanvasTop=0,offCanvasRight=0,offCanvasBottom=0,offCanvasLeft=0;x<0&&(offCanvasLeft=Math.abs(x));const adjustedY=y+src_constants.Z5;if(adjustedY<0&&(offCanvasTop=Math.abs(adjustedY)),x>0)x+width>src_constants.JN&&(offCanvasRight=x+width-src_constants.JN);else{const r=width-Math.abs(x)-src_constants.JN;offCanvasRight=r>0?r:0}if(adjustedY>0){if(y+height>src_constants.r_){const b=Math.floor(y+height-(src_constants.r_+src_constants.Z5));offCanvasBottom=b>0?b:0}}else{const b=height-Math.abs(y)-src_constants.r_;offCanvasBottom=b>0?b:0}return(offCanvasTop>0||offCanvasRight>0||offCanvasBottom>0||offCanvasLeft>0)&&(offCanvas=!0),{offCanvas,offCanvasTop,offCanvasRight,offCanvasBottom,offCanvasLeft}}const hooks_useLayerActions=()=>{const{cropExistingVideo}=(0,app_media.EF)((({actions:{cropExistingVideo}})=>({cropExistingVideo}))),{arrangeElement,elements,selectedElement}=(0,app.rB)((({state,actions})=>({arrangeElement:actions.arrangeElement,elements:state.currentPage?.elements||[],selectedElement:state.selectedElements?.[0]}))),elementPosition=elements.findIndex((({id})=>id===selectedElement?.id)),canElementMoveBackwards=selectedElement&&!selectedElement.isBackground&&elementPosition>1,canElementMoveForwards=selectedElement&&!selectedElement.isBackground&&elementPosition<elements.length-1,handleSendBackward=(0,react_src.I4)((()=>{if(!canElementMoveBackwards)return;const backwardPositionSkipGroups=elements.findLastIndex(((el,position)=>position<elementPosition&&!el.groupId)),newPosition=1===elementPosition?elementPosition:backwardPositionSkipGroups;arrangeElement({elementId:selectedElement.id,position:newPosition}),(0,tracking_src.L9)("context_menu_action",{name:"send_backward",element:selectedElement.type,isBackground:selectedElement.isBackground})}),[arrangeElement,canElementMoveBackwards,elementPosition,selectedElement,elements]),handleSendToBack=(0,react_src.I4)((()=>{canElementMoveBackwards&&(arrangeElement({elementId:selectedElement.id,position:1}),(0,tracking_src.L9)("context_menu_action",{name:"send_to_back",element:selectedElement.type}))}),[arrangeElement,canElementMoveBackwards,selectedElement]),handleBringForward=(0,react_src.I4)((()=>{if(!canElementMoveForwards)return;const forwardPositionSkipGroups=elements.findIndex(((el,position)=>position>elementPosition&&!el.groupId||position===elements.length-1)),newPosition=elementPosition>=elements.length-1?elementPosition:forwardPositionSkipGroups;arrangeElement({elementId:selectedElement.id,position:newPosition}),(0,tracking_src.L9)("context_menu_action",{name:"bring_forward",element:selectedElement.type})}),[arrangeElement,canElementMoveForwards,elementPosition,elements,selectedElement]),handleBringToFront=(0,react_src.I4)((()=>{canElementMoveForwards&&(arrangeElement({elementId:selectedElement.id,position:elements.length-1}),(0,tracking_src.L9)("context_menu_action",{name:"bring_to_front",element:selectedElement.type}))}),[arrangeElement,canElementMoveForwards,elements,selectedElement]),handleCropOffScreenVideo=(0,react_src.I4)((()=>{cropExistingVideo(selectedElement,function getCropParams({x,y,width,height,rotationAngle,resource}){const{offCanvasLeft,offCanvasRight,offCanvasTop,offCanvasBottom}=isOffCanvas({x,y,width,height,rotationAngle}),multiplier=100/(width/resource.width*100),offCanvasX=Math.floor((offCanvasLeft+offCanvasRight)*multiplier),offCanvasY=Math.floor((offCanvasTop+offCanvasBottom)*multiplier);return{cropElement:{x,y},cropWidth:resource.width-offCanvasX,cropHeight:resource.height-offCanvasY,cropX:Math.floor(offCanvasLeft*multiplier),cropY:Math.floor(offCanvasTop*multiplier),newWidth:width-offCanvasLeft-offCanvasRight,newHeight:height-offCanvasTop-offCanvasBottom}}(selectedElement))}),[selectedElement,cropExistingVideo]);return{canElementMoveBackwards,canElementMoveForwards,handleBringForward,handleBringToFront,handleSendBackward,handleSendToBack,handleCropOffScreenVideo}};var elements_src=__webpack_require__("./packages/elements/src/index.ts");const hooks_usePageActions=()=>{const{addPageAt,currentPage,deleteCurrentPage,isSelectedElementBackground,pageLength,selectedElementType}=(0,app.rB)((({state,actions})=>({addPageAt:actions.addPageAt,currentPage:state.currentPage,deleteCurrentPage:actions.deleteCurrentPage,isSelectedElementBackground:state.selectedElements?.[0]?.background||!1,pageLength:state.pages?.length||1,selectedElementType:state.selectedElements?.[0]?.type||null})));return{handleAddPageAtPosition:(0,react_src.I4)((index=>{let position=Boolean(index)||0===index?index:pageLength-1;position=position>pageLength?pageLength-1:position,position=position<0?0:position,addPageAt({page:(0,elements_src.D4)(),position}),(0,tracking_src.L9)("context_menu_action",{name:"page_added",element:selectedElementType,isBackground:isSelectedElementBackground})}),[addPageAt,isSelectedElementBackground,pageLength,selectedElementType]),handleDuplicatePage:(0,react_src.I4)((()=>{addPageAt({page:(0,elements_src.Fl)(currentPage),position:null})}),[addPageAt,currentPage]),handleDeletePage:(0,react_src.I4)((()=>{deleteCurrentPage(),(0,tracking_src.L9)("context_menu_action",{name:"page_deleted",element:selectedElementType,isBackground:isSelectedElementBackground})}),[deleteCurrentPage,isSelectedElementBackground,selectedElementType])}};var useDeleteColor=__webpack_require__("./packages/story-editor/src/components/colorPicker/useDeleteColor.js");__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js");const useDeleteStyle=function useDeletePreset({onEmpty}){const{globalStoryStyles,updateStory}=(0,app.rB)((({state:{story:{globalStoryStyles}},actions:{updateStory}})=>({globalStoryStyles,updateStory}))),{textStyles}=globalStoryStyles||{},deleteGlobalPreset=(0,react_src.I4)((toDelete=>{const updatedStyles=textStyles.filter((style=>style!==toDelete));updateStory({properties:{globalStoryStyles:{...globalStoryStyles,textStyles:updatedStyles}}}),0===updatedStyles.length&&onEmpty()}),[textStyles,updateStory,globalStoryStyles,onEmpty]);return deleteGlobalPreset};var useAddPreset=__webpack_require__("./packages/story-editor/src/utils/useAddPreset.js");const hooks_usePresetActions=()=>{const{addGlobalPreset:addGlobalTextPreset}=(0,useAddPreset.Z)({presetType:story_editor_src_constants.SE.STYLE}),{addGlobalPreset:addGlobalColorPreset}=(0,useAddPreset.Z)({presetType:story_editor_src_constants.SE.COLOR}),deleteGlobalTextPreset=useDeleteStyle({onEmpty:noop.Z}),{deleteGlobalColor:deleteGlobalColorPreset}=(0,useDeleteColor.Z)({onEmpty:noop.Z}),selectedElement=(0,app.rB)((({state})=>state.selectedElements?.[0])),showSnackbar=(0,useSnackbar.D)((value=>value.showSnackbar)),undo=(0,app.k6)((({actions})=>actions.undo));(0,react_src.sO)(undo).current=undo;return{handleAddTextPreset:(0,react_src.I4)((evt=>{const preset=addGlobalTextPreset(evt);showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)('Saved style to "Saved Styles".',"web-stories"),onAction:()=>{deleteGlobalTextPreset(preset),(0,tracking_src.L9)("context_menu_action",{name:"remove_text_preset",element:selectedElement?.type})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.L9)("context_menu_action",{name:"add_text_preset",element:selectedElement?.type})}),[addGlobalTextPreset,deleteGlobalTextPreset,selectedElement?.type,showSnackbar]),handleAddColorPreset:(0,react_src.I4)((evt=>{const preset=addGlobalColorPreset(evt);showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)('Added color to "Saved Colors".',"web-stories"),onAction:()=>{deleteGlobalColorPreset(preset),(0,tracking_src.L9)("context_menu_action",{name:"remove_color_preset",element:selectedElement?.type})},actionHelpText:UNDO_HELP_TEXT}),(0,tracking_src.L9)("context_menu_action",{name:"add_color_preset",element:selectedElement?.type})}),[addGlobalColorPreset,deleteGlobalColorPreset,selectedElement?.type,showSnackbar])}};function RightClickMenuProvider({children}){const[{isMenuOpen,menuPosition},dispatch]=(0,react_src._Y)(reducer,DEFAULT_RIGHT_CLICK_MENU_STATE),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),handleOpenMenu=(0,react_src.I4)((evt=>{evt.preventDefault(),evt.stopPropagation();let x=evt?.clientX,y=evt?.clientY;if(!x&&!y){const dims=evt.target.getBoundingClientRect();x=dims.x,y=dims.y}dispatch({type:ACTION_TYPES_OPEN_MENU,payload:{x,y}}),(0,tracking_src.L9)("context_menu_action",{name:"context_menu_opened"})}),[]),handleCloseMenu=(0,react_src.I4)((()=>{isMenuOpen&&dispatch({type:ACTION_TYPES_CLOSE_MENU})}),[isMenuOpen]);(0,keyboard.xb)({key:["mod+alt+o"]},(evt=>{evt.preventDefault(),handleCopyStyles()}),[handleCopyStyles]),(0,keyboard.xb)({key:["mod+alt+p"]},(evt=>{evt.preventDefault(),handlePasteStyles()}),[handlePasteStyles]);const value=(0,react_src.Ye)((()=>({isMenuOpen,menuPosition,onCloseMenu:handleCloseMenu,onOpenMenu:handleOpenMenu})),[handleCloseMenu,handleOpenMenu,isMenuOpen,menuPosition]);return(0,jsx_runtime.jsx)(rightClickMenu_context.Z.Provider,{value,children})}RightClickMenuProvider.displayName="RightClickMenuProvider";const rightClickMenu_provider=RightClickMenuProvider;var subMenuTrigger=__webpack_require__("./packages/design-system/src/components/contextMenu/components/subMenuTrigger.tsx"),contextMenu=__webpack_require__("./packages/design-system/src/components/contextMenu/contextMenu.tsx"),item=__webpack_require__("./packages/design-system/src/components/contextMenu/components/item.tsx"),separator=__webpack_require__("./packages/design-system/src/components/contextMenu/components/separator.tsx"),components_button=__webpack_require__("./packages/design-system/src/components/contextMenu/components/button.tsx"),shortcut=__webpack_require__("./packages/design-system/src/components/contextMenu/components/shortcut.ts");const constants_RIGHT_CLICK_MENU_LABELS={ADD_NEW_PAGE_AFTER:(0,i18n.__)("Add New Page After","web-stories"),ADD_NEW_PAGE_BEFORE:(0,i18n.__)("Add New Page Before","web-stories"),ADD_TO_COLOR_PRESETS:(0,i18n.__)("Add Color to “Saved Colors”","web-stories"),ADD_TO_TEXT_PRESETS:(0,i18n.__)("Add Style to “Saved Styles”","web-stories"),BRING_FORWARD:(0,i18n.__)("Bring Forward","web-stories"),BRING_TO_FRONT:(0,i18n.__)("Bring to Front","web-stories"),BROWSE_STOCK_IMAGES_AND_VIDEO:(0,i18n.__)("Browse Stock Images and Video","web-stories"),BROWSE_PAGE_TEMPLATES:(0,i18n.__)("Browse Page Templates","web-stories"),CLEAR_IMAGE_STYLES:(0,i18n.__)("Clear Image Styles","web-stories"),CLEAR_SHAPE_STYLES:(0,i18n.__)("Clear Shape Styles","web-stories"),CLEAR_VIDEO_STYLES:(0,i18n.__)("Clear Video Styles","web-stories"),CHOOSE_IMAGE_OR_VIDEO:(0,i18n.__)("Choose Image or Video","web-stories"),COPY_IMAGE_STYLES:(0,i18n.__)("Copy Image Styles","web-stories"),COPY_SHAPE_STYLES:(0,i18n.__)("Copy Shape Styles","web-stories"),COPY_VIDEO_STYLES:(0,i18n.__)("Copy Video Styles","web-stories"),COPY_STYLES:(0,i18n.__)("Copy Style","web-stories"),DELETE_PAGE:(0,i18n.__)("Delete Page","web-stories"),DETACH_IMAGE_FROM_BACKGROUND:(0,i18n.__)("Detach Image From Background","web-stories"),DETACH_VIDEO_FROM_BACKGROUND:(0,i18n.__)("Detach Video From Background","web-stories"),DUPLICATE_PAGE:(0,i18n.__)("Duplicate Page","web-stories"),DUPLICATE_ELEMENTS:(numElements=1)=>(0,i18n._n)("Duplicate Element","Duplicate Elements",numElements,"web-stories"),GROUP_LAYERS:(0,i18n.__)("Group Layers","web-stories"),UNGROUP_LAYERS:(0,i18n.__)("Ungroup Layers","web-stories"),UNGROUP_LAYER:(0,i18n.__)("Remove from Group","web-stories"),LOCK_UNLOCK:(0,i18n.__)("Lock/Unlock","web-stories"),HIDE_SHOW:(0,i18n.__)("Hide/Show","web-stories"),RENAME_LAYER:(0,i18n.__)("Rename Layer","web-stories"),PASTE_IMAGE_STYLES:(0,i18n.__)("Paste Image Styles","web-stories"),PASTE_SHAPE_STYLES:(0,i18n.__)("Paste Shape Styles","web-stories"),PASTE_VIDEO_STYLES:(0,i18n.__)("Paste Video Styles","web-stories"),PASTE_STYLES:(0,i18n.__)("Paste Style","web-stories"),SCALE_AND_CROP_BACKGROUND_IMAGE:(0,i18n.__)("Scale & Crop Background Image","web-stories"),SCALE_AND_CROP_BACKGROUND_VIDEO:(0,i18n.__)("Scale & Crop Background Video","web-stories"),SCALE_AND_CROP_IMAGE:(0,i18n.__)("Scale & Crop Image","web-stories"),SCALE_AND_CROP_VIDEO:(0,i18n.__)("Scale & Crop Video","web-stories"),CROP_OFF_SCREEN_VIDEO:(0,i18n.__)("Crop Off-Screen Video","web-stories"),SEND_BACKWARD:(0,i18n.__)("Send Backward","web-stories"),SEND_TO_BACK:(0,i18n.__)("Send to Back","web-stories"),SET_AS_PAGE_BACKGROUND:(0,i18n.__)("Set as Page Background","web-stories"),TRIM_VIDEO:(0,i18n.__)("Trim Video","web-stories"),UPLOAD_IMAGE_OR_VIDEO:(0,i18n.__)("Upload Image or Video","web-stories"),USE_SHAPE_AS_MASK:(0,i18n.__)("Use Shape as a Mask","web-stories"),REMOVE_MASK:(0,i18n.__)("Unmask","web-stories"),RECORD_VIDEO:(0,i18n.__)("Record Video","web-stories"),HEADING_LEVEL:(0,i18n.__)("Heading Level","web-stories")},StyledKbd=(0,styled_components_browser_esm.ZP)(typography_text.x.Kbd).attrs({size:types.TextSize.Small}).withConfig({displayName:"constants__StyledKbd",componentId:"sc-m1qol5-0"})(["color:inherit;:not(:last-child){margin-right:4px;}"]),RIGHT_CLICK_MENU_SHORTCUTS={SEND_BACKWARD:{display:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"mod down",component:StyledKbd}),title:(0,utils.k$)("mod down")},SEND_TO_BACK:{display:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"mod shift down",component:StyledKbd}),title:(0,utils.k$)("mod shift down")},BRING_FORWARD:{display:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"mod up",component:StyledKbd}),title:(0,utils.k$)("mod up")},BRING_TO_FRONT:{display:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"mod shift up",component:StyledKbd}),title:(0,utils.k$)("mod shift up")},DELETE:{display:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"delete",component:StyledKbd}),title:(0,utils.k$)("delete")},COPY_STYLES:{display:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"alt mod O",component:StyledKbd}),title:(0,utils.k$)("alt mod O")},PASTE_STYLES:{display:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"alt mod P",component:StyledKbd}),title:(0,utils.k$)("alt mod P")}};var useShapeMask=__webpack_require__("./packages/story-editor/src/utils/useShapeMask.js"),useVideoTrim=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoTrim.js"),SAT=__webpack_require__("./node_modules/sat/SAT.js"),SAT_default=__webpack_require__.n(SAT),chevron_right_small=__webpack_require__("./packages/design-system/src/icons/chevron_right_small.svg"),checkmark_small=__webpack_require__("./packages/design-system/src/icons/checkmark_small.svg"),story_useStory=__webpack_require__("./packages/story-editor/src/app/story/useStory.ts"),useElementPolygon=__webpack_require__("./packages/story-editor/src/utils/useElementPolygon.js");const ReversedIcon=(0,styled_components_browser_esm.ZP)(chevron_right_small.Z).withConfig({displayName:"useLayerSelect__ReversedIcon",componentId:"sc-169lxcx-0"})(["transform:rotate(180deg);"]);const rightClickMenu_useLayerSelect=function useLayerSelect({menuItemProps,menuPosition,isMenuOpen}){const{isRTL}=(0,app_config.ZR)(),[isSubMenuOpen,setIsSubMenuOpen]=(0,react_src.eJ)(!1),nodesById=(0,app_canvas.$P)((({state:{nodesById}})=>nodesById)),{currentPage,selectedElements,setSelectedElementsById}=(0,story_useStory.Z)((({state:{currentPage,selectedElements},actions:{setSelectedElementsById}})=>({currentPage,selectedElements,setSelectedElementsById}))),getElementPolygon=(0,useElementPolygon.Z)();(0,react_src.d4)((()=>{isMenuOpen||setIsSubMenuOpen(!1)}),[isMenuOpen]);const{x,y}=menuPosition,getIntersectingElements=(0,react_src.I4)((()=>{if(!currentPage?.elements?.length||!Object.keys(nodesById)?.length)return[];const clickedPoint=new(SAT_default().Vector)(x,y),intersectingElements=currentPage.elements.map((element=>({element,polygon:getElementPolygon(element)}))).map((({element,polygon})=>SAT_default().pointInPolygon(clickedPoint,polygon)?element:null)).filter(Boolean);return intersectingElements.reverse(),intersectingElements}),[currentPage,x,y,nodesById,getElementPolygon]),subMenuItems=(0,react_src.Ye)((()=>{if(!isMenuOpen||0===selectedElements.length)return[];const intersectingElements=getIntersectingElements();return 1===intersectingElements.length&&intersectingElements[0].id===selectedElements[0].id?[]:intersectingElements.map((element=>{const{id,isBackground,type}=element;return{key:id,supportsIcon:!0,icon:selectedElements[0].id===id?(0,jsx_runtime.jsx)(checkmark_small.Z,{}):null,label:(0,jsx_runtime.jsx)("span",{children:(0,elements_src.Ph)(element)}),onClick:()=>{setSelectedElementsById({elementIds:[id]}),(0,tracking_src.L9)("context_menu_action",{name:"layer_selected",element:type,isBackground})},...menuItemProps}}))}),[getIntersectingElements,isMenuOpen,menuItemProps,setSelectedElementsById,selectedElements]);return subMenuItems.length>0?{label:(0,i18n.__)("Select Layer","web-stories"),openSubMenu:()=>setIsSubMenuOpen(!0),closeSubMenu:()=>setIsSubMenuOpen(!1),isSubMenuOpen,subMenuItems:isSubMenuOpen?subMenuItems:[],SuffixIcon:isRTL?ReversedIcon:chevron_right_small.Z,...menuItemProps}:null};function LayerHide(){const updateSelectedElements=(0,app.rB)((ctx=>ctx.actions.updateSelectedElements)),toggleLayerHide=(0,react_src.I4)((()=>updateSelectedElements({properties:oldElement=>({...oldElement,isHidden:!oldElement.isHidden})})),[updateSelectedElements]);return(0,jsx_runtime.jsx)(components_button.Z,{onClick:toggleLayerHide,children:constants_RIGHT_CLICK_MENU_LABELS.HIDE_SHOW})}LayerHide.displayName="LayerHide";const layerHide=LayerHide;function LayerLock(){const updateSelectedElements=(0,app.rB)((ctx=>ctx.actions.updateSelectedElements)),toggleLayerLock=(0,react_src.I4)((()=>updateSelectedElements({properties:oldElement=>({...oldElement,isLocked:!oldElement.isLocked})})),[updateSelectedElements]);return(0,jsx_runtime.jsx)(components_button.Z,{onClick:toggleLayerLock,children:constants_RIGHT_CLICK_MENU_LABELS.LOCK_UNLOCK})}LayerLock.displayName="LayerLock";const layerLock=LayerLock;const layerName=function LayerName(){const{selectedElementIds}=(0,app.rB)((({state})=>({selectedElementIds:state.selectedElementIds}))),{setRenamableLayer}=(0,app.$P)((({state,actions})=>({setRenamableLayer:actions.setRenamableLayer,renamableLayer:state.renamableLayer}))),enableLayerNaming=(0,react_src.I4)((()=>{setRenamableLayer({elementId:selectedElementIds[0]})}),[setRenamableLayer,selectedElementIds]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:enableLayerNaming,children:constants_RIGHT_CLICK_MENU_LABELS.RENAME_LAYER})]})};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.some.js");function LayerUngroup(){const{selectedElements,removeElementFromGroup}=(0,app.rB)((({state,actions})=>({selectedElements:state.selectedElements,removeElementFromGroup:actions.removeElementFromGroup}))),handleLayerUngroup=(0,react_src.I4)((()=>{removeElementFromGroup({elementId:selectedElements[0].id,groupId:selectedElements[0].groupId})}),[selectedElements,removeElementFromGroup]);return selectedElements.some((el=>el.groupId))?(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleLayerUngroup,children:constants_RIGHT_CLICK_MENU_LABELS.UNGROUP_LAYER}):null}LayerUngroup.displayName="LayerUngroup";const layerUngroup=LayerUngroup,SubMenuContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"shared__SubMenuContainer",componentId:"sc-anftx6-0"})(["position:absolute;top:","px;left:","px;z-index:9999;"],(({position})=>position?.y??0),(({position})=>position?.x??0));SubMenuContainer.propTypes={position:prop_types_default().shape({x:prop_types_default().number,y:prop_types_default().number})};const SUB_MENU_ARIA_LABEL=(0,i18n.__)("Select a layer","web-stories");prop_types_default().oneOfType([prop_types_default().func,prop_types_default().shape({current:prop_types_default().instanceOf(Element)})]).isRequired;const foregroundMediaMenu=function ForegroundMediaMenu({parentMenuRef}){const{copiedElementType,selectedElement}=(0,app.rB)((({state})=>({copiedElementType:state.copiedElementState.type,selectedElement:state.selectedElements?.[0]}))),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),{handleDuplicateSelectedElements,handleOpenScaleAndCrop,handleSetPageBackground}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront,handleCropOffScreenVideo}=hooks_useLayerActions(),{hasShapeMask,removeShapeMask}=(0,useShapeMask.Z)(selectedElement),{offCanvas}=(0,react_src.Ye)((()=>isOffCanvas(selectedElement)),[selectedElement]),offScreenVideoCropping=(0,flagged_esm.SS)("offScreenVideoCropping"),canTranscodeResource=(0,app.EF)((value=>value.state.canTranscodeResource)),{hasTrimMode,toggleTrimMode}=(0,useVideoTrim.Z)((({state,actions})=>({hasTrimMode:state.hasTrimMode,toggleTrimMode:actions.toggleTrimMode}))),subMenuRef=(0,react_src.sO)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.Z)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{},isVideo="video"===selectedElement?.type,scaleLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_VIDEO:constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_IMAGE,copyLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.COPY_VIDEO_STYLES:constants_RIGHT_CLICK_MENU_LABELS.COPY_IMAGE_STYLES,pasteLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.PASTE_VIDEO_STYLES:constants_RIGHT_CLICK_MENU_LABELS.PASTE_IMAGE_STYLES,showToggleTrimMode=isVideo&&hasTrimMode;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[layerSelectProps&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(subMenuTrigger.Z,{closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen,...subMenuTriggerProps}),(0,jsx_runtime.jsx)(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0},children:(0,jsx_runtime.jsx)(contextMenu.Z,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef,children:subMenuItems.map((({key,...menuItemProps})=>(0,jsx_runtime.jsx)(item.Z,{...menuItemProps},key)))})}),(0,jsx_runtime.jsx)(separator.Z,{})]}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleDuplicateSelectedElements,children:constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)}),hasShapeMask&&(0,jsx_runtime.jsx)(components_button.Z,{onClick:removeShapeMask,children:constants_RIGHT_CLICK_MENU_LABELS.REMOVE_MASK}),(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendBackward,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendToBack,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringForward,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringToFront,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display})]}),(0,jsx_runtime.jsx)(layerName,{}),(0,jsx_runtime.jsx)(layerLock,{}),(0,jsx_runtime.jsx)(layerHide,{}),(0,jsx_runtime.jsx)(layerUngroup,{}),(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleSetPageBackground,children:constants_RIGHT_CLICK_MENU_LABELS.SET_AS_PAGE_BACKGROUND}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleOpenScaleAndCrop,children:scaleLabel}),offScreenVideoCropping&&isVideo&&offCanvas&&(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleCropOffScreenVideo,children:constants_RIGHT_CLICK_MENU_LABELS.CROP_OFF_SCREEN_VIDEO}),showToggleTrimMode&&(0,jsx_runtime.jsx)(components_button.Z,{disabled:!canTranscodeResource(selectedElement?.resource),onClick:toggleTrimMode,children:constants_RIGHT_CLICK_MENU_LABELS.TRIM_VIDEO}),(0,jsx_runtime.jsxs)(components_button.Z,{onClick:handleCopyStyles,children:[copyLabel,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.COPY_STYLES.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:copiedElementType!==selectedElement?.type,onClick:handlePasteStyles,children:[pasteLabel,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.PASTE_STYLES.display})]})]})};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.every.js");const utils_useShapeMaskElements=()=>{const{selectedElements,combineElements}=(0,app.rB)((({state,actions})=>({selectedElements:state.selectedElements,combineElements:actions.combineElements}))),[shapeMaskElements,setShapeMaskElements]=(0,react_src.eJ)({}),[canMergeIntoMask,setCanMergeIntoMask]=(0,react_src.eJ)(!1);(0,react_src.d4)((()=>{if(selectedElements?.length>2)return void setCanMergeIntoMask(!1);let target,shape;if(selectedElements.forEach((element=>{const{isMedia}=(0,elements_src.Do)(element.type);"shape"===element.type&&(shape=element),isMedia&&(target=element)})),shape&&target)return setCanMergeIntoMask(!0),void setShapeMaskElements({shape,target});setCanMergeIntoMask(!1)}),[selectedElements]);return{canMergeIntoMask,mergeIntoMask:()=>{const{target,shape}=shapeMaskElements;target&&shape&&combineElements({firstElement:target,secondId:shape.id})}}};const multipleElementsMenu=function MultipleElementsMenu(){const{handleDuplicateSelectedElements,handleGroupSelectedElements,handleUngroupSelectedElements}=hooks_useElementActions(),{canMergeIntoMask,mergeIntoMask}=utils_useShapeMaskElements(),{selectedElements}=(0,app.rB)((({state})=>({selectedElements:state.selectedElements}))),isGroupSelected=selectedElements.some((el=>el.groupId)),isOnlyGroupSelected=selectedElements.every((el=>el.groupId&&el.groupId===selectedElements[0].groupId));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleDuplicateSelectedElements,children:constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(2)}),canMergeIntoMask&&(0,jsx_runtime.jsx)(components_button.Z,{onClick:mergeIntoMask,children:constants_RIGHT_CLICK_MENU_LABELS.USE_SHAPE_AS_MASK}),!isOnlyGroupSelected&&(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleGroupSelectedElements,children:constants_RIGHT_CLICK_MENU_LABELS.GROUP_LAYERS}),isGroupSelected&&(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleUngroupSelectedElements,children:constants_RIGHT_CLICK_MENU_LABELS.UNGROUP_LAYERS})]})};const pageMenu=function PageMenu({parentMenuRef}){const{currentPageIndex,canDeletePage,selectedElement}=(0,app.rB)((({state})=>({currentPageIndex:state.currentPageIndex,canDeletePage:state.pages.length>1,selectedElement:state.selectedElements?.[0]}))),{handleOpenScaleAndCrop,handleRemovePageBackground}=hooks_useElementActions(),{handleAddPageAtPosition,handleDeletePage,handleDuplicatePage}=hooks_usePageActions(),canTranscodeResource=(0,app.EF)((value=>value.state.canTranscodeResource)),{hasTrimMode,toggleTrimMode}=(0,useVideoTrim.Z)((({state,actions})=>({hasTrimMode:state.hasTrimMode,toggleTrimMode:actions.toggleTrimMode}))),subMenuRef=(0,react_src.sO)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.Z)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{},disableBackgroundMediaActions=selectedElement?.isDefaultBackground,isVideo="video"===selectedElement?.type,detachLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.DETACH_VIDEO_FROM_BACKGROUND:constants_RIGHT_CLICK_MENU_LABELS.DETACH_IMAGE_FROM_BACKGROUND,scaleLabel=isVideo?constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_BACKGROUND_VIDEO:constants_RIGHT_CLICK_MENU_LABELS.SCALE_AND_CROP_BACKGROUND_IMAGE,showTrimModeAction=isVideo&&hasTrimMode;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[layerSelectProps&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(subMenuTrigger.Z,{closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen,...subMenuTriggerProps}),(0,jsx_runtime.jsx)(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0},children:(0,jsx_runtime.jsx)(contextMenu.Z,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef,children:subMenuItems.map((({key,...menuItemProps})=>(0,jsx_runtime.jsx)(item.Z,{...menuItemProps},key)))})}),(0,jsx_runtime.jsx)(separator.Z,{})]}),(0,jsx_runtime.jsx)(components_button.Z,{disabled:disableBackgroundMediaActions,onClick:handleRemovePageBackground,children:detachLabel}),(0,jsx_runtime.jsx)(components_button.Z,{disabled:disableBackgroundMediaActions,onClick:handleOpenScaleAndCrop,children:scaleLabel}),(0,jsx_runtime.jsx)(separator.Z,{}),showTrimModeAction&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components_button.Z,{disabled:!canTranscodeResource(selectedElement?.resource),onClick:toggleTrimMode,children:detachLabel}),(0,jsx_runtime.jsx)(separator.Z,{})]}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>handleAddPageAtPosition(currentPageIndex+1),children:constants_RIGHT_CLICK_MENU_LABELS.ADD_NEW_PAGE_AFTER}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>handleAddPageAtPosition(currentPageIndex),children:constants_RIGHT_CLICK_MENU_LABELS.ADD_NEW_PAGE_BEFORE}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleDuplicatePage,children:constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_PAGE}),(0,jsx_runtime.jsx)(components_button.Z,{disabled:!canDeletePage,onClick:handleDeletePage,children:constants_RIGHT_CLICK_MENU_LABELS.DELETE_PAGE})]})};const shapeMenu=function ShapeMenu({parentMenuRef}){const{copiedElementType,selectedElementType}=(0,app.rB)((({state})=>({copiedElementType:state.copiedElementState.type,selectedElementType:state.selectedElements?.[0].type}))),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),{handleDuplicateSelectedElements}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),{handleAddColorPreset}=hooks_usePresetActions(),subMenuRef=(0,react_src.sO)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.Z)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[layerSelectProps&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(subMenuTrigger.Z,{closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen,...subMenuTriggerProps}),(0,jsx_runtime.jsx)(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0},children:(0,jsx_runtime.jsx)(contextMenu.Z,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef,children:subMenuItems.map((({key,...menuItemProps})=>(0,jsx_runtime.jsx)(item.Z,{...menuItemProps},key)))})}),(0,jsx_runtime.jsx)(separator.Z,{})]}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleDuplicateSelectedElements,children:constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)}),(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendBackward,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendToBack,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringForward,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringToFront,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display})]}),(0,jsx_runtime.jsx)(layerName,{}),(0,jsx_runtime.jsx)(layerLock,{}),(0,jsx_runtime.jsx)(layerHide,{}),(0,jsx_runtime.jsx)(layerUngroup,{}),(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsxs)(components_button.Z,{onClick:handleCopyStyles,children:[constants_RIGHT_CLICK_MENU_LABELS.COPY_SHAPE_STYLES,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.COPY_STYLES.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:copiedElementType!==selectedElementType,onClick:handlePasteStyles,children:[constants_RIGHT_CLICK_MENU_LABELS.PASTE_SHAPE_STYLES,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.PASTE_STYLES.display})]}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleAddColorPreset,children:constants_RIGHT_CLICK_MENU_LABELS.ADD_TO_COLOR_PRESETS})]})};const stickerMenu=function StickerMenu({parentMenuRef}){const{handleDuplicateSelectedElements}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),subMenuRef=(0,react_src.sO)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.Z)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[layerSelectProps&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(subMenuTrigger.Z,{closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen,...subMenuTriggerProps}),(0,jsx_runtime.jsx)(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0},children:(0,jsx_runtime.jsx)(contextMenu.Z,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef,children:subMenuItems.map((({key,...menuItemProps})=>(0,jsx_runtime.jsx)(item.Z,{...menuItemProps},key)))})}),(0,jsx_runtime.jsx)(separator.Z,{})]}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleDuplicateSelectedElements,children:constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)}),(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendBackward,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendToBack,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringForward,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringToFront,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display})]}),(0,jsx_runtime.jsx)(layerName,{}),(0,jsx_runtime.jsx)(layerLock,{}),(0,jsx_runtime.jsx)(layerHide,{}),(0,jsx_runtime.jsx)(layerUngroup,{})]})};__webpack_require__("./node_modules/core-js/modules/esnext.set.difference.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.intersection.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-disjoint-from.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-subset-of.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-superset-of.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.symmetric-difference.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.union.v2.js");var output_src=__webpack_require__("./packages/output/src/index.ts");const useHeadingSelect_ReversedIcon=(0,styled_components_browser_esm.ZP)(chevron_right_small.Z).withConfig({displayName:"useHeadingSelect__ReversedIcon",componentId:"sc-1xwrfrm-0"})(["transform:rotate(180deg);"]);const hooks_useHeadingSelect=function useHeadingSelect({menuItemProps,isMenuOpen}){const{isRTL}=(0,app_config.ZR)(),[isSubMenuOpen,setIsSubMenuOpen]=(0,react_src.eJ)(!1),{textElements}=(0,story_useStory.Z)((({state})=>({textElements:state.currentPage?.elements?.filter((({type})=>"text"===type))}))),tagNamesMap=(0,output_src.XM)(textElements),{selectedElements,updateSelectedElements}=(0,story_useStory.Z)((({state:{selectedElements},actions:{updateSelectedElements}})=>({selectedElements,updateSelectedElements}))),selectedElementsWithTagNames=selectedElements.map((element=>({...element,tagName:tagNamesMap.get(element.id),defaultTagName:element.tagName||"auto"}))),selectedTagName=(0,shared.d9)(selectedElementsWithTagNames,"defaultTagName","auto"),uniqueTagNames=[...new Set(selectedElementsWithTagNames.map((({tagName})=>tagName||"auto")))],computedTagName=uniqueTagNames?.length?uniqueTagNames[0]:"auto",selectedValue="auto"===selectedTagName?"auto":computedTagName;(0,react_src.d4)((()=>{isMenuOpen||setIsSubMenuOpen(!1)}),[isMenuOpen]);const subMenuItems=(0,react_src.Ye)((()=>{if(!isMenuOpen||0===selectedElements.length)return[];return[{value:"auto",label:"auto"===selectedValue&&story_editor_src_constants.od[computedTagName]?(0,sprintf.Z)((0,i18n.__)("Automatic (%s)","web-stories"),story_editor_src_constants.od[computedTagName]):(0,i18n.__)("Automatic","web-stories")},{value:"h1",label:story_editor_src_constants.od.h1},{value:"h2",label:story_editor_src_constants.od.h2},{value:"h3",label:story_editor_src_constants.od.h3},{value:"p",label:story_editor_src_constants.od.p}].map((element=>{const{value}=element;return{key:value,supportsIcon:!0,icon:selectedValue===value?(0,jsx_runtime.jsx)(checkmark_small.Z,{}):null,label:(0,jsx_runtime.jsx)("span",{children:element.label}),onClick:()=>{updateSelectedElements({properties:oldElement=>({...oldElement,tagName:value})})},...menuItemProps}}))}),[isMenuOpen,menuItemProps,updateSelectedElements,selectedValue,selectedElements,computedTagName]);return subMenuItems.length>0?{label:constants_RIGHT_CLICK_MENU_LABELS.HEADING_LEVEL,openSubMenu:()=>setIsSubMenuOpen(!0),closeSubMenu:()=>setIsSubMenuOpen(!1),isHeadingSubMenuOpen:isSubMenuOpen,headingSubMenuItems:isSubMenuOpen?subMenuItems:[],SuffixIcon:isRTL?useHeadingSelect_ReversedIcon:chevron_right_small.Z,...menuItemProps}:null};const textMenu=function TextMenu({parentMenuRef}){const{copiedElementType,selectedElementType}=(0,app.rB)((({state})=>({copiedElementType:state.copiedElementState.type,selectedElementType:state.selectedElements?.[0].type}))),{handleCopyStyles,handlePasteStyles}=hooks_useCopyPasteActions(),{handleDuplicateSelectedElements}=hooks_useElementActions(),{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),{handleAddColorPreset,handleAddTextPreset}=hooks_usePresetActions(),subMenuRef=(0,react_src.sO)(),headingSubMenuRef=(0,react_src.sO)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.Z)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{},headingSelectProps=hooks_useHeadingSelect({menuPosition,isMenuOpen:!0}),{closeHeadingSubMenu,isHeadingSubMenuOpen,headingSubMenuItems,...headingSubMenuTriggerProps}=headingSelectProps||{};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[layerSelectProps&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(subMenuTrigger.Z,{closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen,...subMenuTriggerProps}),(0,jsx_runtime.jsx)(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0},children:(0,jsx_runtime.jsx)(contextMenu.Z,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef,children:subMenuItems.map((({key,...menuItemProps})=>(0,jsx_runtime.jsx)(item.Z,{...menuItemProps},key)))})}),(0,jsx_runtime.jsx)(separator.Z,{})]}),headingSelectProps&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(subMenuTrigger.Z,{closeSubMenu:closeHeadingSubMenu,parentMenuRef,subMenuRef:headingSubMenuRef,isSubMenuOpen:isHeadingSubMenuOpen,...headingSubMenuTriggerProps}),(0,jsx_runtime.jsx)(SubMenuContainer,{ref:headingSubMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:40},children:(0,jsx_runtime.jsx)(contextMenu.Z,{onDismiss:onCloseMenu,isOpen:isHeadingSubMenuOpen,onCloseSubMenu:closeHeadingSubMenu,"aria-label":constants_RIGHT_CLICK_MENU_LABELS.HEADING_LEVEL,isSubMenu:!0,parentMenuRef,children:headingSubMenuItems.map((({key,...menuItemProps})=>(0,jsx_runtime.jsx)(item.Z,{...menuItemProps},key)))})}),(0,jsx_runtime.jsx)(separator.Z,{})]}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleDuplicateSelectedElements,children:constants_RIGHT_CLICK_MENU_LABELS.DUPLICATE_ELEMENTS(1)}),(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendBackward,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendToBack,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringForward,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringToFront,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display})]}),(0,jsx_runtime.jsx)(layerName,{}),(0,jsx_runtime.jsx)(layerLock,{}),(0,jsx_runtime.jsx)(layerHide,{}),(0,jsx_runtime.jsx)(layerUngroup,{}),(0,jsx_runtime.jsx)(separator.Z,{}),(0,jsx_runtime.jsxs)(components_button.Z,{onClick:handleCopyStyles,children:[constants_RIGHT_CLICK_MENU_LABELS.COPY_STYLES,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.COPY_STYLES.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:copiedElementType!==selectedElementType,onClick:handlePasteStyles,children:[constants_RIGHT_CLICK_MENU_LABELS.PASTE_STYLES,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.PASTE_STYLES.display})]}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleAddTextPreset,children:constants_RIGHT_CLICK_MENU_LABELS.ADD_TO_TEXT_PRESETS}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:handleAddColorPreset,children:constants_RIGHT_CLICK_MENU_LABELS.ADD_TO_COLOR_PRESETS})]})};const productMenu=function ProductMenu({parentMenuRef}){const{canElementMoveBackwards,canElementMoveForwards,handleSendBackward,handleSendToBack,handleBringForward,handleBringToFront}=hooks_useLayerActions(),subMenuRef=(0,react_src.sO)(),{menuPosition,onCloseMenu}=(0,useRightClickMenu.Z)(),layerSelectProps=rightClickMenu_useLayerSelect({menuPosition,isMenuOpen:!0}),{closeSubMenu,isSubMenuOpen,subMenuItems,...subMenuTriggerProps}=layerSelectProps||{};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[layerSelectProps&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(subMenuTrigger.Z,{closeSubMenu,parentMenuRef,subMenuRef,isSubMenuOpen,...subMenuTriggerProps}),(0,jsx_runtime.jsx)(SubMenuContainer,{ref:subMenuRef,position:{x:(parentMenuRef.current.firstChild?.offsetWidth||210)+2,y:0},children:(0,jsx_runtime.jsx)(contextMenu.Z,{onDismiss:onCloseMenu,isOpen:isSubMenuOpen,onCloseSubMenu:closeSubMenu,"aria-label":SUB_MENU_ARIA_LABEL,isSubMenu:!0,parentMenuRef,children:subMenuItems.map((({key,...menuItemProps})=>(0,jsx_runtime.jsx)(item.Z,{...menuItemProps},key)))})}),(0,jsx_runtime.jsx)(separator.Z,{})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendBackward,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_BACKWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_BACKWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveBackwards,onClick:handleSendToBack,children:[constants_RIGHT_CLICK_MENU_LABELS.SEND_TO_BACK,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.SEND_TO_BACK.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringForward,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_FORWARD,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_FORWARD.display})]}),(0,jsx_runtime.jsxs)(components_button.Z,{disabled:!canElementMoveForwards,onClick:handleBringToFront,children:[constants_RIGHT_CLICK_MENU_LABELS.BRING_TO_FRONT,(0,jsx_runtime.jsx)(shortcut.Z,{children:RIGHT_CLICK_MENU_SHORTCUTS.BRING_TO_FRONT.display})]}),(0,jsx_runtime.jsx)(layerName,{}),(0,jsx_runtime.jsx)(layerLock,{}),(0,jsx_runtime.jsx)(layerHide,{}),(0,jsx_runtime.jsx)(layerUngroup,{})]})};var directionAware=__webpack_require__("./packages/story-editor/src/components/directionAware/index.js"),isEmptyStory=__webpack_require__("./packages/story-editor/src/app/story/utils/isEmptyStory.ts"),resourceList=__webpack_require__("./packages/media/src/resourceList.ts");const library_context=(0,react_src.kr)({tabs:{}});const library_useLibrary=function useLibrary(selector){return(0,react_src.Sz)(library_context,selector??react_src.yR)};const local_useOnMediaSelect=function useOnMediaSelect(){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),insertMediaElement=(0,react_src.I4)(((resource,thumbnailURL)=>{resourceList.Z.set(resource.id,{url:thumbnailURL,type:"cached"}),insertElement(resource.type,{resource})}),[insertElement]),onSelect=(0,react_src.I4)((resource=>{insertMediaElement(resource,resource.sizes?.medium?.source_url||resource.src)}),[insertMediaElement]);return{insertMediaElement,onSelect}};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.reduce.js");let TextSetType=function(TextSetType){return TextSetType.Cover="cover",TextSetType.Step="step",TextSetType.SectionHeader="section_header",TextSetType.Editorial="editorial",TextSetType.Contact="contact",TextSetType.Table="table",TextSetType.List="list",TextSetType.Quote="quote",TextSetType}({});async function loadTextSet(name){const data=await __webpack_require__("./packages/text-sets/src/raw lazy recursive ^\\.\\/.*\\.json$")(`./${name}.json`);return(0,migration_src.T)(data,data.version).pages.reduce(((sets,page)=>{const minMax={minX:Number.POSITIVE_INFINITY,maxX:0,minY:Number.POSITIVE_INFINITY,maxY:0},textElements=page.elements.filter((({type})=>type===elements_src.Hd.Text));return textElements.forEach((element=>function updateMinMax(minMax,element){return minMax.minX=Math.min(minMax.minX,element.x),minMax.maxX=Math.max(minMax.maxX,element.x+element.width),minMax.minY=Math.min(minMax.minY,element.y),minMax.maxY=Math.max(minMax.maxY,element.y+element.height),minMax}(minMax,element))),[...sets,{textSetFonts:page.fonts,id:page.id,textSetCategory:name,elements:textElements.map((e=>({...e,normalizedOffsetX:e.x-minMax.minX,normalizedOffsetY:e.y-minMax.minY,textSetWidth:minMax.maxX-minMax.minX,textSetHeight:minMax.maxY-minMax.minY})))}]}),[])}var uniqueEntriesByKey=__webpack_require__("./packages/design-system/src/utils/uniqueEntriesByKey.ts"),popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),arrow_cloud=__webpack_require__("./packages/design-system/src/icons/arrow_cloud.svg"),input=__webpack_require__("./packages/design-system/src/components/search/input/input.tsx");const StyledSearchInput=(0,styled_components_browser_esm.ZP)(input.Z).withConfig({displayName:"searchInput__StyledSearchInput",componentId:"sc-145nauf-0"})(["input{",";}"],shared_styles.j);function WrappedSearchInput({initialValue,placeholder,onSearch,disabled=!1}){const[localValue,setLocalValue]=(0,react_src.eJ)(initialValue),onChange=(0,react_src.I4)((evt=>{const newValue=evt.target.value;setLocalValue(newValue),""===newValue&&onSearch(newValue)}),[onSearch]),onClear=(0,react_src.I4)((()=>{setLocalValue(""),onSearch("")}),[onSearch]),onSubmit=(0,react_src.I4)((evt=>{evt.preventDefault(),onSearch(localValue)}),[localValue,onSearch]),hasContent=localValue.length>0;return(0,jsx_runtime.jsx)("form",{onSubmit,children:(0,jsx_runtime.jsx)(StyledSearchInput,{inputValue:localValue,placeholder,onChange,handleClearInput:onClear,disabled,ariaClearLabel:(0,i18n.__)("Clear Search","web-stories"),isOpen:hasContent,"aria-label":(0,i18n.__)("Search","web-stories")})})}WrappedSearchInput.displayName="WrappedSearchInput";const searchInput=WrappedSearchInput;var headline=__webpack_require__("./packages/design-system/src/components/typography/headline/index.ts");const section_Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"section__Container",componentId:"sc-emh1dh-0"})(["position:relative;margin-top:28px;margin-bottom:28px;&:first-child{margin-top:0px;}"]),Title=(0,styled_components_browser_esm.ZP)(headline.s).attrs({as:"h2",size:types.TextSize.XXXSmall}).withConfig({displayName:"section__Title",componentId:"sc-emh1dh-1"})(["flex:1 1 auto;color:",";margin-bottom:28px;"],(({theme})=>theme.colors.fg.primary));function Section({title,children,...rest}){return(0,jsx_runtime.jsxs)(section_Container,{...rest,children:[(0,jsx_runtime.jsx)(Title,{children:title}),children]})}Section.displayName="Section";styled_components_browser_esm.ZP.h3.withConfig({displayName:"common__Title",componentId:"sc-q5ifvb-0"})(["color:",";margin:0;font-size:19px;line-height:1.4;flex:3 0 0;display:flex;align-items:center;padding:2px 0;"],(({theme})=>theme.colors.fg.primary)),styled_components_browser_esm.ZP.div.withConfig({displayName:"common__Header",componentId:"sc-q5ifvb-1"})(["display:flex;margin:0 0 25px;"]);var common_styles=__webpack_require__("./packages/story-editor/src/components/library/panes/media/common/styles.js"),providerConfiguration=__webpack_require__("./packages/story-editor/src/app/media/media3p/providerConfiguration.js");const StyledText=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).withConfig({displayName:"paginatedMediaGallery__StyledText",componentId:"sc-1xn8t7i-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),MediaGallery=(0,react_src.Vo)((()=>Promise.all([__webpack_require__.e(9066),__webpack_require__.e(6736)]).then(__webpack_require__.bind(__webpack_require__,"./packages/story-editor/src/components/library/panes/media/common/mediaGallery.js"))));function LazyMediaGallery({providerType,canEditMedia,resources,uploadingResources,onInsert}){return(0,jsx_runtime.jsx)(react_src.n4,{fallback:(0,jsx_runtime.jsx)(common_styles.Gw,{children:(0,jsx_runtime.jsx)(StyledText,{size:types.TextSize.Small,children:(0,i18n.__)("Loading…","web-stories")})}),children:(0,jsx_runtime.jsx)(MediaGallery,{providerType,canEditMedia,resources,uploadingResources,onInsert})})}LazyMediaGallery.displayName="LazyMediaGallery";const paginatedMediaGallery=function PaginatedMediaGallery({providerType,resources,uploadingResources=[],searchTerm,selectedCategoryId,isMediaLoading,isMediaLoaded,hasMore,onInsert,setNextPage,canEditMedia=!1}){const refContainer=(0,react_src.sO)(),isNextPageNeeded=(0,react_src.I4)((()=>refContainer.current.clientHeight===refContainer.current.scrollHeight?setNextPage():noop.Z),[setNextPage]),debouncedSetNextPage=(0,react_src.y1)(isNextPageNeeded,500),loadNextPageIfNeeded=(0,react_src.I4)((()=>{const node=refContainer.current;if(!resources.length||!node||0===node.clientHeight||!hasMore||!isMediaLoaded||isMediaLoading)return;if(node.clientHeight===node.scrollHeight)return void debouncedSetNextPage();node.scrollHeight-node.scrollTop<=node.clientHeight+300&&setNextPage()}),[resources.length,hasMore,isMediaLoaded,isMediaLoading,debouncedSetNextPage,setNextPage]);(0,react_src.d4)((()=>{refContainer.current?.scrollTo?.(0,0)}),[searchTerm,selectedCategoryId]);const handleScrollOrResize=(0,react_src.y1)(loadNextPageIfNeeded,500);(0,react_src.bt)((()=>{!async function loadNextPageIfNeededAfterGalleryRendering(){var ms;await(ms=200,new Promise((resolve=>setTimeout(resolve,ms)))),loadNextPageIfNeeded()}()}),[loadNextPageIfNeeded]),(0,react_src.d4)((()=>{const node=refContainer.current;if(node)return node.addEventListener("scroll",handleScrollOrResize),window.addEventListener("resize",handleScrollOrResize),()=>{node.removeEventListener("scroll",handleScrollOrResize),window.removeEventListener("resize",handleScrollOrResize)}}),[handleScrollOrResize]);const mediaGallery=!isMediaLoaded||resources.length||uploadingResources.length?(0,jsx_runtime.jsx)("div",{style:{marginBottom:15},children:(0,jsx_runtime.jsx)(LazyMediaGallery,{providerType,canEditMedia,resources,uploadingResources,onInsert})}):(0,jsx_runtime.jsx)(common_styles.DE,{children:(0,i18n.__)("No media found.","web-stories")}),[showLoadingPill,setShowLoadingPill]=(0,react_src.eJ)(!1);(0,react_src.d4)((()=>{if(isMediaLoading&&hasMore){const showLoadingTimeout=setTimeout((()=>{setShowLoadingPill(isMediaLoading)}),1e3);return()=>clearTimeout(showLoadingTimeout)}setShowLoadingPill(!1)}),[isMediaLoading,hasMore]);const attribution="local"!==providerType&&providerConfiguration.a[providerType].attributionComponent&&providerConfiguration.a[providerType].attributionComponent();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(common_styles.Mo,{"data-testid":"media-gallery-container",ref:refContainer,children:(0,jsx_runtime.jsx)(common_styles.kS,{children:mediaGallery})}),showLoadingPill&&(0,jsx_runtime.jsx)(common_styles.Gw,{"data-testid":"loading-pill",children:(0,jsx_runtime.jsx)(StyledText,{size:types.TextSize.Small,children:(0,i18n.__)("Loading…","web-stories")})}),!showLoadingPill&&attribution]})};var panes_shared=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/index.js"),local_types=__webpack_require__("./packages/story-editor/src/app/media/local/types.js");const paneId=(0,panes_shared.Qk)("media");var localStore=__webpack_require__("./packages/design-system/src/utils/localStore.ts");const storageKey=localStore.h.VIDEO_OPTIMIZATION_DIALOG_DISMISSED;function VideoOptimizationDialog(){const{isTranscoding}=(0,app_media.EF)((({state:{isTranscoding}})=>({isTranscoding}))),[isDialogDismissed,setIsDialogDismissed]=(0,react_src.eJ)(Boolean(localStore.W.getItemByKey(storageKey))),{updateCurrentUser}=(0,currentUser.xJ)((({actions})=>({updateCurrentUser:actions.updateCurrentUser}))),setIsDialogDismissedValue=(0,react_src.I4)((value=>{setIsDialogDismissed(value),localStore.W.setItemByKey(storageKey,value)}),[]),onDisable=(0,react_src.I4)((()=>{updateCurrentUser({mediaOptimization:!1}),setIsDialogDismissedValue(!0)}),[updateCurrentUser,setIsDialogDismissedValue]),onClose=(0,react_src.I4)((()=>{setIsDialogDismissedValue(!0)}),[setIsDialogDismissedValue]),dialogTitle=(0,i18n.__)("Video optimization in progress","web-stories"),dialogDescription=(0,i18n.__)("This process can’t be stopped once it begins. Optimization is automatically enabled for all videos to ensure smooth playback. You can disable optimization any time in Settings.","web-stories");return(0,jsx_runtime.jsx)(dialog.Z,{isOpen:isTranscoding&&!isDialogDismissed,onClose,title:dialogTitle,onSecondary:onDisable,secondaryText:(0,i18n.__)("Disable optimization","web-stories"),onPrimary:onClose,primaryText:(0,i18n.__)("Sounds good","web-stories"),children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.Small,children:dialogDescription})})}VideoOptimizationDialog.displayName="VideoOptimizationDialog";const videoOptimizationDialog=VideoOptimizationDialog;var icons_link=__webpack_require__("./packages/design-system/src/icons/link.svg"),hotlinkModal=__webpack_require__("./packages/story-editor/src/components/hotlinkModal/index.js"),src_mimeTypes=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.flat-map.js"),__webpack_require__("./packages/media/src/mimeTypes.ts")),preloadVideo=__webpack_require__("./packages/media/src/preloadVideo.ts"),seekVideo=__webpack_require__("./packages/media/src/seekVideo.ts"),getVideoLength=__webpack_require__("./packages/media/src/getVideoLength.ts"),hasVideoGotAudio=__webpack_require__("./packages/media/src/hasVideoGotAudio.ts"),getImageFromVideo=__webpack_require__("./packages/media/src/getImageFromVideo.ts"),blobToFile=__webpack_require__("./packages/media/src/blobToFile.ts"),useLocalMedia=__webpack_require__("./packages/story-editor/src/app/media/local/useLocalMedia.js"),getResourceFromUrl=__webpack_require__("./packages/story-editor/src/app/media/utils/getResourceFromUrl.ts"),media_utils=__webpack_require__("./packages/story-editor/src/app/media/utils/index.js"),useCORSProxy=__webpack_require__("./packages/story-editor/src/utils/useCORSProxy.ts");const hotlink_useInsert=function useInsert(){const[isOpen,setIsOpen]=(0,react_src.eJ)(!1),{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{capabilities:{hasUploadMediaAction},allowedMimeTypes:{image:allowedImageMimeTypes,vector:allowedVectorMimeTypes,video:allowedVideoMimeTypes}}=(0,app_config.ZR)(),{updateBaseColor}=(0,useLocalMedia.Z)((({actions:{updateBaseColor}})=>({updateBaseColor}))),allowedMimeTypes=(0,react_src.Ye)((()=>[...allowedImageMimeTypes,...allowedVectorMimeTypes,...allowedVideoMimeTypes]),[allowedImageMimeTypes,allowedVectorMimeTypes,allowedVideoMimeTypes]),allowedFileTypes=(0,react_src.Ye)((()=>allowedMimeTypes.flatMap((type=>(0,src_mimeTypes.E)(type)))),[allowedMimeTypes]),{uploadVideoPoster}=(0,media_utils.s6)({}),{getProxiedUrl}=(0,useCORSProxy.Z)(),onSelect=(0,react_src.I4)((async({link,hotlinkInfo,needsProxy})=>{const{ext,type,mimeType,fileName:originalFileName}=hotlinkInfo,isVideo="video"===type;try{const proxiedUrl=needsProxy?getProxiedUrl({needsProxy},link):link,resourceLike={id:(0,v4.Z)(),src:proxiedUrl,mimeType,needsProxy,alt:originalFileName};if(isVideo){const video=await(0,preloadVideo.Z)(proxiedUrl);await(0,seekVideo.Z)(video),resourceLike.width=video.videoWidth,resourceLike.height=video.videoHeight;const videoLength=(0,getVideoLength.Z)(video);if(resourceLike.length=videoLength.length,resourceLike.lengthFormatted=videoLength.lengthFormatted,resourceLike.isMuted=!(0,hasVideoGotAudio.Z)(video),hasUploadMediaAction)try{const fileName=(0,media_utils.pZ)(originalFileName.replace(`.${ext}`,"")),blob=await(0,getImageFromVideo.Z)(video),posterFile=(0,blobToFile.Z)(blob,fileName,story_editor_src_constants.Iu),posterData=await uploadVideoPoster(0,posterFile);resourceLike.poster=posterData.poster,resourceLike.posterId=posterData.posterId}catch{}}const resource=await(0,getResourceFromUrl.Z)(resourceLike);resource.src=link,insertElement(type,{resource}),updateBaseColor(resource),(0,tracking_src.L9)("hotlink_media",{event_label:link,file_size:hotlinkInfo.fileSize,file_type:hotlinkInfo.mimeType,needs_proxy:needsProxy}),setIsOpen(!1)}catch(e){}}),[getProxiedUrl,insertElement,updateBaseColor,hasUploadMediaAction,uploadVideoPoster]);return{action:{onSelect,onError:(0,react_src.I4)((err=>(0,tracking_src.tz)("hotlink_media",err?.message)),[]),onClick:()=>setIsOpen(!0),onClose:()=>setIsOpen(!1)},state:{allowedFileTypes,isOpen}}},hotlink_Button=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"hotlink__Button",componentId:"sc-1njsgyy-0"})(["",";margin:0 10px 0 0;"],shared_styles.j);const hotlink=function Hotlink(){const label=(0,i18n.__)("Insert by link","web-stories"),{action:{onSelect,onError,onClose,onClick},state:{allowedFileTypes,isOpen}}=hotlink_useInsert();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components_tooltip.Z,{title:label,children:(0,jsx_runtime.jsx)(hotlink_Button,{variant:constants.Wu.Square,type:constants.L$.Secondary,size:constants.qE.Small,onClick,"aria-label":label,children:(0,jsx_runtime.jsx)(icons_link.Z,{})})}),(0,jsx_runtime.jsx)(hotlinkModal.Z,{onClose,isOpen,onError,onSelect,allowedFileTypes,title:(0,i18n.__)("Insert external image or video","web-stories")})]})};var camera=__webpack_require__("./packages/design-system/src/icons/camera.svg"),useMediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/useMediaRecording.js");const mediaRecording_Button=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"mediaRecording__Button",componentId:"sc-zpc7g2-0"})(["",";margin:0 10px 0 0;"],shared_styles.j),Camera=(0,styled_components_browser_esm.ZP)(camera.Z).withConfig({displayName:"mediaRecording__Camera",componentId:"sc-zpc7g2-1"})(["width:24px !important;height:24px !important;"]);function MediaRecording(){const{isInRecordingMode,toggleRecordingMode}=(0,useMediaRecording.Z)((({state:{isInRecordingMode},actions:{toggleRecordingMode}})=>({isInRecordingMode,toggleRecordingMode}))),{isTranscodingEnabled}=(0,useFFmpeg.Z)(),onClick=(0,react_src.I4)((()=>{(0,tracking_src.L9)("media_recording_toggled",{status:isInRecordingMode?"closed":"open"}),toggleRecordingMode()}),[isInRecordingMode,toggleRecordingMode]);if(!isTranscodingEnabled)return null;const label=(0,i18n.__)("Record Video/Audio","web-stories");return(0,jsx_runtime.jsx)(components_tooltip.Z,{title:label,children:(0,jsx_runtime.jsx)(mediaRecording_Button,{variant:constants.Wu.Square,type:constants.L$.Secondary,size:constants.qE.Small,onClick,"aria-label":label,"aria-pressed":isInRecordingMode,isToggled:isInRecordingMode,children:(0,jsx_runtime.jsx)(Camera,{})})})}MediaRecording.displayName="MediaRecording";const mediaRecording=MediaRecording,mediaPane_Button=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"mediaPane__Button",componentId:"sc-usipec-0"})(["",";"],shared_styles.j),FilterArea=styled_components_browser_esm.ZP.div.withConfig({displayName:"mediaPane__FilterArea",componentId:"sc-usipec-1"})(["display:flex;justify-content:space-between;margin-top:24px;padding:0 "," 0 ",";"],panes_shared.gf,panes_shared.gf),SearchCount=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Medium}).withConfig({displayName:"mediaPane__SearchCount",componentId:"sc-usipec-2"})(["display:flex;align-items:center;justify-content:center;flex-shrink:0;"]),ButtonsWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"mediaPane__ButtonsWrapper",componentId:"sc-usipec-3"})(["display:flex;flex:1;justify-content:flex-end;"]),FILTER_NONE=local_types.JC,FILTERS=[{value:FILTER_NONE,label:(0,i18n.__)("All Types","web-stories")},{value:"image",label:(0,i18n.__)("Images","web-stories")},{value:"video",label:(0,i18n.__)("Video","web-stories")}];function MediaPane(props){const{hasMore,media,uploadingMedia,isMediaLoading,isMediaLoaded,mediaType,searchTerm,setNextPage,setMediaType,setSearchTerm,totalItems}=(0,app_media.EF)((({state:{hasMore,media,uploadingMedia,isMediaLoading,isMediaLoaded,mediaType,searchTerm,totalItems},actions:{setNextPage,setMediaType,setSearchTerm}})=>({hasMore,media,uploadingMedia:!media.length&&isMediaLoading?[]:uploadingMedia,isMediaLoading,isMediaLoaded,mediaType,searchTerm,totalItems,setNextPage,setMediaType,setSearchTerm}))),{capabilities:{hasUploadMediaAction}}=(0,app_config.ZR)(),isSearching=searchTerm.length>0,onFilter=(0,react_src.I4)(((evt,filter)=>{setMediaType({mediaType:filter})}),[setMediaType]),{onSelect,insertMediaElement}=local_useOnMediaSelect();(0,react_src.d4)((()=>{searchTerm.length>0&&(0,tracking_src.L9)("search",{search_type:"media",search_term:searchTerm,search_filter:mediaType})}),[searchTerm,mediaType]);const renderUploadButtonIcon=(0,react_src.I4)((open=>(0,jsx_runtime.jsx)(mediaPane_Button,{variant:constants.Wu.Square,type:constants.L$.Secondary,size:constants.qE.Small,onClick:open,"aria-label":(0,i18n.__)("Upload","web-stories"),children:(0,jsx_runtime.jsx)(arrow_cloud.Z,{})})),[]);return(0,jsx_runtime.jsx)(common_styles.K9,{id:paneId,...props,children:(0,jsx_runtime.jsxs)(common_styles.iL,{children:[(0,jsx_runtime.jsxs)(common_styles.hX,{children:[(0,jsx_runtime.jsx)(common_styles.Wf,{children:(0,jsx_runtime.jsx)(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch:value=>{const trimText=value.trim();trimText!==searchTerm&&setSearchTerm({searchTerm:trimText})}})}),(0,jsx_runtime.jsxs)(FilterArea,{children:[(0,jsx_runtime.jsx)(components_form.Ph,{selectedValue:mediaType?.toString()||FILTER_NONE,onMenuItemClick:onFilter,options:FILTERS,placement:popup_constants.ug.BottomStart}),isSearching&&media.length>0&&(0,jsx_runtime.jsx)(SearchCount,{children:(0,sprintf.Z)((0,i18n._n)("%s result found.","%s results found.",totalItems,"web-stories"),totalItems)}),!isSearching&&(0,jsx_runtime.jsxs)(ButtonsWrapper,{children:[(0,jsx_runtime.jsx)(mediaRecording,{}),(0,jsx_runtime.jsx)(hotlink,{}),hasUploadMediaAction&&(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Upload","web-stories"),children:(0,jsx_runtime.jsx)(components_form.Y8,{renderButton:renderUploadButtonIcon,onInsert:onSelect})})]})]})]}),!isMediaLoaded||media.length||uploadingMedia.length?(0,jsx_runtime.jsx)(paginatedMediaGallery,{providerType:"local",canEditMedia:hasUploadMediaAction,resources:media,uploadingResources:uploadingMedia,isMediaLoading,isMediaLoaded,hasMore,onInsert:insertMediaElement,setNextPage,searchTerm}):(0,jsx_runtime.jsx)(common_styles.DE,{children:isSearching?(0,i18n.__)("No results found.","web-stories"):(0,i18n.__)("No media found.","web-stories")}),(0,jsx_runtime.jsx)(videoOptimizationDialog,{})]})})}MediaPane.displayName="MediaPane";const mediaPane=MediaPane;function MediaIcon(){return(0,jsx_runtime.jsx)(arrow_cloud.Z,{title:(0,i18n.__)("Media Gallery","web-stories")})}MediaIcon.displayName="MediaIcon";const mediaIcon=MediaIcon;var useMedia=__webpack_require__("./packages/story-editor/src/app/media/useMedia.js"),translateWithMarkup=__webpack_require__("./packages/i18n/src/translateWithMarkup.tsx"),typography_link=__webpack_require__("./packages/design-system/src/components/typography/link/index.tsx");function TermsDialog(){const hasAcknowledgedTerms3p=localStore.W.getItemByKey(localStore.h.TERMS_MEDIA3P),[dialogOpen,setDialogOpen]=(0,react_src.eJ)(!hasAcknowledgedTerms3p),acknowledgeTerms=(0,react_src.I4)((()=>{setDialogOpen(!1),localStore.W.setItemByKey(localStore.h.TERMS_MEDIA3P,!0),(0,tracking_src.L9)("media3p_terms_acknowledged")}),[]);(0,react_src.d4)((()=>{setDialogOpen(!hasAcknowledgedTerms3p)}),[hasAcknowledgedTerms3p]);const onTermsClick=(0,react_src.I4)((evt=>{(0,tracking_src.ob)(evt,"click_terms_of_service")}),[]);return hasAcknowledgedTerms3p?null:(0,jsx_runtime.jsx)(dialog.Z,{isOpen:dialogOpen,contentLabel:(0,i18n.__)("Third party stock content terms","web-stories"),onClose:acknowledgeTerms,ariaHideApp:!1,onPrimary:acknowledgeTerms,primaryText:(0,i18n.__)("Dismiss","web-stories"),children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.Small,children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{a:(0,jsx_runtime.jsx)(typography_link.r,{size:types.TextSize.Small,href:"https://wp.stories.google/docs/terms/",rel:"noreferrer",target:"_blank","aria-label":(0,i18n.__)("Learn more by visiting Web Stories for WordPress","web-stories"),onClick:onTermsClick})},children:(0,i18n.__)("Your use of stock content is subject to third party terms. <a>Learn more.</a>","web-stories")})})})}TermsDialog.displayName="TermsDialog";const termsDialog=TermsDialog,media3p_paneId=(0,panes_shared.Qk)("media3p"),providerTab_StyledText=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).withConfig({displayName:"providerTab__StyledText",componentId:"sc-1muzdn0-0"})(["color:inherit;"]),Tab=styled_components_browser_esm.ZP.button.withConfig({displayName:"providerTab__Tab",componentId:"sc-1muzdn0-1"})(["padding:6px 16px;background:none;border:none;color:",";position:relative;cursor:pointer;:hover{color:",";}border-radius:",";",";",""],(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.colors.fg.primary),(({theme})=>theme.borders.radius.x_large),shared_styles.j,(({$isActive,theme})=>$isActive&&(0,styled_components_browser_esm.iv)(["::after{content:'';position:absolute;background-color:",";height:2px;border-radius:1px;bottom:-17px;left:16px;right:16px;}"],theme.colors.border.selection)));function ProviderTab({name,isActive,...rest}){return(0,jsx_runtime.jsx)(Tab,{$isActive:isActive,...rest,children:(0,jsx_runtime.jsx)(providerTab_StyledText,{size:types.TextSize.Small,children:name})})}ProviderTab.displayName="ProviderTab";const providerTab=ProviderTab,providerTabList_Section=styled_components_browser_esm.ZP.div.attrs({role:"tablist"}).withConfig({displayName:"providerTabList__Section",componentId:"sc-19jgogw-0"})(["display:flex;flex-wrap:wrap;margin-top:16px;margin-bottom:16px;padding:0 1em;"]);function ProviderTabList({providers}){const{isRTL}=(0,app_config.ZR)(),ref=(0,react_src.sO)(),{selectedProvider,setSelectedProvider}=(0,useMedia.Z)((({media3p:{state:{selectedProvider},actions:{setSelectedProvider}}})=>({selectedProvider,setSelectedProvider}))),[focusedIndex,setFocusedIndex]=(0,react_src.eJ)(0),providerCount=providers.length;(0,react_src.d4)((()=>setFocusedIndex(providers.indexOf(selectedProvider))),[providers,selectedProvider]);const focusByIndex=(0,react_src.I4)((newIndex=>{if(!ref.current)return;ref.current.children[newIndex].focus()}),[]),selectFocused=(0,react_src.I4)((()=>setSelectedProvider({provider:providers[focusedIndex]})),[focusedIndex,setSelectedProvider,providers]),dir=isRTL?-1:1;return(0,keyboard.Ew)(ref,"left",(()=>focusByIndex((focusedIndex-dir+providerCount)%providerCount)),[focusByIndex,focusedIndex,dir,providerCount]),(0,keyboard.Ew)(ref,"right",(()=>focusByIndex((focusedIndex+dir+providerCount)%providerCount)),[focusByIndex,focusedIndex,dir,providerCount]),(0,keyboard.Ew)(ref,"home",(()=>focusByIndex(0)),[focusByIndex]),(0,keyboard.Ew)(ref,"end",(()=>focusByIndex(providerCount-1)),[focusByIndex,providerCount]),(0,keyboard.Ew)(ref,["enter","space"],selectFocused,[selectFocused]),(0,jsx_runtime.jsx)(providerTabList_Section,{ref,children:providers.map(((providerType,index)=>(0,jsx_runtime.jsx)(providerTab,{index,name:providerConfiguration.a[providerType].displayName,isActive:selectedProvider===providerType,onClick:()=>setSelectedProvider({provider:providerType}),onFocus:()=>setFocusedIndex(index),tabIndex:selectedProvider===providerType?0:-1,role:"tab",id:`provider-tab-${providerType}`,"aria-controls":`provider-tabpanel-${providerType}`},providerType)))})}ProviderTabList.displayName="ProviderTabList";const providerTabList=ProviderTabList;__webpack_require__("./node_modules/core-js/modules/esnext.iterator.find.js");var useMedia3pApi=__webpack_require__("./packages/story-editor/src/app/media/media3p/api/useMedia3pApi.js");const MediaSubheading=(0,styled_components_browser_esm.ZP)(headline.s).attrs((()=>({as:"h2",size:types.TextSize.XXSmall}))).withConfig({displayName:"providerPanel__MediaSubheading",componentId:"sc-1c53rqi-0"})(["margin-top:24px;padding:0 24px;",""],(props=>props.shouldDisplay||"display: none;")),ProviderWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"providerPanel__ProviderWrapper",componentId:"sc-1c53rqi-1"})(["position:relative;display:flex;flex-direction:column;height:100%;min-height:100px;max-width:100%;top:0;left:0;",""],(({hidden})=>hidden&&(0,styled_components_browser_esm.iv)(["position:absolute;visibility:hidden;"])));function ProviderPanel({providerType,isActive,searchTerm,...rest}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{actions:{registerUsage}}=(0,useMedia3pApi.Z)(),{updateBaseColor}=(0,useLocalMedia.Z)((({actions:{updateBaseColor}})=>({updateBaseColor}))),handleRegisterUsage=(0,react_src.I4)((resource=>{resource?.attribution?.registerUsageUrl&&registerUsage({registerUsageUrl:resource.attribution.registerUsageUrl})}),[registerUsage]),insertMediaElement=(0,react_src.I4)(((resource,thumbnailURL)=>{resourceList.Z.set(resource.id,{url:thumbnailURL,type:"cached"}),insertElement(resource.type,{resource}),handleRegisterUsage(resource),resource.baseColor||updateBaseColor(resource)}),[insertElement,handleRegisterUsage,updateBaseColor]),{media3p}=(0,useMedia.Z)((({media3p})=>({media3p})));if(!isActive)return(0,jsx_runtime.jsx)(ProviderWrapper,{...rest,hidden:!0});const state=media3p[providerType].state,actions=media3p[providerType].actions,displayName=state.categories.selectedCategoryId?state.categories.categories.find((e=>e.id===state.categories.selectedCategoryId)).label:(0,i18n.__)("Trending","web-stories"),shouldDisplayMediaSubheading=Boolean(state.media?.length||state.categories.selectedCategoryId),searchResultsLabel=(0,i18n.__)("Search Results","web-stories");return(0,jsx_runtime.jsxs)(ProviderWrapper,{...rest,children:[providerConfiguration.a[providerType].supportsCategories&&(0,jsx_runtime.jsx)(panes_shared.Zn,{items:state.categories.categories,selectedItemId:state.categories.selectedCategoryId,selectItem:actions.selectCategory,deselectItem:actions.deselectCategory}),(0,jsx_runtime.jsx)(MediaSubheading,{"data-testid":"media-subheading",shouldDisplay:shouldDisplayMediaSubheading,children:searchTerm.length&&!state.categories.selectedCategoryId?searchResultsLabel:displayName}),(0,jsx_runtime.jsx)(paginatedMediaGallery,{providerType,resources:state.media,isMediaLoading:state.isMediaLoading,isMediaLoaded:state.isMediaLoaded,hasMore:state.hasMore,setNextPage:actions.setNextPage,onInsert:insertMediaElement,searchTerm,selectedCategoryId:state.categories.selectedCategoryId})]})}ProviderPanel.displayName="ProviderPanel";const providerPanel=ProviderPanel,PaneBottom=styled_components_browser_esm.ZP.div.withConfig({displayName:"media3pPane__PaneBottom",componentId:"sc-1hq1xk8-0"})(["position:relative;height:100%;flex:1 1 auto;min-height:0;"]);const media3pPane=function Media3pPane(props){const{isActive}=props,{searchTerm,selectedProvider,setSelectedProvider,setSearchTerm,media3p}=(0,useMedia.Z)((({media3p:{state:{selectedProvider,searchTerm},actions:{setSelectedProvider,setSearchTerm}},media3p})=>({searchTerm,selectedProvider,setSelectedProvider,setSearchTerm,media3p})));(0,react_src.d4)((()=>{isActive&&!selectedProvider&&setSelectedProvider({provider:Object.keys(providerConfiguration.a)[0]})}),[isActive,selectedProvider,setSelectedProvider]);const selectedCategoryId=media3p[selectedProvider]?.state?.categories?.selectedCategoryId;(0,react_src.d4)((()=>{searchTerm.length&&(0,tracking_src.L9)("search",{search_type:"media3p",search_term:searchTerm,search_filter:selectedProvider,search_category:selectedCategoryId})}),[selectedProvider,searchTerm,selectedCategoryId]);const onSearch=(0,react_src.I4)((value=>{const trimText=value.trim();trimText!==searchTerm&&setSearchTerm({searchTerm:trimText})}),[searchTerm,setSearchTerm]),paneBottomRef=(0,react_src.sO)(),features=(0,flagged_esm.hz)(),providers=(0,react_src.Ye)((()=>Object.keys(providerConfiguration.a).filter((p=>!providerConfiguration.a[p].featureName||features[providerConfiguration.a[p].featureName]))),[features]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isActive&&(0,jsx_runtime.jsx)(termsDialog,{}),(0,jsx_runtime.jsx)(common_styles.K9,{id:media3p_paneId,...props,children:(0,jsx_runtime.jsxs)(common_styles.iL,{children:[(0,jsx_runtime.jsxs)(common_styles.hX,{children:[(0,jsx_runtime.jsx)(common_styles.Wf,{children:(0,jsx_runtime.jsx)(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch,disabled:Boolean(selectedProvider&&providerConfiguration.a[selectedProvider].supportsCategories&&media3p[selectedProvider]?.state.categories.selectedCategoryId)})}),(0,jsx_runtime.jsx)(providerTabList,{providers})]}),(0,jsx_runtime.jsx)(PaneBottom,{ref:paneBottomRef,children:providers.map((providerType=>(0,jsx_runtime.jsx)(providerPanel,{providerType,isActive:providerType===selectedProvider,searchTerm,role:"tabpanel","aria-labelledby":`provider-tab-${providerType}`,id:`provider-tabpanel-${providerType}`},providerType)))})]})})]})};var picture=__webpack_require__("./packages/design-system/src/icons/picture.svg");function Media3pIcon(){return(0,jsx_runtime.jsx)(picture.Z,{title:(0,i18n.__)("Explore Media","web-stories")})}Media3pIcon.displayName="Media3pIcon";const media3pIcon=Media3pIcon;var stickers_src=__webpack_require__("./packages/stickers/src/index.ts"),masks_src=__webpack_require__("./packages/masks/src/index.ts"),useRovingTabIndex=__webpack_require__("./packages/story-editor/src/utils/useRovingTabIndex/index.js"),createSolidFromString=__webpack_require__("./packages/patterns/src/createSolidFromString.ts"),useUnits=__webpack_require__("./packages/units/src/useUnits.ts"),libraryMoveable=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/libraryMoveable.js"),insertionOverlay=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/insertionOverlay.js");const DEFAULT_ELEMENT_WIDTH=src_constants.JN/3,Aspect=styled_components_browser_esm.ZP.button.withConfig({displayName:"shapePreview__Aspect",componentId:"sc-1pj9cm0-0"})(["background:transparent;outline:none;border:0;padding:0;position:relative;border-radius:",";background-color:",";&:focus-visible [role='presentation']{",";}"],(({theme})=>theme.borders.radius.small),(({theme})=>theme.colors.interactiveBg.previewOverlay),(({theme})=>outline.R(theme.colors.border.focus,theme.colors.bg.secondary))),AspectInner=styled_components_browser_esm.ZP.div.withConfig({displayName:"shapePreview__AspectInner",componentId:"sc-1pj9cm0-1"})(["position:relative;padding-bottom:95.5%;"]),ShapePreviewContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"shapePreview__ShapePreviewContainer",componentId:"sc-1pj9cm0-2"})(["position:absolute;top:0;left:0;height:100%;width:100%;border-radius:",";display:flex;justify-content:center;align-items:center;svg{display:inline-block;width:36px;height:36px;}"],(({theme})=>theme.borders.radius.small)),ShapeClone=styled_components_browser_esm.ZP.div.withConfig({displayName:"shapePreview__ShapeClone",componentId:"sc-1pj9cm0-3"})(["position:absolute;top:0;left:0;opacity:0;width:",";height:",";svg{display:inline-block;width:100%;height:100%;path{fill:#c4c4c4;}}"],(({width})=>`${width}px`),(({height})=>`${height}px`)),ShapePreviewSizer=styled_components_browser_esm.ZP.div.withConfig({displayName:"shapePreview__ShapePreviewSizer",componentId:"sc-1pj9cm0-4"})(["padding-top:100%;"]),Path=styled_components_browser_esm.ZP.path.withConfig({displayName:"shapePreview__Path",componentId:"sc-1pj9cm0-5"})(["fill:",";"],(({theme})=>theme.colors.fg.primary));function ShapePreview({mask,isPreview,index}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{dataToEditorX,dataToEditorY}=(0,useUnits.Z)((state=>({dataToEditorX:state.actions.dataToEditorX,dataToEditorY:state.actions.dataToEditorY}))),[active,setActive]=(0,react_src.eJ)(!1),makeActive=()=>setActive(!0),makeInactive=()=>setActive(!1),ref=(0,react_src.sO)(),pathRef=(0,react_src.Vf)(),shapeData=(0,react_src.Ye)((()=>({backgroundColor:(0,createSolidFromString.Z)("#c4c4c4"),width:DEFAULT_ELEMENT_WIDTH*mask.ratio,height:DEFAULT_ELEMENT_WIDTH,mask:{type:mask.type},lockAspectRatio:masks_src.sn.RECTANGLE!==mask.type})),[mask.ratio,mask.type]),onClick=(0,react_src.I4)((()=>{insertElement("shape",shapeData),(0,tracking_src.L9)("insert_shape",{name:mask.type})}),[insertElement,shapeData,mask.type]),getSVG=(displayLabel=!0)=>(0,jsx_runtime.jsxs)("svg",{viewBox:"0 0 1 "+1/(isPreview&&mask.iconRatio?mask.iconRatio:mask.ratio),width:36*(isPreview&&mask.iconRatio?mask.iconRatio:mask.ratio),height:36,children:[displayLabel&&(0,jsx_runtime.jsx)("title",{children:mask.name}),(0,jsx_runtime.jsx)(Path,{d:isPreview&&mask.iconPath?mask.iconPath:mask.path,ref:pathRef})]});return(0,jsx_runtime.jsxs)(Aspect,{ref,onClick,tabIndex:0===index?0:-1,"aria-label":mask.name,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,children:[(0,jsx_runtime.jsxs)(AspectInner,{children:[(0,jsx_runtime.jsxs)(ShapePreviewContainer,{children:[(0,jsx_runtime.jsx)(ShapePreviewSizer,{}),getSVG()]},mask.type),active&&(0,jsx_runtime.jsx)(insertionOverlay.Z,{})]}),(0,jsx_runtime.jsx)(libraryMoveable.Z,{type:"shape",elementProps:shapeData,cloneElement:ShapeClone,onClick,cloneProps:{width:dataToEditorX(DEFAULT_ELEMENT_WIDTH*mask.ratio),height:dataToEditorY(DEFAULT_ELEMENT_WIDTH),children:getSVG(!1)}})]})}ShapePreview.displayName="ShapePreview";const shapePreview=ShapePreview,StickerButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({size:constants.qE.Small}).withConfig({displayName:"stickerPreview__StickerButton",componentId:"sc-rjblwe-0"})(["position:relative;padding:0 0 95.5% 0;margin:0;height:60px;background-color:",";&:focus-visible{box-shadow:none;}&:focus-visible [role='presentation']{",";}"],(({theme})=>theme.colors.interactiveBg.previewOverlay),(({theme})=>outline.R(theme.colors.border.focus,theme.colors.bg.secondary))),StickerInner=styled_components_browser_esm.ZP.div.withConfig({displayName:"stickerPreview__StickerInner",componentId:"sc-rjblwe-1"})(["position:absolute;top:0;left:0;height:100%;width:100%;display:flex;align-items:center;justify-content:center;"]),StickerClone=styled_components_browser_esm.ZP.div.withConfig({displayName:"stickerPreview__StickerClone",componentId:"sc-rjblwe-2"})(["position:absolute;top:0;left:0;opacity:0;width:",";height:",";"],(({width})=>`${width}px`),(({height})=>`${height}px`));function StickerPreview({stickerType,index}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{dataToEditorX,dataToEditorY}=(0,useUnits.Z)((state=>({dataToEditorX:state.actions.dataToEditorX,dataToEditorY:state.actions.dataToEditorY}))),sticker=stickers_src.Z[stickerType],aspectRatio=sticker.aspectRatio,stickerData=(0,react_src.Ye)((()=>({width:DEFAULT_ELEMENT_WIDTH*aspectRatio,height:DEFAULT_ELEMENT_WIDTH,sticker:{type:stickerType}})),[aspectRatio,stickerType]),[isActive,setIsActive]=(0,react_src.eJ)(!1),makeActive=()=>setIsActive(!0),makeInactive=()=>setIsActive(!1),onClick=()=>insertElement("sticker",{width:DEFAULT_ELEMENT_WIDTH,sticker:{type:stickerType}}),Svg=sticker.svg;return(0,jsx_runtime.jsx)(StickerButton,{"data-testid":`library-sticker-${stickerType}`,onClick,tabIndex:0===index?0:-1,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,children:(0,jsx_runtime.jsxs)(StickerInner,{children:[(0,jsx_runtime.jsx)(Svg,{style:{height:aspectRatio<.955?"60%":"auto",width:aspectRatio<.955?"auto":"60%"}}),isActive&&(0,jsx_runtime.jsx)(insertionOverlay.Z,{}),(0,jsx_runtime.jsx)(libraryMoveable.Z,{type:"sticker",elementProps:stickerData,cloneElement:StickerClone,onClick,cloneProps:{width:dataToEditorX(DEFAULT_ELEMENT_WIDTH*(aspectRatio<1?aspectRatio:1)),height:dataToEditorY(DEFAULT_ELEMENT_WIDTH/(aspectRatio<1?1:aspectRatio)),children:(0,jsx_runtime.jsx)(Svg,{style:{height:"auto",width:"100%"}})}})]})})}StickerPreview.displayName="StickerPreview";const stickerPreview=StickerPreview,shapes_paneId=(0,panes_shared.Qk)("shapes"),SectionContent=styled_components_browser_esm.ZP.div.withConfig({displayName:"shapesPane__SectionContent",componentId:"sc-ffcyax-0"})(["position:relative;display:grid;grid-column-gap:12px;grid-row-gap:24px;@media screen and (min-width:1220px){grid-template-columns:repeat(4,1fr);}@media screen and (min-width:1100px) and (max-width:1220px){grid-template-columns:repeat(3,1fr);}@media screen and (max-width:1100px){grid-template-columns:repeat(2,1fr);}"]),STICKER_TYPES=Object.keys(stickers_src.Z);function ShapesPane(props){const ref=(0,react_src.sO)();(0,useRovingTabIndex.Z)({ref});const stickersRef=(0,react_src.sO)(null);return(0,useRovingTabIndex.Z)({ref:stickersRef}),(0,jsx_runtime.jsxs)(panes_shared.X6,{id:shapes_paneId,...props,isOverflowScrollable:!0,children:[(0,jsx_runtime.jsx)(Section,{"data-testid":"shapes-library-pane",title:(0,i18n.__)("Shapes","web-stories"),children:(0,jsx_runtime.jsx)(SectionContent,{ref,children:masks_src.R7.filter((mask=>mask.showInLibrary)).map(((mask,i)=>(0,jsx_runtime.jsx)(shapePreview,{mask,index:i,isPreview:!0},mask.type)))})}),(0,jsx_runtime.jsx)(Section,{"data-testid":"stickers-library-pane",title:(0,i18n.__)("Stickers","web-stories"),children:(0,jsx_runtime.jsx)(SectionContent,{ref:stickersRef,children:STICKER_TYPES.map(((stickerType,i)=>(0,jsx_runtime.jsx)(stickerPreview,{index:i,stickerType},stickerType)))})})]})}ShapesPane.displayName="ShapesPane";const shapesPane=ShapesPane;var shapes=__webpack_require__("./packages/design-system/src/icons/shapes.svg");function ShapesIcon(){return(0,jsx_runtime.jsx)(shapes.Z,{title:(0,i18n.__)("Shapes library","web-stories")})}ShapesIcon.displayName="ShapesIcon";const shapesIcon=ShapesIcon;var toggle=__webpack_require__("./packages/design-system/src/components/toggle/toggle.tsx"),objectWithout=__webpack_require__("./packages/story-editor/src/utils/objectWithout.ts");const Preview=styled_components_browser_esm.ZP.button.withConfig({displayName:"fontPreview__Preview",componentId:"sc-kfwh27-0"})(["position:relative;display:flex;align-items:center;background-color:",";padding:8px 0px;border-radius:",";width:100%;border:none;cursor:pointer;text-align:left;"," &:focus-visible [role='presentation']{",";}"],(({theme})=>theme.colors.interactiveBg.secondaryNormal),(({theme})=>theme.borders.radius.small),(({isTextSelected})=>isTextSelected?shared_styles.j:"outline: none;"),(({theme})=>outline.R(theme.colors.border.focus,theme.colors.bg.secondary))),PreviewText=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).withConfig({displayName:"fontPreview__PreviewText",componentId:"sc-kfwh27-1"})(["color:",";font-size:","px;font-weight:",";font-family:",";line-height:normal;margin:",";"],(({theme,isClone})=>isClone?theme.colors.standard.black:theme.colors.fg.primary),(({fontSize})=>fontSize),(({fontWeight})=>fontWeight),(({fontFamily})=>fontFamily),(({isClone})=>isClone?0:"0px 16px")),DragContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"fontPreview__DragContainer",componentId:"sc-kfwh27-2"})(["position:absolute;opacity:0;background-color:",";width:","px;line-height:","px;"],(({theme})=>theme.colors.opacity.white24),(({width})=>width),(({lineHeight})=>lineHeight));function FontPreview({title,element,insertPreset,getPosition,index}){const htmlFormatters=(0,rich_text_src.l5)(),{font,fontSize,content}=element,{fontWeight}=(0,presetUtils.H4)(content),{actions:{maybeEnqueueFontStyle}}=(0,app.jo)(),{dataToEditorX,dataToEditorY}=(0,useUnits.Z)((state=>({dataToEditorX:state.actions.dataToEditorX,dataToEditorY:state.actions.dataToEditorY}))),{shouldUseSmartColor}=library_useLibrary((state=>({shouldUseSmartColor:state.state.shouldUseSmartColor}))),calculateAccessibleTextColors=(0,pageCanvas.J0)(),{isTextSelected,updateSelectedElements}=(0,app.rB)((({state,actions})=>({isTextSelected:(0,presetUtils.rc)("text",state.selectedElements),updateSelectedElements:actions.updateSelectedElements}))),buttonRef=(0,react_src.sO)(null);(0,react_src.d4)((()=>{maybeEnqueueFontStyle([{font,fontWeight,content:(0,dom_src.Cb)(content)}])}),[font,fontWeight,content,maybeEnqueueFontStyle]);const applyStyleOnContent=(0,react_src.I4)((({fontWeight:newFontWeight,isItalic,isUnderline,letterSpacing},elContent)=>(elContent=htmlFormatters.setFontWeight(elContent,newFontWeight),elContent=htmlFormatters.toggleItalic(elContent,isItalic),elContent=htmlFormatters.toggleUnderline(elContent,isUnderline),elContent=htmlFormatters.setLetterSpacing(elContent,letterSpacing))),[htmlFormatters]),onClick=(0,react_src.I4)((async()=>{if(isTextSelected)return void updateSelectedElements({properties:oldElement=>{const newContent=applyStyleOnContent((0,presetUtils.H4)(element.content),oldElement.content),presetAtts=(0,objectWithout.Z)(element,["x","y","content","width"]),sizeUpdates=(0,getUpdatedSizeAndPosition.Z)({...oldElement,...presetAtts});return{...oldElement,...presetAtts,...sizeUpdates,content:newContent}}});let newElement=element;const insertOpts={isPositioned:!1};if(shouldUseSmartColor){const position=getPosition(element);insertOpts.isPositioned=!0,newElement={...element,...position},insertOpts.accessibleColors=await calculateAccessibleTextColors(newElement)}insertPreset(newElement,insertOpts),(0,tracking_src.L9)("insert_text_preset",{name:title})}),[isTextSelected,getPosition,element,shouldUseSmartColor,insertPreset,title,updateSelectedElements,applyStyleOnContent,calculateAccessibleTextColors]),getTextDisplay=(textProps={})=>{const{isClone}=textProps;return(0,jsx_runtime.jsx)(PreviewText,{font,fontSize,fontWeight,...textProps,children:isClone?(0,dom_src.Cb)(content):title})};(0,keyboard.Ew)(buttonRef,{key:["enter","space"]},onClick,[onClick]),(0,useRovingTabIndex.Z)({ref:buttonRef});const[active,setActive]=(0,react_src.eJ)(!1),makeActive=()=>setActive(!0),makeInactive=()=>setActive(!1);return(0,jsx_runtime.jsxs)(Preview,{ref:buttonRef,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,tabIndex:0===index?0:-1,isTextSelected,"aria-label":isTextSelected?(0,sprintf.Z)((0,i18n.__)("Apply preset: %s","web-stories"),title):null,children:[getTextDisplay(),active&&!isTextSelected&&(0,jsx_runtime.jsx)(insertionOverlay.Z,{}),(0,jsx_runtime.jsx)(libraryMoveable.Z,{cloneElement:DragContainer,cloneProps:{children:getTextDisplay({fontSize:dataToEditorY(fontSize),isClone:!0}),width:dataToEditorX(element.width),lineHeight:Math.ceil(dataToEditorY(fontSize))},elementProps:element,type:"text",onClick})]})}FontPreview.displayName="FontPreview";const fontPreview=FontPreview,text_paneId=(0,panes_shared.Qk)("text");var textPresets=__webpack_require__("./packages/story-editor/src/components/library/panes/text/textPresets.ts"),dimensions=__webpack_require__("./packages/units/src/dimensions.ts"),element_library_src=__webpack_require__("./packages/element-library/src/index.js"),getInsertedElementSize=__webpack_require__("./packages/story-editor/src/utils/getInsertedElementSize.ts"),textStyle_utils=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/utils.js");const POSITION_MARGIN=(0,dimensions.dA)(1);const text_useInsertPreset=function useInsertPreset({shouldUseSmartColor}){const{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{state:{versionNumber}}=(0,app.k6)(),htmlFormatters=(0,rich_text_src.l5)(),{setColor}=htmlFormatters,[autoColor,setAutoColor]=(0,react_src.eJ)(null),[presetAtts,setPresetAtts]=(0,react_src.eJ)(null),lastPreset=(0,react_src.sO)(null),calculateAccessibleTextColors=(0,pageCanvas.J0)();(0,react_src.d4)((()=>{lastPreset.current?.element&&!lastPreset.current.versionNumber?lastPreset.current.versionNumber=versionNumber:lastPreset.current?.versionNumber&&(lastPreset.current=null)}),[versionNumber]);const getPosition=(0,react_src.I4)((element=>{const{y}=element;if(!lastPreset.current)return y;const{element:{height:lastHeight,y:lastY}}=lastPreset.current;let positionedY=lastY+lastHeight+POSITION_MARGIN;const{width,height}=(0,getInsertedElementSize.Z)("text",element.width,element.height,{...element,y:positionedY});return positionedY+height>=src_constants.r_&&(positionedY=y),{width,height,y:positionedY}}),[]);(0,react_src.d4)((()=>{if(autoColor&&presetAtts){const{content}=presetAtts,{color,backgroundColor}=autoColor,highlightProps=backgroundColor?{backgroundColor:{color:backgroundColor},backgroundTextMode:elements_src.uG.HIGHLIGHT,padding:(0,textStyle_utils.g1)(presetAtts)}:null,elementProps={...presetAtts,content:color?setColor(content,{color}):content,...highlightProps},addedElement=insertElement("text",{...elementProps,height:(0,element_library_src.XD)(elementProps,elementProps.width)});lastPreset.current={versionNumber:null,element:addedElement},setAutoColor(null),setPresetAtts(null)}}),[autoColor,presetAtts,insertElement,setColor]);const insertPreset=(0,react_src.I4)((async(element,presetProps={})=>{const{isPositioned,accessibleColors}=presetProps,atts=isPositioned?{}:getPosition(element);if(shouldUseSmartColor){if(setPresetAtts({...element,...atts}),accessibleColors)return void setAutoColor(accessibleColors);setAutoColor(await calculateAccessibleTextColors({...element,...atts}))}else{const addedElement=insertElement("text",{...element,...atts});lastPreset.current={versionNumber:null,element:addedElement}}}),[getPosition,calculateAccessibleTextColors,shouldUseSmartColor,insertElement]);return{getPosition,insertPreset}};const src_translateToInclusiveList=function translateToInclusiveList(options){switch(options.length){case 0:return"";case 1:return options[0];case 2:return(0,sprintf.Z)((0,i18n.__)("%1$s and %2$s","web-stories"),options[0],options[1]);default:return(0,sprintf.Z)((0,i18n.__)("%1$s, and %2$s","web-stories"),options.slice(0,options.length-1).join((0,i18n.__)(", ","web-stories")),options[options.length-1])}};var useLiveRegion=__webpack_require__("./packages/design-system/src/utils/useLiveRegion.ts");const FullWidthWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"common__FullWidthWrapper",componentId:"sc-10l2iqe-0"})(["margin-left:-",";margin-right:-",";"],panes_shared.gf,panes_shared.gf);const virtualPaneContainer=(0,styled_components_browser_esm.iv)(["margin-top:38px;padding-top:2px;width:100%;height:100%;"]),VirtualizedWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"virtualizedPanelGrid__VirtualizedWrapper",componentId:"sc-qhv222-0"})(["height:",";width:100%;position:relative;"],(({height})=>`${height}px`));VirtualizedWrapper.propTypes={height:prop_types_default().number.isRequired};const VirtualizedContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"virtualizedPanelGrid__VirtualizedContainer",componentId:"sc-qhv222-1"})(["position:absolute;top:0;left:",";display:grid;grid-template-columns:1fr 1fr;grid-template-columns:",";grid-template-rows:",";gap:","px;width:calc(100% - ",");height:100%;margin-top:4px;"],(({paneLeft=0})=>paneLeft),(({columnWidth})=>`\n    repeat(auto-fill, ${columnWidth}px)`),(({rowHeight})=>`minmax(${rowHeight}px, auto)`),(({rowGap=12})=>rowGap),(({paneLeft=0})=>paneLeft));VirtualizedContainer.propTypes={columnWidth:prop_types_default().number.isRequired,rowHeight:prop_types_default().number.isRequired,rowGap:prop_types_default().number,paneLeft:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().number])};var useFocusCanvas=__webpack_require__("./packages/story-editor/src/components/canvas/useFocusCanvas.ts");var desert_bw=__webpack_require__("./packages/design-system/src/images/desert_bw.svg");const emptyContentMessage_Message=styled_components_browser_esm.ZP.div.withConfig({displayName:"emptyContentMessage__Message",componentId:"sc-vwmhk4-0"})(["display:flex;flex-direction:column;align-items:center;max-width:400px;margin:8vh auto;text-align:center;*{text-align:center;margin:0 auto;}"]),EmptyImage=(0,styled_components_browser_esm.ZP)(desert_bw.Z).withConfig({displayName:"emptyContentMessage__EmptyImage",componentId:"sc-vwmhk4-1"})(["margin-bottom:48px;"]);function EmptyContentMessage({children,...props}){return(0,jsx_runtime.jsxs)(emptyContentMessage_Message,{...props,children:[(0,jsx_runtime.jsx)(EmptyImage,{"aria-hidden":!0,width:274,height:118}),children]})}EmptyContentMessage.displayName="EmptyContentMessage";const components_emptyContentMessage=EmptyContentMessage;var react_virtual=__webpack_require__("./node_modules/react-virtual/dist/react-virtual.mjs"),unitsProvider=__webpack_require__("./packages/units/src/unitsProvider.tsx"),layout=__webpack_require__("./packages/story-editor/src/app/layout/index.ts");function getElementContent(content,isForDisplay){return content?{content:isForDisplay?`<span style="color: #fff">${content}<span>`:content}:{}}function TextSetContainer({pageSize,children}){return pageSize?(0,jsx_runtime.jsx)(unitsProvider.Z,{pageSize,children}):children}function TextSetElements({elements,isForDisplay,pageSize}){const{textSetHeight,textSetWidth}=elements[0],xOffset=isForDisplay?(src_constants.JN-textSetWidth)/2:0,yOffset=isForDisplay?(src_constants.JN-textSetHeight)/2:0;return(0,jsx_runtime.jsx)(TextSetContainer,{pageSize,children:elements.map((({id,content,normalizedOffsetX,normalizedOffsetY,...rest})=>(0,jsx_runtime.jsx)(displayElement.Z,{previewMode:!0,element:{id,...getElementContent(content,isForDisplay),...rest,x:normalizedOffsetX+xOffset,y:normalizedOffsetY+yOffset}},id)))})}TextSetElements.displayName="TextSetElements";const textSetElements=TextSetElements,TextSetItem=styled_components_browser_esm.ZP.button.withConfig({displayName:"textSet__TextSetItem",componentId:"sc-1hor9ow-0"})(["border:0;background:none;position:absolute;top:0;height:","px;width:","px;display:flex;align-items:center;justify-content:center;flex-direction:column;transform:",";background-color:",";border-radius:",";cursor:pointer;transition:background-color ",";outline:none;&:focus-visible [role='presentation']{",";}"],story_editor_src_constants.D_,story_editor_src_constants.D_,(({translateX,translateY})=>`translateX(${translateX}px) translateY(${translateY}px)`),(({theme})=>theme.colors.interactiveBg.secondaryNormal),(({theme})=>theme.borders.radius.small),constants.ok,(({theme})=>outline.R(theme.colors.border.focus,theme.colors.bg.secondary))),TextSetImg=styled_components_browser_esm.ZP.img.withConfig({displayName:"textSet__TextSetImg",componentId:"sc-1hor9ow-1"})(["width:","px;height:","px;"],story_editor_src_constants.D_,story_editor_src_constants.D_),textSet_DragContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"textSet__DragContainer",componentId:"sc-1hor9ow-2"})(["position:absolute;opacity:0;width:","px;height:","px;background-color:",";"],(({width})=>width),(({height})=>height),(({theme})=>theme.colors.opacity.white24));function TextSet({id,elements,translateY,translateX,isActive,index,...rest},ref){const{insertTextSet}=library_useLibrary((state=>({insertTextSet:state.actions.insertTextSet}))),{cdnURL}=(0,app.ZR)(),{pageWidth,pageHeight}=(0,layout.$)((({state:{pageWidth,pageHeight}})=>({pageWidth,pageHeight}))),onClick=(0,react_src.I4)((()=>{insertTextSet(elements),(0,tracking_src.L9)("insert_textset")}),[elements,insertTextSet]),handleKeyboardPageClick=(0,react_src.I4)((({code})=>{"Enter"!==code&&"Space"!==code||onClick()}),[onClick]);(0,useRovingTabIndex.Z)({ref:ref.current});const[isHovering,setIsHovering]=(0,react_src.eJ)(!1),{textSetHeight,textSetWidth}=elements[0],dragWidth=(0,dimensions.Zq)(textSetWidth,pageWidth),dragHeight=(0,dimensions.Px)(textSetHeight,pageHeight);return(0,jsx_runtime.jsxs)(TextSetItem,{translateX,translateY,ref,onKeyUp:handleKeyboardPageClick,onPointerEnter:()=>setIsHovering(!0),onPointerLeave:()=>setIsHovering(!1),tabIndex:0===index?0:-1,...rest,children:[(0,jsx_runtime.jsx)(TextSetImg,{src:`${cdnURL}images/text-sets/${id}.png`,alt:"",crossOrigin:"anonymous",decoding:"async"}),(isActive||isHovering)&&(0,jsx_runtime.jsx)(insertionOverlay.Z,{}),(0,jsx_runtime.jsx)(libraryMoveable.Z,{type:"textSet",elements,elementProps:{},onClick,cloneElement:textSet_DragContainer,cloneProps:{width:dragWidth,height:dragHeight,children:(0,jsx_runtime.jsx)(textSetElements,{elements,pageSize:{width:pageWidth,height:pageHeight}})}})]})}TextSet.displayName="TextSet";const TextSetWithRef=(0,react_src.Gp)(TextSet);TextSet.displayName="TextSet";const textSets_textSet=TextSetWithRef,CATEGORIES={contact:(0,i18n._x)("Contact","text set category","web-stories"),editorial:(0,i18n._x)("Editorial","text set category","web-stories"),list:(0,i18n._x)("List","text set category","web-stories"),cover:(0,i18n._x)("Cover","text set category","web-stories"),section_header:(0,i18n._x)("Header","text set category","web-stories"),step:(0,i18n._x)("Steps","text set category","web-stories"),table:(0,i18n._x)("Table","text set category","web-stories"),quote:(0,i18n._x)("Quote","text set category","web-stories")},PANE_TEXT={TITLE:(0,i18n.__)("Text Sets","web-stories"),SWITCH_LABEL:(0,i18n.__)("Match fonts from story","web-stories")},TEXT_SET_PAGE_SIZE={width:story_editor_src_constants.D_,height:story_editor_src_constants.D_/src_constants.O1};function TextSets({paneRef,filteredTextSets}){const containerRef=(0,react_src.sO)(),textSetRefs=(0,react_src.sO)({}),textSetIds=(0,react_src.Ye)((()=>filteredTextSets.map((textSet=>textSet.id))),[filteredTextSets]),rowVirtualizer=(0,react_virtual.o)({size:Math.ceil((filteredTextSets||[]).length/2),parentRef:paneRef,estimateSize:(0,react_src.I4)((()=>story_editor_src_constants.D_+12),[]),overscan:4}),columnVirtualizer=(0,react_virtual.o)({horizontal:!0,size:2,parentRef:paneRef,estimateSize:(0,react_src.I4)((()=>story_editor_src_constants.D_+12),[]),overscan:0}),{activeGridItemId,handleGridFocus,handleGridItemFocus,isGridFocused}=function useVirtualizedGridNavigation({containerRef,gridItemRefs,gridItemIds,rowVirtualizer}){const[activeGridItemId,setActiveGridItemId]=(0,react_src.eJ)(),[isGridFocused,setIsGridFocused]=(0,react_src.eJ)(!1),currentAvailableRows=(0,react_src.Ye)((()=>rowVirtualizer.virtualItems),[rowVirtualizer]),currentAvailableRowsRef=(0,react_src.sO)();(0,react_src.d4)((()=>{currentAvailableRows!==currentAvailableRowsRef?.current&&(currentAvailableRowsRef.current=currentAvailableRows),activeGridItemId&&isGridFocused&&gridItemRefs.current?.[activeGridItemId]?.focus()}),[activeGridItemId,currentAvailableRows,isGridFocused,gridItemRefs]),(0,useRovingTabIndex.Z)({ref:containerRef});const handleGridFocus=(0,react_src.I4)((()=>{if(!isGridFocused){const newGridItemId=gridItemRefs.current?.[activeGridItemId]?activeGridItemId:gridItemIds?.[0];setActiveGridItemId(newGridItemId),setIsGridFocused(!0),gridItemRefs.current?.[newGridItemId]?.focus()}}),[activeGridItemId,isGridFocused,gridItemIds,gridItemRefs]),handleGridItemFocus=(0,react_src.I4)((itemId=>{activeGridItemId!==itemId&&setActiveGridItemId(itemId)}),[activeGridItemId]),focusCanvas=(0,useFocusCanvas.Z)(),onTabKeyDown=(0,react_src.I4)((()=>{focusCanvas(),setIsGridFocused(!1)}),[focusCanvas]);return(0,keyboard.Ew)(containerRef,"tab",onTabKeyDown,[onTabKeyDown]),(0,react_src.FR)(containerRef,(()=>{setIsGridFocused(!1)}),[]),(0,react_src.Ye)((()=>({handleGridFocus,handleGridItemFocus,activeGridItemId,isGridFocused})),[activeGridItemId,isGridFocused,handleGridFocus,handleGridItemFocus])}({rowVirtualizer,containerRef,gridItemRefs:textSetRefs,gridItemIds:textSetIds});return(0,jsx_runtime.jsx)(unitsProvider.Z,{pageSize:TEXT_SET_PAGE_SIZE,children:(0,jsx_runtime.jsx)(VirtualizedWrapper,{height:rowVirtualizer.totalSize,children:(0,jsx_runtime.jsx)(VirtualizedContainer,{height:rowVirtualizer.totalSize,ref:containerRef,columnWidth:story_editor_src_constants.D_,rowHeight:story_editor_src_constants.D_,onFocus:handleGridFocus,role:"group","aria-label":(0,i18n.__)("Text Set Options","web-stories"),children:rowVirtualizer.virtualItems.map((virtualRow=>columnVirtualizer.virtualItems.map((virtualColumn=>{const gridIndex=(({columnIndex,rowIndex})=>0===columnIndex?2*rowIndex:2*rowIndex+1)({columnIndex:virtualColumn.index,rowIndex:virtualRow.index}),textSet=filteredTextSets[gridIndex];if(!textSet?.elements)return null;const isActive=activeGridItemId===textSet.id&&isGridFocused;return(0,jsx_runtime.jsx)(textSets_textSet,{id:textSet.id,"data-testid":`text_set_${textSet.id}`,ref:el=>textSetRefs.current[textSet.id]=el,translateY:virtualRow.start,translateX:virtualColumn.start,"aria-label":textSet.title,isActive,onFocus:()=>handleGridItemFocus(textSet.id),elements:textSet.elements,index:gridIndex},gridIndex)}))))})})})}TextSets.displayName="TextSets";const textSets_textSets=TextSets,TitleBar=styled_components_browser_esm.ZP.div.withConfig({displayName:"textSetsPane__TitleBar",componentId:"sc-vycaev-0"})(["display:flex;justify-content:space-between;padding:20px 0;"]),TextSetsToggle=styled_components_browser_esm.ZP.div.withConfig({displayName:"textSetsPane__TextSetsToggle",componentId:"sc-vycaev-1"})(["display:flex;label{cursor:pointer;margin:auto 12px;color:",";}"],(({theme})=>theme.colors.fg.secondary)),TextSetsWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"textSetsPane__TextSetsWrapper",componentId:"sc-vycaev-2"})(["",";"],virtualPaneContainer);function TextSetsPane({paneRef}){const{areTextSetsLoading,textSets}=library_useLibrary((({state:{areTextSetsLoading,textSets}})=>({areTextSetsLoading,textSets}))),[showInUse,setShowInUse]=(0,react_src.eJ)(!1),trackChange=(0,react_src.sO)(!1),allTextSets=(0,react_src.Ye)((()=>Object.values(textSets).flat()),[textSets]),storyPages=(0,story_useStory.Z)((({state:{pages}})=>pages)),[selectedCat,setSelectedCat]=(0,react_src.eJ)(localStore.W.getItemByKey(localStore.h.TEXT_SET_SETTINGS)?.selectedCategory),getTextSetsForInUseFonts=(0,react_src.I4)((()=>{return function getTextSetsForFonts({fonts,textSets}){return textSets.map((currentTextSet=>currentTextSet.elements.reduce(((elementMemo,currentElement)=>elements_src.Zy.text(currentElement)?elementMemo||-1!==fonts.indexOf(currentElement.font.family):elementMemo),!1)&&currentTextSet)).filter(Boolean)}({fonts:(pages=storyPages,Array.from(new Set(pages.flatMap((({elements=[]})=>elements.map((element=>elements_src.Zy.text(element)?element.font.family:null)))).filter(Boolean)))||[]),textSets:selectedCat?textSets[selectedCat]:allTextSets});var pages}),[allTextSets,storyPages,selectedCat,textSets]),addIdToTextSets=(0,react_src.I4)(((textSetsArray=[])=>textSetsArray.map((({textSetFonts=[],textSetCategory,elements,id})=>({id,title:(0,sprintf.Z)((0,i18n._n)("Text set %1$s with %2$s font","Text set %1$s with %2$s fonts",textSetFonts.length,"web-stories"),CATEGORIES[textSetCategory],src_translateToInclusiveList(textSetFonts)),elements})))),[]),filteredTextSets=(0,react_src.Ye)((()=>addIdToTextSets(showInUse?getTextSetsForInUseFonts():selectedCat?textSets?.[selectedCat]:allTextSets)),[selectedCat,textSets,allTextSets,addIdToTextSets,getTextSetsForInUseFonts,showInUse]),categories=(0,react_src.Ye)((()=>[{id:null,label:(0,i18n._x)("All","text sets","web-stories")},...Object.keys(textSets).map((category=>({id:category,label:CATEGORIES[category]??category})))]),[textSets]),speak=(0,useLiveRegion.Z)(),handleSelectedCategory=(0,react_src.I4)((selectedCategory=>{setSelectedCat(selectedCategory),speak(null===selectedCategory?(0,i18n.__)("Show all text sets","web-stories"):(0,sprintf.Z)((0,i18n.__)("Selected text set filter %s","web-stories"),CATEGORIES[selectedCategory])),localStore.W.setItemByKey(localStore.h.TEXT_SET_SETTINGS,{selectedCategory}),trackChange.current=!0}),[speak]),onChangeShowInUse=(0,react_src.I4)((()=>{requestAnimationFrame((()=>setShowInUse((prevVal=>!prevVal)))),trackChange.current=!0}),[setShowInUse]);(0,react_src.d4)((()=>{trackChange.current&&(0,tracking_src.L9)("search",{search_type:"textsets",search_term:"",search_category:selectedCat,search_filter:showInUse?"show_in_use":void 0})}),[selectedCat,showInUse]);const sectionId=(0,react_src.Ye)((()=>`section-${(0,v4.Z)()}`),[]),toggleId=(0,react_src.Ye)((()=>`toggle_text_sets_${(0,v4.Z)()}`),[]),emptyContentMessage=(0,react_src.Ye)((()=>showInUse?(0,i18n.__)("No matching Text Sets available. Try adding text to your story.","web-stories"):(0,i18n.__)("No Text Sets available.","web-stories")),[showInUse]);return(0,jsx_runtime.jsxs)(section_Container,{id:sectionId,children:[(0,jsx_runtime.jsxs)(TitleBar,{children:[(0,jsx_runtime.jsx)(headline.s,{as:"h2",size:types.TextSize.XXXSmall,children:PANE_TEXT.TITLE}),(0,jsx_runtime.jsxs)(TextSetsToggle,{children:[(0,jsx_runtime.jsx)(typography_text.x.Label,{htmlFor:toggleId,size:types.TextSize.Small,children:PANE_TEXT.SWITCH_LABEL}),(0,jsx_runtime.jsx)(toggle.Z,{id:toggleId,"aria-label":PANE_TEXT.SWITCH_LABEL,name:toggleId,checked:showInUse,onChange:onChangeShowInUse})]})]}),(0,jsx_runtime.jsx)(FullWidthWrapper,{children:(0,jsx_runtime.jsx)(panes_shared.Zn,{items:categories,selectedItemId:selectedCat,selectItem:handleSelectedCategory,deselectItem:()=>handleSelectedCategory(null),ariaLabel:(0,i18n.__)("Select filter for text sets list","web-stories")})}),(0,jsx_runtime.jsx)(TextSetsWrapper,{children:filteredTextSets?.length||areTextSetsLoading?(0,jsx_runtime.jsx)(textSets_textSets,{paneRef,filteredTextSets}):(0,jsx_runtime.jsx)(components_emptyContentMessage,{children:emptyContentMessage})})]})}TextSetsPane.displayName="TextSetsPane";const textSetsPane=TextSetsPane;var plus=__webpack_require__("./packages/design-system/src/icons/plus.svg"),disclosure=__webpack_require__("./packages/design-system/src/components/disclosure/disclosure.tsx"),popup=__webpack_require__("./packages/design-system/src/components/popup/popup.tsx");const styleManager_useKeyboardNavigation=function useKeyboardNavigation({activeIndex,setActiveIndex,groupRef}){(0,keyboard.Ew)(groupRef,{key:["up","down","left","right"]},(({key})=>{if(groupRef.current){const diff=((key,rowLength)=>{switch(key){case"ArrowUp":return-rowLength;case"ArrowDown":return rowLength;case"ArrowLeft":return-1;case"ArrowRight":return 1;default:return 0}})(key,2),buttons=groupRef.current.querySelectorAll("button:not([disabled])"),maxIndex=buttons.length-1,val=(activeIndex??0)+diff,newIndex=Math.max(0,Math.min(maxIndex,val));setActiveIndex(newIndex),buttons[newIndex]&&buttons[newIndex].focus()}}),[activeIndex,setActiveIndex,groupRef])};var cross=__webpack_require__("./packages/design-system/src/icons/cross.svg");const PresetButton=styled_components_browser_esm.ZP.button.withConfig({displayName:"styleItem__PresetButton",componentId:"sc-157dmik-0"})(["background-color:",";border-color:transparent;position:relative;cursor:pointer;border-width:0;border-radius:4px;padding:3px;height:100%;width:100%;display:flex;justify-content:center;align-items:center;> svg{width:","px;height:","px;position:absolute;top:calc(50% - ","px);left:calc(50% - ","px);color:",";filter:drop-shadow(0px 0px 4px rgba(0,0,0,0.4));}",""],(({theme})=>theme.colors.interactiveBg.secondaryNormal),32,32,16,16,(({theme})=>theme.colors.fg.primary),shared_styles.j),HighLight=styled_components_browser_esm.ZP.span.withConfig({displayName:"styleItem__HighLight",componentId:"sc-157dmik-1"})(["padding:0 2px;"," box-decoration-break:clone;"],(({background})=>(0,generatePatternStyles.Z)(background))),TextWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleItem__TextWrapper",componentId:"sc-157dmik-2"})(["position:relative;display:inline-block;line-height:","px;max-height:","px;overflow:hidden;border-radius:4px;padding:3px;max-width:100%;"," font-size:12px;",""],20,43,(({styles})=>styles),(({background})=>background?(0,generatePatternStyles.Z)(background):null));function StyleItem({style,i,activeIndex,handleOnClick,isEditMode,activeItemOverlay,applyLabel=(0,i18n.__)("Apply style","web-stories")}){const selectedElements=(0,app_story.rB)((({state})=>state.selectedElements)),[isActive,setIsActive]=(0,react_src.eJ)(!1),makeActive=()=>{activeItemOverlay&&setIsActive(!0)},makeInactive=()=>{activeItemOverlay&&setIsActive(!1)};if(!style)return null;const textContent=selectedElements[0]?.content?(0,dom_src.Cb)(selectedElements[0].content):(0,i18n.__)("Lorem ipsum dolor sit amet","web-stories");return(0,jsx_runtime.jsxs)(PresetButton,{tabIndex:activeIndex===i?0:-1,style,onClick:()=>handleOnClick(style),onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,"aria-label":isEditMode?(0,i18n.__)("Delete style","web-stories"):applyLabel,children:[(()=>{const isHighLight=style.backgroundTextMode===elements_src.uG.HIGHLIGHT,isFill=style.backgroundTextMode===elements_src.uG.FILL;return(0,jsx_runtime.jsx)(TextWrapper,{styles:(0,presetUtils.fH)(style,!0),background:isFill?style.backgroundColor:null,children:isHighLight?(0,jsx_runtime.jsx)(HighLight,{background:style.backgroundColor,children:textContent}):textContent})})(),isEditMode&&(0,jsx_runtime.jsx)(cross.Z,{}),!isEditMode&&isActive&&activeItemOverlay]})}StyleItem.displayName="StyleItem";const styleItem=StyleItem,Group=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleGroup__Group",componentId:"sc-1cojpnq-0"})(["display:grid;grid-template-columns:repeat(2,1fr);grid-column-gap:20px;grid-row-gap:16px;"]),ButtonWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleGroup__ButtonWrapper",componentId:"sc-1cojpnq-1"})(["height:","px;width:","px;"],story_editor_src_constants.H_,(({width})=>width));function StyleGroup({styles,isEditMode=!1,handleClick,buttonWidth=128,...rest}){const[activeIndex,setActiveIndex]=(0,react_src.eJ)(0),groupRef=(0,react_src.sO)(null);return styleManager_useKeyboardNavigation({activeIndex,setActiveIndex,groupRef,type:story_editor_src_constants.SE.STYLE}),(0,jsx_runtime.jsx)(Group,{ref:groupRef,children:styles.map(((style,i)=>(0,jsx_runtime.jsx)(ButtonWrapper,{width:buttonWidth,children:(0,jsx_runtime.jsx)(styleItem,{style,i,activeIndex,handleOnClick:handleClick,isEditMode,...rest})},JSON.stringify(style))))})}StyleGroup.displayName="StyleGroup";const styleGroup=StyleGroup;var CSSTransition=__webpack_require__("./node_modules/react-transition-group/esm/CSSTransition.js"),useFocusTrapping=__webpack_require__("./packages/story-editor/src/utils/useFocusTrapping.js"),pencil=__webpack_require__("./packages/design-system/src/icons/pencil.svg");const header_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"header__Wrapper",componentId:"sc-10q8amw-0"})(["display:flex;justify-content:space-between;align-items:center;height:","px;padding:4px 8px 4px 8px;position:relative;border-bottom:1px solid ",";"],44,(({theme})=>theme.colors.divider.tertiary)),Actions=styled_components_browser_esm.ZP.div.withConfig({displayName:"header__Actions",componentId:"sc-10q8amw-1"})(["display:flex;margin-left:auto;"]),StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"header__StyledButton",componentId:"sc-10q8amw-2"})(["margin-left:8px;",";"],shared_styles.j);function header_Header({children,handleClose,isEditMode=!1,setIsEditMode=noop.Z}){const ref=(0,react_src.sO)();(0,react_src.d4)((()=>{ref.current?.focus()}),[]);const buttonProps={type:constants.L$.Tertiary,size:constants.qE.Small,onClick:evt=>{evt.stopPropagation(),setIsEditMode(!isEditMode)},isEditMode};return(0,jsx_runtime.jsxs)(header_Wrapper,{children:[children,(0,jsx_runtime.jsxs)(Actions,{children:[isEditMode?(0,jsx_runtime.jsx)(StyledButton,{...buttonProps,variant:constants.Wu.Rectangle,"aria-label":(0,i18n.__)("Exit edit mode","web-stories"),children:(0,i18n.__)("Done","web-stories")}):(0,jsx_runtime.jsx)(StyledButton,{...buttonProps,variant:constants.Wu.Square,"aria-label":(0,i18n.__)("Edit style","web-stories"),children:(0,jsx_runtime.jsx)(pencil.Z,{})}),(0,jsx_runtime.jsx)(StyledButton,{"aria-label":(0,i18n.__)("Close","web-stories"),onClick:handleClose,type:constants.L$.Tertiary,size:constants.qE.Small,variant:constants.Wu.Square,ref,children:(0,jsx_runtime.jsx)(cross.Z,{})})]})]})}header_Header.displayName="Header";const header=header_Header;var checkbox_checkbox=__webpack_require__("./packages/design-system/src/components/checkbox/checkbox.tsx");const STORAGE_KEY="DELETE_STYLE_PRESET_DIALOG_DISMISSED",confirmationDialog_Label=styled_components_browser_esm.ZP.label.withConfig({displayName:"confirmationDialog__Label",componentId:"sc-ezab89-0"})(["margin-left:12px;"]),CheckboxWrapper=styled_components_browser_esm.ZP.footer.withConfig({displayName:"confirmationDialog__CheckboxWrapper",componentId:"sc-ezab89-1"})(["display:flex;margin-top:12px;padding:14px 0 0 9px;border-top:1px solid ",";"],(({theme})=>theme.colors.divider.primary));function ConfirmationDialog({onClose,onPrimary}){const[isDialogDismissed,setIsDialogDismissed]=(0,react_src.eJ)(localStore.W.getItemByKey(localStore.h[STORAGE_KEY])),dialogText=(0,i18n.__)("This is a global style. Deleting this style will remove it from the Saved Styles across all stories and the style will no longer be available to any other users on the site.","web-stories"),cbId=`cb-${(0,v4.Z)()}`;return(0,jsx_runtime.jsxs)(dialog.Z,{isOpen:!0,onClose,secondaryText:(0,i18n.__)("Cancel","web-stories"),onPrimary,primaryText:(0,i18n.__)("Delete","web-stories"),children:[(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.Small,children:dialogText}),(0,jsx_runtime.jsxs)(CheckboxWrapper,{children:[(0,jsx_runtime.jsx)(checkbox_checkbox.Z,{id:cbId,checked:isDialogDismissed,onChange:()=>{localStore.W.setItemByKey(localStore.h[STORAGE_KEY],!isDialogDismissed),setIsDialogDismissed(!isDialogDismissed)}}),(0,jsx_runtime.jsx)(confirmationDialog_Label,{htmlFor:cbId,children:(0,jsx_runtime.jsx)(typography_text.x.Span,{size:types.TextSize.Small,children:(0,i18n.__)("Don't ask for confirmation again.","web-stories")})})]})]})}ConfirmationDialog.displayName="ConfirmationDialog";const confirmationDialog=ConfirmationDialog,styleManager_Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleManager__Container",componentId:"sc-4hlmhs-0"})(["border-radius:8px;background:",";width:256px;user-select:none;display:flex;flex-direction:column;align-items:stretch;overflow:hidden;&.style-manager-appear{opacity:0.01;margin-top:-10px;&.style-manager-appear-active{opacity:1;margin-top:0;transition:300ms ease-out;transition-property:opacity,margin-top;}}"],(({theme})=>theme.colors.bg.secondary)),Body=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleManager__Body",componentId:"sc-4hlmhs-1"})(["display:flex;margin:8px 12px 16px;"]),styleManager_StyledText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"styleManager__StyledText",componentId:"sc-4hlmhs-2"})(["margin:0 0 0 8px;color:",";"],(({theme})=>theme.colors.fg.primary));function StyleManager({styles,onClose,applyStyle,...rest}){const[isEditMode,setIsEditMode]=(0,react_src.eJ)(!1),[showDialog,setShowDialog]=(0,react_src.eJ)(!1),[toDelete,setToDelete]=(0,react_src.eJ)(null),containerRef=(0,react_src.sO)(null),previousFocus=(0,react_src.sO)(document.activeElement),handleCloseAndRefocus=(0,react_src.I4)((evt=>{previousFocus.current&&previousFocus.current.focus(),onClose(evt)}),[onClose]);(0,keyboard.Ew)(containerRef,"esc",handleCloseAndRefocus);const deleteStyle=useDeleteStyle({onEmpty:handleCloseAndRefocus});(0,react_src.FR)(containerRef,(()=>{showDialog||onClose()}),[showDialog]),(0,useFocusTrapping.Z)({ref:containerRef});return(0,jsx_runtime.jsx)(CSSTransition.Z,{nodeRef:containerRef,in:!0,appear:!0,classNames:"style-manager",timeout:300,children:(0,jsx_runtime.jsxs)(styleManager_Container,{role:"dialog","aria-label":(0,i18n.__)("Style presets manager","web-stories"),ref:containerRef,children:[(0,jsx_runtime.jsx)(header,{handleClose:handleCloseAndRefocus,isEditMode,setIsEditMode,children:(0,jsx_runtime.jsx)(styleManager_StyledText,{children:(0,i18n.__)("Saved Styles","web-stories")})}),(0,jsx_runtime.jsx)(Body,{children:(0,jsx_runtime.jsx)(styleGroup,{styles:[...styles].reverse(),handleClick:style=>{if(!isEditMode)return void applyStyle(style);localStore.W.getItemByKey(localStore.h[STORAGE_KEY])?deleteStyle(style):(setShowDialog(!0),setToDelete(style))},isEditMode,buttonWidth:106,...rest})}),showDialog&&(0,jsx_runtime.jsx)(confirmationDialog,{onClose:()=>setShowDialog(!1),onPrimary:()=>{deleteStyle(toDelete),setToDelete(null),setShowDialog(!1)}})]})})}StyleManager.displayName="StyleManager";const styleManager=StyleManager,NoStylesWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleManager__NoStylesWrapper",componentId:"sc-1u9p583-0"})(["display:flex;justify-content:center;align-items:center;width:calc(100% + 32px);margin:0 0 -8px -16px;background-color:",";height:64px;"],(({theme})=>theme.colors.opacity.black24)),MoreButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:constants.L$.Plain,size:constants.qE.Small,variant:constants.Wu.Rectangle}).withConfig({displayName:"styleManager__MoreButton",componentId:"sc-1u9p583-1"})(["",";margin:12px 0;padding:0 16px;justify-content:center;align-self:center;width:100%;svg{transform:rotate(-90deg);height:32px;width:32px;margin-left:-4px;}"],shared_styles.j),SectionContainer=(0,styled_components_browser_esm.ZP)(section_Container).withConfig({displayName:"stylePresets__SectionContainer",componentId:"sc-bczcw0-0"})(["padding:16px 0;margin-bottom:-24px;border-top:1px solid ",";border-bottom:1px solid ",";"],(({theme})=>theme.colors.divider.tertiary),(({theme})=>theme.colors.divider.tertiary)),stylePresets_TitleBar=styled_components_browser_esm.ZP.div.withConfig({displayName:"stylePresets__TitleBar",componentId:"sc-bczcw0-1"})(["display:flex;padding-bottom:16px;justify-content:space-between;align-items:center;"]),StylesWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"stylePresets__StylesWrapper",componentId:"sc-bczcw0-2"})([""]),stylePresets_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"stylePresets__StyledButton",componentId:"sc-bczcw0-3"})(["margin-left:auto;"]),NoStylesText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"stylePresets__NoStylesText",componentId:"sc-bczcw0-4"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary)),SPACING={x:40};function PresetPanel(){const{textStyles,isText,updateSelectedElements}=(0,app.rB)((({state,actions})=>({isText:Boolean(state.selectedElements&&(0,presetUtils.rc)("text",state.selectedElements)),textStyles:state.story?.globalStoryStyles?.textStyles||[],updateSelectedElements:actions.updateSelectedElements}))),{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),{setColor,setFontWeight,setLetterSpacing,toggleItalic,toggleUnderline}=(0,rich_text_src.l5)(),buttonRef=(0,react_src.sO)(null),stylesRef=(0,react_src.sO)(null),[isPopupOpen,setIsPopupOpen]=(0,react_src.eJ)(!1),hasPresets=textStyles.length>0,pushUpdate=(0,react_src.I4)((update=>{updateSelectedElements({properties:element=>{const updates=(0,updateProperties.Z)(element,update,!0),sizeUpdates=(0,getUpdatedSizeAndPosition.Z)({...element,...updates});return{...updates,...sizeUpdates}}})}),[updateSelectedElements]),handleApplyStyle=styleManager_useApplyStyle({pushUpdate}),{addGlobalPreset}=(0,useAddPreset.Z)({presetType:story_editor_src_constants.SE.STYLE}),handlePresetClick=preset=>{isText?handleApplyStyle(preset):((preset=>{const{color,fontWeight,isItalic,isUnderline,letterSpacing}=preset;let content=textPresets.c.content;content=setColor(content,color),content=setFontWeight(content,fontWeight),content=toggleItalic(content,isItalic),content=toggleUnderline(content,isUnderline),content=setLetterSpacing(content,letterSpacing),insertElement("text",{...textPresets.c,...preset,content})})(preset),setIsPopupOpen(!1))},styleItemProps=isText?{}:{activeItemOverlay:(0,jsx_runtime.jsx)(insertionOverlay.Z,{}),applyLabel:(0,i18n.__)("Add new text","web-stories")};return(0,jsx_runtime.jsxs)(SectionContainer,{children:[(0,jsx_runtime.jsxs)(stylePresets_TitleBar,{children:[(0,jsx_runtime.jsx)(headline.s,{as:"h2",size:types.TextSize.XXXSmall,children:(0,i18n.__)("Saved Styles","web-stories")}),(0,jsx_runtime.jsx)(stylePresets_StyledButton,{type:constants.L$.Tertiary,size:constants.qE.Small,variant:constants.Wu.Square,onClick:addGlobalPreset,"aria-label":(0,i18n.__)("Add style","web-stories"),disabled:!isText,children:(0,jsx_runtime.jsx)(plus.Z,{})})]}),hasPresets&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(StylesWrapper,{ref:stylesRef,children:(0,jsx_runtime.jsx)(styleGroup,{styles:[...textStyles].reverse().slice(0,2),handleClick:handlePresetClick,buttonWidth:150,...styleItemProps})}),(0,jsx_runtime.jsxs)(MoreButton,{ref:buttonRef,onClick:()=>setIsPopupOpen(!0),"aria-haspopup":"dialog","aria-expanded":isPopupOpen,children:[(0,i18n.__)("More styles","web-stories"),(0,jsx_runtime.jsx)(disclosure.Z,{$isOpen:isPopupOpen})]}),(0,jsx_runtime.jsx)(popup.Z,{anchor:buttonRef,isOpen:isPopupOpen,placement:popup_constants.ug.RightStart,spacing:SPACING,renderContents:()=>(0,jsx_runtime.jsx)(styleManager,{styles:textStyles,applyStyle:handlePresetClick,onClose:()=>setIsPopupOpen(!1),...styleItemProps})})]}),!hasPresets&&(0,jsx_runtime.jsx)(NoStylesWrapper,{children:(0,jsx_runtime.jsx)(NoStylesText,{size:types.TextSize.Small,children:(0,i18n.__)("No Styles Saved","web-stories")})})]})}PresetPanel.displayName="PresetPanel";const stylePresets=(0,react_src.X$)(PresetPanel),Pane=(0,styled_components_browser_esm.ZP)(panes_shared.X6).withConfig({displayName:"textPane__Pane",componentId:"sc-zvmbdp-0"})(["overflow-y:scroll;max-height:100%;position:relative;"]),GridContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"textPane__GridContainer",componentId:"sc-zvmbdp-1"})(["display:grid;grid-template-columns:1fr 1fr;gap:12px;"]),SmartColorToggle=styled_components_browser_esm.ZP.div.withConfig({displayName:"textPane__SmartColorToggle",componentId:"sc-zvmbdp-2"})(["display:flex;label{cursor:pointer;margin:auto 12px;color:",";}"],(({theme})=>theme.colors.fg.secondary));function TextPane(props){const paneRef=(0,react_src.sO)(),[,forceUpdate]=(0,react_src.eJ)(),{shouldUseSmartColor,setShouldUseSmartColor}=library_useLibrary((state=>({shouldUseSmartColor:state.state.shouldUseSmartColor,setShouldUseSmartColor:state.actions.setShouldUseSmartColor}))),{getPosition,insertPreset}=text_useInsertPreset({shouldUseSmartColor}),generateDeferredCurrentPageCanvas=(0,pageCanvas.CA)((({actions})=>actions.generateDeferredCurrentPageCanvas));(0,react_src.Bz)(paneRef,(()=>{forceUpdate(Date.now())}),[]);const handleToggleClick=(0,react_src.I4)((()=>setShouldUseSmartColor((currentValue=>!currentValue))),[setShouldUseSmartColor]),toggleId=(0,react_src.Ye)((()=>`toggle_auto_color_${(0,v4.Z)()}`),[]);return(0,jsx_runtime.jsxs)(Pane,{id:text_paneId,...props,ref:paneRef,children:[(0,jsx_runtime.jsxs)(SmartColorToggle,{children:[(0,jsx_runtime.jsx)(typography_text.x.Label,{htmlFor:toggleId,size:types.TextSize.Small,children:(0,i18n.__)("Adaptive text colors","web-stories")}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("May impact performance when inserting text","web-stories"),children:(0,jsx_runtime.jsx)(toggle.Z,{id:toggleId,checked:shouldUseSmartColor,onChange:handleToggleClick})})]}),(0,jsx_runtime.jsx)(section_Container,{onPointerOver:()=>shouldUseSmartColor&&generateDeferredCurrentPageCanvas(),children:(0,jsx_runtime.jsx)(GridContainer,{children:textPresets.P.map((({title,element},index)=>(0,jsx_runtime.jsx)(fontPreview,{title,element,insertPreset,getPosition,index},title)))})}),(0,jsx_runtime.jsx)(stylePresets,{}),paneRef.current&&(0,jsx_runtime.jsx)(textSetsPane,{paneRef})]})}TextPane.displayName="TextPane";const textPane=TextPane;var letter_t=__webpack_require__("./packages/design-system/src/icons/letter_t.svg");function TextIcon(){return(0,jsx_runtime.jsx)(letter_t.Z,{title:(0,i18n.__)("Text library","web-stories")})}TextIcon.displayName="TextIcon";const textIcon=TextIcon,pageTemplates_paneId=(0,panes_shared.Qk)("pageTemplates");var loadingSpinner=__webpack_require__("./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx");const PAGE_TEMPLATE_TYPES={cover:{name:(0,i18n.__)("Cover","web-stories")},section:{name:(0,i18n.__)("Section","web-stories")},quote:{name:(0,i18n.__)("Quote","web-stories")},editorial:{name:(0,i18n.__)("Editorial","web-stories")},list:{name:(0,i18n.__)("List","web-stories")},table:{name:(0,i18n.__)("Table","web-stories")},steps:{name:(0,i18n.__)("Steps","web-stories")}};var useGridViewKeys=__webpack_require__("./packages/design-system/src/components/keyboard/gridview/useGridViewKeys.ts");const PageTemplateWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"defaultPageTemplate__PageTemplateWrapper",componentId:"sc-kt5s68-0"})([""]),PageTemplateButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:constants.L$.Plain}).withConfig({displayName:"defaultPageTemplate__PageTemplateButton",componentId:"sc-kt5s68-1"})(["position:relative;display:block;padding:0;border-radius:",";overflow:hidden;&:focus-visible{box-shadow:none;}&:focus-visible [role='presentation']{",";}"],(({theme})=>theme.borders.radius.small),(({theme})=>outline.R(theme.colors.border.focus,theme.colors.bg.secondary))),TemplateTitleContainer=(0,styled_components_browser_esm.ZP)(panes_shared.vO).withConfig({displayName:"defaultPageTemplate__TemplateTitleContainer",componentId:"sc-kt5s68-2"})(["",":hover &,",":focus &{opacity:1;}"],PageTemplateButton,PageTemplateButton),PosterImg=styled_components_browser_esm.ZP.img.withConfig({displayName:"defaultPageTemplate__PosterImg",componentId:"sc-kt5s68-3"})(["display:block;width:100%;"]),DefaultPageTemplate=(0,react_src.Gp)((({page,columnWidth,isActive,onFocus,...rest},ref)=>{const templateTitle=(0,sprintf.Z)((0,i18n._x)("%1$s %2$s","page template title","web-stories"),page.title,PAGE_TEMPLATE_TYPES[page.type].name),[isFocused,setIsFocused]=(0,react_src.eJ)(!1);return(0,jsx_runtime.jsx)(PageTemplateWrapper,{ref,role:"listitem",children:(0,jsx_runtime.jsxs)(PageTemplateButton,{columnWidth,tabIndex:isActive?0:-1,"aria-label":templateTitle,onPointerEnter:()=>setIsFocused(!0),onPointerLeave:()=>setIsFocused(!1),onFocus:()=>{setIsFocused(!0),onFocus?.()},onBlur:()=>setIsFocused(!1),...rest,children:[page.png&&(0,jsx_runtime.jsx)(PosterImg,{src:page.png,alt:(0,sprintf.Z)((0,i18n.__)("Snapshot of page template for %1$s","web-stories"),page.title),crossOrigin:"anonymous",decoding:"async",draggable:!1}),isFocused&&(0,jsx_runtime.jsx)(insertionOverlay.Z,{}),page.title&&(0,jsx_runtime.jsx)(TemplateTitleContainer,{children:(0,jsx_runtime.jsx)(typography_text.x.Span,{size:types.TextSize.Small,children:templateTitle})})]})})}));DefaultPageTemplate.displayName="DefaultPageTemplate";const defaultPageTemplate=DefaultPageTemplate;var plus_filled_small=__webpack_require__("./packages/design-system/src/icons/plus_filled_small.svg"),fetchRemoteBlob=__webpack_require__("./packages/media/src/fetchRemoteBlob.ts"),uploader=__webpack_require__("./packages/story-editor/src/app/uploader/index.ts"),utils_noop=__webpack_require__("./packages/design-system/src/utils/noop.ts"),dots_fill_small=__webpack_require__("./packages/design-system/src/icons/dots_fill_small.svg"),menu=__webpack_require__("./packages/design-system/src/components/menu/menu.tsx"),dropDownKeyEvents=__webpack_require__("./packages/story-editor/src/components/panels/utils/dropDownKeyEvents.js");function DeleteDialog({onClose,onDelete}){return(0,jsx_runtime.jsx)(dialog.Z,{isOpen:!0,onClose,title:(0,i18n.__)("Delete Page Template","web-stories"),secondaryText:(0,i18n.__)("Cancel","web-stories"),onPrimary:onDelete,primaryText:(0,i18n.__)("Delete","web-stories"),children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.Small,children:(0,i18n.__)("Are you sure you want to delete this template? This action cannot be undone.","web-stories")})})}DeleteDialog.displayName="DeleteDialog";const deleteDialog=DeleteDialog;var input_input=__webpack_require__("./packages/design-system/src/components/input/input.tsx");const InputWrapper=styled_components_browser_esm.ZP.form.withConfig({displayName:"nameDialog__InputWrapper",componentId:"sc-pqbhqw-0"})(["margin:16px 4px;width:470px;height:100px;"]);function NameDialog({onClose,onSave,title,placeholder,previousInput}){const[templateName,setTemplateName]=(0,react_src.eJ)(previousInput);return(0,jsx_runtime.jsx)(dialog.Z,{isOpen:!0,title,primaryText:(0,i18n.__)("Save","web-stories"),onPrimary:()=>{onSave(templateName)},secondaryText:(0,i18n.__)("Cancel","web-stories"),onSecondary:onClose,onClose,children:(0,jsx_runtime.jsx)(InputWrapper,{onSubmit:e=>{e.preventDefault(),onSave(templateName)},children:(0,jsx_runtime.jsx)(input_input.Z,{onChange:e=>{setTemplateName(e.target.value)},value:templateName,label:(0,i18n.__)("Template name","web-stories"),placeholder,type:"text"})})})}NameDialog.displayName="NameDialog";const nameDialog=NameDialog,dropDownMenu_MoreButton=(0,styled_components_browser_esm.ZP)(panes_shared.Kk).withConfig({displayName:"dropDownMenu__MoreButton",componentId:"sc-xiyx7c-0"})(["top:4px;right:4px;"]),DropDownContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"dropDownMenu__DropDownContainer",componentId:"sc-xiyx7c-1"})(["margin-top:10px;"]),MenuContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"dropDownMenu__MenuContainer",componentId:"sc-xiyx7c-2"})(["z-index:1;"]),menuStylesOverride=(0,styled_components_browser_esm.iv)(["min-width:160px;margin-top:0;li{display:block;}"]),MENU_OPTIONS_RENAME="rename",MENU_OPTIONS_DELETE="delete";function DropDownMenu({display,isMenuOpen,onMenuOpen,onMenuCancelled,onMenuSelected,setParentActive=utils_noop.Z,onDelete,onUpdateName,previousName}){const groups=[{options:[{label:(0,i18n.__)("Rename Template","web-stories"),value:MENU_OPTIONS_RENAME},{label:(0,i18n.__)("Delete Template","web-stories"),value:MENU_OPTIONS_DELETE}]}],[showDeleteDialog,setShowDeleteDialog]=(0,react_src.eJ)(!1),[showRenameDialog,setShowRenameDialog]=(0,react_src.eJ)(!1),moreButtonRef=(0,react_src.sO)(),onClose=(0,react_src.I4)((()=>{onMenuCancelled(),moreButtonRef.current?.focus(),setParentActive()}),[onMenuCancelled,setParentActive]),onDeleteDialogClose=(0,react_src.I4)((()=>{setShowDeleteDialog(!1),onClose()}),[setShowDeleteDialog,onClose]),onRenameDialogClose=(0,react_src.I4)((()=>{setShowRenameDialog(!1),onClose()}),[setShowRenameDialog,onClose]),listId=(0,react_src.Ye)((()=>`list-${(0,v4.Z)()}`),[]),buttonId=(0,react_src.Ye)((()=>`button-${(0,v4.Z)()}`),[]);return(0,jsx_runtime.jsxs)(MenuContainer,{children:[moreButtonRef.current&&(0,jsx_runtime.jsx)(dropDownKeyEvents.Z,{target:moreButtonRef.current}),(0,jsx_runtime.jsx)(dropDownMenu_MoreButton,{ref:moreButtonRef,onClick:onMenuOpen,"aria-label":(0,i18n.__)("More","web-stories"),"aria-pressed":isMenuOpen,"aria-haspopup":!0,"aria-expanded":isMenuOpen,"aria-owns":isMenuOpen?listId:null,id:buttonId,$display:display,tabIndex:display||isMenuOpen?0:-1,children:(0,jsx_runtime.jsx)(dots_fill_small.Z,{})}),(display||isMenuOpen)&&(0,jsx_runtime.jsx)(popup.Z,{anchor:moreButtonRef,placement:popup_constants.ug.BottomStart,isOpen:isMenuOpen,children:(0,jsx_runtime.jsx)(DropDownContainer,{children:(0,jsx_runtime.jsx)(menu.Z,{parentId:buttonId,listId,handleMenuItemSelect:(evt,value)=>{switch(evt.stopPropagation(),onMenuSelected(),value){case MENU_OPTIONS_RENAME:setShowRenameDialog(!0);break;case MENU_OPTIONS_DELETE:setShowDeleteDialog(!0)}},groups,onDismissMenu:onClose,hasMenuRole:!0,menuStylesOverride})})}),showDeleteDialog&&(0,jsx_runtime.jsx)(deleteDialog,{onClose:onDeleteDialogClose,onDelete}),showRenameDialog&&(0,jsx_runtime.jsx)(nameDialog,{onClose:onRenameDialogClose,onSave:name=>{onUpdateName(name),onRenameDialogClose()},title:(0,i18n.__)("Rename Page Template","web-stories"),placeholder:previousName||(0,i18n.__)("Untitled","web-stories"),previousInput:previousName||""})]})}DropDownMenu.displayName="DropDownMenu";const dropDownMenu=DropDownMenu,TemplateImage=styled_components_browser_esm.ZP.img.withConfig({displayName:"savedPageTemplate__TemplateImage",componentId:"sc-5hfe38-0"})(["width:100%;height:auto;"]),savedPageTemplate_PageTemplateWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"savedPageTemplate__PageTemplateWrapper",componentId:"sc-5hfe38-1"})(["position:relative;height:","px;width:","px;cursor:pointer;",";",";"],(({pageSize})=>pageSize.height),(({pageSize})=>pageSize.width),(({isHighlighted})=>isHighlighted&&outline.R),shared_styles.j);savedPageTemplate_PageTemplateWrapper.propTypes={pageSize:propTypes.go.isRequired};const PreviewPageWrapper=styled_components_browser_esm.ZP.button.withConfig({displayName:"savedPageTemplate__PreviewPageWrapper",componentId:"sc-5hfe38-2"})(["position:relative;padding:0;border:0;height:100%;width:100%;background-color:",";border-radius:",";overflow:hidden;",""],(({theme})=>theme.colors.interactiveBg.secondary),(({theme})=>theme.borders.radius.small),(({background})=>(0,generatePatternStyles.Z)(background)));PreviewPageWrapper.propTypes={pageSize:propTypes.go.isRequired};const ElementsWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"savedPageTemplate__ElementsWrapper",componentId:"sc-5hfe38-3"})(["z-index:10;"]),TemplateInsertionOverlay=(0,styled_components_browser_esm.ZP)(insertionOverlay.Z).withConfig({displayName:"savedPageTemplate__TemplateInsertionOverlay",componentId:"sc-5hfe38-4"})(["z-index:11;"]),savedPageTemplate_TemplateTitleContainer=(0,styled_components_browser_esm.ZP)(panes_shared.vO).withConfig({displayName:"savedPageTemplate__TemplateTitleContainer",componentId:"sc-5hfe38-5"})(["opacity:",";"],(({isActive})=>isActive?1:0));function SavedPageTemplate({page,pageSize,handleDelete,index,title,highlightedTemplate,onClick},ref){const{capabilities:{hasUploadMediaAction}}=(0,app_config.ZR)(),{actions:{updatePageTemplate}}=(0,api.Ek)(),{actions:{uploadFile}}=(0,uploader.J)(),{showSnackbar}=(0,useSnackbar.D)(),{updateSavedTemplate}=library_useLibrary((state=>({updateSavedTemplate:state.actions.updateSavedTemplate}))),queuePageImageGeneration=pageDataUrls_usePageDataUrls((({actions})=>actions.queuePageImageGeneration)),pageDataUrl=pageDataUrls_usePageDataUrls((({state:{dataUrls}})=>dataUrls[page.id]))||page.pregeneratedPageDataUrl,[isActive,setIsActive]=(0,react_src.eJ)(!1),[isMenuOpen,setIsMenuOpen]=(0,react_src.eJ)(!1),onMenuOpen=(0,react_src.I4)((e=>{e.stopPropagation(),setIsMenuOpen(!0),setIsActive(!1)}),[]),onMenuCancelled=(0,react_src.I4)((()=>{setIsMenuOpen(!1),setIsActive(!1)}),[]),onMenuSelected=(0,react_src.I4)((()=>{setIsMenuOpen(!1),setIsActive(!1)}),[]);(0,react_src.FR)(ref,(()=>setIsActive(!1)),[]);const makeActive=(0,react_src.I4)((()=>setIsActive(!0)),[]),makeInactive=(0,react_src.I4)((()=>{setIsActive(!1)}),[]),updateTemplateName=(0,react_src.I4)((async newName=>{try{const res=await updatePageTemplate(page.templateId,{title:newName});updateSavedTemplate({templateId:page.templateId,title:res.title}),setIsMenuOpen(!1),setIsActive(!1),showSnackbar({message:(0,i18n.__)("Page Template renamed.","web-stories"),dismissible:!0})}catch{showSnackbar({message:(0,i18n.__)("Unable to rename the template. Please try again.","web-stories"),dismissible:!0})}}),[updatePageTemplate,updateSavedTemplate,page.templateId,showSnackbar]),imageUrl=page.image?.url||pageDataUrl,shouldPostBlob=hasUploadMediaAction&&pageDataUrl&&!page.image?.url;(0,react_src.d4)((()=>{shouldPostBlob&&(async()=>{try{const blob=await(0,fetchRemoteBlob.Z)(pageDataUrl),file=(0,blobToFile.Z)(blob,`web-stories-page-template-${page.templateId}.jpg`,"image/jpeg"),resource=await uploadFile(file,{templateId:page.templateId,mediaSource:"page-template"});await updatePageTemplate(page.templateId,{featured_media:resource.id}),updateSavedTemplate({templateId:page.templateId,image:{id:resource.id,height:resource.height,width:resource.width,url:resource.src}})}catch(err){(0,tracking_src.tz)("upload_generated_page_template_image",err?.message)}})()}),[pageDataUrl,uploadFile,updatePageTemplate,page.templateId,shouldPostBlob,updateSavedTemplate]),(0,react_src.d4)((()=>{!imageUrl&&hasUploadMediaAction&&queuePageImageGeneration(page)}),[imageUrl,queuePageImageGeneration,page,hasUploadMediaAction]);const insertButtonRef=(0,react_src.sO)();return(0,useRovingTabIndex.Z)({ref:insertButtonRef},[],2),(0,jsx_runtime.jsxs)(savedPageTemplate_PageTemplateWrapper,{pageSize,role:"listitem",ref,onPointerEnter:makeActive,onPointerLeave:makeInactive,"aria-label":title,isHighlighted:page.id===highlightedTemplate,onFocus:makeActive,onBlur:makeInactive,children:[(0,jsx_runtime.jsxs)(PreviewPageWrapper,{pageSize,background:page.backgroundColor,onClick,children:[imageUrl?(0,jsx_runtime.jsx)(TemplateImage,{alt:page.image?.alt||(0,i18n.__)("Saved Page Template","web-stories"),src:imageUrl,crossOrigin:"anonymous",height:page.image?.height,width:page.image?.height,draggable:!1}):(0,jsx_runtime.jsx)(ElementsWrapper,{children:(0,jsx_runtime.jsx)(unitsProvider.Z,{pageSize:{height:pageSize.height,width:pageSize.width},children:page.elements.map((element=>(0,jsx_runtime.jsx)(displayElement.Z,{previewMode:!0,element},element.id)))})}),isActive&&(0,jsx_runtime.jsx)(TemplateInsertionOverlay,{showIcon:!1}),(0,jsx_runtime.jsx)(savedPageTemplate_TemplateTitleContainer,{isActive,children:(0,jsx_runtime.jsx)(typography_text.x.Span,{size:types.TextSize.Small,children:title||(0,i18n.__)("Untitled","web-stories")})})]}),(0,jsx_runtime.jsx)(panes_shared.Kk,{ref:insertButtonRef,onClick:e=>{e.stopPropagation(),onClick(e)},"aria-label":(0,i18n.__)("Use template","web-stories"),$display:isActive,tabIndex:0===index?0:-1,children:(0,jsx_runtime.jsx)(plus_filled_small.Z,{})}),(0,jsx_runtime.jsx)(dropDownMenu,{display:isActive,isMenuOpen,onMenuOpen,onMenuCancelled,onMenuSelected,onDelete:()=>{handleDelete(page.templateId)},previousName:title,onUpdateName:updateTemplateName})]})}SavedPageTemplate.displayName="SavedPageTemplate";const PageTemplateWithRef=(0,react_src.Gp)(SavedPageTemplate);SavedPageTemplate.displayName="SavedPageTemplate";const savedPageTemplate=PageTemplateWithRef,WrapperGrid=styled_components_browser_esm.ZP.div.withConfig({displayName:"templateList__WrapperGrid",componentId:"sc-1ukppvz-0"})(["display:grid;width:100%;margin-left:",";margin-bottom:12px;gap:12px;grid-template-columns:",";grid-template-rows:",";"],panes_shared.gf,(({columnWidth})=>`repeat(auto-fit, ${columnWidth}px)`),(({rowHeight})=>`repeat(minmax(${rowHeight}px, 1fr))`));function TemplateList({pages,parentRef,pageSize,handleDelete,fetchTemplates,...rest}){const{addPage}=(0,app_story.rB)((({actions})=>({addPage:actions.addPage}))),{isRTL}=(0,app_config.ZR)(),{showSnackbar}=(0,useSnackbar.D)(),[currentPageId,setCurrentPageId]=(0,react_src.eJ)(),containerRef=(0,react_src.sO)(),pageRefs=(0,react_src.sO)({}),handlePageClick=(0,react_src.I4)((({templateId,version,title,...page})=>{const duplicatedPage=(0,elements_src.Fl)(page);addPage({page:duplicatedPage}),(0,tracking_src.L9)("insert_page_template",{name:title||"custom"}),showSnackbar({message:(0,i18n.__)("Page Template added.","web-stories"),dismissible:!0})}),[addPage,showSnackbar]),handleFocus=(0,react_src.I4)((id=>{setCurrentPageId(id)}),[]),isSavedTemplates=handleDelete||fetchTemplates;return(0,react_src.d4)((()=>{pages.length>0&&(currentPageId&&pages.some((page=>page.id===currentPageId))||setCurrentPageId(pages[0].id))}),[currentPageId,pages]),(0,react_src.d4)((()=>{fetchTemplates?.()}),[fetchTemplates]),(0,useGridViewKeys.Z)({containerRef:parentRef,gridRef:containerRef,itemRefs:pageRefs,items:pages,currentItemId:currentPageId,isRTL}),(0,jsx_runtime.jsx)(WrapperGrid,{ref:containerRef,columnWidth:pageSize.width,rowHeight:pageSize.containerHeight,role:"list","aria-label":(0,i18n.__)("Page Template Options","web-stories"),children:isSavedTemplates?pages.map(((page,index)=>(0,jsx_runtime.jsx)(savedPageTemplate,{"data-testid":`page_template_${page.id}`,ref:el=>pageRefs.current[page.id]=el,page,pageSize,onClick:()=>handlePageClick(page),handleDelete,onFocus:()=>handleFocus(page.id),index,title:page?.title?.raw,...rest},page.id))):pages.map((page=>(0,jsx_runtime.jsx)(defaultPageTemplate,{ref:el=>pageRefs.current[page.id]=el,"data-testid":`page_template_${page.id}`,page,pageSize,onFocus:()=>handleFocus(page.id),isActive:currentPageId===page.id,onClick:()=>handlePageClick(page.story),columnWidth:pageSize.width,...rest},page.id)))})}TemplateList.displayName="TemplateList";const templateList=TemplateList,ActionRow=styled_components_browser_esm.ZP.div.withConfig({displayName:"defaultTemplates__ActionRow",componentId:"sc-14vj9wc-0"})(["display:flex;justify-content:space-between;margin:0px 16px 22px 16px;"]),PageTemplatesParentContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"defaultTemplates__PageTemplatesParentContainer",componentId:"sc-14vj9wc-1"})(["",";margin-top:26px;overflow-x:hidden;overflow-y:scroll;"],virtualPaneContainer),SearchInputContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"defaultTemplates__SearchInputContainer",componentId:"sc-14vj9wc-2"})(["padding:0 ",";margin-bottom:26px;"],panes_shared.gf),defaultTemplates_Message=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Medium}).withConfig({displayName:"defaultTemplates__Message",componentId:"sc-14vj9wc-3"})(["color:",";padding:1em;text-align:center;"],(({theme})=>theme.colors.fg.secondary));const defaultTemplates=function DefaultTemplates({pageSize}){const{actions:{getPageTemplates}}=(0,api.Ek)(),[pageTemplates,setPageTemplates]=(0,react_src.eJ)([]),[isLoading,setIsLoading]=(0,react_src.eJ)(!1),[searchTerm,setSearchTerm]=(0,react_src.eJ)("");(0,react_src.d4)((()=>{!async function loadPageTemplates(){setIsLoading(!0);const trackTiming=(0,tracking_src.fR)("load_page_templates");setPageTemplates(await getPageTemplates(searchTerm)),setIsLoading(!1),trackTiming()}()}),[getPageTemplates,setPageTemplates,searchTerm]);const pageTemplatesParentRef=(0,react_src.sO)(),[selectedPageTemplateType,setSelectedPageTemplateType]=(0,react_src.eJ)(null),pills=(0,react_src.Ye)((()=>[{id:null,label:(0,i18n._x)("All","page templates","web-stories")},...Object.entries(PAGE_TEMPLATE_TYPES).map((([key,{name}])=>({id:key,label:name})))]),[]),filteredPages=(0,react_src.Ye)((()=>pageTemplates.reduce(((pages,template)=>[...pages,...Object.values(template.postersByPage).map(((poster,index)=>({id:`${template.slug}_${index}`,title:template.title,story:template.pages[index],...poster}))).reduce(((acc,posterByPage)=>!posterByPage.type||selectedPageTemplateType&&posterByPage.type!==selectedPageTemplateType?acc:[...acc,posterByPage]),[])]),[])),[pageTemplates,selectedPageTemplateType]),handleSelectPageTemplateType=(0,react_src.I4)((key=>{setSelectedPageTemplateType(key),(0,tracking_src.L9)("search",{search_type:"page_templates",search_term:"",search_category:key})}),[]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SearchInputContainer,{children:(0,jsx_runtime.jsx)(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch:setSearchTerm,disabled:!1})}),(0,jsx_runtime.jsx)(panes_shared.Zn,{items:pills,selectedItemId:selectedPageTemplateType,selectItem:handleSelectPageTemplateType,deselectItem:()=>handleSelectPageTemplateType(null)}),(0,jsx_runtime.jsxs)(PageTemplatesParentContainer,{ref:pageTemplatesParentRef,tabIndex:-1,children:[(0,jsx_runtime.jsx)(ActionRow,{children:(0,jsx_runtime.jsx)(headline.s,{as:"h2",size:types.TextSize.XXXSmall,children:(0,i18n.__)("Templates","web-stories")})}),isLoading||!pageTemplatesParentRef.current?(0,jsx_runtime.jsx)(panes_shared.ly,{children:(0,jsx_runtime.jsx)(loadingSpinner.Z,{animationSize:64,numCircles:8})}):0===pageTemplates.length?(0,jsx_runtime.jsx)(defaultTemplates_Message,{children:(0,i18n.__)("No page templates found.","web-stories")}):(0,jsx_runtime.jsx)(templateList,{pageSize,parentRef:pageTemplatesParentRef,pages:filteredPages})]})]})},savedTemplates_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"savedTemplates__Wrapper",componentId:"sc-1bm5y87-0"})(["height:100%;padding-top:5px;overflow-y:scroll;overflow-x:hidden;min-height:96px;"]);function SavedTemplates({searchTerm,setSearchTerm,pageSize,loadTemplates,isLoading,...rest}){const{actions:{deletePageTemplate}}=(0,api.Ek)(),{savedTemplates,setSavedTemplates,nextTemplatesToFetch}=library_useLibrary((state=>({savedTemplates:state.state.savedTemplates,nextTemplatesToFetch:state.state.nextTemplatesToFetch,setSavedTemplates:state.actions.setSavedTemplates}))),{showSnackbar}=(0,useSnackbar.D)(),ref=(0,react_src.sO)(),[,update]=(0,react_src.eJ)(null);(0,react_src.bt)((()=>{update(!1)}),[]);const fetchTemplates=(0,react_src.I4)((()=>{nextTemplatesToFetch&&loadTemplates()}),[nextTemplatesToFetch,loadTemplates]),handleDelete=(0,react_src.I4)((async id=>{try{await deletePageTemplate(id),setSavedTemplates(savedTemplates.filter((({templateId})=>templateId!==id))),showSnackbar({message:(0,i18n.__)("Page Template deleted.","web-stories"),dismissable:!0})}catch{showSnackbar({message:(0,i18n.__)("Unable to delete the template. Please try again.","web-stories"),dismissible:!0})}}),[deletePageTemplate,savedTemplates,showSnackbar,setSavedTemplates]);return(0,jsx_runtime.jsx)(savedTemplates_Wrapper,{ref,tabIndex:-1,children:!isLoading&&ref.current?(0,jsx_runtime.jsx)(templateList,{parentRef:ref,pageSize,pages:savedTemplates,handleDelete,fetchTemplates,...rest}):(0,jsx_runtime.jsx)(panes_shared.ly,{children:(0,jsx_runtime.jsx)(loadingSpinner.Z,{animationSize:64,numCircles:8})})})}SavedTemplates.displayName="SavedTemplates";const pageTemplates_savedTemplates=SavedTemplates,utils_isDefaultPage=page=>{if(page.elements.length>1)return!1;const defaultPage=(0,elements_src.D4)();if("color"in page.backgroundColor&&"color"in defaultPage.backgroundColor&&!(0,react_src.wU)(page.backgroundColor.color,defaultPage.backgroundColor.color))return!1;const backgroundElement=page.elements.find((e=>elements_src.Zy.backgroundable(e)&&e.isBackground));return!!(!backgroundElement||elements_src.Zy.defaultBackground(backgroundElement)&&backgroundElement.isDefaultBackground)};const utils_createThumbnailCanvasFromFullbleedCanvas=function createThumbnailCanvasFromFullbleedCanvas(fullbleedCanvas){const thumbnailCanvas=document.createElement("canvas"),thumbnailContext=thumbnailCanvas.getContext("2d"),fullbleedHeight=Number(fullbleedCanvas.height),thumbnailHeight=Number(fullbleedCanvas.width)/src_constants.O1,dy=(fullbleedHeight-thumbnailHeight)/2;return thumbnailCanvas.width=fullbleedCanvas.width,thumbnailCanvas.height=thumbnailHeight,thumbnailContext&&thumbnailContext.drawImage(fullbleedCanvas,0,-dy),thumbnailCanvas};var _path,_path2,_path3;function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const SvgIllustration=({title,titleId,...props})=>react.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 43","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,_path||(_path=react.createElement("path",{fill:"#767E80",d:"M21.903 0H4a4 4 0 0 0-4 4v34.4a4 4 0 0 0 4 4h24a4 4 0 0 0 4-4V10.03a4 4 0 0 0-1.187-2.844l-6.097-6.03A4 4 0 0 0 21.903 0"})),_path2||(_path2=react.createElement("path",{fill:"#ADB1B3",d:"m30.146 8.146-5.893-5.893a.5.5 0 0 0-.853.354V8.5a.5.5 0 0 0 .5.5h5.893a.5.5 0 0 0 .353-.854"})),_path3||(_path3=react.createElement("path",{fill:"#E4E5E6",fillRule:"evenodd",d:"M16 29a8 8 0 1 0 0-16 8 8 0 0 0 0 16m0-12.469c.535 0 .969.434.969.969v2.531H19.5a.969.969 0 0 1 0 1.938h-2.531V24.5a.969.969 0 0 1-1.938 0v-2.531H12.5a.969.969 0 0 1 0-1.938h2.531V17.5c0-.535.434-.969.969-.969",clipRule:"evenodd"}))),illustration=(0,react.memo)(SvgIllustration),templateSave_StyledText=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).withConfig({displayName:"templateSave__StyledText",componentId:"sc-vcrsmn-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),IconWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"templateSave__IconWrapper",componentId:"sc-vcrsmn-1"})(["width:32px;height:42px;margin-right:29px;"]),SaveButton=styled_components_browser_esm.ZP.button.withConfig({displayName:"templateSave__SaveButton",componentId:"sc-vcrsmn-2"})(["border:0;background:none;height:56px;width:100%;padding:7px;background-color:",";transition:background-color ",";border-radius:",";display:flex;flex-direction:row;align-items:center;cursor:pointer;&:hover{background-color:",";}"," ",";"],(({theme})=>theme.colors.interactiveBg.secondaryNormal),constants.ok,(({theme})=>theme.borders.radius.small),(({theme})=>theme.colors.interactiveBg.secondaryHover),(({$isDisabled,theme})=>$isDisabled&&`\n      cursor: default;\n      background-color: ${theme.colors.interactiveBg.disable};\n      &:hover {\n        background-color: ${theme.colors.interactiveBg.disable};\n      }\n\n      ${IconWrapper} svg {\n        path:nth-child(1): ${theme.colors.fg.disable};\n        path:nth-child(2) {\n          fill: ${theme.colors.fg.tertiary};\n        }\n        path:nth-child(3) {\n          fill: ${theme.colors.fg.secondary};\n        }\n      }\n\n      ${templateSave_StyledText} {\n        color: ${theme.colors.fg.disable};\n      }\n  `),shared_styles.j);const templateSave=function TemplateSave({setShowDefaultTemplates,updateList}){const{actions:{addPageTemplate}}=(0,api.Ek)(),{showSnackbar}=(0,useSnackbar.D)(),{currentPage}=(0,app_story.rB)((({state:{currentPage}})=>({currentPage}))),pageCanvasMap=(0,pageCanvas.CA)((({state})=>state.pageCanvasMap)),isDisabled=(0,react_src.Ye)((()=>currentPage&&utils_isDefaultPage(currentPage)),[currentPage]),[isDialogOpen,setIsDialogOpen]=(0,react_src.eJ)(!1),handleSaveTemplate=(0,react_src.I4)((async templateName=>{if(isDisabled)return;let tmpPageDataUrl;const currentPageCanvas=pageCanvasMap[currentPage.id];if(currentPageCanvas){tmpPageDataUrl=utils_createThumbnailCanvasFromFullbleedCanvas(currentPageCanvas).toDataURL("image/jpeg")}try{const{templateId,...page}=currentPage,addedTemplate=await addPageTemplate({story_data:{...page,id:(0,v4.Z)(),version:migration_src.n},featured_media:undefined,title:""!==templateName?templateName:(0,i18n.__)("Untitled","web-stories")});tmpPageDataUrl&&(addedTemplate.pregeneratedPageDataUrl=tmpPageDataUrl),updateList?.(addedTemplate),showSnackbar({message:(0,i18n.__)("Page Template saved.","web-stories"),dismissable:!0})}catch{showSnackbar({message:(0,i18n.__)("Unable to save the template. Please try again.","web-stories"),dismissable:!0})}setShowDefaultTemplates(!1),setIsDialogOpen(!1)}),[isDisabled,addPageTemplate,currentPage,setShowDefaultTemplates,showSnackbar,updateList,pageCanvasMap]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(SaveButton,{"aria-disabled":isDisabled,onClick:()=>{isDisabled||setIsDialogOpen(!0)},$isDisabled:isDisabled,children:[(0,jsx_runtime.jsx)(IconWrapper,{children:(0,jsx_runtime.jsx)(illustration,{"aria-hidden":!0})}),(0,jsx_runtime.jsx)(templateSave_StyledText,{size:types.TextSize.Small,children:(0,i18n.__)("Save current page as template","web-stories")})]}),isDialogOpen&&(0,jsx_runtime.jsx)(nameDialog,{onClose:()=>{setIsDialogOpen(!1)},onSave:async templateName=>{await handleSaveTemplate(templateName),setIsDialogOpen(!1)},title:(0,i18n.__)("Save Page Template","web-stories"),placeholder:(0,i18n.__)("Untitled","web-stories"),previousInput:""})]})},pageTemplatesPane_SearchInputContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageTemplatesPane__SearchInputContainer",componentId:"sc-hm7mfr-0"})(["padding:0 ",";margin-bottom:26px;"],panes_shared.gf),StyledPane=(0,styled_components_browser_esm.ZP)(panes_shared.X6).withConfig({displayName:"pageTemplatesPane__StyledPane",componentId:"sc-hm7mfr-1"})(["height:100%;padding:0;overflow:hidden;"]),PaneInner=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageTemplatesPane__PaneInner",componentId:"sc-hm7mfr-2"})(["height:100%;display:flex;flex-direction:column;"]),DropDownWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageTemplatesPane__DropDownWrapper",componentId:"sc-hm7mfr-3"})(["text-align:left;margin:28px 16px 17px;"]),pageTemplatesPane_ButtonWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageTemplatesPane__ButtonWrapper",componentId:"sc-hm7mfr-4"})(["padding:0 1em;margin-top:24px;"]),LOCAL_STORAGE_KEY=localStore.h.DEFAULT_VIEW_PAGE_TEMPLATE_LAYOUT,DEFAULT_TEMPLATE_VIEW=localStore.W.getItemByKey(LOCAL_STORAGE_KEY);function PageTemplatesPane(props){const{actions:{getCustomPageTemplates}}=(0,api.Ek)(),{canViewDefaultTemplates}=(0,app_config.ZR)(),supportsCustomTemplates=Boolean(getCustomPageTemplates),{savedTemplates,setSavedTemplates,nextTemplatesToFetch,setNextTemplatesToFetch}=library_useLibrary((state=>({savedTemplates:state.state.savedTemplates,nextTemplatesToFetch:state.state.nextTemplatesToFetch,setSavedTemplates:state.actions.setSavedTemplates,setNextTemplatesToFetch:state.actions.setNextTemplatesToFetch}))),[showDefaultTemplates,setShowDefaultTemplates]=(0,react_src.eJ)(null===DEFAULT_TEMPLATE_VIEW?canViewDefaultTemplates:canViewDefaultTemplates&&DEFAULT_TEMPLATE_VIEW),[highlightedTemplate,setHighlightedTemplate]=(0,react_src.eJ)(null),[searchTerm,setSearchTerm]=(0,react_src.eJ)(""),[isLoading,setIsLoading]=(0,react_src.eJ)(!1),updateTemplatesList=(0,react_src.I4)((page=>{setSavedTemplates((_savedTemplates=>[page,..._savedTemplates||[]])),setHighlightedTemplate(page.id),localStore.W.setItemByKey(LOCAL_STORAGE_KEY,!1)}),[setSavedTemplates]),loadTemplates=(0,react_src.I4)((async()=>{if(nextTemplatesToFetch){setIsLoading(!0);try{const{templates,hasMore}=await getCustomPageTemplates(nextTemplatesToFetch,searchTerm),updatedTemplates=templates.map((({version,templateId,...page})=>{const template={pages:[page]},migratedTemplate=(0,migration_src.T)(template,version||25);return{templateId,version:migration_src.n,...migratedTemplate.pages[0]}}));setSavedTemplates((_savedTemplates=>[..._savedTemplates||[],...updatedTemplates])),setNextTemplatesToFetch(!!hasMore&&nextTemplatesToFetch+1)}catch(err){(0,tracking_src.tz)("saved_templates",err.message),setNextTemplatesToFetch(!1),setSavedTemplates((_savedTemplates=>_savedTemplates??[]))}finally{setIsLoading(!1)}}}),[searchTerm,getCustomPageTemplates,nextTemplatesToFetch,setSavedTemplates,setNextTemplatesToFetch]);(0,react_src.d4)((()=>{savedTemplates||showDefaultTemplates||loadTemplates()}),[loadTemplates,showDefaultTemplates,savedTemplates]),(0,react_src.d4)((()=>{let timeout=null;return highlightedTemplate&&(timeout=setTimeout((()=>{setHighlightedTemplate(null)}),1e3)),()=>clearTimeout(timeout)}),[highlightedTemplate]);const options=[];canViewDefaultTemplates&&options.push({value:"default",label:(0,i18n.__)("Default templates","web-stories")}),supportsCustomTemplates&&options.push({value:"saved",label:(0,i18n.__)("Saved templates","web-stories")});const pageSize=(0,react_src.Ye)((()=>({width:158,height:Math.round(158/src_constants.O1),containerHeight:Math.round(158/src_constants.Sr)})),[]);return(0,jsx_runtime.jsx)(StyledPane,{id:pageTemplates_paneId,...props,children:(0,jsx_runtime.jsxs)(PaneInner,{children:[(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[supportsCustomTemplates&&(0,jsx_runtime.jsx)(pageTemplatesPane_ButtonWrapper,{children:(0,jsx_runtime.jsx)(templateSave,{setShowDefaultTemplates,updateList:updateTemplatesList})}),(0,jsx_runtime.jsx)(DropDownWrapper,{children:options.length>1&&(0,jsx_runtime.jsx)(components_form.Ph,{options,selectedValue:showDefaultTemplates?"default":"saved",onMenuItemClick:(_,menuItem)=>{const value="default"===menuItem;showDefaultTemplates!==value&&(setShowDefaultTemplates("default"===menuItem),localStore.W.setItemByKey(LOCAL_STORAGE_KEY,value))},"aria-label":(0,i18n.__)("Select templates type","web-stories")})})]}),showDefaultTemplates?(0,jsx_runtime.jsx)(defaultTemplates,{pageSize}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(pageTemplatesPane_SearchInputContainer,{children:(0,jsx_runtime.jsx)(searchInput,{initialValue:searchTerm,placeholder:(0,i18n.__)("Search","web-stories"),onSearch:str=>{setSavedTemplates([]),setNextTemplatesToFetch(1),setSearchTerm(str)},disabled:!1})}),(0,jsx_runtime.jsx)(pageTemplates_savedTemplates,{pageSize,highlightedTemplate,loadTemplates,isLoading})]})]})})}PageTemplatesPane.displayName="PageTemplatesPane";const pageTemplatesPane=PageTemplatesPane;var box4_alternate=__webpack_require__("./packages/design-system/src/icons/box4_alternate.svg");function PageTemplatesIcon(){return(0,jsx_runtime.jsx)(box4_alternate.Z,{title:(0,i18n.__)("Page templates library","web-stories")})}PageTemplatesIcon.displayName="PageTemplatesIcon";const pageTemplatesIcon=PageTemplatesIcon;var infiniteScroller=__webpack_require__("./packages/design-system/src/components/infiniteScroller/infiniteScroller.tsx");const shopping_paneId=(0,panes_shared.Qk)("shopping");var productList=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/productList.js"),sort=__webpack_require__("./packages/design-system/src/icons/sort.svg"),media_dropDownMenu=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/dropDownMenu.js");const StyledDropDownMenu=(0,styled_components_browser_esm.ZP)(media_dropDownMenu.Z).withConfig({displayName:"productSort__StyledDropDownMenu",componentId:"sc-1apxa0h-0"})(["margin-left:12px;"]),StyledIcon=(0,styled_components_browser_esm.ZP)(sort.Z).withConfig({displayName:"productSort__StyledIcon",componentId:"sc-1apxa0h-1"})(["width:28px !important;height:28px !important;"]),productSort_menuStylesOverride=(0,styled_components_browser_esm.iv)(["min-width:180px;margin-top:0;"]),options=[{value:"date-desc",orderby:"date",order:"desc",label:(0,i18n.__)("Recently Added","web-stories")},{value:"title-asc",orderby:"title",order:"asc",label:(0,i18n.__)("Alphabetical: A-Z","web-stories")},{value:"title-desc",orderby:"title",order:"desc",label:(0,i18n.__)("Alphabetical: Z-A","web-stories")},{value:"price-asc",orderby:"price",order:"asc",label:(0,i18n.__)("Lowest Price","web-stories")},{value:"price-desc",orderby:"price",order:"desc",label:(0,i18n.__)("Highest Price","web-stories")}];function ProductSort({onChange,value="date-desc"}){const[isMenuOpen,setIsMenuOpen]=(0,react_src.eJ)(!1),onMenuSelected=(0,react_src.I4)((newValue=>{setIsMenuOpen(!1),onChange(options.find((option=>option.value===newValue)))}),[onChange]),optionsWithGroup=[{options}];return(0,jsx_runtime.jsx)(StyledDropDownMenu,{onMenuOpen:()=>setIsMenuOpen(!0),isMenuOpen,onMenuSelected,display:!0,onMenuClose:()=>setIsMenuOpen(!1),groups:optionsWithGroup,ariaLabel:(0,i18n.__)("Product sort options","web-stories"),activeValue:value,dropDownHeight:340,menuStylesOverride:productSort_menuStylesOverride,children:(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Sort","web-stories"),children:(0,jsx_runtime.jsx)(StyledIcon,{})})})}ProductSort.displayName="ProductSort";const productSort=ProductSort;var shopping_constants=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/constants.js");const LoadingContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"shoppingPane__LoadingContainer",componentId:"sc-14o47kz-0"})(["display:flex;justify-content:center;"]),HelperText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"shoppingPane__HelperText",componentId:"sc-14o47kz-1"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),loadingSpinnerProps={animationSize:25,circleSize:3};function ShoppingPane(props){const{showSnackbar}=(0,useSnackbar.D)(),{shoppingProvider}=(0,app.ZR)(),speak=(0,useLiveRegion.Z)("assertive"),{actions:{getProducts}}=(0,app.Ek)(),{currentPageProducts,deleteElementById,currentPageNumber}=(0,app_story.rB)((({actions,state:{currentPage,currentPageNumber}})=>({currentPageProducts:currentPage?.elements?.filter((({type})=>type===elements_src.Yj.PRODUCT)).map((({id,product})=>({elementId:id,product}))),deleteElementById:actions.deleteElementById,currentPageNumber}))),{insertElement}=library_useLibrary((state=>({insertElement:state.actions.insertElement}))),[loaded,setLoaded]=(0,react_src.eJ)(!1),[isLoading,setIsLoading]=(0,react_src.eJ)(!1),[canLoadMore,setCanLoadMore]=(0,react_src.eJ)(!1),[searchTerm,setSearchTerm]=(0,react_src.eJ)(""),[page,setPage]=(0,react_src.eJ)(1),[orderby,setOrderby]=(0,react_src.eJ)("date"),[order,setOrder]=(0,react_src.eJ)("desc"),[isMenuFocused,setIsMenuFocused]=(0,react_src.eJ)(!1),[products,setProducts]=(0,react_src.eJ)([]),searchProducts=(0,react_src.I4)((async(value="",_page=1,sortBy,sortOrder)=>{setIsLoading(!0),setPage(_page),1===_page&&setLoaded(!1);try{const{products:_products,hasNextPage}=await getProducts(value,_page,sortBy,sortOrder),newProducts=1===_page?_products:[...products,..._products];setProducts(newProducts),setCanLoadMore(hasNextPage)}catch(err){(0,tracking_src.tz)("search_products",err?.message),showSnackbar({message:err.message}),1===_page&&(setProducts([]),setPage(1)),setCanLoadMore(!1)}finally{setIsLoading(!1),setLoaded(!0)}}),[getProducts,products,showSnackbar]),searchProductsWithTelemetry=(0,react_src.I4)(((value="",_page,sortBy,sortOrder)=>{searchProducts(value,_page,sortBy,sortOrder),(0,tracking_src.L9)("search",{search_type:"products",search_term:value,search_order:sortOrder,search_orderby:sortBy,search_provider:shoppingProvider})}),[searchProducts,shoppingProvider]),debouncedProductsQuery=(0,react_src.y1)(searchProductsWithTelemetry,300),onSearch=(0,react_src.I4)((evt=>{const value=evt.target.value;value!==searchTerm&&(setSearchTerm(value),debouncedProductsQuery(value,1,orderby,order))}),[debouncedProductsQuery,order,orderby,searchTerm]),isShoppingEnabled="none"!==shoppingProvider;(0,react_src.d4)((()=>{isShoppingEnabled&&searchProducts(searchTerm,page,orderby,order)}),[isShoppingEnabled]);const numProducts=products.length;(0,react_src.d4)((()=>{isShoppingEnabled||0!==numProducts||(setProducts(currentPageProducts?.map((({product})=>product))),setIsLoading(!1),setLoaded(!0))}),[currentPageProducts,isShoppingEnabled,numProducts]);const onSortBy=(0,react_src.I4)((option=>{setOrderby(option.orderby),setOrder(option.order),debouncedProductsQuery(searchTerm,1,option.orderby,option.order)}),[debouncedProductsQuery,searchTerm]),handleInputKeyPress=(0,react_src.I4)((event=>{const{key}=event;"ArrowDown"!==key&&"Tab"!==key||setIsMenuFocused(!0)}),[]),insertProduct=(0,react_src.I4)((product=>{insertElement(elements_src.Yj.PRODUCT,{width:shopping_constants.t,height:shopping_constants.a,product}),(0,tracking_src.L9)("insert_product",{page:currentPageNumber,provider:shoppingProvider});const PRODUCT_ADDED_TEXT=(0,sprintf.Z)((0,i18n.__)("%s added to page","web-stories"),product.productTitle);speak(PRODUCT_ADDED_TEXT)}),[insertElement,speak,currentPageNumber,shoppingProvider]),deleteProduct=(0,react_src.I4)((product=>{const element=currentPageProducts.find((item=>item.product.productId===product.productId));if(element){deleteElementById({elementId:element.elementId});const PRODUCT_REMOVED_TEXT=(0,sprintf.Z)((0,i18n.__)("%s removed","web-stories"),product?.productTitle);speak(PRODUCT_REMOVED_TEXT)}}),[deleteElementById,currentPageProducts,speak]),onClick=(0,react_src.I4)(((product,onPage)=>onPage?deleteProduct(product):insertProduct(product)),[deleteProduct,insertProduct]),handleClearInput=(0,react_src.I4)((()=>{setSearchTerm(""),debouncedProductsQuery("",1,orderby,order)}),[debouncedProductsQuery,order,orderby]),onLoadMore=(0,react_src.I4)((()=>{canLoadMore&&searchProducts(searchTerm,page+1,orderby,order)}),[canLoadMore,searchProducts,order,orderby,page,searchTerm]),allDataLoadedMessage=page>1?(0,i18n.__)("No more products","web-stories"):"";return(0,jsx_runtime.jsx)(panes_shared.X6,{id:shopping_paneId,...props,children:(0,jsx_runtime.jsxs)(Section,{"data-testid":"products-library-pane",title:(0,i18n.__)("Products","web-stories"),children:[(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(HelperText,{children:(0,i18n.__)("This will add products as a tappable dot on your story.","web-stories")})}),isShoppingEnabled&&(0,jsx_runtime.jsxs)(components_form.X2,{children:[(0,jsx_runtime.jsx)(input.Z,{"aria-label":(0,i18n.__)("Product search","web-stories"),inputValue:searchTerm,onChange:onSearch,placeholder:(0,i18n.__)("Search","web-stories"),onKeyDown:handleInputKeyPress,onFocus:()=>setIsMenuFocused(!1),isOpen:!0,ariaClearLabel:(0,i18n.__)("Clear product search","web-stories"),clearId:"clear-product-search",handleClearInput}),(0,jsx_runtime.jsx)(productSort,{onChange:onSortBy,value:`${orderby}-${order}`})]}),!loaded&&isLoading&&(0,jsx_runtime.jsx)(LoadingContainer,{children:(0,jsx_runtime.jsx)(loadingSpinner.Z,{...loadingSpinnerProps})}),loaded&&products?.length>0&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(productList.Z,{isMenuFocused,onClick,products,onPageProducts:currentPageProducts}),(0,jsx_runtime.jsx)(infiniteScroller.Z,{allDataLoadedMessage,allDataLoadedAriaMessage:(0,i18n.__)("Products are loaded","web-stories"),onLoadMore,canLoadMore,isLoading,loadingSpinnerProps,loadingAriaMessage:(0,i18n.__)("Loading more products","web-stories")})]}),loaded&&!isLoading&&0===products?.length&&(0,jsx_runtime.jsx)(HelperText,{children:(0,i18n.__)("No products found.","web-stories")})]})})}ShoppingPane.displayName="ShoppingPane";const shoppingPane=ShoppingPane;var shopping=__webpack_require__("./packages/design-system/src/icons/shopping.svg");function ShoppingIcon(){return(0,jsx_runtime.jsx)(shopping.Z,{title:(0,i18n.__)("Shopping library","web-stories")})}ShoppingIcon.displayName="ShoppingIcon";const shoppingIcon=ShoppingIcon;var paneIds=__webpack_require__("./packages/story-editor/src/components/library/paneIds.ts");const MEDIA={icon:mediaIcon,tooltip:(0,i18n.__)("Media","web-stories"),placement:popup_constants.ug.BottomStart,Pane:mediaPane,id:paneIds.h.Media},MEDIA3P={icon:media3pIcon,tooltip:(0,i18n.__)("Third-party media","web-stories"),Pane:media3pPane,id:paneIds.h.Media3p},TEXT={icon:textIcon,tooltip:(0,i18n.__)("Text","web-stories"),Pane:textPane,id:paneIds.h.Text},SHAPES={icon:shapesIcon,tooltip:(0,i18n.__)("Shapes & Stickers","web-stories"),Pane:shapesPane,id:paneIds.h.Shapes},PAGE_TEMPLATES={icon:pageTemplatesIcon,tooltip:(0,i18n.__)("Page Templates","web-stories"),Pane:pageTemplatesPane,id:paneIds.h.PageTemplates},SHOPPING={icon:shoppingIcon,tooltip:(0,i18n.__)("Shopping","web-stories"),Pane:shoppingPane,id:paneIds.h.Shopping},LIBRARY_TAB_IDS=new Set([MEDIA,MEDIA3P,PAGE_TEMPLATES,SHAPES,TEXT,SHOPPING].map((tab=>tab.id)));function LibraryProvider({children}){const{showMedia3p,shoppingProvider,canViewDefaultTemplates}=(0,app.ZR)(),{actions:{getMedia,getCustomPageTemplates}}=(0,app.Ek)(),{hasProducts}=(0,app.rB)((({state:{currentPage}})=>({hasProducts:currentPage?.elements?.some((({type})=>type===elements_src.Yj.PRODUCT))}))),isShoppingEnabled=shoppingProvider&&"none"!==shoppingProvider||hasProducts,supportsCustomTemplates=Boolean(getCustomPageTemplates),showPageTemplates=canViewDefaultTemplates||supportsCustomTemplates,showMedia=Boolean(getMedia),[textSets,setTextSets]=(0,react_src.eJ)({}),[areTextSetsLoading,setAreTextSetsLoading]=(0,react_src.eJ)({}),[savedTemplates,_setSavedTemplates]=(0,react_src.eJ)(null),[nextTemplatesToFetch,setNextTemplatesToFetch]=(0,react_src.eJ)(1),[shouldUseSmartColor,setShouldUseSmartColor]=(0,react_src.eJ)(!1),setSavedTemplates=(0,react_src.I4)((t=>_setSavedTemplates((_savedTemplates=>(0,uniqueEntriesByKey.Z)("function"==typeof t?t(_savedTemplates):t,"templateId")))),[]),updateSavedTemplate=(0,react_src.I4)((template=>{_setSavedTemplates((_savedTemplates=>_savedTemplates.map((t=>t.templateId===template.templateId?{...t,...template}:t))))}),[]),tabs=(0,react_src.Ye)((()=>[showMedia&&MEDIA,showMedia3p&&MEDIA3P,TEXT,SHAPES,isShoppingEnabled&&SHOPPING,showPageTemplates&&PAGE_TEMPLATES].filter(Boolean)),[showMedia3p,showMedia,showPageTemplates,isShoppingEnabled]),[tab,setTab]=(0,react_src.eJ)(tabs[0].id),insertElement=(0,canvas.OG)(),{insertTextSet,insertTextSetByOffset}=(0,canvas.GE)(shouldUseSmartColor),{highlightedTab}=(0,highlights.QM)((({section:highlightedTab})=>({highlightedTab})));(0,react_src.d4)((()=>{LIBRARY_TAB_IDS.has(highlightedTab)&&(setTab(highlightedTab),(0,tracking_src.L9)("quick_action_tab_change",{name:highlightedTab}))}),[highlightedTab]);const mediaTabRef=(0,react_src.sO)(null),media3pTabRef=(0,react_src.sO)(null),textTabRef=(0,react_src.sO)(null),shapesTabRef=(0,react_src.sO)(null),pageTemplatesTabRef=(0,react_src.sO)(null),shoppingRef=(0,react_src.sO)(null),tabRefs=(0,react_src.Ye)((()=>({[MEDIA.id]:mediaTabRef,[MEDIA3P.id]:media3pTabRef,[TEXT.id]:textTabRef,[SHAPES.id]:shapesTabRef,[PAGE_TEMPLATES.id]:pageTemplatesTabRef,[SHOPPING.id]:shoppingRef})),[]),state=(0,react_src.Ye)((()=>({state:{areTextSetsLoading,tab,tabRefs,textSets,savedTemplates,nextTemplatesToFetch,shouldUseSmartColor},actions:{setTab,insertElement,insertTextSet,insertTextSetByOffset,setSavedTemplates,updateSavedTemplate,setNextTemplatesToFetch,setShouldUseSmartColor},data:{tabs}})),[areTextSetsLoading,tab,tabRefs,textSets,savedTemplates,insertElement,insertTextSet,insertTextSetByOffset,tabs,nextTemplatesToFetch,setNextTemplatesToFetch,shouldUseSmartColor,setSavedTemplates,updateSavedTemplate]);return(0,react_src.d4)((()=>{let mounted=!0;return tab!==TEXT.id||Object.keys(textSets).length||async function getTextSets(){const trackTiming=(0,tracking_src.fR)("load_text_sets");setAreTextSetsLoading(!0);const newTextSets=await async function loadTextSets(){const textSets={};return await Promise.all(Object.values(TextSetType).map((async name=>{textSets[name]=await loadTextSet(name)}))),textSets}();trackTiming(),mounted&&(setTextSets(newTextSets),setAreTextSetsLoading(!1))}(),()=>{mounted=!1}}),[tab,textSets]),(0,react_src.d4)((()=>{tab!==SHOPPING.id||isShoppingEnabled||setTab(tabs[0].id)}),[isShoppingEnabled,tab,tabs]),(0,jsx_runtime.jsx)(library_context.Provider,{value:state,children})}LibraryProvider.displayName="LibraryProvider";const libraryProvider=LibraryProvider;var components_mediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/index.js");const MediaButton=()=>{const{onSelect}=local_useOnMediaSelect();return(0,jsx_runtime.jsx)(components_form.Y8,{renderButton:open=>(0,jsx_runtime.jsx)(components_button.Z,{onClick:open,children:constants_RIGHT_CLICK_MENU_LABELS.UPLOAD_IMAGE_OR_VIDEO}),onInsert:onSelect})};MediaButton.displayName="MediaButton";const emptyStateMenu=function EmptyStateMenu(){const{setHighlights}=(0,highlights.QM)((({setHighlights})=>({setHighlights}))),{toggleRecordingMode}=(0,components_mediaRecording._T)((({actions})=>({toggleRecordingMode:actions.toggleRecordingMode}))),{isTranscodingEnabled}=(0,useFFmpeg.Z)();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>{setHighlights({highlight:highlights.$q.Media})},children:constants_RIGHT_CLICK_MENU_LABELS.CHOOSE_IMAGE_OR_VIDEO}),(0,jsx_runtime.jsx)(libraryProvider,{children:(0,jsx_runtime.jsx)(MediaButton,{})}),isTranscodingEnabled&&(0,jsx_runtime.jsx)(components_button.Z,{onClick:toggleRecordingMode,children:constants_RIGHT_CLICK_MENU_LABELS.RECORD_VIDEO}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>{setHighlights({highlight:highlights.$q.PageTemplates})},children:constants_RIGHT_CLICK_MENU_LABELS.BROWSE_PAGE_TEMPLATES}),(0,jsx_runtime.jsx)(components_button.Z,{onClick:()=>{setHighlights({highlight:highlights.$q.Media3p})},children:constants_RIGHT_CLICK_MENU_LABELS.BROWSE_STOCK_IMAGES_AND_VIDEO})]})},RightClickMenuContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"rightClickMenu__RightClickMenuContainer",componentId:"sc-11e09ag-0"})(["position:absolute;top:","px;left:","px;z-index:9999;"],(({position})=>position?.y??0),(({position})=>position?.x??0)),rightClickMenu=()=>{const{isRTL}=(0,app.ZR)(),{selectedElements,isThisEmptyStory}=(0,app_story.rB)((value=>({selectedElements:value.state.selectedElements,isThisEmptyStory:(0,isEmptyStory.Z)(value.state.pages)}))),{isMenuOpen,menuPosition,onCloseMenu,maskRef}=(0,app.LG)(),ref=(0,react_src.sO)(),preventAdditionalContext=evt=>{evt.preventDefault(),evt.stopPropagation()},Menu=(0,react_src.Ye)((()=>{if(isThisEmptyStory)return emptyStateMenu;if(selectedElements.length>1)return multipleElementsMenu;const selectedElement=selectedElements?.[0];if(selectedElement?.isDefaultBackground)return pageMenu;switch(selectedElement?.type){case elements_src.Yj.IMAGE:case elements_src.Yj.VIDEO:case elements_src.Yj.GIF:return selectedElement?.isBackground?pageMenu:foregroundMediaMenu;case elements_src.Yj.SHAPE:return shapeMenu;case elements_src.Yj.TEXT:return textMenu;case elements_src.Yj.STICKER:return stickerMenu;case elements_src.Yj.PRODUCT:return productMenu;default:return pageMenu}}),[selectedElements,isThisEmptyStory]);return(0,react_src.d4)((()=>{const node=ref.current;return node.addEventListener("contextmenu",preventAdditionalContext),()=>{node.removeEventListener("contextmenu",preventAdditionalContext)}}),[ref]),(0,react_src.jz)((0,jsx_runtime.jsx)(styled_components_browser_esm.LC,{stylisPlugins:[],children:(0,jsx_runtime.jsx)(RightClickMenuContainer,{position:menuPosition,ref,children:(0,jsx_runtime.jsx)(directionAware.Z,{children:(0,jsx_runtime.jsx)(contextMenu.Z,{"data-testid":"right-click-context-menu",isOpen:isMenuOpen,onDismiss:onCloseMenu,"aria-label":(0,i18n.__)("Context Menu for the selected element","web-stories"),maskRef,onMouseDown:evt=>evt.stopPropagation(),isRTL,children:(0,jsx_runtime.jsx)(Menu,{parentMenuRef:ref})})})})}),document.body)};const libraryPanes=function LibraryPanes(){const{tab,tabs}=library_useLibrary((state=>({tab:state.state.tab,tabs:state.data.tabs}))),{actions:{getMedia}}=(0,app.Ek)(),showMediaPane=Boolean(getMedia),highlighted=(0,highlights.QM)((({...highlighted})=>highlighted)),mediaHighlights=highlighted[MEDIA.id],media3pHighlights=highlighted[MEDIA3P.id],textHighlights=highlighted[TEXT.id];return tabs.map((({id})=>{const isActive=id===tab,paneProps={key:id,isActive,"aria-labelledby":(0,panes_shared.pQ)(id)};if(!isActive)return(0,jsx_runtime.jsx)(panes_shared.X6,{...paneProps},id);switch(id){case MEDIA.id:return showMediaPane?(0,jsx_runtime.jsx)(_StyledMediaPane,{...paneProps,$_css:mediaHighlights?.showEffect&&highlights_styles.Z.FLASH},id):null;case MEDIA3P.id:return(0,jsx_runtime.jsx)(_StyledMedia3pPane,{...paneProps,$_css2:media3pHighlights?.showEffect&&highlights_styles.Z.FLASH},id);case SHAPES.id:return(0,jsx_runtime.jsx)(shapesPane,{...paneProps},id);case TEXT.id:return(0,jsx_runtime.jsx)(_StyledTextPane,{...paneProps,$_css3:textHighlights?.showEffect&&highlights_styles.Z.FLASH},id);case PAGE_TEMPLATES.id:return(0,jsx_runtime.jsx)(pageTemplatesPane,{...paneProps},id);case SHOPPING.id:return(0,jsx_runtime.jsx)(shoppingPane,{...paneProps},id);default:return null}}))};var _StyledMediaPane=(0,styled_components_browser_esm.ZP)(mediaPane).withConfig({displayName:"libraryPanes___StyledMediaPane",componentId:"sc-g5zq8j-0"})(["",""],(p=>p.$_css)),_StyledMedia3pPane=(0,styled_components_browser_esm.ZP)(media3pPane).withConfig({displayName:"libraryPanes___StyledMedia3pPane",componentId:"sc-g5zq8j-1"})(["",""],(p=>p.$_css2)),_StyledTextPane=(0,styled_components_browser_esm.ZP)(textPane).withConfig({displayName:"libraryPanes___StyledTextPane",componentId:"sc-g5zq8j-2"})(["",""],(p=>p.$_css3));const libraryLayout_Layout=styled_components_browser_esm.ZP.section.attrs({"aria-label":(0,i18n.__)("Library","web-stories"),"data-testid":"libraryLayout"}).withConfig({displayName:"libraryLayout__Layout",componentId:"sc-6ze1kl-0"})(["height:100%;display:flex;flex-direction:column;background-color:",";color:",";max-height:100%;"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.fg.primary)),TabsArea=styled_components_browser_esm.ZP.nav.attrs({"aria-label":(0,i18n.__)("Library tabs","web-stories")}).withConfig({displayName:"libraryLayout__TabsArea",componentId:"sc-6ze1kl-1"})([""]),LibraryPaneContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"libraryLayout__LibraryPaneContainer",componentId:"sc-6ze1kl-2"})(["height:100%;min-height:0;"]);function LibraryLayout(){const{setTab,tab,tabRefs,tabs}=library_useLibrary((state=>({tab:state.state.tab,tabRefs:state.state.tabRefs,setTab:state.actions.setTab,tabs:state.data.tabs}))),{highlight,resetHighlight}=(0,highlights.QM)((state=>({highlight:{[MEDIA.id]:state[highlights.$q.Media],[MEDIA3P.id]:state[highlights.$q.Media3p],[TEXT.id]:state[highlights.$q.TextSet],[PAGE_TEMPLATES.id]:state[highlights.$q.PageTemplates]},resetHighlight:state.onFocusOut}))),onTabChange=(0,react_src.I4)((id=>{setTab(id),resetHighlight(),(0,tracking_src.L9)("library_tab_change",{name:id})}),[setTab,resetHighlight]);return(0,jsx_runtime.jsxs)(libraryLayout_Layout,{children:[(0,jsx_runtime.jsx)(TabsArea,{children:(0,jsx_runtime.jsx)(tabview.ZP,{label:(0,i18n.__)("Element Library Selection","web-stories"),tabs,tabRefs,tab,onTabChange,onTabRefUpdated:(node,tabId)=>{const h=highlight[tabId];node&&h?.focus&&h?.showEffect&&node.focus()},getTabId:panes_shared.pQ,getAriaControlsId:panes_shared.Qk,shortcut:"mod+option+1"})}),(0,jsx_runtime.jsx)(LibraryPaneContainer,{children:(0,jsx_runtime.jsx)(libraryPanes,{})})]})}LibraryLayout.displayName="LibraryLayout";const libraryLayout=LibraryLayout,MESSAGE_ID="edit-story-library-upload-message";function LibraryUploadDropTarget({children}){const{uploadMedia}=(0,app_media.EF)((({actions:{uploadMedia}})=>({uploadMedia}))),onDropHandler=(0,react_src.I4)((files=>{uploadMedia(files)}),[uploadMedia]);return(0,jsx_runtime.jsxs)(uploadDropTarget.YE,{onDrop:onDropHandler,labelledBy:MESSAGE_ID,children:[children,(0,jsx_runtime.jsx)(uploadDropTarget.DI,{id:MESSAGE_ID,message:(0,i18n.__)("Upload to media library","web-stories")})]})}LibraryUploadDropTarget.displayName="LibraryUploadDropTarget";const libraryUploadDropTarget=LibraryUploadDropTarget;function Library(){return(0,jsx_runtime.jsx)(libraryProvider,{children:(0,jsx_runtime.jsx)(libraryUploadDropTarget,{children:(0,jsx_runtime.jsx)(libraryLayout,{})})})}Library.displayName="Library";const library=Library;var panelSections=__webpack_require__("./packages/design-system/src/utils/panelSections.ts"),box4=__webpack_require__("./packages/design-system/src/icons/box4.svg");function SelectionIcon(){return(0,jsx_runtime.jsx)(box4.Z,{title:(0,i18n.__)("Selection","web-stories")})}SelectionIcon.displayName="SelectionIcon";const selectionIcon=SelectionIcon;function LinkIcon(){return(0,jsx_runtime.jsx)(icons_link.Z,{title:(0,i18n.__)("Link","web-stories")})}LinkIcon.displayName="LinkIcon";const linkIcon=LinkIcon;var circle_speed=__webpack_require__("./packages/design-system/src/icons/circle_speed.svg");function AnimationIcon(){return(0,jsx_runtime.jsx)(circle_speed.Z,{title:(0,i18n.__)("Animation","web-stories")})}AnimationIcon.displayName="AnimationIcon";const animationIcon=AnimationIcon,SELECTION={id:panelSections.C.Selection,icon:selectionIcon,tooltip:(0,i18n.__)("Selection","web-stories")},LINK={id:panelSections.C.Link,icon:linkIcon,tooltip:(0,i18n.__)("Link","web-stories")},ANIMATION={id:panelSections.C.Animation,icon:animationIcon,tooltip:(0,i18n.__)("Animation","web-stories")},style_context=(0,react_src.kr)({state:{},actions:{},tabs:{},refs:{}});function TextSelectionIcon(){return(0,jsx_runtime.jsx)(letter_t.Z,{title:(0,i18n.__)("Text selection","web-stories")})}TextSelectionIcon.displayName="TextSelectionIcon";const textSelectionIcon=TextSelectionIcon;function ImageSelectionIcon(){return(0,jsx_runtime.jsx)(picture.Z,{title:(0,i18n.__)("Image selection","web-stories")})}ImageSelectionIcon.displayName="ImageSelectionIcon";const imageSelectionIcon=ImageSelectionIcon;var video=__webpack_require__("./packages/design-system/src/icons/video.svg");function VideoSelectionIcon(){return(0,jsx_runtime.jsx)(video.Z,{title:(0,i18n.__)("Video selection","web-stories")})}VideoSelectionIcon.displayName="VideoSelectionIcon";const videoSelectionIcon=VideoSelectionIcon;function ShapeSelectionIcon(){return(0,jsx_runtime.jsx)(shapes.Z,{title:(0,i18n.__)("Shape selection","web-stories")})}ShapeSelectionIcon.displayName="ShapeSelectionIcon";const shapeSelectionIcon=ShapeSelectionIcon;var dots=__webpack_require__("./packages/design-system/src/icons/dots.svg");function MultiSelectionIcon(){return(0,jsx_runtime.jsx)(dots.Z,{title:(0,i18n.__)("Multi selection","web-stories")})}MultiSelectionIcon.displayName="MultiSelectionIcon";const multiSelectionIcon=MultiSelectionIcon,productSelectionIcon_StyledIcon=(0,styled_components_browser_esm.ZP)(shopping.Z).withConfig({displayName:"productSelectionIcon__StyledIcon",componentId:"sc-1jpxe2a-0"})(["width:32px !important;height:32px !important;"]);function ProductSelectionIcon(){return(0,jsx_runtime.jsx)(productSelectionIcon_StyledIcon,{title:(0,i18n.__)("Product selection","web-stories")})}ProductSelectionIcon.displayName="ProductSelectionIcon";const productSelectionIcon=ProductSelectionIcon,STYLE_TAB_IDS=new Set([SELECTION.id,LINK.id,ANIMATION.id]);function StyleProvider({children}){const{selectedElements}=(0,app_story.rB)((({state})=>({selectedElements:state.selectedElements}))),{tab:highlightedTab}=(0,highlights.QM)((state=>({tab:state.section})));(0,react_src.d4)((()=>{STYLE_TAB_IDS.has(highlightedTab)&&setTab(highlightedTab)}),[highlightedTab]);const styleRef=(0,react_src.sO)(null),[tab,setTab]=(0,react_src.eJ)(SELECTION.id),selectionPaneRef=(0,react_src.sO)(null),linkPaneRef=(0,react_src.sO)(null),animationPaneRef=(0,react_src.sO)(null),tabRefs=(0,react_src.Ye)((()=>({[SELECTION.id]:selectionPaneRef,[LINK.id]:linkPaneRef,[ANIMATION.id]:animationPaneRef})),[]);let selectionIcon=multiSelectionIcon;const icons=[...new Set(selectedElements.map((({type})=>type)))];1===icons.length?("text"===icons[0]&&(selectionIcon=textSelectionIcon),("image"===icons[0]||selectedElements[0].isBackground)&&(selectionIcon=imageSelectionIcon),"video"===icons[0]&&(selectionIcon=videoSelectionIcon),"shape"!==icons[0]&&"sticker"!==icons[0]||(selectionIcon=shapeSelectionIcon),"product"===icons[0]&&(selectionIcon=productSelectionIcon)):selectionIcon=multiSelectionIcon;const state={state:{tab},refs:{styleRef,tabRefs},actions:{setTab},data:{tabs:[{...SELECTION,icon:selectionIcon}]}},isBackgroundSelected=selectedElements[0]?.isBackground||selectedElements[0]?.isDefaultBackground,hasProductsSelected=selectedElements.some((({type})=>"product"===type));return isBackgroundSelected||hasProductsSelected||state.data.tabs.push(LINK),selectedElements[0]?.isDefaultBackground||hasProductsSelected||state.data.tabs.push(ANIMATION),(0,react_src.d4)((()=>{state.data.tabs.find((t=>t.id===tab))||setTab(SELECTION.id)}),[state.data.tabs,tab]),(0,jsx_runtime.jsx)(style_context.Provider,{value:state,children})}StyleProvider.displayName="StyleProvider";const styleProvider=StyleProvider;const style_useStyle=function useStyle(selector){return(0,react_src.Sz)(style_context,selector??react_src.yR)};var form_context=__webpack_require__("./packages/story-editor/src/components/form/context.js");const utils_useHandlers=function useHandlers(){const handlersRef=(0,react_src.sO)([]),registerHandler=(0,react_src.I4)((handler=>{const handlerList=handlersRef.current;return handlerList.push(handler),()=>{handlerList.splice(handlerList.indexOf(handler),1)}}),[]);return(0,react_src.Ye)((()=>[handlersRef.current,registerHandler]),[registerHandler])},Form=styled_components_browser_esm.ZP.form.withConfig({displayName:"designPanel__Form",componentId:"sc-14jgzfz-0"})(["padding:0;margin:0;"]),AutoSubmitButton=styled_components_browser_esm.ZP.input.attrs({type:"submit"}).withConfig({displayName:"designPanel__AutoSubmitButton",componentId:"sc-14jgzfz-1"})(["display:none;"]);function DesignPanel({panelType,selectedElements,selectedElementIds,onSetProperties,registerSubmitHandler,...rest}){const formRef=(0,react_src.sO)(null),[presubmitHandlers,registerPresubmitHandler]=utils_useHandlers(),formContext=(0,react_src.Ye)((()=>({isMultiple:selectedElements.length>1,registerPresubmitHandler})),[selectedElements,registerPresubmitHandler]),[elementUpdates,setElementUpdates]=(0,react_src.eJ)({}),updatedElements=(0,react_src.Ye)((()=>selectedElements.map((element=>({...element,...elementUpdates[element.id]})))),[selectedElements,elementUpdates]),internalSubmit=(0,react_src.I4)((updates=>{if(0===Object.keys(updates).length)return;const commitUpdates=updates;presubmitHandlers.length>0&&selectedElements.forEach((element=>{const precommitUpdate=(0,updateProperties.Z)(element,updates[element.id],!0);let commitUpdate=precommitUpdate;presubmitHandlers.forEach((handler=>{const handlerUpdate=handler({...element,...commitUpdate},precommitUpdate,element);commitUpdate={...commitUpdate,...handlerUpdate}})),commitUpdates[element.id]=commitUpdate})),onSetProperties((element=>commitUpdates[element.id]))}),[presubmitHandlers,selectedElements,onSetProperties]),onSubmit=registerSubmitHandler((0,react_src.I4)((evt=>{evt&&(evt.preventDefault(),setElementUpdates({})),internalSubmit(elementUpdates)}),[internalSubmit,elementUpdates])),internalSubmitRef=(0,react_src.sO)();(0,react_src.d4)((()=>{internalSubmitRef.current=internalSubmit}),[internalSubmit]);const elementUpdatesRef=(0,react_src.sO)();(0,react_src.d4)((()=>{elementUpdatesRef.current=elementUpdates}),[elementUpdates]),(0,react_src.d4)((()=>{setElementUpdates({}),internalSubmitRef.current(elementUpdatesRef.current)}),[]);const submit=(0,react_src.I4)((()=>{setTimeout((()=>{const form=formRef.current;form&&form.dispatchEvent(new window.Event("submit",{cancelable:!0,bubbles:!0}))}))}),[]),pushUpdate=(0,react_src.I4)(((update,submitArg=!1)=>{setElementUpdates((prevUpdates=>{const newUpdates={};return selectedElements.forEach((element=>{const prevUpdatedElement={...element,...prevUpdates[element.id]},newUpdate=(0,updateProperties.Z)(prevUpdatedElement,update,!1);newUpdates[element.id]={...prevUpdates[element.id],...newUpdate}})),newUpdates})),submitArg&&submit()}),[selectedElements,submit]),pushUpdateForObject=(0,react_src.I4)(((propertyName,update,defaultObject,submitArg=!1)=>{pushUpdate((prevUpdatedElement=>{const prevObject=prevUpdatedElement[propertyName]||defaultObject;return{[propertyName]:update?{...prevObject,...(0,updateProperties.Z)(prevObject,update,!1)}:null}}),submitArg)}),[pushUpdate]),Panel=panelType;return(0,jsx_runtime.jsxs)(Form,{ref:formRef,onSubmit,children:[(0,jsx_runtime.jsx)(AutoSubmitButton,{}),(0,jsx_runtime.jsx)(form_context.Z.Provider,{value:formContext,children:(0,jsx_runtime.jsx)(Panel,{selectedElements:updatedElements,submittedSelectedElements:selectedElements,pushUpdate,pushUpdateForObject,submit,...rest})})]})}DesignPanel.displayName="DesignPanel";const designPanel=DesignPanel;var panelTypes=__webpack_require__("./packages/design-system/src/utils/panelTypes.ts"),range=__webpack_require__("./packages/units/src/range.ts"),exclamation_triangle=__webpack_require__("./packages/design-system/src/icons/exclamation_triangle.svg"),checklist_constants=__webpack_require__("./packages/story-editor/src/components/checklist/constants.js");const WarningContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"warning__WarningContainer",componentId:"sc-16blgsz-0"})(["display:flex;gap:8px;margin:14px auto;border:1px solid ",";border-radius:",";padding:8px;"],(({theme})=>theme.colors.border.defaultHover),(({theme})=>theme.borders.radius.small)),WarningIcon=(0,styled_components_browser_esm.ZP)(exclamation_triangle.Z).withConfig({displayName:"warning__WarningIcon",componentId:"sc-16blgsz-1"})(["width:32px;height:100%;color:",";"],(({theme})=>theme.colors.status.warning)),warning_Message=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"warning__Message",componentId:"sc-16blgsz-2"})(["max-width:calc(100% - 40px);"]);function Warning({message}){const speak=(0,useLiveRegion.Z)("assertive");return(0,react_src.d4)((()=>{speak(message)}),[message,speak]),(0,jsx_runtime.jsxs)(WarningContainer,{"data-testid":"warningContainer",children:[(0,jsx_runtime.jsx)(WarningIcon,{title:checklist_constants.Iy.lowContrast.warningIcon}),(0,jsx_runtime.jsx)(warning_Message,{children:message})]})}Warning.displayName="Warning";const warning=Warning;var numericInput=__webpack_require__("./packages/design-system/src/components/input/numericInput.tsx"),dropdown=__webpack_require__("./packages/design-system/src/components/dropDown/dropdown.tsx"),arrow_up=__webpack_require__("./packages/design-system/src/icons/arrow_up.svg"),useRadioNavigation=__webpack_require__("./packages/story-editor/src/components/form/shared/useRadioNavigation.js");const directionRadioInput_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"directionRadioInput__StyledButton",componentId:"sc-1g0wivz-0"})(["z-index:0;width:28px;height:28px;"," svg{transform-origin:50% 50%;transform:",";}"],(({selected,disabled,theme})=>selected&&!disabled&&(0,styled_components_browser_esm.iv)(["background-color:",";"],theme.colors.interactiveBg.secondaryPress)),(({direction})=>{switch(direction){case animation_src.sc.RightToLeft:return"rotate(270deg)";case animation_src.sc.TopToBottom:return"rotate(180deg)";case animation_src.sc.LeftToRight:return"rotate(90deg)";case animation_src.mi.CounterClockwise:return"rotateX(180deg) rotateZ(90deg)";case animation_src.bQ.ScaleOutBottomLeft:return"rotate(-135deg)";case animation_src.bQ.ScaleInTopLeft:return"rotate(135deg)";case animation_src.bQ.ScaleOutTopRight:return"rotate(-315deg)";case animation_src.bQ.ScaleInBottomRight:return"rotate(315deg)";default:return"rotate(0deg)"}})),Direction=({className,direction,...rest})=>(0,jsx_runtime.jsx)(directionRadioInput_StyledButton,{variant:constants.Wu.Square,type:constants.L$.Tertiary,size:constants.qE.Small,className,direction,...rest,children:[...Object.values(animation_src.sc),...Object.values(animation_src.bQ)].includes(direction)&&(0,jsx_runtime.jsx)(arrow_up.Z,{})});Direction.displayName="Direction";const DirectionIndicator=(0,styled_components_browser_esm.ZP)(Direction).withConfig({displayName:"directionRadioInput__DirectionIndicator",componentId:"sc-1g0wivz-1"})([""]),Fieldset=styled_components_browser_esm.ZP.fieldset.withConfig({displayName:"directionRadioInput__Fieldset",componentId:"sc-1g0wivz-2"})(["position:relative;height:91px;width:88px;margin-top:1px;border-right:1px solid ",";"],(({theme})=>theme.colors.border.defaultNormal)),Figure=styled_components_browser_esm.ZP.div.withConfig({displayName:"directionRadioInput__Figure",componentId:"sc-1g0wivz-3"})(["position:absolute;top:50%;left:50%;width:8px;height:8px;background-color:",";border-radius:2px;transform:translate(-50%,-50%);"],(({theme})=>theme.colors.fg.primary)),directionRadioInput_Label=styled_components_browser_esm.ZP.label.withConfig({displayName:"directionRadioInput__Label",componentId:"sc-1g0wivz-4"})(["position:absolute;cursor:",";",""],(({disabled})=>disabled?"default":"pointer"),(({direction})=>{switch(direction){case animation_src.sc.RightToLeft:return(0,styled_components_browser_esm.iv)(["top:50%;right:","px;transform:translateY(-50%);"],3);case animation_src.sc.TopToBottom:return(0,styled_components_browser_esm.iv)(["top:","px;left:50%;transform:translateX(-50%);"],3);case animation_src.sc.LeftToRight:return(0,styled_components_browser_esm.iv)(["top:50%;left:","px;transform:translateY(-50%);"],3);case animation_src.mi.CounterClockwise:return(0,styled_components_browser_esm.iv)(["bottom:","px;right:","px;transform:translate(-10%,-10%);"],3,3);case animation_src.bQ.ScaleOutBottomLeft:return(0,styled_components_browser_esm.iv)(["bottom:","px;left:","px;"],3,3);case animation_src.bQ.ScaleInTopLeft:return(0,styled_components_browser_esm.iv)(["top:","px;left:","px;"],3,3);case animation_src.bQ.ScaleOutTopRight:return(0,styled_components_browser_esm.iv)(["top:","px;right:","px;"],3,3);case animation_src.bQ.ScaleInBottomRight:return(0,styled_components_browser_esm.iv)(["bottom:","px;right:","px;"],3,3);default:return(0,styled_components_browser_esm.iv)(["bottom:","px;left:50%;transform:translateX(-50%);"],3)}})),HiddenLegend=styled_components_browser_esm.ZP.legend.withConfig({displayName:"directionRadioInput__HiddenLegend",componentId:"sc-1g0wivz-5"})(["position:absolute;opacity:0;clip-path:polygon(0 0);cursor:pointer;"]),RadioGroup=styled_components_browser_esm.ZP.div.withConfig({displayName:"directionRadioInput__RadioGroup",componentId:"sc-1g0wivz-6"})(["position:absolute;top:0;right:0;bottom:0;left:0;"]),translations={[animation_src.sc.RightToLeft]:(0,i18n._x)("right to left","animation direction","web-stories"),[animation_src.sc.LeftToRight]:(0,i18n._x)("left to right","animation direction","web-stories"),[animation_src.sc.TopToBottom]:(0,i18n._x)("top to bottom","animation direction","web-stories"),[animation_src.sc.BottomToTop]:(0,i18n._x)("bottom to top","animation direction","web-stories"),[animation_src.mi.Clockwise]:(0,i18n._x)("clockwise","rotation direction","web-stories"),[animation_src.mi.CounterClockwise]:(0,i18n._x)("counterclockwise","rotation direction","web-stories"),[animation_src.bQ.ScaleIn]:(0,i18n._x)("scale in","scale direction","web-stories"),[animation_src.bQ.ScaleOut]:(0,i18n._x)("scale out","scale direction","web-stories")},valueForInternalValue=value=>{switch(value){case animation_src.bQ.ScaleInTopLeft:case animation_src.bQ.ScaleInBottomRight:return animation_src.bQ.ScaleIn;case animation_src.bQ.ScaleOutBottomLeft:case animation_src.bQ.ScaleOutTopRight:return animation_src.bQ.ScaleOut;default:return value}},isInternalScaleDirection=value=>[...animation_src.nK.IN,...animation_src.nK.OUT].includes(value),splitCamelCase=(camelCase="")=>camelCase?.replace(/([a-z])([A-Z])/g,"$1 $2")?.toLocaleLowerCase()?.split(" ")||[],getPrefixFromCamelCase=(camelCase="")=>splitCamelCase(camelCase)?.[0],getPostfixFromCamelCase=(camelCase="")=>{const split=splitCamelCase(camelCase);return split[split.length-1]},STANDARD_NAV_ORDER=[animation_src.sc.TopToBottom,animation_src.sc.RightToLeft,animation_src.sc.BottomToTop,animation_src.sc.LeftToRight],SCALE_NAV_ORDER=[animation_src.bQ.ScaleInTopLeft,animation_src.bQ.ScaleOutTopRight,animation_src.bQ.ScaleInBottomRight,animation_src.bQ.ScaleOutBottomLeft],sortInputOrderForKeyboardUsability=(directions,directionOrder,isRTL)=>{const referenceOrder=isRTL?directionOrder.reverse():directionOrder;return directions.sort(((a,b)=>referenceOrder.indexOf(a)-referenceOrder.indexOf(b)))},DirectionRadioInput=({value,directions=[],onChange,disabled=[],tooltip})=>{const inputRef=(0,react_src.sO)(),{isRTL}=(0,app_config.ZR)(),flattenedDirections=(0,react_src.Ye)((()=>{const dir=[];if(directions.includes(animation_src.bQ.ScaleOut)||directions.includes(animation_src.bQ.ScaleIn)){const scaleDir=[];directions.includes(animation_src.bQ.ScaleOut)&&scaleDir.push(...animation_src.nK.OUT),directions.includes(animation_src.bQ.ScaleIn)&&scaleDir.push(...animation_src.nK.IN),dir.push(...sortInputOrderForKeyboardUsability(scaleDir,SCALE_NAV_ORDER,isRTL))}else dir.push(...sortInputOrderForKeyboardUsability(directions,STANDARD_NAV_ORDER,isRTL));return dir}),[directions,isRTL]);return(0,useRadioNavigation.Z)(inputRef),(0,jsx_runtime.jsxs)(Fieldset,{children:[(0,jsx_runtime.jsx)(Figure,{}),(0,jsx_runtime.jsx)(HiddenLegend,{children:(0,i18n.__)("Which Direction?","web-stories")}),(0,jsx_runtime.jsx)(RadioGroup,{ref:inputRef,children:flattenedDirections.map((direction=>{const isDisabled=disabled?.includes(valueForInternalValue(direction));return(0,jsx_runtime.jsx)(directionRadioInput_Label,{"aria-label":translations[direction],htmlFor:direction,direction,disabled:isDisabled,children:(0,jsx_runtime.jsx)(components_tooltip.Z,{title:isDisabled?tooltip:"",placement:isInternalScaleDirection(direction)?getPostfixFromCamelCase(direction):getPrefixFromCamelCase(direction),children:(0,jsx_runtime.jsx)(DirectionIndicator,{direction,selected:value===direction||direction?.includes(value),disabled:isDisabled,onClick:()=>onChange(valueForInternalValue(direction))})})},direction)}))})]})};DirectionRadioInput.displayName="DirectionRadioInput";const outerGridBordersCss=(0,styled_components_browser_esm.iv)(["border-radius:0;border-color:"," transparent transparent transparent;"],(({theme})=>theme.colors.border.defaultNormal)),StyledInput=(0,styled_components_browser_esm.ZP)(numericInput.Z).withConfig({displayName:"effectInput__StyledInput",componentId:"sc-1gnssiy-0"})(["height:","px;div{height:calc(100% + 1px);"," &:focus-within{border-radius:",";}}"],45,outerGridBordersCss,(({theme})=>theme.borders.radius.small)),StyledDropDown=(0,styled_components_browser_esm.ZP)(dropdown.Z).withConfig({displayName:"effectInput__StyledDropDown",componentId:"sc-1gnssiy-1"})(["button{height:46px;"," &:hover{","}&:focus-visible{border-radius:",";}}"],outerGridBordersCss,outerGridBordersCss,(({theme})=>theme.borders.radius.small)),allAnimations=[...Object.values(animation_src.sc),...Object.values(animation_src.mi),...Object.values(animation_src.bQ)];const effectInput=function EffectInput({effectProps,effectConfig,field,onChange,disabledOptions,disabled=!1,tooltip}){const directionControlOnChange=(0,react_src.I4)((value=>onChange(value,!0)),[onChange]),_disabledOptions=(0,react_src.Ye)((()=>disabled?allAnimations:disabledOptions),[disabledOptions,disabled]),valueForField=effectConfig[field]??effectProps[field].defaultValue,isFloat=effectProps[field].type===animation_src.fS.Float;switch(effectProps[field].type){case animation_src.fS.Dropdown:return(0,jsx_runtime.jsx)(StyledDropDown,{options:(effectProps[field].values||[]).map((({name,...rest})=>({...rest,label:name,disabled:disabled||disabledOptions.includes(rest.value)}))),placeholder:(0,i18n.__)("Select a value","web-stories"),ariaLabel:(0,i18n.__)("Select effect value","web-stories"),isKeepMenuOpenOnSelection:!1,selectedValue:valueForField,onMenuItemClick:evt=>onChange(evt.target.value,!0),disabled});case animation_src.fS.DirectionPicker:return(0,jsx_runtime.jsx)(DirectionRadioInput,{value:valueForField,directions:effectProps[field].values,onChange:directionControlOnChange,disabled:_disabledOptions,tooltip});default:return(0,jsx_runtime.jsx)(StyledInput,{"aria-label":effectProps[field].label,suffix:effectProps[field].label,unit:effectProps[field].unit,value:valueForField,min:0,onChange:evt=>onChange(isFloat?Number.parseFloat(evt.target.value):Number.parseInt(evt.target.value),!0),isFloat,containerStyleOverride:shared_styles.O,disabled})}};function getEffectDirection(effect={}){return(!effect.zoomDirection||!effect.panDir)&&(effect.zoomDirection?effect.zoomDirection:effect.scaleDirection?effect.scaleDirection:effect.flyInDir?effect.flyInDir:effect.rotateInDir?effect.rotateInDir:effect.whooshInDir?effect.whooshInDir:!!effect.panDir&&effect.panDir)}const AnimationGrid=styled_components_browser_esm.ZP.div.withConfig({displayName:"effectPanel__AnimationGrid",componentId:"sc-s89nzp-0"})(["display:grid;grid-template-columns:auto auto;"]),AnimationGridField=styled_components_browser_esm.ZP.div.withConfig({displayName:"effectPanel__AnimationGridField",componentId:"sc-s89nzp-1"})((({isRotationComponent,isHalfWidthField})=>[{gridColumn:"1/3"},isRotationComponent&&{gridRow:"1/3",gridColumn:"auto"},isHalfWidthField&&{gridColumn:"auto"}]));function EffectPanel({animation:{id,type,...config},onChange,disabledTypeOptionsMap,disabled=!1}){const fields=(0,animation_src.Fh)(type),handleInputChange=(0,react_src.I4)(((updates,submitArg)=>{onChange({id,type,...config,...updates},submitArg)}),[id,type,config,onChange]),containsVisualPicker=(0,react_src.Ye)((()=>Object.keys(fields).reduce(((memo,current)=>fields[current].type===animation_src.fS.DirectionPicker||fields[current].type===animation_src.fS.RotationPicker||memo),!1)),[fields]),content=Object.keys(fields).map(((field,index)=>(0,jsx_runtime.jsx)(AnimationGridField,{isRotationComponent:containsVisualPicker&&0===index,isHalfWidthField:containsVisualPicker&&(1===index||2===index),children:(0,jsx_runtime.jsx)(effectInput,{effectProps:fields,effectConfig:config,field,onChange:(value,submitArg)=>{const fittedValue="number"==typeof value?Math.max(value,0):value;handleInputChange({[field]:fittedValue},submitArg)},disabledOptions:disabledTypeOptionsMap[type]?.options||[],disabled,tooltip:disabledTypeOptionsMap[type]?.tooltip})},field)));return(0,jsx_runtime.jsx)(AnimationGrid,{children:content})}EffectPanel.displayName="EffectPanel";const effectPanel=EffectPanel,BaseAnimationCell=styled_components_browser_esm.ZP.div.withConfig({displayName:"effectChooserElements__BaseAnimationCell",componentId:"sc-13qk6mh-0"})(["display:none;transform-origin:50% 50%;"]),dropKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateY(-100%);animation-timing-function:cubic-bezier(.75,.05,.86,.08);}15%{transform:translateY(0%);animation-timing-function:cubic-bezier(.22,.61,.35,1);}26%{transform:translateY(-62%);animation-timing-function:cubic-bezier(.75,.05,.86,.08);}37%{transform:translateY(-0%);animation-timing-function:cubic-bezier(.22,.61,.35,1);}41.5%{transform:translateY(-30%);animation-timing-function:cubic-bezier(.75,.05,.86,.08);}50%,100%{transform:translateY(0%);animation-timing-function:cubic-bezier(.22,.61,.35,1);}"]),DropAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__DropAnimation",componentId:"sc-13qk6mh-1"})(["animation:"," 3.2s linear infinite;"],dropKeyframes),fadeInKeyframes=(0,styled_components_browser_esm.F4)(["0%{opacity:0;}50%,100%{opacity:1;}"]),FadeInAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FadeInAnimation",componentId:"sc-13qk6mh-2"})(["animation:"," 2.5s linear infinite;"],fadeInKeyframes),flyInLeftKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(-100%);}50%,100%{transform:translateX(0%);}"]),FlyInLeftAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInLeftAnimation",componentId:"sc-13qk6mh-3"})(["animation:"," 2s linear infinite;"],flyInLeftKeyframes),flyInRightKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(100%);}50%,100%{transform:translateX(0%);}"]),FlyInRightAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInRightAnimation",componentId:"sc-13qk6mh-4"})(["animation:"," 2s linear infinite;"],flyInRightKeyframes),flyInTopKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateY(-100%);}50%,100%{transform:translateY(0%);}"]),FlyInTopAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInTopAnimation",componentId:"sc-13qk6mh-5"})(["animation:"," 2s linear infinite;"],flyInTopKeyframes),flyInBottomKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateY(100%);}50%,100%{transform:translateY(0%);}"]),FlyInBottomAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__FlyInBottomAnimation",componentId:"sc-13qk6mh-6"})(["animation:"," 2s linear infinite;"],flyInBottomKeyframes),pulseKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:scale(1);}12.5%{transform:scale(0.75);}37.5%{transform:scale(1.25);}50%,100%{transform:scale(1);}"]),PulseAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PulseAnimation",componentId:"sc-13qk6mh-7"})(["animation:"," 2s cubic-bezier(0.4,0,0.2,1) infinite;"],pulseKeyframes),rotateInLeftKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(-100%) rotate(-360deg);}50%,100%{transform:translateX(0%);}"]),RotateInLeftAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__RotateInLeftAnimation",componentId:"sc-13qk6mh-8"})(["animation:"," 2s linear infinite;"],rotateInLeftKeyframes),rotateInRightKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(100%) rotate(360deg);}50%,100%{transform:translateX(0%);}"]),RotateInRightAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__RotateInRightAnimation",componentId:"sc-13qk6mh-9"})(["animation:"," 2s linear infinite;"],rotateInRightKeyframes),twirlInKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:rotate(-540deg) scale(0.1);opacity:0;}50%,100%{transform:none;opacity:1;}"]),TwirlInAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__TwirlInAnimation",componentId:"sc-13qk6mh-10"})(["animation:"," 2s cubic-bezier(0.2,0.75,0.4,1) infinite;"],twirlInKeyframes),whooshInLeftKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(-100%);opacity:0;}50%,100%{transform:translateX(0%);opacity:1;}"]),WhooshInLeftAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__WhooshInLeftAnimation",componentId:"sc-13qk6mh-11"})(["animation:"," 2s cubic-bezier(0,0,0.2,1) infinite;"],whooshInLeftKeyframes),whooshInRightKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(100%);opacity:0;}50%,100%{transform:translateX(0%);opacity:1;}"]),WhooshInRightAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__WhooshInRightAnimation",componentId:"sc-13qk6mh-12"})(["animation:"," 2s cubic-bezier(0,0,0.2,1) infinite;"],whooshInRightKeyframes),panLeftKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(-100%) scale(1.5);}50%,100%{transform:translateX(200%) scale(1.5);}"]),PanLeftAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanLeftAnimation",componentId:"sc-13qk6mh-13"})(["animation:"," 3s linear infinite;"],panLeftKeyframes),panRightKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateX(100%) scale(1.5);}50%,100%{transform:translateX(-200%) scale(1.5);}"]),PanRightAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanRightAnimation",componentId:"sc-13qk6mh-14"})(["animation:"," 3s linear infinite;"],panRightKeyframes),panTopKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateY(-100%) scale(1.5);}50%,100%{transform:translateY(200%) scale(1.5);}"]),PanTopAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanTopAnimation",componentId:"sc-13qk6mh-15"})(["animation:"," 3s linear infinite;"],panTopKeyframes),panBottomKeyframes=(0,styled_components_browser_esm.F4)(["0%{transform:translateY(100%) scale(1.5);}50%,100%{transform:translateY(-200%) scale(1.5);}"]),PanBottomAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanBottomAnimation",componentId:"sc-13qk6mh-16"})(["animation:"," 3s linear infinite;"],panBottomKeyframes),zoomInKeyframes=(0,styled_components_browser_esm.F4)(["0%{opacity:0;transform:scale(0);}50%,100%{opacity:1;transform:scale(1);}"]),ZoomInAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__ZoomInAnimation",componentId:"sc-13qk6mh-17"})(["animation:"," 2s linear infinite;"],zoomInKeyframes),zoomOutKeyframes=(0,styled_components_browser_esm.F4)(["0%{opacity:0;transform:scale(2);}50%,100%{opacity:1;transform:scale(1);}"]),ZoomOutAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__ZoomOutAnimation",componentId:"sc-13qk6mh-18"})(["animation:"," 2s linear infinite;"],zoomOutKeyframes),panAndZoomKeyframes=(0,styled_components_browser_esm.F4)(["0%{opacity:0;transform:translate3d(-50%,0,0) scale(2);}50%,100%{opacity:1;transform:none;}"]),PanAndZoomAnimation=(0,styled_components_browser_esm.ZP)(BaseAnimationCell).withConfig({displayName:"effectChooserElements__PanAndZoomAnimation",componentId:"sc-13qk6mh-19"})(["animation:"," 2s linear infinite;"],panAndZoomKeyframes),getDirectionalEffect=(effect,direction)=>effectValueExceptions.includes(effect)?effect:direction?`${effect} ${direction}`.trim():effect,GRID_SIZING={HALF:"half",QUARTER:"quarter"},effectValueExceptions=[animation_src.v8.PAN_AND_ZOOM.value],backgroundEffectOptions={NO_ANIMATION:{value:"none",label:(0,i18n._x)("None","animation effect","web-stories")},[getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.LeftToRight)]:{value:getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.LeftToRight),label:(0,i18n._x)("Pan Left","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Left","animation effect","web-stories")),value:animation_src.v8.PAN.value,panDirection:animation_src.sc.LeftToRight,gridSpace:GRID_SIZING.QUARTER,Effect:PanLeftAnimation,size:16}},[getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.RightToLeft)]:{value:getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.RightToLeft),label:(0,i18n._x)("Pan Right","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Right","animation effect","web-stories")),value:animation_src.v8.PAN.value,panDirection:animation_src.sc.RightToLeft,gridSpace:GRID_SIZING.QUARTER,Effect:PanRightAnimation,size:16}},[getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.BottomToTop)]:{value:getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.BottomToTop),label:(0,i18n._x)("Pan Up","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Up","animation effect","web-stories")),value:animation_src.v8.PAN.value,panDirection:animation_src.sc.BottomToTop,gridSpace:GRID_SIZING.QUARTER,Effect:PanBottomAnimation,size:16}},[getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.TopToBottom)]:{value:getDirectionalEffect(animation_src.v8.PAN.value,animation_src.sc.TopToBottom),label:(0,i18n._x)("Pan Down","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Pan Down","animation effect","web-stories")),value:animation_src.v8.PAN.value,panDirection:animation_src.sc.TopToBottom,gridSpace:GRID_SIZING.QUARTER,Effect:PanTopAnimation,size:16}},[getDirectionalEffect(animation_src.v8.ZOOM.value,animation_src.bQ.ScaleIn)]:{value:getDirectionalEffect(animation_src.v8.ZOOM.value,animation_src.bQ.ScaleIn),label:(0,i18n._x)("Zoom In","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Zoom In","animation effect","web-stories")),value:animation_src.v8.ZOOM.value,zoomDirection:animation_src.bQ.ScaleIn,gridSpace:GRID_SIZING.HALF,Effect:ZoomInAnimation,size:14}},[getDirectionalEffect(animation_src.v8.ZOOM.value,animation_src.bQ.ScaleOut)]:{value:getDirectionalEffect(animation_src.v8.ZOOM.value,animation_src.bQ.ScaleOut),label:(0,i18n._x)("Zoom Out","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Zoom Out","animation effect","web-stories")),value:animation_src.v8.ZOOM.value,zoomDirection:animation_src.bQ.ScaleOut,gridSpace:GRID_SIZING.HALF,Effect:ZoomOutAnimation,size:20}},[animation_src.v8.PAN_AND_ZOOM.value]:{value:animation_src.v8.PAN_AND_ZOOM.value,label:animation_src.v8.PAN_AND_ZOOM.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.v8.PAN_AND_ZOOM.name),value:animation_src.v8.PAN_AND_ZOOM.value,zoomDirection:"dynamicPropertyValue",Effect:PanAndZoomAnimation,size:26}}},foregroundEffectOptions={NO_ANIMATION:{value:"none",label:(0,i18n._x)("None","animation effect","web-stories")},[animation_src.Gx.DROP.value]:{value:animation_src.Gx.DROP.value,label:animation_src.Gx.DROP.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.Gx.DROP.name),value:animation_src.Gx.DROP.value,Effect:DropAnimation}},[animation_src.Gx.FADE_IN.value]:{value:animation_src.Gx.FADE_IN.value,label:animation_src.Gx.FADE_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.Gx.FADE_IN.name),value:animation_src.Gx.FADE_IN.value,Effect:FadeInAnimation}},[getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.LeftToRight)]:{value:getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.LeftToRight),label:animation_src.Gx.FLY_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Left","animation effect","web-stories")),value:animation_src.Gx.FLY_IN.value,flyInDirection:animation_src.sc.LeftToRight,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInLeftAnimation,size:16}},[getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.TopToBottom)]:{value:getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.TopToBottom),label:animation_src.Gx.FLY_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Top","animation effect","web-stories")),value:animation_src.Gx.FLY_IN.value,flyInDirection:animation_src.sc.TopToBottom,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInTopAnimation,size:16}},[getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.BottomToTop)]:{value:getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.BottomToTop),label:animation_src.Gx.FLY_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Bottom","animation effect","web-stories")),value:animation_src.Gx.FLY_IN.value,flyInDirection:animation_src.sc.BottomToTop,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInBottomAnimation,size:16}},[getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.RightToLeft)]:{value:getDirectionalEffect(animation_src.Gx.FLY_IN.value,animation_src.sc.RightToLeft),label:animation_src.Gx.FLY_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Fly In from Right","animation effect","web-stories")),value:animation_src.Gx.FLY_IN.value,flyInDirection:animation_src.sc.RightToLeft,gridSpace:GRID_SIZING.QUARTER,Effect:FlyInRightAnimation,size:16}},[animation_src.Gx.PULSE.value]:{value:animation_src.Gx.PULSE.value,label:animation_src.Gx.PULSE.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.Gx.PULSE.name),value:animation_src.Gx.PULSE.value,Effect:PulseAnimation}},[getDirectionalEffect(animation_src.Gx.ROTATE_IN.value,animation_src.sc.LeftToRight)]:{value:getDirectionalEffect(animation_src.Gx.ROTATE_IN.value,animation_src.sc.LeftToRight),label:(0,i18n._x)("Rotate","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Rotate In from Left","animation effect","web-stories")),value:animation_src.Gx.ROTATE_IN.value,rotateInDirection:animation_src.sc.LeftToRight,gridSpace:GRID_SIZING.HALF,Effect:RotateInLeftAnimation,size:18}},[getDirectionalEffect(animation_src.Gx.ROTATE_IN.value,animation_src.sc.RightToLeft)]:{value:getDirectionalEffect(animation_src.Gx.ROTATE_IN.value,animation_src.sc.RightToLeft),label:(0,i18n._x)("Rotate","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Rotate In from Right","animation effect","web-stories")),value:animation_src.Gx.ROTATE_IN.value,rotateInDirection:animation_src.sc.RightToLeft,gridSpace:GRID_SIZING.HALF,Effect:RotateInRightAnimation,size:18}},[animation_src.Gx.TWIRL_IN.value]:{value:animation_src.Gx.TWIRL_IN.value,label:animation_src.Gx.TWIRL_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),animation_src.Gx.TWIRL_IN.name),value:animation_src.Gx.TWIRL_IN.value,Effect:TwirlInAnimation,size:26}},[getDirectionalEffect(animation_src.Gx.WHOOSH_IN.value,animation_src.sc.LeftToRight)]:{value:getDirectionalEffect(animation_src.Gx.WHOOSH_IN.value,animation_src.sc.LeftToRight),label:animation_src.Gx.WHOOSH_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Whoosh In from Left","animation effect","web-stories")),value:animation_src.Gx.WHOOSH_IN.value,whooshInDirection:animation_src.sc.LeftToRight,gridSpace:GRID_SIZING.HALF,Effect:WhooshInLeftAnimation,size:20}},[getDirectionalEffect(animation_src.Gx.WHOOSH_IN.value,animation_src.sc.RightToLeft)]:{value:getDirectionalEffect(animation_src.Gx.WHOOSH_IN.value,animation_src.sc.RightToLeft),label:animation_src.Gx.WHOOSH_IN.name,animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Whoosh In from Right","animation effect","web-stories")),value:animation_src.Gx.WHOOSH_IN.value,whooshInDirection:animation_src.sc.RightToLeft,gridSpace:GRID_SIZING.HALF,Effect:WhooshInRightAnimation,size:20}},[getDirectionalEffect(animation_src.Gx.ZOOM.value,animation_src.bQ.ScaleIn)]:{value:getDirectionalEffect(animation_src.Gx.ZOOM.value,animation_src.bQ.ScaleIn),label:(0,i18n._x)("Scale In","animation effect","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Scale In","animation effect","web-stories")),value:animation_src.Gx.ZOOM.value,scaleDirection:animation_src.bQ.ScaleIn,gridSpace:GRID_SIZING.HALF,Effect:ZoomInAnimation,size:14}},[getDirectionalEffect(animation_src.Gx.ZOOM.value,animation_src.bQ.ScaleOut)]:{value:getDirectionalEffect(animation_src.Gx.ZOOM.value,animation_src.bQ.ScaleOut),label:(0,i18n.__)("Scale Out","web-stories"),animation:{ariaLabel:(0,sprintf.Z)((0,i18n.__)('"%s" Effect',"web-stories"),(0,i18n._x)("Scale Out","animation effect","web-stories")),value:animation_src.Gx.ZOOM.value,scaleDirection:animation_src.bQ.ScaleOut,gridSpace:GRID_SIZING.HALF,Effect:ZoomOutAnimation,size:20}}},ANIMATION_OPTION_PROP_TYPE={ariaLabel:prop_types_default().string,value:prop_types_default().string.isRequired,Effect:prop_types_default().any,gridSpace:prop_types_default().oneOf(Object.values(GRID_SIZING)),size:prop_types_default().number,scaleDirection:prop_types_default().oneOf(Object.values(animation_src.bQ)),panDirection:prop_types_default().oneOf(Object.values(animation_src.sc)),zoomDirection:prop_types_default().oneOf(Object.values(animation_src.bQ)),flyInDirection:prop_types_default().oneOf(Object.values(animation_src.sc)),rotateInDirection:prop_types_default().oneOf(Object.values(animation_src.sc)),whooshInDirection:prop_types_default().oneOf(Object.values(animation_src.sc))},ANIMATION_DROPDOWN_OPTION_PROP_TYPE={value:prop_types_default().string.isRequired,label:prop_types_default().string.isRequired,animation:prop_types_default().shape(ANIMATION_OPTION_PROP_TYPE)},utils_getDisabledBackgroundEffects=(prop_types_default().oneOf([...Object.values(animation_src.sc),...Object.values(animation_src.bQ),!1]),(backgroundEffectOptions,disabledTypeOptionsMap)=>{const disabledDirectionalEffects=Object.entries(disabledTypeOptionsMap).filter((([effect])=>-1===effectValueExceptions.indexOf(effect))).map((([effect,val])=>[effect,val.options])).reduce(((directionalEffects,[effect,directions])=>[...directionalEffects,...(directions||[]).map((dir=>getDirectionalEffect(effect,dir)))]),[]);return Object.keys(backgroundEffectOptions).filter((directionalEffect=>disabledDirectionalEffects.includes(directionalEffect)))}),utils_hasDynamicProperty=animation=>Object.values(animation).includes("dynamicPropertyValue"),utils_updateDynamicProps=({animation,disabledOptions=[]})=>{const panDirection=animation.panDirection&&!disabledOptions.includes(animation.panDirection)?animation.panDirection:Object.values(animation_src.sc).filter((direction=>!disabledOptions.includes(direction)))?.[0]||void 0;return animation.value===animation_src.v8.PAN_AND_ZOOM.value?{...animation,zoomDirection:disabledOptions.includes(animation_src.bQ.ScaleIn)?animation_src.bQ.ScaleOut:animation_src.bQ.ScaleIn,panDirection}:animation},utils_generateDynamicProps=({animation,disabledTypeOptionsMap})=>utils_hasDynamicProperty(animation)?utils_updateDynamicProps({animation,disabledOptions:disabledTypeOptionsMap[animation.value]?.options}):animation,ContentWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"effectChooserDropdown__ContentWrapper",componentId:"sc-1d71y2l-0"})(["display:inline-block;"]),AnimationListItem=styled_components_browser_esm.ZP.li.withConfig({displayName:"effectChooserDropdown__AnimationListItem",componentId:"sc-1d71y2l-1"})(["border:none;background:",";border-radius:",";height:","px;position:relative;grid-column-start:",";overflow:hidden;font-family:'Teko',sans-serif;font-size:","px;line-height:1;color:",";text-transform:uppercase;transition:background 0.1s linear;margin:0;& > div{height:100%;display:flex;align-items:center;justify-content:center;text-align:center;}&[aria-disabled='true']{background:",";}&:hover:not([aria-disabled='true']){cursor:pointer;}&:hover:not([aria-disabled='true']),&:focus:not([aria-disabled='true']){background:",";","{display:inline-block;}","{display:none;}}"," ",";"],(({active,theme})=>active?theme.colors.interactiveBg.secondaryPress:theme.colors.interactiveBg.secondaryNormal),(({theme})=>theme.borders.radius.small),56,(({gridSpace})=>(gridSpace=>{switch(gridSpace){case GRID_SIZING.HALF:return"span 2";case GRID_SIZING.QUARTER:return"span 1";default:return"span 4"}})(gridSpace)),(({size=28})=>size),(({theme})=>theme.colors.fg.primary),(({theme})=>theme.colors.interactiveBg.disable),(({active,theme})=>active?theme.colors.interactiveBg.secondaryPress:theme.colors.interactiveBg.secondaryHover),BaseAnimationCell,ContentWrapper,(({noEffect})=>noEffect&&(0,styled_components_browser_esm.iv)(["height:36px;font-size:14px;text-transform:none;","{display:inline-block !important;}"],ContentWrapper)),shared_styles.j),styleOverrideForAnimationEffectMenu=(0,styled_components_browser_esm.iv)(["display:inline-block;margin-top:0;padding:16px 4px 16px 16px;ul{display:grid;justify-content:center;gap:12px 4px;grid-template-columns:repeat(4,1fr);position:relative;}"]),styleOverrideForSelectButton=({theme})=>(0,styled_components_browser_esm.iv)(["margin:-1px -1px 0 -1px;width:calc(100% + 2px);border-color:transparent transparent "," transparent;height:","px;&:hover{border-color:transparent transparent "," transparent;}",""],theme.colors.border.defaultNormal,45,theme.colors.border.defaultNormal,shared_styles.j),DropDownItem=(0,react_src.Gp)((({option,...rest},ref)=>(0,jsx_runtime.jsx)(AnimationListItem,{ref,"aria-label":option.animation?.ariaLabel||option.label,disabled:option.disabled,"aria-disabled":option.disabled,size:option.animation?.size,gridSpace:option.animation?.gridSpace,noEffect:!option.animation?.Effect,...rest,children:(0,jsx_runtime.jsxs)(components_tooltip.Z,{title:option?.tooltip||"",children:[(0,jsx_runtime.jsx)(ContentWrapper,{children:option.label}),option.animation?.Effect&&(0,jsx_runtime.jsx)(option.animation.Effect,{children:option.label})]})}))),dropdownItem=DropDownItem;DropDownItem.displayName="DropDownItem",DropDownItem.propTypes={option:prop_types_default().shape(ANIMATION_DROPDOWN_OPTION_PROP_TYPE)};const effectChooserDropdown=(0,react_src.Gp)((function EffectChooserDropdown({onAnimationSelected,onNoEffectSelected,isBackgroundEffects=!1,selectedEffectType,disabledTypeOptionsMap,direction,selectButtonStylesOverride,disabled=!1},ref){const selectedValue=(0,react_src.Ye)((()=>getDirectionalEffect(selectedEffectType,direction)),[selectedEffectType,direction]),disabledBackgroundEffects=(0,react_src.Ye)((()=>isBackgroundEffects&&utils_getDisabledBackgroundEffects(backgroundEffectOptions,disabledTypeOptionsMap)),[disabledTypeOptionsMap,isBackgroundEffects]),expandedPlacement=isBackgroundEffects?popup_constants.ug.Bottom:popup_constants.ug.Top,animationOptionsObject=isBackgroundEffects?backgroundEffectOptions:foregroundEffectOptions,availableAnimationOptions=Object.values(animationOptionsObject),assembledOptions=(0,react_src.Ye)((()=>availableAnimationOptions?.map((option=>{const isDisabled=isBackgroundEffects&&disabledBackgroundEffects.includes(option.value);return{...option,disabled:isDisabled,tooltip:isDisabled&&disabledTypeOptionsMap[option.animation?.value]?.tooltip}}))),[availableAnimationOptions,isBackgroundEffects,disabledBackgroundEffects,disabledTypeOptionsMap]),handleSelect=(0,react_src.I4)(((event,value)=>{if(event.preventDefault(),"none"===value)return void(Boolean(selectedValue)&&onNoEffectSelected());const selectedAnimation=animationOptionsObject[value]?.animation,animationWithDynamicProps=utils_generateDynamicProps({animation:selectedAnimation,disabledTypeOptionsMap});onAnimationSelected({animation:animationWithDynamicProps.value,panDir:animationWithDynamicProps?.panDirection,zoomDirection:animationWithDynamicProps?.zoomDirection,flyInDir:animationWithDynamicProps?.flyInDirection,rotateInDir:animationWithDynamicProps?.rotateInDirection,whooshInDir:animationWithDynamicProps?.whooshInDirection,scaleDirection:animationWithDynamicProps?.scaleDirection})}),[animationOptionsObject,disabledTypeOptionsMap,onAnimationSelected,selectedValue,onNoEffectSelected]),innerStyleOverrides=selectedValue&&"none"!==selectedValue?styleOverrideForSelectButton:shared_styles.j,buttonStyleOverride=(0,styled_components_browser_esm.iv)([""," ",""],innerStyleOverrides,void 0!==selectButtonStylesOverride&&selectButtonStylesOverride);return(0,jsx_runtime.jsx)(dropdown.Z,{ref,options:assembledOptions,placeholder:(0,i18n._x)("None","animation effect","web-stories"),selectedValue,ariaLabel:(0,i18n.__)("Animation: Effect Chooser","web-stories"),menuStylesOverride:styleOverrideForAnimationEffectMenu,renderItem:dropdownItem,onMenuItemClick:handleSelect,placement:expandedPlacement,isKeepMenuOpenOnSelection:!0,selectButtonStylesOverride:buttonStyleOverride,disabled})})),StyledRow=(0,styled_components_browser_esm.ZP)(components_form.X2).withConfig({displayName:"animation__StyledRow",componentId:"sc-1j3eshx-0"})(["margin-bottom:-1px;"]),GroupWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"animation__GroupWrapper",componentId:"sc-1j3eshx-1"})([""," margin-bottom:16px;"],(({hasAnimation,theme})=>hasAnimation&&`\n    border: 1px solid ${theme.colors.border.defaultNormal};\n    border-radius: ${theme.borders.radius.small};\n  `)),backgroundAnimationTooltip=(0,i18n.__)("The background image is too small to animate. Double click on the bg & scale the image before applying the animation.","web-stories");const animation=function AnimationPanel({selectedElements,selectedElementAnimations,pushUpdateForObject,updateAnimationState}){const isFirstPage=(0,app.rB)((({state:{currentPageNumber}})=>1===currentPageNumber)),playUpdatedAnimation=(0,react_src.sO)(!1),{highlight,resetHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.Animation],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),isBackground=1===selectedElements.length&&selectedElements[0].isBackground,updatedAnimations=(0,react_src.Ye)((()=>{const updated=selectedElements.map((element=>element.animation)).filter(Boolean);return selectedElementAnimations.map((anim=>({...updated.find((a=>a.id===anim.id))||anim}))).filter((a=>!a.delete))}),[selectedElements,selectedElementAnimations]),handlePanelChange=(0,react_src.I4)(((animation,submitArg=!1)=>{(0,react_src.wU)(animation,updatedAnimations[0])||(updateAnimationState({animationState:animation_src.pG.Reset}),pushUpdateForObject("animation",animation,null,submitArg),playUpdatedAnimation.current=!0)}),[pushUpdateForObject,updatedAnimations,updateAnimationState]),handleAddOrUpdateElementEffect=(0,react_src.I4)((({animation,...options})=>{if(!animation)return;const id=selectedElementAnimations[0]?.id||(0,v4.Z)(),defaults=(0,animation_src.D9)(animation),persisted=selectedElementAnimations[0]?.type===animation?{duration:selectedElementAnimations[0]?.duration,delay:selectedElementAnimations[0]?.delay}:{};pushUpdateForObject("animation",{id,type:animation,...defaults,...persisted,...options},null,!0),playUpdatedAnimation.current=!0}),[selectedElementAnimations,pushUpdateForObject]),activeElement=document.activeElement,debouncedUpdateAnimationState=(0,react_src.y1)((()=>{playUpdatedAnimation.current&&(updateAnimationState({animationState:animation_src.pG.PlayingSelected}),playUpdatedAnimation.current=!1)}),300);(0,react_src.d4)(debouncedUpdateAnimationState,[selectedElementAnimations,updateAnimationState,activeElement,debouncedUpdateAnimationState]);const handleRemoveEffect=(0,react_src.I4)((()=>{pushUpdateForObject("animation",{...updatedAnimations[0],delete:!0},null,!0)}),[pushUpdateForObject,updatedAnimations]),selectedElement=selectedElements[0],disabledTypeOptionsMap=(0,react_src.Ye)((()=>{if(!selectedElement)return{};if(selectedElement.isBackground){const{isMedia}=(0,elements_src.Do)(selectedElement.type),hasOffset=isMedia?(0,animation_src.xY)(selectedElement):animation_src.Ro,normalizedScale=(0,range.YD)(selectedElement.scale||0,{MIN:animation_src.nF,MAX:animation_src.fo});return{[animation_src.v8.PAN.value]:{tooltip:backgroundAnimationTooltip,options:[!hasOffset.bottom&&animation_src.sc.TopToBottom,!hasOffset.left&&animation_src.sc.RightToLeft,!hasOffset.top&&animation_src.sc.BottomToTop,!hasOffset.right&&animation_src.sc.LeftToRight].filter(Boolean)},[animation_src.v8.ZOOM.value]:{tooltip:backgroundAnimationTooltip,options:[normalizedScale<=.01&&animation_src.bQ.ScaleIn,normalizedScale>=.99&&animation_src.bQ.ScaleOut].filter(Boolean)},[animation_src.v8.PAN_AND_ZOOM.value]:{tooltip:backgroundAnimationTooltip,options:[!hasOffset.bottom&&animation_src.sc.TopToBottom,!hasOffset.left&&animation_src.sc.RightToLeft,!hasOffset.top&&animation_src.sc.BottomToTop,!hasOffset.right&&animation_src.sc.LeftToRight,normalizedScale<=.01&&animation_src.bQ.ScaleIn,normalizedScale>=.99&&animation_src.bQ.ScaleOut].filter(Boolean)}}}return{}}),[selectedElement]),selectedEffectTitle=function getEffectName(type){return[...Object.values(animation_src.Gx),...Object.values(animation_src.uf),...Object.values(animation_src.v8)].find((o=>o.value===type))?.name||""}(updatedAnimations[0]?.type);return selectedElements.length>1?null:(0,jsx_runtime.jsxs)(_StyledSimplePanel,{name:"animation",title:(0,i18n.__)("Animation","web-stories"),onAnimationEnd:()=>resetHighlight(),isPersistable:!highlight,$_css:highlight?.showEffect&&highlights_styles.Z.FLASH,children:[(0,jsx_runtime.jsxs)(GroupWrapper,{hasAnimation:selectedEffectTitle,children:[(0,jsx_runtime.jsx)(StyledRow,{children:(0,jsx_runtime.jsx)(effectChooserDropdown,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&node.focus()},onAnimationSelected:handleAddOrUpdateElementEffect,onNoEffectSelected:handleRemoveEffect,isBackgroundEffects:isBackground,disabledTypeOptionsMap,direction:getEffectDirection(updatedAnimations[0]),selectedEffectType:updatedAnimations[0]?.type,selectButtonStylesOverride:highlight?.focus&&highlights_styles.Z.OUTLINE,disabled:isFirstPage})}),updatedAnimations[0]&&(0,jsx_runtime.jsx)(effectPanel,{animation:updatedAnimations[0],onChange:handlePanelChange,disabledTypeOptionsMap,disabled:isFirstPage})]}),isFirstPage&&(0,jsx_runtime.jsx)(warning,{message:checklist.lC.firstPageAnimation.animationPanel})]})};var _StyledSimplePanel=(0,styled_components_browser_esm.ZP)(panel.me).withConfig({displayName:"animation___StyledSimplePanel",componentId:"sc-1j3eshx-2"})(["",""],(p=>p.$_css)),border_shared=__webpack_require__("./packages/story-editor/src/components/panels/design/border/shared.js"),toggleButton=__webpack_require__("./packages/design-system/src/components/button/toggleButton.tsx"),icons_border=__webpack_require__("./packages/design-system/src/icons/border.svg"),stackable=__webpack_require__("./packages/story-editor/src/components/form/stackable/index.js");const BorderInputsFlexContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"borderWidth__BorderInputsFlexContainer",componentId:"sc-tay5fw-0"})(["display:flex;gap:7px;margin-bottom:16px;"]),StyledLockToggle=(0,styled_components_browser_esm.ZP)(toggleButton.o).withConfig({displayName:"borderWidth__StyledLockToggle",componentId:"sc-tay5fw-1"})(["",";"],shared_styles.j),ToggleWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"borderWidth__ToggleWrapper",componentId:"sc-tay5fw-2"})(["padding-top:2px;"," align-self:stretch;"],(({locked})=>locked&&"\n    padding-left: 8px;\n  ")),BorderTop=(0,styled_components_browser_esm.ZP)(icons_border.Z).withConfig({displayName:"borderWidth__BorderTop",componentId:"sc-tay5fw-3"})(["transform:rotate(90deg);"]),BorderBottom=(0,styled_components_browser_esm.ZP)(icons_border.Z).withConfig({displayName:"borderWidth__BorderBottom",componentId:"sc-tay5fw-4"})(["transform:rotate(-90deg);"]),BorderRight=(0,styled_components_browser_esm.ZP)(icons_border.Z).withConfig({displayName:"borderWidth__BorderRight",componentId:"sc-tay5fw-5"})(["transform:scaleX(-1);"]);function WidthControls({selectedElements,pushUpdateForObject}){const border=(0,shared.cn)(selectedElements,"border",border_shared.t),hasMultiBorderSupport=selectedElements.every(masks_src.e5),lockBorder=!0===border.lockedWidth||!hasMultiBorderSupport,handleChange=(0,react_src.I4)((name=>(evt,value)=>{pushUpdateForObject("border",lockBorder?{left:value,top:value,right:value,bottom:value}:{[name]:value},border_shared.t,!0)}),[pushUpdateForObject,lockBorder]),handleLockChange=(0,react_src.I4)((newBorder=>{pushUpdateForObject("border",newBorder,border_shared.t,!0)}),[pushUpdateForObject]),firstInputLabel=lockBorder?(0,i18n.__)("Border","web-stories"):(0,i18n.__)("Left border","web-stories"),getMixedValueProps=(0,react_src.I4)((value=>({isIndeterminate:story_editor_src_constants.mh===value,placeholder:story_editor_src_constants.mh===value?story_editor_src_constants.nz:null})),[]);return(0,jsx_runtime.jsxs)(BorderInputsFlexContainer,{children:[(0,jsx_runtime.jsxs)(stackable.m,{locked:lockBorder,children:[(0,jsx_runtime.jsx)(stackable.H,{value:border.left,onChange:handleChange("left"),"aria-label":firstInputLabel,suffix:!lockBorder&&(0,jsx_runtime.jsx)(icons_border.Z,{}),min:0,...getMixedValueProps(border.left)}),!lockBorder&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(stackable.H,{value:border.top,onChange:handleChange("top"),"aria-label":(0,i18n.__)("Top border","web-stories"),labelText:(0,i18n.__)("Top","web-stories"),suffix:(0,jsx_runtime.jsx)(BorderTop,{}),min:0,...getMixedValueProps(border.top)}),(0,jsx_runtime.jsx)(stackable.H,{value:border.right,onChange:handleChange("right"),"aria-label":(0,i18n.__)("Right border","web-stories"),labelText:(0,i18n.__)("Right","web-stories"),suffix:(0,jsx_runtime.jsx)(BorderRight,{}),min:0,...getMixedValueProps(border.right)}),(0,jsx_runtime.jsx)(stackable.H,{value:border.bottom,onChange:handleChange("bottom"),"aria-label":(0,i18n.__)("Bottom border","web-stories"),labelText:(0,i18n.__)("Bottom","web-stories"),suffix:(0,jsx_runtime.jsx)(BorderBottom,{}),min:0,...getMixedValueProps(border.bottom)})]})]}),hasMultiBorderSupport&&(0,jsx_runtime.jsx)(ToggleWrapper,{locked:lockBorder,children:(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Toggle consistent border","web-stories"),children:(0,jsx_runtime.jsx)(StyledLockToggle,{isLocked:lockBorder,onClick:()=>{let args={lockedWidth:!lockBorder};lockBorder||(args={...args,top:border.left,right:border.left,bottom:border.left}),handleLockChange(args)},"aria-label":(0,i18n.__)("Toggle consistent border","web-stories")})})})]})}WidthControls.displayName="WidthControls";const borderWidth=WidthControls;function BorderStylePanel(props){const{selectedElements,pushUpdate}=props,border=(0,shared.cn)(selectedElements,"border",border_shared.t),{color,left,top,right,bottom}=border,allSupportBorder=selectedElements.every((el=>(0,masks_src.tA)(el))),handleChange=(0,react_src.I4)(((value,name)=>pushUpdate({border:{...border,[name]:value}},!0)),[border,pushUpdate]);if(!allSupportBorder)return null;const hasMultiBorderSupport=selectedElements.every(masks_src.e5),hasBorder=[left,top,right,bottom].some((value=>value>0));return(0,jsx_runtime.jsxs)(panel.me,{name:"borderStyle",title:(0,i18n.__)("Border","web-stories"),children:[(0,jsx_runtime.jsx)(borderWidth,{...props}),hasBorder&&(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(components_form.Il,{value:color,onChange:value=>{handleChange(value,"color")},label:(0,i18n.__)("Border color","web-stories"),hasEyedropper:!0,allowsOpacity:hasMultiBorderSupport})})]})}BorderStylePanel.displayName="BorderStylePanel";const border=BorderStylePanel;var captionsPanelContent=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/captionsPanelContent.js");const captions_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"captions__StyledButton",componentId:"sc-17zds0n-0"})(["",";"],(({theme})=>outline.L(theme.colors.border.focus,theme.colors.bg.secondary))),UploadButton=(0,styled_components_browser_esm.ZP)(captions_StyledButton).withConfig({displayName:"captions__UploadButton",componentId:"sc-17zds0n-1"})(["padding:12px 8px;"]);var _StyledUploadButton=(0,styled_components_browser_esm.ZP)(UploadButton).withConfig({displayName:"captions___StyledUploadButton",componentId:"sc-17zds0n-2"})(["",""],(p=>p.$_css));const MIN_MAX_ALT_TEXT={MAX:1e3};function CaptionsPanel({selectedElements,pushUpdate}){const tracks=(0,shared.d9)(selectedElements,"tracks",[]),isIndeterminate=tracks===story_editor_src_constants.mh;(0,components_form.pz)((({resource:newResource})=>({resource:{...newResource,alt:newResource.alt?.slice(0,MIN_MAX_ALT_TEXT.MAX)}})),[]);const handleRemoveTrack=(0,react_src.I4)((idToDelete=>{let newTracks=[];if(idToDelete){const trackIndex=tracks.findIndex((({id})=>id===idToDelete));newTracks=[...tracks.slice(0,trackIndex),...tracks.slice(trackIndex+1)]}pushUpdate({tracks:newTracks},!0)}),[tracks,pushUpdate]),handleChangeTrack=(0,react_src.I4)((({src="",id,needsProxy=!1})=>{const newTrack={track:src,trackId:id,id:(0,v4.Z)(),kind:"captions",srclang:"",label:"",needsProxy};pushUpdate({tracks:[newTrack]},!0)}),[pushUpdate]),{highlight,resetHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.Captions],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),renderUploadButton=(0,react_src.I4)((open=>(0,jsx_runtime.jsx)(_StyledUploadButton,{onAnimationEnd:()=>resetHighlight(),ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&node.focus()},onClick:open,type:constants.L$.Secondary,size:constants.qE.Small,variant:constants.Wu.Rectangle,$_css:highlight?.showEffect&&highlights_styles.Z.OUTLINE,children:(0,i18n.__)("Upload a file","web-stories")})),[resetHighlight,highlight?.focus,highlight?.showEffect]);return(0,jsx_runtime.jsx)(captions_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"caption",title:(0,i18n.__)("Caption and Subtitles","web-stories"),isPersistable:!highlight,$_css2:highlight?.showEffect&&highlights_styles.Z.FLASH,children:(0,jsx_runtime.jsx)(captionsPanelContent.Z,{isIndeterminate,tracks:isIndeterminate?[]:tracks,handleChangeTrack,handleRemoveTrack,renderUploadButton})})}CaptionsPanel.displayName="CaptionsPanel";const captions=CaptionsPanel;var captions_StyledSimplePanel=(0,styled_components_browser_esm.ZP)(panel.me).withConfig({displayName:"captions___StyledSimplePanel",componentId:"sc-17zds0n-3"})(["",""],(p=>p.$_css2)),distribute_horizontal=__webpack_require__("./packages/design-system/src/icons/distribute_horizontal.svg"),distribute_vertical=__webpack_require__("./packages/design-system/src/icons/distribute_vertical.svg"),align_left=__webpack_require__("./packages/design-system/src/icons/align_left.svg"),align_center=__webpack_require__("./packages/design-system/src/icons/align_center.svg"),align_right=__webpack_require__("./packages/design-system/src/icons/align_right.svg"),align_top=__webpack_require__("./packages/design-system/src/icons/align_top.svg"),align_middle=__webpack_require__("./packages/design-system/src/icons/align_middle.svg"),align_bottom=__webpack_require__("./packages/design-system/src/icons/align_bottom.svg"),useAlignment=__webpack_require__("./packages/story-editor/src/components/panels/design/alignment/useAlignment.js");const ElementRow=styled_components_browser_esm.ZP.div.withConfig({displayName:"alignment__ElementRow",componentId:"sc-812g1l-0"})(["display:flex;flex-direction:row;justify-content:center;align-items:center;padding:16px;overflow:auto;overflow:overlay;"]),alignmentButtonIds=["distributeHorizontally","distributeVertically","alignLeft","alignCenter","alignRight","alignTop","alignMiddle","alignBottom"],AlignmentButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({variant:constants.Wu.Square,type:constants.L$.Tertiary,size:constants.qE.Small}).withConfig({displayName:"alignment__AlignmentButton",componentId:"sc-812g1l-1"})(["position:relative;:focus{z-index:1;}",";"],(({theme})=>outline.L(theme.colors.border.focus,"#1d1f20"))),StyledPanel=(0,styled_components_browser_esm.ZP)(panel.s_).withConfig({displayName:"alignment__StyledPanel",componentId:"sc-812g1l-2"})(["background-color:",";border-bottom:1px solid ",";"],(({theme})=>theme.colors.opacity.black24),(({theme})=>theme.colors.divider.secondary));function ElementAlignmentPanel({selectedElements,pushUpdate}){const{isRTL}=(0,app.ZR)(),{isDistributionEnabled,handleAlignLeft,handleAlignCenter,handleAlignRight,handleAlignTop,handleAlignMiddle,handleAlignBottom,handleHorizontalDistribution,handleVerticalDistribution}=(0,useAlignment.Z)({selectedElements,updateElements:callback=>pushUpdate(callback,!0)}),ref=(0,react_src.sO)(),[currentButton,setCurrentButton]=(0,react_src.eJ)(null),handleNavigation=(0,react_src.I4)((direction=>()=>{const currentIndex=alignmentButtonIds.findIndex((id=>id===currentButton)),nextButtonId=alignmentButtonIds[currentIndex+direction];nextButtonId&&(setCurrentButton(nextButtonId),ref.current.querySelector(`#${nextButtonId}`).focus())}),[currentButton,setCurrentButton]),forward=isRTL?-1:1;return(0,keyboard.Ew)(ref,"left",(()=>handleNavigation(forward)),[handleNavigation,forward]),(0,keyboard.Ew)(ref,"right",(()=>handleNavigation(-forward)),[handleNavigation,forward]),(0,jsx_runtime.jsx)(StyledPanel,{name:"alignment",canCollapse:!1,ariaLabel:(0,i18n.__)("Alignment","web-stories"),children:(0,jsx_runtime.jsxs)(ElementRow,{ref,children:[(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Distribute horizontally","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{disabled:!isDistributionEnabled,onClick:handleHorizontalDistribution,"aria-label":(0,i18n.__)("Distribute horizontally","web-stories"),id:alignmentButtonIds[0],onFocus:()=>setCurrentButton(alignmentButtonIds[0]),children:(0,jsx_runtime.jsx)(distribute_horizontal.Z,{})})}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Distribute vertically","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{disabled:!isDistributionEnabled,onClick:handleVerticalDistribution,"aria-label":(0,i18n.__)("Distribute vertically","web-stories"),id:alignmentButtonIds[1],onFocus:()=>setCurrentButton(alignmentButtonIds[1]),children:(0,jsx_runtime.jsx)(distribute_vertical.Z,{})})}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Align left","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{onClick:handleAlignLeft,"aria-label":(0,i18n.__)("Align left","web-stories"),id:alignmentButtonIds[2],onFocus:()=>setCurrentButton(alignmentButtonIds[2]),children:(0,jsx_runtime.jsx)(align_left.Z,{})})}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Align center","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{onClick:handleAlignCenter,"aria-label":(0,i18n.__)("Align center","web-stories"),id:alignmentButtonIds[3],onFocus:()=>setCurrentButton(alignmentButtonIds[3]),children:(0,jsx_runtime.jsx)(align_center.Z,{})})}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Align right","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{onClick:handleAlignRight,"aria-label":(0,i18n.__)("Align right","web-stories"),id:alignmentButtonIds[4],onFocus:()=>setCurrentButton(alignmentButtonIds[4]),children:(0,jsx_runtime.jsx)(align_right.Z,{})})}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Align top","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{onClick:handleAlignTop,"aria-label":(0,i18n.__)("Align top","web-stories"),id:alignmentButtonIds[5],onFocus:()=>setCurrentButton(alignmentButtonIds[5]),children:(0,jsx_runtime.jsx)(align_top.Z,{})})}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Align vertical center","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{onClick:handleAlignMiddle,"aria-label":(0,i18n.__)("Align vertical center","web-stories"),id:alignmentButtonIds[6],onFocus:()=>setCurrentButton(alignmentButtonIds[6]),children:(0,jsx_runtime.jsx)(align_middle.Z,{})})}),(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Align bottom","web-stories"),children:(0,jsx_runtime.jsx)(AlignmentButton,{onClick:handleAlignBottom,"aria-label":(0,i18n.__)("Align bottom","web-stories"),id:alignmentButtonIds[7],onFocus:()=>setCurrentButton(alignmentButtonIds[7]),children:(0,jsx_runtime.jsx)(align_bottom.Z,{})})})]})})}ElementAlignmentPanel.displayName="ElementAlignmentPanel";const alignment=ElementAlignmentPanel;const filter_convertOverlay=function convertOverlay(currentOverlay,currentType,newType){switch(newType){case elements_src.j2.NONE:return null;case elements_src.j2.SOLID:return function convertToSolid(currentOverlay,currentType){switch(currentType){case elements_src.j2.NONE:return{color:{r:0,g:0,b:0,a:.5}};case elements_src.j2.LINEAR:case elements_src.j2.RADIAL:{const{stops}=currentOverlay,stopsByAlpha=stops.slice().sort(((x,y)=>(y.color.a??1)-(x.color.a??1))),{color:{r,g,b}}=stopsByAlpha[0];return{color:{r,g,b,a:.5}}}default:return currentOverlay}}(currentOverlay,currentType);case elements_src.j2.LINEAR:return function convertToLinear(currentOverlay,currentType){switch(currentType){case elements_src.j2.NONE:return{type:"linear",rotation:0,stops:[{color:{r:0,g:0,b:0,a:0},position:0},{color:{r:0,g:0,b:0,a:1},position:1}],alpha:.7};case elements_src.j2.SOLID:{const{color:{r,g,b,a}}=currentOverlay;return{type:"linear",rotation:0,stops:[{color:{r,g,b,a:0},position:.4},{color:{r,g,b,a:1},position:1}],alpha:a}}case elements_src.j2.RADIAL:{const{stops,alpha}=currentOverlay;return{type:"linear",rotation:0,stops,alpha}}default:return currentOverlay}}(currentOverlay,currentType);case elements_src.j2.RADIAL:return function convertToRadial(currentOverlay,currentType){switch(currentType){case elements_src.j2.NONE:return{type:"radial",size:{w:.67,h:.67},stops:[{color:{r:0,g:0,b:0,a:0},position:0},{color:{r:0,g:0,b:0,a:1},position:1}],alpha:.7};case elements_src.j2.SOLID:{const{color:{r,g,b,a}}=currentOverlay;return{type:"radial",size:{w:.67,h:.67},stops:[{color:{r,g,b,a:0},position:0},{color:{r,g,b,a:1},position:1}],alpha:a}}case elements_src.j2.LINEAR:{const{stops,alpha}=currentOverlay;return{type:"radial",size:{w:.67,h:.67},stops,alpha}}default:return currentOverlay}}(currentOverlay,currentType);default:return currentOverlay}},OverlayPreset={[elements_src.j2.NONE]:{label:(0,i18n._x)("None","overlay","web-stories")},[elements_src.j2.SOLID]:{label:(0,i18n.__)("Tint","web-stories")},[elements_src.j2.LINEAR]:{label:(0,i18n.__)("Linear","web-stories")},[elements_src.j2.RADIAL]:{label:(0,i18n.__)("Vignette","web-stories")}};function FilterPanel({selectedElements,pushUpdate}){const overlay=(0,shared.x2)(selectedElements,"overlay"),isMultiple=overlay===story_editor_src_constants.mh,overlayType=overlay?overlay.type||elements_src.j2.SOLID:elements_src.j2.NONE,{getProxiedUrl}=(0,useCORSProxy.Z)(),{isDefaultBackground}=selectedElements[0],currentPageBackgroundColor=(0,app.rB)((v=>!isDefaultBackground||v.state.currentPage?.backgroundColor)),updateOverlay=(0,react_src.I4)((value=>pushUpdate({overlay:value},!0)),[pushUpdate]),hasEyedropper=overlayType!==elements_src.j2.RADIAL&&overlayType!==elements_src.j2.LINEAR,{LayerIcon}=(0,elements_src.Do)(selectedElements[0].type);return(0,jsx_runtime.jsxs)(panel.me,{name:"filter",title:(0,i18n.__)("Filters","web-stories"),children:[!isMultiple&&(0,jsx_runtime.jsx)(components_form.X2,{children:Object.keys(OverlayPreset).map((type=>{const{label}=OverlayPreset[type];return(0,jsx_runtime.jsx)(components_form.Nz,{element:selectedElements[0],label,isToggled:overlayType===type,onClick:()=>updateOverlay(filter_convertOverlay(overlay,overlayType,type)),filter:filter_convertOverlay(overlay,elements_src.j2.NONE,type),"aria-label":(0,sprintf.Z)((0,i18n.__)("Filter: %s","web-stories"),label),children:(0,jsx_runtime.jsx)(LayerIcon,{element:selectedElements[0],getProxiedUrl,currentPageBackgroundColor})},type)}))}),overlayType!==elements_src.j2.NONE&&(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(components_form.Il,{label:(0,i18n.__)("Color","web-stories"),value:overlay,onChange:updateOverlay,allowsGradient:!0,hasEyedropper})})]})}FilterPanel.displayName="FilterPanel";const filter=FilterPanel,imageAccessibility_StyledText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"imageAccessibility__StyledText",componentId:"sc-147toy8-0"})(["color:",";margin-bottom:10px;"],(({theme})=>theme.colors.fg.secondary)),DEFAULT_RESOURCE={alt:null},imageAccessibility_MIN_MAX_ALT_TEXT={MAX:1e3};function ImageAccessibilityPanel({selectedElements,pushUpdate}){const resource=(0,shared.cn)(selectedElements,"resource",DEFAULT_RESOURCE),alt=(0,shared.d9)(selectedElements,"alt",resource.alt),{highlight,resetHighlight,cancelHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.AssistiveText],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));return(0,jsx_runtime.jsxs)(imageAccessibility_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"imageAccessibility",title:(0,i18n.__)("Accessibility","web-stories"),isPersistable:!highlight,$_css:highlight&&highlights_styles.Z.FLASH,children:[(0,jsx_runtime.jsx)(imageAccessibility_StyledText,{size:types.TextSize.Small,children:(0,i18n.__)("Add a brief description of the image.","web-stories")}),(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(components_form.Kx,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},placeholder:alt===story_editor_src_constants.mh?story_editor_src_constants.nz:"",value:alt||"",onChange:evt=>pushUpdate({alt:evt?.target?.value?.trim()||null},!0),"aria-label":(0,i18n.__)("Assistive text","web-stories"),maxLength:imageAccessibility_MIN_MAX_ALT_TEXT.MAX,rows:2,isIndeterminate:alt===story_editor_src_constants.mh})})]})}ImageAccessibilityPanel.displayName="ImageAccessibilityPanel";const imageAccessibility=ImageAccessibilityPanel;var imageAccessibility_StyledSimplePanel=(0,styled_components_browser_esm.ZP)(panel.me).withConfig({displayName:"imageAccessibility___StyledSimplePanel",componentId:"sc-147toy8-1"})(["",""],(p=>p.$_css)),src_url=__webpack_require__("./packages/url/src/url.ts"),useElementsWithLinks=__webpack_require__("./packages/story-editor/src/utils/useElementsWithLinks.ts"),elementLink=__webpack_require__("./packages/story-editor/src/components/elementLink/index.js");const IconInfo=styled_components_browser_esm.ZP.div.withConfig({displayName:"link__IconInfo",componentId:"sc-niusn4-0"})(["display:flex;flex-direction:column;margin-left:20px;"]),IconText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"link__IconText",componentId:"sc-niusn4-1"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),link_Error=styled_components_browser_esm.ZP.span.withConfig({displayName:"link__Error",componentId:"sc-niusn4-2"})(["font-size:12px;line-height:16px;color:",";"],(({theme})=>theme.colors.fg.negative)),StyledSwitch=(0,styled_components_browser_esm.ZP)(components_form.rs).withConfig({displayName:"link__StyledSwitch",componentId:"sc-niusn4-3"})(["width:100%;"]);function LinkPanel({selectedElements,pushUpdateForObject}){const{clearEditing,setDisplayLinkGuidelines,displayLinkGuidelines}=(0,app.$P)((state=>({clearEditing:state.actions.clearEditing,setDisplayLinkGuidelines:state.actions.setDisplayLinkGuidelines,displayLinkGuidelines:state.state.displayLinkGuidelines}))),{highlight,resetHighlight,cancelHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.Link],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),pages=(0,app.rB)((({state})=>state?.pages?.map((({id},index)=>({value:id,label:(0,sprintf.Z)((0,i18n.__)("Page %s","web-stories"),index+1)}))).filter((({value})=>value!==state.currentPage?.id))||[])),{hasElementsInAttachmentArea}=(0,useElementsWithLinks.Z)(),defaultLink=(0,react_src.Ye)((()=>(0,elementLink.E)({icon:null,desc:null})),[]),linkRaw=(0,shared.cn)(selectedElements,"link",defaultLink),link=(0,elementLink.E)(linkRaw),{url="",desc="",icon,rel=[],type:linkType=elements_src.Un.Regular,pageId=null}=link,[fetchingMetadata,setFetchingMetadata]=(0,react_src.eJ)(!1),[isLinkFocused,setIsLinkFocused]=(0,react_src.eJ)(!1),{actions:{getLinkMetadata}}=(0,app.Ek)(),{getProxiedUrl,checkResourceAccess}=(0,useCORSProxy.Z)(),updateLinkFromMetadataApi=(0,react_src.iS)((({newUrl,newTitle,newIcon,needsProxy})=>pushUpdateForObject("link",(()=>newUrl?(0,elementLink.E)({url:newUrl,needsProxy,desc:newTitle||"",icon:newIcon?(0,src_url.BY)(newUrl,newIcon):""}):null),defaultLink,!0)),[pushUpdateForObject,defaultLink]),[isInvalidUrl,setIsInvalidUrl]=(0,react_src.eJ)(!(0,src_url.jv)((0,src_url.Ac)(url))),populateMetadata=(0,react_src.y1)((0,react_src.I4)((async newUrl=>{if(newUrl.startsWith("http://")||newUrl.startsWith("https://")){setFetchingMetadata(!0);try{const{title:newTitle,image:newIcon}=getLinkMetadata?await getLinkMetadata(newUrl):{},needsProxy=!!newIcon&&await checkResourceAccess(newIcon);updateLinkFromMetadataApi({newUrl,newTitle,newIcon,needsProxy})}catch(e){setIsInvalidUrl(!0)}finally{setFetchingMetadata(!1)}}}),[checkResourceAccess,getLinkMetadata,updateLinkFromMetadataApi]),1200),handleChange=(0,react_src.I4)(((properties,submit)=>{if(clearEditing(),populateMetadata.cancel(),properties.url){if(story_editor_src_constants.mh===properties.url)return;const urlWithProtocol=(0,src_url.Ac)(properties.url),valid=(0,src_url.jv)(urlWithProtocol);setIsInvalidUrl(!valid),valid&&populateMetadata(urlWithProtocol)}pushUpdateForObject("link",""!==properties.url?{...properties}:null,defaultLink,submit)}),[clearEditing,pushUpdateForObject,defaultLink,populateMetadata]),handleChangeIcon=(0,react_src.I4)((resource=>{handleChange({icon:resource?.src},!0)}),[handleChange]),hasLinkSet=Boolean(url?.length),displayMetaFields=hasLinkSet&&!isInvalidUrl||linkType===elements_src.Un.Branching&&pageId;(0,react_src.d4)((()=>{if(isLinkFocused){const hasLink=hasLinkSet&&url!==story_editor_src_constants.mh;setDisplayLinkGuidelines(hasElementsInAttachmentArea&&!hasLink)}}),[selectedElements,isLinkFocused,hasElementsInAttachmentArea,hasLinkSet,setDisplayLinkGuidelines,url]);const linkIcon=icon?getProxiedUrl(link,icon):null,isMultipleLinkType=story_editor_src_constants.mh===linkType,isMultiplePageId=story_editor_src_constants.mh===pageId,isMultipleUrl=story_editor_src_constants.mh===url,isMultipleDesc=story_editor_src_constants.mh===desc,isMultipleRel=story_editor_src_constants.mh===rel,onChangeRel=(0,react_src.I4)((newRel=>handleChange({rel:newRel},!0)),[handleChange]),onChangeLinkType=(0,react_src.I4)((()=>{handleChange({type:linkType===elements_src.Un.Regular?elements_src.Un.Branching:elements_src.Un.Regular},!0)}),[handleChange,linkType]),onChangePageId=(0,react_src.I4)(((_event,value)=>{handleChange({pageId:value},!0)}),[handleChange]);return(0,jsx_runtime.jsxs)(link_StyledSimplePanel,{name:"link",title:(0,i18n.__)("Link","web-stories"),onAnimationEnd:()=>resetHighlight(),isPersistable:!highlight,$_css:highlight?.showEffect&&highlights_styles.Z.FLASH,children:[(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(StyledSwitch,{groupLabel:(0,i18n.__)("Link Type","web-stories"),name:"link-type-switch",value:linkType===elements_src.Un.Regular,onLabel:(0,i18n.__)("Link to website","web-stories"),offLabel:(0,i18n.__)("Link to story page","web-stories"),disabled:isMultipleLinkType,onChange:onChangeLinkType})}),linkType===elements_src.Un.Branching?(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(dropdown.Z,{ariaLabel:(0,i18n.__)("Page","web-stories"),dropDownLabel:(0,i18n.__)("Page","web-stories"),placeholder:(0,i18n.__)("Select Page","web-stories"),options:pages,placement:popup_constants.ug.TopStart,onMenuItemClick:onChangePageId,selectedValue:pageId,disabled:!pages.length||isMultiplePageId})}):(0,jsx_runtime.jsx)(components_form.R,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},onChange:value=>!displayLinkGuidelines&&handleChange({url:value},!value),onBlur:()=>{setDisplayLinkGuidelines(!1),setIsLinkFocused(!1)},onFocus:()=>{setIsLinkFocused(!0)},value:url||"",placeholder:isMultipleUrl?story_editor_src_constants.nz:(0,i18n.__)("Enter an address to apply a link","web-stories"),isIndeterminate:isMultipleUrl,"aria-label":(0,i18n.__)("Element link","web-stories"),hasError:displayLinkGuidelines}),displayLinkGuidelines&&(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(link_Error,{children:(0,i18n.__)("Link can not reside below the dashed line when a page attachment is present","web-stories")})}),displayMetaFields&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(input_input.Z,{placeholder:isMultipleDesc?story_editor_src_constants.nz:(0,i18n.__)("Optional description","web-stories"),onChange:({target})=>handleChange({desc:target.value},!target.value),value:desc,"aria-label":(0,i18n.__)("Link description","web-stories"),isIndeterminate:isMultipleDesc,disabled:fetchingMetadata,containerStyleOverride:shared_styles.O})}),(0,jsx_runtime.jsxs)(components_form.X2,{spaceBetween:!1,children:[(0,jsx_runtime.jsx)(components_form.xP,{handleChange:handleChangeIcon,icon:linkIcon,isLoading:fetchingMetadata,disabled:fetchingMetadata}),(0,jsx_runtime.jsx)(IconInfo,{children:(0,jsx_runtime.jsx)(IconText,{size:types.TextSize.Small,children:(0,i18n.__)("Optional brand icon","web-stories")})})]}),!isMultipleRel&&linkType===elements_src.Un.Regular&&(0,jsx_runtime.jsx)(shared.L7,{onChangeRel,rel})]})]})}LinkPanel.displayName="LinkPanel";const link_link=LinkPanel;var link_StyledSimplePanel=(0,styled_components_browser_esm.ZP)(panel.me).withConfig({displayName:"link___StyledSimplePanel",componentId:"sc-niusn4-4"})(["",""],(p=>p.$_css)),generalPageAdvancement=__webpack_require__("./packages/story-editor/src/components/panels/shared/generalPageAdvancement.js");function CustomPageAdvancementPanel(){const{isOverridden,autoAdvance,pageDuration,updateCurrentPageProperties}=(0,app_story.rB)((({state:{story:{autoAdvance:defaultAutoAdvance,defaultPageDuration},currentPage:{advancement}},actions:{updateCurrentPageProperties}})=>({isOverridden:"object"==typeof advancement,autoAdvance:advancement?.autoAdvance??defaultAutoAdvance,pageDuration:advancement?.pageDuration??defaultPageDuration,updateCurrentPageProperties}))),onUpdate=(0,react_src.I4)((properties=>{if(!1===properties.override)updateCurrentPageProperties({properties:{advancement:void 0}});else{const{override,...rest}=properties,advancement={autoAdvance,pageDuration,...rest};updateCurrentPageProperties({properties:{advancement}})}}),[autoAdvance,pageDuration,updateCurrentPageProperties]);return(0,jsx_runtime.jsx)(generalPageAdvancement.Z,{panelName:"customPageAdvancement",onUpdate,autoAdvance,pageDuration,hasOverrideEnabled:isOverridden,allowsOverride:!0,collapsedByDefault:!0,children:(0,i18n.__)("Control whether this page auto-advances to the next page, or whether the reader has to manually tap to advance.","web-stories")})}CustomPageAdvancementPanel.displayName="CustomPageAdvancementPanel";const customPageAdvancement=CustomPageAdvancementPanel,shared_Label=styled_components_browser_esm.ZP.label.withConfig({displayName:"shared__Label",componentId:"sc-zfap6q-0"})(["margin-left:12px;"]),StyledCheckbox=(0,styled_components_browser_esm.ZP)(checkbox_checkbox.Z).withConfig({displayName:"shared__StyledCheckbox",componentId:"sc-zfap6q-1"})(["",""],(({theme})=>`\n    input[type='checkbox']:focus-visible ~ div, input[type='checkbox']:focus ~ div {\n      box-shadow: 0px 0px 0 2px ${theme.colors.bg.secondary}, 0px 0px 0 4px ${theme.colors.border.focus} !important;\n    }\n  `)),shared_StyledRow=(0,styled_components_browser_esm.ZP)(components_form.X2).withConfig({displayName:"shared__StyledRow",componentId:"sc-zfap6q-2"})(["justify-content:flex-start;"]),Space=styled_components_browser_esm.ZP.div.withConfig({displayName:"shared__Space",componentId:"sc-zfap6q-3"})(["width:20px;"]);function CallToActionText({value,defaultValue,onChange}){const[text,setText]=(0,react_src.eJ)(value||defaultValue),debouncedUpdate=(0,react_src.y1)(onChange,300),handleBlur=(0,react_src.I4)((({target})=>{target.value?(debouncedUpdate.cancel(),onChange({ctaText:text||void 0})):(onChange({ctaText:void 0}),setText(defaultValue))}),[text,debouncedUpdate,defaultValue,onChange]),handleChangeCta=(0,react_src.I4)((({target})=>{const{value:newText}=target;setText(newText),debouncedUpdate({ctaText:newText})}),[debouncedUpdate]),isDefault=value===defaultValue;return(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(input_input.Z,{onChange:handleChangeCta,onBlur:handleBlur,value:text,"aria-label":(0,i18n.__)("Call to Action text","web-stories"),suffix:isDefault?(0,i18n.__)("Default","web-stories"):null})})}function Theme({theme,onChange}){const checkboxId=`cb-${(0,v4.Z)()}`,handleChangeTheme=(0,react_src.I4)((evt=>{onChange({theme:evt.target.checked?story_editor_src_constants.dZ.DARK:story_editor_src_constants.dZ.LIGHT})}),[onChange]);return(0,jsx_runtime.jsxs)(shared_StyledRow,{children:[(0,jsx_runtime.jsx)(StyledCheckbox,{id:checkboxId,checked:theme===story_editor_src_constants.dZ.DARK,onChange:handleChangeTheme}),(0,jsx_runtime.jsx)(shared_Label,{htmlFor:checkboxId,children:(0,jsx_runtime.jsx)(typography_text.x.Span,{size:types.TextSize.Small,children:(0,i18n.__)("Use dark theme","web-stories")})})]})}function Icon({icon,onChange,isFetching,needsProxy}){const{getProxiedUrl}=(0,useCORSProxy.Z)(),handleChangeIcon=(0,react_src.I4)((resource=>{onChange({icon:resource?.src},!0)}),[onChange]),iconUrl=icon?getProxiedUrl({needsProxy},icon):null;return(0,jsx_runtime.jsxs)(shared_StyledRow,{children:[(0,jsx_runtime.jsx)(components_form.xP,{handleChange:handleChangeIcon,icon:iconUrl,isLoading:isFetching,disabled:isFetching}),(0,jsx_runtime.jsx)(Space,{}),(0,jsx_runtime.jsx)(typography_text.x.Span,{size:types.TextSize.Small,children:(0,i18n.__)("Link icon","web-stories")})]})}function LinkUrl({value,onChange,setIsInvalidUrl,setIsFetching,onFocus,hint,hasError}){const{actions:{getLinkMetadata}}=(0,app.Ek)(),[_url,_setUrl]=(0,react_src.eJ)(value),debouncedUpdate=(0,react_src.y1)(onChange,300),{checkResourceAccess}=(0,useCORSProxy.Z)(),populateUrlData=(0,react_src.y1)((0,react_src.I4)((async newValue=>{if(newValue.startsWith("http://")||newValue.startsWith("https://")){setIsFetching(!0);try{const{image}=getLinkMetadata?await getLinkMetadata(newValue):{},iconUrl=image?(0,src_url.BY)(newValue,image):"",needsProxy=!!iconUrl&&await checkResourceAccess(iconUrl);onChange({url:newValue,icon:iconUrl,needsProxy})}catch(e){onChange({url:newValue,icon:"",needsProxy:!1}),setIsInvalidUrl(!0)}finally{setIsFetching(!1)}}}),[checkResourceAccess,getLinkMetadata,onChange,setIsFetching,setIsInvalidUrl]),1200),handleChangeUrl=(0,react_src.I4)((newValue=>{populateUrlData.cancel(),_setUrl(newValue),setIsInvalidUrl(!1);const urlWithProtocol=(0,src_url.Ac)(newValue.trim());(0,src_url.jv)(urlWithProtocol)&&populateUrlData(urlWithProtocol)}),[populateUrlData,setIsInvalidUrl]),onBlur=(0,react_src.I4)((()=>{debouncedUpdate.cancel(),onChange({url:_url?.trim().length?(0,src_url.Ac)(_url.trim()):""})}),[_url,debouncedUpdate,onChange]);return(0,jsx_runtime.jsx)(components_form.R,{onChange:newValue=>handleChangeUrl(newValue?.trim()),onBlur,onFocus,value:_url,clear:!0,"aria-label":(0,i18n.__)("Type an address to add a page attachment link","web-stories"),hasError,hint})}CallToActionText.displayName="CallToActionText",Theme.displayName="Theme",Icon.displayName="Icon",LinkUrl.displayName="LinkUrl";const outlink=function Outlink({pageAttachment,updatePageAttachment}){const{setDisplayLinkGuidelines}=(0,app.$P)((state=>({setDisplayLinkGuidelines:state.actions.setDisplayLinkGuidelines}))),{url,ctaText,icon,theme,rel=[],needsProxy}=pageAttachment,[displayWarning,setDisplayWarning]=(0,react_src.eJ)(!1),[isFetching,setIsFetching]=(0,react_src.eJ)(!1),[isInvalidUrl,setIsInvalidUrl]=(0,react_src.eJ)(url&&!(0,src_url.jv)((0,src_url.Ac)(url).trim())),hasValidUrl=Boolean(url)&&!isInvalidUrl,{hasLinksInAttachmentArea}=(0,useElementsWithLinks.Z)();(0,react_src.d4)((()=>()=>{setDisplayLinkGuidelines(!1)}),[hasLinksInAttachmentArea,setDisplayLinkGuidelines,url]);const onFocus=(0,react_src.I4)((()=>{hasLinksInAttachmentArea&&!url?.length&&(setDisplayWarning(!0),setDisplayLinkGuidelines(!0))}),[hasLinksInAttachmentArea,setDisplayLinkGuidelines,url?.length]);(0,react_src.d4)((()=>{displayWarning&&url?.length&&setDisplayWarning(!1)}),[url,displayWarning]);const onChangeRel=(0,react_src.I4)((newRel=>updatePageAttachment({rel:newRel},!0)),[updatePageAttachment]);let hint;const hasError=displayWarning||isInvalidUrl;return hasError&&(hint=displayWarning?(0,i18n.__)("Links cannot reside below the dashed line when a page attachment is present. If you add a page attachment, your viewers will not be able to click on the link.","web-stories"):(0,i18n.__)("Invalid link","web-stories")),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LinkUrl,{value:url,onChange:updatePageAttachment,isFetching,setIsFetching,setIsInvalidUrl,hint,onFocus,hasError}),hasValidUrl&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CallToActionText,{value:ctaText,defaultValue:(0,i18n.__)("Learn more","web-stories"),onChange:updatePageAttachment}),(0,jsx_runtime.jsx)(Theme,{theme,onChange:updatePageAttachment})]}),hasValidUrl&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Icon,{icon,isFetching,needsProxy,onChange:updatePageAttachment}),(0,jsx_runtime.jsx)(shared.L7,{onChangeRel,rel})]})]})},shoppingAttachment_HelperText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"shoppingAttachment__HelperText",componentId:"sc-fsu1pn-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary));const pageAttachment_shoppingAttachment=function ShoppingAttachment({shoppingAttachment,updateShoppingAttachment}){const{ctaText,theme}=shoppingAttachment;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(shoppingAttachment_HelperText,{children:(0,i18n.__)("Since there are products on this page, you cannot add a regular page attachment, but only customize the appearance of the shopping call to action.","web-stories")})}),(0,jsx_runtime.jsx)(CallToActionText,{value:ctaText,defaultValue:(0,i18n.__)("Shop Now","web-stories"),onChange:updateShoppingAttachment}),(0,jsx_runtime.jsx)(Theme,{theme,onChange:updateShoppingAttachment})]})};function PageAttachmentPanel(){const{pageAttachment,shoppingAttachment,updateCurrentPageProperties,hasProducts}=(0,app.rB)((({state,actions})=>({updateCurrentPageProperties:actions.updateCurrentPageProperties,currentPage:state.currentPage,pageAttachment:state.currentPage.pageAttachment||{},shoppingAttachment:state.currentPage.shoppingAttachment||{},hasProducts:state.currentPage.elements?.some((({type,product})=>type===elements_src.Yj.PRODUCT&&product?.productId))}))),updateShoppingAttachment=(0,react_src.I4)((value=>{updateCurrentPageProperties({properties:{shoppingAttachment:{...shoppingAttachment,...value}}})}),[updateCurrentPageProperties,shoppingAttachment]),updatePageAttachment=(0,react_src.I4)((value=>{updateCurrentPageProperties({properties:{pageAttachment:{...pageAttachment,...value}}})}),[updateCurrentPageProperties,pageAttachment]);return(0,jsx_runtime.jsxs)(panel.me,{name:"pageAttachment",title:(0,i18n.__)("Call to Action","web-stories"),collapsedByDefault:!1,children:[hasProducts&&(0,jsx_runtime.jsx)(pageAttachment_shoppingAttachment,{shoppingAttachment,updateShoppingAttachment}),!hasProducts&&(0,jsx_runtime.jsx)(outlink,{pageAttachment,updatePageAttachment})]})}PageAttachmentPanel.displayName="PageAttachmentPanel";const pageAttachment=PageAttachmentPanel;var getElementProperties=__webpack_require__("./packages/story-editor/src/components/canvas/utils/getElementProperties.ts");const DEFAULT_FLIP={horizontal:!1,vertical:!1},Row=(0,styled_components_browser_esm.ZP)(components_form.X2).withConfig({displayName:"pageBackground__Row",componentId:"sc-1rac0x7-0"})(["justify-content:flex-start;"]),SelectedMedia=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageBackground__SelectedMedia",componentId:"sc-1rac0x7-1"})(["width:128px;height:36px;border-radius:4px;border:1px solid ",";display:flex;justify-content:space-between;margin-right:12px;"],(({theme})=>theme.colors.border.defaultNormal)),MediaWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageBackground__MediaWrapper",componentId:"sc-1rac0x7-2"})(["height:24px;width:24px;border-radius:4px;overflow:hidden;margin:5px;img{object-fit:cover;max-height:100%;max-width:100%;}"]),RemoveButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"pageBackground__RemoveButton",componentId:"sc-1rac0x7-3"})(["margin:1px;align-self:center;"]),ReplaceButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({size:constants.qE.Small,variant:constants.Wu.Square,type:constants.L$.Tertiary}).withConfig({displayName:"pageBackground__ReplaceButton",componentId:"sc-1rac0x7-4"})(["margin-right:8px;"]),Text=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"pageBackground__Text",componentId:"sc-1rac0x7-5"})(["align-self:center;width:55px;"]);function PageBackgroundPanel({selectedElements,pushUpdate}){const{isDefaultBackground}=selectedElements[0],{combineElements,currentPage,clearBackgroundElement,updateCurrentPageProperties,currentPageBackgroundColor}=(0,app.rB)((({state,actions})=>({currentPage:state.currentPage,clearBackgroundElement:actions.clearBackgroundElement,combineElements:actions.combineElements,updateCurrentPageProperties:actions.updateCurrentPageProperties,currentPageBackgroundColor:!isDefaultBackground||state.currentPage?.backgroundColor}))),{getProxiedUrl}=(0,useCORSProxy.Z)(),{capabilities:{hasUploadMediaAction}}=(0,app.ZR)(),pageSize=(0,app.$Y)((({state:{pageWidth,pageHeight}})=>({width:pageWidth,height:pageHeight}))),[failedContrast,setFailedContrast]=(0,react_src.eJ)(!1),updateBackgroundColor=(0,react_src.I4)((value=>{updateCurrentPageProperties({properties:{backgroundColor:value}})}),[updateCurrentPageProperties]),removeAsBackground=(0,react_src.I4)((()=>{pushUpdate({isBackground:!1,opacity:100},!0),clearBackgroundElement()}),[pushUpdate,clearBackgroundElement]),onSelect=(0,react_src.I4)((resource=>{const element=(0,elements_src.vy)(resource.type,(0,getElementProperties.Z)(resource.type,{resource}));combineElements({firstElement:element,secondId:selectedElements[0].id}),(0,tracking_src.L9)("replace_background_media")}),[combineElements,selectedElements]),renderReplaceButton=(0,react_src.I4)((open=>(0,jsx_runtime.jsx)(ReplaceButton,{onClick:open,"aria-label":(0,i18n.__)("Replace","web-stories"),children:(0,jsx_runtime.jsx)(arrow_cloud.Z,{})})),[]),{highlight,resetHighlight,cancelHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.PageBackground],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));(0,react_src.d4)((()=>{(0,checklist.c_)([currentPage],pageSize).then((failedPages=>{const result=failedPages[0]?.result,isBackgroundElement=result?.some((({isBackground})=>isBackground));setFailedContrast(Boolean(isBackgroundElement))})).catch(noop.Z)}),[currentPage,pageSize]);const backgroundEl=selectedElements[0];if(!backgroundEl||!backgroundEl.isBackground)return null;const isMedia=backgroundEl.isBackground&&!isDefaultBackground,{backgroundColor}=currentPage,{LayerIcon}=(0,elements_src.Do)(backgroundEl.type),flip=selectedElements[0]?.flip||DEFAULT_FLIP;return(0,jsx_runtime.jsxs)(pageBackground_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"pageBackground",title:(0,i18n.__)("Page Background","web-stories"),isPersistable:!highlight,collapsedByDefault:!1,$_css:highlight?.showEffect&&highlights_styles.Z.FLASH,children:[isDefaultBackground&&(0,jsx_runtime.jsx)(Row,{children:(0,jsx_runtime.jsx)(components_form.Il,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},allowsGradient:!0,value:backgroundColor,onChange:updateBackgroundColor,label:(0,i18n.__)("Background color","web-stories"),allowsSavedColors:!0,allowsOpacity:!1})}),isMedia&&(0,jsx_runtime.jsxs)(Row,{expand:!1,children:[(0,jsx_runtime.jsxs)(SelectedMedia,{children:[(0,jsx_runtime.jsx)(MediaWrapper,{children:(0,jsx_runtime.jsx)(LayerIcon,{element:backgroundEl,getProxiedUrl,currentPageBackgroundColor})}),(0,jsx_runtime.jsx)(Text,{size:types.TextSize.Small,children:(0,i18n.__)("Media","web-stories")}),(0,jsx_runtime.jsx)(RemoveButton,{"aria-label":(0,i18n.__)("Detach background","web-stories"),onClick:removeAsBackground,size:constants.qE.Small,variant:constants.Wu.Square,type:constants.L$.Tertiary,children:(0,jsx_runtime.jsx)(cross.Z,{})})]}),hasUploadMediaAction&&(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Replace","web-stories"),children:(0,jsx_runtime.jsx)(components_form.Y8,{buttonInsertText:(0,i18n.__)("Use as background","web-stories"),onInsert:onSelect,renderButton:renderReplaceButton})}),(0,jsx_runtime.jsx)(shared.z0,{onChange:value=>pushUpdate({flip:value},!0),value:flip})]}),failedContrast&&(0,jsx_runtime.jsx)(warning,{message:checklist.Iy.lowContrast.backgroundPanel})]})}PageBackgroundPanel.displayName="PageBackgroundPanel";const pageBackground=PageBackgroundPanel;var pageBackground_StyledSimplePanel=(0,styled_components_browser_esm.ZP)(panel.me).withConfig({displayName:"pageBackground___StyledSimplePanel",componentId:"sc-1rac0x7-6"})(["",""],(p=>p.$_css));function ShapeStylePanel({selectedElements,pushUpdate}){const backgroundColor=(0,shared.d9)(selectedElements,"backgroundColor"),onChange=(0,react_src.I4)((value=>{pushUpdate({backgroundColor:value},!0)}),[pushUpdate]),{highlight,resetHighlight,cancelHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.Style],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));return(0,jsx_runtime.jsx)(shapeStyle_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"shapeStyle",title:(0,i18n.__)("Color","web-stories"),isPersistable:!highlight,"aria-labelledby":null,"aria-label":(0,i18n.__)("Shape style","web-stories"),$_css:highlight?.showEffect&&highlights_styles.Z.FLASH,children:(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(components_form.Il,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},allowsGradient:!0,value:backgroundColor,isMultiple:""===backgroundColor,onChange,label:(0,i18n.__)("Background color","web-stories"),allowsSavedColors:!0})})})}ShapeStylePanel.displayName="ShapeStylePanel";const shapeStyle=ShapeStylePanel;var shapeStyle_StyledSimplePanel=(0,styled_components_browser_esm.ZP)(panel.me).withConfig({displayName:"shapeStyle___StyledSimplePanel",componentId:"sc-1ekkvr9-0"})(["",""],(p=>p.$_css)),calcRotatedObjectPositionAndSize=__webpack_require__("./packages/units/src/calcRotatedObjectPositionAndSize.ts"),angle=__webpack_require__("./packages/design-system/src/icons/angle.svg"),flipControls=__webpack_require__("./packages/story-editor/src/components/panels/shared/flipControls.js"),usePerformanceTracking=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),usePresubmitHandler=__webpack_require__("./packages/story-editor/src/components/form/usePresubmitHandler.js");const constants_MIN_MAX={ROTATION:{MIN:-360,MAX:360},WIDTH:{MIN:1,MAX:1e3},HEIGHT:{MIN:1,MAX:1e3},X:{MIN:1,MAX:src_constants.JN-1},Y:{MIN:1-Math.floor(src_constants.Z5),MAX:src_constants.r_+Math.floor(src_constants.Z5)-1}},constants_DEFAULT_FLIP={horizontal:!1,vertical:!1};function isNum(v){return"number"==typeof v&&!isNaN(v)}const sizePosition_usePresubmitHandlers=function usePresubmitHandlers(lockAspectRatio,height,width){(0,usePresubmitHandler.Z)(((newElement,{width:newWidth,height:newHeight},{width:oldWidth,height:oldHeight})=>{const{type}=newElement,isResizeWidth=Boolean(newWidth),isResizeHeight=Boolean(newHeight);if(!isResizeWidth&&!isResizeHeight)return null;const{updateForResizeEvent}=(0,elements_src.Do)(type);if(updateForResizeEvent){return updateForResizeEvent(newElement,[isResizeWidth?1:0,isResizeHeight?1:0],(0,range.uZ)(newWidth,constants_MIN_MAX.WIDTH),(0,range.uZ)(newHeight,constants_MIN_MAX.HEIGHT))}if(lockAspectRatio){const ratio=oldWidth/oldHeight;if(!isResizeWidth)return{width:(0,range.uZ)((0,dimensions.RM)(newHeight*ratio),constants_MIN_MAX.WIDTH)};if(!isResizeHeight)return{height:(0,range.uZ)((0,dimensions.RM)(newWidth/ratio),constants_MIN_MAX.HEIGHT)}}return null}),[lockAspectRatio]),(0,usePresubmitHandler.Z)((({rotationAngle:newRotationAngle})=>({rotationAngle:newRotationAngle%360})),[]),(0,usePresubmitHandler.Z)((({rotationAngle:na,x:nx,y:ny,width:nw,height:nh})=>{const newDims=(0,calcRotatedObjectPositionAndSize.Z)(na,nx,ny,nw,nh),newXOffset=nx-newDims.x,newYOffset=ny-newDims.y;return{x:(0,range.uZ)(nx,{MIN:constants_MIN_MAX.X.MIN+newXOffset-newDims.width,MAX:constants_MIN_MAX.X.MAX+newXOffset}),y:(0,range.uZ)(ny,{MIN:constants_MIN_MAX.Y.MIN+newYOffset-newDims.height,MAX:constants_MIN_MAX.Y.MAX+newYOffset})}}),[]);const setDimensionMinMax=(0,react_src.I4)(((value,ratio,minmax)=>lockAspectRatio&&value>=minmax.MAX?(0,range.uZ)(minmax.MAX*ratio,minmax):(0,range.uZ)(value,minmax)),[lockAspectRatio]);(0,usePresubmitHandler.Z)((({height:newHeight},{width:oldWidth,height:oldHeight})=>{const ratio=oldHeight/oldWidth;return newHeight=(0,range.uZ)(newHeight,constants_MIN_MAX.HEIGHT),isNum(ratio)?{height:setDimensionMinMax((0,dimensions.RM)(newHeight),ratio,constants_MIN_MAX.HEIGHT)}:{height:(0,range.uZ)(newHeight,constants_MIN_MAX.HEIGHT)}}),[height,lockAspectRatio]),(0,usePresubmitHandler.Z)((({width:newWidth},{width:oldWidth,height:oldHeight})=>{const ratio=oldWidth/oldHeight;return newWidth=(0,range.uZ)(newWidth,constants_MIN_MAX.WIDTH),isNum(ratio)?{width:setDimensionMinMax((0,dimensions.RM)(newWidth),ratio,constants_MIN_MAX.WIDTH)}:{width:(0,range.uZ)(newWidth,constants_MIN_MAX.WIDTH)}}),[width,lockAspectRatio])};var opacity=__webpack_require__("./packages/story-editor/src/components/panels/design/sizePosition/opacity.js"),radius=__webpack_require__("./packages/story-editor/src/components/panels/design/sizePosition/radius.js");const sizePosition_StyledLockToggle=(0,styled_components_browser_esm.ZP)(toggleButton.o).withConfig({displayName:"sizePosition__StyledLockToggle",componentId:"sc-7rw4xb-0"})(["",";"],shared_styles.j),stackableGroupStyleOverride=(0,styled_components_browser_esm.iv)(["max-width:none;"]);function getStickerAspectRatio(element){return stickers_src.Z?.[element?.sticker?.type].aspectRatio||1}const gridWithoutFlip=(0,styled_components_browser_esm.iv)(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . o . .' 'c c c c c c c';"],(({isSingleMedia})=>isSingleMedia?"'b b b b b . .'":null)),gridWithFlip=(0,styled_components_browser_esm.iv)(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . f . .' ",";"],(({isSingleMedia})=>isSingleMedia?"'b b b b b . .'":null),(({unlockedRadius})=>unlockedRadius?"\n  'o . . . . . .'\n  'c c c c c c c'\n":"'o . . . c c c'")),Grid=styled_components_browser_esm.ZP.div.withConfig({displayName:"sizePosition__Grid",componentId:"sc-7rw4xb-1"})(["display:grid;"," grid-template-columns:1fr 4px 8px 4px 1fr 8px 32px;grid-template-rows:repeat(4,36px);row-gap:16px;align-items:center;justify-items:start;margin-bottom:16px;"],(({canFlip})=>canFlip?gridWithFlip:gridWithoutFlip)),sizePosition_Area=styled_components_browser_esm.ZP.div.withConfig({displayName:"sizePosition__Area",componentId:"sc-7rw4xb-2"})(["grid-area:",";width:100%;"],(({area})=>area)),Dash=styled_components_browser_esm.ZP.div.withConfig({displayName:"sizePosition__Dash",componentId:"sc-7rw4xb-3"})(["height:1px;width:100%;background:",";"],(({theme})=>theme.colors.divider.primary)),sizePosition_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"sizePosition__StyledButton",componentId:"sc-7rw4xb-4"})(["padding:10px 16px;width:100%;",";"],shared_styles.j);function SizePositionPanel(props){const{selectedElements,submittedSelectedElements,pushUpdate,pushUpdateForObject}=props,x=(0,shared.d9)(selectedElements,"x"),y=(0,shared.d9)(selectedElements,"y"),width=(0,shared.d9)(selectedElements,"width"),height=(0,shared.d9)(selectedElements,"height"),rotationAngle=(0,shared.d9)(selectedElements,"rotationAngle"),flip=(0,shared.cn)(selectedElements,"flip",constants_DEFAULT_FLIP),borderRadius=(0,shared.cn)(selectedElements,"borderRadius",{locked:!0}),origRatio=(0,react_src.Ye)((()=>(0,shared.d9)(submittedSelectedElements,"width")/(0,shared.d9)(submittedSelectedElements,"height")),[submittedSelectedElements]),rawLockAspectRatio=(0,shared.d9)(selectedElements,"lockAspectRatio"),bgButtonRef=(0,react_src.sO)(null);(0,usePerformanceTracking.Z)({node:bgButtonRef.current,eventData:story_editor_src_constants.Iy.SET_BACKGROUND_MEDIA});const lockAspectRatio=rawLockAspectRatio===story_editor_src_constants.mh||rawLockAspectRatio,{currentPage,combineElements}=(0,story_useStory.Z)((state=>({currentPage:state.state.currentPage,combineElements:state.actions.combineElements}))),currentBackgroundId=currentPage?.elements[0].id,isSingleElement=1===selectedElements.length,{isMedia}=(0,elements_src.Do)(selectedElements[0].type),canFlip=selectedElements.every((({type})=>(0,elements_src.Do)(type).canFlip)),isAspectAlwaysLocked=selectedElements.some((({type})=>(0,elements_src.Do)(type).isAspectAlwaysLocked)),hasText=selectedElements.some((({type})=>"text"===type)),actualDimensions=(0,react_src.Ye)((()=>isSingleElement?(0,calcRotatedObjectPositionAndSize.Z)(rotationAngle,x,y,width,height):{}),[rotationAngle,x,y,width,height,isSingleElement]),xOffset=x-actualDimensions.x,yOffset=y-actualDimensions.y,minMaxXY=isSingleElement?{minX:constants_MIN_MAX.X.MIN+xOffset-actualDimensions.width,minY:constants_MIN_MAX.Y.MIN+yOffset-actualDimensions.height,maxX:constants_MIN_MAX.X.MAX+xOffset,maxY:constants_MIN_MAX.Y.MAX+yOffset}:function getMultiSelectionMinMaxXY(selectedElements){const allDimensions=selectedElements.map((element=>(0,calcRotatedObjectPositionAndSize.Z)(element.rotationAngle,element.x,element.y,element.width,element.height)));return selectedElements.reduce(((values,element,i)=>{const actualDimensions=allDimensions[i],xOffset=element.x-actualDimensions.x,yOffset=element.y-actualDimensions.y,minX=constants_MIN_MAX.X.MIN+xOffset-actualDimensions.width,minY=constants_MIN_MAX.Y.MIN+yOffset-actualDimensions.height,maxX=constants_MIN_MAX.X.MAX+xOffset,maxY=constants_MIN_MAX.Y.MAX+yOffset;return{minX:values.minX?Math.max(values.minX,minX):minX,minY:values.minY?Math.max(values.minY,minY):minY,maxX:values.maxX?Math.min(values.maxX,maxX):maxX,maxY:values.maxY?Math.min(values.maxY,maxY):maxY}}),{})}(selectedElements),getUpdateObject=(nWidth,nHeight)=>rawLockAspectRatio===story_editor_src_constants.mh?{lockAspectRatio,height:nHeight,width:nWidth}:{height:nHeight,width:nWidth};sizePosition_usePresubmitHandlers(lockAspectRatio,height,width);const handleSetBackground=(0,react_src.I4)((()=>{combineElements({firstElement:selectedElements[0],secondId:currentBackgroundId})}),[selectedElements,combineElements,currentBackgroundId]),disableHeight=!lockAspectRatio&&hasText,enabledHeightPlaceholder=story_editor_src_constants.mh===height?story_editor_src_constants.nz:null,heightPlaceholder=disableHeight?(0,i18n.__)("Auto","web-stories"):enabledHeightPlaceholder,getMixedValueProps=(0,react_src.I4)((value=>({isIndeterminate:story_editor_src_constants.mh===value,placeholder:story_editor_src_constants.mh===value?story_editor_src_constants.nz:null})),[]);return(0,jsx_runtime.jsx)(panel.me,{name:"size",title:(0,i18n.__)("Selection","web-stories"),children:(0,jsx_runtime.jsxs)(Grid,{isSingleMedia:isMedia&&isSingleElement,canFlip,unlockedRadius:!borderRadius.locked,children:[isMedia&&isSingleElement&&(0,jsx_runtime.jsx)(sizePosition_Area,{area:"b",children:(0,jsx_runtime.jsx)(sizePosition_StyledButton,{ref:bgButtonRef,onClick:handleSetBackground,type:constants.L$.Secondary,size:constants.qE.Small,variant:constants.Wu.Rectangle,children:(0,i18n.__)("Set as background","web-stories")})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"x",children:(0,jsx_runtime.jsx)(numericInput.Z,{suffix:(0,i18n._x)("X","Position on X axis","web-stories"),value:x,min:minMaxXY.minX,max:minMaxXY.maxX,onChange:(evt,value)=>pushUpdate({x:value},!0),"aria-label":(0,i18n.__)("X position","web-stories"),canBeNegative:!0,...getMixedValueProps(x),containerStyleOverride:shared_styles.O})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"y",children:(0,jsx_runtime.jsx)(numericInput.Z,{suffix:(0,i18n._x)("Y","Position on Y axis","web-stories"),value:y,min:minMaxXY.minY,max:minMaxXY.maxY,onChange:(evt,value)=>pushUpdate({y:value},!0),"aria-label":(0,i18n.__)("Y position","web-stories"),canBeNegative:!0,...getMixedValueProps(y),containerStyleOverride:shared_styles.O})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"w",children:(0,jsx_runtime.jsx)(numericInput.Z,{suffix:(0,i18n._x)("W","The Width dimension","web-stories"),value:width,min:constants_MIN_MAX.WIDTH.MIN,max:constants_MIN_MAX.WIDTH.MAX,onChange:(evt,value)=>{const newWidth=value;let newHeight=height;lockAspectRatio&&(""===newWidth?newHeight="":isNum(newWidth/origRatio)&&(newHeight=(0,dimensions.RM)(newWidth/origRatio))),pushUpdate((element=>{if("sticker"===element?.type){const aspectRatio=getStickerAspectRatio(element);return getUpdateObject(newWidth,Math.floor(newWidth/aspectRatio))}return getUpdateObject(newWidth,newHeight)}),!0)},"aria-label":(0,i18n.__)("Width","web-stories"),...getMixedValueProps(width),containerStyleOverride:shared_styles.O})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"d",children:(0,jsx_runtime.jsx)(Dash,{})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"h",children:(0,jsx_runtime.jsx)(numericInput.Z,{allowEmpty:disableHeight,suffix:(0,i18n._x)("H","The Height dimension","web-stories"),value:disableHeight?"":height,disabled:disableHeight,min:constants_MIN_MAX.HEIGHT.MIN,max:constants_MIN_MAX.HEIGHT.MAX,onChange:(evt,value)=>{const newHeight=value;let newWidth=width;lockAspectRatio&&(""===newHeight?newWidth="":isNum(newHeight*origRatio)&&(newWidth=(0,dimensions.RM)(newHeight*origRatio))),pushUpdate((element=>{if("sticker"===element?.type){const aspectRatio=getStickerAspectRatio(element);return getUpdateObject(Math.floor(newHeight*aspectRatio),newHeight)}return getUpdateObject(newWidth,newHeight)}),!0)},"aria-label":(0,i18n.__)("Height","web-stories"),isIndeterminate:story_editor_src_constants.mh===height,placeholder:heightPlaceholder,containerStyleOverride:shared_styles.O})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"l",children:(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Lock aspect ratio","web-stories"),children:(0,jsx_runtime.jsx)(sizePosition_StyledLockToggle,{"aria-label":(0,i18n.__)("Lock aspect ratio","web-stories"),isLocked:lockAspectRatio||isAspectAlwaysLocked,disabled:isAspectAlwaysLocked,onClick:()=>!isAspectAlwaysLocked&&pushUpdate({lockAspectRatio:!lockAspectRatio},!0)})})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"r",children:(0,jsx_runtime.jsx)(numericInput.Z,{suffix:(0,jsx_runtime.jsx)(angle.Z,{}),unit:(0,i18n._x)("°","Degrees, 0 - 360.","web-stories"),value:rotationAngle,min:constants_MIN_MAX.ROTATION.MIN,max:constants_MIN_MAX.ROTATION.MAX,onChange:(evt,value)=>pushUpdate({rotationAngle:value},!0),"aria-label":(0,i18n.__)("Rotation","web-stories"),canBeNegative:!0,...getMixedValueProps(rotationAngle),containerStyleOverride:shared_styles.O})}),canFlip&&(0,jsx_runtime.jsx)(sizePosition_Area,{area:"f",children:(0,jsx_runtime.jsx)(flipControls.Z,{onChange:value=>pushUpdateForObject("flip",value,constants_DEFAULT_FLIP,!0),value:flip})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"o",children:(0,jsx_runtime.jsx)(opacity.Z,{...props})}),(0,jsx_runtime.jsx)(sizePosition_Area,{area:"c",children:(0,jsx_runtime.jsx)(radius.Z,{stackableGroupStyleOverride,...props})})]})})}SizePositionPanel.displayName="SizePositionPanel";const sizePosition=SizePositionPanel;function TextAccessibilityPanel({selectedElements,pushUpdate}){const[tagNamesOverrides,setTagNamesOverrides]=(0,react_src.eJ)(),{textElements}=(0,app_story.rB)((({state})=>({textElements:state.currentPage?.elements?.filter((({type})=>"text"===type)).map((({id,tagName,...rest})=>({id,...rest,tagName:tagNamesOverrides?.get(id)||tagName})))}))),onLinkClick=(0,react_src.I4)((evt=>{(0,tracking_src.ob)(evt,"click_headings_docs")}),[]),handleChange=(0,react_src.I4)(((evt,value)=>{setTagNamesOverrides(new Map(selectedElements.map((({id})=>[id,value])))),selectedElements.forEach((()=>{pushUpdate({tagName:value},!0)}))}),[pushUpdate,selectedElements]),tagNamesMap=(0,output_src.XM)(textElements),selectedElementsWithTagNames=selectedElements.map((element=>({...element,tagName:tagNamesMap.get(element.id),defaultTagName:element.tagName||"auto"}))),uniqueTagNames=[...new Set(selectedElementsWithTagNames.map((({tagName})=>tagName||"auto")))],currentValue=1===uniqueTagNames.length?uniqueTagNames[0]:story_editor_src_constants.mh,tagName=(0,shared.d9)(selectedElementsWithTagNames,"defaultTagName","auto"),isIndeterminate=story_editor_src_constants.mh===tagName,selectedValue="auto"===tagName?"auto":currentValue,options=[{label:"auto"===selectedValue?(0,sprintf.Z)((0,i18n.__)("Automatic (%s)","web-stories"),story_editor_src_constants.od[currentValue]||story_editor_src_constants.nz):(0,i18n.__)("Automatic","web-stories"),value:"auto"},{label:story_editor_src_constants.od.h1,value:"h1"},{label:story_editor_src_constants.od.h2,value:"h2"},{label:story_editor_src_constants.od.h3,value:"h3"},{label:story_editor_src_constants.od.p,value:"p"}];return(0,jsx_runtime.jsxs)(panel.me,{name:"textAccessibility",title:(0,i18n.__)("Accessibility","web-stories"),children:[(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(dropdown.Z,{"data-testid":"text-accessibility-dropdown",title:(0,i18n.__)("Heading Levels","web-stories"),dropdownButtonLabel:(0,i18n.__)("Heading Levels","web-stories"),options,selectedValue,placeholder:isIndeterminate?story_editor_src_constants.nz:currentValue,onMenuItemClick:handleChange,dropDownLabel:(0,i18n.__)("Heading Level","web-stories")})}),(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.XSmall,children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{a:(0,jsx_runtime.jsx)(typography_link.r,{href:(0,i18n.__)("https://wp.stories.google/docs/seo/","web-stories"),rel:"noreferrer",target:"_blank",onClick:onLinkClick,size:types.TextSize.XSmall})},children:(0,i18n.__)("<a>Learn more</a> about using headings in stories.","web-stories")})})]})}TextAccessibilityPanel.displayName="TextAccessibilityPanel";const textAccessibility=TextAccessibilityPanel;var content=__webpack_require__("./packages/story-editor/src/components/panels/panel/shared/content.js"),panel_panel=__webpack_require__("./packages/story-editor/src/components/panels/panel/panel.js"),letter_a_height=__webpack_require__("./packages/design-system/src/icons/letter_a_height.svg"),letter_a_width=__webpack_require__("./packages/design-system/src/icons/letter_a_width.svg"),align_text_left=__webpack_require__("./packages/design-system/src/icons/align_text_left.svg"),align_text_center=__webpack_require__("./packages/design-system/src/icons/align_text_center.svg"),align_text_right=__webpack_require__("./packages/design-system/src/icons/align_text_right.svg"),align_text_justified=__webpack_require__("./packages/design-system/src/icons/align_text_justified.svg"),letter_b_bold=__webpack_require__("./packages/design-system/src/icons/letter_b_bold.svg"),letter_i_italic=__webpack_require__("./packages/design-system/src/icons/letter_i_italic.svg"),letter_u_underline=__webpack_require__("./packages/design-system/src/icons/letter_u_underline.svg"),letter_t_uppercase=__webpack_require__("./packages/design-system/src/icons/letter_t_uppercase.svg");const style_MIN_MAX_LINE_HEIGHT={MIN:.5,MAX:10},style_MIN_MAX_LETTER_SPACING={MIN:0,MAX:300},StyledNumericInput=(0,styled_components_browser_esm.ZP)(numericInput.Z).withConfig({displayName:"style__StyledNumericInput",componentId:"sc-9ups92-0"})(["flex-grow:1;"]),style_Space=styled_components_browser_esm.ZP.div.withConfig({displayName:"style__Space",componentId:"sc-9ups92-1"})(["flex:0 0 3px;"]),StyledToggle=(0,styled_components_browser_esm.ZP)(toggleButton.C).withConfig({displayName:"style__StyledToggle",componentId:"sc-9ups92-2"})(["",";"],shared_styles.j);function Toggle(props){return(0,jsx_runtime.jsx)(StyledToggle,{size:constants.qE.Small,variant:constants.Wu.Square,...props})}Toggle.displayName="Toggle";const style=function StylePanel({selectedElements,pushUpdate}){const{actions:{maybeEnqueueFontStyle}}=(0,font.jo)(),textAlign=(0,shared.d9)(selectedElements,"textAlign"),lineHeight=(0,shared.d9)(selectedElements,"lineHeight"),{textInfo:{isBold,isItalic,isUnderline,isUppercase,letterSpacing,fontWeight},handlers:{handleClickBold,handleClickItalic,handleClickUnderline,handleClickUppercase,handleSetLetterSpacing}}=(0,useRichTextFormatting.Z)(selectedElements,pushUpdate),setLetterSpacingMinMax=(0,react_src.I4)(((evt,value)=>handleSetLetterSpacing((0,range.uZ)(value,style_MIN_MAX_LETTER_SPACING))),[handleSetLetterSpacing]);(0,components_form.pz)((({lineHeight:newLineHeight})=>({lineHeight:(0,range.uZ)(newLineHeight,style_MIN_MAX_LINE_HEIGHT)})),[]);const handleTextAlign=(0,react_src.I4)((alignment=>()=>{pushUpdate({textAlign:textAlign===alignment?"":alignment},!0)}),[pushUpdate,textAlign]),isTrulyBold=!0===isBold,isTrulyItalic=!0===isItalic,isTrulyUnderline=!0===isUnderline,isTrulyUppercase=!0===isUppercase;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(components_form.X2,{children:[(0,jsx_runtime.jsx)(StyledNumericInput,{"aria-label":(0,i18n.__)("Line-height","web-stories"),isFloat:!0,value:lineHeight,min:style_MIN_MAX_LINE_HEIGHT.MIN,max:style_MIN_MAX_LINE_HEIGHT.MAX,suffix:(0,jsx_runtime.jsx)(letter_a_height.Z,{}),onChange:(evt,value)=>pushUpdate({lineHeight:value},!0),allowEmpty:!0,isIndeterminate:story_editor_src_constants.mh===lineHeight,placeholder:story_editor_src_constants.mh===lineHeight?story_editor_src_constants.nz:null,containerStyleOverride:shared_styles.O}),(0,jsx_runtime.jsx)(style_Space,{}),(0,jsx_runtime.jsx)(StyledNumericInput,{"aria-label":(0,i18n.__)("Letter-spacing","web-stories"),value:letterSpacing,min:style_MIN_MAX_LETTER_SPACING.MIN,max:style_MIN_MAX_LETTER_SPACING.MAX,suffix:(0,jsx_runtime.jsx)(letter_a_width.Z,{}),unit:"%",onChange:setLetterSpacingMinMax,allowEmpty:!0,isIndeterminate:story_editor_src_constants.mh===letterSpacing,placeholder:story_editor_src_constants.mh===letterSpacing?story_editor_src_constants.nz:null,containerStyleOverride:shared_styles.O})]}),(0,jsx_runtime.jsxs)(components_form.X2,{children:[(0,jsx_runtime.jsx)(Toggle,{isToggled:"left"===textAlign,onClick:handleTextAlign("left"),"aria-label":(0,i18n.__)("Align text left","web-stories"),children:(0,jsx_runtime.jsx)(align_text_left.Z,{})}),(0,jsx_runtime.jsx)(Toggle,{isToggled:"center"===textAlign,onClick:handleTextAlign("center"),"aria-label":(0,i18n.__)("Align text center","web-stories"),children:(0,jsx_runtime.jsx)(align_text_center.Z,{})}),(0,jsx_runtime.jsx)(Toggle,{isToggled:"right"===textAlign,onClick:handleTextAlign("right"),"aria-label":(0,i18n.__)("Align text right","web-stories"),children:(0,jsx_runtime.jsx)(align_text_right.Z,{})}),(0,jsx_runtime.jsx)(Toggle,{isToggled:"justify"===textAlign,onClick:handleTextAlign("justify"),"aria-label":(0,i18n.__)("Align text justified","web-stories"),children:(0,jsx_runtime.jsx)(align_text_justified.Z,{})}),(0,jsx_runtime.jsx)(Toggle,{isToggled:isTrulyBold,onClick:()=>handleClickBold(!isTrulyBold),"aria-label":(0,i18n.__)("Bold","web-stories"),children:(0,jsx_runtime.jsx)(letter_b_bold.Z,{})}),(0,jsx_runtime.jsx)(Toggle,{isToggled:isTrulyItalic,onClick:async()=>{await maybeEnqueueFontStyle(selectedElements.map((({font,content})=>({font,fontStyle:isTrulyItalic?"normal":"italic",fontWeight,content:(0,dom_src.Cb)(content)})))),handleClickItalic(!isTrulyItalic)},"aria-label":(0,i18n.__)("Italic","web-stories"),children:(0,jsx_runtime.jsx)(letter_i_italic.Z,{})}),(0,jsx_runtime.jsx)(Toggle,{isToggled:isTrulyUnderline,onClick:()=>handleClickUnderline(!isTrulyUnderline),"aria-label":(0,i18n.__)("Underline","web-stories"),children:(0,jsx_runtime.jsx)(letter_u_underline.Z,{})}),(0,jsx_runtime.jsx)(Toggle,{isToggled:isTrulyUppercase,onClick:()=>handleClickUppercase(!isTrulyUppercase),"aria-label":(0,i18n.__)("Uppercase","web-stories"),children:(0,jsx_runtime.jsx)(letter_t_uppercase.Z,{})})]})]})};var hasGradient=__webpack_require__("./packages/patterns/src/hasGradient.ts"),createSolid=__webpack_require__("./packages/patterns/src/createSolid.ts"),patterns_src_constants=__webpack_require__("./packages/patterns/src/constants.ts");function ColorControls({selectedElements,pushUpdate,textColorRef}){const{textInfo:{color,gradientColor},handlers:{handleSetColor,handleSetGradientColor}}=(0,useRichTextFormatting.Z)(selectedElements,pushUpdate),colorInputValue=gradientColor===story_editor_src_constants.mh?story_editor_src_constants.mh:(0,hasGradient.Z)(gradientColor)?gradientColor:color;return(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(components_form.Il,{"data-testid":"text.color",value:colorInputValue,onChange:colorValue=>{(0,hasGradient.Z)(colorValue)?(handleSetColor((0,createSolid.Z)(0,0,0)),handleSetGradientColor(colorValue)):(handleSetGradientColor(patterns_src_constants.ob),handleSetColor(colorValue))},allowsSavedColors:!0,label:(0,i18n.__)("Text color","web-stories"),labelId:"text-color-label",ref:textColorRef,hasEyedropper:!0,allowsGradient:!0})})}ColorControls.displayName="ColorControls";const color=ColorControls;var textStyle_font=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/font.js"),pillGroup=__webpack_require__("./packages/design-system/src/components/pill/pillGroup.tsx"),useCommonColorValue=__webpack_require__("./packages/story-editor/src/components/panels/shared/useCommonColorValue.js"),getCommonValue=__webpack_require__("./packages/story-editor/src/components/panels/shared/getCommonValue.js");const FillRow=(0,styled_components_browser_esm.ZP)(components_form.X2).withConfig({displayName:"backgroundColor__FillRow",componentId:"sc-2oqmdd-0"})(["align-items:flex-start;justify-content:space-between;button{flex:1;z-index:1;}"]),FILL_OPTIONS=[{id:elements_src.uG.NONE,label:(0,i18n.__)("None","web-stories")},{id:elements_src.uG.FILL,label:(0,i18n.__)("Fill","web-stories")},{id:elements_src.uG.HIGHLIGHT,label:(0,i18n.__)("Highlight","web-stories")}];const backgroundColor=function BackgroundControls({selectedElements,pushUpdate}){const backgroundColor=(0,useCommonColorValue.Z)(selectedElements,"backgroundColor"),backgroundTextMode=(0,getCommonValue.Z)(selectedElements,"backgroundTextMode"),fillRow=(0,react_src.sO)(),pushBackgroundTextMode=(0,react_src.I4)((mode=>{pushUpdate((element=>({backgroundTextMode:mode,padding:[elements_src.uG.FILL,elements_src.uG.HIGHLIGHT].includes(mode)?(0,textStyle_utils.g1)(element):(0,textStyle_utils.yo)(element)})),!0)}),[pushUpdate]),onSelect=(0,react_src.I4)((mode=>{pushBackgroundTextMode(mode)}),[pushBackgroundTextMode]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(FillRow,{ref:fillRow,children:(0,jsx_runtime.jsx)(pillGroup.Z,{value:backgroundTextMode,onSelect,options:FILL_OPTIONS,pillStyleOverride:shared_styles.j})}),backgroundTextMode!==elements_src.uG.NONE&&(0,jsx_runtime.jsx)(components_form.X2,{children:(0,jsx_runtime.jsx)(components_form.Il,{"data-testid":"text.backgroundColor",allowsGradient:!0,allowsSavedColors:!0,value:backgroundColor,onChange:value=>pushUpdate({backgroundColor:value},!0),label:(0,i18n.__)("Background color","web-stories"),labelId:"background-color-label",changedStyle:"background",hasEyedropper:!0})})]})};var turning_line=__webpack_require__("./packages/design-system/src/icons/turning_line.svg");const DEFAULT_PADDING={horizontal:0,vertical:0,locked:!0,hasHiddenPadding:!1},padding_MIN_MAX_PADDING={MIN:0,MAX:300},padding_Space=styled_components_browser_esm.ZP.div.withConfig({displayName:"padding__Space",componentId:"sc-17x5rfj-0"})(["flex:0 0 8px;"]),LockToggle=(0,styled_components_browser_esm.ZP)(toggleButton.o).withConfig({displayName:"padding__LockToggle",componentId:"sc-17x5rfj-1"})([""," ",";"],(({isLocked})=>!isLocked&&"\n    position: absolute;\n    right: 0;\n    top: calc(100% - 8px);\n  "),shared_styles.j),padding_Row=(0,styled_components_browser_esm.ZP)(components_form.X2).withConfig({displayName:"padding__Row",componentId:"sc-17x5rfj-2"})(["position:relative;"]),padding_IconWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"padding__IconWrapper",componentId:"sc-17x5rfj-3"})(["width:44px;margin-left:6px;color:",";"," svg{width:22px;}"],(({theme})=>theme.colors.divider.primary),(({reverse})=>reverse&&"transform: scaleY(-1);"));const padding=function PaddingControls({selectedElements,pushUpdateForObject,pushUpdate}){const displayedPadding=(0,shared.cn)(selectedElements.map((el=>({...el,padding:(0,textStyle_utils.yo)(el)}))),"padding",DEFAULT_PADDING),lockPadding=!0===displayedPadding.locked,handleChange=(0,react_src.I4)((updater=>{pushUpdate((el=>{const{x,y,width,height}=el,newPadding=updater(el);return function metricsForTextPadding({currentPadding,newPadding,x,y,width,height}){const updates={};return"horizontal"in newPadding&&(updates.x=x-(newPadding.horizontal-(currentPadding.horizontal||0)),updates.width=width+2*(newPadding.horizontal-(currentPadding.horizontal||0))),"vertical"in newPadding&&(updates.y=y-(newPadding.vertical-(currentPadding.vertical||0)),updates.height=height+2*(newPadding.vertical-(currentPadding.vertical||0))),updates}({x,y,height,width,currentPadding:el.padding,newPadding})})),pushUpdateForObject("padding",(v=>updater({padding:v})),DEFAULT_PADDING,!0)}),[pushUpdate,pushUpdateForObject]);(0,components_form.pz)((({padding:{horizontal,vertical,...rest}})=>({padding:{...rest,horizontal:(0,range.uZ)(horizontal,padding_MIN_MAX_PADDING),vertical:(0,range.uZ)(vertical,padding_MIN_MAX_PADDING)}})),[]);const firstInputProperties=lockPadding?{suffix:(0,i18n.__)("Padding","web-stories"),"aria-label":(0,i18n.__)("Padding","web-stories"),onChange:(evt,value)=>{handleChange((el=>({horizontal:value+(0,textStyle_utils.XE)(el,"horizontal"),vertical:value+(0,textStyle_utils.XE)(el,"vertical")})))},stretch:!0}:{suffix:(0,i18n.__)("Horizontal padding","web-stories"),"aria-label":(0,i18n.__)("Horizontal padding","web-stories"),onChange:(evt,value)=>{handleChange((el=>({horizontal:value+(0,textStyle_utils.XE)(el,"horizontal")})))}};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(padding_Row,{children:[(0,jsx_runtime.jsx)(numericInput.Z,{value:displayedPadding.horizontal,isIndeterminate:displayedPadding.horizontal===story_editor_src_constants.mh,placeholder:displayedPadding.horizontal===story_editor_src_constants.mh?story_editor_src_constants.nz:null,...firstInputProperties,containerStyleOverride:shared_styles.O}),lockPadding&&(0,jsx_runtime.jsx)(padding_Space,{}),(0,jsx_runtime.jsx)(LockToggle,{isLocked:lockPadding,onClick:()=>handleChange((el=>lockPadding?{locked:!1}:{locked:!0,horizontal:el.padding.horizontal,vertical:el.padding.horizontal+(0,textStyle_utils.XE)(el,"vertical")-(0,textStyle_utils.XE)(el,"horizontal")})),"aria-label":(0,i18n.__)("Toggle padding ratio lock","web-stories")}),!lockPadding&&(0,jsx_runtime.jsx)(padding_IconWrapper,{reverse:!0,children:(0,jsx_runtime.jsx)(turning_line.Z,{})})]}),!lockPadding&&(0,jsx_runtime.jsxs)(padding_Row,{children:[(0,jsx_runtime.jsx)(numericInput.Z,{isIndeterminate:displayedPadding.vertical===story_editor_src_constants.mh,placeholder:displayedPadding.vertical===story_editor_src_constants.mh?story_editor_src_constants.nz:null,suffix:(0,i18n.__)("Vertical padding","web-stories"),value:displayedPadding.vertical,onChange:(evt,value)=>{handleChange((el=>({vertical:Number(value)+(0,textStyle_utils.XE)(el,"vertical")})))},"aria-label":(0,i18n.__)("Vertical padding","web-stories"),containerStyleOverride:shared_styles.O}),(0,jsx_runtime.jsx)(padding_IconWrapper,{children:(0,jsx_runtime.jsx)(turning_line.Z,{})})]})]})};var color_bucket=__webpack_require__("./packages/design-system/src/icons/color_bucket.svg"),useApplyTextAutoStyle=__webpack_require__("./packages/story-editor/src/utils/useApplyTextAutoStyle.js"),shared_title=__webpack_require__("./packages/story-editor/src/components/panels/panel/shared/title.js"),panel_context=__webpack_require__("./packages/story-editor/src/components/panels/panel/context.js");const AutoStyleButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({variant:constants.Wu.Square,type:constants.L$.Tertiary,size:constants.qE.Small}).withConfig({displayName:"panelHeader__AutoStyleButton",componentId:"sc-1sprex4-0"})(["",";"],(({theme})=>outline.L(theme.colors.border.focus,"#1d1f20")));function PanelHeader({selectedElements,pushUpdate}){const{state:{isCollapsed}}=(0,react_src.qp)(panel_context.Z),applyTextAutoStyle=(0,useApplyTextAutoStyle.Z)(selectedElements[0],(textProps=>{pushUpdate(textProps,!0),(0,tracking_src.L9)("auto_style_text")})),panelTitle=(0,i18n.__)("Text","web-stories");return(0,jsx_runtime.jsx)(shared_title.Z,{ariaLabel:panelTitle,secondaryAction:isCollapsed?null:(0,jsx_runtime.jsx)(components_tooltip.Z,{title:(0,i18n.__)("Adaptive text colors","web-stories"),children:(0,jsx_runtime.jsx)(AutoStyleButton,{"aria-label":(0,i18n.__)("Adaptive text colors","web-stories"),onClick:applyTextAutoStyle,disabled:selectedElements?.length>1,children:(0,jsx_runtime.jsx)(color_bucket.Z,{})})}),children:panelTitle})}PanelHeader.displayName="PanelHeader";const panelHeader=PanelHeader,PresetsHeader=styled_components_browser_esm.ZP.div.withConfig({displayName:"stylePresets__PresetsHeader",componentId:"sc-8grd53-0"})(["display:flex;padding:8px 0;justify-content:space-between;"]),stylePresets_StylesWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"stylePresets__StylesWrapper",componentId:"sc-8grd53-1"})([""]),stylePresets_NoStylesWrapper=(0,styled_components_browser_esm.ZP)(NoStylesWrapper).withConfig({displayName:"stylePresets__NoStylesWrapper",componentId:"sc-8grd53-2"})(["width:calc(100% + 28px);"]),SubHeading=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"stylePresets__SubHeading",componentId:"sc-8grd53-3"})(["color:",";margin:6px 0;font-weight:",";"],(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.typography.weight.bold)),textStyle_stylePresets_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"stylePresets__StyledButton",componentId:"sc-8grd53-4"})(["margin-left:auto;"]),stylePresets_NoStylesText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"stylePresets__NoStylesText",componentId:"sc-8grd53-5"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary)),stylePresets_SPACING={x:12};const textStyle_stylePresets=function stylePresets_PresetPanel({pushUpdate}){const textStyles=(0,app.rB)((({state})=>state.story.globalStoryStyles.textStyles)),{refs:{sidebar}}=(0,useSidebar.Z)(),buttonRef=(0,react_src.sO)(null),[isPopupOpen,setIsPopupOpen]=(0,react_src.eJ)(!1),hasPresets=textStyles.length>0,handleApplyStyle=styleManager_useApplyStyle({pushUpdate}),{addGlobalPreset}=(0,useAddPreset.Z)({presetType:story_editor_src_constants.SE.STYLE}),handlePresetClick=preset=>{handleApplyStyle(preset)};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(PresetsHeader,{children:[(0,jsx_runtime.jsx)(SubHeading,{size:types.TextSize.Small,children:(0,i18n.__)("Recently Saved Styles","web-stories")}),(0,jsx_runtime.jsx)(textStyle_stylePresets_StyledButton,{type:constants.L$.Tertiary,size:constants.qE.Small,variant:constants.Wu.Square,onClick:addGlobalPreset,"aria-label":(0,i18n.__)("Add style","web-stories"),children:(0,jsx_runtime.jsx)(plus.Z,{})})]}),hasPresets&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(stylePresets_StylesWrapper,{children:(0,jsx_runtime.jsx)(styleGroup,{styles:[...textStyles].reverse().slice(0,2),handleClick:handlePresetClick})}),(0,jsx_runtime.jsxs)(MoreButton,{ref:buttonRef,onClick:()=>setIsPopupOpen(!0),"aria-haspopup":"dialog","aria-expanded":isPopupOpen,children:[(0,i18n.__)("More styles","web-stories"),(0,jsx_runtime.jsx)(disclosure.Z,{$isOpen:isPopupOpen})]}),(0,jsx_runtime.jsx)(popup.Z,{anchor:buttonRef,dock:sidebar,isOpen:isPopupOpen,placement:popup_constants.ug.RightStart,spacing:stylePresets_SPACING,renderContents:()=>(0,jsx_runtime.jsx)(styleManager,{styles:textStyles,applyStyle:handlePresetClick,onClose:()=>setIsPopupOpen(!1)})})]}),!hasPresets&&(0,jsx_runtime.jsx)(stylePresets_NoStylesWrapper,{children:(0,jsx_runtime.jsx)(stylePresets_NoStylesText,{size:types.TextSize.Small,children:(0,i18n.__)("No Styles Saved","web-stories")})})]})},SubSection=styled_components_browser_esm.ZP.section.withConfig({displayName:"textStyle__SubSection",componentId:"sc-1al6pl8-0"})(["border-top:1px solid ",";display:flex;flex-direction:column;"],(({theme})=>theme.colors.border.defaultNormal)),textStyle_SubHeading=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"textStyle__SubHeading",componentId:"sc-1al6pl8-1"})(["color:",";margin:14px 0;font-weight:",";"],(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.typography.weight.bold));function textStyle_StylePanel(props){const{dropdownHighlight,colorHighlight,resetHighlight,cancelHighlight}=(0,highlights.QM)((state=>({dropdownHighlight:state[highlights.$q.Font],colorHighlight:state[highlights.$q.TextColor],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect}))),[fontsFocused,setFontsFocused]=(0,react_src.eJ)(!1),[failedElementIds,setFailedElementIds]=(0,react_src.eJ)([]),{selectedElements}=props;(0,components_form.pz)(getUpdatedSizeAndPosition.Z,[]);const{currentPage}=(0,app.rB)((({state:{currentPage}})=>({currentPage}))),pageSize=(0,app.$Y)((({state:{pageWidth,pageHeight}})=>({width:pageWidth,height:pageHeight}))),selectedElementIds=selectedElements.map((({id})=>id)),showContrastWarning=failedElementIds?.some((({id})=>selectedElementIds.includes(id)));return(0,react_src.d4)((()=>{(0,checklist.c_)([currentPage],pageSize).then((pages=>{const elementIds=pages[0]?.result;setFailedElementIds(elementIds)})).catch(noop.Z)}),[currentPage,pageSize]),(0,jsx_runtime.jsxs)(_StyledPanel,{name:"textStyle",onAnimationEnd:()=>resetHighlight(),isPersistable:!1,$_css:(dropdownHighlight?.showEffect||colorHighlight?.showEffect)&&highlights_styles.Z.FLASH,children:[(0,jsx_runtime.jsx)(panelHeader,{...props}),(0,jsx_runtime.jsxs)(content.Z,{children:[(0,jsx_runtime.jsx)(textStyle_font.Z,{...props,fontDropdownRef:node=>{node&&dropdownHighlight?.focus&&dropdownHighlight?.showEffect&&(node.focus(),setFontsFocused(!0))},highlightStylesOverride:fontsFocused?highlights_styles.Z.OUTLINE:[]}),(0,jsx_runtime.jsx)(style,{...props}),(0,jsx_runtime.jsx)(color,{...props,textColorRef:node=>{node&&colorHighlight?.focus&&colorHighlight?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus(),setFontsFocused(!1))}}),showContrastWarning&&(0,jsx_runtime.jsx)(warning,{message:checklist.Iy.lowContrast.textPanel}),(0,jsx_runtime.jsxs)(SubSection,{children:[(0,jsx_runtime.jsx)(textStyle_SubHeading,{size:types.TextSize.Small,children:(0,i18n.__)("Text Box","web-stories")}),(0,jsx_runtime.jsx)(backgroundColor,{...props}),(0,jsx_runtime.jsx)(padding,{...props})]}),(0,jsx_runtime.jsx)(SubSection,{children:(0,jsx_runtime.jsx)(textStyle_stylePresets,{...props})})]})]})}textStyle_StylePanel.displayName="StylePanel";const textStyle=textStyle_StylePanel;var _StyledPanel=(0,styled_components_browser_esm.ZP)(panel_panel.ZP).withConfig({displayName:"textStyle___StyledPanel",componentId:"sc-1al6pl8-2"})(["",""],(p=>p.$_css)),translateToExclusiveList=__webpack_require__("./packages/i18n/src/translateToExclusiveList.ts");const videoAccessibility_DEFAULT_RESOURCE={alt:null,poster:null,height:0,width:0},videoAccessibility_MIN_MAX_ALT_TEXT={MAX:1e3},StyledMedia=(0,styled_components_browser_esm.ZP)(components_form.pU).withConfig({displayName:"videoAccessibility__StyledMedia",componentId:"sc-1uodz5m-0"})(["height:114px;width:64px;"]),InputsWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"videoAccessibility__InputsWrapper",componentId:"sc-1uodz5m-1"})(["align-self:flex-start;margin-left:16px;"]),videoAccessibility_StyledText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"videoAccessibility__StyledText",componentId:"sc-1uodz5m-2"})(["color:",";margin-bottom:10px;"],(({theme})=>theme.colors.fg.secondary));function VideoAccessibilityPanel({selectedElements,pushUpdate}){const resource=(0,shared.cn)(selectedElements,"resource",videoAccessibility_DEFAULT_RESOURCE),alt=(0,shared.d9)(selectedElements,"alt",resource.alt),{height,width}=resource,rawPoster=(0,shared.d9)(selectedElements,"poster"),poster=(0,shared.d9)(selectedElements,"poster",resource.poster),{allowedMimeTypes:{image:allowedImageMimeTypes},capabilities:{hasUploadMediaAction}}=(0,app_config.ZR)(),options=[hasUploadMediaAction&&"upload",hasUploadMediaAction&&"edit","hotlink",poster!==resource.poster&&"reset"].filter(Boolean),allowedImageFileTypes=(0,react_src.Ye)((()=>allowedImageMimeTypes.flatMap((type=>(0,src_mimeTypes.E)(type)))),[allowedImageMimeTypes]),handleChangePoster=(0,react_src.I4)((newPoster=>{newPoster?.src!==rawPoster&&pushUpdate({poster:newPoster?.src},!0)}),[pushUpdate,rawPoster]),posterErrorMessage=(0,react_src.Ye)((()=>{let message=(0,i18n.__)("No file types are currently supported.","web-stories");return allowedImageFileTypes.length&&(message=(0,sprintf.Z)((0,i18n.__)("Please choose only %s as a poster.","web-stories"),(0,translateToExclusiveList.Z)(allowedImageFileTypes))),message}),[allowedImageFileTypes]),{highlightInput,highlightMediaPicker,resetHighlight,cancelHighlight}=(0,highlights.QM)((state=>({highlightInput:state[highlights.$q.AssistiveText],highlightMediaPicker:state[highlights.$q.VideoA11yPoster],resetHighlight:state.onFocusOut,cancelHighlight:state.cancelEffect})));let cropParams=null;return height&&height!==story_editor_src_constants.mh&&width&&width!==story_editor_src_constants.mh&&(cropParams={height,width}),(0,jsx_runtime.jsx)(videoAccessibility_StyledSimplePanel,{onAnimationEnd:()=>resetHighlight(),name:"videoAccessibility",title:(0,i18n.__)("Accessibility","web-stories"),isPersistable:!highlightInput&&!highlightMediaPicker,$_css:(highlightInput||highlightMediaPicker)&&highlights_styles.Z.FLASH,children:(0,jsx_runtime.jsxs)(components_form.X2,{children:[(0,jsx_runtime.jsx)(StyledMedia,{ref:node=>{node&&highlightMediaPicker?.focus&&highlightMediaPicker?.showEffect&&node.focus()},value:poster,cropParams,onChange:handleChangePoster,onChangeErrorText:posterErrorMessage,title:(0,i18n.__)("Select as video poster","web-stories"),hotlinkTitle:(0,i18n.__)("Use external image as video poster","web-stories"),hotlinkInsertText:(0,i18n.__)("Use image as video poster","web-stories"),hotlinkInsertingText:(0,i18n.__)("Using image as video poster","web-stories"),buttonInsertText:(0,i18n.__)("Set as video poster","web-stories"),alt:(0,i18n.__)("Preview poster image","web-stories"),type:allowedImageMimeTypes,ariaLabel:(0,i18n.__)("Video poster","web-stories"),menuOptions:options,imgProps:cropParams,canUpload:0!==options.length}),(0,jsx_runtime.jsxs)(InputsWrapper,{children:[(0,jsx_runtime.jsx)(videoAccessibility_StyledText,{size:types.TextSize.Small,children:(0,i18n.__)("Add a brief description of the video.","web-stories")}),(0,jsx_runtime.jsx)(components_form.Kx,{ref:node=>{node&&highlightInput?.focus&&highlightInput?.showEffect&&(node.addEventListener("keydown",cancelHighlight,{once:!0}),node.focus())},placeholder:alt===story_editor_src_constants.mh?story_editor_src_constants.nz:"",value:alt||"",onChange:evt=>pushUpdate({alt:evt?.target?.value?.trim()||null},!0),"aria-label":(0,i18n.__)("Assistive text","web-stories"),maxLength:videoAccessibility_MIN_MAX_ALT_TEXT.MAX,rows:2,isIndeterminate:alt===story_editor_src_constants.mh})]})]})})}VideoAccessibilityPanel.displayName="VideoAccessibilityPanel";const videoAccessibility=VideoAccessibilityPanel;var videoAccessibility_StyledSimplePanel=(0,styled_components_browser_esm.ZP)(panel.me).withConfig({displayName:"videoAccessibility___StyledSimplePanel",componentId:"sc-1uodz5m-3"})(["",""],(p=>p.$_css)),slider=__webpack_require__("./packages/design-system/src/components/slider/slider.tsx"),circular=__webpack_require__("./packages/design-system/src/components/circularProgress/circular.tsx"),useVideoElementTranscoding=__webpack_require__("./packages/story-editor/src/app/media/utils/useVideoElementTranscoding.js"),loopPanelContent=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/loopPanelContent.js");const videoOptions_Row=(0,styled_components_browser_esm.ZP)(components_form.X2).withConfig({displayName:"videoOptions__Row",componentId:"sc-csxmtu-0"})(["margin-top:2px;"]),videoOptions_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"videoOptions__StyledButton",componentId:"sc-csxmtu-1"})(["padding:12px 8px;"]),TrimButton=(0,styled_components_browser_esm.ZP)(videoOptions_StyledButton).withConfig({displayName:"videoOptions__TrimButton",componentId:"sc-csxmtu-2"})(["margin-left:20px;"]),TrimWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"videoOptions__TrimWrapper",componentId:"sc-csxmtu-3"})(["position:relative;display:flex;"]),Spinner=styled_components_browser_esm.ZP.div.withConfig({displayName:"videoOptions__Spinner",componentId:"sc-csxmtu-4"})(["margin-left:4px;margin-top:4px;"]),StyledSlider=(0,styled_components_browser_esm.ZP)(slider.Z).withConfig({displayName:"videoOptions__StyledSlider",componentId:"sc-csxmtu-5"})(["width:100%;"]),VolumeWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"videoOptions__VolumeWrapper",componentId:"sc-csxmtu-6"})(["margin-bottom:20px;"]),videoOptions_HelperText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.XSmall}).withConfig({displayName:"videoOptions__HelperText",componentId:"sc-csxmtu-7"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary));function VideoOptionsPanel({selectedElements,pushUpdate}){const resource=(0,shared.d9)(selectedElements,"resource"),elementId=(0,shared.d9)(selectedElements,"id"),loop=(0,shared.d9)(selectedElements,"loop"),volume=(0,shared.d9)(selectedElements,"volume",1),isSingleElement=1===selectedElements.length,showVolumeControl=(0,flagged_esm.SS)("videoVolume")&&isSingleElement&&!resource?.isMuted,{state:{canTrim,canMute,isTrimming,isMuting,isDisabled},actions:{handleMute,handleTrim}}=(0,useVideoElementTranscoding.Z)({resource,elementId,isSingleElement}),muteButtonText=isMuting?(0,i18n.__)("Removing audio…","web-stories"):(0,i18n.__)("Remove audio","web-stories"),trimButtonText=isTrimming?(0,i18n.__)("Trimming…","web-stories"):(0,i18n.__)("Trim","web-stories"),speak=(0,useLiveRegion.Z)();(0,react_src.d4)((()=>{isMuting&&speak(muteButtonText)}),[isMuting,muteButtonText,speak]),(0,react_src.d4)((()=>{isTrimming&&speak(trimButtonText)}),[isTrimming,trimButtonText,speak]);const slideId=(0,react_src.UX)((()=>`slide-${(0,v4.Z)()}`)),Processing=()=>(0,jsx_runtime.jsx)(Spinner,{children:(0,jsx_runtime.jsx)(circular.Z,{size:24})});return(0,jsx_runtime.jsxs)(panel.me,{name:"videoOptions",title:(0,i18n.__)("Video Settings","web-stories"),children:[(0,jsx_runtime.jsxs)(videoOptions_Row,{spaceBetween:!1,children:[(0,jsx_runtime.jsx)(loopPanelContent.Z,{loop,onChange:evt=>pushUpdate({loop:evt.target.checked},!0)}),canTrim&&(0,jsx_runtime.jsxs)(TrimWrapper,{children:[(0,jsx_runtime.jsx)(TrimButton,{disabled:isDisabled,variant:constants.Wu.Rectangle,type:constants.L$.Secondary,size:constants.qE.Small,onClick:handleTrim,children:trimButtonText}),isTrimming&&(0,jsx_runtime.jsx)(Processing,{})]})]}),showVolumeControl&&(0,jsx_runtime.jsxs)(VolumeWrapper,{children:[(0,jsx_runtime.jsx)(typography_text.x.Label,{size:types.TextSize.Small,htmlFor:slideId,children:(0,i18n.__)("Volume","web-stories")}),(0,jsx_runtime.jsx)(StyledSlider,{value:Math.round(100*volume),handleChange:value=>{const newVolume=Math.max(.1,value/100);pushUpdate({volume:newVolume},!0)},minorStep:5,majorStep:10,min:0,max:100,id:slideId,"aria-label":(0,i18n.__)("Volume","web-stories")})]}),canMute&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(videoOptions_Row,{spaceBetween:!1,children:[(0,jsx_runtime.jsx)(videoOptions_StyledButton,{disabled:isDisabled,variant:constants.Wu.Rectangle,type:constants.L$.Secondary,size:constants.qE.Small,onClick:handleMute,children:muteButtonText}),isMuting&&(0,jsx_runtime.jsx)(Processing,{})]}),(0,jsx_runtime.jsx)(videoOptions_Row,{children:(0,jsx_runtime.jsx)(videoOptions_HelperText,{children:(0,i18n.__)("Removing the audio from this video will upload a new muted version of it to the media library. This might take a couple of seconds.","web-stories")})})]})]})}VideoOptionsPanel.displayName="VideoOptionsPanel";const videoOptions=VideoOptionsPanel,videoSegment_Row=(0,styled_components_browser_esm.ZP)(components_form.X2).withConfig({displayName:"videoSegment__Row",componentId:"sc-ohj8ek-0"})(["margin-top:2px;"]),videoSegment_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"videoSegment__StyledButton",componentId:"sc-ohj8ek-1"})(["padding:12px 8px;"]),SliderWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"videoSegment__SliderWrapper",componentId:"sc-ohj8ek-2"})(["flex:1;margin-right:20px;"]),videoSegment_StyledSlider=(0,styled_components_browser_esm.ZP)(slider.Z).withConfig({displayName:"videoSegment__StyledSlider",componentId:"sc-ohj8ek-3"})(["width:100%;"]),videoSegment_HelperText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.XSmall}).withConfig({displayName:"videoSegment__HelperText",componentId:"sc-ohj8ek-4"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary));function VideoSegmentPanel({pushUpdate,selectedElements}){const resource=(0,shared.d9)(selectedElements,"resource"),elementId=(0,shared.d9)(selectedElements,"id"),enableSegmentVideo=(0,flagged_esm.SS)("segmentVideo"),segmentTime=(0,shared.d9)(selectedElements,"segmentTime",20),{pageIds,currentPageId,deleteElementById,addElementsAcrossPages}=(0,app_story.rB)((({state:{pages,currentPageId},actions:{deleteElementById,addElementsAcrossPages}})=>({pageIds:pages.map((({id})=>id)),currentPageId,deleteElementById,addElementsAcrossPages}))),{isBatchUploading,segmentVideo}=(0,app_media.EF)((({state:{isBatchUploading},actions:{segmentVideo}})=>({segmentVideo,isBatchUploading}))),[batchId,setBatchId]=(0,react_src.eJ)(),[isSegmenting,setIsSegmenting]=(0,react_src.eJ)(),[segmentedFiles,setSegmentedFiles]=(0,react_src.eJ)([]),[segmentElementId,setSegmentElementId]=(0,react_src.eJ)(),[segmentPageId,setSegmentPageId]=(0,react_src.eJ)(),isUploading=batchId&&isBatchUploading(batchId),showSnackbar=(0,useSnackbar.D)((({showSnackbar})=>showSnackbar)),segmentButtonText=isSegmenting?(0,i18n.__)("Segmenting…","web-stories"):(0,i18n.__)("Segment","web-stories"),addElementsToPages=(0,react_src.I4)((()=>{if(!segmentPageId||!segmentElementId)return;showSnackbar({message:(0,i18n.__)("Inserting video segments","web-stories"),dismissible:!1});const elements=segmentedFiles.map((segmentedResource=>(0,elements_src.vy)(segmentedResource.type,(0,getElementProperties.Z)(segmentedResource.type,{resource:segmentedResource})))),page=(0,elements_src.D4)(),position=pageIds.indexOf(segmentPageId);addElementsAcrossPages({elements,page,position}),deleteElementById({elementId:segmentElementId}),setSegmentedFiles([]),setIsSegmenting(!1),setBatchId(null)}),[segmentPageId,segmentElementId,showSnackbar,segmentedFiles,pageIds,addElementsAcrossPages,deleteElementById]),onClick=(0,react_src.I4)((async()=>{setIsSegmenting(!0),setSegmentElementId(elementId),setSegmentPageId(currentPageId),showSnackbar({message:(0,i18n.__)("Video segmentation in progress","web-stories"),dismissible:!0});const batchId_=await segmentVideo({resource,segmentTime},(({resource:newResource,batchPosition})=>{setSegmentedFiles((f=>(f[batchPosition]=newResource,f)))}));if(!batchId_)return showSnackbar({message:(0,i18n.__)("Segmentation failed","web-stories"),dismissible:!0}),void setIsSegmenting(!1);setBatchId(batchId_)}),[elementId,currentPageId,showSnackbar,segmentVideo,segmentTime,resource]);return(0,react_src.d4)((()=>{!isUploading&&segmentedFiles.length>=1&&addElementsToPages()}),[isUploading,segmentedFiles,addElementsToPages]),!enableSegmentVideo||resource.length<=10?null:(0,jsx_runtime.jsxs)(panel.me,{name:"videoOptions",title:(0,i18n.__)("Video Segment Settings","web-stories"),children:[(0,jsx_runtime.jsxs)(videoSegment_Row,{spaceBetween:!0,children:[(0,jsx_runtime.jsx)(SliderWrapper,{children:(0,jsx_runtime.jsx)(videoSegment_StyledSlider,{value:segmentTime,handleChange:value=>{pushUpdate({segmentTime:value},!0)},minorStep:1,majorStep:5,min:10,max:Math.max(10,Math.min(resource.length,60)),"aria-label":(0,i18n.__)("Segment length","web-stories"),suffix:"s"})}),(0,jsx_runtime.jsx)(videoSegment_StyledButton,{disabled:isSegmenting,variant:constants.Wu.Rectangle,type:constants.L$.Secondary,size:constants.qE.Small,onClick,children:segmentButtonText})]}),(0,jsx_runtime.jsx)(videoSegment_Row,{children:(0,jsx_runtime.jsx)(videoSegment_HelperText,{children:(0,i18n.__)("Segmenting your video will split the video across multiple pages","web-stories")})})]})}VideoSegmentPanel.displayName="VideoSegmentPanel";const videoSegment=VideoSegmentPanel;var backgroundAudioPanelContent=__webpack_require__("./packages/story-editor/src/components/panels/shared/media/backgroundAudioPanelContent.js");const backgroundAudio_HelperText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"backgroundAudio__HelperText",componentId:"sc-qyqy4a-0"})(["color:",";"],(({theme})=>theme.colors.fg.secondary)),HighlightRow=(0,styled_components_browser_esm.ZP)(components_form.X2).attrs({spaceBetween:!1}).withConfig({displayName:"backgroundAudio__HighlightRow",componentId:"sc-qyqy4a-1"})(["position:relative;&::after{content:'';position:absolute;top:-10px;bottom:-10px;left:-20px;right:-10px;"," pointer-events:none;}"],(({isHighlighted})=>isHighlighted&&highlights_styles.Z.FLASH));function PageBackgroundAudioPanel(){const{backgroundAudio,currentPageId,updateCurrentPageProperties}=(0,app.rB)((state=>({updateCurrentPageProperties:state.actions.updateCurrentPageProperties,backgroundAudio:state.state.currentPage?.backgroundAudio,currentPageId:state.state.currentPage?.id}))),{highlightBackgroundAudio,resetHighlight}=(0,useHighlights.Z)((state=>({highlightBackgroundAudio:state[highlights.$q.PageBackgroundAudio],resetHighlight:state.onFocusOut}))),updateBackgroundAudio=(0,react_src.I4)((updatedBackgroundAudio=>{updateCurrentPageProperties({properties:{backgroundAudio:updatedBackgroundAudio}})}),[updateCurrentPageProperties]);return(0,jsx_runtime.jsxs)(panel.me,{name:"pageBackgroundAudio",title:(0,i18n.__)("Page Background Audio","web-stories"),collapsedByDefault:!1,isPersistable:!highlightBackgroundAudio,children:[(0,jsx_runtime.jsx)(HighlightRow,{isHighlighted:highlightBackgroundAudio?.showEffect,onAnimationEnd:()=>resetHighlight(),children:(0,jsx_runtime.jsx)(backgroundAudio_HelperText,{children:(0,i18n.__)("Select an audio file that plays while this page is in view.","web-stories")})}),(0,jsx_runtime.jsx)(backgroundAudioPanelContent.Z,{backgroundAudio,updateBackgroundAudio,showCaptions:!0,showLoopControl:!0,audioId:`page-${currentPageId}-background-audio`})]})}PageBackgroundAudioPanel.displayName="PageBackgroundAudioPanel";const backgroundAudio=PageBackgroundAudioPanel;var productDropdown=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/productDropdown.js");function ProductPanel({selectedElements,pushUpdate}){const isMultiple=(0,shared.d9)(selectedElements,"product",[])===story_editor_src_constants.mh,setProduct=(0,react_src.I4)((newProduct=>pushUpdate({product:newProduct})),[pushUpdate]);return(0,jsx_runtime.jsx)(panel.me,{name:"product",title:(0,i18n.__)("Product","web-stories"),collapsedByDefault:!1,children:(0,jsx_runtime.jsxs)(components_form.X2,{children:[isMultiple&&(0,jsx_runtime.jsx)(input_input.Z,{onChange:noop.Z,disabled:!0,value:story_editor_src_constants.nz,"aria-label":(0,i18n.__)("Product","web-stories")}),!isMultiple&&(0,jsx_runtime.jsx)(productDropdown.Z,{product:selectedElements[0].product,setProduct})]})})}ProductPanel.displayName="ProductPanel";const product=ProductPanel,ALL=Object.values(panelTypes.Z);const style_getDesignPanelsForSelection=function getDesignPanelsForSelection(elements){if(0===elements.length)return[];if(1===elements.length&&elements[0].isBackground){const panels=[];return!elements[0].isDefaultBackground&&(panels.push({type:panelTypes.Z.PageBackground,Panel:pageBackground}),panels.push({type:panelTypes.Z.Filter,Panel:filter}),panels.push({type:panelTypes.Z.Animation,Panel:animation})),"video"===elements[0].type?(panels.push({type:panelTypes.Z.VideoOptions,Panel:videoOptions}),panels.push({type:panelTypes.Z.VideoSegment,Panel:videoSegment}),panels.push({type:panelTypes.Z.Captions,Panel:captions}),panels.push({type:panelTypes.Z.VideoAcessibility,Panel:videoAccessibility})):["gif","image"].includes(elements[0].type)?panels.push({type:panelTypes.Z.ImageAccessibility,Panel:imageAccessibility}):panels.unshift({type:panelTypes.Z.PageBackground,Panel:pageBackground}),panels.push({type:panelTypes.Z.PageAttachment,Panel:pageAttachment}),panels.push({type:panelTypes.Z.PageBackgroundAudio,Panel:backgroundAudio}),panels.push({type:panelTypes.Z.PageAdvancement,Panel:customPageAdvancement}),panels}return elements.map((({type})=>elements_src.am[type].panels)).reduce(((commonPanels,panels)=>function intersect(a,b){return a.filter((v=>b.includes(v)))}(commonPanels,panels)),ALL).map((type=>{switch(type){case panelTypes.Z.Animation:return{type,Panel:animation};case panelTypes.Z.PageBackground:return null;case panelTypes.Z.Filter:return{type,Panel:filter};case panelTypes.Z.SizePosition:return{type,Panel:sizePosition};case panelTypes.Z.Link:return{type,Panel:link_link};case panelTypes.Z.TextStyle:return{type,Panel:textStyle};case panelTypes.Z.TextAccessibility:return{type,Panel:textAccessibility};case panelTypes.Z.ShapeStyle:return{type,Panel:shapeStyle};case panelTypes.Z.Border:return{type,Panel:border};case panelTypes.Z.VideoOptions:return{type,Panel:videoOptions};case panelTypes.Z.VideoSegment:return{type,Panel:videoSegment};case panelTypes.Z.Captions:return{type,Panel:captions};case panelTypes.Z.VideoAcessibility:return{type,Panel:videoAccessibility};case panelTypes.Z.ImageAccessibility:return{type,Panel:imageAccessibility};case panelTypes.Z.ElementAlignment:return{type,Panel:alignment};case panelTypes.Z.Product:return{type,Panel:product};default:throw new Error(`Unknown panel: ${type}`)}})).filter((panel=>panel))};const style_useDesignPanels=function useDesignPanels(){const{selectedElementIds,selectedElements,selectedElementAnimations,deleteSelectedElements,updateElementsById,updateAnimationState}=(0,app.rB)((({state:{selectedElementIds,selectedElements,selectedElementAnimations},actions:{deleteSelectedElements,updateElementsById,updateAnimationState}})=>({selectedElementIds,selectedElements,selectedElementAnimations,deleteSelectedElements,updateElementsById,updateAnimationState}))),panels=(0,react_src.Ye)((()=>style_getDesignPanelsForSelection(selectedElements)),[selectedElements]),[submitHandlers,registerSubmitHandler]=utils_useHandlers(),onSetProperties=(0,react_src.I4)((newPropertiesOrUpdater=>{updateElementsById({elementIds:selectedElementIds,properties:element=>(0,updateProperties.Z)(element,newPropertiesOrUpdater,!0)})}),[selectedElementIds,updateElementsById]),createSubmitHandlerForPanel=(0,react_src.I4)((panelId=>submit=>(submitHandlers.forEach((handler=>handler(onSetProperties,panelId,submit))),submit)),[onSetProperties,submitHandlers]);return(0,react_src.d4)((()=>{const submits={},unregister=registerSubmitHandler(((onSetPropertiesArg,panelId,submit)=>{onSetProperties===onSetPropertiesArg&&(submits[panelId]=submit)}));return()=>{unregister(),Object.values(submits).forEach((submit=>submit()))}}),[onSetProperties,registerSubmitHandler]),(0,react_src.Ye)((()=>({panels,createSubmitHandlerForPanel,panelProperties:{onSetProperties,deleteSelectedElements,selectedElements,selectedElementIds,selectedElementAnimations,updateAnimationState}})),[panels,createSubmitHandlerForPanel,onSetProperties,deleteSelectedElements,selectedElements,selectedElementIds,selectedElementAnimations,updateAnimationState])},stylePanes_StyledPane=(0,styled_components_browser_esm.ZP)(panes_shared.X6).withConfig({displayName:"stylePanes__StyledPane",componentId:"sc-18fi38s-0"})(["height:100%;padding:0;overflow-y:auto;"]);const stylePanes=function StylePanes(){const{tab,tabs}=style_useStyle((state=>({tab:state.state.tab,tabs:state.data.tabs}))),{panels,createSubmitHandlerForPanel,panelProperties}=style_useDesignPanels(),getPanelsByType=(0,react_src.I4)(((types,paneProps)=>{const panelsList=panels.filter((({type})=>types.includes(type))).map((({Panel,type})=>(0,jsx_runtime.jsx)(designPanel,{panelType:Panel,registerSubmitHandler:createSubmitHandlerForPanel(type),...panelProperties},type)));return(0,jsx_runtime.jsx)(stylePanes_StyledPane,{id:(0,panes_shared.Qk)(paneProps.key),...paneProps,children:panelsList})}),[panels,createSubmitHandlerForPanel,panelProperties]);return tabs.map((({id})=>{const isActive=id===tab,paneProps={key:id,isActive,"aria-labelledby":(0,panes_shared.pQ)(id)};if(!isActive)return(0,jsx_runtime.jsx)(panes_shared.X6,{...paneProps},id);switch(id){case SELECTION.id:case LINK.id:case ANIMATION.id:return getPanelsByType(panelSections.F[id],paneProps);default:return null}}))},styleLayout_Layout=styled_components_browser_esm.ZP.section.attrs({"aria-label":(0,i18n.__)("Style","web-stories"),"data-testid":"styleLayout"}).withConfig({displayName:"styleLayout__Layout",componentId:"sc-1ihuio6-0"})(["height:100%;display:flex;flex-direction:column;background-color:",";color:",";max-height:100%;"],(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.fg.primary)),styleLayout_TabsArea=styled_components_browser_esm.ZP.nav.attrs({"aria-label":(0,i18n.__)("Style tabs","web-stories")}).withConfig({displayName:"styleLayout__TabsArea",componentId:"sc-1ihuio6-1"})([""]),styleLayout_UnjustifiedTabView=(0,styled_components_browser_esm.ZP)(tabview.ZP).withConfig({displayName:"styleLayout__UnjustifiedTabView",componentId:"sc-1ihuio6-2"})(["justify-content:center;"]),StylePaneContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleLayout__StylePaneContainer",componentId:"sc-1ihuio6-3"})(["height:100%;overflow-y:auto;min-height:0;"]),NoSelection=styled_components_browser_esm.ZP.div.withConfig({displayName:"styleLayout__NoSelection",componentId:"sc-1ihuio6-4"})(["height:100%;display:flex;justify-content:center;align-items:center;"]),Note=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"styleLayout__Note",componentId:"sc-1ihuio6-5"})(["color:",";"],(({theme})=>theme.colors.fg.secondary));function StyleLayout(){const{state:{tab},actions:{setTab},refs:{tabRefs},data:{tabs}}=style_useStyle(),{selectedElementIds}=(0,app_story.rB)((({state})=>({selectedElementIds:state.selectedElementIds}))),{highlight,resetHighlight}=(0,highlights.QM)((state=>({highlight:{[SELECTION.id]:state[highlights.$q.Style],[LINK.id]:state[highlights.$q.Style],[ANIMATION.id]:state[highlights.$q.Style]},resetHighlight:state.onFocusOut}))),onTabChange=(0,react_src.I4)((id=>{setTab(id),resetHighlight(),(0,tracking_src.L9)("style_tab_change",{name:id})}),[setTab,resetHighlight]);return 0===selectedElementIds.length?(0,jsx_runtime.jsx)(NoSelection,{children:(0,jsx_runtime.jsx)(Note,{size:types.TextSize.Medium,children:(0,i18n.__)("Nothing selected","web-stories")})}):(0,jsx_runtime.jsxs)(styleLayout_Layout,{children:[(0,jsx_runtime.jsx)(styleLayout_TabsArea,{children:(0,jsx_runtime.jsx)(styleLayout_UnjustifiedTabView,{label:(0,i18n.__)("Style Selection","web-stories"),tabs,tabRefs,tab,onTabChange,onTabRefUpdated:(node,tabId)=>{const h=highlight[tabId];node&&h?.focus&&h?.showEffect&&node.focus()},getTabId:panes_shared.pQ,getAriaControlsId:panes_shared.Qk})}),(0,jsx_runtime.jsx)(StylePaneContainer,{children:(0,jsx_runtime.jsx)(stylePanes,{})})]})}StyleLayout.displayName="StyleLayout";const styleLayout=StyleLayout;function Style(){return(0,jsx_runtime.jsx)(styleProvider,{children:(0,jsx_runtime.jsx)(styleLayout,{})})}Style.displayName="Style";const style_style=Style;var sidebar_constants=__webpack_require__("./packages/story-editor/src/components/sidebar/constants.ts"),sidebar_context=__webpack_require__("./packages/story-editor/src/components/sidebar/context.js");const TABS=[{id:sidebar_constants.Jm,title:(0,i18n.__)("Insert","web-stories"),Pane:library},{id:sidebar_constants.BI,title:(0,i18n.__)("Style","web-stories"),Pane:style_style}],SIDEBAR_TAB_IDS=new Set([sidebar_constants.Jm,sidebar_constants.K0,sidebar_constants.BI]);function SidebarProvider({sidebarTabs,children}){const{actions:{getAuthors}}=(0,api.Ek)(),{selectedElementIds,currentPage}=(0,app_story.rB)((({state})=>({selectedElementIds:state.selectedElementIds,currentPage:state.currentPage}))),{tab:highlightedTab,highlight}=(0,highlights.QM)((state=>({tab:state.tab,highlight:state[highlights.$q.StylePane]})));(0,react_src.d4)((()=>{SIDEBAR_TAB_IDS.has(highlightedTab)&&(setTab(highlightedTab),(0,tracking_src.L9)("quick_action_tab_change",{name:highlightedTab}))}),[highlightedTab]);const sidebarRef=(0,react_src.sO)(null),[tab,setTab]=(0,react_src.eJ)(sidebar_constants.Jm),[users,setUsers]=(0,react_src.eJ)([]),[sidebarContentHeight,setSidebarContentHeight]=(0,react_src.eJ)(null),sidebarContentRef=(0,react_src.sO)(),tabRef=(0,react_src.sO)(tab),insertPaneRef=(0,react_src.sO)(null),designPaneRef=(0,react_src.sO)(null),documentPaneRef=(0,react_src.sO)(null),tabRefs=(0,react_src.Ye)((()=>({[sidebar_constants.Jm]:insertPaneRef,[sidebar_constants.BI]:designPaneRef,[sidebar_constants.K0]:documentPaneRef})),[]),[usersLoadingState,setUsersLoadingState]=(0,react_src.eJ)("idle"),setSidebarContentNode=(0,react_src.I4)((node=>{sidebarContentRef.current=node}),[]);(0,react_src.Bz)(sidebarContentRef,(({height})=>setSidebarContentHeight(height)),[]),(0,react_src.d4)((()=>{selectedElementIds.length>0&&tabRef.current===sidebar_constants.K0&&setTab(sidebar_constants.BI)}),[selectedElementIds]),(0,react_src.d4)((()=>{tabRef.current===sidebar_constants.K0&&setTab(sidebar_constants.BI)}),[currentPage]),(0,react_src.d4)((()=>{const node=designPaneRef.current;node&&highlight?.focus&&highlight?.showEffect&&node.focus()}),[highlight]);const loadUsers=(0,react_src.I4)((()=>{"finished"!==usersLoadingState&&"errored"!==usersLoadingState&&0===users.length&&(setUsersLoadingState("loading"),getAuthors().then((data=>{const saveData=data.map((({id,name})=>({id,name})));setUsers(saveData),setUsersLoadingState("finished")})).catch((()=>{setUsersLoadingState("errored")})))}),[usersLoadingState,users.length,getAuthors]),tabs=(0,react_src.Ye)((()=>[...TABS,sidebarTabs?.document&&{id:sidebar_constants.K0,...sidebarTabs.document}].filter(Boolean)),[sidebarTabs]),data=(0,react_src.Ye)((()=>({tabs,modalSidebarTab:sidebarTabs?.publishModal&&{id:sidebar_constants.k3,...sidebarTabs.publishModal}})),[tabs,sidebarTabs]),state={state:{tab,tabRefs,users,sidebarContentHeight,usersLoadingState},refs:{sidebar:sidebarRef},actions:{setTab,loadUsers,setSidebarContentNode},data};return(0,jsx_runtime.jsx)(sidebar_context.Z.Provider,{value:state,children})}SidebarProvider.displayName="SidebarProvider";const sidebarProvider=SidebarProvider,Editor=(0,moveable_src.Ep)(styled_components_browser_esm.ZP.section.attrs({"aria-label":(0,i18n.__)("Web Stories Editor","web-stories")}).withConfig({displayName:"layout__Editor",componentId:"sc-9gpyr-0"})([""," background-color:",";position:relative;max-height:100vh;height:100%;width:100%;display:grid;grid:'sidebar   canv          ' 1fr 'sidebar   supplementary ' auto / ","px minmax(","px,1fr);"],expandPresetStyles.K((({paragraph},{Medium})=>paragraph[Medium])),(({theme})=>theme.colors.bg.primary),story_editor_src_constants.ZR,story_editor_src_constants.tl));const components_layout=function layout_Layout({header,footer={},sidebarTabs,children}){const snackbarState=(0,useSnackbar.D)((({removeSnack,currentSnacks,placement})=>({onRemove:removeSnack,notifications:currentSnacks,placement})));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(layoutProvider.Z,{children:(0,jsx_runtime.jsx)(checklist.Vi,{children:(0,jsx_runtime.jsx)(highlights.LM,{children:(0,jsx_runtime.jsx)(sidebarProvider,{sidebarTabs,children:(0,jsx_runtime.jsxs)(Editor,{zIndex:3,children:[(0,jsx_runtime.jsx)(app_canvas.K,{children:(0,jsx_runtime.jsx)(rightClickMenu_provider,{children:(0,jsx_runtime.jsxs)(components_mediaRecording.NK,{children:[(0,jsx_runtime.jsx)(workspace,{header,footer}),(0,jsx_runtime.jsx)(rightClickMenu,{})]})})}),children]})})})})}),(0,jsx_runtime.jsx)(snackbarContainer.Z,{...snackbarState})]})},AutoSaveDialog=({onClose,isOpen,autoSaveLink})=>(0,jsx_runtime.jsx)(dialog.Z,{isOpen,title:(0,i18n.__)("Autosave","web-stories"),contentLabel:(0,i18n.__)("Autosave Available","web-stories"),secondaryText:(0,i18n.__)("Dismiss","web-stories"),onClose,actions:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(button_button.z,{type:constants.L$.Tertiary,size:constants.qE.Small,onClick:onClose,children:(0,i18n.__)("Dismiss","web-stories")}),(0,jsx_runtime.jsx)(button_button.i,{type:constants.L$.Primary,size:constants.qE.Small,href:autoSaveLink,children:(0,i18n.__)("View the autosave","web-stories")})]}),children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.Small,children:(0,i18n.__)("There is an autosave of this story that is more recent than the version you are editing.","web-stories")})});AutoSaveDialog.displayName="AutoSaveDialog";const AutoSaveCheck=()=>{const{autoSaveLink}=(0,app_config.ZR)(),[showDialog,setShowDialog]=(0,react_src.eJ)(Boolean(autoSaveLink));return(0,jsx_runtime.jsx)(AutoSaveDialog,{isOpen:showDialog,onClose:()=>setShowDialog(!1),autoSaveLink})};AutoSaveCheck.displayName="AutoSaveCheck";async function getFonts(params){let{default:fonts}=await __webpack_require__.e(3766).then(__webpack_require__.t.bind(__webpack_require__,"./packages/fonts/src/fonts.json",19));if(fonts=fonts.map((font=>({id:font.family,name:font.family,value:font.family,...font}))),params.include){const include=params.include.split(",");fonts=fonts.filter((({family})=>include.includes(family)))}return params.search&&(fonts=fonts.filter((({family})=>family.toLowerCase().includes(params.search)))),fonts}var createResource=__webpack_require__("./packages/media/src/createResource.ts");function createDummyImageData({mimeType="image/jpeg",src,width,height,id,title}){return(0,createResource.Z)({mimeType,creationDate:"2021-10-29T11:43:38",src,width,height,id,alt:title,sizes:{medium:{file:`${title}-300x84.jpeg`,width:300,height:84,mimeType,sourceUrl:src},large:{file:`${title}-1024x288.jpeg`,width:1024,height:288,mimeType,sourceUrl:src},thumbnail:{file:`${title}-150x150.jpeg`,width:150,height:150,mimeType,sourceUrl:src},medium_large:{file:`${title}-768x216.jpeg`,width:768,height:216,mimeType,sourceUrl:src},"1536x1536":{file:`${title}-1536x432.jpeg`,width:1536,height:432,mimeType,sourceUrl:src},"2048x2048":{file:`${title}-2048x576.jpeg`,width:2048,height:576,mimeType,sourceUrl:src},"post-thumbnail":{file:`${title}-1568x441.jpeg`,width:1568,height:441,mimeType,sourceUrl:src},"web-stories-poster-portrait":{file:`${title}-640x853.jpeg`,width:640,height:853,mimeType,sourceUrl:src},"web-stories-publisher-logo":{file:`${title}-96x96.jpeg`,width:96,height:96,mimeType,sourceUrl:src},"web-stories-thumbnail":{file:`${title}-150x42.jpeg`,width:150,height:42,mimeType,sourceUrl:src},full:{file:title,width,height,mimeType,sourceUrl:src}}})}function createDummyVideoData({mimeType="video/mp4",src,mediaDetails,id,title,poster}){return(0,createResource.Z)({mimeType,creationDate:"2021-10-29T11:56:33",src,width:mediaDetails.width,height:mediaDetails.height,poster:poster.src,posterId:57,id,length:mediaDetails.length,bitsPerSample:mediaDetails.bitsPerSample,alt:title})}const getMedia=params=>{const dummyMedia=function getDummyMedia(){return[createDummyImageData({mimeType:"image/png",src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page1_bg-alt.png",width:412,height:732,id:1,title:"Fresh and Bright 1"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page3_figure.jpg",width:720,height:844,id:2,title:"Fresh and Bright 2"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page4_bg.png",width:750,height:1334,id:3,title:"Fresh and Bright 3"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page5_figure.jpg",width:750,height:1079,id:4,title:"Fresh and Bright 4"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page7_product1.jpg",width:720,height:900,id:5,title:"Fresh and Bright 5"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page8_figure.jpg",width:408,height:544,id:6,title:"Fresh and Bright 6"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page9_story1.jpg",width:720,height:405,id:7,title:"Fresh and Bright 7"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page9_story2.jpg",width:480,height:720,id:8,title:"Fresh and Bright 8"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/fresh-and-bright/page9_story3.jpg",width:480,height:720,id:9,title:"Fresh and Bright 9"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/food-and-stuff/page1_bg.jpg",width:1080,height:1620,id:10,title:"Fresh and Bright 10"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/food-and-stuff/page3_image1.jpg",width:1080,height:720,id:11,title:"Food and Stuff 1"}),createDummyImageData({src:"https://wp.stories.google/static/main/images/templates/food-and-stuff/page5_bg.jpg",width:731,height:1300,id:12,title:"Food and Stuff 2"}),createDummyVideoData({src:"https://stream.mux.com/OGTmBYTMkV7Ez601cRNpH6BP10102fQu9C00/high.mp4?token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InQ5UHZucm9ZY0hQNjhYSmlRQnRHTEVVSkVSSXJ0UXhKIn0.eyJleHAiOjE2MjYxNzgxMTIsImF1ZCI6InYiLCJzdWIiOiJPR1RtQllUTWtWN0V6NjAxY1JOcEg2QlAxMDEwMmZRdTlDMDAifQ.Jvddeah-XyF0AMmfYND-fFaIfgeDYW_cAuIVIXOrk2so_YalyMMAQ11YXHA1h11yKpLM-xa8xiNXazPqA0Suq1tfxHjJjEqiQOzSlPYd4visiPdTjUgT50FkwYdJrN0IldfXoS19yi3GyAd9McVFoSGCZ6qp8m_hgJ39y8FJJbOrvGtrzEvElpz1M8M1Dat3PF-BSLvFcTvCOlec9dipajxHG_2Xg-EE_vOqww6z81kC09evj5gu_A-Vz58Q-ebd08R47ybNejhE3rzMr1dCKgUikjkkQokPPQyrwVEy8zeZ68elax-ZRvDokZ2mTVPGvKIye6m_CQ-WVlG5XRjw7A",mediaDetails:{filesize:1867215,mimeType:"video/mp4",length:12,lengthFormatted:"0:12",width:720,height:406,fileformat:"mp4",dataformat:"quicktime",audio:{dataformat:"mp4",codec:"ISO/IEC 14496-3 AAC",sampleRate:48e3,channels:2,bitsPerSample:16,lossless:!1,channelmode:"stereo"},createdTimestamp:-2082844800,sizes:{}},id:13,title:"Story",poster:{src:"https://image.mux.com/OGTmBYTMkV7Ez601cRNpH6BP10102fQu9C00/thumbnail.jpg?token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InQ5UHZucm9ZY0hQNjhYSmlRQnRHTEVVSkVSSXJ0UXhKIn0.eyJ0aW1lIjowLCJleHAiOjMxNzE3MDYwNjg4MSwiYXVkIjoidCIsInN1YiI6Ik9HVG1CWVRNa1Y3RXo2MDFjUk5wSDZCUDEwMTAyZlF1OUMwMCJ9.WxHU2cpFdNqqiWF08KEv1g7barfbE_Nw4JDvVrtrQc9mVKiSZ6pEHpYl14NZeaBOf4Ep9MiomaegCVrD-UANhURlxWuHWFx5h7Msg74-q_ojjuZbLZtFPUdA0NA3_GTq5y0LDAeXijM7oENn_IkuDSY0fbRhRUVh-hYqCzw_OqMx7B1IxoOkkZUCHgkm9VnPdAMQRpmaanCHB8SHVRI_vIJo577DxLd88KBFP3UWK1XTvN5NYr0oPtwc82XMYUW4HrxZZTmxzLSZckxzwB7T5E6zAtXpo-xwd52yB1OUhoihlTqiOPWbntpvt9H4lFVRISLwsT39d1Tw80HF_X02eQ",width:1920,height:1080,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/PDolZIrwdONTFJd005VOT4qvFsyxVfB01N/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM0NDQzfQ._6LJb2Ad843im0xV4-2I2vVpDNoPiy8nPc3-3IkSSuw",mediaDetails:{filesize:1510877,mimeType:"video/quicktime",length:18,lengthFormatted:"0:18",width:640,height:360,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{}},id:14,title:"Low",poster:{src:"https://storage.coverr.co/p/PDolZIrwdONTFJd005VOT4qvFsyxVfB01N",width:2048,height:1152,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/qMc3OVOA8a6Q9j01T2L3pGfF029UA00OvZJ/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM3NDkwfQ.rHiHdTyik8sDuP8viRbC4ph-qjHHJ81I7kdawP2-1eQ",mediaDetails:{filesize:456538,mimeType:"video/mp4",length:15,lengthFormatted:"0:15",width:360,height:640,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{},audio:{bitsPerSample:16,channelmode:"stereo",channels:2,codec:"ISO/IEC 14496-3 AAC",dataformat:"mp4",lossless:!1,sampleRate:48e3}},id:15,title:"Mountain Video",poster:{src:"https://storage.coverr.co/p/qMc3OVOA8a6Q9j01T2L3pGfF029UA00OvZJ",width:1080,height:1920,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/XHtOLYGTnHiXVxofSdO8oTcA02vxasheL/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM3NDkwfQ.rHiHdTyik8sDuP8viRbC4ph-qjHHJ81I7kdawP2-1eQ",mediaDetails:{filesize:2536304,mimeType:"video/mp4",length:27,lengthFormatted:"0:27",width:640,height:360,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{},audio:{bitsPerSample:16,channelmode:"stereo",channels:2,codec:"ISO/IEC 14496-3 AAC",dataformat:"mp4",lossless:!1,sampleRate:48e3}},id:16,title:"Beautiful Cloud Video",poster:{src:"https://storage.coverr.co/p/XHtOLYGTnHiXVxofSdO8oTcA02vxasheL",width:1920,height:1080,generated:!1}}),createDummyVideoData({src:"https://storage.coverr.co/videos/X4pOA7IG76p95Gl3IcU3oX26S2sbGsc2/preview?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjEyNjFDMkM5QUYxNEY5NkJDRTc2IiwiaWF0IjoxNjI2ODM4Mjc3fQ.lIznWsYEFy3abrDbou1mKJivj6GzQnHO6gJ8jdisPW0",mediaDetails:{filesize:1029136,mimeType:"video/mp4",length:10,lengthFormatted:"0:10",width:640,height:360,fileformat:"mp4",dataformat:"quicktime",createdTimestamp:-2082844800,sizes:{},audio:{bitsPerSample:16,channelmode:"stereo",channels:2,codec:"ISO/IEC 14496-3 AAC",dataformat:"mp4",lossless:!1,sampleRate:48e3}},id:17,title:"Beautiful Fire Video",poster:{src:"https://storage.coverr.co/p/X4pOA7IG76p95Gl3IcU3oX26S2sbGsc2",width:1920,height:1080,generated:!1}})]}(),mediaResponse={data:dummyMedia,headers:{totalItems:dummyMedia.length,totalPages:1}};return params.searchTerm&&(mediaResponse.data=dummyMedia.filter((media=>media.alt.toLowerCase().includes(params.searchTerm.toLowerCase()))),mediaResponse.headers.totalItems=mediaResponse.data.length),Promise.resolve(mediaResponse)};var story_editor_constants=__webpack_require__("./.storybook/stories/playground/story-editor/constants.js");const saveStoryById=({pages,globalStoryStyles,autoAdvance,defaultPageDuration,currentStoryStyles,backgroundAudio,content,title,excerpt})=>{const storySaveData={title:{raw:title},excerpt:{raw:excerpt},storyData:{version:migration_src.n,pages,autoAdvance,defaultPageDuration,currentStoryStyles,backgroundAudio},author:{id:1,name:""},stylePresets:globalStoryStyles,permalinkTemplate:"https://example.org/web-stories/%pagename%/"};return window.localStorage.setItem(story_editor_constants.E,JSON.stringify(storySaveData)),window.localStorage.setItem(story_editor_constants.F,content),Promise.resolve({})};function saveButton_SaveButton(){const{isSaving,saveStory}=(0,app_story.rB)((({state:{meta:{isSaving}},actions:{saveStory}})=>({isSaving,saveStory}))),{showSnackbar}=(0,useSnackbar.D)();return(0,jsx_runtime.jsx)(button_button.z,{variant:constants.Wu.Rectangle,type:constants.L$.Primary,size:constants.qE.Small,onClick:()=>{saveStory().then((()=>{showSnackbar({message:"Story Saved"})}))},disabled:isSaving,children:"Save"})}saveButton_SaveButton.displayName="SaveButton";var dist=__webpack_require__("./node_modules/@storybook/addon-links/dist/index.mjs"),eye=__webpack_require__("./packages/design-system/src/icons/eye.svg");function preview_PreviewButton(){const{isSaving,saveStory}=(0,app_story.rB)((({state:{meta:{isSaving}},actions:{saveStory}})=>({isSaving,saveStory})));return(0,jsx_runtime.jsx)(components_tooltip.Z,{title:"Preview",hasTail:!0,children:(0,jsx_runtime.jsx)(button_button.z,{variant:constants.Wu.Square,type:constants.L$.Quaternary,size:constants.qE.Small,onClick:async()=>{await saveStory();const previewLink=await(0,dist.ew)("Playground/preview","default");try{const popup=window.open("about:blank","story-preview");popup&&(popup.document.write("<!DOCTYPE html><html><head>"),popup.document.write("<title>"),popup.document.write("Generating the preview…"),popup.document.write("</title>"),popup.document.write("</head><body>"),popup.document.write("Please wait. Generating the preview…"),popup.document.write(`<script>\n            setTimeout(function() {\n              location.replace(${JSON.stringify(previewLink)});\n            }, 5000);\n          <\/script>`))}catch(e){}},disabled:isSaving,children:(0,jsx_runtime.jsx)(eye.Z,{})})})}preview_PreviewButton.displayName="PreviewButton";const ButtonList=styled_components_browser_esm.ZP.nav.withConfig({displayName:"buttons__ButtonList",componentId:"sc-ds1kaw-0"})(["display:flex;justify-content:flex-end;padding:1em;height:100%;"]),List=styled_components_browser_esm.ZP.div.withConfig({displayName:"buttons__List",componentId:"sc-ds1kaw-1"})(["display:flex;align-items:center;"]),buttons_Space=styled_components_browser_esm.ZP.div.withConfig({displayName:"buttons__Space",componentId:"sc-ds1kaw-2"})(["width:8px;"]),buttons_Spinner=styled_components_browser_esm.ZP.div.withConfig({displayName:"buttons__Spinner",componentId:"sc-ds1kaw-3"})(["position:absolute;top:0;"]),IconWithSpinner=styled_components_browser_esm.ZP.div.withConfig({displayName:"buttons__IconWithSpinner",componentId:"sc-ds1kaw-4"})(["position:relative;"]);function Loading(){return(0,jsx_runtime.jsx)(buttons_Spinner,{children:(0,jsx_runtime.jsx)(circular.Z,{size:32})})}function Buttons(){const{isSaving}=(0,app_story.rB)((({state:{meta:{isSaving}}})=>({isSaving})));return(0,jsx_runtime.jsx)(ButtonList,{children:(0,jsx_runtime.jsxs)(List,{children:[(0,jsx_runtime.jsxs)(IconWithSpinner,{children:[(0,jsx_runtime.jsx)(preview_PreviewButton,{}),isSaving&&(0,jsx_runtime.jsx)(Loading,{})]}),(0,jsx_runtime.jsx)(buttons_Space,{}),(0,jsx_runtime.jsx)(saveButton_SaveButton,{})]})})}Loading.displayName="Loading",Buttons.displayName="Buttons";const Background=styled_components_browser_esm.ZP.header.attrs({role:"group","aria-label":"Story canvas header"}).withConfig({displayName:"header__Background",componentId:"sc-1iw47x9-0"})(["display:flex;align-items:center;justify-content:space-between;background-color:",";"],(({theme})=>theme.colors.bg.primary)),Head=styled_components_browser_esm.ZP.div.withConfig({displayName:"header__Head",componentId:"sc-1iw47x9-1"})(["flex:1 1 auto;padding:1em;"]),ButtonCell=styled_components_browser_esm.ZP.div.withConfig({displayName:"header__ButtonCell",componentId:"sc-1iw47x9-2"})(["grid-area:buttons;"]);function HeaderLayout(){return(0,jsx_runtime.jsxs)(Background,{children:[(0,jsx_runtime.jsx)(Head,{children:(0,jsx_runtime.jsx)(title,{})}),(0,jsx_runtime.jsx)(ButtonCell,{children:(0,jsx_runtime.jsx)(Buttons,{})})]})}HeaderLayout.displayName="HeaderLayout";const story_editor={title:"Playground/Stories Editor"},_default={render:function Render(){const content=window.localStorage.getItem(story_editor_constants.E),story=content?JSON.parse(content):{},apiCallbacks={saveStoryById,getMedia,getFonts};return element_library_src.am.forEach(elements_src.QS),(0,jsx_runtime.jsx)("div",{style:{height:"100vh"},children:(0,jsx_runtime.jsx)(storyEditor,{config:{apiCallbacks},initialEdits:{story},children:(0,jsx_runtime.jsx)(components_layout,{header:(0,jsx_runtime.jsx)(HeaderLayout,{})})})})}}},"./packages/design-system/src/components/contextMenu/components/subMenuTrigger.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/react/src/index.ts"),_keyboard__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/design-system/src/utils/constants.ts"),_contextMenuProvider__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/design-system/src/components/contextMenu/contextMenuProvider/useContextMenu.ts"),_item__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/design-system/src/components/contextMenu/components/item.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");function SubMenuTrigger({openSubMenu,closeSubMenu,isSubMenuOpen,isRTL=!1,subMenuRef,parentMenuRef,...buttonProps}){const ref=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.sO)(null),pointerTracker=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.sO)({}),{setFocusedId}=(0,_contextMenuProvider__WEBPACK_IMPORTED_MODULE_6__.Z)((({actions})=>({setFocusedId:actions.setFocusedId}))),pointerIsOutside=node=>{const{x,y,width,height}=node.getBoundingClientRect(),{x:pointerX,y:pointerY}=pointerTracker.current;if(void 0===pointerX||void 0===pointerY)return!0;return pointerX<x-2||pointerX>x+width+2||pointerY<y-2||pointerY>y+height+2},maybeCloseSubMenu=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.y1)((()=>{ref.current&&subMenuRef.current?.firstChild&&subMenuRef.current.firstChild instanceof Element&&pointerIsOutside(ref.current)&&pointerIsOutside(subMenuRef.current.firstChild)&&closeSubMenu()}),200);(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.d4)((()=>{if(isSubMenuOpen&&subMenuRef.current){const subMenuItems=function getFocusableChildren(parent){return Array.from(parent.querySelectorAll(_utils__WEBPACK_IMPORTED_MODULE_5__.G.join(", "))).filter((e=>e instanceof HTMLElement))}(subMenuRef.current);subMenuItems.length&&(subMenuItems[0].focus(),setFocusedId(subMenuItems[0].id))}}),[isSubMenuOpen,subMenuRef,setFocusedId]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.d4)((()=>{const node=parentMenuRef.current?.querySelector('[role="dialog"]');if(!isSubMenuOpen||!node)return;const onPointerMove=e=>{e instanceof PointerEvent&&(pointerTracker.current.x=e.clientX,pointerTracker.current.y=e.clientY,maybeCloseSubMenu())};return node.addEventListener("pointermove",onPointerMove),()=>node.removeEventListener("pointermove",onPointerMove)}),[isSubMenuOpen,parentMenuRef,maybeCloseSubMenu]);const handleKeyboardEvents=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.I4)((evt=>{const{code}=evt;[_utils__WEBPACK_IMPORTED_MODULE_5__.t.SPACE,_utils__WEBPACK_IMPORTED_MODULE_5__.t.ENTER].includes(code)?isSubMenuOpen?closeSubMenu():openSubMenu():(!isRTL&&_utils__WEBPACK_IMPORTED_MODULE_5__.t.RIGHT===code||(isRTL&&_utils__WEBPACK_IMPORTED_MODULE_5__.t.LEFT)===code)&&(isSubMenuOpen||openSubMenu())}),[openSubMenu,closeSubMenu,isSubMenuOpen,isRTL]);return(0,_keyboard__WEBPACK_IMPORTED_MODULE_7__.Ew)(ref,{key:["enter","space","left","right"]},handleKeyboardEvents,[handleKeyboardEvents]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_item__WEBPACK_IMPORTED_MODULE_8__.Z,{...buttonProps,ref,onPointerEnter:openSubMenu,onPointerLeave:()=>{pointerTracker.current={},maybeCloseSubMenu()},onClick:e=>e.preventDefault(),"aria-haspopup":!0,"aria-expanded":isSubMenuOpen,dismissOnClick:!1})}SubMenuTrigger.displayName="SubMenuTrigger";const __WEBPACK_DEFAULT_EXPORT__=SubMenuTrigger},"./packages/design-system/src/components/infiniteScroller/infiniteScroller.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/react/src/index.ts"),styled_components__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_theme__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/design-system/src/theme/helpers/visuallyHidden.ts"),_theme__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/design-system/src/theme/types.ts"),_loadingSpinner__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx"),_typography__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");const ScrollMessage=styled_components__WEBPACK_IMPORTED_MODULE_5__.ZP.div.withConfig({displayName:"infiniteScroller__ScrollMessage",componentId:"sc-smx7an-0"})(["width:100%;padding:140px 0 40px;margin:-100px auto 0;text-align:center;p{color:",";}"],(({theme})=>theme.colors.fg.tertiary)),LoadingContainer=styled_components__WEBPACK_IMPORTED_MODULE_5__.ZP.div.withConfig({displayName:"infiniteScroller__LoadingContainer",componentId:"sc-smx7an-1"})(["display:flex;justify-content:center;"]),AriaOnlyAlert=styled_components__WEBPACK_IMPORTED_MODULE_5__.ZP.span.withConfig({displayName:"infiniteScroller__AriaOnlyAlert",componentId:"sc-smx7an-2"})(["",""],_theme__WEBPACK_IMPORTED_MODULE_6__.j);var State=function(State){return State.Loadable="loadable",State.LoadingInternal="loading_internal",State.LoadingExternal="loading_external",State.Complete="complete",State}(State||{}),Action=function(Action){return Action.OnInternalLoad="internal on load",Action.OnExternalLoad="external on load",Action.OnAllLoaded="all loaded",Action.OnLoadSuccess="load success",Action.OnCanLoadMore="can load more",Action}(Action||{});const machine={[State.Loadable]:{[Action.OnInternalLoad]:State.LoadingInternal,[Action.OnExternalLoad]:State.LoadingExternal},[State.LoadingInternal]:{[Action.OnAllLoaded]:State.Complete,[Action.OnLoadSuccess]:State.Loadable},[State.LoadingExternal]:{[Action.OnAllLoaded]:State.Complete,[Action.OnLoadSuccess]:State.Loadable},[State.Complete]:{[Action.OnCanLoadMore]:State.Loadable}},loadReducer=(state,action)=>machine[state][action]||state;function InfiniteScroller({allDataLoadedMessage,allDataLoadedAriaMessage,onLoadMore,canLoadMore,isLoading,loadingAriaMessage,loadingSpinnerProps={animationSize:50,circleSize:6}}){const loadingRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.sO)(null),onLoadMoreRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.sO)(onLoadMore);onLoadMoreRef.current=onLoadMore;const[loadState,dispatch]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__._Y)(loadReducer,State.Loadable),loadingAlert=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.Ye)((()=>loadState===State.LoadingInternal?loadingAriaMessage:loadState===State.LoadingExternal||canLoadMore?null:allDataLoadedAriaMessage),[allDataLoadedAriaMessage,loadingAriaMessage,loadState,canLoadMore]);(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.d4)((()=>{loadState===State.LoadingInternal&&onLoadMoreRef.current?.()}),[loadState]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.d4)((()=>{isLoading&&dispatch(Action.OnExternalLoad)}),[isLoading]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.d4)((()=>{isLoading||dispatch(canLoadMore?Action.OnLoadSuccess:Action.OnAllLoaded)}),[isLoading,canLoadMore]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.d4)((()=>{canLoadMore&&dispatch(Action.OnCanLoadMore)}),[canLoadMore]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.d4)((()=>{if(!loadingRef.current)return;const observer=new IntersectionObserver((entries=>{entries.forEach((entry=>{entry.isIntersecting&&dispatch(Action.OnInternalLoad)}))}),{rootMargin:"0px",threshold:0}),triggerEl=loadingRef.current;return observer.observe(triggerEl),()=>{observer.unobserve(triggerEl)}}),[]);const loadingContent=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.Ye)((()=>loadState===State.LoadingExternal?null:canLoadMore?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(LoadingContainer,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_loadingSpinner__WEBPACK_IMPORTED_MODULE_9__.Z,{...loadingSpinnerProps})}):allDataLoadedMessage?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_typography__WEBPACK_IMPORTED_MODULE_7__.x.Paragraph,{size:_theme__WEBPACK_IMPORTED_MODULE_8__.TextSize.Small,children:allDataLoadedMessage}):null),[allDataLoadedMessage,canLoadMore,loadState,loadingSpinnerProps]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(ScrollMessage,{"data-testid":"load-more-on-scroll",ref:loadingRef,children:[loadingAlert&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(AriaOnlyAlert,{role:"status",children:loadingAlert}),loadingContent]})}InfiniteScroller.displayName="InfiniteScroller";const __WEBPACK_DEFAULT_EXPORT__=InfiniteScroller},"./packages/design-system/src/components/pill/pillGroup.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var styled_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_pill__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/components/pill/pill.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Container=styled_components__WEBPACK_IMPORTED_MODULE_3__.ZP.div.attrs({role:"listbox"}).withConfig({displayName:"pillGroup__Container",componentId:"sc-1iis7mb-0"})(["display:flex;flex:1;column-gap:4px;"]);function PillGroup({options,value,onSelect,...rest}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Container,{children:options.map((({id,label})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_pill__WEBPACK_IMPORTED_MODULE_4__.Z,{isActive:id===value,onClick:()=>onSelect(id),role:"option",...rest,children:label},id)))})}PillGroup.displayName="PillGroup";const __WEBPACK_DEFAULT_EXPORT__=PillGroup},"./packages/design-system/src/components/search/constants.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K5:()=>DEFAULT_PLACEHOLDER,kg:()=>Z_INDEX,m7:()=>DEFAULT_POPUP_FILL_WIDTH,q0:()=>DEFAULT_ARIA_INPUT_LABEL,z6:()=>DEFAULT_ARIA_CLEAR_LABEL});var _googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/i18n/src/i18n.ts");const DEFAULT_POPUP_FILL_WIDTH=276,DEFAULT_PLACEHOLDER=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__.__)("Search","web-stories"),DEFAULT_ARIA_CLEAR_LABEL=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__.__)("Clear Search","web-stories"),DEFAULT_ARIA_INPUT_LABEL=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_0__.__)("Search","web-stories"),Z_INDEX={CLEAR_BUTTON:5}},"./packages/design-system/src/components/search/input/input.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>input});__webpack_require__("./node_modules/react/index.js");var src=__webpack_require__("./packages/react/src/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),cross_small=__webpack_require__("./packages/design-system/src/icons/cross_small.svg"),chevron_down_small=__webpack_require__("./packages/design-system/src/icons/chevron_down_small.svg"),magnifier=__webpack_require__("./packages/design-system/src/icons/magnifier.svg"),expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),constants=__webpack_require__("./packages/design-system/src/components/search/constants.ts");const InputContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"input__InputContainer",componentId:"sc-hhun7d-0"})((({theme})=>(0,styled_components_browser_esm.iv)(["display:flex;position:relative;height:36px;width:100%;max-width:400px;background-color:transparent;color:",";"],theme.colors.fg.primary))),Input=styled_components_browser_esm.ZP.input.withConfig({displayName:"input__Input",componentId:"sc-hhun7d-1"})((({theme,hasError})=>(0,styled_components_browser_esm.iv)(["position:absolute;height:100%;width:100%;background-color:transparent;outline:none;cursor:pointer;",";color:",";border:1px solid ",";padding:8px 20px 8px 40px;&::placeholder{color:",";}&[aria-expanded='true']{border-color:",";}border-radius:",";&::-ms-clear{display:none;}&::-webkit-search-decoration,&::-webkit-search-cancel-button,&::-webkit-search-results-button,&::-webkit-search-results-decoration{appearance:none;}&:hover{border-color:",";}",";"," &:disabled{pointer-events:none;border-color:",";color:",";&:hover{border-color:",";}}"],expandPresetStyles._({preset:theme.typography.presets.paragraph[types.TextSize.Small],theme}),theme.colors.fg.primary,theme.colors.border.defaultNormal,theme.colors.fg.tertiary,theme.colors.border.defaultActive,theme.borders.radius.small,theme.colors.border.defaultHover,outline.L(theme.colors.border.focus),hasError&&(0,styled_components_browser_esm.iv)(["border-color:",";&:active,&:hover{border-color:",";}"],theme.colors.interactiveBg.negativeHover,theme.colors.interactiveBg.negativeHover),theme.colors.border.disable,theme.colors.fg.disable,theme.colors.border.disable))),BaseDecorationContainer=(0,styled_components_browser_esm.iv)(["display:flex;align-items:center;width:32px;background-color:transparent;color:",";border:0;margin:auto 1px auto auto;padding:0;align-self:flex-end;cursor:pointer;"],(({theme})=>theme.colors.fg.secondary)),ClearButton=styled_components_browser_esm.ZP.button.withConfig({displayName:"input__ClearButton",componentId:"sc-hhun7d-2"})(["",";display:",";outline:none;",";height:30px;z-index:",";"],BaseDecorationContainer,(({isVisible})=>isVisible?"flex":"none"),(({theme})=>outline.L(theme.colors.border.focus)),constants.kg.CLEAR_BUTTON),ClearIcon=(0,styled_components_browser_esm.ZP)(cross_small.Z).withConfig({displayName:"input__ClearIcon",componentId:"sc-hhun7d-3"})(["width:32px;height:auto;margin:auto;"]),ChevronDecoration=styled_components_browser_esm.ZP.div.withConfig({displayName:"input__ChevronDecoration",componentId:"sc-hhun7d-4"})(["",";display:",";visibility:",";height:100%;",""],BaseDecorationContainer,(({isVisible})=>isVisible?"flex":"none"),(({isVisible})=>isVisible?"visible":"collapsed"),(({disabled,theme})=>disabled&&(0,styled_components_browser_esm.iv)(["pointer-events:none;color:",";"],theme.colors.fg.disable))),ChevronIcon=(0,styled_components_browser_esm.ZP)(chevron_down_small.Z).withConfig({displayName:"input__ChevronIcon",componentId:"sc-hhun7d-5"})(["width:32px;height:auto;margin:auto;",""],(({$isMenuOpen})=>$isMenuOpen&&(0,styled_components_browser_esm.iv)(["transform:rotate(180deg);"]))),SearchDecoration=styled_components_browser_esm.ZP.div.withConfig({displayName:"input__SearchDecoration",componentId:"sc-hhun7d-6"})((({theme,activeSearch,disabled})=>(0,styled_components_browser_esm.iv)(["",";position:absolute;height:100%;margin:0;left:8px;color:",";pointer-events:none;",""],BaseDecorationContainer,activeSearch?theme.colors.fg.tertiary:theme.colors.fg.primary,disabled&&(0,styled_components_browser_esm.iv)(["color:",";"],theme.colors.fg.disable)))),SearchIcon=(0,styled_components_browser_esm.ZP)(magnifier.Z).withConfig({displayName:"input__SearchIcon",componentId:"sc-hhun7d-7"})(["position:relative;width:32px;height:auto;margin:auto;"]);var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const input=(0,src.Gp)((({ariaClearLabel,clearId,disabled,handleClearInput=()=>{},handleTabClear,inputValue,isOpen,listId,className="",...rest},ref)=>{const[inputChanged,setInputChanged]=(0,src.eJ)(!1),[isEmptyValue,setIsEmptyValue]=(0,src.eJ)(!1),activeInput=(0,src.Ye)((()=>inputValue.length>0&&isOpen),[isOpen,inputValue]),alignInputCenter=(0,src.Ye)((()=>0===inputValue.length&&!isOpen),[isOpen,inputValue]),onClearButtonKeyDown=(0,src.I4)((({key})=>{"Tab"===key&&handleTabClear?.()}),[handleTabClear]),handleOnInput=(0,src.I4)((value=>{setIsEmptyValue(""===value),setInputChanged(isOpen)}),[isOpen]);return(0,jsx_runtime.jsxs)(InputContainer,{className,children:[(0,jsx_runtime.jsx)(Input,{"aria-disabled":disabled,autoComplete:"off",disabled,onInput:event=>handleOnInput(event.currentTarget.value),ref,type:"search",value:inputValue,...listId&&{role:"combobox","aria-expanded":isOpen,"aria-controls":listId,"aria-owns":listId,"aria-autocomplete":"list"},...rest}),(0,jsx_runtime.jsx)(SearchDecoration,{activeSearch:alignInputCenter,"aria-hidden":!0,disabled,children:(0,jsx_runtime.jsx)(SearchIcon,{id:clearId})}),(0,jsx_runtime.jsx)(ClearButton,{type:"button",isVisible:activeInput&&inputChanged,tabIndex:0,"aria-label":activeInput&&inputChanged?ariaClearLabel:"",onClick:handleClearInput,onKeyDown:onClearButtonKeyDown,children:(0,jsx_runtime.jsx)(ClearIcon,{id:clearId,"data-testid":"clear-search-icon"})}),(0,jsx_runtime.jsx)(ChevronDecoration,{disabled,"aria-hidden":activeInput&&inputChanged||isEmptyValue,isVisible:(!activeInput||!inputChanged)&&!isEmptyValue&&inputValue.length>0,children:(0,jsx_runtime.jsx)(ChevronIcon,{$isMenuOpen:isOpen,"data-testid":"chevron-search-icon"})})]})}))},"./packages/design-system/src/contexts/snackbar/snackbarProvider.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.find.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/react/src/index.ts"),uuid__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/design-system/node_modules/uuid/dist/esm-browser/v4.js"),_context__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/design-system/src/contexts/snackbar/context.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js");function SnackbarProvider({children,placement="bottom"}){const[notifications,setNotifications]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.eJ)([]),remove=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.I4)((toRemove=>{setNotifications((currentNotifications=>currentNotifications.filter((item=>Array.isArray(toRemove)?!toRemove.find((({id})=>id===item.id)):item.id!==toRemove.id))))}),[]),create=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.I4)((notification=>{const newNotification={id:(0,uuid__WEBPACK_IMPORTED_MODULE_6__.Z)(),...notification};setNotifications((currentNotifications=>[...currentNotifications,newNotification]))}),[]),clear=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.I4)((()=>{setNotifications([])}),[]),state=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_4__.Ye)((()=>({showSnackbar:create,clearSnackbar:clear,removeSnack:remove,currentSnacks:notifications,placement})),[create,clear,remove,notifications,placement]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_context__WEBPACK_IMPORTED_MODULE_7__.Z.Provider,{value:state,children})}SnackbarProvider.displayName="SnackbarProvider";const __WEBPACK_DEFAULT_EXPORT__=SnackbarProvider},"./packages/story-editor/src/components/devTools/dummyData.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{k:()=>dummyVideo,r:()=>dummyImage});const dummyVideo="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAPEbW9vdgAAAGxtdmhkAAAAANrF/AXaxfwFAAAD6AAAB9AAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAABhpb2RzAAAAABCAgIAHAE///////wAAAzh0cmFrAAAAXHRraGQAAAAB2sX8BdrF/AUAAAABAAAAAAAAB9AAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAABQAAAAUAAAAAAKwbWRpYQAAACBtZGhkAAAAANrF/AXaxfwFAAAD6AAAB9BVxAAAAAAAIWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAAAAAAACZ21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAq3N0c2QAAAAAAAAAAQAAAJthdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAABQAFABIAAAASAAAAAAAAAABDkpWVC9BVkMgQ29kaW5nAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAM2F2Y0MBTUAK/+EAG2dNQArsxLzzzUBAQZAAAAMAEAAAAwFI8SJZoAEABWjpeyyAAAAAEmNvbHJuY2xjAAEAAQAGAAAAGHN0dHMAAAAAAAAAAQAAABQAAABkAAAAZHN0c3oAAAAAAAAAAAAAABQAAAC1AAAADAAAAAwAAAAMAAAADAAAAGcAAAAOAAAADQAAAAwAAADEAAAADwAAAA4AAAAMAAAAmgAAAA8AAAAMAAAADAAAABEAAAAOAAAADAAAABxzdHNjAAAAAAAAAAEAAAABAAAACgAAAAEAAAAgY282NAAAAAAAAAACAAAAAAAAA/QAAAAAAAAGKwAAAKhjdHRzAAAAAAAAABMAAAABAAAAyAAAAAEAAAH0AAAAAQAAAMgAAAABAAAAAAAAAAEAAABkAAAAAQAAAfQAAAABAAAAyAAAAAEAAAAAAAAAAQAAAGQAAAABAAAB9AAAAAEAAADIAAAAAQAAAAAAAAABAAAAZAAAAAEAAAH0AAAAAQAAAMgAAAABAAAAAAAAAAEAAABkAAAAAQAAAZAAAAACAAAAZAAAABRzdHNzAAAAAAAAAAEAAAABAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAH0AAAAMgAAQAAAAAAAW1kYXQAAAAAAAADXAAAALFliIQAIf8tERhKDUPN//6tPIlfMgqs2j4bf1chdW+++2VwQdh75gd9Y8UGeNAnhlaisT01Zs49a/0nV0aO/GLhqiGwvWR/s1K9W3zBx2od2cS1bT/kb2rz7FeHrWTqTLX6Gx65Y6i33pdJ/uLJd1nt76ybxnGFuPrIHacdB39MBmZsd4t/m7wPBzhrJIjUCiCUcSaxJPxvEH+6DID5TqxsXtv0RS9+hTuYECGa+YWdx4EAAAAIQZokbEMfi4AAAAAIQZ5COIc/0YEAAAAIAZ5hNEEH1YAAAAAIAZ5jakEH1YEAAABjQZpoSahBaJlMCM/eVhjnGE9A+AdJ7SwN5vlKUC/otPa/5jefanvcx5sQZ4c8/3tiMqvDgQF8rydFoFe3gcpkTP4xG9DP5oXTv1DTSsVi1O/u9fkq6BMYR61X6/n148wbBk3hAAAACkGehi5RMJfxO6sAAAAJAZ6lKRDn87czAAAACAGep25Cn8WAAAAAwEGarDUILakymAT/lvijvmpe6mLGpu6rJNoev4/97f/3/AViMdt7WMTLeGSxGKwsecwmz+Z5NTf4Lgky4aLbYBjw9pUtNg4bov9E4yT+OadpewkQxiWZZozDDf98P4PN72xr+rkQJcODW8z2LOkQVijjHcWSmTAvF7/ANFm8TO5l9vC/tz7FvEis+ba+dTueI87l9hdLXQfWqKN+J9j1fj5cguj08byzEmWnKbLlqG1uTZmu0LDedc3Ugo76bySHIAAAAAtBnspklERc3+sNqQAAAAoBnukpEZ/3fsMPAAAACAGe625N/6+AAAAAlkGa8DUILakymARfBGYe5snAbMic1iEEu9W/yugK09WdqQ1/7ftt/lUz4i6orQg+4cIz2nHYVKTXCJJbyOrz/tGL+TWtNtUBVK2kbTsfCYF8ddhk+qL5Jr82IUEUALXNsKpx1hhGIJnvqqlGTOyyOpmwbHhNUa2TaBkzzVzuaVnuHnaL3sjfLR0XEc/T6ntUXHacPLf94QAAAAtBnw5klERd//FEowAAAAgBny1pFf+ngQAAAAgBny9uf+yhJAAAAA1BmzM1CC2pMpgE/xwwAAAACkGfUWSURFz/kYEAAAAIAZ9ybkv/mIA=",dummyImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAGElEQVQYV2NkYGD4////fwZGEMnIyMgAAEvqB/6wfXLSAAAAAElFTkSuQmCC"},"./packages/story-editor/src/components/library/panes/media/common/styles.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{DE:()=>MediaGalleryMessage,Gw:()=>MediaGalleryLoadingPill,K9:()=>StyledPane,Mo:()=>MediaGalleryContainer,Wf:()=>SearchInputContainer,hX:()=>PaneHeader,iL:()=>PaneInner,kS:()=>MediaGalleryInnerContainer,l0:()=>GalleryContainer});var styled_components__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),polished__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/design-system/src/theme/types.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),_shared__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/index.js");const PaneInner=styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP.div.withConfig({displayName:"common__PaneInner",componentId:"sc-18rwr03-0"})(["height:100%;display:flex;flex-direction:column;"]),PaneHeader=styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP.div.withConfig({displayName:"common__PaneHeader",componentId:"sc-18rwr03-1"})(["padding-top:24px;flex:0 1 auto;"]),GalleryContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP.div.withConfig({displayName:"common__GalleryContainer",componentId:"sc-18rwr03-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;"]),MediaGalleryContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP.div.withConfig({displayName:"common__MediaGalleryContainer",componentId:"sc-18rwr03-3"})(["overflow-y:scroll;overflow-x:hidden;padding:0 ",";margin-top:1em;position:relative;width:100%;flex:1 1 auto;min-height:100px;"],_shared__WEBPACK_IMPORTED_MODULE_0__.gf),MediaGalleryInnerContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP.div.withConfig({displayName:"common__MediaGalleryInnerContainer",componentId:"sc-18rwr03-4"})(["width:calc(100% + ","px);"],_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.TextSize.SCROLLBAR_WIDTH),MediaGalleryLoadingPill=styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP.div.withConfig({displayName:"common__MediaGalleryLoadingPill",componentId:"sc-18rwr03-5"})(["display:block;position:absolute;bottom:20px;left:60px;right:60px;width:240px;text-align:center;padding:8px 80px;background-color:",";border-radius:100px;"],(({theme})=>(0,polished__WEBPACK_IMPORTED_MODULE_3__.m4)(theme.colors.standard.black,.4))),MediaGalleryMessage=(0,styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_4__.x.Paragraph).attrs({size:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.TextSize.Medium}).withConfig({displayName:"common__MediaGalleryMessage",componentId:"sc-18rwr03-6"})(["color:",";padding:1em;text-align:center;"],(({theme})=>theme.colors.fg.secondary)),StyledPane=(0,styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP)(_shared__WEBPACK_IMPORTED_MODULE_0__.X6).withConfig({displayName:"common__StyledPane",componentId:"sc-18rwr03-7"})(["height:100%;padding:0;overflow:hidden;"]),SearchInputContainer=styled_components__WEBPACK_IMPORTED_MODULE_1__.ZP.div.withConfig({displayName:"common__SearchInputContainer",componentId:"sc-18rwr03-8"})(["padding:0 ",";"],_shared__WEBPACK_IMPORTED_MODULE_0__.gf)},"./packages/story-editor/src/components/library/panes/shared/chipGroup/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>chipGroup});__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),src=__webpack_require__("./packages/react/src/index.ts"),v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),chip=__webpack_require__("./packages/design-system/src/components/chip/chip.tsx"),chevron_up=__webpack_require__("./packages/design-system/src/icons/chevron_up.svg"),useRovingTabIndex=__webpack_require__("./packages/story-editor/src/utils/useRovingTabIndex/index.js");const hooks_useExpandAnimation=function useExpandAnimation({sectionRef,innerContainerRef,isExpanded,setFocusedRowOffset,collapsedHeight,bottomMargin,topMargin}){(0,src.bt)((()=>{if(!sectionRef.current||!innerContainerRef.current)return;let height;height=isExpanded?`${innerContainerRef.current.offsetHeight+topMargin+bottomMargin}px`:`${collapsedHeight}px`,sectionRef.current.style.height=height,sectionRef.current.style.minHeight=height,setFocusedRowOffset(0)}),[bottomMargin,collapsedHeight,innerContainerRef,isExpanded,sectionRef,setFocusedRowOffset,topMargin])};const hooks_useHandleRowVisibility=function useHandleRowVisibility({innerContainerRef,isExpanded,setFocusedRowOffset,selectedItemId,itemRefs,offsetSpacing=0}){(0,src.bt)((()=>{if(!innerContainerRef.current)return;const selectedItem=itemRefs.current?.[selectedItemId]?itemRefs.current[selectedItemId]:null;!isExpanded&&selectedItem&&setFocusedRowOffset(selectedItem?.offsetTop-offsetSpacing||0)}),[innerContainerRef,isExpanded,itemRefs,offsetSpacing,selectedItemId,setFocusedRowOffset]),(0,src.bt)((()=>{if(!innerContainerRef.current)return;const selectedItem=itemRefs.current?.[selectedItemId]?itemRefs.current[selectedItemId]:null,selectedItemOffsetTop=selectedItem?.offsetTop||0;for(const pill of itemRefs.current){if(!pill)continue;const isSameRow=selectedItem&&pill.offsetTop===selectedItemOffsetTop;!selectedItem||isSameRow||isExpanded?pill.classList.remove("invisible"):pill.classList.add("invisible")}}),[innerContainerRef,isExpanded,selectedItemId,itemRefs])};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Section=styled_components_browser_esm.ZP.div.withConfig({displayName:"chipGroup__Section",componentId:"sc-emvo4b-0"})(["height:","px;min-height:","px;background-color:",";display:flex;flex-direction:column;align-items:flex-start;flex:0 1 auto;position:relative;transition:height 0.2s,min-height 0.2s;"],80,80,(({theme})=>theme.colors.divider.tertiary)),Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"chipGroup__Container",componentId:"sc-emvo4b-1"})(["overflow:hidden;margin:","px 12px ","px 24px;"],16,20),InnerContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"chipGroup__InnerContainer",componentId:"sc-emvo4b-2"})(["display:flex;justify-content:center;flex-wrap:wrap;position:relative;padding:4px 0;transition:transform 0.2s;column-gap:8px;row-gap:14px;"]),ExpandButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:constants.L$.Tertiary,size:constants.qE.Small,variant:constants.Wu.Circle}).withConfig({displayName:"chipGroup__ExpandButton",componentId:"sc-emvo4b-3"})(["display:flex;position:absolute;bottom:-24px;background:",";max-height:none;width:32px;height:32px;"," visibility:inherit;align-self:center;justify-content:center;align-items:center;"],(({theme})=>theme.colors.bg.tertiary),(({isExpanded})=>isExpanded&&"transform: scaleY(-1);")),ChipGroup=({items,selectedItemId,selectItem,deselectItem,ariaLabel})=>{const[isExpanded,setIsExpanded]=(0,src.eJ)(!1),sectionRef=(0,src.sO)(),innerContainerRef=(0,src.sO)(),itemRefs=(0,src.sO)([]),[focusedRowOffset,setFocusedRowOffset]=(0,src.eJ)(0),handleClick=(0,src.I4)(((selected,id)=>{selected&&null!==id?deselectItem():(setIsExpanded(!1),selectItem(id))}),[deselectItem,selectItem]),handleExpandClick=(0,src.I4)((()=>setIsExpanded((currentExpanded=>!currentExpanded))),[]);hooks_useExpandAnimation({sectionRef,innerContainerRef,isExpanded,setFocusedRowOffset,collapsedHeight:80,bottomMargin:20,topMargin:16}),hooks_useHandleRowVisibility({isExpanded,innerContainerRef,selectedItemId,setFocusedRowOffset,itemRefs,offsetSpacing:4});const hasItems=items.length>0;(0,useRovingTabIndex.Z)({ref:sectionRef},[isExpanded]),(0,keyboard.Ew)(sectionRef,isExpanded?"":"down",(()=>hasItems&&setIsExpanded(!0)),[isExpanded,hasItems]);const containerId=(0,src.Ye)((()=>`pill-group-${(0,v4.Z)()}`),[]);return(0,jsx_runtime.jsx)(Section,{ref:sectionRef,children:hasItems&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Container,{id:containerId,isExpanded,role:"listbox","aria-label":ariaLabel||(0,i18n.__)("List of filtering options","web-stories"),children:(0,jsx_runtime.jsx)(InnerContainer,{role:"presentation",ref:innerContainerRef,style:{transform:`translateY(-${focusedRowOffset}px`},children:items.map(((item,index)=>{const{id,label}=item,selected=id===selectedItemId,tabIndex=selected||!selected&&0===index?0:-1;return(0,jsx_runtime.jsx)(chip.Z,{role:"option",ref:el=>{itemRefs.current[id]=el},active:selected,"aria-selected":selected,onClick:()=>handleClick(selected,id),tabIndex,children:label},id)}))})}),(0,jsx_runtime.jsx)(ExpandButton,{onClick:handleExpandClick,isExpanded,"aria-controls":containerId,"aria-expanded":isExpanded,"aria-label":(0,i18n.__)("Expand","web-stories"),children:(0,jsx_runtime.jsx)(chevron_up.Z,{})})]})})};ChipGroup.displayName="ChipGroup";const chipGroup=ChipGroup},"./packages/story-editor/src/components/library/panes/shared/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Kk:()=>ActionButton,Qk:()=>getPaneId,X6:()=>Pane,Zn:()=>_chipGroup__WEBPACK_IMPORTED_MODULE_4__.Z,gf:()=>PANE_PADDING,ly:()=>LoadingContainer,pQ:()=>getTabId,vO:()=>PageTemplateTitleContainer});var styled_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),_constants_zIndex__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/constants/zIndex.ts"),_chipGroup__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/chipGroup/index.js");const PANE_PADDING="1em",Pane=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.section.attrs((({isActive})=>({role:"tabpanel","aria-expanded":isActive,hidden:!isActive}))).withConfig({displayName:"shared__Pane",componentId:"sc-10fhorr-0"})(["padding:1.5em ",";",""],PANE_PADDING,(({isOverflowScrollable=!1})=>isOverflowScrollable&&(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.iv)(["overflow-y:scroll;height:100%;"])));function getPaneId(tab){return`library-pane-${tab}`}function getTabId(tab){return`library-tab-${tab}`}const LoadingContainer=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.div.withConfig({displayName:"shared__LoadingContainer",componentId:"sc-10fhorr-1"})(["display:flex;justify-content:center;margin-top:18px;"]),ActionButton=(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_1__.z).attrs({variant:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.Wu.Icon}).withConfig({displayName:"shared__ActionButton",componentId:"sc-10fhorr-2"})(["display:flex;align-items:center;position:absolute;top:calc(50% - ","px);right:calc(50% - ","px);color:",";border-radius:",";width:","px;height:","px;opacity:",";z-index:",";"],8,8,(({theme})=>theme.colors.fg.primary),(({theme})=>theme.borders.radius.round),16,16,(({$display})=>$display?"1":"0"),_constants_zIndex__WEBPACK_IMPORTED_MODULE_3__.bH),PageTemplateTitleContainer=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.div.withConfig({displayName:"shared__PageTemplateTitleContainer",componentId:"sc-10fhorr-3"})(["position:absolute;bottom:0;width:100%;padding:8px;background-color:",";opacity:",";"],(({theme})=>theme.colors.opacity.black64),(({isActive})=>isActive?1:0))},"./packages/story-editor/src/components/library/panes/shared/insertionOverlay.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var styled_components__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/icons/plus_filled_small.svg"),polished__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const IconContainer=styled_components__WEBPACK_IMPORTED_MODULE_2__.ZP.div.withConfig({displayName:"insertionOverlay__IconContainer",componentId:"sc-x3oxxu-0"})(["height:","px;width:","px;position:absolute;top:calc(50% - ","px);left:calc(50% - ","px);color:",";border-radius:",";pointer-events:none;svg{position:absolute;top:0;left:0;}"],16,16,8,8,(({theme})=>theme.colors.fg.primary),(({theme})=>theme.borders.radius.round)),Scrim=styled_components__WEBPACK_IMPORTED_MODULE_2__.ZP.div.withConfig({displayName:"insertionOverlay__Scrim",componentId:"sc-x3oxxu-1"})(["position:absolute;width:100%;height:100%;top:0;left:0;background-color:",";pointer-events:none;"],(({theme})=>(0,polished__WEBPACK_IMPORTED_MODULE_3__.m4)(theme.colors.standard.black,.5)));function InsertionOverlay({showIcon=!0,className=""}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(Scrim,{className,children:showIcon&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(IconContainer,{role:"presentation",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_4__.Z,{})})})}InsertionOverlay.displayName="InsertionOverlay";const __WEBPACK_DEFAULT_EXPORT__=InsertionOverlay},"./packages/story-editor/src/components/tabview/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{ZP:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var styled_components__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./packages/design-system/src/components/typography/headline/index.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./packages/design-system/src/theme/types.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),_app__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/app/index.js"),_tooltip__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js"),_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),_constants__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/story-editor/src/constants/index.ts"),_utils_noop__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Tabs=styled_components__WEBPACK_IMPORTED_MODULE_8__.ZP.ul.attrs({role:"tablist","aria-orientation":"horizontal"}).withConfig({displayName:"tabview__Tabs",componentId:"sc-10d408-0"})(["display:flex;flex-direction:row;align-items:stretch;width:100%;max-width:100%;justify-content:space-between;margin:0;padding:0;list-style:none;border-bottom:1px solid ",";"],(({theme})=>theme.colors.divider.secondary)),TabElement=styled_components__WEBPACK_IMPORTED_MODULE_8__.ZP.li.attrs((({isActive})=>({tabIndex:isActive?0:-1,role:"tab","aria-selected":isActive}))).withConfig({displayName:"tabview__TabElement",componentId:"sc-10d408-1"})(["cursor:pointer;border:none;background:none;padding:0 4px;margin:","px 12px 9px;height:","px;display:flex;align-items:center;justify-content:center;position:relative;transition:color 0.2s ease;color:",";border-radius:",";",";:hover{color:",";}"," svg{display:block;width:32px;height:32px;margin:0 -4px;transform-origin:center center;transition:transform 0.3s ease,color 0.2s ease;color:",";border-radius:",";pointer-events:none;}svg.alert{width:","px;margin-left:4px;color:",";}span,svg:not(.alert){",";}&:hover span,&:hover svg:not(.alert),&:active span,&:active svg:not(.alert){color:",";}&:focus-visible{svg:not(.alert){background-color:",";}}"],10,32,(({theme,isActive})=>isActive?theme.colors.fg.primary:theme.colors.fg.tertiary),(({theme})=>theme.borders.radius.small),(({theme})=>_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_9__.L(theme.colors.border.focus,theme.colors.bg.secondary)),(({theme})=>theme.colors.fg.primary),(({isActive,theme})=>isActive&&(0,styled_components__WEBPACK_IMPORTED_MODULE_8__.iv)(["::after{content:'';position:absolute;background-color:",";height:2px;border-radius:1px;bottom:-10px;left:4px;right:4px;}"],theme.colors.border.selection)),(({theme})=>theme.colors.fg.tertiary),(({theme})=>theme.borders.radius.small),28,(({theme})=>theme.colors.fg.primary),(({isActive,theme})=>isActive&&`color: ${theme.colors.fg.primary}`),(({theme})=>theme.colors.fg.primary),(({theme})=>theme.colors.interactiveBg.tertiaryHover)),TabText=(0,styled_components__WEBPACK_IMPORTED_MODULE_8__.ZP)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_10__.s).attrs({as:"p",size:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_11__.TextSize.XXXSmall}).withConfig({displayName:"tabview__TabText",componentId:"sc-10d408-2"})(["color:inherit;"]);const Tab=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.Gp)((function UnreffedTab({children,tooltip=null,placement,refId,tabRefs,...rest},ref){const{id}=rest,eventData=id.includes("library")?_constants__WEBPACK_IMPORTED_MODULE_6__.Iy.LIBRARY_PANEL_CLICK:_constants__WEBPACK_IMPORTED_MODULE_6__.Iy.DESIGN_PANEL_CLICK;(0,_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_5__.Z)({node:tabRefs?.[refId]?.current,eventData:{...eventData,label:`${refId}_tab`}});const tab=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(TabElement,{ref,...rest,children});return null!==tooltip?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_tooltip__WEBPACK_IMPORTED_MODULE_4__.Z,{title:tooltip,placement,isDelayed:!0,children:tab}):tab}));function TabView({getTabId=id=>id,getAriaControlsId,onTabChange=_utils_noop__WEBPACK_IMPORTED_MODULE_12__.Z,onTabRefUpdated=_utils_noop__WEBPACK_IMPORTED_MODULE_12__.Z,tabs=[],label="",shortcut="",tab,tabRefs,...rest}){const{isRTL}=(0,_app__WEBPACK_IMPORTED_MODULE_3__.ZR)(),ref=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.sO)(),focused=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.sO)(),internalTabRefs=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.sO)({}),focusChanged=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.I4)((id=>{tabRefs?.[id]?.current?tabRefs[id].current?.focus():internalTabRefs?.current[id]&&internalTabRefs.current[id]?.focus(),focused.current=id}),[tabRefs]),selectTab=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.I4)((id=>{focusChanged(id),onTabChange(id)}),[focusChanged,onTabChange]);(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__.xb)({key:shortcut,editable:!0},(()=>selectTab(tab)),[selectTab,tab]);const focusTabByIndex=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.I4)((index=>{const nextTab=tabs[(index+tabs.length)%tabs.length];focusChanged(nextTab.id)}),[tabs,focusChanged]),handleNavigation=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.I4)((direction=>{const directionWithRTL=isRTL?-direction:direction,currentIndex=tabs.findIndex((({id})=>id===focused.current));focusTabByIndex(currentIndex+directionWithRTL)}),[isRTL,tabs,focusTabByIndex]);return(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__.Ew)(ref,"left",(()=>handleNavigation(-1)),[handleNavigation]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__.Ew)(ref,"right",(()=>handleNavigation(1)),[handleNavigation]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__.Ew)(ref,["up","down"],_utils_noop__WEBPACK_IMPORTED_MODULE_12__.Z,[]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__.Ew)(ref,"home",(()=>focusTabByIndex(0)),[focusTabByIndex]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__.Ew)(ref,"end",(()=>focusTabByIndex(-1)),[focusTabByIndex]),(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_13__.Ew)(ref,{key:["enter","space"],allowDefault:!0},(evt=>{"tab"===evt.target.getAttribute("role")&&(selectTab(focused.current),evt.preventDefault())}),[selectTab],{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(Tabs,{"aria-label":label,ref,...rest,children:tabs.map((({id,title,icon:Icon,...tabRest})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(Tab,{ref:node=>{tabRefs?.[id]?tabRefs[id].current=node:internalTabRefs.current[id]=node,onTabRefUpdated(node,id)},id:getTabId(id),isActive:tab===id,"aria-controls":getAriaControlsId?getAriaControlsId(id):null,"aria-selected":tab===id,onClick:()=>selectTab(id),onFocus:()=>{focused.current=tab},refId:id,tabRefs,...tabRest,children:[Boolean(title)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(TabText,{children:title}),Boolean(Icon)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(Icon,{isActive:id===tab})]},id)))})}TabView.displayName="TabView";const __WEBPACK_DEFAULT_EXPORT__=TabView},"./packages/text-sets/src/raw lazy recursive ^\\.\\/.*\\.json$":(module,__unused_webpack_exports,__webpack_require__)=>{var map={"./contact.json":["./packages/text-sets/src/raw/contact.json",2476],"./cover.json":["./packages/text-sets/src/raw/cover.json",9027],"./editorial.json":["./packages/text-sets/src/raw/editorial.json",3871],"./list.json":["./packages/text-sets/src/raw/list.json",2634],"./quote.json":["./packages/text-sets/src/raw/quote.json",2563],"./section_header.json":["./packages/text-sets/src/raw/section_header.json",9843],"./step.json":["./packages/text-sets/src/raw/step.json",7611],"./table.json":["./packages/text-sets/src/raw/table.json",2761]};function webpackAsyncContext(req){if(!__webpack_require__.o(map,req))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}));var ids=map[req],id=ids[0];return __webpack_require__.e(ids[1]).then((()=>__webpack_require__.t(id,19)))}webpackAsyncContext.keys=()=>Object.keys(map),webpackAsyncContext.id="./packages/text-sets/src/raw lazy recursive ^\\.\\/.*\\.json$",module.exports=webpackAsyncContext}}]);