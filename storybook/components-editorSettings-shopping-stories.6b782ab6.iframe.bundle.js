"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[5688],{"./packages/design-system/src/components/circularProgress/circular.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var styled_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),react_transition_group__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react-transition-group/esm/CSSTransition.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/react/src/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const wrapperRotation=(0,styled_components__WEBPACK_IMPORTED_MODULE_3__.F4)(["100%{transform:rotate(360deg)}"]),circleRotation=(0,styled_components__WEBPACK_IMPORTED_MODULE_3__.F4)(["0%{stroke-dasharray:1,200;stroke-dashoffset:0;}50%{stroke-dasharray:100,200;stroke-dashoffset:-15;}100%{stroke-dasharray:100,200;stroke-dashoffset:-125;}"]),Wrapper=styled_components__WEBPACK_IMPORTED_MODULE_3__.ZP.div.attrs({role:"progressbar"}).withConfig({displayName:"circular__Wrapper",componentId:"sc-9ce9zw-0"})(["width:",";height:",";animation:"," 1.4s linear infinite;"],(({size})=>`${size}px`),(({size})=>`${size}px`),wrapperRotation),StyledSpinner=styled_components__WEBPACK_IMPORTED_MODULE_3__.ZP.svg.withConfig({displayName:"circular__StyledSpinner",componentId:"sc-9ce9zw-1"})(["display:block;"]),StyledCircle=styled_components__WEBPACK_IMPORTED_MODULE_3__.ZP.circle.withConfig({displayName:"circular__StyledCircle",componentId:"sc-9ce9zw-2"})(["animation:"," 1.4s ease-in-out infinite;stroke:",";"],circleRotation,(({theme})=>`${theme.colors.accent.secondary}`));function CircularProgress({size=24,thickness=2}){const nodeRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.sO)(null);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_transition_group__WEBPACK_IMPORTED_MODULE_4__.Z,{nodeRef,in:!0,appear:!0,timeout:0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Wrapper,{ref:nodeRef,size,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StyledSpinner,{viewBox:`${size/2} ${size/2} ${size} ${size}`,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StyledCircle,{cx:size,cy:size,r:(size-thickness)/2,fill:"none",strokeWidth:thickness,stroke:"currentColor"})})})})}CircularProgress.displayName="CircularProgress";const __WEBPACK_DEFAULT_EXPORT__=CircularProgress},"./packages/wp-dashboard/src/components/editorSettings/shopping/stories/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{_default:()=>_default,default:()=>stories});__webpack_require__("./node_modules/react/index.js");var src=__webpack_require__("./packages/react/src/index.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),translateWithMarkup=__webpack_require__("./packages/i18n/src/translateWithMarkup.tsx"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),components=__webpack_require__("./packages/wp-dashboard/src/components/editorSettings/components.js"),constants=__webpack_require__("./packages/wp-dashboard/src/constants/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),useLiveRegion=__webpack_require__("./packages/design-system/src/utils/useLiveRegion.ts"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),circular=__webpack_require__("./packages/design-system/src/components/circularProgress/circular.tsx"),dashboard_src=__webpack_require__("./packages/dashboard/src/index.js");const hostPattern=/[\w-]+\.myshopify\.com/i;function isValidShopifyHost(value=""){return Boolean(value.toLowerCase().match(hostPattern))}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Loading=styled_components_browser_esm.ZP.div.withConfig({displayName:"shopify__Loading",componentId:"sc-ur0gaq-0"})(["position:relative;margin-top:10px;"]),Spinner=styled_components_browser_esm.ZP.div.withConfig({displayName:"shopify__Spinner",componentId:"sc-ur0gaq-1"})(["position:absolute;top:0;"]),TEXT={HOST_CONTEXT:(0,sprintf.Z)((0,i18n.__)("Without <code>%1$s</code> or <code>%2$s</code>. Example: %3$s. <a>Find your URL</a>.","web-stories"),"https://","www.","yourstore.myshopify.com"),HOST_CONTEXT_LINK:(0,i18n.__)("https://help.shopify.com/en/manual/domains","web-stories"),HOST_PLACEHOLDER:(0,i18n.__)("Enter your .myshopify.com domain","web-stories"),HOST_LABEL:(0,i18n.__)("Shopify Domain","web-stories"),ACCESS_TOKEN_CONTEXT:(0,i18n.__)("<a>Learn how to get one</a>.","web-stories"),ACCESS_TOKEN_CONTEXT_LINK:(0,i18n.__)("https://help.shopify.com/en/manual/apps/custom-apps#get-the-api-credentials-for-a-custom-app","web-stories"),ACCESS_TOKEN_PLACEHOLDER:(0,i18n.__)("Enter your API access token","web-stories"),ACCESS_TOKEN_LABEL:(0,i18n.__)("Storefront API Access Token","web-stories"),INPUT_ERROR:(0,i18n.__)("Invalid format","web-stories"),SUBMIT_BUTTON:(0,i18n.__)("Save","web-stories"),CONNECTION_TEST_BUTTON:(0,i18n.__)("Test connection","web-stories"),CONNECTION_CHECKING:(0,i18n.__)("Testing connectionâ€¦","web-stories"),CONNECTION_SUCCESS:(0,i18n.__)("Connection successful","web-stories"),CONNECTION_ERROR_DEFAULT:(0,i18n.__)("Connection failed. Please try again.","web-stories")};const shopify=function ShopifySettings({host:shopifyHost,accessToken:shopifyAccessToken,handleUpdateHost,handleUpdateAccessToken}){const speak=(0,useLiveRegion.Z)(),[host,setHost]=(0,src.eJ)(shopifyHost),[hostInputError,setHostInputError]=(0,src.eJ)(""),canSaveHost=host!==shopifyHost&&!hostInputError,disableHostSaveButton=!canSaveHost,[accessToken,setAccessToken]=(0,src.eJ)(shopifyAccessToken),[accessTokenInputError,setAccessTokenInputError]=(0,src.eJ)(""),canSaveAccessToken=accessToken!==shopifyAccessToken&&!accessTokenInputError,disableAccessTokenSaveButton=!canSaveAccessToken,{apiCallbacks:{getProducts}}=(0,dashboard_src.ZR)(),[isTestingConnection,setIsTestingConnection]=(0,src.eJ)(!1),[testConnectionStatus,setTestConnectionStatus]=(0,src.eJ)(""),[hasConnectionError,setHasConnectionError]=(0,src.eJ)(!1);(0,src.d4)((()=>{setHost(shopifyHost)}),[shopifyHost]),(0,src.d4)((()=>{setAccessToken(shopifyAccessToken)}),[shopifyAccessToken]);const onUpdateHost=(0,src.I4)((event=>{const{value}=event.target;setHost(value),0===value.length||isValidShopifyHost(value)?setHostInputError(""):setHostInputError(TEXT.INPUT_ERROR)}),[]),onHostBlur=(0,src.I4)((event=>{const{value}=event.target;isValidShopifyHost(value)&&setHost(value.match(hostPattern)[0])}),[]),onSaveHost=(0,src.I4)((()=>{canSaveHost&&handleUpdateHost(host)}),[canSaveHost,host,handleUpdateHost]),onKeyDownHost=(0,src.I4)((e=>{"Enter"===e.key&&(e.preventDefault(),onSaveHost())}),[onSaveHost]),onUpdateAccessToken=(0,src.I4)((event=>{const{value}=event.target;setAccessTokenInputError(""),setAccessToken(value)}),[]),onSaveAccessToken=(0,src.I4)((()=>{canSaveAccessToken&&handleUpdateAccessToken(accessToken)}),[canSaveAccessToken,accessToken,handleUpdateAccessToken]),onKeyDownAccessToken=(0,src.I4)((e=>{"Enter"===e.key&&(e.preventDefault(),onSaveAccessToken())}),[onSaveAccessToken]),onTestConnection=(0,src.I4)((async()=>{setHasConnectionError(!1),setIsTestingConnection(!0),speak(TEXT.CONNECTION_CHECKING),(0,tracking_src.L9)("test_shopping_connection");try{await getProducts((new Date).getTime()),setTestConnectionStatus(TEXT.CONNECTION_SUCCESS),speak(TEXT.CONNECTION_SUCCESS)}catch(e){(0,tracking_src.tz)("test_shopping_connection",e?.message),setHasConnectionError(!0),setTestConnectionStatus(TEXT.CONNECTION_ERROR_DEFAULT),speak(TEXT.CONNECTION_ERROR_DEFAULT)}finally{setIsTestingConnection(!1)}}),[getProducts,speak]),canTestConnection=host&&!hostInputError&&accessToken&&!accessTokenInputError&&!isTestingConnection,handleClick=(0,src.I4)((evt=>(0,tracking_src.ob)(evt,"click_shopify_docs")),[]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(components.yN,{children:[(0,jsx_runtime.jsx)(components.xU,{htmlFor:"shopifyHost",children:TEXT.HOST_LABEL}),(0,jsx_runtime.jsx)(components.CG,{"aria-label":TEXT.HOST_LABEL,id:"shopifyHost",name:"shopifyHost","data-testid":"shopifyHost",value:host,onChange:onUpdateHost,onKeyDown:onKeyDownHost,onBlur:onHostBlur,placeholder:TEXT.HOST_PLACEHOLDER,hasError:Boolean(hostInputError),hint:hostInputError}),(0,jsx_runtime.jsx)(components.k$,{type:button_constants.L$.Secondary,size:button_constants.qE.Small,disabled:disableHostSaveButton,onClick:onSaveHost,"data-testid":"shopifyHostButton",children:TEXT.SUBMIT_BUTTON})]}),(0,jsx_runtime.jsx)(components.rJ,{size:types.TextSize.Small,children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{a:(0,jsx_runtime.jsx)(components.Un,{href:TEXT.HOST_CONTEXT_LINK,rel:"noreferrer",target:"_blank",onClick:handleClick,size:types.TextSize.Small})},children:TEXT.HOST_CONTEXT})}),(0,jsx_runtime.jsxs)(components.yN,{children:[(0,jsx_runtime.jsx)(components.xU,{htmlFor:"shopifyAccessToken",children:TEXT.ACCESS_TOKEN_LABEL}),(0,jsx_runtime.jsx)(components.CG,{id:"shopifyAccessToken","aria-label":TEXT.ACCESS_TOKEN_LABEL,name:"shopifyAccessToken","data-testid":"shopifyAccessToken",value:accessToken,onChange:onUpdateAccessToken,onKeyDown:onKeyDownAccessToken,placeholder:TEXT.ACCESS_TOKEN_PLACEHOLDER,hasError:Boolean(accessTokenInputError),hint:accessTokenInputError}),(0,jsx_runtime.jsx)(components.k$,{type:button_constants.L$.Secondary,size:button_constants.qE.Small,disabled:disableAccessTokenSaveButton,onClick:onSaveAccessToken,"data-testid":"shopifyAccessTokenButton",children:TEXT.SUBMIT_BUTTON})]}),(0,jsx_runtime.jsx)(components.rJ,{size:types.TextSize.Small,children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{a:(0,jsx_runtime.jsx)(components.Un,{href:TEXT.ACCESS_TOKEN_CONTEXT_LINK,rel:"noreferrer",target:"_blank",size:types.TextSize.Small})},children:TEXT.ACCESS_TOKEN_CONTEXT})}),(0,jsx_runtime.jsx)(components.Ro,{onFocus:()=>setTestConnectionStatus(""),type:button_constants.L$.Secondary,size:button_constants.qE.Small,disabled:!canTestConnection,onClick:onTestConnection,children:isTestingConnection?TEXT.CONNECTION_CHECKING:TEXT.CONNECTION_TEST_BUTTON}),isTestingConnection&&(0,jsx_runtime.jsx)(Loading,{children:(0,jsx_runtime.jsx)(Spinner,{children:(0,jsx_runtime.jsx)(circular.Z,{size:24})})}),testConnectionStatus&&(0,jsx_runtime.jsx)(components.Me,{"data-testid":"api-status","aria-label":(0,i18n.__)("API connection status","web-stories"),hasError:hasConnectionError,size:types.TextSize.Small,children:testConnectionStatus})]})};__webpack_require__("./node_modules/core-js/modules/es.array.push.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js");var dropdown=__webpack_require__("./packages/design-system/src/components/dropDown/dropdown.tsx");const shoppingProviderDropDown_TEXT={SLOT_ID_LABEL:(0,i18n.__)("Shopping provider","web-stories")};function ShoppingProviderDropDown({vendors,shoppingProvider,handleUpdate}){const OPTIONS=[];return Object.entries(vendors).forEach((([value,label])=>OPTIONS.push({label,value}))),(0,jsx_runtime.jsx)(dropdown.Z,{ariaLabel:shoppingProviderDropDown_TEXT.SLOT_ID_LABEL,options:OPTIONS,selectedValue:shoppingProvider,onMenuItemClick:(_,newShoppingProvider)=>handleUpdate(newShoppingProvider),fillWidth:!0})}ShoppingProviderDropDown.displayName="ShoppingProviderDropDown";const shoppingProviderDropDown=ShoppingProviderDropDown,shopping_TEXT={SECTION_HEADING:(0,i18n.__)("Shopping","web-stories"),SHOPPING_PROVIDER_HELPER_MESSAGE:(0,i18n.__)("Once configured you can add products from this provider.","web-stories"),HELPER_MESSAGE:(0,i18n.__)("Connect your store so you can easily add products to your stories.","web-stories"),WOOCOMMERCE_INSTALL:(0,i18n.__)("Install <a>WooCommerce</a> to easily add shoppable products to Web Stories.","web-stories"),WOOCOMMERCE_ACTIVE:(0,i18n.__)("Activate <a>WooCommerce</a> to easily add shoppable products to Web Stories.","web-stories"),WOOCOMMERCE_MANAGE:(0,i18n.__)("Manage products in <a>WooCommerce</a> to make them available in Web Stories.","web-stories")};function Shopping({updateSettings,shoppingProvider,shopifyHost,shopifyAccessToken,vendors,woocommerce}){const handleUpdateShoppingProvider=(0,src.I4)((newValue=>{updateSettings({shoppingProvider:newValue}),(0,tracking_src.L9)("change_shopping_provider",{name:newValue})}),[updateSettings]),handleUpdateShopifyHost=(0,src.I4)((newValue=>updateSettings({shopifyHost:newValue})),[updateSettings]),handleUpdateShopifyAccessToken=(0,src.I4)((newValue=>updateSettings({shopifyAccessToken:newValue})),[updateSettings]),onWoocommerceClick=(0,src.I4)((evt=>(0,tracking_src.ob)(evt,"click_woocommerce_link")),[]),{canManage,installed,active,link}=woocommerce;let woocommerceMessage;return!1===installed?woocommerceMessage=shopping_TEXT.WOOCOMMERCE_INSTALL:!1===active?woocommerceMessage=shopping_TEXT.WOOCOMMERCE_ACTIVE:!0===canManage&&(woocommerceMessage=shopping_TEXT.WOOCOMMERCE_MANAGE),(0,jsx_runtime.jsxs)(components.xh,{onSubmit:e=>e.preventDefault(),children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(components.B5,{children:shopping_TEXT.SECTION_HEADING}),(0,jsx_runtime.jsx)(components.rJ,{size:types.TextSize.Small,children:shopping_TEXT.HELPER_MESSAGE}),shoppingProvider===constants.Gs.WOOCOMMERCE&&woocommerceMessage&&link&&(0,jsx_runtime.jsx)(components.rJ,{"data-testid":"woocommerceMessage",size:types.TextSize.Small,children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{a:(0,jsx_runtime.jsx)(components.Un,{href:link,rel:"noreferrer",target:"_blank",size:types.TextSize.Small,onClick:onWoocommerceClick})},children:woocommerceMessage})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(shoppingProviderDropDown,{vendors,shoppingProvider,handleUpdate:handleUpdateShoppingProvider}),(0,jsx_runtime.jsx)(components.rJ,{size:types.TextSize.Small,children:shopping_TEXT.SHOPPING_PROVIDER_HELPER_MESSAGE}),shoppingProvider===constants.Gs.SHOPIFY&&(0,jsx_runtime.jsx)(shopify,{handleUpdateHost:handleUpdateShopifyHost,handleUpdateAccessToken:handleUpdateShopifyAccessToken,host:shopifyHost,accessToken:shopifyAccessToken})]})]})}Shopping.displayName="Shopping";const shopping=Shopping,stories={title:"Dashboard/Views/EditorSettings/Shopping",component:shopping,args:{shoppingProvider:constants.Gs.NONE,shopifyHost:"yourstore.myshopify.com",shopifyAccessToken:"",vendors:{none:"None",shopify:"Shopify",woocommerce:"WooCommerce"}},argTypes:{updateSettings:{action:"update settings"}}},_default={render:function Render(args){return(0,jsx_runtime.jsx)(shopping,{...args})}}}}]);