"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[4390],{"./packages/design-system/src/components/keyboard/gridview/useGridViewKeys.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>gridview_useGridViewKeys});var src=__webpack_require__("./packages/react/src/index.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx");function focusOnPage(page){const button=page?.querySelector("button, a");button&&button.focus()}function getArrowDir(key,pos,neg,isRTL){const rtlDir=isRTL?-1:1;return key===pos?rtlDir:key===neg?-1*rtlDir:0}function getGridColumnAndRowCount(grid,pageCount){let prevX,columns=0;for(const el of grid.children){const{x}=el.getBoundingClientRect();if(void 0!==prevX&&x<prevX)break;prevX=x,columns++}return{rows:Math.ceil(pageCount/columns),columns}}function getRow(index,numColumns){return Math.ceil((index+1)/numColumns)}function getColumn(index,numColumns){return index%numColumns+1}function getIndex(_ref){let{row,column,numRows,numColumns,numItems}=_ref;if(row>numRows||row<=0||column>numColumns||column<=0)return-1;const index=numColumns*(row-1)+(column-1);return index>=numItems?numItems-1:index}const gridview_useGridViewKeys=function useGridViewKeys(_ref){let{currentItemId,items,containerRef,gridRef,itemRefs,isRTL,arrangeItem}=_ref;const[focusedItemId,setFocusedItemId]=(0,src.eJ)(null),itemIds=(0,src.Ye)((()=>items.map((_ref2=>{let{id}=_ref2;return id}))),[items]);(0,src.d4)((()=>{setFocusedItemId(currentItemId)}),[currentItemId]),(0,keyboard.Ew)(containerRef,{key:["up","down","left","right"]},(_ref3=>{let{key}=_ref3;switch(key){case"ArrowLeft":case"ArrowRight":{const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;const nextIndex=(null!==focusedItemId?itemIds.indexOf(focusedItemId):-1)+dir;if(nextIndex<0||nextIndex===itemIds.length)return;const itemId=itemIds[nextIndex];setFocusedItemId(itemId);const item=itemRefs?.current?.[itemId];focusOnPage(item);break}case"ArrowUp":case"ArrowDown":{if(!gridRef.current)return;const{rows:numRows,columns:numColumns}=getGridColumnAndRowCount(gridRef.current,itemIds.length),currentIndex=null!==focusedItemId?itemIds.indexOf(focusedItemId):-1,dir="ArrowDown"===key?1:-1,nextIndex=getIndex({row:getRow(currentIndex,numColumns)+dir,column:getColumn(currentIndex,numColumns),numRows,numColumns,numItems:itemIds.length});if(nextIndex<0)return;const itemId=itemIds[nextIndex];setFocusedItemId(itemId);const item=itemRefs?.current?.[itemId];focusOnPage(item);break}}}),[focusedItemId,isRTL,itemIds,itemRefs,gridRef,currentItemId]),(0,keyboard.Ew)(containerRef,{key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(e=>{const{key,shiftKey}=e;let nextIndex,canArrange=!1;switch(e.preventDefault(),key){case"ArrowLeft":case"ArrowRight":{const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;const currentIndex=null!==focusedItemId?itemIds.indexOf(focusedItemId):-1;nextIndex=currentIndex,shiftKey?nextIndex=dir<0?0:itemIds.length-1:nextIndex+=dir,canArrange=nextIndex!==currentIndex&&nextIndex>=0&&nextIndex<=itemIds.length-1;break}case"ArrowUp":case"ArrowDown":{if(!gridRef.current)return;const{rows:numRows,columns:numColumns}=getGridColumnAndRowCount(gridRef.current,itemIds.length),currentIndex=null!==focusedItemId?itemIds.indexOf(focusedItemId):-1,dir="ArrowDown"===key?1:-1;if(nextIndex=getIndex({row:getRow(currentIndex,numColumns)+dir,column:getColumn(currentIndex,numColumns),numRows,numColumns,numItems:itemIds.length}),nextIndex<0)return;break}}canArrange&&void 0!==nextIndex&&arrangeItem&&focusedItemId&&arrangeItem(focusedItemId,nextIndex)}),[currentItemId,itemIds,isRTL,gridRef,itemRefs,focusedItemId,arrangeItem])}},"./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/react/src/index.ts"),styled_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),uuid__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/design-system/node_modules/uuid/dist/esm-browser/v4.js"),_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/i18n/src/i18n.ts"),_theme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/theme/helpers/visuallyHidden.ts"),_theme__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/design-system/src/theme/constants/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const TAU=2*Math.PI,AriaOnlyAlert=styled_components__WEBPACK_IMPORTED_MODULE_3__.ZP.span.withConfig({displayName:"loadingSpinner__AriaOnlyAlert",componentId:"sc-10eor9p-0"})(["",""],_theme__WEBPACK_IMPORTED_MODULE_4__.j),Container=styled_components__WEBPACK_IMPORTED_MODULE_3__.ZP.div.withConfig({displayName:"loadingSpinner__Container",componentId:"sc-10eor9p-1"})(["position:relative;height:","px;width:","px;color:",";"],(_ref=>{let{animationSize}=_ref;return animationSize}),(_ref2=>{let{animationSize}=_ref2;return animationSize}),(_ref3=>{let{theme}=_ref3;return theme.colors.interactiveBg.brandNormal})),Circle=styled_components__WEBPACK_IMPORTED_MODULE_3__.ZP.div.withConfig({displayName:"loadingSpinner__Circle",componentId:"sc-10eor9p-2"})(["position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) ",";height:","px;width:","px;background-color:",";border-radius:",";animation-name:",";animation-fill-mode:both;animation-duration:","s;animation-iteration-count:infinite;animation-timing-function:",";"],(_ref4=>{let{$position:{x,y}}=_ref4;return`translate(${x}px, ${y}px)`}),(_ref5=>{let{circleSize}=_ref5;return circleSize}),(_ref6=>{let{circleSize}=_ref6;return circleSize}),(_ref7=>{let{theme}=_ref7;return theme.colors.interactiveBg.brandNormal}),(_ref8=>{let{theme}=_ref8;return theme.borders.radius.round}),(_ref9=>{let{circleIndex,numCircles}=_ref9;return(0,styled_components__WEBPACK_IMPORTED_MODULE_3__.F4)(["0%{opacity:1}","{opacity:1}","{opacity:0.3}","{opacity:1}"],100*circleIndex/numCircles+"%",100*(circleIndex+1)/numCircles+"%",100*(circleIndex+1)/numCircles+1+"%")}),.85,_theme__WEBPACK_IMPORTED_MODULE_5__.s.inOutQuad);function LoadingSpinner(_ref10){let{animationSize=95,circleSize=12,loadingMessage=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_6__.__)("Loading","web-stories"),numCircles=11,...props}=_ref10;const ids=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.Ye)((()=>new Array(numCircles).fill(1).map((()=>(0,uuid__WEBPACK_IMPORTED_MODULE_7__.Z)()))),[numCircles]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(Container,{animationSize,...props,children:[loadingMessage&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AriaOnlyAlert,{role:"status",children:loadingMessage}),ids.map(((id,index)=>{const angle=((index,numCircles)=>TAU*index/numCircles)(index,numCircles),position=((angle,animationSize)=>{const radius=animationSize/2,x=Math.sin(angle)*radius,y=-Math.cos(angle)*radius;return{x:x.toFixed(1),y:y.toFixed(1)}})(angle,animationSize);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Circle,{circleIndex:index,circleSize,numCircles,$position:position},id)}))]})}LoadingSpinner.displayName="LoadingSpinner";const __WEBPACK_DEFAULT_EXPORT__=LoadingSpinner},"./packages/media/src/formatMsToHMS.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _formatDuration__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/media/src/formatDuration.ts");const __WEBPACK_DEFAULT_EXPORT__=function formatMsToHMS(ms){if(!ms)return"00:00:00";let seconds=ms/1e3;const hours=Math.floor(seconds/3600);seconds%=3600;const minutes=Math.floor(seconds/60);return seconds%=60,`${(0,_formatDuration__WEBPACK_IMPORTED_MODULE_0__.Z)(hours)}:${(0,_formatDuration__WEBPACK_IMPORTED_MODULE_0__.Z)(minutes)}:${(0,_formatDuration__WEBPACK_IMPORTED_MODULE_0__.Z)(seconds)}`}},"./packages/story-editor/src/app/highlights/styles.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var polished__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),styled_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/design-system/src/theme/theme.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts");const flash=(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.F4)(["50%{background-color:",";}"],(0,polished__WEBPACK_IMPORTED_MODULE_1__.m4)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.r.colors.standard.white,.3)),FLASH=(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.iv)(["background-color:",";animation:"," 0.3s ease-in-out 2;"],(0,polished__WEBPACK_IMPORTED_MODULE_1__.m4)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.r.colors.standard.white,0),flash),__WEBPACK_DEFAULT_EXPORT__={OUTLINE:(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.iv)(["",";"],_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_3__.R),FLASH}},"./packages/story-editor/src/app/story/utils/isEmptyStory.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/elements/src/index.ts");const __WEBPACK_DEFAULT_EXPORT__=pages=>{if(!(1===pages.length))return!1;if(!(1===pages[0].elements?.length))return!1;if(!pages[0].elements[0].isDefaultBackground)return!1;const hasPageAttachment=pages[0].pageAttachment?.url;if(hasPageAttachment)return!1;return!(!("color"in pages[0].backgroundColor)||!(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.wU)(_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.A6.color,pages[0].backgroundColor.color))}},"./packages/story-editor/src/components/canvas/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZP:()=>canvas_canvas,OG:()=>useInsertElement.Z,GE:()=>canvas_useInsertTextSet});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),src=__webpack_require__("./packages/react/src/index.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),directionAware=__webpack_require__("./packages/story-editor/src/components/directionAware/index.js"),floatingMenu_constants=__webpack_require__("./packages/story-editor/src/components/floatingMenu/constants.js"),menu=__webpack_require__("./packages/story-editor/src/components/floatingMenu/menu.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function FloatingMenuLayer(){const{setMoveableMount,isEyedropperActive,floatingMenuPosition,displayFloatingMenu}=(0,app.$P)((_ref=>{let{actions,state}=_ref;return{setMoveableMount:actions.setMoveableMount,isEyedropperActive:state.isEyedropperActive,floatingMenuPosition:state.floatingMenuPosition,displayFloatingMenu:state.displayFloatingMenu}})),{workspaceWidth,workspaceHeight}=(0,app.$Y)((_ref2=>{let{state:{workspaceWidth,workspaceHeight}}=_ref2;return{workspaceWidth,workspaceHeight}})),{selectedElementType,selectionIdentifier}=(0,app.rB)((_ref3=>{let{state:{selectedElements}}=_ref3;return{selectedElementType:1!==selectedElements.length||selectedElements[0].isBackground?selectedElements.length>1?floatingMenu_constants.NW.MULTIPLE:floatingMenu_constants.NW.NONE:selectedElements[0]?.type,selectionIdentifier:selectedElements.map((_ref4=>{let{id}=_ref4;return id})).join("")}})),isAnythingTransforming=(0,app.Hm)((_ref5=>{let{state}=_ref5;return state.isAnythingTransforming})),[moveable,setMoveable]=(0,src.eJ)(null),menuRef=(0,src.sO)(),workspaceSize=(0,src.sO)(),[isDismissed,setDismissed]=(0,src.eJ)(!1),handleDismiss=(0,src.I4)((()=>setDismissed(!0)),[]);(0,src.d4)((()=>setDismissed(!1)),[selectionIdentifier]),(0,src.d4)((()=>(setMoveableMount((()=>setMoveable)),()=>setMoveableMount(null))),[setMoveableMount]),(0,src.d4)((()=>{setDismissed(!!isEyedropperActive)}),[isEyedropperActive]),(0,src.d4)((()=>{workspaceSize.current={width:workspaceWidth,height:workspaceHeight}}),[workspaceWidth,workspaceHeight]);const hasMenu=(0,floatingMenu_constants.f2)(selectedElementType)&&!isDismissed&&moveable&&!(!1===displayFloatingMenu);return(0,src.d4)((()=>{const menu=menuRef.current;if(!menu||!moveable)return;const updatePosition=()=>{const frameRect=moveable.getRect(),{width,height}=workspaceSize.current;if(floatingMenuPosition===floatingMenu_constants.k0.TOP)menu.style.left=`clamp(0px, ${width/2}px - (var(--width) / 2), ${width}px - var(--width))`,menu.style.top=`clamp(0px, ${constants.Mz}px, ${height}px - var(--height))`;else{const centerX=frameRect.left+frameRect.width/2;menu.style.left=`clamp(0px, ${centerX}px - (var(--width) / 2), ${width}px - var(--width))`;const bottomX=frameRect.top+frameRect.height+constants.sx;menu.style.top=`clamp(0px, ${bottomX}px, ${height}px - var(--height))`}};updatePosition();const observer=new MutationObserver(updatePosition),node=document.querySelector(".moveable-control-box");return observer.observe(node,{attributes:!0,subtree:!0,attributeFilter:["style"]}),()=>observer.disconnect()}),[moveable,hasMenu,floatingMenuPosition]),!!hasMenu&&(0,jsx_runtime.jsx)(directionAware.Z,{children:(0,jsx_runtime.jsx)(menu.Z,{ref:menuRef,handleDismiss,selectedElementType,selectionIdentifier,visuallyHidden:isAnythingTransforming})})}FloatingMenuLayer.displayName="FloatingMenuLayer";const floatingMenu_layer=FloatingMenuLayer;var mediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/index.js"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),moveable_src=__webpack_require__("./packages/moveable/src/index.ts"),elements_src=__webpack_require__("./packages/elements/src/index.ts"),zIndex=(__webpack_require__("./packages/story-editor/src/propTypes.js"),__webpack_require__("./packages/story-editor/src/constants/zIndex.ts")),useVideoTrim=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoTrim.js"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),getVideoLengthDisplay=__webpack_require__("./packages/media/src/getVideoLengthDisplay.ts"),useLayout=__webpack_require__("./packages/story-editor/src/app/layout/useLayout.ts"),useFocusTrapping=__webpack_require__("./packages/story-editor/src/utils/useFocusTrapping.js");var getMediaSizePositionProps=__webpack_require__("./packages/media/src/getMediaSizePositionProps.ts"),preloadVideo=__webpack_require__("./packages/media/src/preloadVideo.ts"),seekVideo=__webpack_require__("./packages/media/src/seekVideo.ts");const CACHE=new Map;const videoTrim_generateVideoStrip=async function generateVideoStrip(element,resource,stripWidth,stripHeight){const{width:frameWidth,height:frameHeight,scale,focalX,focalY,flip}=element,{src,length}=resource,cacheKey=JSON.stringify([src,stripWidth,stripHeight,scale,focalX,focalY,flip,frameWidth,frameHeight]);if(CACHE.has(cacheKey))return CACHE.get(cacheKey);const stripFrameHeight=stripHeight,stripFrameWidth=stripFrameHeight/frameHeight*frameWidth,frameCount=Math.ceil(stripWidth/stripFrameWidth),actualStripFrameWidth=stripWidth/frameCount,actualFrameWidth=actualStripFrameWidth/stripFrameWidth*frameWidth,{width:videoWidth,height:videoHeight,offsetX,offsetY}=(0,getMediaSizePositionProps.Z)(resource,actualFrameWidth,frameHeight,scale,flip?.horizontal?100-focalX:focalX,flip?.vertical?100-focalY:focalY),frameDistance=length/(frameCount-1),video=await(0,preloadVideo.Z)(src);video.width=videoWidth,video.height=videoHeight,await(0,seekVideo.Z)(video,1e-6);const canvas=document.createElement("canvas");canvas.width=stripWidth,canvas.height=stripHeight;const ctx=canvas.getContext("2d");if(!ctx)return Promise.resolve(null);let timeOffset=0,frame=0;const grabFrame=async()=>{await(0,seekVideo.Z)(video,timeOffset);const dx=frame*actualStripFrameWidth;return(flip.vertical||flip.horizontal)&&(ctx.translate(dx+actualStripFrameWidth/2,stripFrameHeight/2),ctx.scale(flip.horizontal?-1:1,flip.vertical?-1:1),ctx.translate(-(dx+actualStripFrameWidth/2),-stripFrameHeight/2)),ctx.drawImage(video,offsetX,offsetY,actualFrameWidth,frameHeight,dx,0,actualStripFrameWidth,stripFrameHeight),ctx.setTransform(1,0,0,1,0,0),frame+=1,frame===frameCount?Promise.resolve():(timeOffset+=frameDistance,grabFrame())};return grabFrame().then((()=>{const finalStrip=canvas.toDataURL();return CACHE.set(cacheKey,finalStrip),finalStrip}))};const videoTrim_useRailBackground=function useRailBackground(isReady,videoData,railWidth){const[railBackgroundImage,setRailBackgroundImage]=(0,src.eJ)(null);return(0,src.d4)((()=>{if(!isReady)return;const{element,resource}=videoData;videoTrim_generateVideoStrip(element,resource,railWidth,36).then(setRailBackgroundImage)}),[isReady,videoData,railWidth]),railBackgroundImage};var noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const Thumb=styled_components_browser_esm.ZP.button.withConfig({displayName:"slider__Thumb",componentId:"sc-50zvue-0"})(["position:absolute;padding:0;"]);function getPageX(evt){return evt.pageX||evt.clientX}function Slider(_ref){let{railWidth,min,max,step,minorStep=null,value=0,onChange=noop.Z,getValueText=null,onPointerDown=noop.Z,onNudge=noop.Z,...rest}=_ref;const ref=(0,src.sO)(),handlePointerDown=(0,src.I4)((downEvent=>{downEvent.preventDefault(),downEvent.stopPropagation(),ref.current.focus(),onPointerDown?.();const handlePointerMove=function(event){const deltaX=getPageX(event)-getPageX(downEvent);onChange(value+deltaX/railWidth*(max-min)),event.preventDefault(),event.stopPropagation()},handlePointerUp=function(){document.removeEventListener("pointermove",handlePointerMove),document.removeEventListener("pointerup",handlePointerUp)};return document.addEventListener("pointermove",handlePointerMove),document.addEventListener("pointerup",handlePointerUp),handlePointerUp}),[value,max,min,onChange,railWidth,onPointerDown]),handleNudge=(0,src.I4)((delta=>{onChange(value+delta),onNudge?.()}),[onChange,onNudge,value]);(0,keyboard.Ew)(ref,"left",(()=>handleNudge(-step)),[handleNudge,step]),(0,keyboard.Ew)(ref,"shift+left",(()=>handleNudge(-minorStep)),[handleNudge,minorStep]),(0,keyboard.Ew)(ref,"right",(()=>handleNudge(step)),[handleNudge,step]),(0,keyboard.Ew)(ref,"shift+right",(()=>handleNudge(minorStep)),[handleNudge,minorStep]);const sliderStyle={left:`${((value-min)/(max-min)*railWidth).toFixed(2)}px`};return(0,jsx_runtime.jsx)(Thumb,{ref,onPointerDown:handlePointerDown,style:sliderStyle,role:"slider","aria-valuemin":min,"aria-valuemax":max,"aria-valuenow":value,"aria-valuetext":getValueText?.(value),...rest})}Slider.displayName="Slider";const slider=Slider,StyledSlider=(0,styled_components_browser_esm.ZP)(slider).withConfig({displayName:"currentTime__StyledSlider",componentId:"sc-tf91kz-0"})(["top:-3px;bottom:-3px;width:6px;margin-left:-3px;border-radius:6px;border-width:0;background-color:",";box-shadow:0px 1px 2px rgba(60,64,67,0.3),0px 1px 3px 1px rgba(60,64,67,0.15);"],(_ref=>{let{theme}=_ref;return theme.colors.interactiveBg.primaryNormal}));function CurrentTime(props){const currentTime=(0,useVideoTrim.Z)((_ref2=>{let{state:{currentTime}}=_ref2;return currentTime}));return(0,jsx_runtime.jsx)(StyledSlider,{"aria-label":(0,i18n.__)("Current time","web-stories"),value:currentTime,disabled:!0,...props})}CurrentTime.displayName="CurrentTime";const currentTime=CurrentTime;var typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts");const Menu=styled_components_browser_esm.ZP.aside.withConfig({displayName:"trimmerComponents__Menu",componentId:"sc-1vmlktu-0"})(["display:flex;justify-content:center;align-items:flex-start;height:","px;gap:14px;"],40),RailWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"trimmerComponents__RailWrapper",componentId:"sc-1vmlktu-1"})(["display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-end;"]),Rail=styled_components_browser_esm.ZP.div.withConfig({displayName:"trimmerComponents__Rail",componentId:"sc-1vmlktu-2"})(["position:relative;width:","px;height:","px;border-radius:4px;border:1px solid ",";background-color:",";"],(_ref=>{let{width}=_ref;return width}),36,(_ref2=>{let{theme}=_ref2;return theme.colors.standard.white}),(_ref3=>{let{theme}=_ref3;return theme.colors.standard.white}));function Duration(_ref4){let{children}=_ref4;return(0,jsx_runtime.jsx)(typography_text.x.Span,{size:types.TextSize.XSmall,children})}Duration.displayName="Duration";const Handle=(0,styled_components_browser_esm.ZP)(slider).withConfig({displayName:"trimmerComponents__Handle",componentId:"sc-1vmlktu-3"})(["top:6px;bottom:6px;width:6px;margin-left:-3px;border-radius:6px;background-color:",";border:1px solid ",";box-shadow:0px 1px 2px rgba(60,64,67,0.3),0px 1px 3px 1px rgba(60,64,67,0.15);cursor:col-resize;&:focus{border-color:",";}&:focus-visible{outline:none !important;}"],(_ref5=>{let{theme}=_ref5;return theme.colors.bg.primary}),(_ref6=>{let{theme}=_ref6;return theme.colors.border.defaultNormal}),(_ref7=>{let{theme}=_ref7;return theme.colors.border.focus})),SVG=styled_components_browser_esm.ZP.svg.withConfig({displayName:"trimmerComponents__SVG",componentId:"sc-1vmlktu-4"})(["position:absolute;top:-1px;"]),ButtonWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"trimmerComponents__ButtonWrapper",componentId:"sc-1vmlktu-5"})(["flex-grow:1;flex-basis:100px;display:flex;justify-content:",";"],(_ref8=>{let{isStart}=_ref8;return isStart?"flex-end":"flex-start"}));function Scrim(_ref9){let{width,isLeftAligned=!1}=_ref9;const floatStyle=isLeftAligned?{left:"-1px"}:{right:"-1px"},path=isLeftAligned?`M 4 0 h ${width} a 4 4 0 0 0 -4 4 v 28 a 4 4 0 0 0 4 4 h -${width} a 4 4 0 0 1 -4 -4 v -28 a 4 4 0 0 1 4 -4 Z`:`M 0 0 h ${width} a 4 4 0 0 1 4 4 v 28 a 4 4 0 0 1 -4 4 h -${width} a 4 4 0 0 0 4 -4 v -28 a 4 4 0 0 0 -4 -4 Z`;return(0,jsx_runtime.jsx)(SVG,{style:{width:`${width+4}px`,...floatStyle},viewBox:`0 0 ${width+4} 36`,children:(0,jsx_runtime.jsx)("path",{stroke:"transparent",fill:"black",fillOpacity:"0.5",d:path})})}Scrim.displayName="Scrim";function VideoTrimmer(){const{startOffset,endOffset,maxOffset,setStartOffset,setEndOffset,hasChanged,performTrim,setIsDraggingHandles,toggleTrimMode,videoData}=(0,useVideoTrim.Z)((_ref=>{let{state:{startOffset,endOffset,maxOffset,hasChanged,videoData},actions:{setStartOffset,setEndOffset,performTrim,toggleTrimMode,setIsDraggingHandles}}=_ref;return{startOffset,endOffset,maxOffset,setStartOffset,setEndOffset,hasChanged,performTrim,setIsDraggingHandles,toggleTrimMode,videoData}})),{workspaceWidth,pageWidth}=(0,useLayout.Z)((_ref2=>{let{state:{workspaceWidth,pageWidth}}=_ref2;return{workspaceWidth,pageWidth}})),debouncedNudge=(0,src.y1)((()=>setIsDraggingHandles(!1)),1e3),menu=(0,src.sO)(null);(0,useFocusTrapping.Z)({ref:menu});const setCancelRef=(0,src.I4)((node=>{node&&node.focus()}),[]),railWidth=Math.min(pageWidth,workspaceWidth-260),isReady=pageWidth&&maxOffset&&videoData,railBackgroundImage=videoTrim_useRailBackground(isReady,videoData,railWidth),menuProps={ref:menu,"aria-label":(0,i18n.__)("Video trimmer","web-stories")};if(!isReady)return(0,jsx_runtime.jsx)(Menu,{...menuProps});const sliderProps={min:0,max:maxOffset,step:100,minorStep:10,onPointerDown:()=>setIsDraggingHandles(!0),onPointerUp:()=>setIsDraggingHandles(!1),onNudge:()=>{setIsDraggingHandles(!0),debouncedNudge()}};return(0,jsx_runtime.jsxs)(Menu,{...menuProps,children:[(0,jsx_runtime.jsx)(ButtonWrapper,{isStart:!0,children:(0,jsx_runtime.jsx)(button_button.z,{variant:button_constants.Wu.Rectangle,type:button_constants.L$.Secondary,size:button_constants.qE.Small,onClick:toggleTrimMode,ref:setCancelRef,children:(0,i18n.__)("Cancel","web-stories")})}),(0,jsx_runtime.jsxs)(RailWrapper,{children:[(0,jsx_runtime.jsxs)(Rail,{width:railWidth,style:{backgroundImage:railBackgroundImage?`url(${railBackgroundImage})`:void 0},children:[(0,jsx_runtime.jsx)(Scrim,{isLeftAligned:!0,width:startOffset/maxOffset*railWidth}),(0,jsx_runtime.jsx)(Scrim,{width:(maxOffset-endOffset)/maxOffset*railWidth}),(0,jsx_runtime.jsx)(currentTime,{railWidth,...sliderProps}),(0,jsx_runtime.jsx)(Handle,{railWidth,value:startOffset,"aria-label":(0,i18n.__)("Start offset","web-stories"),onChange:val=>setStartOffset(val),...sliderProps}),(0,jsx_runtime.jsx)(Handle,{railWidth,value:endOffset,"aria-label":(0,i18n.__)("End offset","web-stories"),onChange:val=>setEndOffset(val),...sliderProps})]}),(0,jsx_runtime.jsx)(Duration,{children:(0,getVideoLengthDisplay.Z)(Math.ceil((endOffset-startOffset)/1e3))})]}),(0,jsx_runtime.jsx)(ButtonWrapper,{children:(0,jsx_runtime.jsx)(button_button.z,{variant:button_constants.Wu.Rectangle,type:button_constants.L$.Primary,size:button_constants.qE.Small,onClick:performTrim,disabled:!hasChanged,children:(0,i18n.__)("Trim","web-stories")})})]})}VideoTrimmer.displayName="VideoTrimmer";const videoTrimmer=VideoTrimmer;var useUnits=__webpack_require__("./packages/units/src/useUnits.ts"),animation_src=__webpack_require__("./packages/animation/src/index.ts"),element_library_src=__webpack_require__("./packages/element-library/src/index.js"),useCORSProxy=__webpack_require__("./packages/story-editor/src/utils/useCORSProxy.ts");const Z_INDEX_CANVAS={FLOAT_PANEL:11},Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"editElement__Wrapper",componentId:"sc-1w8k2uc-0"})([""," "," "," pointer-events:initial;"],element_library_src.Q_,element_library_src.WG,element_library_src.h1),editElement=(0,src.X$)((0,src.Gp)((function EditElement(_ref,ref){let{element,editWrapper,onResize}=_ref;const{id,type}=element,{getBox,getBoxWithBorder}=(0,useUnits.Z)((state=>({getBox:state.actions.getBox,getBoxWithBorder:state.actions.getBoxWithBorder}))),{getProxiedUrl}=(0,useCORSProxy.Z)(),{isRTL,styleConstants:{topOffset}={}}=(0,app.ZR)(),{actions:{maybeEnqueueFontStyle}}=(0,app.jo)(),{updateElementById,deleteSelectedElements}=(0,app.rB)((state=>({updateElementById:state.actions.updateElementById,deleteSelectedElements:state.actions.deleteSelectedElements}))),{isTrimMode,resource,setVideoNode}=(0,useVideoTrim.Z)((_ref2=>{let{state:{isTrimMode,videoData},actions:{setVideoNode}}=_ref2;return{isTrimMode,setVideoNode,resource:videoData?.resource}})),[localProperties,setLocalProperties]=(0,src.eJ)(null),{Edit}=(0,elements_src.Do)(type),elementWithLocal=localProperties?{...element,...localProperties}:element,editBox="text"===type?getBoxWithBorder(elementWithLocal):getBox(elementWithLocal);return(0,jsx_runtime.jsx)(Wrapper,{"aria-labelledby":`layer-${id}`,...editBox,ref,children:(0,jsx_runtime.jsx)(Edit,{element:elementWithLocal,box:editBox,editWrapper,onResize,setLocalProperties,getProxiedUrl,isRTL,topOffset,isTrimMode,resource,setVideoNode,updateElementById,deleteSelectedElements,maybeEnqueueFontStyle,zIndexCanvas:Z_INDEX_CANVAS,scaleMin:animation_src.nF,scaleMax:animation_src.fo})})})));var generatePatternStyles=__webpack_require__("./packages/patterns/src/generatePatternStyles.ts"),src_constants=__webpack_require__("./packages/units/src/constants.ts"),theme_constants=__webpack_require__("./packages/design-system/src/theme/constants/index.ts");const NAVIGATION_BUTTON_WIDTH=theme_constants.Z.ICON_SIZE,NAVIGATION_BUTTON_GUTTER=NAVIGATION_BUTTON_WIDTH+8,FOOTER_BOTTOM_MARGIN=16,KEYBOARD_SHORTCUTS_WIDTH=theme_constants.Z.ICON_SIZE+6+2,MAX_MENU_WIDTH=2*(theme_constants.Z.LARGE_BUTTON_SIZE+2)+2*KEYBOARD_SHORTCUTS_WIDTH+16+16;const footer_useFooterHeight=function useFooterHeight(){const{carouselState}=(0,app.$Y)((_ref=>{let{state:{carouselState}}=_ref;return{carouselState}}));return carouselState===constants.bh.Closed?52:136};var layout=__webpack_require__("./packages/story-editor/src/app/layout/index.ts");const canvas_usePinchToZoom=function usePinchToZoom(_ref){let{containerRef}=_ref;const{zoomLevel,setZoomLevel}=(0,layout.$)((_ref2=>{let{state:{zoomLevel},actions:{setZoomLevel}}=_ref2;return{zoomLevel,setZoomLevel}})),handleZoom=(0,src.y1)((level=>setZoomLevel(level)),25);(0,src.bt)((()=>{if(!containerRef.current)return;const clampZoomLevel=value=>Math.min(3,Math.max(.25,value-value%.25)),onWheel=e=>{const{ctrlKey,deltaY}=e,node=containerRef.current.childNodes[0];if(ctrlKey&&node.contains(e.target)&&deltaY){handleZoom(clampZoomLevel(deltaY>0?zoomLevel-.25:zoomLevel+.25)),e.preventDefault()}},preventDefault=e=>{containerRef.current.childNodes[0].contains(e.target)&&e.preventDefault()},handleGestureChange=e=>{const node=containerRef.current.childNodes[0],{scale}=e;if(node.contains(e.target)&&scale){handleZoom(clampZoomLevel(scale<1?zoomLevel-.25:zoomLevel+.25)),e.preventDefault()}};return document.addEventListener("wheel",onWheel,{passive:!1}),document.addEventListener("gesturestart",preventDefault),document.addEventListener("gestureend",preventDefault),document.addEventListener("gesturechange",handleGestureChange),()=>{document.removeEventListener("wheel",onWheel,{passive:!1}),document.removeEventListener("gesturestart",preventDefault),document.removeEventListener("gestureend",preventDefault),document.removeEventListener("gesturechange",handleGestureChange)}}),[containerRef,handleZoom,zoomLevel])},PAGE_NAV_WIDTH=theme_constants.Z.LARGE_BUTTON_SIZE+8,PAGE_NAV_GAP=20,LayerGrid=styled_components_browser_esm.ZP.section.withConfig({displayName:"layout__LayerGrid",componentId:"sc-1n0mp4m-0"})(["pointer-events:",";position:absolute;top:0;left:0;right:0;bottom:0;"," display:grid;grid:'h h h h h h h' ","px '. . . t . . .' minmax(","px,1fr) 'p b . c . f n' var(--viewport-height-px) '. . . . . . .' 1fr 'w w w w w w w' ","px '. . . . . . .' ","px / 1fr var(--page-nav-width) var(--page-nav-gap) var(--viewport-width-px) var(--page-nav-gap) var(--page-nav-width) 1fr;height:100%;"],(_ref=>{let{pointerEvents}=_ref;return pointerEvents}),(_ref2=>{let{zIndex}=_ref2;return"number"==typeof zIndex?`z-index: ${zIndex};`:""}),constants.Mz,constants.Qu,(_ref3=>{let{footerHeight}=_ref3;return footerHeight}),FOOTER_BOTTOM_MARGIN),Area=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__Area",componentId:"sc-1n0mp4m-1"})(["pointer-events:",";grid-area:",";overflow:",";position:relative;width:100%;height:100%;",";"],(_ref4=>{let{pointerEvents}=_ref4;return pointerEvents}),(_ref5=>{let{area}=_ref5;return area}),(_ref6=>{let{showOverflow}=_ref6;return showOverflow?"visible":"hidden"}),(_ref7=>{let{zIndex}=_ref7;return void 0!==zIndex?`z-index: ${zIndex}`:null})),PageAreaContainer=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"c"}).withConfig({displayName:"layout__PageAreaContainer",componentId:"sc-1n0mp4m-2"})(["position:relative;display:flex;justify-content:",";align-items:",";overflow:",";",""],(_ref8=>{let{hasHorizontalOverflow}=_ref8;return hasHorizontalOverflow?"flex-start":"center"}),(_ref9=>{let{hasVerticalOverflow}=_ref9;return hasVerticalOverflow?"flex-start":"center"}),(_ref10=>{let{showOverflow}=_ref10;return showOverflow?"visible":"var(--overflow-x) var(--overflow-y)"}),(_ref11=>{let{isControlled,hasVerticalOverflow,hasHorizontalOverflow,showOverflow}=_ref11;return isControlled&&`\n      overflow: ${showOverflow?"visible":"hidden"};\n      width: calc(\n        100% - ${hasVerticalOverflow?theme_constants.Z.SCROLLBAR_WIDTH:0}px\n      );\n      height: calc(\n        100% - ${hasHorizontalOverflow?theme_constants.Z.SCROLLBAR_WIDTH:0}px\n      );\n    `})),PageTitleContainer=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"t"}).withConfig({displayName:"layout__PageTitleContainer",componentId:"sc-1n0mp4m-3"})(["position:relative;display:flex;justify-content:center;align-items:center;"]),Layer=(0,src.Gp)((function Layer(_ref12,ref){let{children,...rest}=_ref12;const footerHeight=footer_useFooterHeight();return(0,jsx_runtime.jsx)(LayerGrid,{ref,footerHeight,...rest,children})})),PaddedPage=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__PaddedPage",componentId:"sc-1n0mp4m-4"})(["padding:calc(0.5 * var(--page-padding-px));"]),PageClip=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__PageClip",componentId:"sc-1n0mp4m-5"})(["",""],(_ref13=>{let{hasHorizontalOverflow,hasVerticalOverflow}=_ref13;return(hasHorizontalOverflow||hasVerticalOverflow)&&`\n      overflow: hidden;\n      width: ${hasHorizontalOverflow?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${theme_constants.Z.SCROLLBAR_WIDTH}px)`};\n      flex-basis: ${hasHorizontalOverflow?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${theme_constants.Z.SCROLLBAR_WIDTH}px)`};\n      height: ${hasVerticalOverflow?"calc(var(--fullbleed-height-px) + var(--page-padding-px))":`calc(var(--viewport-height-px) - ${theme_constants.Z.SCROLLBAR_WIDTH}px)`};\n      flex-shrink: 0;\n      flex-grow: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    `})),FullbleedContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__FullbleedContainer",componentId:"sc-1n0mp4m-6"})([""," overflow:visible;position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;border-radius:5px;",";",""],(_ref14=>{let{background}=_ref14;return(0,generatePatternStyles.Z)(background)}),(_ref15=>{let{isControlled}=_ref15;return isControlled&&"\n      left: var(--scroll-left-px);\n      top: var(--scroll-top-px);\n    "}),(_ref16=>{let{isBackgroundSelected,theme}=_ref16;return isBackgroundSelected&&`\n      &:before {\n        content: '';\n        position: absolute;\n        top: -4px;\n        left: -4px;\n        right: -4px;\n        bottom: -4px;\n        border: ${theme.colors.border.selection} 1px solid;\n        border-radius: ${theme.borders.radius.medium};\n      }\n    `})),PageAreaWithoutOverflow=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__PageAreaWithoutOverflow",componentId:"sc-1n0mp4m-7"})(["overflow:",";position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;"],(_ref17=>{let{showOverflow}=_ref17;return showOverflow?"initial":"hidden"})),PageAreaSafeZone=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__PageAreaSafeZone",componentId:"sc-1n0mp4m-8"})(["width:var(--page-width-px);height:var(--page-height-px);overflow:visible;position:relative;"]),HeadArea=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"h"}).withConfig({displayName:"layout__HeadArea",componentId:"sc-1n0mp4m-9"})([""]),NavArea=((0,styled_components_browser_esm.ZP)(Area).attrs({area:"m"}).withConfig({displayName:"layout__MenuArea",componentId:"sc-1n0mp4m-10"})([""]),(0,styled_components_browser_esm.ZP)(Area).withConfig({displayName:"layout__NavArea",componentId:"sc-1n0mp4m-11"})(["display:flex;align-items:center;justify-content:center;"])),NavPrevArea=(0,styled_components_browser_esm.ZP)(NavArea).attrs({area:"b"}).withConfig({displayName:"layout__NavPrevArea",componentId:"sc-1n0mp4m-12"})([""]),NavNextArea=(0,styled_components_browser_esm.ZP)(NavArea).attrs({area:"f"}).withConfig({displayName:"layout__NavNextArea",componentId:"sc-1n0mp4m-13"})([""]),PageBeforeArea=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"p"}).withConfig({displayName:"layout__PageBeforeArea",componentId:"sc-1n0mp4m-14"})([""]),PageAfterArea=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"n"}).withConfig({displayName:"layout__PageAfterArea",componentId:"sc-1n0mp4m-15"})([""]),PageMenuArea=styled_components_browser_esm.ZP.div.withConfig({displayName:"layout__PageMenuArea",componentId:"sc-1n0mp4m-16"})(["grid-area:c;position:absolute;right:calc(-24px + var(--page-padding-px));top:calc(0.5 * var(--page-padding-px));min-height:calc(100% - var(--page-padding-px));"]),FooterArea=(0,styled_components_browser_esm.ZP)(Area).attrs({area:"w",showOverflow:!0}).withConfig({displayName:"layout__FooterArea",componentId:"sc-1n0mp4m-17"})([""]);const PageArea=(0,src.Gp)((function PageArea(_ref21,ref){let{children,fullbleedRef:_fullbleedRef=null,fullBleedContainerLabel=(0,i18n.__)("Fullbleed area","web-stories"),overlay=[],background,isControlled=!1,className="",showOverflow=!1,isBackgroundSelected=!1,pageAreaRef=(0,src.Vf)(),withSafezone=!0,...rest}=_ref21;const internalFullblledRef=(0,src.sO)(),fullbleedRef=_fullbleedRef||internalFullblledRef,{hasVerticalOverflow,hasHorizontalOverflow,zoomSetting,scrollLeft,scrollTop}=(0,app.$Y)((_ref22=>{let{state:{hasVerticalOverflow,hasHorizontalOverflow,zoomSetting,scrollLeft,scrollTop}}=_ref22;return{hasVerticalOverflow,hasHorizontalOverflow,zoomSetting,scrollLeft,scrollTop}})),scroll=(0,src.sO)();scroll.current={top:scrollTop,left:scrollLeft},(0,src.d4)((()=>{isControlled||(fullbleedRef.current.scrollTop=scroll.current.top,fullbleedRef.current.scrollLeft=scroll.current.left)}),[isControlled,zoomSetting,fullbleedRef]);const paddedRef=(0,src.sO)(null);return canvas_usePinchToZoom({containerRef:paddedRef}),(0,jsx_runtime.jsx)(PageAreaContainer,{showOverflow,isControlled,hasHorizontalOverflow,hasVerticalOverflow,className,"data-scroll-container":!0,...rest,children:(0,jsx_runtime.jsx)(PageClip,{hasHorizontalOverflow,hasVerticalOverflow,children:(0,jsx_runtime.jsx)(PaddedPage,{ref:paddedRef,children:(0,jsx_runtime.jsx)(FullbleedContainer,{"aria-label":fullBleedContainerLabel,role:"region",ref:fullbleedRef,"data-testid":"fullbleed",background,isControlled,isBackgroundSelected,children:(0,jsx_runtime.jsxs)(PageAreaWithoutOverflow,{ref:pageAreaRef,showOverflow,children:[withSafezone?(0,jsx_runtime.jsx)(PageAreaSafeZone,{ref,"data-testid":"safezone",children}):children,overlay]})})})})})}));var useFocusCanvas=__webpack_require__("./packages/story-editor/src/components/canvas/useFocusCanvas.ts"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),transform_src=__webpack_require__("./packages/transform/src/index.ts"),masks_src=__webpack_require__("./packages/masks/src/index.ts"),objectWithout=__webpack_require__("./packages/story-editor/src/utils/objectWithout.ts"),useSnapping=__webpack_require__("./packages/story-editor/src/components/canvas/utils/useSnapping.js");const utils_useUpdateSelectionRectangle=function useUpdateSelectionRectangle(moveableRef){let dependencies=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,src.d4)((()=>{let mounted=!0;const update=()=>{mounted&&moveableRef.current?.updateRect?.()};update();const timeout=setTimeout(update);return()=>{mounted=!1,clearTimeout(timeout)}}),dependencies)};const canvas_useWindowResizeHandler=function useWindowResizeHandler(ref){(0,src.d4)((()=>{const handleUpdateMoveable=()=>ref.current?.updateRect();return window.addEventListener("resize",handleUpdateMoveable),()=>{window.removeEventListener("resize",handleUpdateMoveable)}}),[ref])};var dropTargets=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),isTargetOutOfContainer=__webpack_require__("./packages/story-editor/src/utils/isTargetOutOfContainer.ts");const utils_useElementOutOfCanvas=function useElementOutOfCanvas(){const{deleteSelectedElements}=(0,app.rB)((state=>({deleteSelectedElements:state.actions.deleteSelectedElements}))),{clearTransforms}=(0,app.Hm)((state=>({clearTransforms:state.actions.clearTransforms}))),{fullbleedContainer}=(0,app.$P)((_ref=>{let{state:{fullbleedContainer}}=_ref;return{fullbleedContainer}}));return{handleElementOutOfCanvas:target=>!!(0,isTargetOutOfContainer.Z)(target,fullbleedContainer)&&(deleteSelectedElements(),clearTransforms(),!0)}};var localStore=__webpack_require__("./packages/design-system/src/utils/localStore.ts"),useSnackbar=__webpack_require__("./packages/design-system/src/contexts/snackbar/useSnackbar.ts"),SAT=__webpack_require__("./node_modules/sat/SAT.js"),SAT_default=__webpack_require__.n(SAT),useElementPolygon=__webpack_require__("./packages/story-editor/src/utils/useElementPolygon.js");const utils_useFullbleedMediaAsBackground=function useFullbleedMediaAsBackground(){const[isBackgroundSnackbarMessageDismissed,setIsBackgroundSnackbarMessageDismissed]=(0,src.eJ)(localStore.W.getItemByKey(localStore.h.BACKGROUND_IS_SET_DIALOG_DISMISSED)),{setBackgroundElement,isDefaultBackground}=(0,app.rB)((state=>({setBackgroundElement:state.actions.setBackgroundElement,isDefaultBackground:state.state.currentPage?.elements[0]?.isDefaultBackground}))),{fullbleedContainer}=(0,app.$P)((_ref=>{let{state:{fullbleedContainer}}=_ref;return{fullbleedContainer}})),{clearTransforms}=(0,app.Hm)((state=>({clearTransforms:state.actions.clearTransforms}))),{showSnackbar}=(0,useSnackbar.D)(),getElementPolygon=(0,useElementPolygon.Z)();return{handleFullbleedMediaAsBackground:selectedElement=>{if(isDefaultBackground&&elements_src.ne.includes(selectedElement.type)){const elPolygon=getElementPolygon(selectedElement),fullbleedBox=fullbleedContainer.getBoundingClientRect(),bgPolygon=new(SAT_default().Box)(new(SAT_default().Vector)(fullbleedBox.x+2,fullbleedBox.y+2),fullbleedBox.width-4,fullbleedBox.height-4).toPolygon(),response=new(SAT_default().Response);SAT_default().testPolygonPolygon(elPolygon,bgPolygon,response),response.bInA&&setBackgroundElement({elementId:selectedElement.id}),isBackgroundSnackbarMessageDismissed||(showSnackbar({message:(0,i18n.__)("Full bleed images and videos are automatically set as background. Double click to scale and position at any time.","web-stories"),dismissible:!0}),localStore.W.setItemByKey(localStore.h.BACKGROUND_IS_SET_DIALOG_DISMISSED,!0),setIsBackgroundSnackbarMessageDismissed(!0)),clearTransforms()}}}};const useDrag=function useSingleSelectionDrag(_ref){let{setIsDragging,resetMoveable,selectedElement,setTransformStyle,frame}=_ref;const{isDropSource,handleDrag,handleDrop,setDraggingResource}=(0,dropTargets.H)((_ref2=>{let{actions:{handleDrag,handleDrop,isDropSource,setDraggingResource}}=_ref2;return{handleDrag,handleDrop,setDraggingResource,isDropSource}})),{handleElementOutOfCanvas}=utils_useElementOutOfCanvas(),{handleFullbleedMediaAsBackground}=utils_useFullbleedMediaAsBackground(),{updateSelectedElements}=(0,app.rB)((state=>({updateSelectedElements:state.actions.updateSelectedElements}))),{editorToDataX,editorToDataY}=(0,useUnits.Z)((_ref3=>{let{actions:{editorToDataX,editorToDataY}}=_ref3;return{editorToDataX,editorToDataY}})),resetDragging=(0,src.iS)((target=>{setIsDragging(!1),setDraggingResource(null),resetMoveable(target)}),[setIsDragging,setDraggingResource,resetMoveable]);return{onDrag:_ref4=>{let{target,beforeTranslate,clientX,clientY}=_ref4;setIsDragging(!0),isDropSource(selectedElement.type)&&setDraggingResource(selectedElement.resource),frame.translate=beforeTranslate,setTransformStyle(target,frame),isDropSource(selectedElement.type)&&handleDrag(selectedElement.resource,clientX,clientY,selectedElement.id)},throttleDrag:0,onDragStart:_ref5=>{let{set}=_ref5;set(frame.translate)},onDragEnd:_ref6=>{let{target,isDrag}=_ref6;if(!isDrag)return!1;if(handleElementOutOfCanvas(target))return setIsDragging(!1),void setDraggingResource(null);const roundToZero=num=>Math.abs(num)<=1?0:num,[deltaX,deltaY]=frame.translate;let properties={};0===deltaX&&0===deltaY||(properties={x:roundToZero(selectedElement.x+editorToDataX(deltaX)),y:roundToZero(selectedElement.y+editorToDataY(deltaY))},updateSelectedElements({properties}),isDropSource(selectedElement.type)&&handleDrop(selectedElement.resource,selectedElement.id)),resetDragging(target),handleFullbleedMediaAsBackground({...selectedElement,...properties})}}},EMPTY_HANDLES=[],VERTICAL_HANDLES=["n","s"],HORIZONTAL_HANDLES=["e","w"],DIAGONAL_HANDLES=["nw","ne","sw","se"];function getRenderDirections(_ref){let{vertical,horizontal,diagonal}=_ref;return[...vertical?VERTICAL_HANDLES:EMPTY_HANDLES,...horizontal?HORIZONTAL_HANDLES:EMPTY_HANDLES,...diagonal?DIAGONAL_HANDLES:EMPTY_HANDLES]}const useResize=function useSingleSelectionResize(_ref2){let{resetMoveable,selectedElement,setTransformStyle,frame,isEditMode,pushTransform,classNames,forceLockRatio}=_ref2;const{updateSelectedElements}=(0,app.rB)((state=>({updateSelectedElements:state.actions.updateSelectedElements}))),{handleElementOutOfCanvas}=utils_useElementOutOfCanvas(),{handleFullbleedMediaAsBackground}=utils_useFullbleedMediaAsBackground(),{editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}=(0,useUnits.Z)((_ref3=>{let{actions:{editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}}=_ref3;return{editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}})),{lockAspectRatio:elementLockRatio,type,border}=selectedElement,isText="text"===type,[isResizingFromCorner,setIsResizingFromCorner]=(0,src.eJ)(!0),lockAspectRatio=!isText&&(forceLockRatio||elementLockRatio)||isText&&isResizingFromCorner,{resizeRules,updateForResizeEvent}=(0,elements_src.Do)(type),minWidth=dataToEditorX(resizeRules.minWidth),minHeight=dataToEditorY(resizeRules.minHeight),aspectRatio=selectedElement.width/selectedElement.height,{left=0,right=0,top=0,bottom=0}=border||{},visuallyHideHandles=selectedElement.width<=resizeRules.minWidth||selectedElement.height<=resizeRules.minHeight;return{onResize:_ref4=>{let{target,direction,width,height,drag}=_ref4,newWidth=width-(left+right),newHeight=height-(top+bottom),updates=null;lockAspectRatio?(newWidth<minWidth&&(newWidth=minWidth,newHeight=newWidth/aspectRatio),newHeight<minHeight&&(newHeight=minHeight,newWidth=minHeight*aspectRatio)):(newHeight=Math.max(newHeight,minHeight),newWidth=Math.max(newWidth,minWidth)),updateForResizeEvent&&(updates=updateForResizeEvent(selectedElement,direction,editorToDataX(newWidth,!1),editorToDataY(newHeight,!1))),updates&&updates.height&&(newHeight=dataToEditorY(updates.height)),updates&&updates.marginOffset&&(target.querySelector(".syncMargin").style.margin=-dataToEditorY(updates.marginOffset)/2+"px 0");const frameWidth=newWidth+left+right,frameHeight=newHeight+top+bottom;target.style.width=`${frameWidth}px`,target.style.height=`${frameHeight}px`,frame.direction=direction,frame.resize=[frameWidth,frameHeight],frame.translate=drag.beforeTranslate,frame.updates=updates,setTransformStyle(target,frame)},onResizeStart:_ref5=>{let{setOrigin,dragStart,direction}=_ref5;setOrigin(["%","%"]),dragStart&&dragStart.set(frame.translate);const newResizingMode=0!==direction[0]&&0!==direction[1];isResizingFromCorner!==newResizingMode&&isText&&setIsResizingFromCorner(newResizingMode),isEditMode&&pushTransform(selectedElement.id,frame)},onResizeEnd:_ref6=>{let{target}=_ref6;if(handleElementOutOfCanvas(target))return;const[editorWidth,editorHeight]=frame.resize;let properties={};if(0!==editorWidth&&0!==editorHeight){const{direction}=frame,[deltaX,deltaY]=frame.translate,newWidth=editorToDataX(editorWidth-(left+right)),newHeight=editorToDataY(editorHeight-(top+bottom));properties={width:newWidth,height:newHeight,x:selectedElement.x+editorToDataX(deltaX),y:selectedElement.y+editorToDataY(deltaY)},updateForResizeEvent&&Object.assign(properties,updateForResizeEvent(selectedElement,direction,newWidth,newHeight)),updateSelectedElements({properties})}setIsResizingFromCorner(!0),resetMoveable(target),handleFullbleedMediaAsBackground({...selectedElement,...properties})},keepRatio:lockAspectRatio,renderDirections:getRenderDirections(resizeRules),className:classnames_default()(classNames,{"visually-hide-handles":visuallyHideHandles})}};const utils_normalizeRotationDegrees=function normalizeRotationDegrees(degrees){return(degrees%360+360)%360};const useRotate=function useSingleSelectionRotate(_ref){let{selectedElement,isEditMode,pushTransform,frame,setTransformStyle,resetMoveable,throttleRotation}=_ref;const{updateSelectedElements}=(0,app.rB)((state=>({updateSelectedElements:state.actions.updateSelectedElements}))),{handleElementOutOfCanvas}=utils_useElementOutOfCanvas();return{throttleRotate:throttleRotation?30:0,onRotate:_ref3=>{let{target,beforeRotate}=_ref3;frame.rotate=utils_normalizeRotationDegrees(beforeRotate),setTransformStyle(target,frame)},onRotateEnd:_ref4=>{let{target}=_ref4;if(handleElementOutOfCanvas(target))return;const properties={rotationAngle:Math.round(frame.rotate)};updateSelectedElements({properties}),resetMoveable(target)},onRotateStart:_ref2=>{let{set}=_ref2;isEditMode&&pushTransform(selectedElement.id,frame),set(frame.rotate)}}},singleSelectionMoveable=(0,src.Gp)((function SingleSelectionMoveable(_ref,ref){let{selectedElement,targetEl,pushEvent,isEditMode,...props}=_ref;const moveable=(0,src.sO)(null),[isDragging,setIsDragging]=(0,src.eJ)(!1),nodesById=(0,app.$P)((_ref2=>{let{state}=_ref2;return state.nodesById})),getBox=(0,useUnits.Z)((_ref3=>{let{actions}=_ref3;return actions.getBox})),pushTransform=(0,transform_src.Hm)((_ref4=>{let{actions}=_ref4;return actions.pushTransform})),{zoomSetting,scrollLeft,scrollTop}=(0,app.$Y)((_ref5=>{let{state}=_ref5;return{zoomSetting:state.zoomSetting,scrollLeft:state.scrollLeft,scrollTop:state.scrollTop}})),{isBackground,isLocked,isHidden}=selectedElement,actionsEnabled=!isBackground&&!isLocked&&!isHidden,latestEvent=(0,src.sO)(),backgroundElementId=(0,app.rB)((_ref6=>{let{state}=_ref6;return state.currentPage?.elements[0]?.id})),isShiftPressed=(0,keyboard.yg)("shift");canvas_useWindowResizeHandler(moveable),(0,src.d4)((()=>{latestEvent.current=pushEvent}),[pushEvent]),(0,src.d4)((()=>{moveable.current&&moveable.current.updateRect()}),[scrollLeft,scrollTop]),utils_useUpdateSelectionRectangle(moveable,[zoomSetting]),(0,src.d4)((()=>{moveable.current&&(latestEvent.current&&targetEl.contains(latestEvent.current.target)&&actionsEnabled&&moveable.current.moveable.dragStart(latestEvent.current),moveable.current.updateRect())}),[targetEl,moveable,actionsEnabled]),(0,src.d4)((()=>{moveable.current&&moveable.current.updateRect()}));const box=getBox(selectedElement),frame=(0,src.Ye)((()=>({translate:[0,0],rotate:box.rotationAngle,resize:[0,0],updates:null})),[box.rotationAngle]),{border}=selectedElement,{left=0,right=0,top=0,bottom=0}=border||{},setTransformStyle=function(target){let newFrame=arguments.length>1&&void 0!==arguments[1]?arguments[1]:frame;frame.translate=newFrame.translate,frame.direction=newFrame.direction,frame.resize=newFrame.resize,frame.updates=newFrame.updates,frame.rotate=newFrame.rotate,target.style.transform=`translate(${frame.translate[0]}px, ${frame.translate[1]}px) rotate(${frame.rotate}deg)`,frame.resize[0]&&(target.style.width=`${frame.resize[0]}px`),frame.resize[1]&&(target.style.height=`${frame.resize[1]}px`);let frameForEl={...frame};if((frame.resize[0]||frame.resize[1])&&(0,masks_src.e5)(selectedElement)){const elWidth=frame.resize[0]-(left+right),elHeight=frame.resize[1]-(top+bottom);frameForEl={...frame,resize:[elWidth,elHeight]}}pushTransform(selectedElement.id,frameForEl)},resetMoveable=(0,src.iS)((target=>{moveable.current&&(frame.direction=[0,0],frame.translate=[0,0],frame.resize=[0,0],frame.updates=null,pushTransform(selectedElement.id,null),target.style.transform="",target.style.width="",target.style.height="",moveable.current.updateRect())}),[frame,pushTransform,selectedElement.id]),canSnap=!isEditMode,hideHandles=isDragging,classNames=classnames_default()("default-moveable",{"hide-handles":hideHandles,"type-text":"text"===selectedElement.type,immoveable:isLocked||isHidden}),_dragProps=useDrag({setIsDragging,resetMoveable,selectedElement,setTransformStyle,frame}),dragProps=isEditMode?{onDrag:()=>!1,onDragEnd:()=>!1,onDragStart:()=>!1}:_dragProps,resizeProps=useResize({resetMoveable,selectedElement,setTransformStyle,frame,isEditMode,pushTransform,classNames,forceLockRatio:isShiftPressed}),rotateProps=useRotate({selectedElement,isEditMode,pushTransform,frame,setTransformStyle,resetMoveable,throttleRotation:isShiftPressed}),otherNodes=Object.values((0,objectWithout.Z)(nodesById,[selectedElement.id,backgroundElementId])),snapProps=(0,useSnapping.Z)({otherNodes,canSnap:canSnap&&actionsEnabled,isDragging}),isResizable=actionsEnabled&&!hideHandles&&!0!==selectedElement.lockDimensions,isRotatable=actionsEnabled&&!hideHandles&&!1!==selectedElement.supportsRotation;return(0,jsx_runtime.jsx)(moveable_src.Tt,{...props,className:classNames,zIndex:0,ref:(0,src.HB)(moveable,ref),target:targetEl,edge:!0,draggable:actionsEnabled,resizable:isResizable,rotatable:isRotatable,...dragProps,...resizeProps,...rotateProps,...snapProps,origin:!1,pinchable:!0})})),LayerWithGrayout=(0,moveable_src.Ep)((0,styled_components_browser_esm.ZP)(Layer).withConfig({displayName:"editLayer__LayerWithGrayout",componentId:"sc-1j9iuj3-0"})(["background-color:",";"],(_ref=>{let{grayout,theme}=_ref;return grayout?theme.colors.opacity.overlayDark:"transparent"}))),EditPageArea=(0,moveable_src.Ep)(PageArea);function EditLayer(){const{currentPage}=(0,app.rB)((state=>({currentPage:state.state.currentPage}))),{editingElement:editingElementId,showOverflow=!0}=(0,app.$P)((_ref2=>{let{state:{editingElement,editingElementState:{showOverflow}={}}}=_ref2;return{editingElement,showOverflow}})),editingElement=editingElementId&&currentPage&&currentPage.elements.find((element=>element.id===editingElementId));return editingElement?(0,jsx_runtime.jsx)(EditLayerForElement,{element:editingElement,showOverflow}):null}function EditLayerForElement(_ref3){let{element,showOverflow}=_ref3;const ref=(0,src.sO)(null),pageAreaRef=(0,src.sO)(null),{editModeGrayout}=(0,elements_src.Do)(element.type),{isTrimMode}=(0,useVideoTrim.Z)((_ref4=>{let{state:{isTrimMode}}=_ref4;return{isTrimMode}})),{clearEditing,onMoveableMount}=(0,app.$P)((state=>({clearEditing:state.actions.clearEditing,onMoveableMount:state.state.onMoveableMount}))),focusCanvas=(0,useFocusCanvas.Z)(),[editWrapper,setEditWrapper]=(0,src.eJ)(null);(0,keyboard.Ew)(ref,{key:"esc",editable:!0},(()=>clearEditing()),[clearEditing]),(0,src.d4)((()=>()=>focusCanvas(!1)),[focusCanvas]);const moveable=(0,src.sO)(null),setRef=(0,src.I4)((moveableRef=>{moveable.current=moveableRef,onMoveableMount?.(moveableRef)}),[onMoveableMount]),onResize=(0,src.I4)((()=>{moveable.current&&moveable.current.updateRect()}),[]),{hasEditModeMoveable}=(0,elements_src.Do)(element.type);return(0,jsx_runtime.jsxs)(LayerWithGrayout,{ref,"aria-label":(0,i18n._x)("Edit layer","compound noun","web-stories"),"data-testid":"editLayer",grayout:editModeGrayout,zIndex:zIndex.wL,onPointerDown:evt=>{evt.target!==ref.current&&evt.target!==pageAreaRef.current||clearEditing()},children:[(0,jsx_runtime.jsx)(EditPageArea,{ref:pageAreaRef,fullBleedContainerLabel:(0,i18n.__)("Fullbleed area (Edit layer)","web-stories"),isControlled:!0,showOverflow,overflow:showOverflow?"visible":"hidden",children:(0,jsx_runtime.jsx)(editElement,{editWrapper:hasEditModeMoveable&&editWrapper,onResize,element,ref:setEditWrapper})}),hasEditModeMoveable&&editWrapper&&(0,jsx_runtime.jsx)(singleSelectionMoveable,{selectedElement:element,targetEl:editWrapper,isEditMode:!0,ref:setRef}),isTrimMode&&(0,jsx_runtime.jsx)(FooterArea,{showOverflow:!0,children:(0,jsx_runtime.jsx)(videoTrimmer,{})})]})}EditLayer.displayName="EditLayer",EditLayerForElement.displayName="EditLayerForElement";const editLayer=(0,src.X$)(EditLayer);var _path,_path2,prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),displayElement=__webpack_require__("./packages/story-editor/src/components/canvas/displayElement.js"),popup=__webpack_require__("./packages/design-system/src/components/popup/popup.tsx"),popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),useElementsWithLinks=__webpack_require__("./packages/story-editor/src/utils/useElementsWithLinks.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const SvgDefaultIcon=_ref=>{let{title,titleId,...props}=_ref;return react.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,_path||(_path=react.createElement("path",{fillOpacity:.1,d:"M12 0c6.6 0 12 5.4 12 12s-5.4 12-12 12S0 18.6 0 12 5.4 0 12 0z"})),_path2||(_path2=react.createElement("path",{d:"M13.8 14.6c.1.1.2.3.2.5s-.1.3-.2.5L12.3 17c-.7.7-1.7 1.1-2.7 1.1-1 0-1.9-.4-2.7-1.1-.7-.7-1.1-1.7-1.1-2.7 0-1 .4-1.9 1.1-2.7l1.5-1.5c.2 0 .3-.1.5-.1s.3.1.5.2c.1.1.2.3.2.5s-.1.4-.2.5l-1.5 1.5c-.5.5-.7 1.1-.7 1.7 0 .6.3 1.3.7 1.7.5.5 1.1.7 1.7.7s1.3-.3 1.7-.7l1.5-1.5c.3-.3.7-.3 1 0zM17 7c-.7-.7-1.7-1.1-2.7-1.1-1 0-1.9.4-2.7 1.1l-1.5 1.5c0 .1-.1.3-.1.4 0 .2.1.3.2.5.1.1.3.2.5.2s.3-.1.5-.2l1.5-1.5c.5-.5 1.1-.7 1.7-.7.6 0 1.3.3 1.7.7.5.5.7 1.1.7 1.7 0 .6-.3 1.3-.7 1.7l-1.5 1.5c-.1.1-.2.3-.2.5s.1.3.2.5c.1.1.3.2.5.2s.3-.1.5-.2l1.5-1.5c.7-.7 1.1-1.7 1.1-2.7-.1-1-.5-1.9-1.2-2.6zm-7.9 7.2c0 .2.1.3.2.5.1.1.3.2.5.2s.4-.1.5-.2l4.5-4.5c.1-.1.2-.3.2-.5s-.1-.4-.2-.5c-.3-.2-.8-.2-1 .1l-4.5 4.5c-.1.1-.2.3-.2.4z"})))},defaultIcon=(0,react.memo)(SvgDefaultIcon);var arrowBar_path;function arrowBar_extends(){return arrowBar_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},arrowBar_extends.apply(this,arguments)}const SvgArrowBar=_ref=>{let{title,titleId,...props}=_ref;return react.createElement("svg",arrowBar_extends({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 8","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,arrowBar_path||(arrowBar_path=react.createElement("path",{d:"M18 7.7c-.2 0-.5-.1-.7-.2l-7.3-4-7.3 4c-.7.4-1.6.2-2-.6-.4-.7-.1-1.6.6-2l8-4.4c.5-.2 1-.2 1.5 0l8 4.4c.7.4 1 1.3.6 2-.4.5-.9.8-1.4.8z"})))},arrowBar=(0,react.memo)(SvgArrowBar),pageAttachment_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageAttachment__Wrapper",componentId:"sc-1bseqmx-0"})(["position:absolute;display:flex;align-items:center;justify-content:flex-end;flex-direction:column;bottom:0;height:20%;width:100%;color:",";z-index:3;"],(_ref=>{let{theme}=_ref;return theme.colors.standard.white})),Guideline=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageAttachment__Guideline",componentId:"sc-1bseqmx-1"})(["mix-blend-mode:difference;position:absolute;height:1px;bottom:20%;width:100%;background-image:",";background-position:top;background-size:16px 0.5px;background-repeat:repeat-x;z-index:3;"],(_ref2=>{let{theme}=_ref2;return`linear-gradient(to right, ${theme.colors.standard.black} 50%, ${theme.colors.standard.white} 0%)`})),ArrowBar=(0,styled_components_browser_esm.ZP)(arrowBar).withConfig({displayName:"pageAttachment__ArrowBar",componentId:"sc-1bseqmx-2"})(["display:block;cursor:pointer;margin-bottom:10px;filter:drop-shadow(0px 2px 6px rgba(0,0,0,0.3));width:20px;height:8px;"]),OutlinkChip=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageAttachment__OutlinkChip",componentId:"sc-1bseqmx-3"})(["height:","px;display:flex;position:relative;padding:","px ","px;margin:0 0 20px;max-width:calc(100% - 64px);border-radius:30px;place-items:center;box-shadow:0px 4px 10px rgba(0,0,0,0.15);background:",";"],(_ref3=>{let{$factor}=_ref3;return $factor(36)}),(_ref4=>{let{$factor}=_ref4;return $factor(10)}),(_ref5=>{let{$factor}=_ref5;return $factor(6)}),(_ref6=>{let{bgColor}=_ref6;return bgColor})),TextWrapper=styled_components_browser_esm.ZP.span.withConfig({displayName:"pageAttachment__TextWrapper",componentId:"sc-1bseqmx-4"})(["font-family:Roboto,sans-serif;font-size:","px;line-height:18px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;position:relative;padding-inline-start:6px;padding-inline-end:8px;height:16px;letter-spacing:0.3px;font-weight:700;max-width:210px;color:",";"],(_ref7=>{let{$factor}=_ref7;return $factor(16)}),(_ref8=>{let{fgColor}=_ref8;return fgColor})),Tooltip=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageAttachment__Tooltip",componentId:"sc-1bseqmx-5"})(["background-color:",";color:",";width:200px;padding:8px;font-size:14px;border-radius:4px;text-align:center;"],(_ref9=>{let{theme}=_ref9;return theme.colors.standard.black}),(_ref10=>{let{theme}=_ref10;return theme.colors.standard.white})),LinkImage=styled_components_browser_esm.ZP.img.withConfig({displayName:"pageAttachment__LinkImage",componentId:"sc-1bseqmx-6"})(["height:24px;width:24px;vertical-align:middle;border-radius:50%;border:0 none;object-fit:contain;"]),spacing={x:8};const canvas_pageAttachment=function PageAttachment(_ref11){let{pageAttachment={}}=_ref11;const{displayLinkGuidelines,pageAttachmentContainer,setPageAttachmentContainer}=(0,app.$P)((state=>({displayLinkGuidelines:state.state.displayLinkGuidelines,pageAttachmentContainer:state.state.pageAttachmentContainer,setPageAttachmentContainer:state.actions.setPageAttachmentContainer}))),{dataToEditorY}=(0,useUnits.Z)((_ref12=>{let{actions:{dataToEditorY}}=_ref12;return{dataToEditorY}})),{hasInvalidLinkSelected}=(0,useElementsWithLinks.Z)(),{ctaText,url,icon,theme}=pageAttachment,bgColor=theme===constants.dZ.DARK?"#000000":"#FFFFFF",fgColor=theme===constants.dZ.DARK?"#FFFFFF":"#000000";return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(displayLinkGuidelines||hasInvalidLinkSelected)&&(0,jsx_runtime.jsx)(Guideline,{}),(0,jsx_runtime.jsx)(pageAttachment_Wrapper,{role:"presentation",ref:setPageAttachmentContainer,children:url?.length>0&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ArrowBar,{fill:bgColor}),(0,jsx_runtime.jsxs)(OutlinkChip,{bgColor,$factor:dataToEditorY,children:[icon?(0,jsx_runtime.jsx)(LinkImage,{src:icon,alt:(0,i18n.__)("Site Icon","web-stories"),decoding:"async",crossOrigin:"anonymous"}):(0,jsx_runtime.jsx)(defaultIcon,{fill:fgColor,width:dataToEditorY(24),height:dataToEditorY(24)}),(0,jsx_runtime.jsx)(TextWrapper,{fgColor,$factor:dataToEditorY,children:ctaText||(0,i18n.__)("Learn more","web-stories")})]}),pageAttachmentContainer&&hasInvalidLinkSelected&&(0,jsx_runtime.jsx)(popup.Z,{anchor:{current:pageAttachmentContainer},isOpen:!0,placement:popup_constants.ug.Left,spacing,children:(0,jsx_runtime.jsx)(Tooltip,{children:(0,i18n.__)("Links can not reside below the dashed line when a page attachment is present. Your viewers will not be able to click on the link.","web-stories")})})]})})]})};var icons_arrowBar_path;function icons_arrowBar_extends(){return icons_arrowBar_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},icons_arrowBar_extends.apply(this,arguments)}const arrowBar_SvgArrowBar=_ref=>{let{title,titleId,...props}=_ref;return react.createElement("svg",icons_arrowBar_extends({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 8","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,icons_arrowBar_path||(icons_arrowBar_path=react.createElement("path",{d:"M18 7.7c-.2 0-.5-.1-.7-.2l-7.3-4-7.3 4c-.7.4-1.6.2-2-.6-.4-.7-.1-1.6.6-2l8-4.4c.5-.2 1-.2 1.5 0l8 4.4c.7.4 1 1.3.6 2-.4.5-.9.8-1.4.8z"})))},icons_arrowBar=(0,react.memo)(arrowBar_SvgArrowBar),shoppingPageAttachment_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"shoppingPageAttachment__Wrapper",componentId:"sc-7unzl7-0"})(["position:absolute;display:flex;align-items:center;justify-content:flex-end;flex-direction:column;bottom:0;height:20%;width:100%;color:",";z-index:3;"],(_ref=>{let{theme}=_ref;return theme.colors.standard.white})),InnerWrap=styled_components_browser_esm.ZP.div.withConfig({displayName:"shoppingPageAttachment__InnerWrap",componentId:"sc-7unzl7-1"})(["position:relative;width:100%;height:100%;"]),Inner=styled_components_browser_esm.ZP.div.withConfig({displayName:"shoppingPageAttachment__Inner",componentId:"sc-7unzl7-2"})(["position:absolute;bottom:0;width:100%;",";display:flex;flex-direction:column;align-items:center;"],(_ref2=>{let{$hasGradient}=_ref2;return $hasGradient&&"background: linear-gradient(0, rgba(0, 0, 0, 0.15), transparent) !important"})),ArrowWrap=styled_components_browser_esm.ZP.div.withConfig({displayName:"shoppingPageAttachment__ArrowWrap",componentId:"sc-7unzl7-3"})(["width:","px;min-height:","px;border-radius:50%;background:",";display:flex;align-items:center;justify-content:center;"],(_ref3=>{let{$factor}=_ref3;return $factor(32)}),(_ref4=>{let{$factor}=_ref4;return $factor(32)}),(_ref5=>{let{bgColor}=_ref5;return bgColor})),shoppingPageAttachment_ArrowBar=(0,styled_components_browser_esm.ZP)(icons_arrowBar).withConfig({displayName:"shoppingPageAttachment__ArrowBar",componentId:"sc-7unzl7-4"})(["display:block;cursor:pointer;filter:drop-shadow(0px 2px 6px rgba(0,0,0,0.3));width:","px;height:","px;"],(_ref6=>{let{$factor}=_ref6;return $factor(20)}),(_ref7=>{let{$factor}=_ref7;return $factor(8)})),shoppingPageAttachment_OutlinkChip=styled_components_browser_esm.ZP.div.withConfig({displayName:"shoppingPageAttachment__OutlinkChip",componentId:"sc-7unzl7-5"})(["height:","px;display:flex;position:relative;padding:","px ","px;margin:0 0 ","px;max-width:calc(100% - 64px);border-radius:30px;place-items:center;background:",";"],(_ref8=>{let{$factor}=_ref8;return $factor(36)}),(_ref9=>{let{$factor}=_ref9;return $factor(10)}),(_ref10=>{let{$factor}=_ref10;return $factor(6)}),(_ref11=>{let{$factor}=_ref11;return $factor(20)}),(_ref12=>{let{bgColor}=_ref12;return bgColor})),shoppingPageAttachment_TextWrapper=styled_components_browser_esm.ZP.span.withConfig({displayName:"shoppingPageAttachment__TextWrapper",componentId:"sc-7unzl7-6"})(["font-family:Roboto,sans-serif;font-size:","px;line-height:18px;text-overflow:ellipsis;white-space:nowrap;position:relative;padding-inline-start:6px;padding-inline-end:8px;height:","px;letter-spacing:0.3px;font-weight:700;max-width:210px;color:",";"],(_ref13=>{let{$factor}=_ref13;return $factor(16)}),(_ref14=>{let{$factor}=_ref14;return $factor(16)}),(_ref15=>{let{fgColor}=_ref15;return fgColor}));function shoppingPageAttachment_PageAttachment(_ref16){let{ctaText,theme}=_ref16;const arrowColor=theme===constants.dZ.DARK?"#FFFFFF":"#000000",fgColor=theme===constants.dZ.DARK?"#000000":"#FFFFFF",{dataToEditorY}=(0,useUnits.Z)((_ref17=>{let{actions:{dataToEditorY}}=_ref17;return{dataToEditorY}}));return(0,jsx_runtime.jsx)(shoppingPageAttachment_Wrapper,{role:"presentation",tabIndex:-1,children:(0,jsx_runtime.jsx)(InnerWrap,{children:(0,jsx_runtime.jsxs)(Inner,{$hasGradient:theme!==constants.dZ.DARK,children:[(0,jsx_runtime.jsx)(ArrowWrap,{bgColor:fgColor,$factor:dataToEditorY,children:(0,jsx_runtime.jsx)(shoppingPageAttachment_ArrowBar,{fill:arrowColor,$factor:dataToEditorY})}),(0,jsx_runtime.jsx)(shoppingPageAttachment_OutlinkChip,{$factor:dataToEditorY,children:(0,jsx_runtime.jsx)(shoppingPageAttachment_TextWrapper,{fgColor,$factor:dataToEditorY,children:ctaText||(0,i18n.__)("Shop Now","web-stories")})})]})})})}shoppingPageAttachment_PageAttachment.displayName="PageAttachment";const shoppingPageAttachment=shoppingPageAttachment_PageAttachment;const mediaCaptions_parseTimestamp=function parseTimestamp(timestamp){const match=/^(?:(\d{2,}):)?(\d{2}):(\d{2})\.(\d{3})$/.exec(timestamp);return match?3600*(match[1]?parseInt(match[1]):0)+60*parseInt(match[2])+parseInt(match[3])+parseInt(match[4])/1e3:null},CueWrapper=styled_components_browser_esm.ZP.span.withConfig({displayName:"cue__CueWrapper",componentId:"sc-h5j1x4-0"})(["text-align:center;height:",";"],(_ref=>{let{$height}=_ref;return`${$height}px`})),CueEl=styled_components_browser_esm.ZP.span.withConfig({displayName:"cue__CueEl",componentId:"sc-h5j1x4-1"})(["color:",";"],(_ref2=>{let{$isFutureCue,theme}=_ref2;return $isFutureCue?theme.colors.fg.black:theme.colors.fg.white})),Section=styled_components_browser_esm.ZP.span.withConfig({displayName:"cue__Section",componentId:"sc-h5j1x4-2"})(["margin:0 10px 10px;padding:6px 12px;vertical-align:middle;border-radius:15px;background:rgba(11,11,11,0.6);color:rgba(255,255,255,1);display:inline-block;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;line-height:1.4;word-break:break-word;word-wrap:break-word;overflow-wrap:break-word;"]);function Cue(_ref3){let{cue,videoTime,height}=_ref3;const html=cue.getCueAsHTML();return(0,jsx_runtime.jsx)(CueWrapper,{$height:height,children:(0,jsx_runtime.jsx)(Section,{children:[...html.childNodes].map((node=>{if("timestamp"===node.target)return null;{let timestamp=null;"timestamp"===node.previousSibling?.target&&(timestamp=mediaCaptions_parseTimestamp(node.previousSibling.data));const isFutureCue=timestamp>videoTime;return node.nodeType===Node.TEXT_NODE?null!==timestamp?(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(CueEl,{$isFutureCue:isFutureCue,children:node.textContent})}):(0,jsx_runtime.jsx)(CueEl,{children:node.textContent}):null!==timestamp?(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(CueEl,{$isFutureCue:isFutureCue,dangerouslySetInnerHTML:{__html:node.innerHTML}})}):(0,jsx_runtime.jsx)(CueEl,{dangerouslySetInnerHTML:{__html:node.innerHTML}})}}))})})}Cue.displayName="Cue";const mediaCaptions_cue=Cue,Track=styled_components_browser_esm.ZP.div.withConfig({displayName:"trackRenderer__Track",componentId:"sc-7rx40r-0"})(["width:100%;height:100%;display:grid;align-content:end;font-size:",";"],(_ref=>{let{$fontSize}=_ref;return`${$fontSize}px`}));function TrackRenderer(_ref2){let{elementId,trackIndex}=_ref2;const{pageWidth,pageHeight}=(0,app.$Y)((_ref3=>{let{state:{pageWidth,pageHeight}}=_ref3;return{pageWidth,pageHeight}})),fontSize=.04*pageWidth,height=.2*pageHeight,[track,setTrack]=(0,src.eJ)(null),[videoTime,setVideoTime]=(0,src.eJ)(0),[cues,setCues]=(0,src.eJ)([]),updateCues=(0,src.I4)((()=>{const activeCues=track?.activeCues?[...track.activeCues]:[];setCues(activeCues)}),[track]);return(0,src.d4)((()=>{updateCues(),setVideoTime(0);const mediaEl=document.getElementById(elementId);if(!mediaEl)return;const mediaTrack=mediaEl.textTracks?.[trackIndex];return mediaTrack?(mediaTrack.mode="hidden",updateCues(),setTrack(mediaTrack),mediaEl.addEventListener("timeupdate",(()=>{setVideoTime(mediaEl.currentTime)})),mediaTrack.addEventListener("cuechange",updateCues),()=>{mediaTrack.removeEventListener("cuechange",updateCues)}):void 0}),[trackIndex,updateCues,elementId,pageWidth,pageHeight]),cues&&track?(0,jsx_runtime.jsx)(Track,{$fontSize:fontSize,children:cues.map(((cue,index)=>(0,jsx_runtime.jsx)(mediaCaptions_cue,{cue,videoTime,height},index)))}):null}TrackRenderer.displayName="TrackRenderer";const trackRenderer=TrackRenderer,CaptionsLayer=(0,styled_components_browser_esm.ZP)(Layer).withConfig({displayName:"mediaCaptionsLayer__CaptionsLayer",componentId:"sc-11mx67a-0"})([""]),CaptionsPageArea=(0,styled_components_browser_esm.ZP)(PageArea).withConfig({displayName:"mediaCaptionsLayer__CaptionsPageArea",componentId:"sc-11mx67a-1"})(["position:absolute;pointer-events:none;"]),CaptionsCanvas=styled_components_browser_esm.ZP.div.withConfig({displayName:"mediaCaptionsLayer__CaptionsCanvas",componentId:"sc-11mx67a-2"})(["background:transparent;border-radius:5px;position:absolute;z-index:2;transform:translateZ(0);top:0;left:0;bottom:0;right:0;cursor:default;"]);function MediaCaptionsLayer(){const{isEditing}=(0,app.$P)((_ref=>{let{state:{isEditing}}=_ref;return{isEditing}})),{currentPageId,backgroundAudio,videoElement}=(0,app.rB)((_ref2=>{let{state}=_ref2;const{selectedElements,currentPage}=state;let backgroundAudio=null,videoElement=null;if(1===selectedElements.length&&currentPage){const selectedElement=selectedElements[0],{isBackground,type,tracks}=selectedElement,{backgroundAudio:currentPageBackgroundAudio}=currentPage;isBackground&&currentPageBackgroundAudio&&currentPageBackgroundAudio?.tracks?.length>0&&(backgroundAudio=currentPageBackgroundAudio),"video"===type&&tracks?.length>0&&(videoElement=selectedElement)}return{currentPageId:currentPage?.id,backgroundAudio,videoElement}})),[mediaTrackCount,setMediaTrackCount]=(0,src.eJ)(0),[mediaElementId,setMediaElementId]=(0,src.eJ)("");return(0,src.d4)((()=>{if(setMediaTrackCount(0),setMediaElementId(""),backgroundAudio)return setMediaElementId(`page-${currentPageId}-background-audio`),void setMediaTrackCount(backgroundAudio?.tracks?.length);!isEditing&&videoElement&&(setMediaElementId(`video-${videoElement.id}`),setMediaTrackCount(videoElement.tracks.length))}),[videoElement,backgroundAudio,currentPageId,isEditing]),mediaTrackCount?(0,jsx_runtime.jsx)(CaptionsLayer,{children:(0,jsx_runtime.jsx)(CaptionsPageArea,{withSafezone:!1,showOverflow:!0,children:(0,jsx_runtime.jsx)(CaptionsCanvas,{children:Array.from({length:mediaTrackCount}).map(((_,index)=>(0,jsx_runtime.jsx)(trackRenderer,{elementId:mediaElementId,trackIndex:index},index)))})})}):null}MediaCaptionsLayer.displayName="MediaCaptionsLayer";const mediaCaptionsLayer=MediaCaptionsLayer,DisplayPageArea=(0,styled_components_browser_esm.ZP)(PageArea).withConfig({displayName:"displayLayer__DisplayPageArea",componentId:"sc-13e1aq-0"})(["position:absolute;"]);function DisplayPage(_ref){let{pageElements,editingElement}=_ref;return pageElements?pageElements.map((element=>{if(editingElement===element.id)return null;if(element.isHidden)return null;const siblingCount=pageElements.filter((_ref2=>{let{type}=_ref2;return type===element.type})).length-1;return(0,jsx_runtime.jsx)(displayElement.Z,{element,isAnimatable:!0,siblingCount},element.id)})):null}function DisplayPageAnimationController(_ref3){let{resetAnimationState}=_ref3;const{animationState,pageId}=(0,app.rB)((_ref4=>{let{state}=_ref4;return{animationState:state.animationState,pageId:state.currentPage?.id}})),WAAPIAnimationMethods=(0,animation_src.JK)((_ref5=>{let{actions}=_ref5;return actions.WAAPIAnimationMethods}));return(0,src.d4)((()=>{switch(animationState){case animation_src.pG.PlayingSelected:case animation_src.pG.Playing:return void WAAPIAnimationMethods.play();case animation_src.pG.Reset:return void WAAPIAnimationMethods.reset();case animation_src.pG.Scrubbing:case animation_src.pG.Paused:return void WAAPIAnimationMethods.pause();default:return}}),[animationState,WAAPIAnimationMethods]),(0,src.d4)((()=>resetAnimationState),[resetAnimationState,pageId]),null}function StoryAnimations(_ref6){let{children}=_ref6;const{isAnimationPlaying,currentPageAnimations,currentPageElements,selectedElements,updateAnimationState}=(0,app.rB)((_ref7=>{let{state,actions}=_ref7;return{isAnimationPlaying:state.animationState===animation_src.pG.PlayingSelected,currentPageAnimations:state.currentPage?.animations||constants.Qw,currentPageElements:state.currentPage?.elements||constants.Qw,selectedElements:state.selectedElements,updateAnimationState:actions.updateAnimationState}})),resetAnimationState=(0,src.I4)((()=>{updateAnimationState({animationState:animation_src.pG.Reset})}),[updateAnimationState]),animatedElements=(0,src.Ye)((()=>selectedElements.map((el=>el.id))),[selectedElements]);return(0,jsx_runtime.jsxs)(animation_src.bu,{animations:currentPageAnimations,elements:currentPageElements,onWAAPIFinish:resetAnimationState,selectedElementIds:isAnimationPlaying?animatedElements:constants.Qw,children:[(0,jsx_runtime.jsx)(DisplayPageAnimationController,{resetAnimationState}),children]})}function DisplayLayer(){const{backgroundColor,isBackgroundSelected,pageAttachment,shoppingAttachment,hasProducts}=(0,app.rB)((_ref8=>{let{state}=_ref8;return{hasCurrentPage:Boolean(state.currentPage),backgroundColor:state.currentPage?.backgroundColor,isBackgroundSelected:state.selectedElements?.[0]?.isBackground,pageAttachment:state.currentPage?.pageAttachment||{},shoppingAttachment:state.currentPage?.shoppingAttachment||{},hasProducts:state.currentPage?.elements?.some((_ref9=>{let{type,product}=_ref9;return type===elements_src.Yj.PRODUCT&&product?.productId}))}})),currentPageElements=(0,app.rB)((_ref10=>{let{state}=_ref10;return state.currentPage?.elements||constants.Qw})),boundingBoxTrackingRef=(0,app.l8)(app.lb.PAGE_CONTAINER),{editingElement,setPageContainer,setFullbleedContainer}=(0,app.$P)((_ref11=>{let{state:{editingElement},actions:{setPageContainer,setFullbleedContainer}}=_ref11;return{editingElement,setPageContainer,setFullbleedContainer}})),Overlay=(0,src.Ye)((()=>hasProducts?(0,jsx_runtime.jsx)(shoppingPageAttachment,{...shoppingAttachment}):(0,jsx_runtime.jsx)(canvas_pageAttachment,{pageAttachment})),[hasProducts,pageAttachment,shoppingAttachment]);return(0,jsx_runtime.jsx)(StoryAnimations,{children:(0,jsx_runtime.jsxs)(Layer,{"data-testid":"DisplayLayer",pointerEvents:"none","aria-label":(0,i18n._x)("Display layer","compound noun","web-stories"),children:[(0,jsx_runtime.jsx)(DisplayPageArea,{ref:(0,src.HB)(setPageContainer,boundingBoxTrackingRef),fullbleedRef:setFullbleedContainer,background:backgroundColor,isBackgroundSelected,fullBleedContainerLabel:(0,i18n.__)("Fullbleed area (Display layer)","web-stories"),overlay:Overlay,isControlled:!0,children:(0,jsx_runtime.jsx)(DisplayPage,{pageElements:currentPageElements,editingElement})}),(0,jsx_runtime.jsx)(mediaCaptionsLayer,{})]})})}DisplayPageAnimationController.propTypes={resetAnimationState:prop_types_default().func},StoryAnimations.displayName="StoryAnimations",DisplayLayer.displayName="DisplayLayer";const displayLayer=(0,src.X$)(DisplayLayer);var outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),useLiveRegion=__webpack_require__("./packages/design-system/src/utils/useLiveRegion.ts"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),getKeyboardMovement=__webpack_require__("./packages/design-system/src/utils/getKeyboardMovement.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),highlights=__webpack_require__("./packages/story-editor/src/app/highlights/index.ts"),useHighlights=__webpack_require__("./packages/story-editor/src/app/highlights/useHighlights.ts"),story=__webpack_require__("./packages/story-editor/src/app/story/index.ts");const utils_getLayerArrangementProps=function getLayerArrangementProps(key,shift,selectedElements,elements){if(!selectedElements||selectedElements.length>1)return{};let position=null;if("ArrowUp"===key&&(position=shift?constants.Fs.Front:constants.Fs.Forward),"ArrowDown"===key&&(position=shift?constants.Fs.Back:constants.Fs.Backward),!position)return{};const{id,groupId}=selectedElements[0],currentPosition=elements.findIndex((_ref=>{let{id:elId}=_ref;return elId===id}));if(groupId){const isLastInGroup=elements[currentPosition-1]?.groupId!==groupId,isFirstInGroup=elements[currentPosition+1]?.groupId!==groupId;if(isLastInGroup&&position===constants.Fs.Backward||isFirstInGroup&&position===constants.Fs.Forward)return{position:currentPosition,groupId:null}}else{if(elements[currentPosition-1]?.groupId&&position===constants.Fs.Backward)return{position:currentPosition,groupId:elements[currentPosition-1].groupId};if(elements[currentPosition+1]?.groupId&&position===constants.Fs.Forward)return{position:currentPosition,groupId:elements[currentPosition+1].groupId}}return{position}};var canvas=__webpack_require__("./packages/story-editor/src/app/canvas/index.ts");const canvas_useCanvasKeys=function useCanvasKeys(ref){const{selectedElementIds,selectedElements,arrangeSelection,deleteSelectedElements,duplicateElementsById,updateSelectedElements,setSelectedElementsById,currentPage,currentPageNumber,animationState,updateAnimationState,currentPageProductIds,pageElements}=(0,story.rB)((_ref=>{let{state:{selectedElementIds,selectedElements,currentPage,currentPageNumber,animationState},actions:{arrangeSelection,deleteSelectedElements,duplicateElementsById,updateSelectedElements,setSelectedElementsById,updateAnimationState}}=_ref;return{currentPage,currentPageNumber,selectedElementIds,selectedElements,arrangeSelection,deleteSelectedElements,duplicateElementsById,updateSelectedElements,setSelectedElementsById,animationState,updateAnimationState,currentPageProductIds:currentPage?.elements?.filter(elements_src.Zy.product).map((_ref2=>{let{product}=_ref2;return product?.productId})),pageElements:currentPage?.elements}})),showSnackbar=(0,useSnackbar.D)((_ref3=>{let{showSnackbar}=_ref3;return showSnackbar})),{setHighlights}=(0,useHighlights.Z)((_ref4=>{let{setHighlights}=_ref4;return{setHighlights}})),{isEditing,getNodeForElement,setEditingElement}=(0,canvas.$P)((_ref5=>{let{state:{isEditing},actions:{getNodeForElement,setEditingElement}}=_ref5;return{isEditing,getNodeForElement,setEditingElement}})),selectedElementIdsRef=(0,src.sO)(null);selectedElementIdsRef.current=selectedElementIds,(0,src.d4)((()=>{const container=ref.current;if(!container)return;const doc=container.ownerDocument;if(!doc)return;const handler=()=>{setTimeout((()=>{if(doc.activeElement===doc.body){const currentSelectedIds=selectedElementIdsRef.current,selectedFrame=1===currentSelectedIds?.length?getNodeForElement(currentSelectedIds[0]):null,sel=window.getSelection();if(""!==sel?.toString())return;selectedFrame?selectedFrame.focus({preventScroll:!0}):container.focus({preventScroll:!0})}}),300)};return doc.addEventListener("focusout",handler,!0),()=>{doc.removeEventListener("focusout",handler,!0)}}),[ref,getNodeForElement]),(0,keyboard.xb)("delete",(()=>deleteSelectedElements()),[deleteSelectedElements]),(0,keyboard.xb)({key:["mod+a"]},(()=>{if(!currentPage)return;const elementIds=currentPage.elements.map((_ref6=>{let{id}=_ref6;return id}));setSelectedElementsById({elementIds})}),[currentPage,setSelectedElementsById]),(0,keyboard.xb)({key:["up","down","left","right"],shift:!0},(_ref7=>{let{key,shiftKey}=_ref7;if(isEditing||!selectedElements?.length)return;const{isLocked}=selectedElements[0];if(elements_src.Zy.backgroundable(selectedElements[0])&&selectedElements[0].isBackground||isLocked)return;const{dx,dy}=(0,getKeyboardMovement.Z)(key,shiftKey);updateSelectedElements({properties:_ref8=>{let{x,y}=_ref8;return{x:x+dx,y:y+dy}}})}),[updateSelectedElements,isEditing,selectedElements]),(0,keyboard.xb)({key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(evt=>{const{key,shiftKey}=evt;if(evt.preventDefault(),1===selectedElements?.length&&pageElements){const{position,groupId}=utils_getLayerArrangementProps(key,shiftKey,selectedElements,pageElements);(position||groupId)&&arrangeSelection({position,groupId})}}),[arrangeSelection,selectedElements,pageElements]),(0,keyboard.xb)({key:"enter",clickable:!1},(()=>{if(1!==selectedElements.length)return;const{type,id,isLocked}=selectedElements[0],{hasEditMode,hasEditModeIfLocked}=(0,elements_src.Do)(type);!hasEditMode||!hasEditModeIfLocked&&isLocked||setEditingElement(id)}),[selectedElements,setEditingElement]);const cloneHandler=(0,src.I4)((()=>{if(0!==selectedElements.length){for(const el of selectedElements)if(elements_src.Zy.product(el)){const{product}=el,{productId,productTitle,productImages}=product;productId&&currentPageProductIds?.includes(productId)&&showSnackbar({message:(0,sprintf.Z)((0,i18n.__)('Product "%s" already exists on the page.',"web-stories"),productTitle),thumbnail:productImages?.[0]?.url?{src:productImages[0].url,alt:productImages[0].alt}:void 0})}duplicateElementsById({elementIds:selectedElements.map((element=>element.id))})}}),[duplicateElementsById,selectedElements,currentPageProductIds,showSnackbar]);(0,keyboard.xb)("clone",(()=>cloneHandler()),[cloneHandler]);const isPlaying=[animation_src.pG.Playing,animation_src.pG.PlayingSelected].includes(animationState);(0,keyboard.xb)({key:["mod+enter"]},(evt=>{evt.preventDefault(),1!==currentPageNumber&&(updateAnimationState({animationState:isPlaying?animation_src.pG.Reset:animation_src.pG.Playing}),(0,tracking_src.L9)("canvas_play_animations",{status:isPlaying?"stop":"play"}))}),[isPlaying,updateAnimationState,currentPageNumber]),(0,keyboard.xb)({key:["mod+k"]},(evt=>{evt.preventDefault(),!selectedElements.length||elements_src.Zy.backgroundable(selectedElements[0])&&selectedElements[0].isBackground||setHighlights({elements:selectedElements,highlight:highlights.$q.Link})}),[setHighlights,selectedElements])};var pagepreview=__webpack_require__("./packages/story-editor/src/components/footer/pagepreview/index.js");const ExtraPageWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"extraPages__ExtraPageWrapper",componentId:"sc-12b8j4d-0"})(["display:flex;overflow:hidden;justify-content:",";align-items:center;height:100%;"],(_ref=>{let{isPrevious}=_ref;return isPrevious?"flex-end":"flex-start"})),ExtraPageList=styled_components_browser_esm.ZP.ol.withConfig({displayName:"extraPages__ExtraPageList",componentId:"sc-12b8j4d-1"})(["display:flex;flex-direction:",";width:","px;margin:0;padding:0 ","px;gap:","px;"],(_ref2=>{let{isPrevious}=_ref2;return isPrevious?"row-reverse":"row"}),(_ref3=>{let{listWidth}=_ref3;return listWidth}),32,32),ExtraPage=styled_components_browser_esm.ZP.li.withConfig({displayName:"extraPages__ExtraPage",componentId:"sc-12b8j4d-2"})(["display:block;width:","px;height:100%;border-radius:4px;background-color:white;opacity:",";transition:opacity 0.2s ease;&:hover{opacity:1;}",""],(_ref4=>{let{extraPageWidth}=_ref4;return extraPageWidth-32}),(_ref5=>{let{$distance}=_ref5;return.6-.15*$distance}),(_ref6=>{let{$inert}=_ref6;return $inert&&"pointer-events: none;"})),ExtraPagePreview=(0,styled_components_browser_esm.ZP)(pagepreview.Z).withConfig({displayName:"extraPages__ExtraPagePreview",componentId:"sc-12b8j4d-3"})(["cursor:pointer;"]);function range(from,to){return from<to?Array.from(Array(to-from)).map(((k,v)=>v+from)):[]}function ExtraPages(_ref8){let{isPrevious=!1}=_ref8;const{currentPageIndex,pages,setCurrentPage}=(0,app.rB)((_ref9=>{let{state:{pages,currentPageIndex},actions:{setCurrentPage}}=_ref9;return{currentPageIndex,pages,setCurrentPage}})),{hasExtraPages,extraPageWidth,extraPageCount}=(0,app.$Y)((_ref10=>{let{state:{hasExtraPages,extraPageWidth,extraPageCount}}=_ref10;return{hasExtraPages,extraPageWidth,extraPageCount}})),isAnythingTransforming=(0,transform_src.Hm)((_ref11=>{let{state:{isAnythingTransforming}}=_ref11;return isAnythingTransforming})),pageCount=pages?.length;if(!pageCount)return null;const pagesToShow=function getPagesToShow(_ref7){let{isPrevious,hasExtraPages,currentPageIndex,extraPageCount,pageCount}=_ref7;if(!hasExtraPages)return[];if(isPrevious)return range(Math.max(0,currentPageIndex-extraPageCount),currentPageIndex).reverse();return range(currentPageIndex+1,Math.min(pageCount,currentPageIndex+extraPageCount+2))}({isPrevious,hasExtraPages,currentPageIndex,extraPageCount,pageCount});if(0===pagesToShow.length)return null;const listWidth=pagesToShow.length*extraPageWidth,extraPageHeight=(extraPageWidth-32)/src_constants.O1;return(0,jsx_runtime.jsx)(ExtraPageWrapper,{isPrevious,children:(0,jsx_runtime.jsx)(ExtraPageList,{isPrevious,listWidth,extraPageHeight,children:pagesToShow.map(((pageNum,index)=>{return(0,jsx_runtime.jsx)(ExtraPage,{extraPageWidth,$inert:isAnythingTransforming,$distance:index,children:(0,jsx_runtime.jsx)(ExtraPagePreview,{page:pages[pageNum],onClick:(pageId=pages[pageNum].id,()=>setCurrentPage({pageId})),"aria-label":(0,sprintf.Z)((0,i18n.__)("Go to page %s","web-stories"),pageNum+1),width:extraPageWidth-32})},pageNum);var pageId}))})})}ExtraPages.displayName="ExtraPages";const extraPages=(0,src.X$)(ExtraPages);var utils=__webpack_require__("./packages/design-system/src/components/keyboard/utils.ts"),polished_esm=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),url_src=__webpack_require__("./packages/url/src/index.ts"),external_link=__webpack_require__("./packages/design-system/src/icons/external_link.svg"),tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js"),elementLink=__webpack_require__("./packages/story-editor/src/components/elementLink/index.js");const StyledTooltip=(0,styled_components_browser_esm.ZP)(tooltip.Z).withConfig({displayName:"frame__StyledTooltip",componentId:"sc-1fjzoyw-0"})(["box-shadow:0px 6px 10px ",";align-items:center;p{display:flex;max-width:100%;}"],(_ref=>{let{theme}=_ref;return(0,polished_esm.m4)(theme.colors.standard.black,.1)})),IconWrapper=styled_components_browser_esm.ZP.span.withConfig({displayName:"frame__IconWrapper",componentId:"sc-1fjzoyw-1"})(["background-color:",";width:24px;height:24px;border-radius:50%;overflow:hidden;margin-right:8px;display:inline-block;"],(_ref2=>{let{theme}=_ref2;return theme.colors.fg.secondary})),BrandIcon=styled_components_browser_esm.ZP.img.withConfig({displayName:"frame__BrandIcon",componentId:"sc-1fjzoyw-2"})(["width:100%;height:100%;border:none;"]),LinkDesc=styled_components_browser_esm.ZP.span.withConfig({displayName:"frame__LinkDesc",componentId:"sc-1fjzoyw-3"})(["padding-top:2px;flex:1;max-width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),ExternalLink=(0,styled_components_browser_esm.ZP)(external_link.Z).withConfig({displayName:"frame__ExternalLink",componentId:"sc-1fjzoyw-4"})(["width:24px;"]);function WithLink(_ref3){let{element,active,children,anchorRef}=_ref3;const link=(0,elementLink.W)(element),tooltipContent=link?.url&&active?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[link?.icon&&(0,jsx_runtime.jsx)(IconWrapper,{children:(0,jsx_runtime.jsx)(BrandIcon,{src:link.icon,alt:(0,i18n.__)("Site Icon","web-stories"),decoding:"async",crossOrigin:"anonymous"})}),(0,jsx_runtime.jsx)(LinkDesc,{children:link.desc||(0,url_src.fs)(link.url)}),(0,jsx_runtime.jsx)(ExternalLink,{})]}):null;return(0,jsx_runtime.jsx)(StyledTooltip,{forceAnchorRef:anchorRef,placement:popup_constants.ug.Top,title:tooltipContent,children})}WithLink.displayName="WithLink";const elementLink_frame=WithLink;var pill_path;function pill_extends(){return pill_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},pill_extends.apply(this,arguments)}const SvgPill=_ref=>{let{title,titleId,...props}=_ref;return react.createElement("svg",pill_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 12","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,pill_path||(pill_path=react.createElement("path",{fill:"currentColor",d:"M11.49 5.755 6.24.505a1.16 1.16 0 0 0-.823-.338H1.334A1.17 1.17 0 0 0 .167 1.333v4.084c0 .32.128.612.344.828l5.25 5.25c.21.21.502.338.823.338.32 0 .612-.128.822-.344l4.083-4.083a1.14 1.14 0 0 0 .345-.823c0-.32-.134-.618-.345-.828ZM2.208 3.083a.874.874 0 1 1 0-1.75.874.874 0 1 1 0 1.75Z"})))},pill=(0,react.memo)(SvgPill),frame_StyledTooltip=(0,styled_components_browser_esm.ZP)(tooltip.Z).withConfig({displayName:"frame__StyledTooltip",componentId:"sc-uvs0u9-0"})(["align-items:center;p{display:flex;max-width:100%;color:#fff;font-family:'Poppins',sans-serif;font-weight:700;font-size:14px;line-height:24px;padding:0;}background-color:rgba(125,125,125,0.75);border-radius:18px;padding-inline-start:6px;padding-inline-end:12px;cursor:pointer;height:36px;"]),PillImage=styled_components_browser_esm.ZP.span.withConfig({displayName:"frame__PillImage",componentId:"sc-uvs0u9-1"})(["width:24px;height:24px;display:flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,0.6);border-radius:100%;flex-shrink:0;margin-inline-end:4px;"]);function TooltipTitle(_ref){let{productTagText}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PillImage,{children:(0,jsx_runtime.jsx)(pill,{width:14,height:14,"aria-hidden":!0})}),productTagText]})}function WithProductPill(_ref2){let{element,active,children,anchorRef}=_ref2;const{actions:{maybeEnqueueFontStyle}}=(0,app.jo)(),{locale:{locale}}=(0,app.ZR)(),elementType=element.type;if((0,src.d4)((()=>{elementType===elements_src.Yj.PRODUCT&&maybeEnqueueFontStyle([{font:{family:"Poppins",service:"fonts.google.com",weights:[700],styles:["regular"],variants:[[0,700]]},fontWeight:700}])}),[elementType,maybeEnqueueFontStyle]),elementType!==elements_src.Yj.PRODUCT)return children;const{productPrice,productPriceCurrency,productTitle}=element.product,productTagText=productPrice&&productPriceCurrency&&locale?new Intl.NumberFormat(locale,{style:"currency",currency:productPriceCurrency}).format(productPrice):productTitle;return(0,jsx_runtime.jsx)(frame_StyledTooltip,{forceAnchorRef:anchorRef,placement:popup_constants.ug.Right,hasTail:!1,title:active?(0,jsx_runtime.jsx)(TooltipTitle,{productTagText}):null,children})}WithProductPill.displayName="WithProductPill";const shopping_frame=WithProductPill,utils_useDoubleClick=function(onSingleClick,onDoubleClick){let ms=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;const[target,setTarget]=(0,src.eJ)(null),[lastEvent,setLastEvent]=(0,src.eJ)(null),getHandler=(0,src.I4)((newTarget=>evt=>{if(evt.stopPropagation(),target!==newTarget)return target&&onSingleClick(evt,target),setTarget(newTarget),void setLastEvent(evt);onDoubleClick(evt,target),setTarget(null)}),[onSingleClick,onDoubleClick,target]);return(0,src.d4)((()=>{if(!target)return;const int=setTimeout((()=>{setTarget(null),lastEvent&&target&&onSingleClick(lastEvent,target)}),ms);return()=>{clearTimeout(int)}}),[target,lastEvent,onSingleClick,ms]),getHandler};var usePerformanceTracking=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),editLayerFocusManager=__webpack_require__("./packages/story-editor/src/components/canvas/editLayerFocusManager/index.js");const frameElement_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"frameElement__Wrapper",componentId:"sc-80q0sm-0"})([""," "," "," outline:1px solid transparent;transition:outline-color 0.5s;&:focus,&:active{outline-color:",";}"," ",""],element_library_src.Q_,element_library_src.WG,element_library_src.h1,(_ref=>{let{theme,hasMask}=_ref;return hasMask?"transparent":theme.colors.border.selection}),(_ref2=>{let{isLocked,hasMask,theme}=_ref2;return!isLocked&&!hasMask&&`\n    &:hover {\n      outline-color: ${theme.colors.border.selection};\n    }\n  `}),(_ref3=>{let{isClickable}=_ref3;return!isClickable&&"pointer-events: none;"})),EmptyFrame=styled_components_browser_esm.ZP.div.withConfig({displayName:"frameElement__EmptyFrame",componentId:"sc-80q0sm-1"})(["position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"]),FRAME_ELEMENT_MESSAGE=(0,sprintf.Z)((0,i18n.__)("To exit the canvas area, press Escape. Press Tab to move to the next group or element. To enter floating menu, press %s.","web-stories"),(0,utils.U2)("ctrl+alt+p"));function FrameElement(_ref4){let{id}=_ref4;const speak=(0,useLiveRegion.Z)(),{enterFocusGroup,setFocusGroupCleanup}=(0,editLayerFocusManager.b0)((_ref5=>{let{enterFocusGroup,setFocusGroupCleanup}=_ref5;return{enterFocusGroup,setFocusGroupCleanup}})),[isTransforming,setIsTransforming]=(0,src.eJ)(!1),focusGroupRef=(0,editLayerFocusManager._n)(editLayerFocusManager.HL.ELEMENT_SELECTION),{setNodeForElement,handleSelectElement,isEditing,setEditingElement,setEditingElementWithState}=(0,app.$P)((_ref6=>{let{state,actions}=_ref6;return{setNodeForElement:actions.setNodeForElement,handleSelectElement:actions.handleSelectElement,isEditing:state.isEditing,setEditingElement:actions.setEditingElement,setEditingElementWithState:actions.setEditingElementWithState}})),{isSelected,isOnlySelectedElement,isActive,isBackground,element}=(0,app.rB)((_ref7=>{let{state}=_ref7;const isSelected=state.selectedElementIds.includes(id),isOnlySelectedElement=isSelected&&1===state.selectedElementIds.length,isActive=isOnlySelectedElement&&!isTransforming&&!isEditing;return{isSelected,isBackground:state.currentPage?.elements[0].id===id,element:state.currentPage?.elements.find((el=>el.id===id)),isOnlySelectedElement,isActive}})),{type,flip,isLocked,isHidden}=element,isClickable=(!isLocked||isSelected)&&!isHidden,{Frame,isMaskable,Controls}=(0,elements_src.Do)(type),elementRef=(0,src.sO)(),combinedFocusGroupRef=(0,src.HB)(elementRef,focusGroupRef),[hovering,setHovering]=(0,src.eJ)(!1),{isRTL,styleConstants:{topOffset}={}}=(0,app.ZR)(),{draggingResource,activeDropTargetId,isDropSource,registerDropTarget,unregisterDropTarget}=(0,app.HG)((_ref8=>{let{state:{draggingResource,activeDropTargetId},actions:{isDropSource,registerDropTarget,unregisterDropTarget}}=_ref8;return{draggingResource,activeDropTargetId,isDropSource,registerDropTarget,unregisterDropTarget}})),isLinkActive=(0,app.Hm)((_ref9=>{let{state}=_ref9;return!isSelected&&hovering&&!state.isAnythingTransforming}))&&!isLocked,getBoxWithBorder=(0,useUnits.Z)((_ref10=>{let{actions}=_ref10;return actions.getBoxWithBorder}));(0,src.bt)((()=>{setNodeForElement(id,elementRef.current)}),[id,setNodeForElement]);const boxWithBorder=getBoxWithBorder(element);(0,transform_src.YB)(id,(transform=>{const target=elementRef.current;void 0!==transform?.dropTargets?.hover&&(target.style.opacity=transform.dropTargets.hover?0:1),setIsTransforming(null!==transform)}));const{isMedia}=(0,elements_src.Do)(type),handleMediaDoubleClick=(0,src.I4)((evt=>{isSelected||handleSelectElement(id,evt),setEditingElement(id)}),[id,setEditingElement,handleSelectElement,isSelected]),handleMediaClick=utils_useDoubleClick(noop.Z,handleMediaDoubleClick),handleFocus=(0,src.I4)((evt=>{isSelected||handleSelectElement(id,evt),isBackground||speak(FRAME_ELEMENT_MESSAGE)}),[handleSelectElement,id,isBackground,isSelected,speak]),{clearTransforms}=(0,app.Hm)((state=>({clearTransforms:state.actions.clearTransforms}))),handleMouseDown=(0,src.I4)((evt=>{isSelected||(handleSelectElement(id,evt),clearTransforms()),elementRef.current.focus({preventScroll:!0}),isBackground||evt.stopPropagation()}),[handleSelectElement,id,isBackground,isSelected,clearTransforms]);(0,usePerformanceTracking.Z)({node:elementRef.current,eventData:{...constants.Iy.SELECT_ELEMENT,label:element.type},eventType:"pointerdown"}),(0,keyboard.Ew)(elementRef,{key:["ctrl+alt+p"]},(()=>{enterFocusGroup({groupId:editLayerFocusManager.HL.EDIT_ELEMENT})}),[enterFocusGroup]),(0,src.d4)((()=>{isSelected&&setFocusGroupCleanup({groupId:editLayerFocusManager.HL.EDIT_ELEMENT,cleanup:()=>elementRef.current?.focus()})}),[setFocusGroupCleanup,isSelected]);const layerName=(0,elements_src.Ph)(element),elementLabel=element.isLocked?(0,sprintf.Z)((0,i18n.__)("Locked element: %s","web-stories"),layerName):(0,sprintf.Z)((0,i18n.__)("Element: %s","web-stories"),layerName);return(0,jsx_runtime.jsx)(shopping_frame,{element,active:isLinkActive,anchorRef:elementRef,children:(0,jsx_runtime.jsxs)(elementLink_frame,{element,active:isLinkActive,anchorRef:elementRef,children:[Controls&&(0,jsx_runtime.jsx)(Controls,{isTransforming,box:boxWithBorder,elementRef,element,isRTL,topOffset,isActive}),(0,jsx_runtime.jsx)(frameElement_Wrapper,{ref:combinedFocusGroupRef,"data-element-id":id,...boxWithBorder,tabIndex:-1,role:"button","aria-label":elementLabel,hasMask:isMaskable,isClickable,"data-testid":"frameElement",onMouseDown:handleMouseDown,onFocus:handleFocus,onPointerEnter:()=>setHovering(!0),onPointerLeave:()=>setHovering(!1),onClick:isMedia?handleMediaClick(id):null,children:(0,jsx_runtime.jsx)(masks_src.xp,{element,fill:!0,flip,draggingResource,activeDropTargetId,isDropSource,registerDropTarget,unregisterDropTarget,isSelected,children:Frame?(0,jsx_runtime.jsx)(Frame,{wrapperRef:elementRef,element,box:boxWithBorder,isOnlySelectedElement,setEditingElementWithState}):(0,jsx_runtime.jsx)(EmptyFrame,{})})})]})})}FrameElement.displayName="FrameElement";const frameElement=(0,src.X$)(FrameElement);__webpack_require__("./node_modules/core-js/modules/es.array.push.js");const multiSelectionMoveable_useDrag=function useMultiSelectionDrag(_ref){let{targetList,frames,setTransformStyle,onGroupEventStart,onGroupEventEnd,isDragging,setIsDragging}=_ref;const{draggingResource}=(0,dropTargets.H)((_ref2=>{let{state:{draggingResource}}=_ref2;return{draggingResource}})),{nodesById,handleSelectElement}=(0,app.$P)((_ref3=>{let{state:{nodesById},actions:{handleSelectElement}}=_ref3;return{nodesById,handleSelectElement}})),eventTracker=(0,src.sO)({}),hideHandles=isDragging||Boolean(draggingResource);return{onDragGroup:_ref4=>{let{events}=_ref4;events.forEach(((_ref5,i)=>{let{target,beforeTranslate}=_ref5;const sFrame=frames[i],{element}=targetList[i];sFrame.translate=beforeTranslate,setTransformStyle(element,target,sFrame)}))},onDragGroupEnd:_ref7=>{let{targets,inputEvent}=_ref7;setIsDragging(!1),(inputEvent=>{if((0,moveable_src.Kv)(eventTracker.current,inputEvent))return!1;const clickedElement=Object.keys(nodesById).find((id=>nodesById[id].contains(inputEvent.target)));return clickedElement&&setTimeout((()=>{handleSelectElement(clickedElement,inputEvent)}),0),!0})(inputEvent)||onGroupEventEnd({targets})},onDragGroupStart:_ref6=>{let{events,inputEvent}=_ref6;(evt=>{const{timeStamp,clientX,clientY}=evt;eventTracker.current={timeStamp,clientX,clientY}})(inputEvent),isDragging||setIsDragging(!0),onGroupEventStart({events,isDrag:!0})},className:"default-moveable "+(hideHandles?"hide-handles":""),resizable:!hideHandles,rotatable:!hideHandles}};const multiSelectionMoveable_useResize=function useResize_useResize(_ref){let{onGroupEventEnd,targetList,setTransformStyle,frames}=_ref;const{editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}=(0,useUnits.Z)((state=>({editorToDataX:state.actions.editorToDataX,editorToDataY:state.actions.editorToDataY,dataToEditorY:state.actions.dataToEditorY,dataToEditorX:state.actions.dataToEditorX})));return{onResizeGroup:_ref3=>{let{events}=_ref3;events.forEach(((_ref4,i)=>{let{target,direction,width,height,drag}=_ref4;const sFrame=frames[i],{element,updateForResizeEvent}=targetList[i],{border,type}=element,{resizeRules}=(0,elements_src.Do)(type),minWidth=dataToEditorX(resizeRules.minWidth),minHeight=dataToEditorY(resizeRules.minHeight),{left=0,right=0,top=0,bottom=0}=border||{};let newWidth=width-(left+right),newHeight=height-(top+bottom);const aspectRatio=element.width/element.height;newWidth<minWidth&&(newWidth=minWidth,newHeight=newWidth/aspectRatio),newHeight<minHeight&&(newHeight=minHeight,newWidth=minHeight*aspectRatio);let updates=null;updateForResizeEvent&&(updates=updateForResizeEvent(element,direction,editorToDataX(newWidth),editorToDataY(newHeight))),updates&&updates.height&&(newHeight=dataToEditorY(updates.height));const frameWidth=newWidth+left+right,frameHeight=newHeight+top+bottom;target.style.width=`${frameWidth}px`,target.style.height=`${frameHeight}px`,sFrame.direction=direction,sFrame.resize=[frameWidth,frameHeight],sFrame.translate=drag.beforeTranslate,sFrame.updates=updates,setTransformStyle(element,target,sFrame)}))},onResizeGroupStart:_ref2=>{let{events}=_ref2;events.forEach(((ev,i)=>{const frame=frames[i];ev.setOrigin(["%","%"]),ev.dragStart&&ev.dragStart.set(frame.translate)}))},onResizeGroupEnd:_ref5=>{let{targets}=_ref5;onGroupEventEnd({targets,isResize:!0})}}};const multiSelectionMoveable_useRotate=function useRotate_useRotate(_ref){let{onGroupEventStart,setTransformStyle,onGroupEventEnd,targetList,frames}=_ref;return{onRotateGroup:_ref3=>{let{events}=_ref3;events.forEach(((_ref4,i)=>{let{target,beforeRotate,drag}=_ref4;const sFrame=frames[i],{element}=targetList[i];sFrame.rotate=utils_normalizeRotationDegrees(beforeRotate),sFrame.translate=drag.beforeTranslate,setTransformStyle(element,target,sFrame)}))},onRotateGroupEnd:_ref5=>{let{targets}=_ref5;onGroupEventEnd({targets,isRotate:!0})},onRotateGroupStart:_ref2=>{let{events}=_ref2;onGroupEventStart({events,isRotate:!0})},throttleRotate:(0,keyboard.yg)("shift")?30:0}},CORNER_HANDLES=["nw","ne","sw","se"],multiSelectionMoveable=(0,src.Gp)((function MultiSelectionMoveable(_ref,ref){let{selectedElements,...props}=_ref;const moveable=(0,src.sO)(),[isDragging,setIsDragging]=(0,src.eJ)(!1),isAnyLayerLocked=selectedElements.some((el=>el.isLocked)),actionsEnabled=!isAnyLayerLocked,{updateElementsById,deleteElementsById,backgroundElement}=(0,app.rB)((state=>({updateElementsById:state.actions.updateElementsById,deleteElementsById:state.actions.deleteElementsById,backgroundElement:state.state.currentPage.elements[0]??{}}))),{nodesById,fullbleedContainer}=(0,app.$P)((_ref2=>{let{state:{nodesById,fullbleedContainer}}=_ref2;return{fullbleedContainer,nodesById}})),{editorToDataX,editorToDataY}=(0,useUnits.Z)((state=>({editorToDataX:state.actions.editorToDataX,editorToDataY:state.actions.editorToDataY}))),{zoomSetting,scrollLeft,scrollTop}=(0,app.$Y)((_ref3=>{let{state:{zoomSetting,scrollLeft,scrollTop}}=_ref3;return{zoomSetting,scrollLeft,scrollTop}})),{actions:{pushTransform}}=(0,transform_src.Hm)();canvas_useWindowResizeHandler(moveable),(0,src.d4)((()=>{moveable.current&&moveable.current.updateRect()}),[selectedElements,moveable,nodesById,scrollLeft,scrollTop]),utils_useUpdateSelectionRectangle(moveable,[zoomSetting]);const targetList=selectedElements.map((element=>({element,node:nodesById[element.id],updateForResizeEvent:(0,elements_src.Do)(element.type).updateForResizeEvent}))),setTransformStyle=(element,target,frame)=>{const{id,border}=element;target.style.transform=`translate(${frame.translate[0]}px, ${frame.translate[1]}px) rotate(${frame.rotate}deg)`;const{left=0,right=0,top=0,bottom=0}=border||{};let frameForEl={...frame};if((frame.resize[0]||frame.resize[1])&&(0,masks_src.e5)(element)){const elWidth=frame.resize[0]-(left+right),elHeight=frame.resize[1]-(top+bottom);frameForEl={...frame,resize:[elWidth,elHeight]}}pushTransform(id,frameForEl)},frames=targetList?targetList.map((_ref4=>{let{element}=_ref4;return{translate:[0,0],rotate:element.rotationAngle,direction:[0,0],resize:[0,0],updates:null}})):[],onGroupEventStart=_ref6=>{let{events,isDrag,isRotate}=_ref6;events.forEach(((ev,i)=>{const sFrame=frames[i];isDrag?ev.set(sFrame.translate):isRotate&&ev.set(sFrame.rotate)}))},onGroupEventEnd=_ref7=>{let{targets,isRotate,isResize}=_ref7;const updates={},toRemove=[];targets.forEach(((target,i)=>{const{element,updateForResizeEvent}=targetList[i];if((0,isTargetOutOfContainer.Z)(target,fullbleedContainer))return void toRemove.push(element.id);const frame=frames[i],{direction}=frame,roundToZero=num=>Math.abs(num)<=1?0:num,properties={x:roundToZero(element.x+editorToDataX(frame.translate[0])),y:roundToZero(element.y+editorToDataY(frame.translate[1]))};isRotate&&(properties.rotationAngle=frame.rotate);const[editorWidth,editorHeight]=frame.resize;if(isResize&&(0!==editorWidth&&0!==editorHeight)){const{border}=element,{left=0,right=0,top=0,bottom=0}=border||{},newWidth=editorToDataX(editorWidth-(left+right)),newHeight=editorToDataY(editorHeight-(top+bottom));properties.width=newWidth,properties.height=newHeight,updateForResizeEvent&&Object.assign(properties,updateForResizeEvent(element,direction,newWidth,newHeight))}updates[element.id]=properties})),updateElementsById({elementIds:Object.keys(updates),properties:currentProperties=>updates[currentProperties.id]}),toRemove.length>0&&deleteElementsById({elementIds:toRemove}),targetList.forEach(((_ref5,i)=>{let{element,node}=_ref5;frames[i].direction=[0,0],frames[i].translate=[0,0],frames[i].resize=[0,0],frames[i].updates=null,node.style.transform="",node.style.width="",node.style.height="",pushTransform(element.id,null)})),moveable.current&&moveable.current.updateRect()},otherNodes=Object.values((0,objectWithout.Z)(nodesById,[...selectedElements.map((element=>element.id)),backgroundElement.id])),snapProps=(0,useSnapping.Z)({canSnap:!0,otherNodes}),dragProps=multiSelectionMoveable_useDrag({targetList,frames,setTransformStyle,onGroupEventStart,onGroupEventEnd,isDragging,setIsDragging}),resizeProps=multiSelectionMoveable_useResize({onGroupEventEnd,targetList,setTransformStyle,frames}),rotateProps=multiSelectionMoveable_useRotate({onGroupEventStart,setTransformStyle,onGroupEventEnd,targetList,frames}),combinedRef=(0,src.HB)(moveable,ref);if(targetList.some((_ref8=>{let{node}=_ref8;return void 0===node})))return null;const classNames=classnames_default()("default-moveable",{"hide-handles":isDragging,immoveable:isAnyLayerLocked});return(0,jsx_runtime.jsx)(moveable_src.Tt,{...props,className:classNames,ref:combinedRef,zIndex:0,target:targetList.map((_ref9=>{let{node}=_ref9;return node})),renderDirections:CORNER_HANDLES,...dragProps,draggable:actionsEnabled,resizable:actionsEnabled,rotatable:actionsEnabled,...rotateProps,...resizeProps,...snapProps})}));function Selection(props){const isBackground=(0,app.rB)((_ref=>{let{state}=_ref;return state.selectedElements[0]?.id===state.currentPage?.elements?.[0]?.id})),{selectedElements,isAnimating}=(0,app.rB)((state=>({selectedElements:state.state.selectedElements,isAnimating:[animation_src.pG.Playing,animation_src.pG.PlayingSelected,animation_src.pG.Scrubbing].includes(state.state.animationState)}))),{editingElement,lastSelectionEvent,nodesById,onMoveableMount}=(0,app.$P)((_ref2=>{let{state:{editingElement,lastSelectionEvent,nodesById,onMoveableMount}}=_ref2;return{editingElement,lastSelectionEvent,nodesById,onMoveableMount}}));if(0===selectedElements.length)return null;if(isBackground)return null;const isVideoPlaceholder=selectedElements[0]?.resource?.isPlaceholder;if(isVideoPlaceholder)return null;if(editingElement||isAnimating)return null;if(1===selectedElements.length){const selectedElement=selectedElements[0],target=nodesById[selectedElement.id];return target?(0,jsx_runtime.jsx)(singleSelectionMoveable,{selectedElement,targetEl:target,pushEvent:lastSelectionEvent,...props,...onMoveableMount&&{ref:onMoveableMount}}):null}return(0,jsx_runtime.jsx)(multiSelectionMoveable,{selectedElements,...props,...onMoveableMount&&{ref:onMoveableMount}})}Selection.displayName="Selection";const selection=Selection;var arrow_left_large=__webpack_require__("./packages/design-system/src/icons/arrow_left_large.svg");const pagenav_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"pagenav__Wrapper",componentId:"sc-j8q0gt-0"})(["display:flex;align-items:center;color:",";& > *{pointer-events:initial;}"],(_ref=>{let{theme}=_ref;return theme.colors.fg.white})),FlippableArrow=(0,styled_components_browser_esm.ZP)(arrow_left_large.Z).withConfig({displayName:"pagenav__FlippableArrow",componentId:"sc-j8q0gt-1"})(["transform:rotate(","turn);"],(_ref2=>{let{$isLeft}=_ref2;return $isLeft?0:.5}));function PageNav(_ref3){let{isNext=!0}=_ref3;const{pages,currentPageIndex,setCurrentPage}=(0,app.rB)((_ref4=>{let{state:{pages,currentPageIndex},actions:{setCurrentPage}}=_ref4;return{pages,currentPageIndex,setCurrentPage}})),{isRTL}=(0,app.ZR)(),buttonRef=(0,src.sO)(null),cancelMouseDown=(0,src.I4)((evt=>evt.stopPropagation()),[]),handleClick=(0,src.I4)((()=>{const newPage=isNext?pages[currentPageIndex+1]:pages[currentPageIndex-1];newPage&&setCurrentPage({pageId:newPage.id})}),[setCurrentPage,currentPageIndex,isNext,pages]),{hasPageNavigation}=(0,app.$Y)((_ref5=>{let{state:{hasPageNavigation}}=_ref5;return{hasPageNavigation}}));if((0,usePerformanceTracking.Z)({node:buttonRef.current,eventData:constants.Iy.PAGE_NAVIGATION}),!hasPageNavigation)return!1;const displayNav=isNext&&currentPageIndex<pages.length-1||!isNext&&currentPageIndex>0,isLeft=isRTL===isNext;return(0,jsx_runtime.jsx)(pagenav_Wrapper,{children:(0,jsx_runtime.jsx)(button_button.z,{ref:buttonRef,variant:button_constants.Wu.Square,type:button_constants.L$.Tertiary,size:button_constants.qE.Medium,"aria-disabled":!displayNav,"aria-label":isNext?(0,i18n.__)("Next Page","web-stories"):(0,i18n.__)("Previous Page","web-stories"),onClick:handleClick,onMouseDown:cancelMouseDown,children:(0,jsx_runtime.jsx)(FlippableArrow,{$isLeft:isLeft})})})}PageNav.displayName="PageNav";const pagenav=PageNav,FramesPageArea=(0,styled_components_browser_esm.ZP)(PageArea).withConfig({displayName:"framesLayer__FramesPageArea",componentId:"sc-5ltl4w-0"})(["pointer-events:initial;"]),marginRatio=constants.sk/src_constants.JN*100,FocusContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"framesLayer__FocusContainer",componentId:"sc-5ltl4w-1"})(["grid-row:2 / -1;grid-column:1 / -1;margin:5px;",";"],outline.L),FOCUS_CONTAINER_MESSAGE=(0,i18n.__)("Canvas Area. To navigate into the page, press Enter.","web-stories"),framesLayer_FRAME_ELEMENT_MESSAGE=(0,i18n.__)("To exit the canvas area, press Escape. Press Tab to move to the next group or element.","web-stories"),DesignSpaceGuidelineBorder=styled_components_browser_esm.ZP.div.withConfig({displayName:"framesLayer__DesignSpaceGuidelineBorder",componentId:"sc-5ltl4w-2"})(["border:1px solid ",";left:","%;right:","%;top:0;bottom:0;position:absolute;pointer-events:none;z-index:1;visibility:",";"],(_ref=>{let{theme}=_ref;return theme.colors.border.negativePress}),marginRatio,marginRatio,(_ref2=>{let{isVisible}=_ref2;return isVisible?"visible":"hidden"}));function DesignSpaceGuideline(){const setDesignSpaceGuideline=(0,app.$P)((_ref3=>{let{actions}=_ref3;return actions.setDesignSpaceGuideline})),{isAnythingTransforming}=(0,app.Hm)((_ref4=>{let{state}=_ref4;return{isAnythingTransforming:state.isAnythingTransforming}}));return(0,jsx_runtime.jsx)(DesignSpaceGuidelineBorder,{ref:setDesignSpaceGuideline,isVisible:isAnythingTransforming})}function FramesNavAndSelection(_ref5){let{children}=_ref5;const framesLayerRef=(0,src.sO)(null),onOpenMenu=(0,app.LG)((state=>state.onOpenMenu));return(0,keyboard.Ew)(framesLayerRef,"mod+alt+shift+m",(evt=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"tab"})),onOpenMenu(evt)})),(0,jsx_runtime.jsxs)(Layer,{ref:framesLayerRef,"data-testid":"FramesLayer",pointerEvents:"initial",tabIndex:"-1","aria-label":(0,i18n.__)("Frames layer","web-stories"),children:[children,(0,jsx_runtime.jsx)(PageBeforeArea,{children:(0,jsx_runtime.jsx)(extraPages,{isPrevious:!0})}),(0,jsx_runtime.jsx)(PageAfterArea,{children:(0,jsx_runtime.jsx)(extraPages,{})}),(0,jsx_runtime.jsx)(NavPrevArea,{children:(0,jsx_runtime.jsx)(pagenav,{isNext:!1})}),(0,jsx_runtime.jsx)(NavNextArea,{children:(0,jsx_runtime.jsx)(pagenav,{})}),(0,jsx_runtime.jsx)(selection,{onContextMenu:onOpenMenu})]})}function FrameElements(){const elementIds=(0,app.rB)((_ref6=>{let{state}=_ref6;return state.currentPage?.elements?.map((el=>el.id))||constants.Qw})),isAnimating=(0,app.rB)((_ref7=>{let{state}=_ref7;return[animation_src.pG.Playing,animation_src.pG.Scrubbing].includes(state.animationState)})),onOpenMenu=(0,app.LG)((state=>state.onOpenMenu)),{setScrollOffset}=(0,app.$Y)((_ref8=>{let{actions:{setScrollOffset}}=_ref8;return{setScrollOffset}})),onScroll=(0,src.I4)((evt=>setScrollOffset({left:evt.target.scrollLeft,top:evt.target.scrollTop})),[setScrollOffset]);return!isAnimating&&(0,jsx_runtime.jsxs)(FramesPageArea,{fullBleedContainerLabel:(0,i18n.__)("Fullbleed area (Frames layer)","web-stories"),onContextMenu:onOpenMenu,onScroll,children:[elementIds.map((id=>(0,jsx_runtime.jsx)(frameElement,{id},id))),(0,jsx_runtime.jsx)(DesignSpaceGuideline,{})]})}function FramesLayer(){const canvasRef=(0,src.sO)(),speak=(0,useLiveRegion.Z)(),{enterFocusGroup,setFocusGroupCleanup}=(0,editLayerFocusManager.b0)((_ref9=>{let{enterFocusGroup,setFocusGroupCleanup}=_ref9;return{enterFocusGroup,setFocusGroupCleanup}}));return(0,keyboard.xb)({key:"mod+option+2",editable:!0},(()=>{enterFocusGroup({groupId:editLayerFocusManager.HL.ELEMENT_SELECTION})}),[enterFocusGroup]),canvas_useCanvasKeys(canvasRef),(0,keyboard.Ew)(canvasRef,{key:["enter"]},(()=>{enterFocusGroup({groupId:editLayerFocusManager.HL.ELEMENT_SELECTION}),speak(framesLayer_FRAME_ELEMENT_MESSAGE)}),[enterFocusGroup,speak]),(0,react.useEffect)((()=>{setFocusGroupCleanup({groupId:editLayerFocusManager.HL.ELEMENT_SELECTION,cleanup:()=>canvasRef.current?.focus()})}),[setFocusGroupCleanup]),(0,jsx_runtime.jsxs)(FramesNavAndSelection,{children:[(0,jsx_runtime.jsx)(FocusContainer,{role:"region","data-testid":"canvas-focus-container",ref:canvasRef,"aria-label":FOCUS_CONTAINER_MESSAGE,tabIndex:0}),(0,jsx_runtime.jsx)(FrameElements,{})]})}DesignSpaceGuideline.displayName="DesignSpaceGuideline",FramesNavAndSelection.displayName="FramesNavAndSelection",FramesLayer.displayName="FramesLayer";const framesLayer=(0,src.X$)(FramesLayer);var checklist=__webpack_require__("./packages/story-editor/src/components/checklist/index.js"),keyboardShortcutsMenuContext=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/keyboardShortcutsMenuContext/index.ts"),CSSTransition=__webpack_require__("./node_modules/react-transition-group/esm/CSSTransition.js"),arrow_left=__webpack_require__("./packages/design-system/src/icons/arrow_left.svg");const context=(0,src.kr)({state:{pageThumbWidth:0,pageThumbHeight:0,pageThumbMargin:0,carouselWidth:0,hasOverflow:!1,pages:[],pageIds:[],numPages:0,currentPageId:null,canScrollBack:!1,canScrollForward:!1,showSkeleton:!1},actions:{scrollBack:noop.Z,scrollForward:noop.Z,clickPage:noop.Z,rearrangePages:noop.Z,setListRef:noop.Z,setPageRef:noop.Z}});const carouselContext_useCarousel=function useCarousel(){let selector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:src.yR;return(0,src.Sz)(context,selector)};var idleCallback=__webpack_require__("./packages/story-editor/src/utils/idleCallback.ts");const carouselContext_useCarouselSizing=function useCarouselSizing(_ref){let{availableSpace,numPages}=_ref;return(0,src.Ye)((()=>{const isWideCarousel=availableSpace>=400,spaceForCarousel=availableSpace-2*NAVIGATION_BUTTON_GUTTER,pageThumbWidth=isWideCarousel?45:36,pageThumbHeight=isWideCarousel?80:64,pageAndMargin=pageThumbWidth+16,showablePages=Math.floor((spaceForCarousel-16)/pageAndMargin),hasOverflow=showablePages<numPages;return{pageThumbWidth,pageThumbHeight,pageThumbMargin:16,carouselWidth:Math.min(showablePages,numPages)*(pageThumbWidth+16)+16,showablePages,hasOverflow}}),[availableSpace,numPages])};var config=__webpack_require__("./packages/story-editor/src/app/config/index.ts");const carouselContext_useCarouselScroll=function useCarouselScroll(_ref){let{listElement,carouselWidth,hasOverflow,showablePages,pageThumbWidth,pageThumbMargin}=_ref;const[ratio,setRatio]=(0,src.eJ)(0),{isRTL}=(0,config.ZR)(),{carouselState}=(0,layout.$)((_ref2=>{let{state:{carouselState}}=_ref2;return{carouselState}})),{currentPageIndex}=(0,story.rB)((_ref3=>{let{state:{currentPageId,pages}}=_ref3;return{currentPageIndex:pages.findIndex((_ref4=>{let{id}=_ref4;return id===currentPageId}))}})),scroll=(0,src.I4)((offset=>{listElement&&(isRTL&&(offset*=-1),listElement.scrollBy?listElement.scrollBy({left:offset,behavior:"smooth"}):listElement.scrollLeft+=offset)}),[listElement,isRTL]),scrollByPx=carouselWidth,canScrollBack=hasOverflow&&!(0===ratio),canScrollForward=hasOverflow&&!(isRTL?-1===ratio:1===ratio),scrollForward=(0,src.I4)((()=>scroll(scrollByPx)),[scroll,scrollByPx]),scrollBack=(0,src.I4)((()=>scroll(-scrollByPx)),[scroll,scrollByPx]);(0,src.bt)((()=>{if(!hasOverflow||!listElement)return;const handleScroll=()=>{const{offsetWidth,scrollLeft,scrollWidth}=listElement;setRatio(scrollLeft/(scrollWidth-offsetWidth))};return listElement.addEventListener("scroll",handleScroll,{passive:!0}),()=>listElement.removeEventListener("scroll",handleScroll)}),[listElement,hasOverflow]);const getOffsetFromIndex=(0,src.I4)((index=>(pageThumbWidth+pageThumbMargin)*index),[pageThumbWidth,pageThumbMargin]),firstScroll=(0,src.sO)(!0);return(0,src.d4)((()=>{carouselState===constants.bh.Closed&&(firstScroll.current=!0)}),[carouselState]),(0,src.bt)((()=>{if(!hasOverflow||!listElement)return;const{scrollLeft}=listElement,minVisiblePageIndex=Math.max(0,currentPageIndex-showablePages+1),maxVisiblePageIndex=currentPageIndex,minOffset=getOffsetFromIndex(minVisiblePageIndex),maxOffset=getOffsetFromIndex(maxVisiblePageIndex);if(scrollLeft>=minOffset&&scrollLeft<=maxOffset)return;const targetLeft=scrollLeft<minOffset?minOffset:maxOffset,retry=setInterval((()=>{if(listElement.scrollWidth-listElement.offsetWidth<targetLeft)return;const scrollBehavior=firstScroll.current?"auto":"smooth";firstScroll.current=!1,listElement.scrollTo({left:targetLeft,top:0,behavior:scrollBehavior}),clearInterval(retry)}),100);return()=>clearInterval(retry)}),[listElement,hasOverflow,currentPageIndex,showablePages,getOffsetFromIndex]),{canScrollBack,canScrollForward,scrollForward,scrollBack}};function getArrowDir(key,pos,neg,isRTL){const rtlDir=isRTL?-1:1;return key===pos?rtlDir:key===neg?-rtlDir:0}const carouselContext_useCarouselKeys=function useCarouselKeys(_ref){let{listElement,pageRefs}=_ref;const{isRTL}=(0,config.ZR)(),{addPageAt,arrangePage,currentPage,currentPageId,deletePage,pages,setCurrentPage}=(0,story.rB)((_ref2=>{let{state:{pages,currentPage,currentPageId},actions:{addPageAt,arrangePage,deletePage,setCurrentPage}}=_ref2;return{addPageAt,arrangePage,currentPage,currentPageId,deletePage,pages,setCurrentPage}})),pageIds=(0,src.Ye)((()=>pages.map((_ref3=>{let{id}=_ref3;return id}))),[pages]);(0,keyboard.Xl)(listElement,[listElement]),(0,keyboard.Ew)(listElement,{key:["up","down","left","right"]},(_ref4=>{let{key}=_ref4;const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;if(!currentPageId)return;const nextIndex=pageIds.indexOf(currentPageId)+dir;if(nextIndex>=0&&nextIndex<pageIds.length){const pageId=pageIds[nextIndex];setCurrentPage({pageId});const thumbnail=pageRefs.current&&pageRefs.current[pageId],button=thumbnail?.querySelector("button");button&&button.focus()}}),[currentPageId,isRTL,pageIds,setCurrentPage,pageRefs,listElement]),(0,keyboard.Ew)(listElement,{key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(evt=>{const{key,shiftKey}=evt;evt.preventDefault();const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;if(!currentPageId)return;const index=pageIds.indexOf(currentPageId);let newPos=index+dir;shiftKey&&(newPos=dir<0?0:pageIds.length-1),newPos!==index&&newPos>=0&&newPos<pageIds.length&&arrangePage({pageId:currentPageId,position:newPos})}),[arrangePage,currentPageId,isRTL,pageIds,setCurrentPage]),(0,keyboard.Ew)(listElement,"delete",(()=>{deletePage({pageId:currentPageId});const currentElement=document.activeElement,setFocusWhenActiveElementChanges=()=>{if(document.activeElement!==currentElement&&listElement){const focusableOption=listElement.querySelector('[role="option"][tabindex="0"]');if(focusableOption)return void focusableOption.focus()}setTimeout(setFocusWhenActiveElementChanges,100)};setFocusWhenActiveElementChanges()}),[currentPageId,deletePage,listElement]),(0,keyboard.Ew)(listElement,"clone",(()=>{if(!currentPage)return;const index=pageIds.indexOf(currentPage.id);addPageAt({page:(0,elements_src.Fl)(currentPage),position:index+1})}),[addPageAt,currentPage,pageIds])};function CarouselProvider(_ref){let{availableSpace,children}=_ref;const{pages,currentPageId,setCurrentPage,arrangePage}=(0,story.rB)((_ref2=>{let{state:{pages,currentPageId},actions:{setCurrentPage,arrangePage}}=_ref2;return{pages,currentPageId,setCurrentPage,arrangePage}})),[listElement,setListElement]=(0,src.eJ)(null),pageRefs=(0,src.sO)({}),numPages=pages.length,pageIds=(0,src.Ye)((()=>pages.map((_ref3=>{let{id}=_ref3;return id}))),[pages]),[showSkeleton,setShowSkeleton]=(0,src.eJ)(!0);(0,src.d4)((()=>{const id=(0,idleCallback.K)((()=>setShowSkeleton(!1)),{timeout:5e3});return()=>(0,idleCallback.G)(id)}),[]);const{pageThumbWidth,pageThumbHeight,pageThumbMargin,carouselWidth,hasOverflow,showablePages}=carouselContext_useCarouselSizing({availableSpace,numPages}),{canScrollBack,canScrollForward,scrollBack,scrollForward}=carouselContext_useCarouselScroll({listElement,carouselWidth,hasOverflow,showablePages,pageThumbWidth,pageThumbMargin});carouselContext_useCarouselKeys({listElement,pageRefs});const setPageRef=(0,src.I4)(((page,el)=>{pageRefs.current[page.id]=el}),[]),clickPage=(0,src.I4)((page=>setCurrentPage({pageId:page.id})),[setCurrentPage]),rearrangePages=(0,src.I4)(((_ref4,_ref5)=>{let{position:oldPos}=_ref4,{position:newPos}=_ref5;const pageId=pageIds[oldPos];arrangePage({pageId,position:newPos}),setCurrentPage({pageId})}),[pageIds,arrangePage,setCurrentPage]),value={state:{pageThumbWidth,pageThumbHeight,pageThumbMargin,carouselWidth,hasOverflow,pages,pageIds,numPages,currentPageId,canScrollBack,canScrollForward,showSkeleton},actions:{scrollBack,scrollForward,clickPage,rearrangePages,setListRef:setListElement,setPageRef}};return(0,jsx_runtime.jsx)(context.Provider,{value,children})}CarouselProvider.displayName="CarouselProvider";const carouselProvider=CarouselProvider,carouselScroll_FlippableArrow=(0,styled_components_browser_esm.ZP)(arrow_left.Z).withConfig({displayName:"carouselScroll__FlippableArrow",componentId:"sc-1npfzcu-0"})(["transform:rotate(","turn);"],(_ref=>{let{$isLeft}=_ref;return $isLeft?0:.5}));function CarouselScrollButton(_ref2){let{isNext=!1}=_ref2;const{hasOverflow,canScrollBack,canScrollForward,scrollBack,scrollForward}=carouselContext_useCarousel((_ref3=>{let{state:{hasOverflow,canScrollBack,canScrollForward},actions:{scrollBack,scrollForward}}=_ref3;return{hasOverflow,canScrollBack,canScrollForward,scrollBack,scrollForward}})),{isRTL}=(0,app.ZR)();if(!hasOverflow)return null;const canScroll=isNext?canScrollForward:canScrollBack,onClick=isNext?scrollForward:scrollBack,label=isNext?(0,i18n.__)("Scroll Forward","web-stories"):(0,i18n.__)("Scroll Back","web-stories"),isLeft=isRTL===isNext;return(0,jsx_runtime.jsx)(button_button.z,{variant:button_constants.Wu.Square,type:button_constants.L$.Plain,size:button_constants.qE.Small,disabled:!canScroll,onClick,"aria-label":label,children:(0,jsx_runtime.jsx)(carouselScroll_FlippableArrow,{$isLeft:isLeft})})}function CarouselScrollForward(){return(0,jsx_runtime.jsx)(CarouselScrollButton,{isNext:!0})}function CarouselScrollBack(){return(0,jsx_runtime.jsx)(CarouselScrollButton,{})}CarouselScrollButton.displayName="CarouselScrollButton",CarouselScrollForward.displayName="CarouselScrollForward",CarouselScrollBack.displayName="CarouselScrollBack";const reorderable_context=(0,src.kr)({state:{},actions:{}});const reorderable_useReordering=function useReordering(onPositionChange,numChildren){const[isReordering,setIsReordering]=(0,src.eJ)(!1),[currentSeparator,setCurrentSeparator]=(0,src.eJ)(null),[currentPosition,setCurrentPosition]=(0,src.eJ)(null),[dragTarget,setDragTarget]=(0,src.eJ)(null),speak=(0,useLiveRegion.Z)("assertive"),handleStartReordering=(0,src.I4)((_ref=>{let{position:currentPos,data={},onStartReordering=noop.Z}=_ref;return evt=>{const isModified=evt.shiftKey||evt.metaKey||evt.ctrlKey||evt.altKey,isLeftButton=0===evt.button;!isModified&&isLeftButton&&(onStartReordering(),setCurrentPosition({position:currentPos,data}),setDragTarget(evt.target))}}),[]),separator=(0,src.sO)(null);return(0,src.d4)((()=>{separator.current=currentSeparator}),[currentSeparator]),(0,src.d4)((()=>{if(!dragTarget)return;const onRelease=evt=>{if(evt.preventDefault(),null!==separator.current){const newPosition=separator.current,position=newPosition.position>currentPosition.position?newPosition.position-1:newPosition.position;onPositionChange(currentPosition,{...separator.current,position},evt)}setDragTarget(null)},onMove=()=>setIsReordering(!0),onAbort=evt=>{"Escape"===evt.key&&(setDragTarget(null),evt.stopPropagation())};return dragTarget.ownerDocument.addEventListener("pointerup",onRelease),dragTarget.ownerDocument.addEventListener("keydown",onAbort,!0),dragTarget.addEventListener("pointermove",onMove),()=>{setCurrentSeparator(null),setIsReordering(!1),dragTarget.removeEventListener("pointermove",onMove),dragTarget.ownerDocument.removeEventListener("pointerup",onRelease),dragTarget.ownerDocument.removeEventListener("keydown",onAbort,!0)}}),[dragTarget,currentPosition,setCurrentSeparator,setIsReordering,onPositionChange]),(0,src.d4)((()=>{if(isReordering&&currentSeparator){const position=numChildren-currentSeparator.position,message=(0,sprintf.Z)((0,i18n.__)("Reordering. Press Escape to abort. Release mouse to drop in position %d.","web-stories"),String(position));speak(message)}}),[isReordering,currentSeparator,numChildren,speak]),{isReordering,currentSeparator,setCurrentSeparator,handleStartReordering,currentPosition}},Scroller=styled_components_browser_esm.ZP.div.withConfig({displayName:"reorderableScroller__Scroller",componentId:"sc-lvxibs-0"})(["z-index:3;opacity:0;position:sticky;"]),HorizontalScroller=(0,styled_components_browser_esm.ZP)(Scroller).withConfig({displayName:"reorderableScroller__HorizontalScroller",componentId:"sc-lvxibs-1"})(["padding-left:","px;height:100%;",""],(_ref=>{let{size}=_ref;return size}),(_ref2=>{let{direction,size}=_ref2;return-1===direction?`\n        left: 0px;\n        margin-right: -${size}px;\n        `:`\n        right: 0px;\n        margin-left: -${size}px;\n        `})),VerticalScroller=(0,styled_components_browser_esm.ZP)(Scroller).withConfig({displayName:"reorderableScroller__VerticalScroller",componentId:"sc-lvxibs-2"})(["padding-top:","px;width:100%;",""],(_ref3=>{let{size}=_ref3;return size}),(_ref4=>{let{direction,size}=_ref4;return-1===direction?`\n        top: 0px;\n        margin-bottom: -${size}px;\n        `:`\n        bottom: 0px;\n        margin-top: -${size}px;\n        `}));function ReorderableScroller(_ref5){let{direction,size}=_ref5;const{state:{canScrollEnd,canScrollStart,mode},actions:{startScroll}}=(0,src.qp)(reorderable_context),[isHovering,setIsHovering]=(0,src.eJ)(!1),handlePointerEnter=(0,src.I4)((()=>setIsHovering(!0)),[]),handlePointerLeave=(0,src.I4)((()=>setIsHovering(!1)),[]);(0,src.d4)((()=>{if(isHovering)return startScroll(direction)}),[direction,startScroll,isHovering]);const isVisible=-1===direction&&canScrollStart||1===direction&&canScrollEnd;if((0,src.d4)((()=>{isVisible||setIsHovering(!1)}),[isVisible]),!isVisible)return null;const ScrollerElement="horizontal"===mode?HorizontalScroller:VerticalScroller;return(0,jsx_runtime.jsx)(ScrollerElement,{size,direction,onPointerEnter:handlePointerEnter,onPointerLeave:handlePointerLeave,mode})}ReorderableScroller.displayName="ReorderableScroller";const reorderableScroller=(0,src.X$)(ReorderableScroller);const reorderable_useScroll=function useScroll(){let mode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"horizontal",isReordering=arguments.length>1?arguments[1]:void 0,scrollTarget=arguments.length>2?arguments[2]:void 0,size=arguments.length>3?arguments[3]:void 0;const[hasScrollAbove,setHasScrollAbove]=(0,src.eJ)(!1),[hasScrollBelow,setHasScrollBelow]=(0,src.eJ)(!1),[scrollDirection,setScrollDirection]=(0,src.eJ)(0),updateScrollMarkers=(0,src.iS)((()=>{const node=scrollTarget.current;if(node)if("horizontal"===mode){const possibleScroll=node.scrollWidth-node.clientWidth;possibleScroll<=0?(setHasScrollAbove(!1),setHasScrollBelow(!1)):(setHasScrollAbove(node.scrollLeft>0),setHasScrollBelow(node.scrollLeft<possibleScroll))}else{const possibleScroll=node.scrollHeight-node.clientHeight;possibleScroll<=0?(setHasScrollAbove(!1),setHasScrollBelow(!1)):(setHasScrollAbove(node.scrollTop>0),setHasScrollBelow(node.scrollTop<possibleScroll))}}),[mode,scrollTarget]),startScroll=(0,src.I4)((dir=>(setScrollDirection(dir),()=>setScrollDirection(0))),[setScrollDirection]),canScrollStart=isReordering&&hasScrollAbove,canScrollEnd=isReordering&&hasScrollBelow;return(0,src.d4)((()=>{if(0===scrollDirection||!(canScrollStart&&scrollDirection<0||canScrollEnd&&scrollDirection>0))return;let mounted=!0;const update=()=>{const scrollStep=Math.max(Math.min(.2*size,10),0);"horizontal"===mode?scrollTarget.current.scrollLeft+=scrollDirection*scrollStep:scrollTarget.current.scrollTop+=scrollDirection*scrollStep,updateScrollMarkers(),mounted&&window.requestAnimationFrame(update)};return update(),()=>{mounted=!1}}),[scrollDirection,updateScrollMarkers,canScrollStart,canScrollEnd,size,mode,scrollTarget]),(0,src.d4)((()=>updateScrollMarkers()),[isReordering,updateScrollMarkers]),{startScroll,canScrollEnd,canScrollStart}},ReorderableContainer=styled_components_browser_esm.ZP.div.attrs({role:"listbox"}).withConfig({displayName:"reorderable__ReorderableContainer",componentId:"sc-plmujd-0"})(["display:flex;"]),reorderable=(0,src.Gp)((function Reorderable(_ref,forwardedRef){let{children,onPositionChange,getItemSize,scrollSize=null,mode="horizontal",...props}=_ref;const ref=(0,src.sO)(null),containerRef=forwardedRef||ref,{isReordering,currentSeparator,setCurrentSeparator,handleStartReordering,currentPosition}=reorderable_useReordering(onPositionChange,children.length),{startScroll,canScrollEnd,canScrollStart}=reorderable_useScroll(mode,isReordering,containerRef,getItemSize()),state={state:{isReordering,currentSeparator,containerRef,mode,canScrollEnd,canScrollStart,currentPosition},actions:{setCurrentSeparator,handleStartReordering,startScroll}},scrollerSize=scrollSize||getItemSize();return(0,jsx_runtime.jsx)(reorderable_context.Provider,{value:state,children:(0,jsx_runtime.jsxs)(ReorderableContainer,{ref:containerRef,...props,children:[(0,jsx_runtime.jsx)(reorderableScroller,{direction:-1,size:scrollerSize}),children,(0,jsx_runtime.jsx)(reorderableScroller,{direction:1,size:scrollerSize})]})})}));const reorderable_useReorderable=function useReorderable(selector){return(0,src.Sz)(reorderable_context,selector??src.yR)},Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"reorderableItem__Container",componentId:"sc-5aswet-0"})(["z-index:1;"]);function ReorderableItem(_ref){let{children,position,onStartReordering,disabled,data,...props}=_ref;const handleStartReordering=reorderable_useReorderable((_ref2=>{let{actions}=_ref2;return actions.handleStartReordering}));return(0,jsx_runtime.jsx)(Container,{...disabled?null:{onPointerDown:handleStartReordering({position,onStartReordering,data})},...props,children})}ReorderableItem.displayName="ReorderableItem";const reorderableItem=ReorderableItem,nestedOffsetCalcFunc=evt=>evt.offsetY<35/1.7,reorderableSeparator_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"reorderableSeparator__Wrapper",componentId:"sc-1tnz6qo-0"})(["opacity:0;position:relative;z-index:",";&:hover{opacity:",";}"],(_ref=>{let{isReordering,isNested}=_ref;return isReordering?isNested?3:2:-1}),(_ref2=>{let{isReordering}=_ref2;return isReordering?1:0})),Line=styled_components_browser_esm.ZP.div.withConfig({displayName:"reorderableSeparator__Line",componentId:"sc-1tnz6qo-1"})(["height:4px;margin:0 0 -4px;background:",";width:100%;"," width:",""],(_ref3=>{let{theme}=_ref3;return theme.colors.accent.secondary}),(_ref4=>{let{isNested}=_ref4;return isNested&&"margin-left: 30px;"}),(_ref5=>{let{isNested}=_ref5;return isNested?"calc(100% - 30px)":"100%"}));function ReorderableSeparator(_ref6){let{position,groupId=null,isNested=!1,nestedOffset=!1,nestedOffsetCalcFunc=noop.Z,children=null,...props}=_ref6;const separatorRef=(0,src.sO)(null),[isTempNested,setIsTempNested]=(0,src.eJ)(!1),{isReordering,setCurrentSeparator}=reorderable_useReorderable((_ref7=>{let{state,actions}=_ref7;const currentPosition=state.currentPosition?.position,isNextToCurrentItem=currentPosition===position||currentPosition===position-1;return{isReordering:state.isReordering&&!isNextToCurrentItem,isNextToCurrentItem,setCurrentSeparator:actions.setCurrentSeparator}})),handlePointerEnter=(0,src.I4)((()=>{isReordering&&setCurrentSeparator({position,data:{groupId}})}),[setCurrentSeparator,isReordering,position,groupId]);return null===children&&(children=(0,jsx_runtime.jsx)(Line,{isNested:isNested||isTempNested})),(0,jsx_runtime.jsx)(reorderableSeparator_Wrapper,{onPointerOver:handlePointerEnter,onPointerMove:evt=>{nestedOffset&&setIsTempNested(nestedOffsetCalcFunc(evt.nativeEvent))},ref:separatorRef,isReordering,isNested:isNested||isTempNested,...props,children})}ReorderableSeparator.displayName="ReorderableSeparator";const reorderableSeparator=ReorderableSeparator,carouselPage_Line=styled_components_browser_esm.ZP.div.withConfig({displayName:"carouselPage__Line",componentId:"sc-mvqls9-0"})(["background:",";height:","px;width:","px;margin:0px;"],(_ref=>{let{theme}=_ref;return theme.colors.border.selection}),(_ref2=>{let{$height}=_ref2;return $height}),4),ItemContainer=styled_components_browser_esm.ZP.li.attrs({role:"presentation"}).withConfig({displayName:"carouselPage__ItemContainer",componentId:"sc-mvqls9-1"})(["display:flex;position:relative;margin:0;padding:0;"]),PageSeparator=(0,styled_components_browser_esm.ZP)(reorderableSeparator).withConfig({displayName:"carouselPage__PageSeparator",componentId:"sc-mvqls9-2"})(["position:absolute;bottom:0;left:","px;width:","px;height:","px;display:flex;justify-content:center;",":first-of-type &:first-of-type,",":last-of-type &:last-of-type{width:","px;}",":first-of-type &:first-of-type{left:","px;justify-content:flex-start;}",":first-of-type &:last-of-type{left:","px;}",":last-of-type &:last-of-type{justify-content:flex-end;}"],(_ref3=>{let{$width}=_ref3;return $width/2}),(_ref4=>{let{$width,margin}=_ref4;return $width+margin}),(_ref5=>{let{$height}=_ref5;return $height}),ItemContainer,ItemContainer,(_ref6=>{let{$width,margin}=_ref6;return($width+margin+4)/2}),ItemContainer,(_ref7=>{let{margin}=_ref7;return(margin-4)/2}),ItemContainer,(_ref8=>{let{$width,margin}=_ref8;return margin+$width/2}),ItemContainer),ReorderablePage=(0,styled_components_browser_esm.ZP)(reorderableItem).withConfig({displayName:"carouselPage__ReorderablePage",componentId:"sc-mvqls9-3"})(["display:flex;z-index:1;margin-right:","px;margin-left:","px;"],(_ref9=>{let{margin}=_ref9;return margin}),(_ref10=>{let{margin,position}=_ref10;return 0===position?margin:0}));function CarouselPage(_ref11){let{pageId,index}=_ref11;const{pageThumbWidth,pageThumbHeight,pageThumbMargin,clickPage,setPageRef,page,isCurrentPage,hasMultiplePages}=carouselContext_useCarousel((_ref12=>{let{state:{pageThumbWidth,pageThumbHeight,pageThumbMargin,numPages,pages,currentPageId},actions:{clickPage,setPageRef}}=_ref12;return{pageThumbWidth,pageThumbHeight,pageThumbMargin,clickPage,setPageRef,page:pages.find((_ref13=>{let{id}=_ref13;return id===pageId})),isCurrentPage:pageId===currentPageId,hasMultiplePages:numPages>1}}));return page&&page.id?(0,jsx_runtime.jsxs)(ItemContainer,{ref:el=>setPageRef(page,el),"data-testid":`carousel-page-preview-${pageId}`,children:[0===index&&(0,jsx_runtime.jsx)(PageSeparator,{position:0,$width:pageThumbWidth,$height:pageThumbHeight,margin:pageThumbMargin,children:(0,jsx_runtime.jsx)(carouselPage_Line,{$height:pageThumbHeight})}),(0,jsx_runtime.jsx)(ReorderablePage,{position:index,margin:pageThumbMargin,children:(0,jsx_runtime.jsx)(pagepreview.Z,{tabIndex:isCurrentPage&&hasMultiplePages?0:-1,onClick:()=>clickPage(page),role:"option","data-page-id":page.id,label:isCurrentPage?(0,sprintf.Z)((0,i18n.__)("Page %s (current page)","web-stories"),index+1):(0,sprintf.Z)((0,i18n.__)("Go to page %s","web-stories"),index+1),isActive:isCurrentPage,page,width:pageThumbWidth,height:pageThumbHeight,isInteractive:hasMultiplePages})}),(0,jsx_runtime.jsx)(PageSeparator,{position:index+1,$width:pageThumbWidth,$height:pageThumbHeight,margin:pageThumbMargin,children:(0,jsx_runtime.jsx)(carouselPage_Line,{$height:pageThumbHeight})})]}):null}CarouselPage.displayName="CarouselPage";const carouselPage=CarouselPage;var isHexColorString=__webpack_require__("./packages/patterns/src/isHexColorString.ts"),getSolidFromHex=__webpack_require__("./packages/patterns/src/getSolidFromHex.ts");const EmptyPage=styled_components_browser_esm.ZP.li.attrs({role:"presentation"}).withConfig({displayName:"skeletonPage__EmptyPage",componentId:"sc-3wwzc9-0"})(["display:block;position:relative;flex:0 0;margin:0;padding:0;border-radius:4px;"]);function SkeletonPage(_ref){let{pageId,index}=_ref;const{pageThumbWidth,pageThumbHeight,pageThumbMargin,hasPage,bgColor}=carouselContext_useCarousel((_ref2=>{let{state:{pageThumbWidth,pageThumbHeight,pageThumbMargin,pages}}=_ref2,bgColor=null;const page=pages.find((_ref3=>{let{id}=_ref3;return id===pageId}));if(page){bgColor=page.backgroundColor;const bgElement=page.elements[0];bgElement&&elements_src.Zy.media(bgElement)&&bgElement.resource.baseColor&&(0,isHexColorString.Z)(bgElement.resource.baseColor)&&(bgColor=(0,getSolidFromHex.Z)(bgElement.resource.baseColor.replace("#","")))}return{pageThumbWidth,pageThumbHeight,pageThumbMargin,hasPage:Boolean(page&&page.id),bgColor}}));return hasPage?(0,jsx_runtime.jsx)(EmptyPage,{style:{flexBasis:`${pageThumbWidth}px`,height:`${pageThumbHeight}px`,marginLeft:`${0===index?pageThumbMargin:0}px`,marginRight:`${pageThumbMargin}px`,...(0,generatePatternStyles.Z)(bgColor)},"data-testid":`carousel-page-preview-skeleton-${pageId}`}):null}SkeletonPage.displayName="SkeletonPage";const skeletonPage=SkeletonPage,PageList=(0,styled_components_browser_esm.ZP)(reorderable).attrs({role:"listbox","aria-orientation":"horizontal",mode:"horizontal"}).withConfig({displayName:"carouselList__PageList",componentId:"sc-1oa14z5-0"})(["grid-area:carousel;flex-direction:row;align-items:center;justify-content:center;overflow-x:hidden;overflow-y:hidden;width:","px;list-style:none;padding:4px 0;margin:-4px 0;",";::-webkit-scrollbar-thumb{border:6px solid transparent !important;}"],(_ref=>{let{$width}=_ref;return $width}),(_ref2=>{let{hasOverflow}=_ref2;return hasOverflow&&(0,styled_components_browser_esm.iv)(["overflow-x:visible;overflow-x:overlay;justify-content:flex-start;"])}));function CarouselList(){const{pageThumbWidth,carouselWidth,hasOverflow,pageIds,rearrangePages,setListRef,showSkeleton}=carouselContext_useCarousel((_ref3=>{let{state:{pageThumbWidth,carouselWidth,hasOverflow,pageIds,showSkeleton},actions:{rearrangePages,setListRef}}=_ref3;return{pageThumbWidth,carouselWidth,hasOverflow,pageIds,rearrangePages,setListRef,showSkeleton}})),Page=showSkeleton?skeletonPage:carouselPage;return(0,jsx_runtime.jsx)(PageList,{mode:"horizontal",$width:carouselWidth,ref:setListRef,hasOverflow,"aria-label":(0,i18n.__)("Pages List","web-stories"),onPositionChange:rearrangePages,getItemSize:()=>pageThumbWidth,children:pageIds.map(((pageId,index)=>(0,jsx_runtime.jsx)(Page,{pageId,index},pageId)))})}CarouselList.displayName="CarouselList";const carouselList=CarouselList;var chevron_down_small=__webpack_require__("./packages/design-system/src/icons/chevron_down_small.svg"),chevron_up_small=__webpack_require__("./packages/design-system/src/icons/chevron_up_small.svg");const iconCss=(0,styled_components_browser_esm.iv)(["width:32px;margin:-8px;"]),IconDown=(0,styled_components_browser_esm.ZP)(chevron_down_small.Z).withConfig({displayName:"carouselDrawerIcon__IconDown",componentId:"sc-b03fdn-0"})(["",""],iconCss),IconUp=(0,styled_components_browser_esm.ZP)(chevron_up_small.Z).withConfig({displayName:"carouselDrawerIcon__IconUp",componentId:"sc-b03fdn-1"})(["",""],iconCss);function CarouselDrawerIcon(_ref){let{state}=_ref;return[constants.bh.Open,constants.bh.Closing].includes(state)?(0,jsx_runtime.jsx)(IconDown,{}):(0,jsx_runtime.jsx)(IconUp,{})}CarouselDrawerIcon.displayName="CarouselDrawerIcon";const carouselDrawerIcon=CarouselDrawerIcon,carouselDrawer_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"carouselDrawer__Wrapper",componentId:"sc-1dxh28m-0"})(["display:flex;justify-content:center;"]),StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"carouselDrawer__StyledButton",componentId:"sc-1dxh28m-1"})(["white-space:nowrap;gap:8px;"]);function CarouselDrawer(){const{carouselState,openCarousel,closeCarousel}=(0,app.$Y)((_ref=>{let{state:{carouselState},actions:{openCarousel,closeCarousel}}=_ref;return{carouselState,openCarousel,closeCarousel}})),{currentPageNumber,pageCount}=(0,app.rB)((_ref2=>{let{state:{currentPageNumber,pages}}=_ref2;return{currentPageNumber,pageCount:pages.length}})),onClick=(0,src.I4)((()=>{carouselState===constants.bh.Open?closeCarousel():carouselState===constants.bh.Closed&&openCarousel()}),[carouselState,openCarousel,closeCarousel]);return(0,jsx_runtime.jsx)(carouselDrawer_Wrapper,{children:(0,jsx_runtime.jsxs)(StyledButton,{"aria-label":(0,i18n.__)("Toggle page carousel","web-stories"),onClick,variant:button_constants.Wu.Rectangle,size:button_constants.qE.Small,type:button_constants.L$.Tertiary,children:[(0,sprintf.Z)((0,i18n._n)("%1$d of %2$d page","%1$d of %2$d pages",pageCount,"web-stories"),currentPageNumber,pageCount),(0,jsx_runtime.jsx)(carouselDrawerIcon,{state:carouselState})]})})}CarouselDrawer.displayName="CarouselDrawer";const carouselDrawer=CarouselDrawer,carouselLayout_Wrapper=styled_components_browser_esm.ZP.section.withConfig({displayName:"carouselLayout__Wrapper",componentId:"sc-iaovfa-0"})(["position:relative;display:grid;grid:'. d d d d d .' 32px '. . . . . . .' ","px '. p . c . n .' auto / 1fr ","px ","px auto ","px ","px 1fr;width:100%;height:auto;z-index:",";&.carousel-enter{top:","px;&.carousel-enter-active{top:0;transition:","ms ease-out;transition-property:top;}}&.carousel-exit{top:0;&.carousel-exit-active{top:","px;transition:","ms ease-out;transition-property:top;}}"],(_ref=>{let{isCollapsed}=_ref;return isCollapsed?2:8}),NAVIGATION_BUTTON_WIDTH,8,8,NAVIGATION_BUTTON_WIDTH,zIndex.FM,(_ref2=>{let{thumbHeight}=_ref2;return thumbHeight+6}),constants.e0,(_ref3=>{let{thumbHeight}=_ref3;return thumbHeight+6}),constants.e0),carouselLayout_Area=styled_components_browser_esm.ZP.div.withConfig({displayName:"carouselLayout__Area",componentId:"sc-iaovfa-1"})(["grid-area:",";display:flex;align-items:center;justify-content:center;flex-direction:column;"],(_ref4=>{let{area}=_ref4;return area}));function CarouselLayout(){const{carouselState}=(0,app.$Y)((_ref5=>{let{state:{carouselState}}=_ref5;return{carouselState}})),{numPages,pageThumbHeight}=carouselContext_useCarousel((_ref6=>{let{state:{numPages,pageThumbHeight}}=_ref6;return{numPages,pageThumbHeight}})),nodeRef=(0,src.sO)();if(numPages<=0)return null;const isCollapsed=carouselState===constants.bh.Closed,isOpenOrOpening=[constants.bh.Open,constants.bh.Opening].includes(carouselState);return(0,jsx_runtime.jsx)(CSSTransition.Z,{in:isOpenOrOpening,classNames:"carousel",containerRef:!0,nodeRef,timeout:constants.e0,children:(0,jsx_runtime.jsxs)(carouselLayout_Wrapper,{ref:nodeRef,"aria-label":(0,i18n.__)("Page Carousel","web-stories"),isCollapsed,thumbHeight:pageThumbHeight,children:[(0,jsx_runtime.jsx)(carouselLayout_Area,{area:"d",children:(0,jsx_runtime.jsx)(carouselDrawer,{})}),!isCollapsed&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(carouselLayout_Area,{area:"p",children:(0,jsx_runtime.jsx)(CarouselScrollBack,{})}),(0,jsx_runtime.jsx)(carouselLayout_Area,{area:"c",children:(0,jsx_runtime.jsx)(carouselList,{})}),(0,jsx_runtime.jsx)(carouselLayout_Area,{area:"n",children:(0,jsx_runtime.jsx)(CarouselScrollForward,{})})]})]})})}CarouselLayout.displayName="CarouselLayout";const carouselLayout=CarouselLayout,carouselContainer_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"carouselContainer__Wrapper",componentId:"sc-1dsu28u-0"})(["height:auto;width:100%;align-self:flex-end;"]);function CarouselContainer(){const ref=(0,src.sO)(),[carouselWidth,setCarouselWidth]=(0,src.eJ)(0);return(0,src.Bz)(ref,(_ref=>{let{width}=_ref;return setCarouselWidth(width)}),[]),(0,jsx_runtime.jsx)(carouselProvider,{availableSpace:carouselWidth,children:(0,jsx_runtime.jsx)(carouselContainer_Wrapper,{ref,children:(0,jsx_runtime.jsx)(carouselLayout,{})})})}CarouselContainer.displayName="CarouselContainer";const carouselContainer=(0,src.X$)(CarouselContainer);var dropdown=__webpack_require__("./packages/design-system/src/components/dropDown/dropdown.tsx");const selectButtonCSS=(0,styled_components_browser_esm.iv)(["width:80px;height:36px;padding:0 10px;border-width:1px;border-style:solid;border-color:",";background-color:",";transition:background-color ",";&:hover,&:focus,&:active{border-color:",";background-color:",";}span{height:100%;padding:0;display:flex;align-items:center;}svg{margin:0 -10px;}"],(_ref=>{let{theme}=_ref;return theme.colors.border.defaultNormal}),(_ref2=>{let{theme}=_ref2;return theme.colors.bg.primary}),button_constants.ok,(_ref3=>{let{theme}=_ref3;return theme.colors.bg.secondary}),(_ref4=>{let{theme}=_ref4;return theme.colors.bg.tertiary})),ZOOM_OPTIONS=[{label:(0,i18n._x)("100%","zoom level","web-stories"),value:1},{label:(0,i18n._x)("200%","zoom level","web-stories"),value:2},{label:(0,i18n._x)("Fill","zoom level","web-stories"),value:constants.uM.Fill},{label:(0,i18n._x)("Fit","zoom level","web-stories"),value:constants.uM.Fit}];function ZoomSelector(){const{zoomSetting,zoomLevel,setZoomSetting,setZoomLevel}=(0,layout.$)((_ref5=>{let{state:{zoomSetting,zoomLevel},actions:{setZoomSetting,setZoomLevel}}=_ref5;return{zoomSetting,zoomLevel,setZoomSetting,setZoomLevel}})),placeholder=(0,src.Ye)((()=>{const option=ZOOM_OPTIONS.find((_ref6=>{let{value}=_ref6;return zoomSetting===constants.uM.Fixed?value===zoomLevel:value===zoomSetting}));return option?option.label:(0,sprintf.Z)((0,i18n._x)("%d%%","zoom level","web-stories"),Math.round(100*zoomLevel))}),[zoomSetting,zoomLevel]),handleSetZoom=(0,src.I4)(((_event,value)=>{Object.values(constants.uM).includes(value)?setZoomSetting(value):setZoomLevel(value)}),[setZoomSetting,setZoomLevel]);return(0,jsx_runtime.jsx)(dropdown.Z,{ariaLabel:(0,i18n.__)("Zoom Level","web-stories"),placeholder,options:ZOOM_OPTIONS,placement:popup_constants.ug.TopStart,onMenuItemClick:handleSetZoom,selectedValue:zoomSetting,popupFillWidth:!1,selectButtonStylesOverride:selectButtonCSS,className:"zoom-selector-dropdown"})}ZoomSelector.displayName="ZoomSelector";const zoomSelector=ZoomSelector;var box4=__webpack_require__("./packages/design-system/src/icons/box4.svg"),modal=__webpack_require__("./packages/design-system/src/components/modal/modal.tsx"),toggleButton=__webpack_require__("./packages/story-editor/src/components/toggleButton/index.js"),slider_slider=__webpack_require__("./packages/design-system/src/components/slider/slider.tsx"),useGridViewKeys=__webpack_require__("./packages/design-system/src/components/keyboard/gridview/useGridViewKeys.ts"),cross=__webpack_require__("./packages/design-system/src/icons/cross.svg");const gridView_Container=styled_components_browser_esm.ZP.section.withConfig({displayName:"gridView__Container",componentId:"sc-ytsaos-0"})(["display:flex;flex-direction:column;height:100%;width:100%;padding:32px;"]),TopRow=styled_components_browser_esm.ZP.header.withConfig({displayName:"gridView__TopRow",componentId:"sc-ytsaos-1"})(["display:flex;justify-content:space-between;align-items:center;margin-bottom:36px;@media ","{margin-bottom:72px;}@media ","{margin-bottom:112px;}"],(_ref=>{let{theme}=_ref;return theme.breakpoint.desktop}),(_ref2=>{let{theme}=_ref2;return theme.breakpoint.wide})),gridView_Wrapper=(0,styled_components_browser_esm.ZP)(reorderable).withConfig({displayName:"gridView__Wrapper",componentId:"sc-ytsaos-2"})(["position:relative;overflow-y:auto;overflow-y:overlay;overflow-x:hidden;flex-grow:1;display:flex;flex-direction:column;pointer-events:all;padding:4px;"]),Grid=styled_components_browser_esm.ZP.div.withConfig({displayName:"gridView__Grid",componentId:"sc-ytsaos-3"})(["position:relative;display:grid;grid-template-columns:",";grid-template-rows:repeat(auto-fill,","px);grid-gap:","px;justify-content:center;align-items:flex-start;flex-grow:1;"],(_ref3=>{let{pageWidth}=_ref3;return`repeat(auto-fit, minmax(${pageWidth}px, max-content))`}),(_ref4=>{let{pageHeight}=_ref4;return pageHeight}),(_ref5=>{let{gapWidth}=_ref5;return gapWidth})),NoButton=styled_components_browser_esm.ZP.div.withConfig({displayName:"gridView__NoButton",componentId:"sc-ytsaos-4"})(["flex:0 0 56px;"]),ClickableButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"gridView__ClickableButton",componentId:"sc-ytsaos-5"})(["pointer-events:all;"]),ClickableSlider=(0,styled_components_browser_esm.ZP)(slider_slider.Z).withConfig({displayName:"gridView__ClickableSlider",componentId:"sc-ytsaos-6"})(["pointer-events:all;width:366px;"]),gridView_PageSeparator=(0,styled_components_browser_esm.ZP)(reorderableSeparator).withConfig({displayName:"gridView__PageSeparator",componentId:"sc-ytsaos-7"})(["position:absolute;bottom:0;left:","px;width:","px;height:","px;display:flex;justify-content:center;align-items:center;",""],(_ref6=>{let{width}=_ref6;return width/2}),(_ref7=>{let{width,margin}=_ref7;return width+margin}),(_ref8=>{let{height}=_ref8;return height}),(_ref9=>{let{before,width,margin}=_ref9;return before&&`\n      left: -${(width+2*margin)/2}px;\n    `})),gridView_Line=styled_components_browser_esm.ZP.div.withConfig({displayName:"gridView__Line",componentId:"sc-ytsaos-8"})(["background:",";height:","px;width:2px;margin:0px;"],(_ref10=>{let{theme}=_ref10;return theme.colors.border.selection}),(_ref11=>{let{height}=_ref11;return height})),gridView_ItemContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"gridView__ItemContainer",componentId:"sc-ytsaos-9"})(["display:flex;flex-direction:row;position:relative;"]);function GridView(_ref12){let{onClose}=_ref12;const{pages,currentPageId,currentPageIndex,setCurrentPage,arrangePage}=(0,app.rB)((_ref13=>{let{state:{pages,currentPageIndex,currentPageId},actions:{setCurrentPage,arrangePage}}=_ref13;return{pages,currentPageIndex,currentPageId,setCurrentPage,arrangePage}})),{isRTL}=(0,app.ZR)(),[pagesPerRow,setPagesPerRow]=(0,src.eJ)(4),[availableWidth,setAvailableWidth]=(0,src.eJ)(null),wrapperRef=(0,src.sO)();(0,src.Bz)(wrapperRef,(_ref14=>{let{width}=_ref14;return setAvailableWidth(width)}),[]);const rawPageWidth=(availableWidth-20*(pagesPerRow-1))/pagesPerRow,pageWidth=12*Math.floor(rawPageWidth/12),actualPageWidths=pageWidth*pagesPerRow,pageGridGap=Math.floor((availableWidth-actualPageWidths)/(pagesPerRow-1)),pageHeight=pageWidth/src_constants.Sr,handleClickPage=page=>()=>setCurrentPage({pageId:page.id}),gridRef=(0,src.sO)(),pageRefs=(0,src.sO)({}),arrangeItem=(0,src.I4)(((focusedPageId,nextIndex)=>{arrangePage({pageId:focusedPageId,position:nextIndex})}),[arrangePage]);(0,useGridViewKeys.Z)({containerRef:wrapperRef,gridRef,itemRefs:pageRefs,isRTL,currentItemId:currentPageId,items:pages,arrangeItem});const dividerLineHeight=Math.min(pageHeight-24,64);return(0,jsx_runtime.jsxs)(gridView_Container,{"aria-label":(0,i18n.__)("Grid View","web-stories"),children:[(0,jsx_runtime.jsxs)(TopRow,{children:[(0,jsx_runtime.jsx)(ClickableButton,{variant:button_constants.Wu.Square,type:button_constants.L$.Tertiary,size:button_constants.qE.Medium,onClick:onClose,"aria-label":(0,i18n.__)("Close","web-stories"),children:(0,jsx_runtime.jsx)(cross.Z,{})}),(0,jsx_runtime.jsx)(ClickableSlider,{min:4,max:12,majorStep:1,minorStep:1,value:pagesPerRow,handleChange:newValue=>setPagesPerRow(newValue),"aria-label":(0,i18n.__)("Pages per row","web-stories"),popupZIndexOverride:zIndex.mV}),(0,jsx_runtime.jsx)(NoButton,{})]}),(0,jsx_runtime.jsx)(gridView_Wrapper,{"aria-label":(0,i18n.__)("Grid View Pages List","web-stories"),ref:wrapperRef,onPositionChange:(_ref15,_ref16)=>{let{position:oldPos}=_ref15,{position:newPos}=_ref16;const pageId=pages[oldPos].id;arrangePage({pageId,position:newPos}),setCurrentPage({pageId})},mode:"grid",getItemSize:()=>pageHeight,scrollSize:64,children:(0,jsx_runtime.jsx)(Grid,{pageWidth,pageHeight,gapWidth:pageGridGap,ref:gridRef,children:pages.map(((page,index)=>{const isCurrentPage=index===currentPageIndex,isInteractive=pages.length>1;return(0,jsx_runtime.jsxs)(gridView_ItemContainer,{ref:el=>{pageRefs.current[page.id]=el},children:[(0,jsx_runtime.jsx)(gridView_PageSeparator,{position:index,width:pageWidth,height:pageHeight,margin:pageGridGap,before:!0,children:(0,jsx_runtime.jsx)(gridView_Line,{height:dividerLineHeight})}),(0,jsx_runtime.jsx)(reorderableItem,{position:index,children:(0,jsx_runtime.jsx)(pagepreview.Z,{label:isCurrentPage?(0,sprintf.Z)((0,i18n.__)("Page %s (current page)","web-stories"),index+1):(0,sprintf.Z)((0,i18n.__)("Page %s","web-stories"),index+1),tabIndex:isCurrentPage&&isInteractive?0:-1,isActive:isCurrentPage&&isInteractive,page,width:pageWidth,height:pageHeight,onClick:handleClickPage(page),isInteractive,gridRef,role:"option"})}),(0,jsx_runtime.jsx)(gridView_PageSeparator,{position:index+1,width:pageWidth,height:pageHeight,margin:pageGridGap,children:(0,jsx_runtime.jsx)(gridView_Line,{height:dividerLineHeight})})]},page.id)}))})})]})}GridView.displayName="GridView";const gridView=GridView,Box=styled_components_browser_esm.ZP.div.withConfig({displayName:"gridViewButton__Box",componentId:"sc-1gc0r0y-0"})(["display:flex;justify-content:center;align-items:center;"]);const gridViewButton=function GridViewButton(){const[isGridViewOpen,setIsGridViewOpen]=(0,src.eJ)(!1),toggleModal=(0,src.I4)((()=>{setIsGridViewOpen((prevIsOpen=>{const newIsOpen=!prevIsOpen;return(0,tracking_src.L9)("grid_view_toggled",{status:newIsOpen?"open":"closed"}),newIsOpen}))}),[setIsGridViewOpen]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Box,{children:(0,jsx_runtime.jsx)(tooltip.Z,{title:(0,i18n.__)("Grid View","web-stories"),placement:popup_constants.ug.Top,hasTail:!0,children:(0,jsx_runtime.jsx)(toggleButton.C,{isOpen:isGridViewOpen,onClick:toggleModal,"aria-owns":"gridview_modal",MainIcon:box4.Z,"aria-label":(0,i18n.__)("Grid View","web-stories"),label:(0,i18n.__)("Grid View","web-stories")})})}),(0,jsx_runtime.jsx)(modal.Z,{isOpen:isGridViewOpen,onClose:toggleModal,contentLabel:(0,i18n.__)("Grid View","web-stories"),popupId:"gridview_modal",overlayStyles:{alignItems:"stretch",backgroundColor:"#131516"},contentStyles:{pointerEvents:"none",flex:1},children:(0,jsx_runtime.jsx)(gridView,{onClose:toggleModal})})]})};var panel=__webpack_require__("./packages/story-editor/src/components/panels/panel/index.js"),useSidebar=__webpack_require__("./packages/story-editor/src/components/sidebar/useSidebar.js"),chevron_down=__webpack_require__("./packages/design-system/src/icons/chevron_down.svg"),group=__webpack_require__("./packages/design-system/src/icons/group.svg"),visibility_off=__webpack_require__("./packages/design-system/src/icons/visibility_off.svg"),lock_closed=__webpack_require__("./packages/design-system/src/icons/lock_closed.svg");const layer_useGroupSelection=function useGroupSelection(groupId){const{toggleLayer,groupLayers,selectedElementIds}=(0,app.rB)((_ref=>{let{state,actions}=_ref;return{groupLayers:state.currentPage.elements.filter((el=>el.groupId===groupId)),selectedElementIds:state.selectedElementIds,toggleLayer:actions.toggleLayer}})),setRenamableLayer=(0,app.$P)((_ref2=>{let{actions}=_ref2;return actions.setRenamableLayer}));return{isSelected:groupLayers.every((gl=>selectedElementIds.includes(gl.id))),handleClick:(0,src.I4)((evt=>{evt.preventDefault(),evt.stopPropagation(),toggleLayer({elementId:groupLayers[0].id,metaKey:evt.metaKey,shiftKey:evt.shiftKey,withLinked:!0});2===evt.detail&&setRenamableLayer({elementId:groupId})}),[toggleLayer,groupLayers,setRenamableLayer,groupId])}};var visibility=__webpack_require__("./packages/design-system/src/icons/visibility.svg"),trash=__webpack_require__("./packages/design-system/src/icons/trash.svg"),page_plus=__webpack_require__("./packages/design-system/src/icons/page_plus.svg"),lock_open=__webpack_require__("./packages/design-system/src/icons/lock_open.svg"),v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),generateGroupName=__webpack_require__("./packages/story-editor/src/utils/generateGroupName.ts");const layerIdContext=(0,src.kr)(""),ActionButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:button_constants.L$.Plain,tabIndex:-1}).withConfig({displayName:"layerAction__ActionButton",componentId:"sc-xw5sxy-0"})(["position:relative;aspect-ratio:1;width:20px;padding:0;svg{position:absolute;width:32px;height:auto;top:50%;left:50%;transform:translate(-50%,-50%);}&&{transition:revert;background:var(--background-color);}:disabled{color:",";}:hover{color:var( --selected-hover-color,"," );}& + &{margin-left:4px;}*{pointer-events:none;}:focus{","}"],(_ref=>{let{theme}=_ref;return theme.colors.fg.secondary}),(_ref2=>{let{theme}=_ref2;return theme.colors.fg.secondary}),(_ref3=>{let{theme}=_ref3;return outline.R(theme.colors.border.focus,"var(--background-color)")}));function preventReorder(e){e.stopPropagation(),e.preventDefault()}function LayerAction(_ref4){let{label,handleClick,children,disabled=!1,isActive=!0,trackingData=null}=_ref4;const buttonRef=(0,src.sO)(null);(0,usePerformanceTracking.Z)({node:trackingData?buttonRef.current:null,eventData:trackingData});const layerId=(0,src.qp)(layerIdContext);return isActive?(0,jsx_runtime.jsx)(tooltip.Z,{title:label,hasTail:!0,isDelayed:!0,children:(0,jsx_runtime.jsx)(ActionButton,{"aria-label":label,"aria-describedby":layerId,onPointerDown:preventReorder,disabled,onClick:handleClick,ref:buttonRef,children})}):null}LayerAction.displayName="LayerAction";const layerAction=(0,src.X$)(LayerAction);const groupLayerActions=(0,src.X$)((function GroupLayerActions(_ref){let{groupId}=_ref;const{groups,updateGroupById,deleteGroupAndElementsById,updateElementsById,duplicateGroupById,groupLayers}=(0,app.rB)((_ref2=>{let{actions,state}=_ref2;return{groups:state.currentPage.groups,updateGroupById:actions.updateGroupById,deleteGroupAndElementsById:actions.deleteGroupAndElementsById,updateElementsById:actions.updateElementsById,duplicateGroupById:actions.duplicateGroupById,groupLayers:state.currentPage.elements.filter((el=>el.groupId===groupId))}})),group=groups[groupId],allLayersHidden=groupLayers.every((layer=>layer.isHidden)),visibilityTitle=allLayersHidden?(0,i18n.__)("Show Group","web-stories"):(0,i18n.__)("Hide Group","web-stories"),lockTitle=group.isLocked?(0,i18n.__)("Unlock Group","web-stories"):(0,i18n.__)("Lock Group","web-stories"),{name,isLocked,isCollapsed}=group,handleHideGroup=(0,src.I4)((()=>{updateElementsById({elementIds:groupLayers.map((layer=>layer.id)),properties:{isHidden:!allLayersHidden}})}),[allLayersHidden,groupLayers,updateElementsById]),handleLockGroup=(0,src.I4)((()=>{updateGroupById({groupId,properties:{isLocked:!isLocked}}),updateElementsById({elementIds:groupLayers.map((layer=>layer.id)),properties:{isLocked:!isLocked}})}),[groupId,groupLayers,isLocked,updateElementsById,updateGroupById]),handleDuplicateGroup=(0,src.I4)((()=>{const newGroupId=(0,v4.Z)(),newGroupName=(0,generateGroupName.Z)(groups,name);duplicateGroupById({oldGroupId:groupId,groupId:newGroupId,name:newGroupName,isLocked,isCollapsed})}),[duplicateGroupById,name,isLocked,isCollapsed,groupId,groups]),handleDeleteGroup=(0,src.I4)((()=>deleteGroupAndElementsById({groupId})),[groupId,deleteGroupAndElementsById]),VisibilityIcon=allLayersHidden?visibility_off.Z:visibility.Z;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(layerAction,{label:(0,i18n.__)("Delete Group","web-stories"),handleClick:handleDeleteGroup,children:(0,jsx_runtime.jsx)(trash.Z,{})}),(0,jsx_runtime.jsx)(layerAction,{label:(0,i18n.__)("Duplicate Group","web-stories"),handleClick:handleDuplicateGroup,children:(0,jsx_runtime.jsx)(page_plus.Z,{})}),(0,jsx_runtime.jsx)(layerAction,{label:visibilityTitle,handleClick:handleHideGroup,children:(0,jsx_runtime.jsx)(VisibilityIcon,{})}),(0,jsx_runtime.jsx)(layerAction,{label:lockTitle,handleClick:handleLockGroup,children:isLocked?(0,jsx_runtime.jsx)(lock_closed.Z,{}):(0,jsx_runtime.jsx)(lock_open.Z,{})})]})}));var input=__webpack_require__("./packages/design-system/src/components/input/input.tsx");const fadeOutCss=(0,styled_components_browser_esm.iv)(["background-color:var(--background-color);::before{position:absolute;content:'';width:32px;height:100%;top:0;left:0;transform:translateX(-100%);background:linear-gradient( to right,var(--background-color-opaque),var(--background-color) );pointer-events:none;}"]),ActionsContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerComponents__ActionsContainer",componentId:"sc-sxidj-0"})(["position:absolute;display:none;align-items:center;height:100%;top:0;right:0;padding-right:6px;column-gap:6px;",""],fadeOutCss),LayerContainer=styled_components_browser_esm.ZP.div.attrs({"data-testid":"layer-option"}).withConfig({displayName:"layerComponents__LayerContainer",componentId:"sc-sxidj-1"})(["position:relative;height:","px;width:100%;overflow:hidden;--background-color:",";--background-color-opaque:",";:is(:hover,:focus-within) ","{display:inline-flex;}"],35,(_ref=>{let{theme}=_ref;return theme.colors.bg.secondary}),(_ref2=>{let{theme}=_ref2;return(0,polished_esm.m4)(theme.colors.bg.secondary,0)}),ActionsContainer),LayerButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:button_constants.L$.Plain,tabIndex:-1,role:"option"}).withConfig({displayName:"layerComponents__LayerButton",componentId:"sc-sxidj-2"})(["position:relative;display:grid;grid-template-columns:auto 1fr;gap:12px;border:0;padding:0;background:transparent;height:100%;width:100%;overflow:hidden;align-items:center;user-select:none;border-radius:0;padding-left:","px;transition:revert;"," :hover{background:",";}:hover,:hover + *{--background-color:",";--background-color-opaque:",";}:active{background:",";}:active,:active + *{--background-color:",";--background-color-opaque:",";}"],(_ref3=>{let{isNested}=_ref3;return isNested?30:12}),(_ref4=>{let{isSelected,theme}=_ref4;return isSelected&&(0,styled_components_browser_esm.iv)(["background:",";&,& + *{--background-color:",";--background-color-opaque:",";--selected-hover-color:",";}"],theme.colors.interactiveBg.tertiaryPress,theme.colors.interactiveBg.tertiaryPress,(0,polished_esm.m4)(theme.colors.interactiveBg.tertiaryPress,0),theme.colors.interactiveBg.tertiaryHover)}),(_ref5=>{let{theme}=_ref5;return theme.colors.interactiveBg.tertiaryHover}),(_ref6=>{let{theme}=_ref6;return theme.colors.interactiveBg.tertiaryHover}),(_ref7=>{let{theme}=_ref7;return(0,polished_esm.m4)(theme.colors.interactiveBg.tertiaryHover,0)}),(_ref8=>{let{theme}=_ref8;return theme.colors.interactiveBg.tertiaryPress}),(_ref9=>{let{theme}=_ref9;return theme.colors.interactiveBg.tertiaryPress}),(_ref10=>{let{theme}=_ref10;return(0,polished_esm.m4)(theme.colors.interactiveBg.tertiaryPress,0)})),LayerInputWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerComponents__LayerInputWrapper",componentId:"sc-sxidj-3"})(["display:grid;grid-template-columns:23px 1fr;gap:12px;height:100%;width:100%;padding-left:","px;padding-right:10px;:hover{background:",";}:hover,:hover + *{--background-color:",";--background-color-opaque:",";}"],(_ref11=>{let{isNested}=_ref11;return isNested?30:12}),(_ref12=>{let{theme}=_ref12;return theme.colors.interactiveBg.tertiaryHover}),(_ref13=>{let{theme}=_ref13;return theme.colors.interactiveBg.tertiaryHover}),(_ref14=>{let{theme}=_ref14;return(0,polished_esm.m4)(theme.colors.interactiveBg.tertiaryHover,0)})),LayerDescription=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerComponents__LayerDescription",componentId:"sc-sxidj-4"})(["position:relative;width:100%;overflow:hidden;display:flex;align-items:center;margin-left:0;text-align:left;color:",";"],(_ref15=>{let{theme}=_ref15;return theme.colors.fg.primary})),LayerText=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).attrs({size:types.TextSize.Small}).withConfig({displayName:"layerComponents__LayerText",componentId:"sc-sxidj-5"})(["color:inherit;white-space:nowrap;text-overflow:' ';overflow:hidden;max-width:100%;",";"],(_ref16=>{let{isHidden}=_ref16;return isHidden&&(0,styled_components_browser_esm.iv)(["opacity:0.3;"])})),LayerIconWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerComponents__LayerIconWrapper",componentId:"sc-sxidj-6"})(["",";"],(_ref17=>{let{isHidden}=_ref17;return isHidden&&(0,styled_components_browser_esm.iv)(["opacity:0.3;"])})),FadeOutWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerComponents__FadeOutWrapper",componentId:"sc-sxidj-7"})(["display:flex;align-items:center;justify-content:flex-start;position:absolute;right:0;aspect-ratio:1;",""],fadeOutCss),layerComponents_IconWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerComponents__IconWrapper",componentId:"sc-sxidj-8"})(["display:flex;align-items:center;justify-content:flex-start;width:32px;aspect-ratio:1;svg{position:relative;display:block;width:100%;color:",";}"],(_ref18=>{let{theme}=_ref18;return theme.colors.fg.secondary})),HiddenIconWrapper=(0,styled_components_browser_esm.ZP)(layerComponents_IconWrapper).withConfig({displayName:"layerComponents__HiddenIconWrapper",componentId:"sc-sxidj-9"})(["margin-right:-6px;"]),LayerContentContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerComponents__LayerContentContainer",componentId:"sc-sxidj-10"})(["margin-right:8px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),LayerInput=(0,styled_components_browser_esm.ZP)(input.Z).withConfig({displayName:"layerComponents__LayerInput",componentId:"sc-sxidj-11"})(["overflow:visible;div{height:100%;}"]),LayerInputForm=(0,styled_components_browser_esm.ZP)(LayerDescription).attrs({as:"form"}).withConfig({displayName:"layerComponents__LayerInputForm",componentId:"sc-sxidj-12"})(["overflow:visible;"]),stopPropagation=evt=>evt.stopPropagation();function LayerForm(_ref){let{layerName,handleNewLayerName}=_ref;const[newLayerName,setNewLayerName]=(0,src.eJ)(layerName),setRenamableLayer=(0,app.$P)((_ref2=>{let{actions}=_ref2;return actions.setRenamableLayer}));(0,src.d4)((()=>{setNewLayerName(layerName)}),[layerName]);const updateLayerName=()=>{setRenamableLayer(null);const trimmedLayerName=newLayerName.trim();trimmedLayerName&&handleNewLayerName(trimmedLayerName)};return(0,jsx_runtime.jsxs)(LayerInputForm,{onSubmit:evt=>{evt.preventDefault(),updateLayerName()},children:[(0,jsx_runtime.jsx)(LayerInput,{tabIndex:-1,"aria-label":(0,i18n.__)("Layer Name","web-stories"),value:newLayerName,onChange:evt=>{setNewLayerName(evt.target.value)},onKeyDown:evt=>{"Escape"===evt.key&&(setNewLayerName(layerName),setRenamableLayer(null))},onBlur:updateLayerName,onPointerDown:stopPropagation,hasFocus:!0}),(0,jsx_runtime.jsx)("button",{hidden:!0})]})}LayerForm.displayName="LayerForm";const layerForm=(0,src.X$)(LayerForm);function layer_Layer(_ref){let{id,handleNewLayerName,layerName,handleClick,isSelected,LayerIcon,hasLayerLockIcon,hasLayerHiddenIcon,LayerLockIcon,LayerVisibilityIcon,actions,hasActions=!0,isNested=!1,skipLayer=!1,trackingData=null}=_ref;const renamableLayer=(0,app.$P)((_ref2=>{let{state}=_ref2;return state.renamableLayer})),layerRef=(0,src.sO)(null);if((0,usePerformanceTracking.Z)({node:trackingData?layerRef.current:null,eventData:trackingData}),skipLayer)return null;const layerId=`layer-${id}`,isRenameable=renamableLayer?.elementId===id;return(0,jsx_runtime.jsx)(LayerContainer,{children:isRenameable?(0,jsx_runtime.jsxs)(LayerInputWrapper,{isNested,children:[(0,jsx_runtime.jsx)(LayerIcon,{}),(0,jsx_runtime.jsx)(layerForm,{handleNewLayerName,layerName})]}):(0,jsx_runtime.jsxs)(layerIdContext.Provider,{value:layerId,children:[(0,jsx_runtime.jsxs)(LayerButton,{ref:layerRef,id:layerId,onClick:handleClick,isSelected,isNested,children:[(0,jsx_runtime.jsx)(LayerIconWrapper,{isHidden:hasLayerHiddenIcon,children:(0,jsx_runtime.jsx)(LayerIcon,{})}),(0,jsx_runtime.jsxs)(LayerDescription,{children:[(0,jsx_runtime.jsx)(LayerContentContainer,{children:(0,jsx_runtime.jsx)(LayerText,{isHidden:hasLayerHiddenIcon,children:layerName})}),(hasLayerHiddenIcon||hasLayerLockIcon)&&(0,jsx_runtime.jsxs)(FadeOutWrapper,{children:[hasLayerHiddenIcon&&(0,jsx_runtime.jsx)(HiddenIconWrapper,{children:hasLayerHiddenIcon&&(0,jsx_runtime.jsx)(LayerVisibilityIcon,{})}),(hasLayerHiddenIcon||hasLayerLockIcon)&&(0,jsx_runtime.jsx)(layerComponents_IconWrapper,{children:hasLayerLockIcon&&(0,jsx_runtime.jsx)(LayerLockIcon,{})})]})]})]}),hasActions&&(0,jsx_runtime.jsx)(ActionsContainer,{children:actions})]})})}layer_Layer.displayName="Layer";const layer_layer=(0,src.X$)(layer_Layer),GroupIconsWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"groupLayer__GroupIconsWrapper",componentId:"sc-gchq7p-0"})(["display:flex;align-items:center;justify-content:flex-start;width:48px;svg{position:relative;display:block;width:100%;color:",";}transform:translateX(-12px);margin-right:-12px;"],(_ref=>{let{theme}=_ref;return theme.colors.fg.secondary})),ChevronDown=(0,styled_components_browser_esm.ZP)(chevron_down.Z).withConfig({displayName:"groupLayer__ChevronDown",componentId:"sc-gchq7p-1"})(["min-width:32px;min-height:32px;"]),ChevronRight=(0,styled_components_browser_esm.ZP)(chevron_down.Z).withConfig({displayName:"groupLayer__ChevronRight",componentId:"sc-gchq7p-2"})(["min-width:32px;min-height:32px;transform:rotate(-90deg);"]);function GroupLayer(_ref2){let{groupId}=_ref2;const{groups,updateGroupById,groupLayers}=(0,app.rB)((_ref3=>{let{actions,state}=_ref3;return{groups:state.currentPage.groups,updateGroupById:actions.updateGroupById,groupLayers:state.currentPage.elements.filter((el=>el.groupId===groupId))}})),{name,isLocked,isCollapsed}=groups[groupId],{isSelected,handleClick}=layer_useGroupSelection(groupId),handleGroupArrowClick=(0,src.I4)((()=>{updateGroupById({groupId,properties:{isCollapsed:!isCollapsed}})}),[isCollapsed,groupId,updateGroupById]),GroupLayerIcon=(0,src.I4)((()=>(0,jsx_runtime.jsxs)(GroupIconsWrapper,{children:[isCollapsed?(0,jsx_runtime.jsx)(ChevronRight,{onClick:handleGroupArrowClick}):(0,jsx_runtime.jsx)(ChevronDown,{onClick:handleGroupArrowClick}),(0,jsx_runtime.jsx)(group.Z,{})]})),[handleGroupArrowClick,isCollapsed]),allLayersHidden=groupLayers.every((layer=>layer.isHidden));return(0,jsx_runtime.jsx)(layer_layer,{id:groupId,handleNewLayerName:newLayerName=>updateGroupById({groupId,properties:{name:newLayerName}}),layerName:name,handleClick,hasLayerHiddenIcon:allLayersHidden,isSelected,LayerIcon:GroupLayerIcon,LayerVisibilityIcon:()=>allLayersHidden&&(0,jsx_runtime.jsx)(visibility_off.Z,{}),hasLayerLockIcon:isLocked,LayerLockIcon:lock_closed.Z,actions:(0,jsx_runtime.jsx)(groupLayerActions,{groupId})})}GroupLayer.displayName="GroupLayer";const groupLayer=(0,src.X$)(GroupLayer),LayerSeparator=(0,styled_components_browser_esm.ZP)(reorderableSeparator).withConfig({displayName:"reorderableGroupLayer__LayerSeparator",componentId:"sc-zozo8e-0"})(["height:","px;margin:-","px 0;padding:","px 0;"],35,17.5,17.5),reorderableGroupLayer=(0,src.X$)((function ReorderableGroup(_ref){let{id,position,handleStartReordering}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LayerSeparator,{groupId:null,position:position+1}),(0,jsx_runtime.jsx)(reorderableItem,{position,data:{group:id},onStartReordering:handleStartReordering({id}),children:(0,jsx_runtime.jsx)(groupLayer,{groupId:id})})]})}));var lock_filled_closed=__webpack_require__("./packages/design-system/src/icons/lock_filled_closed.svg");const layer_useLayerSelection=function useLayerSelection(layer){const{id:elementId}=layer,{isSelected,toggleLayer}=(0,app.rB)((_ref=>{let{state,actions}=_ref;return{isSelected:state.selectedElementIds.includes(elementId),toggleLayer:actions.toggleLayer}})),setRenamableLayer=(0,app.$P)((_ref2=>{let{actions}=_ref2;return actions.setRenamableLayer}));return{isSelected,handleClick:(0,src.I4)((evt=>{evt.preventDefault(),evt.stopPropagation(),toggleLayer({elementId,metaKey:evt.metaKey,shiftKey:evt.shiftKey,withLinked:!1});2===evt.detail&&setRenamableLayer({elementId})}),[toggleLayer,elementId,setRenamableLayer])}};var useShapeMask=__webpack_require__("./packages/story-editor/src/utils/useShapeMask.js");const MaskedIconWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"shapeMaskWrapper__MaskedIconWrapper",componentId:"sc-1blxy5z-0"})(["position:relative;clip-path:url(#",");"],(_ref=>{let{maskId}=_ref;return maskId}));function ShapeMaskWrapper(_ref2){let{element,children}=_ref2;const{hasShapeMask}=(0,useShapeMask.Z)(element);return hasShapeMask?(0,jsx_runtime.jsx)(MaskedIconWrapper,{maskId:(0,masks_src.eV)(element,"frame"),children}):children}ShapeMaskWrapper.displayName="ShapeMaskWrapper";const shapeMaskWrapper=ShapeMaskWrapper;var remove_mask=__webpack_require__("./packages/design-system/src/icons/remove_mask.svg");const elementLayerActions=(0,src.X$)((function ElementLayerActions(_ref){let{element}=_ref;const{hasDuplicateMenu}=(0,elements_src.Do)(element.type),{duplicateElementsById,updateElementById,deleteElementById}=(0,app.rB)((_ref2=>{let{actions}=_ref2;return{duplicateElementsById:actions.duplicateElementsById,deleteElementById:actions.deleteElementById,updateElementById:actions.updateElementById}})),{hasShapeMask,removeShapeMask}=(0,useShapeMask.Z)(element),removeMaskTitle=(0,i18n.__)("Unmask","web-stories"),isNested=Boolean(element.groupId),{isLocked,isHidden}=element,lockTitle=(0,src.Ye)((()=>isNested?isLocked?(0,i18n.__)("Group is Locked","web-stories"):(0,i18n.__)("Group is Unlocked","web-stories"):isLocked?(0,i18n.__)("Unlock Layer","web-stories"):(0,i18n.__)("Lock Layer","web-stories")),[isLocked,isNested]),visibilityTitle=isHidden?(0,i18n.__)("Show Layer","web-stories"):(0,i18n.__)("Hide Layer","web-stories"),handleDeleteElement=(0,src.I4)((()=>deleteElementById({elementId:element.id})),[deleteElementById,element.id]),handleDuplicateElement=(0,src.I4)((()=>duplicateElementsById({elementIds:[element.id]})),[duplicateElementsById,element.id]),handleLockElement=(0,src.I4)((()=>updateElementById({elementId:element.id,properties:{isLocked:!isLocked}})),[element.id,isLocked,updateElementById]),handleHideElement=(0,src.I4)((()=>updateElementById({elementId:element.id,properties:{isHidden:!isHidden}})),[element.id,isHidden,updateElementById]),LockIcon=isLocked?lock_closed.Z:lock_open.Z,VisibilityIcon=isHidden?visibility_off.Z:visibility.Z;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(layerAction,{isActive:hasShapeMask,label:removeMaskTitle,handleClick:removeShapeMask,children:(0,jsx_runtime.jsx)(remove_mask.Z,{})}),(0,jsx_runtime.jsx)(layerAction,{label:(0,i18n.__)("Delete Layer","web-stories"),handleClick:handleDeleteElement,trackingData:{...constants.Iy.DELETE_ELEMENT,label:element.type},children:(0,jsx_runtime.jsx)(trash.Z,{})}),(0,jsx_runtime.jsx)(layerAction,{isActive:hasDuplicateMenu,label:(0,i18n.__)("Duplicate Layer","web-stories"),handleClick:handleDuplicateElement,children:(0,jsx_runtime.jsx)(page_plus.Z,{})}),(0,jsx_runtime.jsx)(layerAction,{label:visibilityTitle,handleClick:handleHideElement,children:(0,jsx_runtime.jsx)(VisibilityIcon,{})}),(0,jsx_runtime.jsx)(layerAction,{label:lockTitle,disabled:isNested,handleClick:handleLockElement,children:isNested?(0,jsx_runtime.jsx)(lock_filled_closed.Z,{}):(0,jsx_runtime.jsx)(LockIcon,{})})]})})),elementLayer_LayerIconWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"elementLayer__LayerIconWrapper",componentId:"sc-ndwsm1-0"})(["display:flex;align-items:center;justify-content:flex-start;color:",";:hover{background:",";}:hover,:hover + *{--background-color:",";--background-color-opaque:",";}"],(_ref=>{let{theme}=_ref;return theme.colors.fg.primary}),(_ref2=>{let{theme}=_ref2;return theme.colors.interactiveBg.tertiaryHover}),(_ref3=>{let{theme}=_ref3;return theme.colors.interactiveBg.tertiaryHover}),(_ref4=>{let{theme}=_ref4;return(0,polished_esm.m4)(theme.colors.interactiveBg.tertiaryHover,0)}));function ElementLayer(_ref5){let{element}=_ref5;const layerName=(0,elements_src.Ph)(element),{LayerIcon}=(0,elements_src.Do)(element.type),{isSelected,handleClick}=layer_useLayerSelection(element),{id,isDefaultBackground,isBackground,type}=element,{updateElementById,currentPageBackgroundColor,groups}=(0,app.rB)((_ref6=>{let{actions,state}=_ref6;return{updateElementById:actions.updateElementById,groups:state.currentPage?.groups||{},currentPageBackgroundColor:!isDefaultBackground||state.currentPage?.backgroundColor}})),{getProxiedUrl}=(0,useCORSProxy.Z)(),isNested=Boolean(element.groupId),group=groups[element.groupId],CompoundLayerIcon=(0,src.I4)((()=>(0,jsx_runtime.jsx)(elementLayer_LayerIconWrapper,{children:(0,jsx_runtime.jsx)(shapeMaskWrapper,{element,children:(0,jsx_runtime.jsx)(LayerIcon,{element,getProxiedUrl,currentPageBackgroundColor})})})),[currentPageBackgroundColor,element,getProxiedUrl]),hasLayerHiddenIcon=element.isHidden,hasLayerLockIcon=Boolean(isBackground||element.isLocked),LayerLockIcon=(0,src.I4)((()=>isBackground||isNested?(0,jsx_runtime.jsx)(lock_filled_closed.Z,{}):(0,jsx_runtime.jsx)(lock_closed.Z,{})),[isBackground,isNested]);return(0,jsx_runtime.jsx)(layer_layer,{id,handleNewLayerName:newLayerName=>updateElementById({elementId:element.id,properties:{layerName:newLayerName}}),layerName,handleClick,isSelected,LayerIcon:CompoundLayerIcon,hasLayerLockIcon,hasLayerHiddenIcon,LayerLockIcon,LayerVisibilityIcon:()=>element.isHidden&&(0,jsx_runtime.jsx)(visibility_off.Z,{}),hasActions:!isBackground,actions:(0,jsx_runtime.jsx)(elementLayerActions,{element}),isNested,skipLayer:group?.isCollapsed,trackingData:{...constants.Iy.SELECT_ELEMENT,label:type}})}ElementLayer.displayName="ElementLayer";const elementLayer=(0,src.X$)(ElementLayer),reorderableElementLayer_LayerSeparator=(0,styled_components_browser_esm.ZP)(reorderableSeparator).withConfig({displayName:"reorderableElementLayer__LayerSeparator",componentId:"sc-1ed8ff9-0"})(["height:","px;margin:-","px 0;padding:","px 0;"],35,17.5,17.5),ReorderableLayer=(0,src.X$)((function ReorderableLayer(_ref){let{id,position,nestedOffset,nestedOffsetCalcFunc,handleStartReordering}=_ref;const element=(0,app.rB)((_ref2=>{let{state}=_ref2;return state.currentPage?.elements.find((el=>el.id===id))}));return element?(0,jsx_runtime.jsxs)(src.HY,{children:[(0,jsx_runtime.jsx)(reorderableElementLayer_LayerSeparator,{groupId:element.groupId,nestedOffset:Boolean(nestedOffset),nestedOffsetCalcFunc,position:position+1,isNested:element.groupId}),(0,jsx_runtime.jsx)(reorderableItem,{position,onStartReordering:handleStartReordering(element),disabled:element.isBackground,children:(0,jsx_runtime.jsx)(elementLayer,{element})})]},id):null})),reorderableElementLayer=ReorderableLayer;function ReorderableElement(_ref){let{isGroup,isFirstElementAfterGroup=!1,...rest}=_ref;const setSelectedElementsById=(0,app.rB)((_ref2=>{let{actions}=_ref2;return actions.setSelectedElementsById})),focusCanvas=(0,useFocusCanvas.Z)(),renamableLayer=(0,app.$P)((_ref3=>{let{state}=_ref3;return state.renamableLayer})),props={...rest,handleStartReordering:(0,src.I4)((element=>()=>{setSelectedElementsById({elementIds:[element.id]}),renamableLayer&&focusCanvas()}),[setSelectedElementsById,focusCanvas,renamableLayer])};return isGroup?(0,jsx_runtime.jsx)(reorderableGroupLayer,{...props}):(0,jsx_runtime.jsx)(reorderableElementLayer,{nestedOffset:isFirstElementAfterGroup,nestedOffsetCalcFunc,...props})}ReorderableElement.displayName="ReorderableElement";const reorderableLayer=ReorderableElement;__webpack_require__("./node_modules/core-js/modules/esnext.set.difference.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.intersection.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-disjoint-from.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-subset-of.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-superset-of.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.symmetric-difference.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.union.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.array.group.js");const layer_useLayers=function useLayers(){const{elements,arrangeElement,arrangeGroup}=(0,app.rB)((_ref=>{let{state,actions}=_ref;return{elements:state.currentPage?.elements||[],arrangeElement:actions.arrangeElement,arrangeGroup:actions.arrangeGroup}})),elementLayers=(0,src.Ye)((()=>elements.map(((_ref2,position)=>{let{id,groupId,layerName}=_ref2;return{id,groupId,layerName,position}}))),[elements]);elementLayers.reverse();const layers=(0,src.Ye)((()=>{const groupIds=new Set;return elementLayers.map(((element,index,list)=>{const elementLayer={isGroup:!1,isFirstElementAfterGroup:index>0&&Boolean(list[index-1].groupId),id:element.id,position:element.position};if(!(element.groupId&&!groupIds.has(element.groupId)))return elementLayer;groupIds.add(element.groupId);return[{isGroup:!0,id:element.groupId,position:element.position,name:element.groupId},elementLayer]})).flat()}),[elementLayers]);return{layers,handleDragPosition:(0,src.I4)(((oldPosObj,newPosObj,evt)=>{const{position:oldPos}=oldPosObj,{position:newPos,data:{groupId:newGroupId}}=newPosObj,offsetTopHalf=nestedOffsetCalcFunc(evt),oldPosElement=elementLayers.find((e=>e.position===oldPos)),elementAboveNewPos=elementLayers.find((e=>e.position===(newPos<=2?1:newPos+1)));let groupId=newGroupId;offsetTopHalf&&elementAboveNewPos?.groupId&&(groupId=elementAboveNewPos.groupId),oldPosObj.data?.group?newPosObj.data?.groupId||arrangeGroup({groupId:oldPosObj.data.group,position:newPos}):arrangeElement({elementId:oldPosElement.id,position:newPos,groupId})}),[arrangeElement,arrangeGroup,elementLayers])}},ReorderableLayerList=(0,styled_components_browser_esm.ZP)(reorderable).attrs({"aria-orientation":"vertical","aria-label":(0,i18n.__)("Layers List","web-stories")}).withConfig({displayName:"layerList__ReorderableLayerList",componentId:"sc-1ykjl19-0"})(["flex-direction:column;width:100%;height:100%;align-items:stretch;user-select:",";overflow-y:auto;padding-bottom:4px;"],(_ref=>{let{hasUserSelect}=_ref;return hasUserSelect?"none":"initial"}));function LayerList(){const onOpenMenu=(0,app.LG)((value=>value.onOpenMenu)),{layers,handleDragPosition}=layer_useLayers();return 0===layers.length?null:(0,jsx_runtime.jsx)(ReorderableLayerList,{onContextMenu:onOpenMenu,onPositionChange:handleDragPosition,mode:"vertical",getItemSize:()=>35,children:layers.map((layer=>(0,jsx_runtime.jsx)(reorderableLayer,{...layer},layer.id)))})}LayerList.displayName="LayerList";const layerList=LayerList,layerPanel_Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"layerPanel__Container",componentId:"sc-1ogzglc-0"})(["filter:drop-shadow(0px -4px 8px rgba(0,0,0,0.2));max-height:","px;background-color:",";"],(_ref=>{let{maxHeight}=_ref;return maxHeight}),(_ref2=>{let{theme}=_ref2;return theme.colors.bg.secondary}));function LayerPanel(){const sidebarContentHeight=(0,useSidebar.Z)((_ref3=>{let{state}=_ref3;return state.sidebarContentHeight}));return(0,jsx_runtime.jsx)(layerPanel_Container,{maxHeight:sidebarContentHeight,children:(0,jsx_runtime.jsx)(panel.KG,{padding:"0",children:(0,jsx_runtime.jsx)(layerList,{})})})}LayerPanel.displayName="LayerPanel";const layerPanel=(0,src.X$)(LayerPanel);var secondaryPopup=__webpack_require__("./packages/story-editor/src/components/secondaryPopup/index.js");const layers_Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"layers__Container",componentId:"sc-12gh0kb-0"})(["background-color:",";overflow:auto;z-index:",";"],(_ref=>{let{theme}=_ref;return theme.colors.bg.secondary}),zIndex.FM),StyledNavigationWrapper=(0,styled_components_browser_esm.ZP)(secondaryPopup.dl).withConfig({displayName:"layers__StyledNavigationWrapper",componentId:"sc-12gh0kb-1"})(["width:260px;"]);const layers_layers=function Layers(){const numElements=(0,app.rB)((_ref2=>{let{state}=_ref2;return state.currentPage?.elements?.length})),[isOpen,setIsOpen]=(0,src.eJ)(!1),ref=(0,src.sO)(),{renamableLayer}=(0,app.$P)((_ref3=>{let{state}=_ref3;return{renamableLayer:state.renamableLayer}}));return(0,src.d4)((()=>{renamableLayer&&setIsOpen(!0)}),[renamableLayer]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(secondaryPopup.ZP,{isOpen,placement:popup_constants.ug.Right,ariaLabel:(0,i18n.__)("Layers Panel","web-stories"),children:(0,jsx_runtime.jsx)(StyledNavigationWrapper,{alignRight:!0,ref,isOpen,children:(0,jsx_runtime.jsx)(layers_Container,{children:(0,jsx_runtime.jsx)(layerPanel,{})})})}),(0,jsx_runtime.jsx)(toggleButton.C,{hasMenuList:!0,isOpen,notificationCount:numElements,copy:(0,i18n.__)("Layers","web-stories"),onClick:()=>setIsOpen((state=>!state)),"aria-label":(0,sprintf.Z)((0,i18n.__)("Layers (%d)","web-stories"),numElements)})]})};var box_with_dots=__webpack_require__("./packages/design-system/src/icons/box_with_dots.svg"),styles=__webpack_require__("./packages/story-editor/src/app/highlights/styles.js");const toolbarToggle_StyledButton=(0,styled_components_browser_esm.ZP)(toggleButton.C).withConfig({displayName:"toolbarToggle__StyledButton",componentId:"sc-1hbzga5-0"})(["",""],(_ref=>{let{isHighlighted}=_ref;return isHighlighted&&(0,styled_components_browser_esm.iv)([""," ",""],styles.Z.OUTLINE,styles.Z.FLASH)})),LOCAL_STORAGE_KEY=localStore.h.ELEMENT_TOOLBAR_SETTINGS;function ToolbarToggle(){const{displayFloatingMenu,setDisplayFloatingMenu}=(0,app.$P)((_ref2=>{let{state,actions}=_ref2;return{displayFloatingMenu:state.displayFloatingMenu,setDisplayFloatingMenu:actions.setDisplayFloatingMenu}})),{highlight,resetHighlight}=(0,highlights.QM)((state=>({highlight:state[highlights.$q.ElementToolbarToggle],resetHighlight:state.onFocusOut})));return displayFloatingMenu?null:(0,jsx_runtime.jsx)(tooltip.Z,{title:(0,i18n.__)("Show element toolbar","web-stories"),placement:popup_constants.ug.Top,hasTail:!0,children:(0,jsx_runtime.jsx)(toolbarToggle_StyledButton,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&node.focus()},onClick:()=>{const local=localStore.W.getItemByKey(LOCAL_STORAGE_KEY)||{};localStore.W.setItemByKey(LOCAL_STORAGE_KEY,{...local,isDisplayed:!0}),setDisplayFloatingMenu(!0)},"aria-label":(0,i18n.__)("Show element toolbar","web-stories"),label:(0,i18n.__)("Show element toolbar","web-stories"),isOpen:!1,isHighlighted:highlight?.showEffect,onAnimationEnd:()=>resetHighlight(),MainIcon:box_with_dots.Z})})}ToolbarToggle.displayName="ToolbarToggle";const toolbarToggle=ToolbarToggle,primaryMenu_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"primaryMenu__Wrapper",componentId:"sc-1n6k8y9-0"})(["display:flex;align-items:flex-end;justify-content:flex-end;width:100%;height:100%;z-index:",";"],zIndex.FM),MenuItems=styled_components_browser_esm.ZP.div.withConfig({displayName:"primaryMenu__MenuItems",componentId:"sc-1n6k8y9-1"})(["position:relative;display:flex;flex-direction:row;align-items:center;margin-right:","px;gap:","px;"],16,8);function PrimaryMenu(){return(0,jsx_runtime.jsx)(primaryMenu_Wrapper,{children:(0,jsx_runtime.jsxs)(MenuItems,{id:"primary-menu-items",children:[(0,jsx_runtime.jsx)(toolbarToggle,{}),(0,jsx_runtime.jsx)(zoomSelector,{}),(0,jsx_runtime.jsx)(gridViewButton,{}),(0,jsx_runtime.jsx)(layers_layers,{})]})})}PrimaryMenu.displayName="PrimaryMenu";const primaryMenu=PrimaryMenu;var icons_keyboard=__webpack_require__("./packages/design-system/src/icons/keyboard.svg"),keyboardOnlyOutline=__webpack_require__("./packages/story-editor/src/utils/keyboardOnlyOutline.js"),shortcutMenu=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/shortcutMenu.js"),keyboardShortcutsMenu_constants=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/constants.js");const keyboardShortcutsMenu_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"keyboardShortcutsMenu__Wrapper",componentId:"sc-1nngfyy-0"})(["z-index:",";"],zIndex.FM);function KeyboardShortcutsMenu(){const anchorRef=(0,src.sO)(),wrapperRef=(0,src.sO)(),{close,toggle,isOpen}=(0,keyboardShortcutsMenuContext.A)((_ref=>{let{actions:{close,toggle},state:{isOpen}}=_ref;return{close,toggle,isOpen}}));return(0,src.d4)((()=>{(0,keyboardOnlyOutline.pz)()&&!isOpen&&anchorRef?.current?.focus?.()}),[isOpen]),(0,keyboard.xb)(keyboardShortcutsMenu_constants.H,toggle,[toggle]),(0,src.FR)(wrapperRef,close,[close]),(0,jsx_runtime.jsx)(directionAware.Z,{children:(0,jsx_runtime.jsxs)(keyboardShortcutsMenu_Wrapper,{ref:wrapperRef,children:[(0,jsx_runtime.jsx)(secondaryPopup.ZP,{popupId:"keyboard_shortcut_menu",isOpen,ariaLabel:(0,i18n.__)("Keyboard Shortcuts","web-stories"),children:(0,jsx_runtime.jsx)(shortcutMenu.Z,{toggleMenu:toggle})}),(0,jsx_runtime.jsx)(toggleButton.C,{ref:anchorRef,isOpen,"aria-owns":"keyboard_shortcut_menu",onClick:toggle,"aria-label":(0,i18n.__)("Keyboard Shortcuts","web-stories"),label:(0,i18n.__)("Keyboard Shortcuts","web-stories"),MainIcon:icons_keyboard.Z,shortcut:"mod+/"})]})})}KeyboardShortcutsMenu.displayName="KeyboardShortcutsMenu";const keyboardShortcutsMenu=KeyboardShortcutsMenu;var global_styles=__webpack_require__("./packages/design-system/src/theme/global/styles.ts"),helpCenter=__webpack_require__("./packages/story-editor/src/app/helpCenter/index.ts"),helpCenter_constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),helpCenter_navigator=__webpack_require__("./packages/story-editor/src/components/helpCenter/navigator/index.js"),TransitionGroup=__webpack_require__("./node_modules/react-transition-group/esm/TransitionGroup.js"),helpCenter_menu=__webpack_require__("./packages/story-editor/src/components/helpCenter/menu/index.js"),quickTip=__webpack_require__("./packages/story-editor/src/components/helpCenter/quickTip/index.js");function Companion(_ref){let{tipKey,onTipSelect,isLeftToRightTransition,readTips,components}=_ref;const{state:{tips}}=(0,app.Do)(),TIP_MAP={...tips,[helpCenter_constants.eZ[0]]:helpCenter_constants.eZ[1]},tip=tipKey&&TIP_MAP[tipKey];return(0,jsx_runtime.jsx)(TransitionGroup.Z,{children:tip?(0,jsx_runtime.jsx)(quickTip._,{isDone:tipKey===helpCenter_constants.eZ[0],transitionKey:tipKey,isLeftToRightTransition,...tip},tipKey):(0,jsx_runtime.jsx)(helpCenter_menu.v,{readTips,onTipSelect,components},"menu")})}Companion.displayName="Companion";const companion=(0,src.X$)(Companion);var toggle=__webpack_require__("./packages/story-editor/src/components/helpCenter/toggle/index.js"),helpCenter_utils=__webpack_require__("./packages/story-editor/src/components/helpCenter/utils.js");const helpCenter_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"helpCenter__Wrapper",componentId:"sc-12zoy5g-0"})(["z-index:",";"],zIndex.FM),HelpCenter=_ref=>{let{components}=_ref;const ref=(0,src.sO)(null),{state,actions}=(0,helpCenter.D)();return(0,src.d4)((()=>{state.isOpen&&(0,helpCenter_utils.o)()}),[state.isOpen]),(0,story._Z)(story.xw.onReplaceBackgroundMedia,(0,src.I4)((()=>{actions.openToUnreadTip(helpCenter_constants.tW.ADD_BACKGROUND_MEDIA)}),[actions])),(0,story._Z)(story.xw.onReplaceForegroundMedia,(0,src.I4)((()=>{actions.openToUnreadTip(helpCenter_constants.tW.CROP_SELECTED_ELEMENTS)}),[actions])),(0,jsx_runtime.jsx)(directionAware.Z,{children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(global_styles.z,{}),(0,jsx_runtime.jsxs)(helpCenter_Wrapper,{ref,children:[(0,jsx_runtime.jsx)(secondaryPopup.ZP,{popupId:helpCenter_constants.Uq,isOpen:state.isOpen,ariaLabel:(0,i18n.__)("Help Center","web-stories"),children:(0,jsx_runtime.jsx)(helpCenter_navigator.Z,{isOpen:state.isOpen,onNext:actions.goToNext,onPrev:actions.goToPrev,onAllTips:actions.goToMenu,onClose:actions.close,hasBottomNavigation:state.hasBottomNavigation,isNextDisabled:state.isNextDisabled,isPrevDisabled:state.isPrevDisabled,children:(0,jsx_runtime.jsx)(companion,{readTips:state.readTips,tipKey:state.navigationFlow[state.navigationIndex],onTipSelect:actions.goToTip,isLeftToRightTransition:state.isLeftToRightTransition,components})})}),(0,jsx_runtime.jsx)(toggle.Z,{isOpen:state.isOpen,onClick:actions.toggle,notificationCount:state.unreadTipsCount,popupId:helpCenter_constants.Uq})]})]})})};HelpCenter.displayName="HelpCenter";const secondaryMenu_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"secondaryMenu__Wrapper",componentId:"sc-4921wn-0"})(["display:flex;align-items:flex-end;justify-content:flex-start;width:100%;height:100%;"]),secondaryMenu_MenuItems=styled_components_browser_esm.ZP.div.withConfig({displayName:"secondaryMenu__MenuItems",componentId:"sc-4921wn-1"})(["position:relative;display:flex;flex-direction:row;align-items:center;margin-left:","px;gap:","px;"],16,8),POPUPS_HELP_CENTER="help_center",POPUPS_CHECKLIST="checklist",POPUPS_KEYBOARD_SHORTCUTS="keyboard_shortcuts";function SecondaryMenu(_ref){let{menu}=_ref;const expandedPopupRef=(0,src.sO)(""),{close:closeHelpCenter,isHelpCenterOpen}=(0,app.Do)((_ref2=>{let{actions:{close},state:{isOpen:isHelpCenterOpen}}=_ref2;return{close,isHelpCenterOpen}})),{close:closeChecklist,open:openChecklist,isChecklistOpen}=(0,checklist.M_)((_ref3=>{let{actions:{close,open},state:{isOpen:isChecklistOpen}}=_ref3;return{close,open,isChecklistOpen}})),{close:closeKeyboardShortcutsMenu,isKeyboardShortcutsMenuOpen}=(0,keyboardShortcutsMenuContext.A)((_ref4=>{let{actions:{close},state:{isOpen:isKeyboardShortcutsMenuOpen}}=_ref4;return{close,isKeyboardShortcutsMenuOpen}})),{handleResetReviewChecklist,reviewChecklistRequested}=(0,checklist.Kf)((_ref5=>{let{actions:{handleResetReviewChecklist},state:{reviewChecklistRequested}}=_ref5;return{reviewChecklistRequested,handleResetReviewChecklist}})),isActiveTrimOrEdit=(0,app.$P)((_ref6=>{let{state:{editingElementState:{isTrimMode},isEditing}}=_ref6;return isTrimMode||isEditing})),setPopupRef=(0,src.I4)((function(){let newPopup=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";expandedPopupRef.current=newPopup}),[]);return(0,src.d4)((()=>{isChecklistOpen&&expandedPopupRef.current!==POPUPS_CHECKLIST&&(closeHelpCenter(),closeKeyboardShortcutsMenu(),setPopupRef(POPUPS_CHECKLIST))}),[closeHelpCenter,closeKeyboardShortcutsMenu,isChecklistOpen,setPopupRef]),(0,src.d4)((()=>{isHelpCenterOpen&&expandedPopupRef.current!==POPUPS_HELP_CENTER&&(closeChecklist(),closeKeyboardShortcutsMenu(),setPopupRef(POPUPS_HELP_CENTER))}),[closeChecklist,closeKeyboardShortcutsMenu,isHelpCenterOpen,setPopupRef]),(0,src.d4)((()=>{isKeyboardShortcutsMenuOpen&&expandedPopupRef.current!==POPUPS_KEYBOARD_SHORTCUTS&&(closeChecklist(),closeHelpCenter(),setPopupRef(POPUPS_KEYBOARD_SHORTCUTS))}),[closeChecklist,closeHelpCenter,isKeyboardShortcutsMenuOpen,setPopupRef]),(0,src.d4)((()=>{reviewChecklistRequested&&(setPopupRef(),handleResetReviewChecklist(),openChecklist())}),[reviewChecklistRequested,handleResetReviewChecklist,openChecklist,setPopupRef]),(0,src.d4)((()=>{isActiveTrimOrEdit&&expandedPopupRef.current&&(setPopupRef(),closeChecklist(),closeHelpCenter())}),[closeChecklist,closeHelpCenter,isActiveTrimOrEdit,setPopupRef]),(0,jsx_runtime.jsx)(secondaryMenu_Wrapper,{children:(0,jsx_runtime.jsxs)(secondaryMenu_MenuItems,{children:[(0,jsx_runtime.jsx)(HelpCenter,{components:menu?.helpCenter}),menu?.checklist&&(0,jsx_runtime.jsx)(checklist.W6,{items:menu.checklist}),(0,jsx_runtime.jsx)(keyboardShortcutsMenu,{})]})})}SecondaryMenu.displayName="SecondaryMenu";const secondaryMenu=SecondaryMenu,footerLayout_Wrapper=styled_components_browser_esm.ZP.section.withConfig({displayName:"footerLayout__Wrapper",componentId:"sc-gme2s1-0"})(["position:relative;display:grid;grid:'secondary carousel primary' auto / 1fr minmax(auto,calc(100% - ","px)) 1fr;width:100%;max-width:100%;height:100%;"],3*MAX_MENU_WIDTH),footerLayout_Area=styled_components_browser_esm.ZP.div.withConfig({displayName:"footerLayout__Area",componentId:"sc-gme2s1-1"})(["grid-area:",";display:flex;align-items:flex-end;justify-content:center;z-index:",";"],(_ref=>{let{area}=_ref;return area}),(_ref2=>{let{zIndex="auto"}=_ref2;return zIndex}));function FooterLayout(_ref3){let{footer,zIndex}=_ref3;return(0,jsx_runtime.jsx)(directionAware.Z,{children:(0,jsx_runtime.jsxs)(footerLayout_Wrapper,{"aria-label":(0,i18n.__)("Workspace Footer","web-stories"),children:[(0,jsx_runtime.jsx)(footerLayout_Area,{area:"carousel",children:(0,jsx_runtime.jsx)(carouselContainer,{})}),(0,jsx_runtime.jsx)(footerLayout_Area,{area:"primary",zIndex,children:(0,jsx_runtime.jsx)(primaryMenu,{})}),(0,jsx_runtime.jsx)(footerLayout_Area,{area:"secondary",zIndex,children:(0,jsx_runtime.jsx)(secondaryMenu,{menu:footer?.secondaryMenu})})]})})}FooterLayout.displayName="FooterLayout";const footerLayout=FooterLayout,Outer=styled_components_browser_esm.ZP.section.withConfig({displayName:"footer__Outer",componentId:"sc-124zhi3-0"})(["height:100%;"]),footer_Inner=(0,styled_components_browser_esm.ZP)(Outer).withConfig({displayName:"footer__Inner",componentId:"sc-124zhi3-1"})(["margin-right:","px;"],(_ref=>{let{marginRight}=_ref;return marginRight}));function Footer(_ref2){let{footer,zIndex}=_ref2;const ref=(0,src.sO)(),[workspaceWidth,setWorkspaceWidth]=(0,src.eJ)(0);(0,src.Bz)(ref,(_ref3=>{let{width}=_ref3;return setWorkspaceWidth(width)}),[]);const margin=(0,src.Ye)((()=>workspaceWidth>=1e3?8:0),[workspaceWidth]);return(0,jsx_runtime.jsx)(checklist.fM,{children:(0,jsx_runtime.jsx)(keyboardShortcutsMenuContext.S,{children:(0,jsx_runtime.jsx)(Outer,{ref,children:(0,jsx_runtime.jsx)(footer_Inner,{marginRight:margin,children:(0,jsx_runtime.jsx)(footerLayout,{footer,zIndex})})})})})}Footer.displayName="Footer";const footer_footer=(0,src.X$)(Footer);var contextMenu=__webpack_require__("./packages/design-system/src/components/contextMenu/contextMenu.tsx"),utils_noop=__webpack_require__("./packages/design-system/src/utils/noop.ts"),components_separator=__webpack_require__("./packages/design-system/src/components/contextMenu/components/separator.tsx"),components_button=__webpack_require__("./packages/design-system/src/components/contextMenu/components/button.tsx"),icon=__webpack_require__("./packages/design-system/src/components/contextMenu/components/icon.tsx"),icons=__webpack_require__("./packages/design-system/src/icons/index.ts"),app_history=__webpack_require__("./packages/story-editor/src/app/history/index.ts"),useInsertElement=__webpack_require__("./packages/story-editor/src/components/canvas/useInsertElement.ts"),textPresets=__webpack_require__("./packages/story-editor/src/components/library/panes/text/textPresets.ts");const ACTIONS={ADD_ANIMATION:{trackingEventName:"add_animation",text:(0,i18n.__)("Add animation","web-stories")},ADD_LINK:{trackingEventName:"add_link",text:(0,i18n.__)("Add link","web-stories")},ADD_CAPTIONS:{trackingEventName:"add_captions",text:(0,i18n.__)("Add captions","web-stories")},AUTO_STYLE_TEXT:{trackingEventName:"auto_style_text",text:(0,i18n.__)("Adaptive text colors","web-stories")},CHANGE_BACKGROUND_COLOR:{trackingEventName:"change_background_color",text:(0,i18n.__)("Change background color","web-stories")},CHANGE_TEXT_COLOR:{trackingEventName:"change_text_color",text:(0,i18n.__)("Change color","web-stories")},CHANGE_COLOR:{trackingEventName:"change_color",text:(0,i18n.__)("Change color","web-stories")},RESET_ELEMENT:{trackingEventName:"reset_element",text:(0,i18n.__)("Reset element","web-stories")},CHANGE_FONT:{trackingEventName:"change_font",text:(0,i18n.__)("Edit text","web-stories")},INSERT_BACKGROUND_MEDIA:{trackingEventName:"insert_background_media",text:(0,i18n.__)("Insert background media","web-stories")},INSERT_TEXT:{trackingEventName:"insert_text",text:(0,i18n.__)("Insert text","web-stories")},REPLACE_BACKGROUND_MEDIA:{trackingEventName:"replace_background_media",text:(0,i18n.__)("Replace background","web-stories")},REPLACE_MEDIA:{trackingEventName:"replace_media",text:(0,i18n.__)("Replace media","web-stories")},TRIM_VIDEO:{trackingEventName:"trim_video",text:(0,i18n.__)("Trim video","web-stories")}},RESET_PROPERTIES_ANIMATION="animation",RESET_PROPERTIES_OVERLAY="overlay",RESET_PROPERTIES_STYLES="styles",RESET_DEFAULTS_TEXT_BORDER_RADIUS={locked:!0,topLeft:2,topRight:2,bottomLeft:2,bottomRight:2},RESET_DEFAULTS_STANDARD_BORDER_RADIUS=0;const utils_getResetProperties=function(selectedElement){let selectedElementAnimations=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!selectedElement)return[];const resetProperties=[];return selectedElement?.overlay&&resetProperties.push(RESET_PROPERTIES_OVERLAY),selectedElementAnimations?.length&&resetProperties.push(RESET_PROPERTIES_ANIMATION),(selectedElement?.opacity<100||!function isBorderRadiusDefault(element){return element?.type===elements_src.Yj.TEXT&&element?.borderRadius?element.borderRadius.locked&&element.borderRadius.topLeft===RESET_DEFAULTS_TEXT_BORDER_RADIUS.topLeft:!element?.borderRadius||element.borderRadius===RESET_DEFAULTS_STANDARD_BORDER_RADIUS}(selectedElement)||selectedElement?.border)&&resetProperties.push(RESET_PROPERTIES_STYLES),resetProperties};var color_bucket=__webpack_require__("./packages/design-system/src/icons/color_bucket.svg"),useApplyTextAutoStyle=__webpack_require__("./packages/story-editor/src/utils/useApplyTextAutoStyle.js");const quickActions_useTextActions=function useTextActions(_ref){let{selectedElement,updater,commonActions,actionProps}=_ref;const applyTextAutoStyle=(0,useApplyTextAutoStyle.Z)(selectedElement,(properties=>updater({elementIds:[selectedElement?.id],properties})));return(0,src.Ye)((()=>[{Icon:color_bucket.Z,label:ACTIONS.AUTO_STYLE_TEXT.text,onClick:()=>{applyTextAutoStyle(),(0,tracking_src.L9)("quick_action",{name:ACTIONS.AUTO_STYLE_TEXT.trackingEventName,element:"text"})},...actionProps},...commonActions]),[actionProps,applyTextAutoStyle,commonActions])};__webpack_require__("./node_modules/core-js/modules/es.array.unshift.js");var settings=__webpack_require__("./packages/design-system/src/icons/settings.svg"),mic=__webpack_require__("./packages/design-system/src/icons/mic.svg"),mic_off=__webpack_require__("./packages/design-system/src/icons/mic_off.svg"),camera=__webpack_require__("./packages/design-system/src/icons/camera.svg"),camera_off=__webpack_require__("./packages/design-system/src/icons/camera_off.svg"),background_blur=__webpack_require__("./packages/design-system/src/icons/background_blur.svg"),background_blur_off=__webpack_require__("./packages/design-system/src/icons/background_blur_off.svg"),picture_swap=__webpack_require__("./packages/design-system/src/icons/picture_swap.svg"),captions=__webpack_require__("./packages/design-system/src/icons/captions.svg"),circle_speed=__webpack_require__("./packages/design-system/src/icons/circle_speed.svg"),eraser=__webpack_require__("./packages/design-system/src/icons/eraser.svg"),scissors=__webpack_require__("./packages/design-system/src/icons/scissors.svg"),mediaRecording_constants=__webpack_require__("./packages/story-editor/src/components/mediaRecording/constants.js"),updateProperties=__webpack_require__("./packages/story-editor/src/components/style/updateProperties.js");const quickActions_useElementReset=function useElementReset(){const showSnackbar=(0,useSnackbar.D)((_ref=>{let{showSnackbar}=_ref;return showSnackbar})),{selectedElementAnimations,updateElementsById}=(0,story.rB)((_ref2=>{let{state:{selectedElementAnimations},actions:{updateElementsById}}=_ref2;return{selectedElementAnimations,updateElementsById}})),{undo}=(0,app_history.k6)((_ref3=>{let{actions:{undo}}=_ref3;return{undo}})),undoRef=(0,src.sO)(undo);undoRef.current=undo;const handleResetProperties=(0,src.I4)(((elementType,elementId,properties)=>{const newProperties={};properties.includes(RESET_PROPERTIES_OVERLAY)&&(newProperties.overlay=null),properties.includes(RESET_PROPERTIES_ANIMATION)&&updateElementsById({elementIds:[elementId],properties:currentProperties=>(0,updateProperties.Z)(currentProperties,{animation:{...selectedElementAnimations?.[0],delete:!0}},!0)}),properties.includes(RESET_PROPERTIES_STYLES)&&(newProperties.opacity=100,newProperties.border=null,newProperties.borderRadius=null),elementType===elements_src.Hd.Text&&(newProperties.borderRadius=RESET_DEFAULTS_TEXT_BORDER_RADIUS),updateElementsById({elementIds:[elementId],properties:currentProperties=>(0,updateProperties.Z)(currentProperties,newProperties,!0)})}),[selectedElementAnimations,updateElementsById]);return(0,src.I4)((_ref4=>{let{elementId,resetProperties,elementType}=_ref4;handleResetProperties(elementType,elementId,resetProperties),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Element properties have been reset","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.L9)("quick_action",{name:`undo_${ACTIONS.RESET_ELEMENT.trackingEventName}`,element:elementType,isBackground:!0})},actionHelpText:(0,sprintf.Z)((0,i18n.__)("Press %s to undo the last change","web-stories"),(0,utils.U2)("mod+z"))})}),[handleResetProperties,showSnackbar])},quickActionIconAttrs={width:24,height:24},StyledSettings=(0,styled_components_browser_esm.ZP)(settings.Z).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__StyledSettings",componentId:"sc-1770zw4-0"})([""]),Mic=(0,styled_components_browser_esm.ZP)(mic.Z).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__Mic",componentId:"sc-1770zw4-1"})([""]),MicOff=(0,styled_components_browser_esm.ZP)(mic_off.Z).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__MicOff",componentId:"sc-1770zw4-2"})([""]),Video=(0,styled_components_browser_esm.ZP)(camera.Z).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__Video",componentId:"sc-1770zw4-3"})([""]),VideoOff=(0,styled_components_browser_esm.ZP)(camera_off.Z).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__VideoOff",componentId:"sc-1770zw4-4"})([""]),BackgroundBlur=(0,styled_components_browser_esm.ZP)(background_blur.Z).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__BackgroundBlur",componentId:"sc-1770zw4-5"})([""]),BackgroundBlurOff=(0,styled_components_browser_esm.ZP)(background_blur_off.Z).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__BackgroundBlurOff",componentId:"sc-1770zw4-6"})([""]);const quickActions_useMediaActions=function useMediaActions(_ref){let{actionProps,selectedElement,handleFocusPanel,resetProperties,commonActions}=_ref;const{capabilities:{hasUploadMediaAction}}=(0,config.ZR)(),dispatchStoryEvent=(0,story.o_)(),{toggleRecordingMode,toggleVideo,toggleAudio,hasVideo,hasAudio,videoEffect,setVideoEffect,toggleSettings,audioInput,videoInput,isReady,isProcessing,isAdjustingTrim,isProcessingTrim,startTrim}=(0,mediaRecording._T)((_ref2=>{let{state,actions}=_ref2;return{hasAudio:state.hasAudio,hasVideo:state.hasVideo,videoEffect:state.videoEffect,audioInput:state.audioInput,videoInput:state.videoInput,isReady:!("ready"!==state.inputStatus||state.file?.type?.startsWith("image")||state.isCountingDown||"ready"!==state.status&&"idle"!==state.status),isProcessing:state.isProcessing,isAdjustingTrim:state.isAdjustingTrim,isProcessingTrim:state.isProcessingTrim,toggleRecordingMode:actions.toggleRecordingMode,toggleVideo:actions.toggleVideo,toggleAudio:actions.toggleAudio,toggleSettings:actions.toggleSettings,muteAudio:actions.muteAudio,unMuteAudio:actions.unMuteAudio,startTrim:actions.startTrim,setVideoEffect:actions.setVideoEffect}})),showClearAction=resetProperties.length>0,foregroundImageActions=(0,src.Ye)((()=>{const actions=[];return hasUploadMediaAction&&actions.push({Icon:picture_swap.Z,label:ACTIONS.REPLACE_MEDIA.text,onClick:()=>{dispatchStoryEvent(story.xw.onReplaceForegroundMedia),(0,tracking_src.L9)("quick_action",{name:ACTIONS.REPLACE_MEDIA.trackingEventName,element:selectedElement?.type})},wrapWithMediaPicker:!0,...actionProps}),[...actions,...commonActions]}),[hasUploadMediaAction,commonActions,actionProps,dispatchStoryEvent,selectedElement?.type]),{handleFocusAnimationPanel,handleFocusCaptionsPanel}=(0,src.Ye)((()=>({handleFocusAnimationPanel:handleFocusPanel(highlights.$q.Animation),handleFocusCaptionsPanel:handleFocusPanel(highlights.$q.Captions)})),[handleFocusPanel]),videoActions=(0,src.Ye)((()=>{const[baseActions,clearActions]=showClearAction?[foregroundImageActions.slice(0,foregroundImageActions.length-1),foregroundImageActions.slice(-1)]:[foregroundImageActions,[]];return[...baseActions,{Icon:captions.Z,label:ACTIONS.ADD_CAPTIONS.text,onClick:evt=>{handleFocusCaptionsPanel()(evt),(0,tracking_src.L9)("quick_action",{name:ACTIONS.ADD_CAPTIONS.trackingEventName,element:selectedElement?.type})},...actionProps},...clearActions]}),[actionProps,foregroundImageActions,handleFocusCaptionsPanel,selectedElement?.type,showClearAction]),handleElementReset=quickActions_useElementReset(),backgroundElementMediaActions=(0,src.Ye)((()=>{const baseActions=[{Icon:circle_speed.Z,label:ACTIONS.ADD_ANIMATION.text,onClick:evt=>{handleFocusAnimationPanel()(evt),(0,tracking_src.L9)("quick_action",{name:ACTIONS.ADD_ANIMATION.trackingEventName,element:selectedElement?.type,isBackground:!0})},...actionProps}];hasUploadMediaAction&&baseActions.unshift({Icon:picture_swap.Z,label:ACTIONS.REPLACE_BACKGROUND_MEDIA.text,onClick:()=>{dispatchStoryEvent(story.xw.onReplaceBackgroundMedia),(0,tracking_src.L9)("quick_action",{name:ACTIONS.REPLACE_BACKGROUND_MEDIA.trackingEventName,element:selectedElement?.type,isBackground:!0})},wrapWithMediaPicker:!0,...actionProps});const clearAction={Icon:eraser.Z,label:ACTIONS.RESET_ELEMENT.text,onClick:()=>{handleElementReset({elementId:selectedElement?.id,resetProperties,elementType:elements_src.Yj.IMAGE}),(0,tracking_src.L9)("quick_action",{name:ACTIONS.RESET_ELEMENT.trackingEventName,element:selectedElement?.type,isBackground:!0})},separator:"top",...actionProps};return showClearAction?[...baseActions,clearAction]:baseActions}),[actionProps,dispatchStoryEvent,handleElementReset,handleFocusAnimationPanel,hasUploadMediaAction,resetProperties,selectedElement?.id,selectedElement?.type,showClearAction]),mediaRecordingActions=(0,src.Ye)((()=>[{Icon:cross.Z,label:(0,i18n.__)("Close","web-stories"),onClick:()=>{(0,tracking_src.L9)("media_recording_mode_toggled",{status:"closed"}),toggleRecordingMode()},...actionProps},{Icon:StyledSettings,label:(0,i18n.__)("Options","web-stories"),onClick:()=>{(0,tracking_src.L9)("media_recording_open_settings"),toggleSettings()},disabled:!isReady,separator:"top",...actionProps},audioInput&&{Icon:hasAudio?Mic:MicOff,label:hasAudio?(0,i18n.__)("Disable Audio","web-stories"):(0,i18n.__)("Enable Audio","web-stories"),onClick:()=>{(0,tracking_src.L9)("media_recording_audio_toggled",{status:hasAudio?"muted":"unmuted"}),toggleAudio()},disabled:!isReady||!hasVideo,...actionProps},videoInput&&{Icon:hasVideo?Video:VideoOff,label:hasVideo?(0,i18n.__)("Disable Video","web-stories"):(0,i18n.__)("Enable Video","web-stories"),onClick:()=>{(0,tracking_src.L9)("media_recording_video_toggled",{status:hasVideo?"off":"on"}),toggleVideo()},disabled:!isReady||!hasAudio,...actionProps},videoInput&&{Icon:videoEffect===mediaRecording_constants.ut.BLUR?BackgroundBlur:BackgroundBlurOff,label:videoEffect===mediaRecording_constants.ut.BLUR?(0,i18n.__)("Disable Background Blur","web-stories"):(0,i18n.__)("Enable Background Blur","web-stories"),onClick:()=>{(0,tracking_src.L9)("media_recording_background_blur_px",{value:videoEffect===mediaRecording_constants.ut.BLUR?0:mediaRecording_constants.mb});const newVideoEffect=videoEffect===mediaRecording_constants.ut.BLUR?mediaRecording_constants.ut.NONE:mediaRecording_constants.ut.BLUR;setVideoEffect(newVideoEffect)},disabled:!isReady||!hasVideo,...actionProps},{Icon:scissors.Z,label:(0,i18n.__)("Trim Video","web-stories"),onClick:()=>{(0,tracking_src.L9)("media_recording_trim_start"),startTrim()},disabled:!isProcessing||isAdjustingTrim||!hasVideo||isProcessingTrim,...actionProps}].filter(Boolean)),[actionProps,isReady,audioInput,hasAudio,hasVideo,videoInput,videoEffect,isProcessing,isAdjustingTrim,isProcessingTrim,toggleRecordingMode,toggleSettings,toggleAudio,toggleVideo,setVideoEffect,startTrim]);return{backgroundElementMediaActions,foregroundImageActions,mediaRecordingActions,videoActions}};var icons_link=__webpack_require__("./packages/design-system/src/icons/link.svg");const quickActions_useForegroundActions=function useForegroundActions(_ref){let{actionProps,selectedElement,handleFocusPanel,resetProperties}=_ref;const{currentPageNumber}=(0,story.rB)((_ref2=>{let{state:{currentPageNumber}}=_ref2;return{currentPageNumber}})),handleElementReset=quickActions_useElementReset(),showClearAction=resetProperties.length>0;return(0,src.Ye)((()=>{const handleFocusAnimationPanel=handleFocusPanel(highlights.$q.Animation),handleFocusLinkPanel=handleFocusPanel(highlights.$q.Link),commonActions=[];return currentPageNumber>1&&commonActions.push({Icon:circle_speed.Z,label:ACTIONS.ADD_ANIMATION.text,onClick:evt=>{handleFocusAnimationPanel()(evt),(0,tracking_src.L9)("quick_action",{name:ACTIONS.ADD_ANIMATION.trackingEventName,element:selectedElement?.type})},...actionProps}),commonActions.push({Icon:icons_link.Z,label:ACTIONS.ADD_LINK.text,onClick:evt=>{handleFocusLinkPanel()(evt),(0,tracking_src.L9)("quick_action",{name:ACTIONS.ADD_LINK.trackingEventName,element:selectedElement?.type})},...actionProps}),showClearAction&&commonActions.push({Icon:eraser.Z,label:ACTIONS.RESET_ELEMENT.text,onClick:()=>{handleElementReset({elementId:selectedElement?.id,resetProperties,elementType:selectedElement?.type}),(0,tracking_src.L9)("quick_action",{name:ACTIONS.RESET_ELEMENT.trackingEventName,element:selectedElement?.type})},separator:"top",...actionProps}),commonActions}),[handleFocusPanel,currentPageNumber,actionProps,showClearAction,selectedElement?.type,selectedElement?.id,resetProperties,handleElementReset])},{Bucket,LetterTPlus,Media}=icons,quickActions_useQuickActions=()=>{const{backgroundElement,selectedElementAnimations,selectedElements,updateElementsById}=(0,story.rB)((_ref=>{let{state:{currentPage,currentPageNumber,selectedElementAnimations,selectedElements},actions:{updateElementsById}}=_ref;return{backgroundElement:currentPage?.elements.find((element=>element.isBackground)),currentPageNumber,selectedElementAnimations,selectedElements,updateElementsById}})),{undo}=(0,app_history.k6)((_ref2=>{let{actions:{undo}}=_ref2;return{undo}})),{setHighlights}=(0,highlights.QM)((_ref3=>{let{setHighlights}=_ref3;return{setHighlights}})),{isInRecordingMode}=(0,mediaRecording._T)((_ref4=>{let{state}=_ref4;return{isInRecordingMode:state.isInRecordingMode}}));(0,src.sO)(undo).current=undo;const selectedElement=selectedElements?.[0],handleMouseDown=(0,src.I4)((ev=>{ev.stopPropagation()}),[]),handleFocusPanel=(0,src.I4)((highlight=>elementId=>ev=>{ev.preventDefault(),setHighlights({elementId:elementId||selectedElement?.id,highlight})}),[setHighlights,selectedElement]),resetProperties=(0,src.Ye)((()=>utils_getResetProperties(selectedElement,selectedElementAnimations)),[selectedElement,selectedElementAnimations]),handleFocusMediaPanel=(0,src.Ye)((()=>{const panelToFocus=(selectedElements?.[0]?.resource?.id?.toString()||"").startsWith("media/")?highlights.$q.Media3p:highlights.$q.Media;return handleFocusPanel(panelToFocus)}),[handleFocusPanel,selectedElements]),{handleFocusPageBackground}=(0,src.Ye)((()=>({handleFocusPageBackground:handleFocusPanel(highlights.$q.PageBackground)})),[handleFocusPanel]),insertElement=(0,useInsertElement.Z)(),actionMenuProps=(0,src.Ye)((()=>({tooltipPlacement:popup_constants.ug.Right,onMouseDown:handleMouseDown})),[handleMouseDown]),noElementSelectedActions=(0,src.Ye)((()=>[{Icon:Bucket,label:ACTIONS.CHANGE_BACKGROUND_COLOR.text,onClick:evt=>{handleFocusPageBackground(backgroundElement?.id)(evt),(0,tracking_src.L9)("quick_action",{name:ACTIONS.CHANGE_BACKGROUND_COLOR.trackingEventName,element:"none"})},...actionMenuProps},{Icon:Media,label:ACTIONS.INSERT_BACKGROUND_MEDIA.text,onClick:evt=>{handleFocusMediaPanel()(evt),(0,tracking_src.L9)("quick_action",{name:ACTIONS.INSERT_BACKGROUND_MEDIA.trackingEventName,element:"none"})},separator:"top",...actionMenuProps},{Icon:LetterTPlus,label:ACTIONS.INSERT_TEXT.text,onClick:()=>{setHighlights({highlight:highlights.$q.StylePane}),insertElement("text",textPresets.c),(0,tracking_src.L9)("quick_action",{name:ACTIONS.INSERT_TEXT.trackingEventName,element:"none"})},...actionMenuProps}]),[actionMenuProps,backgroundElement,handleFocusMediaPanel,handleFocusPageBackground,setHighlights,insertElement]),foregroundCommonActions=quickActions_useForegroundActions({actionProps:actionMenuProps,selectedElement,handleFocusPanel,resetProperties}),textActions=quickActions_useTextActions({selectedElement,updater:updateElementsById,commonActions:foregroundCommonActions,actionProps:actionMenuProps}),{backgroundElementMediaActions,foregroundImageActions,mediaRecordingActions,videoActions}=quickActions_useMediaActions({selectedElement,handleFocusPanel,resetProperties,commonActions:foregroundCommonActions});if(isInRecordingMode)return mediaRecordingActions;if(selectedElements.length>1)return[];const isBackgroundElementMedia=Boolean(backgroundElement&&backgroundElement?.resource),noElementsSelected=0===selectedElements.length,isBackgroundSelected=selectedElements?.[0]?.isBackground;if(noElementsSelected||isBackgroundSelected&&!isBackgroundElementMedia)return noElementSelectedActions;if(isBackgroundSelected&&isBackgroundElementMedia)return backgroundElementMediaActions;switch(selectedElements?.[0]?.type){case elements_src.Hd.Image:case elements_src.Hd.Gif:return foregroundImageActions;case elements_src.Hd.Shape:case elements_src.Hd.Sticker:return foregroundCommonActions;case elements_src.Hd.Text:return textActions;case elements_src.Hd.Video:return videoActions;default:return[]}};var translateToExclusiveList=__webpack_require__("./packages/i18n/src/translateToExclusiveList.ts"),src_mimeTypes=__webpack_require__("./packages/media/src/mimeTypes.ts"),resourceList=__webpack_require__("./packages/media/src/resourceList.ts"),media=__webpack_require__("./packages/story-editor/src/app/media/index.js"),useFFmpeg=__webpack_require__("./packages/story-editor/src/app/media/utils/useFFmpeg.ts");const MediaPicker=_ref=>{let{render,...props}=_ref;const{allowedMimeTypes:{image:allowedImageMimeTypes,vector:allowedVectorMimeTypes,video:allowedVideoMimeTypes},MediaUpload}=(0,config.ZR)(),{selectedElements,updateElementsById}=(0,story.rB)((_ref2=>{let{state:{selectedElements},actions:{updateElementsById}}=_ref2;return{selectedElements,updateElementsById}})),{resetWithFetch,postProcessingResource,optimizeVideo,optimizeGif,canTranscodeResource}=(0,media.EF)((_ref3=>{let{state:{canTranscodeResource},actions:{resetWithFetch,postProcessingResource,optimizeVideo,optimizeGif}}=_ref3;return{canTranscodeResource,resetWithFetch,postProcessingResource,optimizeVideo,optimizeGif}})),{isTranscodingEnabled}=(0,useFFmpeg.Z)(),{showSnackbar}=(0,useSnackbar.D)();let allowedMimeTypes=(0,src.Ye)((()=>[...allowedImageMimeTypes,...allowedVectorMimeTypes,...allowedVideoMimeTypes]),[allowedImageMimeTypes,allowedVectorMimeTypes,allowedVideoMimeTypes]);const allowedFileTypes=(0,src.Ye)((()=>allowedMimeTypes.map((type=>(0,src_mimeTypes.E)(type))).flat()),[allowedMimeTypes]);isTranscodingEnabled&&(allowedMimeTypes=allowedMimeTypes.concat(media.Uj));const transcodableMimeTypes=media.Uj.filter((x=>!allowedVideoMimeTypes.includes(x)));let onSelectErrorMessage=(0,i18n.__)("No file types are currently supported.","web-stories");allowedFileTypes.length&&(onSelectErrorMessage=(0,sprintf.Z)((0,i18n.__)("Please choose only %s to insert into page.","web-stories"),(0,translateToExclusiveList.Z)(allowedFileTypes)));const insertMediaElement=(0,src.I4)(((resource,thumbnailURL)=>{resourceList.Z.set(resource.id,{url:thumbnailURL,type:"cached"}),updateElementsById({elementIds:[selectedElements?.[0]?.id],properties:{type:resource.type,resource}})}),[selectedElements,updateElementsById]),handleMediaSelect=(0,src.I4)((resource=>{try{isTranscodingEnabled&&canTranscodeResource(resource)&&(transcodableMimeTypes.includes(resource.mimeType)&&optimizeVideo({resource}),"image/gif"===resource.mimeType&&optimizeGif({resource})),insertMediaElement(resource,resource.sizes?.medium?.sourceUrl||resource.src),postProcessingResource(resource)}catch(e){showSnackbar({message:e.message,dismissable:!0})}}),[isTranscodingEnabled,canTranscodeResource,insertMediaElement,postProcessingResource,transcodableMimeTypes,optimizeVideo,optimizeGif,showSnackbar]);return(0,jsx_runtime.jsx)(MediaUpload,{title:(0,i18n.__)("Replace media","web-stories"),buttonInsertText:(0,i18n.__)("Replace media","web-stories"),onSelect:handleMediaSelect,onClose:resetWithFetch,type:allowedMimeTypes,onSelectErrorMessage,render:open=>render({onClick:open}),...props})};MediaPicker.displayName="MediaPicker";const mediaPicker=MediaPicker;var plus_outline=__webpack_require__("./packages/design-system/src/icons/plus_outline.svg");const pageMenuButton_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"pageMenuButton__StyledButton",componentId:"sc-x8fz92-0"})(["margin-top:12px;"]);function PageMenuButtonWithRef(_ref,forwardedRef){let{children,title,shortcut,...rest}=_ref;return(0,jsx_runtime.jsx)(tooltip.Z,{title,shortcut,placement:popup_constants.ug.Right,hasTail:!0,children:(0,jsx_runtime.jsx)(pageMenuButton_StyledButton,{variant:button_constants.Wu.Square,type:button_constants.L$.Secondary,size:button_constants.qE.Small,ref:forwardedRef,...rest,children})})}PageMenuButtonWithRef.displayName="PageMenuButtonWithRef";const PageMenuButton=(0,src.Gp)(PageMenuButtonWithRef);PageMenuButton.propTypes={children:prop_types_default().node,title:prop_types_default().string,shortcut:prop_types_default().string};const pageMenuButton=PageMenuButton;var stop_outline=__webpack_require__("./packages/design-system/src/icons/stop_outline.svg"),play_outline=__webpack_require__("./packages/design-system/src/icons/play_outline.svg");function AnimationToggle(){const{animationState,updateAnimationState,isFirstPage}=(0,app.rB)((_ref=>{let{state:{animationState,currentPageNumber},actions:{updateAnimationState}}=_ref;return{animationState,updateAnimationState,isFirstPage:1===currentPageNumber}})),isPlaying=[animation_src.pG.Playing,animation_src.pG.PlayingSelected].includes(animationState),tooltip=isFirstPage?(0,i18n.__)("Animations Disabled","web-stories"):isPlaying?(0,i18n.__)("Stop","web-stories"):(0,i18n.__)("Play","web-stories"),label=isFirstPage?(0,i18n.__)("Page Animations Disabled","web-stories"):isPlaying?(0,i18n.__)("Stop Page Animations","web-stories"):(0,i18n.__)("Play Page Animations","web-stories"),shortcut=isFirstPage?null:"mod+enter",Icon=isPlaying?stop_outline.Z:play_outline.Z,toggleAnimationState=(0,src.I4)((()=>{updateAnimationState({animationState:isPlaying?animation_src.pG.Reset:animation_src.pG.Playing}),(0,tracking_src.L9)("canvas_play_animations",{status:isPlaying?"stop":"play"})}),[isPlaying,updateAnimationState]);return(0,jsx_runtime.jsx)(pageMenuButton,{title:tooltip,shortcut,onClick:toggleAnimationState,"aria-label":label,disabled:isFirstPage,children:(0,jsx_runtime.jsx)(Icon,{})})}AnimationToggle.displayName="AnimationToggle";const animationToggle=AnimationToggle,pageMenu_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageMenu__Wrapper",componentId:"sc-m9u2n8-0"})(["margin-top:auto;padding:0 4px;pointer-events:all;"]);function PageMenu(){const{currentPage,numberOfPages,deleteCurrentPage,addPage,hasVisibleAnimations}=(0,app.rB)((_ref=>{let{state:{currentPage,pages},actions:{deleteCurrentPage,addPage}}=_ref;return{currentPage,numberOfPages:pages.length,deleteCurrentPage,addPage,hasVisibleAnimations:currentPage?.animations?.some((animation=>animation.targets.some((id=>!currentPage.elements.find((element=>element.id===id))?.isHidden))))}})),addPageButtonRef=(0,src.sO)(null),deletePageButtonRef=(0,src.sO)(null);(0,usePerformanceTracking.Z)({node:addPageButtonRef.current,eventData:constants.Iy.PAGE_ADD}),(0,usePerformanceTracking.Z)({node:deletePageButtonRef.current,eventData:constants.Iy.PAGE_DELETE});const handleDeletePage=(0,src.I4)((()=>deleteCurrentPage()),[deleteCurrentPage]),handleAddPage=(0,src.I4)((()=>addPage({page:(0,elements_src.D4)()})),[addPage]),handleDuplicatePage=(0,src.I4)((()=>addPage({page:(0,elements_src.Fl)(currentPage)})),[addPage,currentPage]),disableDeleteButton=numberOfPages<=1;return currentPage?(0,jsx_runtime.jsxs)(pageMenu_Wrapper,{role:"group","aria-label":(0,i18n.__)("Page actions","web-stories"),children:[hasVisibleAnimations&&(0,jsx_runtime.jsx)(animationToggle,{}),(0,jsx_runtime.jsx)(pageMenuButton,{ref:addPageButtonRef,title:(0,i18n.__)("New Page","web-stories"),onClick:handleAddPage,"aria-label":(0,i18n.__)("Add New Page","web-stories"),children:(0,jsx_runtime.jsx)(plus_outline.Z,{})}),(0,jsx_runtime.jsx)(pageMenuButton,{title:(0,i18n.__)("Duplicate Page","web-stories"),onClick:handleDuplicatePage,"aria-label":(0,i18n.__)("Duplicate Page","web-stories"),children:(0,jsx_runtime.jsx)(page_plus.Z,{})}),(0,jsx_runtime.jsx)(pageMenuButton,{ref:deletePageButtonRef,title:(0,i18n.__)("Delete Page","web-stories"),disabled:disableDeleteButton,onClick:handleDeletePage,"aria-label":(0,i18n.__)("Delete Page","web-stories"),children:(0,jsx_runtime.jsx)(trash.Z,{})})]}):null}PageMenu.displayName="PageMenu";const pageMenu=(0,src.X$)(PageMenu),MenusWrapper=styled_components_browser_esm.ZP.section.withConfig({displayName:"pageSideMenu__MenusWrapper",componentId:"sc-sll2i1-0"})(["position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:space-between;z-index:",";pointer-events:none;min-height:100%;",""],(_ref=>{let{$zIndex}=_ref;return $zIndex}),(_ref2=>{let{isZoomed,theme}=_ref2;return isZoomed&&`\n    min-height: initial;\n    background-color: ${(0,polished_esm.m4)(theme.colors.standard.black,.45)};\n    border-radius: ${theme.borders.radius.small};\n    padding: 8px;\n    margin-left: -24px;\n  `})),Divider=styled_components_browser_esm.ZP.div.withConfig({displayName:"pageSideMenu__Divider",componentId:"sc-sll2i1-1"})(["width:20px;height:1px;margin:13px auto 1px;background-color:",";"],(_ref3=>{let{theme}=_ref3;return theme.colors.divider.primary})),StyledContextMenu=(0,styled_components_browser_esm.ZP)(contextMenu.Z).withConfig({displayName:"pageSideMenu__StyledContextMenu",componentId:"sc-sll2i1-2"})(["pointer-events:all;"]);function PageSideMenu(){const{zoomSetting}=(0,app.$Y)((_ref4=>{let{state:{zoomSetting}}=_ref4;return{zoomSetting}})),quickActions=quickActions_useQuickActions(),{isInRecordingMode}=(0,mediaRecording._T)((_ref5=>{let{state:{isInRecordingMode}}=_ref5;return{isInRecordingMode}})),isZoomed=zoomSetting!==constants.uM.Fit;return(0,jsx_runtime.jsxs)(MenusWrapper,{"aria-label":(0,i18n.__)("Page side menu","web-stories"),isZoomed,$zIndex:isInRecordingMode?zIndex.lb:zIndex.Gu,children:[quickActions.length?(0,jsx_runtime.jsx)(StyledContextMenu,{isInline:!0,isAlwaysVisible:!0,isIconMenu:!0,disableControlledTabNavigation:!0,"data-testid":"Element quick actions","aria-label":(0,i18n.__)("Group of available options for selected element","web-stories"),onMouseDown:e=>{e.stopPropagation()},children:quickActions.map((_ref6=>{let{Icon,label,onClick,separator,tooltipPlacement,wrapWithMediaPicker,...quickAction}=_ref6;const action=function(){let externalOnClick=arguments.length>0&&void 0!==arguments[0]?arguments[0]:utils_noop.Z;return(0,jsx_runtime.jsxs)(src.HY,{children:["top"===separator&&(0,jsx_runtime.jsx)(components_separator.Z,{}),(0,jsx_runtime.jsx)(tooltip.Z,{placement:tooltipPlacement,title:label,children:(0,jsx_runtime.jsx)(components_button.Z,{"aria-label":label,onClick:evt=>{onClick(evt),externalOnClick(evt)},...quickAction,children:(0,jsx_runtime.jsx)(icon.Z,{title:label,children:(0,jsx_runtime.jsx)(Icon,{})})})}),"bottom"===separator&&(0,jsx_runtime.jsx)(components_separator.Z,{})]},label)};return wrapWithMediaPicker?(0,jsx_runtime.jsx)(mediaPicker,{render:_ref7=>{let{onClick:openMediaPicker}=_ref7;return action(openMediaPicker)}},label):action()}))}):null,!isInRecordingMode&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isZoomed&&(0,jsx_runtime.jsx)(Divider,{}),(0,jsx_runtime.jsx)(pageMenu,{})]})]})}PageSideMenu.displayName="PageSideMenu";const pageSideMenu=PageSideMenu;function NavLayer(_ref){let{header,footer}=_ref;return(0,jsx_runtime.jsx)(checklist.rJ,{hasChecklist:Boolean(footer?.secondaryMenu?.checklist),children:(0,jsx_runtime.jsxs)(Layer,{pointerEvents:"none",onMouseDown:evt=>evt.stopPropagation(),children:[(0,jsx_runtime.jsx)(HeadArea,{pointerEvents:"initial",zIndex:zIndex.wF,children:header}),(0,jsx_runtime.jsx)(directionAware.Z,{children:(0,jsx_runtime.jsx)(PageMenuArea,{children:(0,jsx_runtime.jsx)(pageSideMenu,{})})}),(0,jsx_runtime.jsx)(FooterArea,{pointerEvents:"initial",children:(0,jsx_runtime.jsx)(footer_footer,{footer,zIndex:zIndex.wF})})]})})}NavLayer.displayName="NavLayer";const navLayer=(0,src.X$)(NavLayer),LassoMode_OFF=0,LassoMode_ON=1,LassoMode_MAYBE=2,selectionCanvas_Container=(0,moveable_src.Ep)(styled_components_browser_esm.ZP.div.withConfig({displayName:"selectionCanvas__Container",componentId:"sc-qsqc5z-0"})(["position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;user-select:none;"])),Lasso=styled_components_browser_esm.ZP.div.withConfig({displayName:"selectionCanvas__Lasso",componentId:"sc-qsqc5z-1"})(["display:none;position:absolute;border:1px dotted ",";z-index:1;"],(_ref=>{let{theme}=_ref;return theme.colors.border.selection}));function SelectionCanvas(_ref2){let{children}=_ref2;const currentPageElements=(0,app.rB)((_ref3=>{let{state}=_ref3;return state.currentPage?.elements||constants.Qw})),{selectedElements,clearSelection,setSelectedElementsById}=(0,app.rB)((_ref4=>{let{state:{selectedElements},actions:{clearSelection,setSelectedElementsById}}=_ref4;return{selectedElements,clearSelection,setSelectedElementsById}})),{isEditing,nodesById,clearEditing}=(0,app.$P)((_ref5=>{let{state:{isEditing,nodesById},actions:{clearEditing}}=_ref5;return{isEditing,nodesById,clearEditing}})),overlayRef=(0,src.sO)(null),lassoRef=(0,src.sO)(null),startRef=(0,src.sO)([0,0]),endRef=(0,src.sO)([0,0]),lassoModeRef=(0,src.sO)(LassoMode_OFF),getLassoBox=(0,src.I4)((()=>{const[x1,y1]=startRef.current,[x2,y2]=endRef.current;return[Math.min(x1,x2),Math.min(y1,y2),Math.abs(x1-x2),Math.abs(y1-y2)]}),[]),updateLasso=(0,src.I4)((()=>{const lasso=lassoRef.current;if(!lasso)return;const lassoMode=lassoModeRef.current,[x,y,w,h]=getLassoBox();let offsetX=0,offsetY=0;for(let offsetNode=overlayRef.current;offsetNode;offsetNode=offsetNode.offsetParent)offsetX+=offsetNode.offsetLeft,offsetY+=offsetNode.offsetTop;const relativeX=x-offsetX,relativeY=y-offsetY;lasso.style.left=`${relativeX}px`,lasso.style.top=`${relativeY}px`,lasso.style.width=`${w}px`,lasso.style.height=`${h}px`,lasso.style.display=lassoMode===LassoMode_ON?"block":"none"}),[getLassoBox]),onMouseDown=(0,src.I4)((evt=>{nodesById[currentPageElements[0]?.id]?.contains(evt.target)||(selectedElements.length&&clearSelection(),isEditing&&clearEditing()),startRef.current=[evt.pageX,evt.pageY],endRef.current=[evt.pageX,evt.pageY],lassoModeRef.current=LassoMode_MAYBE,updateLasso()}),[clearEditing,clearSelection,currentPageElements,isEditing,nodesById,selectedElements.length,updateLasso]),onMouseMove=(0,src.I4)((evt=>{if(lassoModeRef.current===LassoMode_OFF)return;const[x1,y1]=startRef.current,x2=evt.pageX,y2=evt.pageY;endRef.current[0]=x2,endRef.current[1]=y2,updateLasso(),Math.abs(x1-x2)+Math.abs(y1-y2)>10&&(lassoModeRef.current=LassoMode_ON)}),[updateLasso]),getElementPolygon=(0,useElementPolygon.Z)(),selectIntersection=(0,src.I4)((_ref6=>{let{x:lx,y:ly,width:lw,height:lh}=_ref6;const lassoP=new(SAT_default().Box)(new(SAT_default().Vector)(lx,ly),lw,lh).toPolygon(),newSelectedElementIds=currentPageElements.filter((_ref7=>{let{isBackground,isLocked,isHidden}=_ref7;return!isBackground&&!isLocked&&!isHidden})).map((_ref8=>{let{id,...rest}=_ref8;const elementP=getElementPolygon({id,...rest});return SAT_default().testPolygonPolygon(lassoP,elementP)?id:null})).filter((id=>id));setSelectedElementsById({elementIds:newSelectedElementIds,withLinked:!0})}),[currentPageElements,setSelectedElementsById,getElementPolygon]),onMouseUp=(0,src.I4)((()=>{if(lassoModeRef.current===LassoMode_ON){const[lx,ly,lwidth,lheight]=getLassoBox();clearSelection(),clearEditing(),selectIntersection({x:lx,y:ly,width:lwidth,height:lheight})}lassoModeRef.current=LassoMode_OFF,updateLasso()}),[clearEditing,clearSelection,getLassoBox,selectIntersection,updateLasso]);return(0,src.d4)((()=>(document.addEventListener("mouseup",onMouseUp),()=>{document.removeEventListener("mouseup",onMouseUp)})),[onMouseUp]),(0,src.d4)(updateLasso),(0,jsx_runtime.jsxs)(selectionCanvas_Container,{onMouseDown,onMouseMove,"data-fix-caret":!0,children:[children,(0,jsx_runtime.jsx)(moveable_src.dN,{ref:overlayRef,children:(0,jsx_runtime.jsx)(Lasso,{ref:lassoRef})})]})}SelectionCanvas.displayName="SelectionCanvas";const selectionCanvas=SelectionCanvas;var uploadDropTarget=__webpack_require__("./packages/story-editor/src/components/uploadDropTarget/index.js"),useUploadWithPreview=__webpack_require__("./packages/story-editor/src/components/canvas/useUploadWithPreview.js");const MESSAGE_ID="edit-story-canvas-upload-message";function CanvasUploadDropTarget(_ref){let{children}=_ref;const uploadWithPreview=(0,useUploadWithPreview.Z)(),onDropHandler=(0,src.I4)((files=>{files&&files.length>0&&uploadWithPreview(files)}),[uploadWithPreview]);return(0,jsx_runtime.jsxs)(uploadDropTarget.YE,{onDrop:onDropHandler,labelledBy:MESSAGE_ID,children:[children,(0,jsx_runtime.jsx)(uploadDropTarget.Vm,{children:(0,jsx_runtime.jsx)(Layer,{children:(0,jsx_runtime.jsx)(PageArea,{overlay:(0,jsx_runtime.jsx)(uploadDropTarget.DI,{id:MESSAGE_ID,message:(0,i18n.__)("Upload to media library and add to the page.","web-stories")})})})})]})}CanvasUploadDropTarget.displayName="CanvasUploadDropTarget";const canvasUploadDropTarget=CanvasUploadDropTarget;__webpack_require__("./node_modules/core-js/modules/esnext.json.parse.js");var dragEvent=__webpack_require__("./packages/story-editor/src/utils/dragEvent.ts");const canvasElementDropzone_Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"canvasElementDropzone__Container",componentId:"sc-8cm35g-0"})(["width:100%;height:100%;"]);function CanvasElementDropzone(_ref){let{children}=_ref;const insertElement=(0,useInsertElement.Z)(),{activeDropTargetId}=(0,dropTargets.H)((state=>({activeDropTargetId:state.state.activeDropTargetId}))),{pageContainer}=(0,app.$P)((state=>({pageContainer:state.state.pageContainer}))),{editorToDataX,editorToDataY}=(0,useUnits.Z)((state=>({editorToDataX:state.actions.editorToDataX,editorToDataY:state.actions.editorToDataY}))),onDropHandler=(0,src.I4)((e=>{if((0,dragEvent.B)(e,"resource/media")&&!activeDropTargetId){const{resource,offset:{x:offsetX,y:offsetY,w:offsetWidth,h:offsetHeight}}=JSON.parse(e.dataTransfer.getData("resource/media")),{x,y}=pageContainer.getBoundingClientRect();insertElement(resource.type,{resource,x:editorToDataX(e.clientX-x-offsetX),y:editorToDataY(e.clientY-y-offsetY),width:editorToDataX(offsetWidth),height:editorToDataY(offsetHeight)}),e.stopPropagation(),e.preventDefault()}}),[activeDropTargetId,pageContainer,insertElement,editorToDataX,editorToDataY]),onDragOverHandler=(0,src.I4)((e=>{(0,dragEvent.B)(e,"resource/media")&&!activeDropTargetId&&(e.stopPropagation(),e.preventDefault())}),[activeDropTargetId]);return(0,jsx_runtime.jsx)(canvasElementDropzone_Container,{onDrop:onDropHandler,onDragOver:onDragOverHandler,children})}CanvasElementDropzone.displayName="CanvasElementDropzone";const canvasElementDropzone=CanvasElementDropzone;var circular=__webpack_require__("./packages/design-system/src/components/circularProgress/circular.tsx"),useEyeDropperApi=__webpack_require__("./packages/story-editor/src/components/eyedropper/useEyeDropperApi.js");const utils_getColorFromPixelData=function getColorFromPixelData(pixelData,x,y,width){const colorIndices=((x,y,width)=>{const red=4*(Math.floor(y)*width+Math.floor(x));return[red,red+1,red+2,red+3]})(x,y,width),[redIndex,greenIndex,blueIndex,alphaIndex]=colorIndices;return{r:pixelData[redIndex],g:pixelData[greenIndex],b:pixelData[blueIndex],a:pixelData[alphaIndex]/255}},EyedropperBackground=(0,styled_components_browser_esm.ZP)(Layer).withConfig({displayName:"eyedropperLayer__EyedropperBackground",componentId:"sc-nf74gq-0"})(["background:",";cursor:not-allowed;z-index:2;"],(_ref=>{let{theme}=_ref;return theme.colors.opacity.black64})),eyedropperLayer_DisplayPageArea=(0,styled_components_browser_esm.ZP)(PageArea).withConfig({displayName:"eyedropperLayer__DisplayPageArea",componentId:"sc-nf74gq-1"})(["position:absolute;"]),EyedropperCanvas=styled_components_browser_esm.ZP.div.withConfig({displayName:"eyedropperLayer__EyedropperCanvas",componentId:"sc-nf74gq-2"})(["background:transparent;border-radius:5px;position:absolute;z-index:2;transform:translateZ(0);top:0;left:0;bottom:0;right:0;cursor:default;"]),ColorInfo=styled_components_browser_esm.ZP.div.withConfig({displayName:"eyedropperLayer__ColorInfo",componentId:"sc-nf74gq-3"})(["text-transform:uppercase;margin-top:30px;padding:9px;min-width:102px;text-align:center;"]),Circle=styled_components_browser_esm.ZP.div.withConfig({displayName:"eyedropperLayer__Circle",componentId:"sc-nf74gq-4"})(["transform:translateY(20px);background:",";border:2px solid black;border-radius:50%;overflow:hidden;width:","px;height:","px;"],(_ref2=>{let{theme}=_ref2;return theme.colors.bg.primary}),198,200),Magnifier=styled_components_browser_esm.ZP.div.withConfig({displayName:"eyedropperLayer__Magnifier",componentId:"sc-nf74gq-5"})(["position:absolute;top:0;left:0;transform:translateY(-2000px);pointer-events:none;"]),Center=styled_components_browser_esm.ZP.div.withConfig({displayName:"eyedropperLayer__Center",componentId:"sc-nf74gq-6"})(["position:absolute;top:0;left:0;right:0;bottom:0;z-index:3;background:",";cursor:not-allowed;display:flex;justify-content:center;align-items:center;"],(_ref3=>{let{theme}=_ref3;return theme.colors.opacity.black64})),CanvasImage=styled_components_browser_esm.ZP.img.withConfig({displayName:"eyedropperLayer__CanvasImage",componentId:"sc-nf74gq-7"})(["width:100%;"]);function EyedropperLayer(){const{fullbleedContainer,isEyedropperActive,eyedropperCallback,eyedropperImg,eyedropperPixelData,setIsEyedropperActive,setEyedropperImg,setEyedropperPixelData}=(0,app.$P)((_ref4=>{let{state:{fullbleedContainer,isEyedropperActive,eyedropperCallback,eyedropperImg,eyedropperPixelData},actions:{setIsEyedropperActive,setEyedropperImg,setEyedropperPixelData}}=_ref4;return{fullbleedContainer,isEyedropperActive,eyedropperCallback,eyedropperImg,eyedropperPixelData,setIsEyedropperActive,setEyedropperImg,setEyedropperPixelData}})),{isEyeDropperApiSupported}=(0,useEyeDropperApi.Z)({}),{pageWidth}=(0,app.$Y)((_ref5=>{let{state:{pageWidth}}=_ref5;return{pageWidth}})),fullHeight=pageWidth/src_constants.Sr,img=eyedropperImg,imgRef=(0,src.sO)(),magnifier=(0,src.sO)(),magnifierInfo=(0,src.sO)(),magnifierColor=(0,src.sO)(),eyedropperCanvas=(0,src.sO)(),closeEyedropper=()=>{setIsEyedropperActive(!1),setEyedropperImg(null),setEyedropperPixelData(null)};if((0,src.FR)(eyedropperCanvas,closeEyedropper,[isEyedropperActive,img]),(0,keyboard.xb)("esc",closeEyedropper),isEyeDropperApiSupported)return null;if(isEyedropperActive&&!img)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Center,{onClick:closeEyedropper,children:(0,jsx_runtime.jsx)(circular.Z,{})})});if(!isEyedropperActive||!img)return null;return(0,jsx_runtime.jsx)(EyedropperBackground,{"data-testid":"eyedropperLayer",onMouseMove:e=>{const{left,top,width,height}=fullbleedContainer.getBoundingClientRect(),x=(e.clientX-left)*(pageWidth/width),y=(e.clientY-top)*(fullHeight/height);if(x<0||y<0||x>width||y>height)return void(magnifierInfo.current.style.display="none");magnifierInfo.current.style.display="block",magnifierInfo.current.style.transform=`translate(${x-100}px, ${y}px)`,function(x,y){const canvas=magnifier.current;if(canvas){const ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.msImageSmoothingEnabled=!1,ctx.clearRect(0,0,200,200),ctx.drawImage(imgRef.current,Math.round(x-3.5),Math.round(y-3.5),7,7,0,0,200,200),ctx.beginPath(),ctx.rect(Math.round(100)-14.285714285714286,Math.round(100)-14.285714285714286,28.571428571428573,28.571428571428573),ctx.stroke()}}(x,y);const rgbaObject=utils_getColorFromPixelData(eyedropperPixelData,x,y,width),{r,g,b,a}=rgbaObject,hex=(0,polished_esm.m4)(r,g,b,a);magnifierColor.current.style.background=`rgba(${r},${g},${b},${a})`,magnifierColor.current.style.color=(0,polished_esm.XV)(hex,"#333","#EDEDED",!1),magnifierColor.current.innerText=hex},children:(0,jsx_runtime.jsx)(eyedropperLayer_DisplayPageArea,{withSafezone:!1,showOverflow:!0,children:(0,jsx_runtime.jsxs)(EyedropperCanvas,{ref:eyedropperCanvas,onClick:e=>{const{left,top,width,height}=fullbleedContainer.getBoundingClientRect(),x=(e.clientX-left)*(pageWidth/width),y=(e.clientY-top)*(fullHeight/height),rgbaObject=utils_getColorFromPixelData(eyedropperPixelData,x,y,pageWidth);eyedropperCallback(rgbaObject)},children:[(0,jsx_runtime.jsx)(CanvasImage,{ref:imgRef,src:img,alt:""}),(0,jsx_runtime.jsxs)(Magnifier,{ref:magnifierInfo,children:[(0,jsx_runtime.jsx)(Circle,{children:(0,jsx_runtime.jsx)("canvas",{ref:magnifier,width:200,height:200})}),(0,jsx_runtime.jsx)(ColorInfo,{ref:magnifierColor})]})]})})})}EyedropperLayer.displayName="EyedropperLayer";const eyedropperLayer=EyedropperLayer;var contextMenu_constants=__webpack_require__("./packages/design-system/src/components/contextMenu/constants.ts"),icons_media=__webpack_require__("./packages/design-system/src/icons/media.svg"),theme=__webpack_require__("./packages/design-system/src/theme/theme.ts"),colors=__webpack_require__("./packages/design-system/src/theme/colors.ts"),useStory=__webpack_require__("./packages/story-editor/src/app/story/useStory.ts"),isEmptyStory=__webpack_require__("./packages/story-editor/src/app/story/utils/isEmptyStory.ts");const emptyStateLayer_DisplayPageArea=(0,styled_components_browser_esm.ZP)(PageArea).withConfig({displayName:"emptyStateLayer__DisplayPageArea",componentId:"sc-1ypjr32-0"})(["position:absolute;z-index:1;"]),EmptyStateMessage=styled_components_browser_esm.ZP.div.withConfig({displayName:"emptyStateLayer__EmptyStateMessage",componentId:"sc-1ypjr32-1"})(["display:flex;flex-direction:column;align-items:center;padding:20px;text-align:center;svg{pointer-events:none;}p{margin-top:14px;}"]),emptyStateLayer_StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"emptyStateLayer__StyledButton",componentId:"sc-1ypjr32-2"})(["pointer-events:initial;"]);function EmptyStateLayer(){const{isRTL}=(0,app.ZR)(),{isMenuOpen,onOpenMenu}=(0,app.LG)((_ref=>{let{isMenuOpen,onOpenMenu}=_ref;return{isMenuOpen,onOpenMenu}})),{pages}=(0,useStory.Z)((_ref2=>{let{state:{pages}}=_ref2;return{pages}})),{isAnythingTransforming}=(0,transform_src.Hm)((state=>({isAnythingTransforming:state.state.isAnythingTransforming})));if(!(0,isEmptyStory.Z)(pages)||isAnythingTransforming)return null;return(0,jsx_runtime.jsx)(Layer,{onContextMenu:onOpenMenu,pointerEvents:"none","aria-label":(0,i18n.__)("Empty state layer","web-stories"),children:(0,jsx_runtime.jsx)(emptyStateLayer_DisplayPageArea,{withSafezone:!1,children:(0,jsx_runtime.jsxs)(EmptyStateMessage,{children:[(0,jsx_runtime.jsx)(emptyStateLayer_StyledButton,{type:button_constants.L$.Secondary,variant:button_constants.Wu.Circle,onClick:e=>{const bb=e.target.getBoundingClientRect();e.clientX=bb.left-(isRTL?-1:1)*contextMenu_constants.Q/2+bb.width/2;e.clientY=bb.top-132+bb.height,onOpenMenu(e)},"aria-haspopup":"true","aria-label":(0,i18n.__)("Add content","web-stories"),"aria-describedby":"emptystate-message","aria-expanded":isMenuOpen,children:(0,jsx_runtime.jsx)(icons_media.Z,{})}),(0,jsx_runtime.jsx)(styled_components_browser_esm.f6,{theme:{...theme.r,colors:colors.R},children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{id:"emptystate-message",size:types.TextSize.Small,children:(0,i18n.__)("Add an image, video or template to get started","web-stories")})})]})})})}EmptyStateLayer.displayName="EmptyStateLayer";const emptyStateLayer=EmptyStateLayer;var stylis_rtl=__webpack_require__("./node_modules/stylis-plugin-rtl/dist/stylis-rtl.js"),useConfig=__webpack_require__("./packages/story-editor/src/app/config/useConfig.ts"),videoTrimContext=__webpack_require__("./packages/story-editor/src/components/videoTrim/videoTrimContext.js"),useVideoNode=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoNode.js");function VideoRecordingTrimProvider(_ref){let{children,onTrim,videoData}=_ref;const{hasChanged,currentTime,startOffset,endOffset,maxOffset,videoNode,setStartOffset,setEndOffset,setVideoNode,setIsDraggingHandles}=(0,useVideoNode.Z)(videoData),performTrim=(0,src.I4)((()=>{onTrim({start:startOffset,end:endOffset}),(0,tracking_src.L9)("recording_video_trim",{start_offset:startOffset,end_offset:endOffset})}),[endOffset,startOffset,onTrim]),value={state:{videoData,hasChanged,isTrimMode:!0,currentTime,startOffset,endOffset,maxOffset,videoNode},actions:{performTrim,setVideoNode,setStartOffset,setEndOffset,setIsDraggingHandles,toggleTrimMode:()=>onTrim()}};return(0,jsx_runtime.jsx)(videoTrimContext.Z.Provider,{value,children})}VideoRecordingTrimProvider.displayName="VideoRecordingTrimProvider";const recordingProvider=VideoRecordingTrimProvider;Object.defineProperty(stylis_rtl.ZP,"name",{value:"stylisRTLPlugin"});const mediaRecordingLayer_DisplayPageArea=(0,styled_components_browser_esm.ZP)(PageArea).withConfig({displayName:"mediaRecordingLayer__DisplayPageArea",componentId:"sc-18wneqt-0"})(["position:absolute;"]),mediaRecordingLayer_LayerWithGrayout=(0,moveable_src.Ep)((0,styled_components_browser_esm.ZP)(Layer).withConfig({displayName:"mediaRecordingLayer__LayerWithGrayout",componentId:"sc-18wneqt-1"})(["background-color:",";z-index:",";"],(_ref=>{let{theme}=_ref;return theme.colors.opacity.overlayExtraDark}),zIndex.wp)),StyledFooter=(0,styled_components_browser_esm.ZP)(FooterArea).withConfig({displayName:"mediaRecordingLayer__StyledFooter",componentId:"sc-18wneqt-2"})(["display:flex;align-items:start;flex-direction:row;justify-content:center;z-index:",";"],zIndex.wp);function MediaRecordingLayer(){const{isRTL}=(0,useConfig.Z)(),{status,inputStatus,audioInput,videoInput,hasVideo,isAdjustingTrim,trimData,originalMediaBlobUrl,duration,updateMediaDevices,getMediaStream,resetStream,onTrim,videoEffect}=(0,mediaRecording._T)((_ref2=>{let{state,actions}=_ref2;return{status:state.status,inputStatus:state.inputStatus,audioInput:state.audioInput,videoInput:state.videoInput,hasVideo:state.hasVideo,isAdjustingTrim:state.isAdjustingTrim,trimData:state.trimData,originalMediaBlobUrl:state.originalMediaBlobUrl,duration:state.duration,videoEffect:state.videoEffect,updateMediaDevices:actions.updateMediaDevices,getMediaStream:actions.getMediaStream,resetStream:actions.resetStream,onTrim:actions.onTrim}})),isReady="ready"===inputStatus||"ready"===status;(0,src.d4)((()=>{!async function run(){resetStream(),await getMediaStream()}()}),[audioInput,videoInput,hasVideo,videoEffect]),(0,src.d4)((()=>{isReady&&updateMediaDevices()}),[isReady,updateMediaDevices]);const videoData=(0,src.Ye)((()=>isAdjustingTrim?{element:{width:480*src_constants.Sr,height:480,scale:1,focalX:50,focalY:50,flip:{}},resource:{src:originalMediaBlobUrl,length:duration},...trimData}:null),[isAdjustingTrim,trimData,originalMediaBlobUrl,duration]);return(0,jsx_runtime.jsx)(styled_components_browser_esm.LC,{stylisPlugins:isRTL?[stylis_rtl.ZP]:[],children:(0,jsx_runtime.jsxs)(recordingProvider,{onTrim,videoData,children:[(0,jsx_runtime.jsxs)(mediaRecordingLayer_LayerWithGrayout,{"aria-label":(0,i18n.__)("Media Recording layer","web-stories"),children:[(0,jsx_runtime.jsx)(PageTitleContainer,{children:(0,jsx_runtime.jsx)(mediaRecording.QY,{})}),(0,jsx_runtime.jsx)(mediaRecordingLayer_DisplayPageArea,{withSafezone:!1,showOverflow:!0,children:(0,jsx_runtime.jsx)(mediaRecording.B3,{})}),(0,jsx_runtime.jsx)(StyledFooter,{showOverflow:!0,children:isAdjustingTrim?(0,jsx_runtime.jsx)(videoTrimmer,{}):(0,jsx_runtime.jsx)(mediaRecording.$_,{})})]}),(0,jsx_runtime.jsx)(mediaRecording.TB,{})]})})}MediaRecordingLayer.displayName="MediaRecordingLayer";const mediaRecordingLayer=MediaRecordingLayer,Background=styled_components_browser_esm.ZP.section.attrs({"aria-label":(0,i18n.__)("Canvas","web-stories"),"data-fix-caret":!0}).withConfig({displayName:"canvasLayout__Background",componentId:"sc-1ciyn0c-0"})(["background-color:",";width:100%;height:100%;position:relative;user-select:none;"],(_ref=>{let{theme}=_ref;return theme.colors.bg.primary}));function CanvasLayout(_ref2){let{header,footer}=_ref2;const boundingBoxTrackingRef=(0,app.l8)(app.lb.CANVAS_CONTAINER),setCanvasContainer=(0,app.$P)((state=>state.actions.setCanvasContainer)),backgroundRef=(0,src.sO)(null),setBackgroundRef=(0,src.HB)(backgroundRef,setCanvasContainer,boundingBoxTrackingRef);!function useLayoutParams(containerRef){const{setWorkspaceSize}=(0,app.$Y)((_ref18=>{let{actions:{setWorkspaceSize}}=_ref18;return{setWorkspaceSize}})),footerHeight=footer_useFooterHeight();(0,src.Bz)(containerRef,(_ref19=>{let{width,height}=_ref19;const availableHeight=height-constants.Mz-constants.Qu-footerHeight-FOOTER_BOTTOM_MARGIN;setWorkspaceSize({width,height,availableHeight})}),[setWorkspaceSize,footerHeight])}(backgroundRef);const layoutParamsCss=function useLayoutParamsCssVars(){const{pageWidth,pageHeight,pagePadding,viewportWidth,viewportHeight,hasPageNavigation,hasVerticalOverflow,hasHorizontalOverflow,scrollLeft,scrollTop}=(0,app.$Y)((_ref20=>{let{state:{pageWidth,pageHeight,pagePadding,viewportWidth,viewportHeight,hasPageNavigation,hasVerticalOverflow,hasHorizontalOverflow,scrollLeft,scrollTop}}=_ref20;return{pageWidth,pageHeight,pagePadding,viewportWidth,viewportHeight,hasPageNavigation,hasVerticalOverflow,hasHorizontalOverflow,scrollLeft,scrollTop}})),fullHeight=pageWidth/src_constants.Sr;return{"--page-nav-width":`${hasPageNavigation?PAGE_NAV_WIDTH:0}px`,"--page-nav-gap":`${hasPageNavigation?PAGE_NAV_GAP:0}px`,"--page-width-px":`${pageWidth}px`,"--page-height-px":`${pageHeight}px`,"--page-padding-px":`${pagePadding}px`,"--fullbleed-height-px":`${fullHeight}px`,"--viewport-width-px":`${viewportWidth}px`,"--viewport-height-px":`${viewportHeight}px`,"--overflow-x":hasHorizontalOverflow?"scroll":"visible","--overflow-y":hasVerticalOverflow?"scroll":"visible","--scroll-left-px":-scrollLeft+"px","--scroll-top-px":-scrollTop+"px"}}(),{pageWidth,pageHeight}=(0,app.$Y)((_ref3=>{let{state:{pageWidth,pageHeight}}=_ref3;return{pageWidth,pageHeight}})),{isInRecordingMode}=(0,mediaRecording._T)((_ref4=>{let{state:{isInRecordingMode}}=_ref4;return{isInRecordingMode}})),hasDimensions=0!==pageWidth&&0!==pageHeight;return(0,jsx_runtime.jsx)(styled_components_browser_esm.LC,{stylisPlugins:[],children:(0,jsx_runtime.jsx)(editLayerFocusManager.ZP,{children:(0,jsx_runtime.jsx)(Background,{ref:setBackgroundRef,style:layoutParamsCss,children:(0,jsx_runtime.jsx)(canvasUploadDropTarget,{children:(0,jsx_runtime.jsxs)(canvasElementDropzone,{children:[(0,jsx_runtime.jsxs)(selectionCanvas,{children:[hasDimensions&&!isInRecordingMode&&(0,jsx_runtime.jsx)(displayLayer,{}),hasDimensions&&!isInRecordingMode&&(0,jsx_runtime.jsx)(framesLayer,{}),(0,jsx_runtime.jsx)(navLayer,{header,footer})]}),(0,jsx_runtime.jsx)(editLayer,{}),!isInRecordingMode&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(eyedropperLayer,{}),(0,jsx_runtime.jsx)(emptyStateLayer,{}),(0,jsx_runtime.jsx)(floatingMenu_layer,{})]}),isInRecordingMode&&(0,jsx_runtime.jsx)(mediaRecordingLayer,{})]})})})})})}CanvasLayout.displayName="CanvasLayout";const canvasLayout=(0,src.X$)(CanvasLayout);function Canvas(_ref){let{header,footer}=_ref;return(0,jsx_runtime.jsx)(canvasLayout,{header,footer})}Canvas.displayName="Canvas";const canvas_canvas=Canvas;var rich_text_src=__webpack_require__("./packages/rich-text/src/index.ts"),pageCanvas=__webpack_require__("./packages/story-editor/src/app/pageCanvas/index.ts");const canvas_useInsertTextSet=function useInsertTextSet(){let shouldUseSmartColor=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const insertElement=(0,useInsertElement.Z)(),calculateAccessibleTextColors=(0,pageCanvas.J0)(),{setSelectedElementsById}=(0,story.rB)((_ref=>{let{actions:{setSelectedElementsById}}=_ref;return{setSelectedElementsById}})),insertTextSet=(0,src.iS)((async function(toAdd){let applySmartColor=arguments.length>1&&void 0!==arguments[1]?arguments[1]:shouldUseSmartColor;const htmlFormatters=(0,rich_text_src.l5)(),{setColor}=htmlFormatters,addedElements=[],hasPredefinedColor=toAdd.some((element=>element.content?.includes("color:")));let textElementsContrasts=[],firstValidColor=null;const white={r:255,g:255,b:255},black={r:0,g:0,b:0},whiteScrim={...white,a:.3},blackScrim={...black,a:.3};let preferredScrimColor,scrimsCount,useScrim;if(applySmartColor&&!hasPredefinedColor){textElementsContrasts=await Promise.all(toAdd.map((element=>"text"===element.type?calculateAccessibleTextColors(element):null))),firstValidColor=textElementsContrasts.find((c=>c));const allColorsEqual=textElementsContrasts.every((contrast=>null===contrast||contrast.color?.r===firstValidColor.color?.r&&contrast.color?.g===firstValidColor.color?.g&&contrast.color?.b===firstValidColor.color?.b&&contrast.color?.a===firstValidColor.color?.a));scrimsCount=textElementsContrasts.reduce(((acc,contrast)=>contrast?.backgroundColor?acc+1:acc),0);const blackScrims=textElementsContrasts.reduce(((acc,contrast)=>0===contrast?.backgroundColor?.r&&0===contrast?.backgroundColor?.g&&0===contrast?.backgroundColor?.b?acc+1:acc),0);if(preferredScrimColor=scrimsCount-blackScrims>0?blackScrim:whiteScrim,useScrim=scrimsCount>0||!1===allColorsEqual,useScrim){const{textSetHeight,textSetWidth}=toAdd[0],getMinDim=dim=>Math.min.apply(null,toAdd.map((e=>e[dim]))),scrim={x:getMinDim("x")-24,y:getMinDim("y")-24,width:textSetWidth+48,height:textSetHeight+48,backgroundColor:{color:preferredScrimColor},type:"shape"};addedElements.push(insertElement(elements_src.Yj.SHAPE,scrim))}}toAdd.forEach(((element,index)=>{const toInsert=(0,objectWithout.Z)(element,["id","normalizedOffsetX","normalizedOffsetY","textSetWidth","textSetHeight"]);if(applySmartColor&&!hasPredefinedColor){const scrimContrastingTextColor=0===preferredScrimColor.r?white:black,autoColor=useScrim?{color:scrimContrastingTextColor}:textElementsContrasts[index];"text"===element.type&&autoColor.color&&(toInsert.content=setColor(toInsert.content,autoColor)),"shape"===element.type&&firstValidColor.color&&(element.border?toInsert.border.color=firstValidColor:toInsert.backgroundColor=firstValidColor)}addedElements.push(insertElement(element.type,toInsert))})),setSelectedElementsById({elementIds:addedElements.map((_ref2=>{let{id}=_ref2;return id}))})}),[calculateAccessibleTextColors,shouldUseSmartColor,insertElement,setSelectedElementsById]),insertTextSetByOffset=(0,src.I4)(((elements,_ref3)=>{let{offsetX,offsetY}=_ref3;if(!elements.length)return;const positionedTextSet=elements.map((element=>{const x=element.normalizedOffsetX+offsetX,y=element.normalizedOffsetY+offsetY,{width,height}=element;return x>src_constants.JN||x+width<0||y>src_constants.gC||y+height<-src_constants.Z5?null:{...element,x,y}})).filter((el=>el));insertTextSet(positionedTextSet,!1)}),[insertTextSet]);return{insertTextSet,insertTextSetByOffset}}},"./packages/story-editor/src/components/canvas/utils/useSnapping.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/units/src/constants.ts"),_dropTargets__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),_app__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/app/index.js");const __WEBPACK_DEFAULT_EXPORT__=function useSnapping(_ref){let{canSnap,otherNodes,snappingOffsetX=null,isDragging}=_ref;const canvasRect=(0,_app__WEBPACK_IMPORTED_MODULE_2__.Cj)(_app__WEBPACK_IMPORTED_MODULE_2__.lb.CANVAS_CONTAINER),pageRect=(0,_app__WEBPACK_IMPORTED_MODULE_2__.Cj)(_app__WEBPACK_IMPORTED_MODULE_2__.lb.PAGE_CONTAINER),designSpaceGuideline=(0,_app__WEBPACK_IMPORTED_MODULE_2__.$P)((_ref2=>{let{state}=_ref2;return state.designSpaceGuideline})),{pageWidth,pageHeight}=(0,_app__WEBPACK_IMPORTED_MODULE_2__.$Y)((_ref3=>{let{state:{pageWidth,pageHeight}}=_ref3;return{pageWidth,pageHeight}})),{activeDropTargetId,isDropTargetingDisabled}=(0,_dropTargets__WEBPACK_IMPORTED_MODULE_1__.H)((_ref4=>{let{state}=_ref4;return{activeDropTargetId:state.activeDropTargetId,isDropTargetingDisabled:state.isDropTargetingDisabled}})),triggerOnboarding=(0,_app__WEBPACK_IMPORTED_MODULE_2__.gy)((_ref5=>{let{SAFE_ZONE}=_ref5;return SAFE_ZONE}));canSnap=canSnap&&!isDropTargetingDisabled&&!activeDropTargetId;const handleSnap=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.I4)((_ref6=>{let{elements}=_ref6;const isSnappingDesignSpace=elements.flat().some((_ref7=>{let{center,element}=_ref7;return element===designSpaceGuideline&&!center}));isDragging&&isSnappingDesignSpace&&triggerOnboarding()}),[isDragging,designSpaceGuideline,triggerOnboarding]);if(!canvasRect||!pageRect)return{};const canvasOffsetX=snappingOffsetX||canvasRect.x,offsetX=Math.ceil(pageRect.x-canvasOffsetX),offsetY=Math.floor(pageRect.y-canvasRect.y),verticalGuidelines=canSnap?[offsetX,offsetX+pageWidth/2,offsetX+pageWidth]:[],fullBleedOffset=(pageWidth/_googleforcreators_units__WEBPACK_IMPORTED_MODULE_3__.Sr-pageHeight)/2,snapDirections={left:!0,top:!0,right:!0,bottom:!0,center:!0,middle:!0};return{snappable:canSnap,snapGap:canSnap,snapDirections,elementSnapDirections:snapDirections,isDisplaySnapDigit:!1,onSnap:handleSnap,horizontalGuidelines:canSnap?[offsetY-fullBleedOffset,offsetY,offsetY+pageHeight/2,offsetY+pageHeight,offsetY+pageHeight+fullBleedOffset]:[],verticalGuidelines,elementGuidelines:canSnap?[...otherNodes,designSpaceGuideline]:[]}}},"./packages/story-editor/src/components/elementLink/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>createLink,W:()=>getLinkFromElement});var _googleforcreators_elements__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/elements/src/index.ts");function getLinkFromElement(element){return element.link||null}function createLink(){let{url="",needsProxy=!1,rel=[],type=_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_0__.Un.Regular,pageId=null,...rest}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{needsProxy,url,rel,type,pageId,...rest}}},"./packages/story-editor/src/components/helpCenter/menu/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{v:()=>Menu});__webpack_require__("./node_modules/react/index.js");var styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Panel=styled_components_browser_esm.ZP.div.withConfig({displayName:"header__Panel",componentId:"sc-1aci6do-0"})(["padding:24px 0 16px 0;border-bottom:1px solid ",";"],(_ref=>{let{theme}=_ref;return theme.colors.bg.tertiary})),Heading=styled_components_browser_esm.ZP.h1.withConfig({displayName:"header__Heading",componentId:"sc-1aci6do-1"})([""," color:",";line-height:32px;margin:0 0 8px 0;"],expandPresetStyles.K(((_ref2,_ref3)=>{let{label}=_ref2,{Medium}=_ref3;return label[Medium]})),(_ref4=>{let{theme}=_ref4;return theme.colors.fg.primary}));function Header(){return(0,jsx_runtime.jsxs)(Panel,{children:[(0,jsx_runtime.jsx)(Heading,{as:"h2",children:(0,i18n.__)("Web Stories Help Center","web-stories")}),(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{size:types.TextSize.XSmall,children:(0,i18n.__)("Discover tips & resources to help you get the most out of your Web Stories.","web-stories")})]})}Header.displayName="Header";var button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),arrow_left=__webpack_require__("./packages/design-system/src/icons/arrow_left.svg"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),utils=__webpack_require__("./packages/story-editor/src/components/helpCenter/utils.js"),app=__webpack_require__("./packages/story-editor/src/app/index.js");const tips_Panel=styled_components_browser_esm.ZP.div.withConfig({displayName:"tips__Panel",componentId:"sc-1bvshes-0"})(["padding:24px 0;"]),StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"tips__StyledButton",componentId:"sc-1bvshes-1"})([""," display:flex;justify-content:space-between;width:100%;padding:6px 0;"],expandPresetStyles.K(((_ref,_ref2)=>{let{label}=_ref,{Small}=_ref2;return label[Small]}))),ButtonText=styled_components_browser_esm.ZP.span.withConfig({displayName:"tips__ButtonText",componentId:"sc-1bvshes-2"})(["vertical-align:middle;text-align:left;",""],(_ref3=>{let{unread,theme}=_ref3;return unread&&(0,styled_components_browser_esm.iv)(["&::before{content:' ';display:inline-block;height:10px;width:10px;margin-right:16px;border-radius:",";background-color:",";}"],theme.borders.radius.round,theme.colors.accent.primary)})),ArrowWrap=styled_components_browser_esm.ZP.div.withConfig({displayName:"tips__ArrowWrap",componentId:"sc-1bvshes-3"})(["width:32px;margin:-9px;transform-origin:50% 50%;transform:",";"],(_ref4=>{let{$isRTL}=_ref4;return $isRTL?"none":"rotate(180deg)"})),StyledArrow=(0,styled_components_browser_esm.ZP)(arrow_left.Z).withConfig({displayName:"tips__StyledArrow",componentId:"sc-1bvshes-4"})(["width:100%;"]);function Tip(_ref5){let{children,onClick,unread=!0}=_ref5;const{isRTL}=(0,config.ZR)();return(0,jsx_runtime.jsxs)(StyledButton,{size:button_constants.qE.Small,onClick,children:[(0,jsx_runtime.jsx)(ButtonText,{unread,children}),(0,jsx_runtime.jsx)(ArrowWrap,{$isRTL:isRTL,children:(0,jsx_runtime.jsx)(StyledArrow,{})})]})}function Tips(_ref6){let{onTipSelect=noop.Z,readTips}=_ref6;const{state:{tips}}=(0,app.Do)(),tipsIterable=Object.entries(tips);return(0,jsx_runtime.jsx)(tips_Panel,{children:tipsIterable.map((_ref7=>{let[key,tip]=_ref7;return(0,jsx_runtime.jsx)(Tip,{unread:!readTips[key],onClick:()=>{(0,utils.o)(),onTipSelect(key)},children:tip.title},key)}))})}Tip.displayName="Tip",Tips.displayName="Tips";var theme_constants=__webpack_require__("./packages/design-system/src/theme/constants/index.ts"),scheduledTransition=__webpack_require__("./packages/story-editor/src/components/transition/scheduledTransition.js");const DURATION=1.2*constants.CT,enterStyles=(0,styled_components_browser_esm.iv)(["opacity:1;transform:none;"]),exitStyles=(0,styled_components_browser_esm.iv)(["position:absolute;bottom:0;opacity:0.6;transform:scale(0.96);"]),transitionStyles={entering:enterStyles,entered:enterStyles,exiting:exitStyles,exited:exitStyles},Manager=styled_components_browser_esm.ZP.div.withConfig({displayName:"transitioner__Manager",componentId:"sc-aat78p-0"})(["position:relative;color:",";opacity:0.6;transform-origin:50% 50%;transform:scale(0.96);transition:transform ","ms ",",opacity ","ms ",";z-index:",";",";"],(_ref=>{let{theme}=_ref;return theme.colors.fg.primary}),DURATION,theme_constants.s.default,DURATION,theme_constants.s.default,constants.kg.MENU,(_ref2=>{let{state}=_ref2;return transitionStyles[state]}));function Transitioner(_ref3){let{children,...props}=_ref3;return(0,jsx_runtime.jsx)(scheduledTransition.i,{...props,timeout:DURATION,mountOnEnter:!0,unmountOnExit:!0,children:state=>(0,jsx_runtime.jsx)(Manager,{state,children})})}Transitioner.displayName="Transitioner";const Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"menu__Container",componentId:"sc-ztoh5v-0"})(["padding:0 ","px;max-height:60vh;overflow-y:scroll;*{user-select:text;}"],constants.q3);function Menu(_ref){let{onTipSelect=noop.Z,readTips,components,...transitionProps}=_ref;const Footer=components?.Footer;return(0,jsx_runtime.jsx)(Transitioner,{...transitionProps,children:(0,jsx_runtime.jsxs)(Container,{"data-testid":"help_center_container",children:[(0,jsx_runtime.jsx)(Header,{}),(0,jsx_runtime.jsx)(Tips,{readTips,onTipSelect}),Footer&&(0,jsx_runtime.jsx)(Footer,{})]})})}Menu.displayName="Menu"},"./packages/story-editor/src/components/helpCenter/navigator/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>helpCenter_navigator});__webpack_require__("./node_modules/react/index.js");var i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),src=__webpack_require__("./packages/react/src/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),fullSize=__webpack_require__("./packages/design-system/src/theme/helpers/fullSize.ts"),constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),secondaryPopup=__webpack_require__("./packages/story-editor/src/components/secondaryPopup/index.js"),theme_constants=__webpack_require__("./packages/design-system/src/theme/constants/index.ts"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),arrow_left=__webpack_require__("./packages/design-system/src/icons/arrow_left.svg"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),utils=__webpack_require__("./packages/story-editor/src/components/helpCenter/utils.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const secondaryTextStyle=(0,styled_components_browser_esm.iv)(["color:",";"],(_ref=>{let{theme}=_ref;return theme.colors.fg.secondary})),AllTips=styled_components_browser_esm.ZP.span.withConfig({displayName:"bottomNavigation__AllTips",componentId:"sc-yk08yc-0"})(["",""],secondaryTextStyle),BottomNavBar=(0,styled_components_browser_esm.ZP)(secondaryPopup.l2).withConfig({displayName:"bottomNavigation__BottomNavBar",componentId:"sc-yk08yc-1"})(["position:absolute;bottom:0;transition:transform ","ms ",";z-index:2;",""],constants.CT,theme_constants.s.default,(_ref2=>{let{isHidden}=_ref2;return isHidden&&(0,styled_components_browser_esm.iv)(["transform:translateY(100%);"])})),BottomNavButtons=styled_components_browser_esm.ZP.div.withConfig({displayName:"bottomNavigation__BottomNavButtons",componentId:"sc-yk08yc-2"})(["display:flex;padding:0 16px;white-space:nowrap;"]),ArrowWrap=styled_components_browser_esm.ZP.div.withConfig({displayName:"bottomNavigation__ArrowWrap",componentId:"sc-yk08yc-3"})([""," margin:-5px -16px;"," svg{display:block;}"],secondaryTextStyle,(_ref3=>{let{$isRTL}=_ref3;return $isRTL&&(0,styled_components_browser_esm.iv)(["transform:rotate(180deg);"])})),onCondition=condition=>fn=>{condition&&fn()};function BottomNavigation(_ref4){let{onAllTips,onPrev,onNext,hasBottomNavigation,isNextDisabled,isPrevDisabled}=_ref4;const{isRTL}=(0,config.ZR)(),prevButtonRef=(0,src.sO)(null),nextButtonRef=(0,src.sO)(null),[local,setLocal]=(0,src.eJ)({isPrevDisabled,isNextDisabled});return(0,src.d4)((()=>{[isPrevDisabled&&document.activeElement===prevButtonRef.current,isNextDisabled&&document.activeElement===nextButtonRef.current].forEach((condition=>onCondition(condition)(utils.o))),setLocal({isPrevDisabled,isNextDisabled})}),[isPrevDisabled,isNextDisabled]),(0,jsx_runtime.jsxs)(BottomNavBar,{"aria-hidden":!hasBottomNavigation,isHidden:!hasBottomNavigation,children:[(0,jsx_runtime.jsx)(BottomNavButtons,{children:(0,jsx_runtime.jsxs)(secondaryPopup.fe,{onClick:()=>{(0,utils.o)(),onAllTips()},type:button_constants.L$.Plain,size:button_constants.qE.Small,disabled:!hasBottomNavigation,children:[(0,jsx_runtime.jsx)(ArrowWrap,{$isRTL:isRTL,children:(0,jsx_runtime.jsx)(arrow_left.Z,{})}),(0,jsx_runtime.jsx)(AllTips,{children:(0,i18n.__)("All Tips","web-stories")})]})}),(0,jsx_runtime.jsxs)(BottomNavButtons,{children:[(0,jsx_runtime.jsx)(secondaryPopup.fe,{ref:prevButtonRef,onClick:onPrev,type:button_constants.L$.Plain,size:button_constants.qE.Small,disabled:!hasBottomNavigation||local.isPrevDisabled,children:(0,i18n.__)("Previous","web-stories")}),(0,jsx_runtime.jsx)(secondaryPopup.fe,{ref:nextButtonRef,onClick:onNext,type:button_constants.L$.Plain,size:button_constants.qE.Small,disabled:!hasBottomNavigation||local.isNextDisabled,children:(0,i18n.__)("Next","web-stories")})]})]})}BottomNavigation.displayName="BottomNavigation";var noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const Layout=styled_components_browser_esm.ZP.div.withConfig({displayName:"navigator__Layout",componentId:"sc-3xgugm-0"})([""," contain:content;"],fullSize.i),Content=styled_components_browser_esm.ZP.div.withConfig({displayName:"navigator__Content",componentId:"sc-3xgugm-1"})([""]),ContentInner=styled_components_browser_esm.ZP.div.withConfig({displayName:"navigator__ContentInner",componentId:"sc-3xgugm-2"})(["position:relative;"]);function Navigator(_ref){let{children,isOpen,onClose,onNext,onPrev,onAllTips,hasBottomNavigation,isNextDisabled,isPrevDisabled}=_ref;const innerRef=(0,src.sO)(null),layoutRef=(0,src.sO)(null);return(0,src.d4)((()=>function removeInnerElementFromLayoutFlow(innerEl,outerEl){if(!innerEl||!outerEl)return noop.Z;const{height}=innerEl.getBoundingClientRect();outerEl.style.height=`${height}px`,innerEl.style.position="absolute",innerEl.style.bottom=0,innerEl.style.content="contain";let id=requestAnimationFrame((()=>{id=requestAnimationFrame((()=>{outerEl.style.transition=`height ${constants.CT}ms ${theme_constants.s.default}`}))}));return()=>cancelAnimationFrame(id)}(innerRef.current,layoutRef.current)),[]),(0,src.Bz)(innerRef,(_ref2=>{let{height}=_ref2;layoutRef.current&&(layoutRef.current.style.height=`${height}px`)}),[]),(0,jsx_runtime.jsxs)(secondaryPopup.dl,{isOpen,children:[(0,jsx_runtime.jsx)(secondaryPopup._g,{onClose,label:(0,i18n.__)("Quick Tips","web-stories"),popupId:constants.Uq}),(0,jsx_runtime.jsx)(Layout,{ref:layoutRef,children:(0,jsx_runtime.jsx)(Content,{ref:innerRef,children:(0,jsx_runtime.jsx)(ContentInner,{children})})}),(0,jsx_runtime.jsx)(BottomNavigation,{onNext,onPrev,onAllTips,hasBottomNavigation,isNextDisabled,isPrevDisabled})]})}Navigator.displayName="Navigator";const helpCenter_navigator=(0,src.X$)(Navigator)},"./packages/story-editor/src/components/helpCenter/quickTip/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>QuickTip});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),translateWithMarkup=__webpack_require__("./packages/i18n/src/translateWithMarkup.tsx"),expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),centerContent=__webpack_require__("./packages/design-system/src/theme/helpers/centerContent.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),typography_link=__webpack_require__("./packages/design-system/src/components/typography/link/index.tsx"),visuallyHidden=__webpack_require__("./packages/design-system/src/components/visuallyHidden.ts"),secondaryPopup=__webpack_require__("./packages/story-editor/src/components/secondaryPopup/index.js"),constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),theme_constants=__webpack_require__("./packages/design-system/src/theme/constants/index.ts"),scheduledTransition=__webpack_require__("./packages/story-editor/src/components/transition/scheduledTransition.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const DELAY=80,DURATION=constants.CT-DELAY,Opacity=styled_components_browser_esm.ZP.div.withConfig({displayName:"transitioner__Opacity",componentId:"sc-cc5d3w-0"})([""]),enterStyles=()=>(0,styled_components_browser_esm.iv)(["transition-delay:","ms;transform:none;","{opacity:1;}"],DELAY,Opacity),exitStyles=_ref=>{let{isLeftToRightTransition}=_ref;return(0,styled_components_browser_esm.iv)(["position:absolute;bottom:0;","{opacity:0;}",""],Opacity,isLeftToRightTransition?(0,styled_components_browser_esm.iv)(["transform:translateX(-100%);"]):(0,styled_components_browser_esm.iv)(["transform:translateX(100%);"]))},transitionStyles={entering:enterStyles,entered:enterStyles,exiting:exitStyles,exited:exitStyles},Manager=styled_components_browser_esm.ZP.div.withConfig({displayName:"transitioner__Manager",componentId:"sc-cc5d3w-1"})(["position:relative;color:",";background-color:",";transition:transform ","ms ",";transform-origin:50% 50%;z-index:",";"," ","{opacity:0.6;transition:opacity ","ms ",";}",";"],(_ref2=>{let{theme}=_ref2;return theme.colors.fg.primary}),(_ref3=>{let{theme}=_ref3;return theme.colors.bg.primary}),DURATION,theme_constants.s.default,constants.kg.QUICK_TIP,(_ref4=>{let{isLeftToRightTransition}=_ref4;return isLeftToRightTransition?(0,styled_components_browser_esm.iv)(["transform:translateX(100%);"]):(0,styled_components_browser_esm.iv)(["transform:translateX(-100%);"])}),Opacity,DURATION,theme_constants.s.default,(_ref5=>{let{state,...props}=_ref5;return transitionStyles[state]?.(props)}));function Transitioner(_ref6){let{children,isLeftToRightTransition,...props}=_ref6;return(0,jsx_runtime.jsx)(scheduledTransition.i,{...props,timeout:{enter:DURATION+DELAY,exit:DURATION},mountOnEnter:!0,unmountOnExit:!0,children:state=>(0,jsx_runtime.jsx)(Manager,{state,isLeftToRightTransition,children:(0,jsx_runtime.jsx)(Opacity,{children})})})}var _circle,_path,_path2;function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}Transitioner.displayName="Transitioner";const SvgDoneCheckmark=_ref=>{let{title,titleId,...props}=_ref;return react.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 135 136","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,_circle||(_circle=react.createElement("circle",{cx:67.5,cy:68.5,r:67.5,fill:"currentColor"})),_path||(_path=react.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M67.5 93.146c13.889 0 25.148-11.259 25.148-25.147 0-13.889-11.26-25.147-25.147-25.147-13.889 0-25.148 11.258-25.148 25.147 0 13.888 11.26 25.147 25.148 25.147Z"})),_path2||(_path2=react.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M81.698 57.64a1.5 1.5 0 0 1 .037 2.12l-17.93 18.563a1.5 1.5 0 0 1-2.157 0l-7.383-7.643a1.5 1.5 0 1 1 2.158-2.084l6.304 6.526 16.85-17.445a1.5 1.5 0 0 1 2.121-.037Z",clipRule:"evenodd"})))},doneCheckmark=(0,react.memo)(SvgDoneCheckmark),Panel=styled_components_browser_esm.ZP.div.withConfig({displayName:"quickTip__Panel",componentId:"sc-1kyj87z-0"})(["width:100%;padding-bottom:","px;*{user-select:text;}"],secondaryPopup.aj),Overflow=styled_components_browser_esm.ZP.div.withConfig({displayName:"quickTip__Overflow",componentId:"sc-1kyj87z-1"})(["position:relative;width:100%;max-height:70vh;padding:","px;strong{font-weight:700;}"],constants.q3),Video=styled_components_browser_esm.ZP.video.withConfig({displayName:"quickTip__Video",componentId:"sc-1kyj87z-2"})(["height:180px;margin-bottom:","px;max-width:100%;"],constants.q3),Title=styled_components_browser_esm.ZP.h1.withConfig({displayName:"quickTip__Title",componentId:"sc-1kyj87z-3"})([""," color:",";line-height:32px;margin:0 0 8px 0;"],expandPresetStyles.K(((_ref,_ref2)=>{let{label}=_ref,{Medium}=_ref2;return label[Medium]})),(_ref3=>{let{theme}=_ref3;return theme.colors.fg.primary})),Paragraph=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"quickTip__Paragraph",componentId:"sc-1kyj87z-4"})(["& + &{margin-top:8px;}"]),DoneContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"quickTip__DoneContainer",componentId:"sc-1kyj87z-5"})([""," height:180px;margin-bottom:","px;color:#f4f2ef;svg{display:block;path{color:#4285f4;}}"],centerContent.z,constants.q3);function QuickTip(_ref4){let{title,description,isLeftToRightTransition=!0,figureSrc,figureSrcImg,figureAlt,href,isDone=!1,...transitionProps}=_ref4;const{cdnURL}=(0,app.ZR)();return(0,jsx_runtime.jsx)(Transitioner,{...transitionProps,isLeftToRightTransition,children:(0,jsx_runtime.jsx)(Panel,{children:(0,jsx_runtime.jsxs)(Overflow,{children:[Boolean(figureSrc)&&(0,jsx_runtime.jsxs)(Video,{controls:!1,autoPlay:!0,loop:!0,muted:!0,noControls:!0,preload:"true",crossOrigin:"anonymous",children:[(0,jsx_runtime.jsx)("source",{src:`${cdnURL}${figureSrc}.webm`,type:"video/webm"}),(0,jsx_runtime.jsx)("source",{src:`${cdnURL}${figureSrc}.mp4`,type:"video/mp4"})]}),figureSrcImg&&(0,jsx_runtime.jsx)(Video,{as:"img",alt:figureAlt,src:`${cdnURL}${figureSrcImg}.png`,crossOrigin:"anonymous"}),isDone&&(0,jsx_runtime.jsx)(DoneContainer,{children:(0,jsx_runtime.jsx)(doneCheckmark,{height:135,width:135})}),(0,jsx_runtime.jsx)(Title,{children:title}),description.map(((paragraph,i)=>(0,jsx_runtime.jsx)(Paragraph,{size:types.TextSize.Small,children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{a:(0,jsx_runtime.jsx)(typography_link.r,{size:types.TextSize.Small,rel:"noreferrer noopener",target:"_blank",href}),screenreader:(0,jsx_runtime.jsx)(visuallyHidden.T,{})},children:paragraph})},`${title}-${i}`)))]})})})}QuickTip.displayName="QuickTip"},"./packages/story-editor/src/components/helpCenter/toggle/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Toggle});__webpack_require__("./node_modules/react/index.js");var _googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/i18n/src/sprintf.ts"),_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/i18n/src/i18n.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/design-system/src/icons/question_mark_outline.svg"),_toggleButton__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/components/toggleButton/index.js"),_utils_noop__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");function Toggle(_ref){let{isOpen=!1,popupId="",onClick=_utils_noop__WEBPACK_IMPORTED_MODULE_3__.Z,notificationCount=0}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_toggleButton__WEBPACK_IMPORTED_MODULE_1__.C,{"aria-owns":popupId,"aria-label":notificationCount>0?(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_4__.Z)((0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_5__._n)("Help Center: %s unread notification","Help Center: %s unread notifications",notificationCount,"web-stories"),notificationCount):(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_5__.__)("Help Center","web-stories"),onClick,isOpen,label:(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_5__.__)("Help","web-stories"),MainIcon:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_6__.Z,notificationCount})}Toggle.displayName="Toggle"},"./packages/story-editor/src/components/helpCenter/utils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>forceFocusCompanion});var _app_helpCenter_constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts");function forceFocusCompanion(){document.querySelector(_app_helpCenter_constants__WEBPACK_IMPORTED_MODULE_0__.OH)?.focus()}},"./packages/story-editor/src/components/keyboardShortcutsMenu/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>TOGGLE_SHORTCUTS_MENU,I:()=>TOP_MARGIN});const TOP_MARGIN=16,TOGGLE_SHORTCUTS_MENU="mod+/"},"./packages/story-editor/src/components/keyboardShortcutsMenu/keyboardShortcutsMenuContext/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>provider,A:()=>useKeyboardShortcutsMenu});__webpack_require__("./node_modules/react/index.js");var src=__webpack_require__("./packages/react/src/index.ts"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const context=(0,src.kr)({state:{isOpen:!1},actions:{toggle:noop.Z,close:noop.Z}});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function KeyboardShortcutsMenuProvider(_ref){let{children}=_ref;const[isOpen,setIsOpen]=(0,src.eJ)(!1),toggle=(0,src.I4)((e=>{e.preventDefault(),(0,tracking_src.L9)("shortcuts_menu_toggled",{status:isOpen?"closed":"open"}),setIsOpen((prevIsOpen=>!prevIsOpen))}),[isOpen]),close=(0,src.I4)((()=>{isOpen&&((0,tracking_src.L9)("shortcuts_menu_toggled",{status:"closed"}),setIsOpen(!1))}),[isOpen]),contextValue=(0,src.Ye)((()=>({state:{isOpen},actions:{toggle,close}})),[close,isOpen,toggle]);return(0,jsx_runtime.jsx)(context.Provider,{value:contextValue,children})}KeyboardShortcutsMenuProvider.displayName="KeyboardShortcutsMenuProvider";const provider=KeyboardShortcutsMenuProvider;function useKeyboardShortcutsMenu(){let selector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:src.yR;return(0,src.Sz)(context,selector)}},"./packages/story-editor/src/components/keyboardShortcutsMenu/shortcutMenu.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>shortcutMenu});__webpack_require__("./node_modules/react/index.js");var styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),src=__webpack_require__("./packages/react/src/index.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),cross=__webpack_require__("./packages/design-system/src/icons/cross.svg"),src_constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),headline=__webpack_require__("./packages/design-system/src/components/typography/headline/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),translateWithMarkup=__webpack_require__("./packages/i18n/src/translateWithMarkup.tsx"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),utils=__webpack_require__("./packages/design-system/src/components/keyboard/utils.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const isMacOS=(0,utils.vx)(),LargeKey=props=>(0,jsx_runtime.jsx)("kbd",{className:"large-key",...props});LargeKey.displayName="LargeKey";const ShiftKeyWrapper=props=>isMacOS?(0,jsx_runtime.jsx)("kbd",{...props}):(0,jsx_runtime.jsx)(LargeKey,{...props}),shortcuts={header:{label:(0,i18n.__)("Keyboard Shortcuts","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"/"})]})},landmarks:[{label:(0,i18n.__)("Element","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:(0,utils.U2)("alt")}),(0,jsx_runtime.jsx)("kbd",{children:"1"})]})},{label:(0,i18n.__)("Workspace","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:(0,utils.U2)("alt")}),(0,jsx_runtime.jsx)("kbd",{children:"2"})]})},{label:(0,i18n.__)("Design panels","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:(0,utils.U2)("alt")}),(0,jsx_runtime.jsx)("kbd",{children:"3"})]})}],sections:[{title:(0,i18n.__)("Basics","web-stories"),commands:[{label:(0,i18n.__)("Undo","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"Z"})]})},{label:(0,i18n.__)("Redo","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)(ShiftKeyWrapper,{children:(0,utils.U2)("shift")}),(0,jsx_runtime.jsx)("kbd",{children:"Z"})]})},{label:(0,i18n.__)("Save","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"S"})]})},{label:(0,i18n.__)("Play / Stop","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:(0,utils.U2)("enter")})]})}]},{title:(0,i18n.__)("Text","web-stories"),commands:[{label:(0,i18n.__)("Insert/edit link","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"K"})]})},{label:(0,i18n.__)("Bold","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"B"})]})},{label:(0,i18n.__)("Italic","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"I"})]})},{label:(0,i18n.__)("Underline","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"U"})]})}]},{title:(0,i18n.__)("Element","web-stories"),commands:[{label:(0,i18n.__)("Copy","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"C"})]})},{label:(0,i18n.__)("Cut","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"X"})]})},{label:(0,i18n.__)("Duplicate","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"D"})]})},{label:(0,i18n.__)("Paste","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"V"})]})},{label:(0,i18n.__)("Copy Styles","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:(0,utils.U2)("alt")}),(0,jsx_runtime.jsx)("kbd",{children:"O"})]})},{label:(0,i18n.__)("Paste Styles","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:(0,utils.U2)("alt")}),(0,jsx_runtime.jsx)("kbd",{children:"P"})]})},{label:(0,i18n.__)("Select all","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"A"})]})},{label:(0,i18n.__)("Select multiple","web-stories"),shortcut:(0,jsx_runtime.jsx)("kbd",{children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{lkbd:(0,jsx_runtime.jsx)(LargeKey,{}),shortcut:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"shift"})},children:(0,sprintf.Z)((0,i18n.__)("<lkbd>%s</lkbd> <span>+ click</span>","web-stories"),(0,utils.U2)("shift"))})})},{label:(0,i18n.__)("Move forward or back","web-stories"),shortcut:(0,jsx_runtime.jsx)("kbd",{children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{kbd:(0,jsx_runtime.jsx)("kbd",{}),lkbd:(0,jsx_runtime.jsx)(LargeKey,{})},children:(0,sprintf.Z)((0,i18n.__)("<lkbd>%1$s</lkbd> <kbd>%2$s</kbd> <span>or</span> <kbd>%3$s</kbd>","web-stories"),(0,utils.U2)("mod"),(0,utils.U2)("up"),(0,utils.U2)("down"))})})},{label:(0,i18n.__)("Move to front or back","web-stories"),shortcut:(0,jsx_runtime.jsx)("kbd",{children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{kbd:(0,jsx_runtime.jsx)("kbd",{}),lkbd:(0,jsx_runtime.jsx)(LargeKey,{})},children:(0,sprintf.Z)((0,i18n.__)("<lkbd>%1$s</lkbd> <lkbd>%2$s</lkbd> <kbd>%3$s</kbd> <span>or</span> <kbd>%4$s</kbd>","web-stories"),(0,utils.U2)("mod"),(0,utils.U2)("shift"),(0,utils.U2)("up"),(0,utils.U2)("down"))})})},{label:(0,i18n.__)("Enter crop/edit mode","web-stories"),shortcut:(0,jsx_runtime.jsx)("kbd",{children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{kbd:(0,jsx_runtime.jsx)("kbd",{})},children:(0,sprintf.Z)((0,i18n.__)("<kbd>%s</kbd> <span>or double-click</span>","web-stories"),(0,utils.U2)("enter"))})})},{label:(0,i18n.__)("Delete","web-stories"),shortcut:(0,jsx_runtime.jsx)("kbd",{children:(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("delete")})})},{disabled:!0,label:(0,i18n.__)("Insert/edit link","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{children:"A"})]})},{label:(0,i18n.__)("Disable snapping and drop targeting","web-stories"),shortcut:(0,jsx_runtime.jsx)("kbd",{children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{lkbd:(0,jsx_runtime.jsx)(LargeKey,{})},children:(0,sprintf.Z)((0,i18n.__)("<span>Hold</span> <lkbd>%s</lkbd>","web-stories"),(0,utils.U2)("mod"))})})},{label:(0,i18n.__)("Access floating toolbar","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("ctrl")}),(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("alt")}),(0,jsx_runtime.jsx)("kbd",{children:"P"})]})},{label:(0,i18n.__)("Open context menu","web-stories"),shortcut:(0,jsx_runtime.jsxs)("kbd",{children:[(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("mod")}),(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("alt")}),(0,jsx_runtime.jsx)("kbd",{className:"large-key",children:(0,utils.U2)("shift")}),(0,jsx_runtime.jsx)("kbd",{children:"M"})]})},{label:(0,i18n.__)("Move element 1px","web-stories"),shortcut:(0,jsx_runtime.jsx)("kbd",{children:(0,jsx_runtime.jsx)(translateWithMarkup.Z,{mapping:{lkbd:(0,jsx_runtime.jsx)(LargeKey,{}),shortcut:(0,jsx_runtime.jsx)(keyboard.z9,{shortcut:"shift"})},children:(0,sprintf.Z)((0,i18n.__)("<lkbd>%s</lkbd> <span>+ arrow keys</span>","web-stories"),(0,utils.U2)("shift"))})})}]}]},header=shortcuts.header,landmarks=shortcuts.landmarks.filter((o=>!o.disabled)),sections=shortcuts.sections.map((section=>({...section,commands:section.commands.filter((o=>!o.disabled))})));var expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts");const Wrapper=styled_components_browser_esm.ZP.dd.withConfig({displayName:"shortcutLabel__Wrapper",componentId:"sc-6tlmvo-0"})(["display:block;margin:0;kbd{"," display:flex;justify-content:",";align-items:center;margin:0;padding:0;color:",";background-color:transparent;& > kbd{display:flex;justify-content:center;align-items:center;padding:0 5px;height:24px;width:24px;border-radius:",";border:1px solid ",";color:",";}& > kbd.large-key{width:auto;}kbd + kbd{margin-left:2px;}kbd + span{margin-left:4px;}span + kbd{margin-left:4px;}}"],expandPresetStyles.K(((_ref,_ref2)=>{let{paragraph}=_ref,{XSmall}=_ref2;return paragraph[XSmall]})),(_ref3=>{let{alignment}=_ref3;return alignment}),(_ref4=>{let{theme}=_ref4;return theme.colors.fg.secondary}),(_ref5=>{let{theme}=_ref5;return theme.borders.radius.medium}),(_ref6=>{let{theme}=_ref6;return theme.colors.border.defaultNormal}),(_ref7=>{let{theme}=_ref7;return theme.colors.fg.primary}));function ShortCutLabel(_ref8){let{keys,alignment="center",...rest}=_ref8;return(0,jsx_runtime.jsx)(Wrapper,{alignment,...rest,children:keys})}ShortCutLabel.displayName="ShortCutLabel";const shortcutLabel=ShortCutLabel,List=styled_components_browser_esm.ZP.dl.withConfig({displayName:"headerShortcut__List",componentId:"sc-1egg06k-0"})(["margin:24px;display:flex;flex-shrink:0;"]),Item=styled_components_browser_esm.ZP.dt.withConfig({displayName:"headerShortcut__Item",componentId:"sc-1egg06k-1"})(["margin:0 12px 0 0;"]);function HeaderShortcut(props){const{label,shortcut}=header;return(0,jsx_runtime.jsxs)(List,{children:[(0,jsx_runtime.jsx)(Item,{children:(0,jsx_runtime.jsx)(headline.s,{as:"h2",size:types.TextSize.XSmall,...props,children:label})}),(0,jsx_runtime.jsx)(shortcutLabel,{keys:shortcut})]})}HeaderShortcut.displayName="HeaderShortcut";const headerShortcut=HeaderShortcut;var typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts");const LandmarksWrapper=styled_components_browser_esm.ZP.dl.withConfig({displayName:"landmarkShortcuts__LandmarksWrapper",componentId:"sc-k7r8e2-0"})(["background-color:",";margin:0;padding:16px 24px;display:flex;justify-content:space-between;user-select:text;"],(_ref=>{let{theme}=_ref;return theme.colors.bg.secondary})),Landmark=styled_components_browser_esm.ZP.div.withConfig({displayName:"landmarkShortcuts__Landmark",componentId:"sc-k7r8e2-1"})(["display:flex;flex-direction:column;"]),Label=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).attrs({size:types.TextSize.XSmall}).withConfig({displayName:"landmarkShortcuts__Label",componentId:"sc-k7r8e2-2"})(["text-align:center;margin-top:8px;white-space:nowrap;display:inline-block;"]);function LandmarkShortcuts(){return(0,jsx_runtime.jsx)(LandmarksWrapper,{children:landmarks.map((_ref2=>{let{label,shortcut}=_ref2;return(0,jsx_runtime.jsxs)(Landmark,{children:[(0,jsx_runtime.jsx)(shortcutLabel,{keys:shortcut}),(0,jsx_runtime.jsx)("dt",{children:(0,jsx_runtime.jsx)(Label,{children:label})})]},label)}))})}LandmarkShortcuts.displayName="LandmarkShortcuts";const landmarkShortcuts=LandmarkShortcuts,Header=(0,styled_components_browser_esm.ZP)(headline.s).attrs({as:"h3",size:types.TextSize.XXSmall}).withConfig({displayName:"shortcutMenuSection__Header",componentId:"sc-xssjcb-0"})(["margin-top:24px;color:",";"],(_ref=>{let{theme}=_ref;return theme.colors.fg.primary})),shortcutMenuSection_List=styled_components_browser_esm.ZP.dl.withConfig({displayName:"shortcutMenuSection__List",componentId:"sc-xssjcb-1"})(["display:grid;grid-template-columns:1fr;row-gap:12px;align-items:center;margin:12px 0 0;"]),ListRow=styled_components_browser_esm.ZP.div.withConfig({displayName:"shortcutMenuSection__ListRow",componentId:"sc-xssjcb-2"})(["display:grid;grid-template-columns:1fr 1fr;grid-template-rows:auto;column-gap:5px;align-items:center;dd{grid-column:1;grid-row:1;}dt{grid-column:2;grid-row:1;}"]),shortcutMenuSection_Label=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).attrs({size:types.TextSize.Small}).withConfig({displayName:"shortcutMenuSection__Label",componentId:"sc-xssjcb-3"})(["display:inline-block;color:",";"],(_ref2=>{let{theme}=_ref2;return theme.colors.fg.secondary}));const shortcutMenuSection=function ShortcutMenuSection(_ref3){let{title,commands}=_ref3;const headerId=`header-${(0,v4.Z)()}`;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Header,{id:headerId,children:title}),(0,jsx_runtime.jsx)(shortcutMenuSection_List,{title,children:commands.map((_ref4=>{let{label,shortcut}=_ref4;return(0,jsx_runtime.jsxs)(ListRow,{children:[(0,jsx_runtime.jsx)(shortcutLabel,{keys:shortcut,alignment:"left"}),(0,jsx_runtime.jsx)("dt",{children:(0,jsx_runtime.jsx)(shortcutMenuSection_Label,{children:label})})]},label)}))})]})},ContentWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"regularShortcuts__ContentWrapper",componentId:"sc-fl8s7-0"})(["display:flex;flex-direction:column;margin:0 24px 24px;*{user-select:text;}"]);function RegularShortcuts(){return(0,jsx_runtime.jsx)(ContentWrapper,{children:sections.map((_ref=>{let{title,commands}=_ref;return(0,jsx_runtime.jsx)(shortcutMenuSection,{title,commands},title)}))})}RegularShortcuts.displayName="RegularShortcuts";const regularShortcuts=RegularShortcuts;var keyboardShortcutsMenu_constants=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/constants.js"),keyboardShortcutsMenuContext=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/keyboardShortcutsMenuContext/index.ts");const Container=styled_components_browser_esm.ZP.div.withConfig({displayName:"shortcutMenu__Container",componentId:"sc-m0xcqa-0"})(["position:absolute;left:0;bottom:0;width:352px;border-radius:",";background-color:",";border:","px solid ",";"],(_ref=>{let{theme}=_ref;return theme.borders.radius.small}),(_ref2=>{let{theme}=_ref2;return theme.colors.bg.primary}),1,(_ref3=>{let{theme}=_ref3;return theme.colors.border.defaultNormal})),EXTRA_SPACE=src_constants.mO+src_constants.Mz+keyboardShortcutsMenu_constants.I-2,FlexContent=styled_components_browser_esm.ZP.div.withConfig({displayName:"shortcutMenu__FlexContent",componentId:"sc-m0xcqa-1"})(["display:flex;flex-direction:column;max-height:calc( 100vh - ","px - ","px );"],EXTRA_SPACE,(_ref4=>{let{bottomOffset}=_ref4;return bottomOffset})),CloseContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"shortcutMenu__CloseContainer",componentId:"sc-m0xcqa-2"})(["position:absolute;right:4px;top:4px;"]),ScrollableContent=styled_components_browser_esm.ZP.div.withConfig({displayName:"shortcutMenu__ScrollableContent",componentId:"sc-m0xcqa-3"})(["overflow:auto;flex-shrink:1;",";"],outline.L),HEADER_ID=`kb-header-${(0,v4.Z)()}`;function ShortcutMenu(){const anchorRef=(0,src.sO)(),containerRef=(0,src.sO)(),{close,toggle,isOpen}=(0,keyboardShortcutsMenuContext.A)((_ref5=>{let{actions,state}=_ref5;return{toggle:actions.toggle,close:actions.close,isOpen:state.isOpen}})),[bottomOffset,setBottomOffset]=(0,src.eJ)(0);return(0,src.bt)((()=>{const node=containerRef.current;if(!node)return;const calc=()=>{const nodeRect=node.getBoundingClientRect(),docRect=node.ownerDocument.documentElement.getBoundingClientRect();setBottomOffset(docRect.height-nodeRect.y-nodeRect.height)};return calc(),setTimeout(calc),window.addEventListener("resize",calc),()=>window.removeEventListener("resize",calc)}),[]),(0,src.d4)((()=>{isOpen&&anchorRef.current&&anchorRef.current.focus()}),[isOpen]),(0,keyboard.Ew)(containerRef,keyboardShortcutsMenu_constants.H,toggle,[toggle]),(0,keyboard.Ew)(containerRef,"esc",close),(0,jsx_runtime.jsxs)(Container,{ref:containerRef,children:[(0,jsx_runtime.jsx)(CloseContainer,{children:(0,jsx_runtime.jsx)(button_button.z,{ref:anchorRef,type:constants.L$.Plain,size:constants.qE.Small,variant:constants.Wu.Circle,onClick:close,"aria-label":(0,i18n.__)("Close Menu","web-stories"),children:(0,jsx_runtime.jsx)(cross.Z,{})})}),(0,jsx_runtime.jsxs)(FlexContent,{bottomOffset,children:[(0,jsx_runtime.jsx)(headerShortcut,{id:HEADER_ID}),(0,jsx_runtime.jsxs)(ScrollableContent,{role:"presentation",tabIndex:0,children:[(0,jsx_runtime.jsx)(landmarkShortcuts,{}),(0,jsx_runtime.jsx)(regularShortcuts,{})]})]})]})}ShortcutMenu.displayName="ShortcutMenu";const shortcutMenu=ShortcutMenu},"./packages/story-editor/src/components/library/panes/shared/libraryMoveable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/react/src/index.ts"),styled_components__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./packages/units/src/dimensions.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/moveable/src/index.ts"),_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/transform/src/index.ts"),_constants__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/constants/index.ts"),_dropTargets__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),_app_layout__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/story-editor/src/app/layout/index.ts"),_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/story-editor/src/components/canvas/useInsertElement.ts"),_canvas__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/story-editor/src/components/canvas/index.js"),_utils_isTargetOutOfContainer__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./packages/story-editor/src/utils/isTargetOutOfContainer.ts"),_canvas_utils_useSnapping__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./packages/story-editor/src/components/canvas/utils/useSnapping.js"),_app__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./packages/story-editor/src/app/index.js"),_utils_objectWithout__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./packages/story-editor/src/utils/objectWithout.ts"),_utils_noop__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),_shopping_constants__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/constants.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/react/jsx-runtime.js");const TargetBox=styled_components__WEBPACK_IMPORTED_MODULE_13__.ZP.div.withConfig({displayName:"libraryMoveable__TargetBox",componentId:"sc-jgbz52-0"})(["position:absolute;width:100%;height:100%;top:0;z-index:1;cursor:pointer;"]);const __WEBPACK_DEFAULT_EXPORT__=function LibraryMoveable(_ref){let{type,elementProps={},handleDrag,handleDragEnd,onClick=_utils_noop__WEBPACK_IMPORTED_MODULE_14__.Z,cloneElement,cloneProps,elements=[],active=!1}=_ref;const CloneElement=cloneElement,[isDragging,setIsDragging]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.eJ)(!1),[didManuallyReset,setDidManuallyReset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.eJ)(!1),[hover,setHover]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.eJ)(!1),cloneRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.sO)(null),targetBoxRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.sO)(null),targetBoxSize=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.sO)(null),overlayRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.sO)(null),moveable=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.sO)(null),pageSize=(0,_app_layout__WEBPACK_IMPORTED_MODULE_6__.$)((_ref2=>{let{state:{pageWidth,pageHeight}}=_ref2;return{width:pageWidth,height:pageHeight}})),{setZoomSetting}=(0,_app_layout__WEBPACK_IMPORTED_MODULE_6__.$)((_ref3=>{let{actions:{setZoomSetting}}=_ref3;return{setZoomSetting}})),insertElement=(0,_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_7__.Z)(),{backgroundElement}=(0,_app__WEBPACK_IMPORTED_MODULE_10__.rB)((state=>({backgroundElement:state.state.currentPage?.elements?.[0]??{}}))),{fullbleedContainer,nodesById,pageContainer}=(0,_app__WEBPACK_IMPORTED_MODULE_10__.$P)((state=>({fullbleedContainer:state.state.fullbleedContainer,pageContainer:state.state.pageContainer,nodesById:state.state.nodesById}))),{activeDropTargetId,setDraggingResource}=(0,_dropTargets__WEBPACK_IMPORTED_MODULE_5__.H)((_ref4=>{let{state:{activeDropTargetId},actions:{setDraggingResource}}=_ref4;return{activeDropTargetId,setDraggingResource}})),{clearTransforms,pushTransform}=(0,_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__.Hm)((state=>({clearTransforms:state.actions.clearTransforms,pushTransform:state.actions.pushTransform}))),frame={translate:[0,0]},{insertTextSetByOffset}=(0,_canvas__WEBPACK_IMPORTED_MODULE_8__.GE)(),eventTracker=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.sO)({}),resetMoveable=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.I4)((()=>{targetBoxRef.current&&cloneRef.current&&(targetBoxRef.current.style.transform=null,cloneRef.current.style.transform=null,cloneRef.current.style.opacity=0,setIsDragging(!1),clearTransforms(),setDraggingResource(null))}),[setDraggingResource,clearTransforms]);(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_15__.Ew)(isDragging?document.body:{current:null},"esc",(()=>{setDidManuallyReset(!0),resetMoveable()}),[isDragging,resetMoveable]);const getTargetOffset=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.I4)((()=>{let offsetX=0,offsetY=0;for(let offsetNode=overlayRef.current;offsetNode;offsetNode=offsetNode.offsetParent)offsetX+=offsetNode.offsetLeft,offsetY+=offsetNode.offsetTop;return{offsetX,offsetY}}),[overlayRef]);(0,_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_11__.Z)({node:targetBoxRef.current,eventData:{..._constants__WEBPACK_IMPORTED_MODULE_4__.Iy.INSERT_ELEMENT,label:type},eventType:"pointerdown"});const{offsetX:snappingOffsetX}=getTargetOffset(),snapProps=(0,_canvas_utils_useSnapping__WEBPACK_IMPORTED_MODULE_9__.Z)({isDragging:!0,canSnap:!0,otherNodes:Object.values((0,_utils_objectWithout__WEBPACK_IMPORTED_MODULE_19__.Z)(nodesById,[backgroundElement.id])),snappingOffsetX});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(TargetBox,{ref:targetBoxRef,onPointerOver:()=>setHover(!0),onPointerOut:()=>setHover(!1)}),(isDragging||active||hover)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.dN,{ref:overlayRef,zIndex:1,pointerEvents:"none",render:()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(CloneElement,{ref:cloneRef,...cloneProps})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.Tt,{ref:moveable,className:"default-moveable hide-handles",target:targetBoxRef.current,edge:!0,draggable:!0,origin:!1,pinchable:!0,onDragStart:_ref6=>{let{set,inputEvent}=_ref6;inputEvent.stopPropagation(),setDidManuallyReset(!1),set(frame.translate),setIsDragging(!0),(evt=>{const{timeStamp,clientX,clientY}=evt;eventTracker.current={timeStamp,clientX,clientY}})(inputEvent),setZoomSetting(_constants__WEBPACK_IMPORTED_MODULE_4__.uM.Fit);const{offsetX,offsetY}=getTargetOffset(),targetBox=targetBoxRef.current.getBoundingClientRect();targetBoxSize.current={width:targetBox.width,height:targetBox.height},targetBoxRef.current.style.width=`${cloneProps.width}px`,targetBoxRef.current.style.height=`${cloneProps.height}px`;const x1=targetBox.left-offsetX,y1=targetBox.top-offsetY;cloneRef.current.style.left=`${x1}px`,cloneRef.current.style.top=`${y1}px`,moveable.current&&moveable.current.updateRect()},onDrag:_ref5=>{let{beforeTranslate,inputEvent}=_ref5;if(pushTransform(null,{drag:beforeTranslate}),didManuallyReset)return!1;frame.translate=beforeTranslate,cloneRef.current&&(0,_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.Kv)(eventTracker.current,inputEvent)&&(1===cloneRef.current.style.opacity||activeDropTargetId?activeDropTargetId&&(cloneRef.current.style.opacity=0):cloneRef.current.style.opacity=1,cloneRef.current.style.transform=`translate(${beforeTranslate[0]}px, ${beforeTranslate[1]}px)`,targetBoxRef.current.style.transform=`translate(${beforeTranslate[0]}px, ${beforeTranslate[1]}px)`),handleDrag?.(inputEvent)},onDragEnd:_ref7=>{let{inputEvent}=_ref7;if(didManuallyReset)return!1;if(targetBoxRef.current.style.width=`${targetBoxSize.current.width}px`,targetBoxRef.current.style.height=`${targetBoxSize.current.height}px`,!(0,_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.Kv)(eventTracker.current,inputEvent))return resetMoveable(),onClick(),!1;if(activeDropTargetId&&handleDragEnd)handleDragEnd();else if(!(0,_utils_isTargetOutOfContainer__WEBPACK_IMPORTED_MODULE_16__.Z)(cloneRef.current,fullbleedContainer)){const{x,y,width:w,height:h}=cloneRef.current.getBoundingClientRect(),{x:pageX,y:pageY}=pageContainer.getBoundingClientRect();"textSet"===type?insertTextSetByOffset(elements,{offsetX:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Kf)(x-pageX,pageSize.width),offsetY:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Og)(y-pageY,pageSize.height)}):insertElement(type,"product"===type?{...elementProps,width:_shopping_constants__WEBPACK_IMPORTED_MODULE_18__.t,height:_shopping_constants__WEBPACK_IMPORTED_MODULE_18__.a,x:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Kf)(x-pageX,pageSize.width),y:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Og)(y-pageY,pageSize.height)}:{...elementProps,x:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Kf)(x-pageX,pageSize.width),y:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Og)(y-pageY,pageSize.height),width:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Kf)(w,pageSize.width),height:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.Og)(h,pageSize.height)})}resetMoveable()},...snapProps})]})]})}},"./packages/story-editor/src/components/library/panes/shopping/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>PRODUCT_HEIGHT,t:()=>PRODUCT_WIDTH});const PRODUCT_WIDTH=25,PRODUCT_HEIGHT=25},"./packages/story-editor/src/components/library/panes/shopping/productList.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>productList});__webpack_require__("./node_modules/react/index.js");var src=__webpack_require__("./packages/react/src/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types);function useProductNavigation(_ref){let{isMenuFocused,products=[]}=_ref;const currentRowsRef=(0,src.sO)([]),[currentFocusIndex,setCurrentFocusIndex]=(0,src.eJ)(0);(0,src.d4)((()=>{const el=currentRowsRef.current[`row-${currentFocusIndex}`];el&&isMenuFocused&&!el.contains(document.activeElement)&&el.focus()}),[currentFocusIndex,isMenuFocused]);return{handleListNav:(0,src.I4)((evt=>{const{key}=evt;"ArrowUp"===key?(evt.preventDefault(),setCurrentFocusIndex((index=>Math.max(0,index-1)))):"ArrowDown"===key&&(evt.preventDefault(),setCurrentFocusIndex((index=>Math.min(products.length-1,index+1))))}),[products]),currentRowsRef,setCurrentFocusIndex}}useProductNavigation.propTypes={isMenuFocused:prop_types_default().bool,products:prop_types_default().arrayOf(prop_types_default().object)};const shopping_useProductNavigation=useProductNavigation;var typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),libraryMoveable=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/libraryMoveable.js"),shopping_constants=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/constants.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const imgPlaceholder=(0,styled_components_browser_esm.iv)(["display:block;margin-right:10px;border-radius:4px;background-color:",";width:41px;height:41px;"],(_ref=>{let{theme}=_ref;return theme.colors.interactiveBg.disable})),StyledImgPlaceHolder=styled_components_browser_esm.ZP.div.withConfig({displayName:"productImage__StyledImgPlaceHolder",componentId:"sc-17w7h9b-0"})(["",""],imgPlaceholder),ProductImageWrap=styled_components_browser_esm.ZP.div.withConfig({displayName:"productImage__ProductImageWrap",componentId:"sc-17w7h9b-1"})(["position:relative;"]),StyledImage=styled_components_browser_esm.ZP.img.withConfig({displayName:"productImage__StyledImage",componentId:"sc-17w7h9b-2"})([""," object-fit:cover;"],imgPlaceholder),StyledImageClone=styled_components_browser_esm.ZP.img.withConfig({displayName:"productImage__StyledImageClone",componentId:"sc-17w7h9b-3"})(["opacity:0;position:absolute;object-fit:cover;border-radius:4px;width:","px;height:","px;"],shopping_constants.t,shopping_constants.a);function ProductImage(_ref2){let{product}=_ref2;const imageSrc=product?.productImages[0]?.url||"";return imageSrc?(0,jsx_runtime.jsx)(StyledImage,{alt:product?.productImages[0]?.alt,src:imageSrc,loading:"lazy",decoding:"async",draggable:!1,crossOrigin:"anonymous"}):(0,jsx_runtime.jsx)(StyledImgPlaceHolder,{})}function DraggableProductImage(_ref3){let{product,draggable}=_ref3;const src=product?.productImages[0]?.url||"";return(0,jsx_runtime.jsxs)(ProductImageWrap,{children:[(0,jsx_runtime.jsx)(ProductImage,{product}),draggable&&src&&(0,jsx_runtime.jsx)(libraryMoveable.Z,{type:"product",elementProps:{product},cloneElement:StyledImageClone,cloneProps:{loading:"lazy",decoding:"async",crossOrigin:"anonymous",src}})]})}DraggableProductImage.displayName="DraggableProductImage";const productImage=DraggableProductImage;var checkmark=__webpack_require__("./packages/design-system/src/icons/checkmark.svg"),cross=__webpack_require__("./packages/design-system/src/icons/cross.svg"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),plus_filled=__webpack_require__("./packages/design-system/src/icons/plus_filled.svg"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const Checkmark=(0,styled_components_browser_esm.ZP)(checkmark.Z).withConfig({displayName:"productButton__Checkmark",componentId:"sc-8ap58c-0"})(["width:16px !important;height:16px !important;border-radius:100%;color:",";background-color:",";"],(_ref=>{let{theme}=_ref;return theme.colors.interactiveBg.disable}),(_ref2=>{let{theme}=_ref2;return theme.colors.fg.positive})),Cross=(0,styled_components_browser_esm.ZP)(cross.Z).withConfig({displayName:"productButton__Cross",componentId:"sc-8ap58c-1"})(["width:16px !important;height:16px !important;border-radius:100%;color:",";background-color:",";"],(_ref3=>{let{theme}=_ref3;return theme.colors.interactiveBg.disable}),(_ref4=>{let{theme}=_ref4;return theme.colors.fg.negative})),StyledButton=(0,styled_components_browser_esm.ZP)(button_button.z).withConfig({displayName:"productButton__StyledButton",componentId:"sc-8ap58c-2"})(["","{display:none;}&:hover ",",&:focus-within ",",&:active ","{display:none;}&:hover ",",&:focus-within ",",&:active ","{display:block;}"],Cross,Checkmark,Checkmark,Checkmark,Cross,Cross,Cross),StyledActionsContainer=styled_components_browser_esm.ZP.div.withConfig({displayName:"productButton__StyledActionsContainer",componentId:"sc-8ap58c-3"})(["margin-right:10px;"]),DISABLED_PRODUCT_TEXT=(0,sprintf.Z)((0,i18n._n)("Only %d item can be added per page.","Only %d items can be added per page.",constants.LK,"web-stories"),constants.LK),DISABLED_PRODUCT_IMAGE_TEXT=(0,i18n.__)("Products without images cannot be added.","web-stories"),TooltipWrapper=_ref5=>{let{hasImage,disabled,children}=_ref5;return hasImage?disabled?(0,jsx_runtime.jsx)(tooltip.Z,{hasTail:!0,title:DISABLED_PRODUCT_TEXT,children}):children:(0,jsx_runtime.jsx)(tooltip.Z,{hasTail:!0,title:DISABLED_PRODUCT_IMAGE_TEXT,children})};function ProductButton(_ref6){let{product,onClick,onFocus,isOnPage,canAddMore}=_ref6;const ADD_PRODUCT_TEXT=(0,sprintf.Z)((0,i18n.__)("Add %s","web-stories"),product?.productTitle),hasImage=Boolean(product?.productImages?.length),REMOVE_PRODUCT_TEXT=(0,sprintf.Z)((0,i18n.__)("Remove %s","web-stories"),product?.productTitle),disabled=!isOnPage&&!canAddMore;let ariaLabel="";return ariaLabel=hasImage?isOnPage?REMOVE_PRODUCT_TEXT:disabled?DISABLED_PRODUCT_TEXT:ADD_PRODUCT_TEXT:DISABLED_PRODUCT_IMAGE_TEXT,(0,jsx_runtime.jsx)(TooltipWrapper,{hasImage,disabled,children:(0,jsx_runtime.jsx)(StyledActionsContainer,{children:(0,jsx_runtime.jsx)(StyledButton,{"aria-label":ariaLabel,"aria-disabled":!hasImage||disabled,onClick:hasImage&&!disabled?()=>{onClick(product,isOnPage)}:noop.Z,type:button_constants.L$.Tertiary,size:button_constants.qE.Small,variant:button_constants.Wu.Square,onFocus,children:isOnPage?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Checkmark,{}),(0,jsx_runtime.jsx)(Cross,{})]}):(0,jsx_runtime.jsx)(plus_filled.Z,{})})})})}ProductButton.displayName="ProductButton";const productButton=ProductButton;var config=__webpack_require__("./packages/story-editor/src/app/config/index.ts");const StyledPrice=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.XSmall}).withConfig({displayName:"productPrice__StyledPrice",componentId:"sc-1b0ir4w-0"})(["color:",";"],(_ref=>{let{theme}=_ref;return theme.colors.fg.tertiary}));const productPrice=function ProductPrice(_ref2){let{price,currency}=_ref2;const{locale:{locale}}=(0,config.ZR)();return price&&currency&&locale?(0,jsx_runtime.jsx)(StyledPrice,{children:new Intl.NumberFormat(locale,{style:"currency",currency}).format(price)}):null},StyledDescription=styled_components_browser_esm.ZP.div.withConfig({displayName:"product__StyledDescription",componentId:"sc-1bhc150-0"})(["padding-left:12px;"]),StyledTitle=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"product__StyledTitle",componentId:"sc-1bhc150-1"})(["color:",";"],(_ref=>{let{theme}=_ref;return theme.colors.fg.primary}));const shopping_product=function Product(_ref2){let{product,onClick,onFocus,isOnPage,canAddMore}=_ref2;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(productButton,{product,isOnPage,canAddMore,onClick,onFocus}),(0,jsx_runtime.jsx)(productImage,{product,draggable:!isOnPage&&canAddMore}),(0,jsx_runtime.jsxs)(StyledDescription,{children:[(0,jsx_runtime.jsx)(StyledTitle,{isBold:!0,children:product?.productTitle}),(0,jsx_runtime.jsx)(productPrice,{price:product?.productPrice,currency:product?.productPriceCurrency})]})]})},StyledListItem=styled_components_browser_esm.ZP.div.withConfig({displayName:"productList__StyledListItem",componentId:"sc-16x13t7-0"})(["display:flex;width:100%;padding:5px 0;align-items:center;border-bottom:1px solid ",";transition:background-color ease-in-out 300ms;"],(_ref=>{let{theme}=_ref;return theme.colors.divider.tertiary}));function ProductList(_ref2){let{products=[],onPageProducts=[],onClick,isMenuFocused=!0}=_ref2;const{handleListNav,currentRowsRef,setCurrentFocusIndex}=shopping_useProductNavigation({isMenuFocused,products});(0,src.d4)((()=>{isMenuFocused||setCurrentFocusIndex(0)}),[isMenuFocused,setCurrentFocusIndex]);const canAddMore=onPageProducts.length<constants.LK;return(0,jsx_runtime.jsx)("div",{"aria-label":(0,i18n.__)("Products list","web-stories"),role:"list",onKeyDown:handleListNav,children:products.map(((product,index)=>(0,jsx_runtime.jsx)(StyledListItem,{role:"listitem",tabIndex:-1,ref:el=>currentRowsRef.current[`row-${index}`]=el,children:(0,jsx_runtime.jsx)(shopping_product,{product,canAddMore,isOnPage:onPageProducts.some((item=>item.product.productId===product?.productId)),onClick,onFocus:evt=>{((evt,index)=>{currentRowsRef.current[`row-${index}`]&&"focus"===evt.type&&setCurrentFocusIndex(index)})(evt,index)}})},product?.productId)))})}ProductList.displayName="ProductList";const productList=ProductList},"./packages/story-editor/src/components/mediaRecording/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A0:()=>MAX_RECORDING_DURATION_IN_MINUTES,Bj:()=>VIDEO_FILE_TYPE,CY:()=>SETTINGS_POPUP_ZINDEX,L1:()=>VIDEO_MIME_TYPE,RE:()=>PHOTO_MIME_TYPE,Y6:()=>AUDIO_FILE_TYPE,Yn:()=>PHOTO_FILE_TYPE,h1:()=>AUDIO_MIME_TYPE,mb:()=>BACKGROUND_BLUR_PX,pS:()=>MAX_RECORDING_DURATION_IN_SECONDS,ut:()=>VIDEO_EFFECTS,x_:()=>COUNTDOWN_TIME_IN_SECONDS});const MAX_RECORDING_DURATION_IN_SECONDS=120,MAX_RECORDING_DURATION_IN_MINUTES=2,COUNTDOWN_TIME_IN_SECONDS=3,BACKGROUND_BLUR_PX=3,VIDEO_MIME_TYPE="video/mp4",VIDEO_FILE_TYPE="mp4",AUDIO_MIME_TYPE="audio/mpeg",AUDIO_FILE_TYPE="mp3",PHOTO_MIME_TYPE="image/jpeg",PHOTO_FILE_TYPE="jpeg",SETTINGS_POPUP_ZINDEX=11,VIDEO_EFFECTS={NONE:"none",BLUR:"blur"}},"./packages/story-editor/src/components/mediaRecording/context.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=(0,__webpack_require__("./packages/react/src/index.ts").kr)({state:{},actions:{}})},"./packages/story-editor/src/components/mediaRecording/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{QY:()=>durationIndicator,$_:()=>footer,B3:()=>mediaRecording,NK:()=>provider,TB:()=>settingsModal,_T:()=>useMediaRecording.Z});var useMediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/useMediaRecording.js"),styled_components_browser_esm=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js")),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const countdown_Number=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({as:"div"}).withConfig({displayName:"countdown__Number",componentId:"sc-14vheov-0"})(["position:absolute;top:0;left:0;bottom:0;right:0;display:flex;align-items:center;justify-content:center;font-size:70px;font-weight:bold;color:",";"],(_ref=>{let{theme}=_ref;return theme.colors.standard.white}));const countdown=function Countdown(){const{countdown}=(0,useMediaRecording.Z)((_ref2=>{let{state}=_ref2;return{countdown:state.countdown}}));return countdown>0?(0,jsx_runtime.jsx)(countdown_Number,{children:countdown}):null};var polished_esm=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),constants=__webpack_require__("./packages/story-editor/src/components/mediaRecording/constants.js");const ProgressIndicator=styled_components_browser_esm.ZP.progress.withConfig({displayName:"progressBar__ProgressIndicator",componentId:"sc-oxcipv-0"})(["appearance:none;border:none;width:100%;height:8px;position:absolute;top:0;left:0;right:0;background-color:",";border-top-left-radius:5px;border-top-right-radius:5px;&::-webkit-progress-bar{background-color:",";border-top-left-radius:5px;border-top-right-radius:5px;}&::-webkit-progress-value{background-color:",";border-top-left-radius:5px;}&::-moz-progress-bar{background-color:",";border-top-left-radius:5px;}"],(_ref=>{let{theme}=_ref;return(0,polished_esm.m4)(theme.colors.fg.primary,.3)}),(_ref2=>{let{theme}=_ref2;return(0,polished_esm.m4)(theme.colors.fg.primary,.3)}),(_ref3=>{let{theme}=_ref3;return theme.colors.fg.primary}),(_ref4=>{let{theme}=_ref4;return theme.colors.fg.primary}));function ProgressBar(){const{duration,isRecording}=(0,useMediaRecording.Z)((_ref5=>{let{state}=_ref5;return{duration:state.duration,isRecording:["recording","paused"].includes(state.status)}}));return isRecording?(0,jsx_runtime.jsx)(ProgressIndicator,{value:duration,max:constants.pS}):null}ProgressBar.displayName="ProgressBar";const progressBar=ProgressBar;var i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),src=__webpack_require__("./packages/react/src/index.ts"),useVideoTrim=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoTrim.js"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),camera=__webpack_require__("./packages/design-system/src/icons/camera.svg"),gif=__webpack_require__("./packages/design-system/src/icons/gif.svg"),components_form=__webpack_require__("./packages/story-editor/src/components/form/index.js");const Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"videoMode__Wrapper",componentId:"sc-y6q7x7-0"})(["position:absolute;z-index:2;top:20px;right:20px;width:70px;"]),StyledSwitch=(0,styled_components_browser_esm.ZP)(components_form.rs).withConfig({displayName:"videoMode__StyledSwitch",componentId:"sc-y6q7x7-1"})(["background:",";"],(_ref=>{let{theme}=_ref;return theme.colors.bg.tertiary})),CameraIcon=(0,styled_components_browser_esm.ZP)(camera.Z).attrs({title:(0,i18n.__)("Use as video","web-stories")}).withConfig({displayName:"videoMode__CameraIcon",componentId:"sc-y6q7x7-2"})(["flex:1;"]),GifIcon=(0,styled_components_browser_esm.ZP)(gif.Z).attrs({title:(0,i18n.__)("Use as GIF","web-stories")}).withConfig({displayName:"videoMode__GifIcon",componentId:"sc-y6q7x7-3"})(["flex:1;"]);function VideoMode(_ref2){let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(Wrapper,{children:(0,jsx_runtime.jsx)(StyledSwitch,{groupLabel:(0,i18n.__)("Video Mode","web-stories"),name:"video-mode-switch",value,onLabel:(0,jsx_runtime.jsx)(CameraIcon,{}),offLabel:(0,jsx_runtime.jsx)(GifIcon,{}),onChange})})}VideoMode.displayName="VideoMode";const videoMode=VideoMode;var play_filled=__webpack_require__("./packages/design-system/src/icons/play_filled.svg"),stop_filled=__webpack_require__("./packages/design-system/src/icons/stop_filled.svg"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts");const Controls=styled_components_browser_esm.ZP.div.withConfig({displayName:"playPauseButton__Controls",componentId:"sc-bvqqpx-0"})(["position:absolute;z-index:2;"]),ButtonWrapper=styled_components_browser_esm.ZP.button.attrs({tabIndex:-1}).withConfig({displayName:"playPauseButton__ButtonWrapper",componentId:"sc-bvqqpx-1"})(["cursor:pointer;pointer-events:initial;width:","px;height:","px;overflow:hidden;background:transparent;border:none;padding:0;"],82,82),iconCss=(0,styled_components_browser_esm.iv)(["width:","px;height:","px;color:",";filter:drop-shadow( 0px 0px 10px "," );"],72,72,(_ref=>{let{theme}=_ref;return theme.colors.standard.white}),(_ref2=>{let{theme}=_ref2;return(0,polished_esm.m4)(theme.colors.bg.primary,.4)})),Play=(0,styled_components_browser_esm.ZP)(play_filled.Z).withConfig({displayName:"playPauseButton__Play",componentId:"sc-bvqqpx-2"})(["",";"],iconCss),Pause=(0,styled_components_browser_esm.ZP)(stop_filled.Z).withConfig({displayName:"playPauseButton__Pause",componentId:"sc-bvqqpx-3"})(["",";"],iconCss);function PlayPauseButton(_ref3){let{videoRef}=_ref3;const{isRTL}=(0,config.ZR)(),[showControls,setShowControls]=(0,src.eJ)(!0),[isPlaying,setIsPlaying]=(0,src.eJ)(!0);(0,src.d4)((()=>{const videoNode=videoRef?.current,onVideoEnd=()=>{videoNode&&(videoNode.currentTime=0),setIsPlaying(!1)};return videoNode?.addEventListener("ended",onVideoEnd),()=>videoNode?.removeEventListener("ended",onVideoEnd)}),[videoRef]),(0,src.d4)((()=>{const videoNode=videoRef?.current;if(!videoNode)return;const onVideoPlay=()=>setIsPlaying(!0),onVideoPause=()=>setIsPlaying(!1),onTimeUpdate=_ref4=>{let{target:{paused}}=_ref4;return setIsPlaying(!paused)};return videoNode.addEventListener("play",onVideoPlay),videoNode.addEventListener("pause",onVideoPause),videoNode.addEventListener("timeupdate",onTimeUpdate),()=>{videoNode.removeEventListener("play",onVideoPlay),videoNode.removeEventListener("pause",onVideoPause),videoNode.removeEventListener("timeupdate",onTimeUpdate)}}),[videoRef]);const handlePlayPause=evt=>{evt.stopPropagation();const videoNode=videoRef?.current;videoNode&&(isPlaying?(videoNode.pause(),setShowControls(!0)):videoNode.play().catch(noop.Z))};(0,keyboard.Ew)(videoRef,{key:["space"]},handlePlayPause,[handlePlayPause]);const nodeRef=(0,src.sO)(),buttonLabel=isPlaying?(0,i18n.__)("Click to pause","web-stories"):(0,i18n.__)("Click to play","web-stories"),Icon=isPlaying?Pause:Play;return(0,jsx_runtime.jsx)(Controls,{children:showControls&&(0,jsx_runtime.jsx)(ButtonWrapper,{ref:nodeRef,"aria-label":buttonLabel,"aria-pressed":isPlaying,onClick:handlePlayPause,children:(0,jsx_runtime.jsx)(Icon,{$isRTL:isRTL})},"wrapper")})}PlayPauseButton.displayName="PlayPauseButton";const playPauseButton=PlayPauseButton;var types=__webpack_require__("./packages/design-system/src/theme/types.ts");const MessageWrap=styled_components_browser_esm.ZP.div.withConfig({displayName:"mediaRecording__MessageWrap",componentId:"sc-tmkrsc-0"})(["display:flex;flex-direction:column;align-items:center;align-content:center;padding:20px;height:100%;justify-content:center;text-align:center;user-select:text;"]),MessageHeading=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.XLarge}).withConfig({displayName:"mediaRecording__MessageHeading",componentId:"sc-tmkrsc-1"})(["margin:0 0 14px;"]),MessageText=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"mediaRecording__MessageText",componentId:"sc-tmkrsc-2"})(["margin:0 0 14px;"]),components_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"mediaRecording__Wrapper",componentId:"sc-tmkrsc-3"})(["background-color:",";border-radius:5px;position:absolute;transform:translateZ(0);top:0;left:0;bottom:0;right:0;cursor:default;"],(_ref=>{let{theme}=_ref;return theme.colors.standard.white})),VideoWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"mediaRecording__VideoWrapper",componentId:"sc-tmkrsc-4"})(["width:100%;height:100%;background:#000;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;"]),Photo=styled_components_browser_esm.ZP.img.withConfig({displayName:"mediaRecording__Photo",componentId:"sc-tmkrsc-5"})(["display:block;width:100%;height:100%;object-fit:cover;border-radius:5px;"]),Video=styled_components_browser_esm.ZP.video.attrs({autoPlay:!0,disablePictureInPicture:!0}).withConfig({displayName:"mediaRecording__Video",componentId:"sc-tmkrsc-6"})(["display:block;position:absolute;z-index:1;width:100%;height:100%;object-fit:cover;border-radius:5px;",";"],(_ref2=>{let{$isProcessing}=_ref2;return $isProcessing&&"filter: blur(5px)"})),Canvas=styled_components_browser_esm.ZP.canvas.withConfig({displayName:"mediaRecording__Canvas",componentId:"sc-tmkrsc-7"})(["display:block;position:absolute;z-index:2;width:100%;height:100%;object-fit:cover;border-radius:5px;",";"],(_ref3=>{let{$isProcessing}=_ref3;return $isProcessing&&"filter: blur(5px)"}));__webpack_require__("./node_modules/core-js/modules/es.typed-array.at.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.find-last.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.find-last-index.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.to-reversed.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.to-sorted.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.with.js"),__webpack_require__("./node_modules/core-js/modules/esnext.array-buffer.detached.js"),__webpack_require__("./node_modules/core-js/modules/esnext.array-buffer.transfer.js"),__webpack_require__("./node_modules/core-js/modules/esnext.array-buffer.transfer-to-fixed-length.js");const AudioWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"audio__AudioWrapper",componentId:"sc-yvjjwu-0"})(["background:",";border-radius:5px;width:100%;height:100%;"],(_ref=>{let{theme}=_ref;return theme.colors.bg.secondary}));function Audio(_ref2){let{liveStream}=_ref2;return(0,jsx_runtime.jsx)(AudioWrapper,{children:(0,jsx_runtime.jsx)(AudioAnalyser,{source:liveStream})})}Audio.displayName="Audio";const AudioAnalyser=_ref3=>{let{source}=_ref3;const[data,setData]=(0,src.eJ)([]),raf=(0,src.sO)(),audioContextRef=(0,src.sO)(),analyserRef=(0,src.sO)(),prevRafTime=(0,src.sO)();return analyserRef.current||(audioContextRef.current=new window.AudioContext,analyserRef.current=audioContextRef.current.createAnalyser()),(0,src.d4)((()=>{if(0===source.getAudioTracks().length)return noop.Z;const audioNode=audioContextRef.current.createMediaStreamSource(source);audioNode.connect(analyserRef.current);const tick=time=>{if(void 0!==prevRafTime.current){const dataArray=new Uint8Array(analyserRef.current.frequencyBinCount);analyserRef.current.getByteTimeDomainData(dataArray),setData(dataArray)}prevRafTime.current=time,raf.current=requestAnimationFrame(tick)};return raf.current=requestAnimationFrame(tick),()=>{cancelAnimationFrame(raf.current),analyserRef.current.disconnect(),audioNode.disconnect()}}),[source]),(0,jsx_runtime.jsx)(AudioVisualiser,{data})};AudioAnalyser.displayName="AudioAnalyser";const AudioVisualiser=_ref4=>{let{data}=_ref4;const ref=(0,src.sO)(),canvas=ref.current;if(canvas){canvas.style.width="100%",canvas.style.height="100%",canvas.width=canvas.offsetWidth,canvas.height=canvas.offsetHeight;const height=canvas.height,width=canvas.width,context=canvas.getContext("2d"),sliceWidth=Number(width)/data.length;context.lineWidth=2,context.strokeStyle="#FFF",context.clearRect(0,0,width,height),context.beginPath(),context.moveTo(0,height/2);let x=0;for(const item of data){const y=item/255*height;context.lineTo(x,y),x+=sliceWidth}context.lineTo(x,height/2),context.stroke()}return(0,jsx_runtime.jsx)("canvas",{ref})};AudioVisualiser.displayName="AudioVisualiser";const audio=Audio,mediaRecording_blur=(context,amount)=>{if(amount<=0)return context;const{height,width}=context.canvas,imageData=context.getImageData(0,0,width,height),{data}=imageData,wm=width-1,hm=height-1,rad1=amount+1,mulSum=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1][amount],shgSum=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18][amount],r=[],g=[],b=[],a=[],vmin=[],vmax=[];let p,p1,p2,pa,iterations=3;for(;iterations-- >0;){let yw=0,yi=0;for(let y=0;y<height;y++){let rsum=data[yw]*rad1,gsum=data[yw+1]*rad1,bsum=data[yw+2]*rad1,asum=data[yw+3]*rad1;for(let i=1;i<=amount;i++)p=yw+((i>wm?wm:i)<<2),rsum+=data[p++],gsum+=data[p++],bsum+=data[p++],asum+=data[p];for(let x=0;x<width;x++)r[yi]=rsum,g[yi]=gsum,b[yi]=bsum,a[yi]=asum,0===y&&(vmin[x]=((p=x+rad1)<wm?p:wm)<<2,vmax[x]=(p=x-amount)>0?p<<2:0),p1=yw+vmin[x],p2=yw+vmax[x],rsum+=data[p1++]-data[p2++],gsum+=data[p1++]-data[p2++],bsum+=data[p1++]-data[p2++],asum+=data[p1]-data[p2],yi++;yw+=width<<2}for(let x=0;x<width;x++){let yp=x,rsum=r[yp]*rad1,gsum=g[yp]*rad1,bsum=b[yp]*rad1,asum=a[yp]*rad1;for(let i=1;i<=amount;i++)yp+=i>hm?0:width,rsum+=r[yp],gsum+=g[yp],bsum+=b[yp],asum+=a[yp];yi=x<<2;for(let y=0;y<height;y++)data[yi+3]=pa=asum*mulSum>>>shgSum,pa>0?(pa=255/pa,data[yi]=(rsum*mulSum>>>shgSum)*pa,data[yi+1]=(gsum*mulSum>>>shgSum)*pa,data[yi+2]=(bsum*mulSum>>>shgSum)*pa):data[yi]=data[yi+1]=data[yi+2]=0,0===x&&(vmin[y]=((p=y+rad1)<hm?p:hm)*width,vmax[y]=(p=y-amount)>0?p*width:0),p1=x+vmin[y],p2=x+vmax[y],rsum+=r[p1]-r[p2],gsum+=g[p1]-g[p2],bsum+=b[p1]-b[p2],asum+=a[p1]-a[p2],yi+=width<<2}}return context.putImageData(imageData,0,0),context};const playbackMedia=function PlaybackMedia(){const{mediaBlob,mediaBlobUrl,originalMediaBlobUrl,liveStream,hasVideo,hasAudio,videoEffect,isGif,isImageCapture,isAdjustingTrim,toggleIsGif,streamNode,setStreamNode,isProcessingTrim,setCanvasStream,setCanvasNode}=(0,useMediaRecording.Z)((_ref=>{let{state,actions}=_ref;return{mediaBlob:state.mediaBlob,mediaBlobUrl:state.mediaBlobUrl,originalMediaBlobUrl:state.originalMediaBlobUrl,liveStream:state.liveStream,hasVideo:state.hasVideo,hasAudio:state.hasAudio,videoEffect:state.videoEffect,isGif:state.isGif,streamNode:state.streamNode,isImageCapture:Boolean(state.file?.type?.startsWith("image")),isAdjustingTrim:state.isAdjustingTrim,toggleIsGif:actions.toggleIsGif,setStreamNode:actions.setStreamNode,isProcessingTrim:state.isProcessingTrim,setCanvasStream:actions.setCanvasStream,setCanvasNode:actions.setCanvasNode}})),setVideoNode=(0,useVideoTrim.Z)((_ref2=>{let{actions:{setVideoNode}}=_ref2;return setVideoNode})),isMuted=!hasAudio||isGif,hasVideoEffect=videoEffect&&videoEffect!==constants.ut.NONE,onToggleVideoMode=(0,src.I4)((()=>{toggleIsGif(),videoRef.current&&videoRef.current.play().catch(noop.Z)}),[toggleIsGif]),rafRef=(0,src.sO)(),canvasRef=(0,src.sO)(),videoRef=(0,src.sO)(),updateVideoNode=(0,src.I4)((node=>{setVideoNode(node),videoRef.current=node}),[setVideoNode]),selfieSegmentation=(0,src.sO)(),onSelfieSegmentationResults=results=>{const canvas=canvasRef.current;if(!canvas||!results.image||0===results.image.width)return;const context=canvasRef.current.getContext("2d"),canvasBlur="filter"in CanvasRenderingContext2D.prototype;context.save(),canvasBlur?(context.globalCompositeOperation="copy",context.filter=`blur(${constants.mb}px)`,context.drawImage(results.segmentationMask,0,0,canvas.width,canvas.height),context.globalCompositeOperation="source-in",context.filter="none",context.drawImage(results.image,0,0,canvas.width,canvas.height),context.globalCompositeOperation="destination-over",context.filter=`blur(${constants.mb}px)`,context.drawImage(results.image,0,0,canvas.width,canvas.height)):(context.drawImage(results.image,0,0,canvas.width,canvas.height),mediaRecording_blur(context,constants.mb),context.globalCompositeOperation="destination-out",context.drawImage(results.segmentationMask,0,0,canvas.width,canvas.height),context.globalCompositeOperation="destination-over",context.drawImage(results.image,0,0,canvas.width,canvas.height)),context.restore()};(0,src.d4)((()=>{hasVideoEffect&&!selfieSegmentation.current&&(async()=>{const{SelfieSegmentation}=await __webpack_require__.e(4005).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@mediapipe/selfie_segmentation/selfie_segmentation.js",23));selfieSegmentation.current=new SelfieSegmentation({locateFile:file=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`}),selfieSegmentation.current.setOptions({modelSelection:1}),await selfieSegmentation.current.initialize()})()}),[hasVideoEffect]),(0,src.d4)((()=>{!async function run(){if(hasVideoEffect&&canvasRef.current){canvasRef.current.getContext("2d"),setCanvasNode(canvasRef.current);const canvasStreamRaw=canvasRef.current.captureStream(),liveStreamAudio=liveStream.getAudioTracks();liveStreamAudio.length>0&&canvasStreamRaw.addTrack(liveStreamAudio[0]),setCanvasStream(canvasStreamRaw)}if(videoEffect===constants.ut.BLUR&&selfieSegmentation.current){selfieSegmentation.current.onResults(onSelfieSegmentationResults);const sendFrame=async()=>{if(streamNode&&streamNode.videoWidth&&canvasRef.current)try{await selfieSegmentation.current.send({image:streamNode})}catch(e){}canvasRef.current&&(rafRef.current=requestAnimationFrame(sendFrame))};streamNode&&hasVideoEffect&&await sendFrame()}}()}),[videoEffect,hasVideoEffect,streamNode,setCanvasStream,setCanvasNode]);const hasPlayButton=!isGif&&!isProcessingTrim||isAdjustingTrim,mediaSrc=isAdjustingTrim?originalMediaBlobUrl:mediaBlobUrl,hasVideoModeSwitch=mediaBlobUrl&&hasVideo&&!isAdjustingTrim&&!isProcessingTrim;return(0,src.d4)((()=>(mediaBlobUrl&&rafRef.current&&cancelAnimationFrame(rafRef.current),()=>{rafRef.current&&cancelAnimationFrame(rafRef.current)})),[mediaBlobUrl]),isImageCapture?(0,jsx_runtime.jsx)(VideoWrapper,{children:(0,jsx_runtime.jsx)(Photo,{decoding:"async",src:mediaBlobUrl,alt:(0,i18n.__)("Image capture","web-stories")})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[hasVideoModeSwitch&&(0,jsx_runtime.jsx)(videoMode,{value:!isGif,onChange:onToggleVideoMode}),(0,jsx_runtime.jsxs)(VideoWrapper,{children:[mediaBlobUrl&&(hasVideo?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Video,{ref:updateVideoNode,src:mediaSrc,muted:isMuted,loop:isGif||isAdjustingTrim,$isProcessing:isProcessingTrim,tabIndex:0}),hasPlayButton&&(0,jsx_runtime.jsx)(playPauseButton,{videoRef})]}):(0,jsx_runtime.jsx)("audio",{controls:"controls",src:mediaBlobUrl})),!mediaBlob&&!mediaBlobUrl&&liveStream&&(hasVideo?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Video,{ref:setStreamNode,muted:!0,onLoadedMetadata:()=>{canvasRef.current&&(canvasRef.current.width=streamNode.videoWidth,canvasRef.current.height=streamNode.videoHeight)}}),hasVideoEffect&&(0,jsx_runtime.jsx)(Canvas,{ref:canvasRef,width:640,height:480})]}):(0,jsx_runtime.jsx)(audio,{liveStream}))]})]})};var theme=__webpack_require__("./packages/design-system/src/theme/theme.ts"),colors=__webpack_require__("./packages/design-system/src/theme/colors.ts"),exclamation_triangle=__webpack_require__("./packages/design-system/src/icons/exclamation_triangle.svg"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts");const StyledHeading=(0,styled_components_browser_esm.ZP)(MessageHeading).withConfig({displayName:"errorDialog__StyledHeading",componentId:"sc-mbe9k2-0"})(["display:flex;align-items:center;"]);function ErrorMessage(_ref){let{error,hasVideo}=_ref,errorMessage=error?.message;return window.isSecureContext?"NotAllowedError"===error?.name?errorMessage=(0,i18n.__)("Permission denied","web-stories"):hasVideo&&"NotFoundError"!==error?.name&&"OverConstrainedError"!==error?.name||(errorMessage=(0,i18n.__)("No camera found","web-stories")):errorMessage=(0,i18n.__)("Requires a secure browsing context (HTTPS)","web-stories"),(0,jsx_runtime.jsx)(MessageWrap,{children:(0,jsx_runtime.jsxs)(styled_components_browser_esm.f6,{theme:{...theme.r,colors:colors.R},children:[(0,jsx_runtime.jsxs)(StyledHeading,{children:[(0,jsx_runtime.jsx)(exclamation_triangle.Z,{size:32,height:32,"aria-hidden":!0}),(0,i18n.__)("Error","web-stories")]}),(0,jsx_runtime.jsx)(MessageText,{children:(0,i18n.__)("Could not initialize recording.","web-stories")}),errorMessage&&(0,jsx_runtime.jsx)(MessageText,{children:(0,sprintf.Z)((0,i18n.__)("Reason: %s","web-stories"),errorMessage)})]})})}function ErrorDialog(){const{error,hasVideo}=(0,useMediaRecording.Z)((_ref2=>{let{state}=_ref2;return{error:state.error,hasVideo:Boolean(state.videoInput)}}));return(0,jsx_runtime.jsx)(components_Wrapper,{children:(0,jsx_runtime.jsx)(ErrorMessage,{error,hasVideo})})}ErrorMessage.displayName="ErrorMessage",ErrorDialog.displayName="ErrorDialog";const errorDialog=ErrorDialog;function PermissionsDialog(){return(0,jsx_runtime.jsx)(components_Wrapper,{children:(0,jsx_runtime.jsx)(MessageWrap,{children:(0,jsx_runtime.jsxs)(styled_components_browser_esm.f6,{theme:{...theme.r,colors:colors.R},children:[(0,jsx_runtime.jsx)(MessageHeading,{children:(0,i18n.__)("Media Recording","web-stories")}),(0,jsx_runtime.jsx)(MessageText,{children:(0,i18n.__)("To get started, you need to allow access to your camera and microphone.","web-stories")})]})})})}PermissionsDialog.displayName="PermissionsDialog";const permissionsDialog=PermissionsDialog;var useLiveRegion=__webpack_require__("./packages/design-system/src/utils/useLiveRegion.ts"),loadingSpinner=__webpack_require__("./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx");const processingOverlay_Wrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"processingOverlay__Wrapper",componentId:"sc-ksu3mm-0"})(["position:absolute;left:0;top:0;height:100%;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;background-color:rgba(0 0 0 / 0.5);gap:2em;padding:3em;"]);function ProcessingOverlay(){const speak=(0,useLiveRegion.Z)();return(0,src.d4)((()=>{speak((0,i18n.__)("Video trimming in progress. Please wait up to a few minutes depending on output video length.","web-stories"))}),[speak]),(0,jsx_runtime.jsxs)(processingOverlay_Wrapper,{children:[(0,jsx_runtime.jsx)(loadingSpinner.Z,{}),(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{children:(0,i18n.__)("Video trimming in progress. Please wait up to a few minutes depending on output video length.","web-stories")})]})}ProcessingOverlay.displayName="ProcessingOverlay";const processingOverlay=ProcessingOverlay;const mediaRecording=function MediaRecording(){const{status,error,needsPermissions,isProcessingTrim}=(0,useMediaRecording.Z)((_ref=>{let{state}=_ref;return{status:state.status,error:state.error,needsPermissions:("idle"===state.status||"acquiring_media"===state.status)&&!state.videoInput,isProcessingTrim:state.isProcessingTrim}}));return"failed"===status||Boolean(error)?(0,jsx_runtime.jsx)(errorDialog,{}):needsPermissions?(0,jsx_runtime.jsx)(permissionsDialog,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(components_Wrapper,{children:[(0,jsx_runtime.jsx)(playbackMedia,{}),isProcessingTrim&&(0,jsx_runtime.jsx)(processingOverlay,{})]}),(0,jsx_runtime.jsx)(progressBar,{}),(0,jsx_runtime.jsx)(countdown,{})]})};var use_media_recorder=__webpack_require__("./node_modules/@wmik/use-media-recorder/index.js"),use_media_recorder_default=__webpack_require__.n(use_media_recorder),localStore=__webpack_require__("./packages/design-system/src/utils/localStore.ts"),useSnackbar=__webpack_require__("./packages/design-system/src/contexts/snackbar/useSnackbar.ts"),blobToFile=__webpack_require__("./packages/media/src/blobToFile.ts"),src_blob=__webpack_require__("./packages/media/src/blob.ts"),date_src=__webpack_require__("./packages/date/src/index.ts"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),context=__webpack_require__("./packages/story-editor/src/components/mediaRecording/context.js"),formatMsToHMS=__webpack_require__("./packages/media/src/formatMsToHMS.ts"),useFFmpeg=__webpack_require__("./packages/story-editor/src/app/media/utils/useFFmpeg.ts");const mediaRecording_useTrim=function useTrim(_ref){let{setDuration,onTrimmed,file,isRecording}=_ref;const[trimData,setTrimData]=(0,src.eJ)({start:0,end:null}),[isAdjustingTrim,setIsAdjustingTrim]=(0,src.eJ)(!1),[isProcessingTrim,setIsProcessingTrim]=(0,src.eJ)(!1),{trimVideo}=(0,useFFmpeg.Z)(),hasCancelledTrim=(0,src.sO)(),onTrim=(0,src.I4)((async newTrimData=>{if(setIsAdjustingTrim(!1),newTrimData){hasCancelledTrim.current=!1,setIsProcessingTrim(!0);const start=(0,formatMsToHMS.Z)(newTrimData.start),end=(0,formatMsToHMS.Z)(newTrimData.end),result=await trimVideo(file,start,end);if(hasCancelledTrim.current)return;setTrimData(newTrimData),setIsProcessingTrim(!1),onTrimmed(result),setDuration(newTrimData.end-newTrimData.start)}}),[file,onTrimmed,setDuration,trimVideo]),startTrim=(0,src.I4)((()=>setIsAdjustingTrim(!0)),[]),resetTrim=(0,src.I4)((()=>{setIsAdjustingTrim(!1),setTrimData({start:0,end:null})}),[]),cancelTrim=(0,src.I4)((()=>{hasCancelledTrim.current=!0,setIsProcessingTrim(!1)}),[]);return(0,src.d4)((()=>{isRecording&&resetTrim()}),[isRecording,resetTrim]),{trimData,isAdjustingTrim,isProcessingTrim,onTrim,startTrim,resetTrim,cancelTrim}};function MediaRecordingProvider(_ref){let{children}=_ref;const[isInRecordingMode,setIsInRecordingMode]=(0,src.eJ)(!1),[isSettingsOpen,setIsSettingsOpen]=(0,src.eJ)(!1),[isProcessing,setIsProcessing]=(0,src.eJ)(!1),[streamNode,setStreamNode]=(0,src.eJ)(null),[canvasStream,setCanvasStream]=(0,src.eJ)(null),[canvasNode,setCanvasNode]=(0,src.eJ)(null),[countdown,setCountdown]=(0,src.eJ)(0),[duration,setDuration]=(0,src.eJ)(0),[isGif,setIsGif]=(0,src.eJ)(!1),[hasVideo,setHasVideo]=(0,src.eJ)(!0),[hasAudio,setHasAudio]=(0,src.eJ)(!0),[videoInput,setVideoInput]=(0,src.eJ)(localStore.W.getItemByKey(localStore.h.MEDIA_RECORDING_VIDEO_INPUT)),[audioInput,setAudioInput]=(0,src.eJ)(localStore.W.getItemByKey(localStore.h.MEDIA_RECORDING_AUDIO_INPUT)),[videoEffect,setVideoEffect]=(0,src.eJ)(localStore.W.getItemByKey(localStore.h.MEDIA_RECORDING_VIDEO_EFFECT)),[mediaDevices,setMediaDevices]=(0,src.eJ)([]),[file,setFile]=(0,src.eJ)(null),[originalFile,setOriginalFile]=(0,src.eJ)(null);(0,src.d4)((()=>{mediaDevices.length&&(setVideoInput(mediaDevices.find((device=>device.deviceId===videoInput))?.deviceId||mediaDevices.find((device=>"videoinput"===device.kind))?.deviceId),setAudioInput(mediaDevices.find((device=>device.deviceId===audioInput))?.deviceId||mediaDevices.find((device=>"audioinput"===device.kind))?.deviceId))}),[audioInput,mediaDevices,videoInput]);const[mediaBlobUrl,setMediaBlobUrl]=(0,src.eJ)(),[originalMediaBlobUrl,setOriginalMediaBlobUrl]=(0,src.eJ)(),{showSnackbar}=(0,useSnackbar.D)(),onStop=(0,src.I4)((blob=>{try{const recordedBlob=(0,src_blob.Pv)(blob);setOriginalMediaBlobUrl(recordedBlob),setMediaBlobUrl(recordedBlob);const recordedFile=function createFile(blob,hasVideo){const FILE_TYPE=hasVideo?constants.Bj:constants.Y6,MIME_TYPE=hasVideo?constants.L1:constants.h1,captureType=hasVideo?"webcam":"audio";return(0,blobToFile.Z)(blob,`${captureType}-capture-${(0,date_src.WU)(new Date,"Y-m-d-H-i")}.${FILE_TYPE}`,MIME_TYPE)}(blob,hasVideo);setOriginalFile(recordedFile),setFile(recordedFile)}catch(e){(0,tracking_src.tz)("media_recording_capture",e.message),showSnackbar({message:(0,i18n.__)("There was an error recording a video. Please try again.","web-stories"),dismissable:!0})}}),[showSnackbar,hasVideo]),mediaRecorder=use_media_recorder_default()({recordScreen:!1,mediaStreamConstraints:{audio:!!hasAudio&&(!audioInput||{deviceId:audioInput}),video:!!hasVideo&&(!videoInput||{deviceId:videoInput})},onStop}),canvasRecorder=use_media_recorder_default()({recordScreen:!1,customMediaStream:canvasStream,onStop}),currentRecorder=videoEffect&&"none"!==videoEffect&&hasVideo?{...mediaRecorder,inputStatus:mediaRecorder.status,status:canvasRecorder.status,startRecording:canvasRecorder.startRecording,pauseRecording:canvasRecorder.pauseRecording,resumeRecording:canvasRecorder.resumeRecording,stopRecording:canvasRecorder.stopRecording,mediaBlob:canvasRecorder.mediaBlob,clearMediaBlob:canvasRecorder.clearMediaBlob,getMediaStream:async()=>{canvasRecorder.clearMediaStream(),await mediaRecorder.getMediaStream()}}:{...mediaRecorder,inputStatus:mediaRecorder.status},{error,inputStatus,status,mediaBlob,stopRecording:originalStopRecording,startRecording,liveStream,getMediaStream,clearMediaStream,clearMediaBlob,muteAudio,unMuteAudio,pauseRecording,resumeRecording}=currentRecorder,isRecording="recording"===status,onTrimmed=(0,src.I4)((trimmedFile=>{setMediaBlobUrl((0,src_blob.Pv)(trimmedFile)),setFile(trimmedFile)}),[]),{trimData,isAdjustingTrim,isProcessingTrim,startTrim,onTrim,resetTrim,cancelTrim}=mediaRecording_useTrim({setDuration,onTrimmed,file:originalFile,isRecording});(0,src.d4)((()=>{"NotFoundError"!==error?.name&&"NotReadableError"!==error?.name&&"OverConstrainedError"!==error?.name||(setHasVideo(!1),setVideoInput(null))}),[error]);const speak=(0,useLiveRegion.Z)(),stopRecording=(0,src.I4)((()=>{setIsProcessing(!0),originalStopRecording(),speak((0,i18n.__)("Recording stopped","web-stories"))}),[originalStopRecording,speak]),updateMediaDevices=(0,src.I4)((async()=>{if(navigator.mediaDevices)try{const devices=await navigator.mediaDevices.enumerateDevices();setMediaDevices(devices.filter((device=>"audiooutput"!==device.kind)).filter((device=>device.label)))}catch(err){}}),[]);(0,src.d4)((()=>{if(navigator.mediaDevices)return navigator.mediaDevices.addEventListener("devicechange",updateMediaDevices),()=>{navigator.mediaDevices.removeEventListener("devicechange",updateMediaDevices)}}),[]);const toggleVideo=(0,src.I4)((()=>{setHasVideo(!hasVideo)}),[hasVideo]),toggleAudio=(0,src.I4)((()=>{setHasAudio(!hasAudio),hasAudio?muteAudio():unMuteAudio()}),[hasAudio,muteAudio,unMuteAudio]),previousBlobUrl=(0,src.D9)(mediaBlobUrl);(0,src.d4)((()=>{previousBlobUrl&&previousBlobUrl!==mediaBlobUrl&&previousBlobUrl!==originalMediaBlobUrl&&(0,src_blob.oU)(previousBlobUrl)}),[mediaBlobUrl,previousBlobUrl,originalMediaBlobUrl]),(0,src.d4)((()=>{let timeout;return duration>=0&&isRecording&&(timeout=setTimeout((()=>setDuration((seconds=>seconds+1))),1e3)),()=>clearTimeout(timeout)}),[duration,isRecording]),(0,src.d4)((()=>{let timeout;return countdown>0&&(timeout=setTimeout((()=>setCountdown(countdown-1)),1e3)),()=>clearTimeout(timeout)}),[countdown]),(0,src.d4)((()=>{duration>constants.pS&&stopRecording()}),[duration,stopRecording]);const resetStream=(0,src.I4)((()=>{liveStream&&liveStream.getTracks().forEach((track=>track.stop())),canvasRecorder.liveStream&&canvasRecorder.liveStream.getTracks().forEach((track=>track.stop())),clearMediaBlob(),clearMediaStream(),canvasRecorder.clearMediaStream()}),[clearMediaBlob,clearMediaStream,liveStream,canvasRecorder]),resetState=(0,src.I4)((()=>{setFile(null),setIsGif(!1),setMediaBlobUrl(null),setCountdown(0),setIsProcessing(!1),setDuration(0),resetTrim(),resetStream()}),[resetStream,resetTrim]),toggleRecordingMode=(0,src.I4)((()=>{setIsInRecordingMode((state=>!state)),"recording"===canvasRecorder.status?stopRecording():(resetState(),!0===isInRecordingMode&&canvasRecorder.clearMediaStream())}),[resetState,canvasRecorder,isInRecordingMode,stopRecording]),toggleSettings=(0,src.I4)((()=>setIsSettingsOpen((state=>!state))),[]),toggleIsGif=(0,src.I4)((()=>setIsGif((state=>!state))),[]),isCountingDown=countdown>0,wasCountingDown=(0,src.D9)(isCountingDown),value=(0,src.Ye)((()=>({state:{isInRecordingMode,hasVideo,hasAudio,mediaDevices,audioInput,videoInput,videoEffect,isSettingsOpen,error,inputStatus,status,mediaBlob,mediaBlobUrl,originalMediaBlobUrl,liveStream,file,isGif,duration,countdown,isProcessing,isCountingDown:isCountingDown||wasCountingDown,trimData,isAdjustingTrim,streamNode,isProcessingTrim,canvasStream,canvasNode},actions:{toggleRecordingMode,setMediaBlobUrl,toggleVideo,toggleAudio,toggleSettings,toggleIsGif,setAudioInput,setVideoInput,setVideoEffect,updateMediaDevices,stopRecording,startRecording,getMediaStream,clearMediaStream,clearMediaBlob,setFile,muteAudio,unMuteAudio,setDuration,setCountdown,resetState,resetStream,onTrim,startTrim,setStreamNode,pauseRecording,resumeRecording,cancelTrim,setCanvasStream,setCanvasNode}})),[isInRecordingMode,hasVideo,hasAudio,mediaDevices,audioInput,videoInput,videoEffect,isSettingsOpen,error,inputStatus,status,mediaBlob,mediaBlobUrl,originalMediaBlobUrl,liveStream,file,isGif,duration,countdown,isCountingDown,wasCountingDown,isProcessing,trimData,isAdjustingTrim,streamNode,isProcessingTrim,toggleRecordingMode,toggleVideo,toggleAudio,toggleSettings,toggleIsGif,updateMediaDevices,stopRecording,startRecording,getMediaStream,clearMediaStream,clearMediaBlob,muteAudio,unMuteAudio,resetState,resetStream,onTrim,startTrim,setStreamNode,pauseRecording,resumeRecording,cancelTrim,canvasStream,setCanvasStream,canvasNode,setCanvasNode]);return(0,jsx_runtime.jsx)(context.Z.Provider,{value,children})}MediaRecordingProvider.displayName="MediaRecordingProvider";const provider=MediaRecordingProvider;var dropdown=__webpack_require__("./packages/design-system/src/components/dropDown/dropdown.tsx"),dialog=__webpack_require__("./packages/story-editor/src/components/dialog/index.js");const Row=styled_components_browser_esm.ZP.div.withConfig({displayName:"settingsModal__Row",componentId:"sc-1xjwc1a-0"})(["margin-bottom:16px;"]),Label=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({as:"label",size:types.TextSize.Small}).withConfig({displayName:"settingsModal__Label",componentId:"sc-1xjwc1a-1"})(["display:inline-block;margin-bottom:8px;"]);function SettingsModal(){const{mediaDevices,hasAudio,videoInput,audioInput,videoEffect,isSettingsOpen,setAudioInput,setVideoInput,setVideoEffect,clearMediaStream,clearMediaBlob,toggleSettings}=(0,useMediaRecording.Z)((_ref=>{let{state,actions}=_ref;return{mediaDevices:state.mediaDevices,hasAudio:state.hasAudio,videoInput:state.videoInput,audioInput:state.audioInput,videoEffect:state.videoEffect,isSettingsOpen:state.isSettingsOpen,setAudioInput:actions.setAudioInput,setVideoInput:actions.setVideoInput,setVideoEffect:actions.setVideoEffect,clearMediaStream:actions.clearMediaStream,clearMediaBlob:actions.clearMediaBlob,toggleSettings:actions.toggleSettings}})),[localVideoInput,setLocalVideoInput]=(0,src.eJ)(videoInput),[localAudioInput,setLocalAudioInput]=(0,src.eJ)(audioInput),[localVideoEffect,setLocalVideoEffect]=(0,src.eJ)(videoEffect);(0,src.d4)((()=>setLocalVideoInput(videoInput)),[videoInput]),(0,src.d4)((()=>setLocalAudioInput(audioInput)),[audioInput]);const onSaveChanges=(0,src.I4)((()=>{toggleSettings(),setVideoInput(localVideoInput),localStore.W.setItemByKey(localStore.h.MEDIA_RECORDING_VIDEO_INPUT,localVideoInput),setAudioInput(localAudioInput),localStore.W.setItemByKey(localStore.h.MEDIA_RECORDING_AUDIO_INPUT,localAudioInput),setVideoEffect(localVideoEffect),localStore.W.setItemByKey(localStore.h.MEDIA_RECORDING_VIDEO_EFFECT,localVideoEffect),videoInput===localVideoInput&&audioInput===localAudioInput&&videoEffect===localVideoEffect||((0,tracking_src.L9)("media_recording_settings_changed"),clearMediaStream(),clearMediaBlob())}),[audioInput,clearMediaBlob,clearMediaStream,localAudioInput,localVideoInput,localVideoEffect,setAudioInput,setVideoInput,setVideoEffect,toggleSettings,videoInput,videoEffect]),videoInputs=mediaDevices.filter((device=>"videoinput"===device.kind)).map((_ref2=>{let{deviceId,label}=_ref2;return{value:deviceId,label}})),audioInputs=mediaDevices.filter((device=>"audioinput"===device.kind)).map((_ref3=>{let{deviceId,label}=_ref3;return{value:deviceId,label}})),videoEffects=[{value:constants.ut.NONE,label:(0,i18n.__)("None","web-stories")},{value:constants.ut.BLUR,label:(0,i18n.__)("Background blur","web-stories")}],onChangeVideoInput=(0,src.I4)(((_event,value)=>setLocalVideoInput(value)),[]),onChangeAudioInput=(0,src.I4)(((evt,value)=>setLocalAudioInput(value)),[]),onChangeVideoEffect=(0,src.I4)(((_event,value)=>setLocalVideoEffect(value)),[]),onClose=(0,src.I4)((()=>{toggleSettings(),setLocalVideoInput(videoInput),setLocalAudioInput(audioInput)}),[audioInput,toggleSettings,videoInput]);return(0,jsx_runtime.jsxs)(dialog.Z,{onClose,isOpen:isSettingsOpen,contentLabel:(0,i18n.__)("Media Recording Options","web-stories"),title:(0,i18n.__)("Options","web-stories"),onPrimary:onSaveChanges,primaryText:(0,i18n.__)("Save","web-stories"),secondaryText:(0,i18n.__)("Cancel","web-stories"),children:[(0,jsx_runtime.jsx)(Row,{children:(0,jsx_runtime.jsx)(typography_text.x.Paragraph,{children:(0,i18n.__)("Choose the camera and microphone to use for the recording.","web-stories")})}),videoInputs.length>0&&(0,jsx_runtime.jsxs)(Row,{children:[(0,jsx_runtime.jsx)(Label,{htmlFor:"camera",children:(0,i18n.__)("Camera","web-stories")}),(0,jsx_runtime.jsx)(dropdown.Z,{id:"camera",ariaLabel:(0,i18n.__)("Video Input","web-stories"),placeholder:(0,i18n.__)("Select Video Input","web-stories"),options:videoInputs,onMenuItemClick:onChangeVideoInput,selectedValue:localVideoInput,popupZIndex:constants.CY})]}),audioInputs.length>0&&(0,jsx_runtime.jsxs)(Row,{children:[(0,jsx_runtime.jsx)(Label,{htmlFor:"microphone",children:(0,i18n.__)("Microphone","web-stories")}),(0,jsx_runtime.jsx)(dropdown.Z,{id:"microphone",ariaLabel:(0,i18n.__)("Audio Input","web-stories"),placeholder:(0,i18n.__)("Select Audio Input","web-stories"),options:audioInputs,onMenuItemClick:onChangeAudioInput,selectedValue:localAudioInput,disabled:!hasAudio,popupZIndex:constants.CY})]}),videoInputs.length>0&&(0,jsx_runtime.jsxs)(Row,{children:[(0,jsx_runtime.jsx)(Label,{htmlFor:"video-effect",children:(0,i18n.__)("Video Effect","web-stories")}),(0,jsx_runtime.jsx)(dropdown.Z,{id:"video-effect",ariaLabel:(0,i18n.__)("Video Effect","web-stories"),placeholder:(0,i18n.__)("Select Video Effect","web-stories"),options:videoEffects,onMenuItemClick:onChangeVideoEffect,selectedValue:localVideoEffect,popupZIndex:constants.CY})]})]})}SettingsModal.displayName="SettingsModal";const settingsModal=SettingsModal;var button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),photo_camera=__webpack_require__("./packages/design-system/src/icons/photo_camera.svg"),mic=__webpack_require__("./packages/design-system/src/icons/mic.svg"),getVideoLengthDisplay=__webpack_require__("./packages/media/src/getVideoLengthDisplay.ts"),getVideoLength=__webpack_require__("./packages/media/src/getVideoLength.ts"),getCanvasBlob=__webpack_require__("./packages/media/src/getCanvasBlob.ts"),getImageFromVideo=__webpack_require__("./packages/media/src/getImageFromVideo.ts"),propTypes=__webpack_require__("./packages/media/src/types/propTypes.ts"),getResourceFromLocalFile=__webpack_require__("./packages/story-editor/src/app/media/utils/getResourceFromLocalFile.ts"),useUploadWithPreview=__webpack_require__("./packages/story-editor/src/components/canvas/useUploadWithPreview.js"),uploader=__webpack_require__("./packages/story-editor/src/app/uploader/index.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),highlights=__webpack_require__("./packages/story-editor/src/app/highlights/index.ts"),objectPick=__webpack_require__("./packages/story-editor/src/utils/objectPick.ts");const BaseButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:button_constants.L$.Primary,size:button_constants.qE.Small}).withConfig({displayName:"footer__BaseButton",componentId:"sc-cffjy6-0"})([""]),RecordingButton=(0,styled_components_browser_esm.ZP)(BaseButton).withConfig({displayName:"footer__RecordingButton",componentId:"sc-cffjy6-1"})(["margin-right:20px;padding-top:12px;padding-bottom:12px;svg{margin:-9px 10px -9px 0;}"]),PauseButton=(0,styled_components_browser_esm.ZP)(BaseButton).attrs({type:button_constants.L$.Secondary}).withConfig({displayName:"footer__PauseButton",componentId:"sc-cffjy6-2"})(["margin-right:20px;padding-top:12px;padding-bottom:12px;"]),StopButton=(0,styled_components_browser_esm.ZP)(BaseButton).withConfig({displayName:"footer__StopButton",componentId:"sc-cffjy6-3"})(["padding-top:12px;padding-bottom:12px;background-color:",";border-color:",";color:",";&:active,&:hover,&:focus{background-color:",";border-color:",";}"],(_ref=>{let{theme}=_ref;return theme.colors.interactiveBg.negativeNormal}),(_ref2=>{let{theme}=_ref2;return theme.colors.interactiveBg.negativeNormal}),(_ref3=>{let{theme}=_ref3;return theme.colors.gray[5]}),(_ref4=>{let{theme}=_ref4;return theme.colors.interactiveBg.negativeHover}),(_ref5=>{let{theme}=_ref5;return theme.colors.interactiveBg.negativeHover})),CaptureButton=(0,styled_components_browser_esm.ZP)(BaseButton).attrs({type:button_constants.L$.Quaternary}).withConfig({displayName:"footer__CaptureButton",componentId:"sc-cffjy6-4"})(["background-color:",";padding-top:12px;padding-bottom:12px;svg{margin:-9px 10px -9px 0;}"],(_ref6=>{let{theme}=_ref6;return theme.colors.opacity.overlayDark})),InsertButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:button_constants.L$.Primary,size:button_constants.qE.Small}).withConfig({displayName:"footer__InsertButton",componentId:"sc-cffjy6-5"})([""]),RetryButton=(0,styled_components_browser_esm.ZP)(button_button.z).attrs({type:button_constants.L$.Plain,size:button_constants.qE.Small}).withConfig({displayName:"footer__RetryButton",componentId:"sc-cffjy6-6"})(["margin-right:20px;"]);const footer=function Footer(){const{status,file,isGif,isMuted,hasMediaToInsert,countdown,duration,isCountingDown,setMediaBlobUrl,setDuration,setCountdown,startRecording,stopRecording,setFile,toggleRecordingMode,getMediaStream,resetState,resetStream,streamNode,canvasStream,liveStream,hasVideo,videoEffect,pauseRecording,resumeRecording,isProcessingTrim,cancelTrim,canvasNode}=(0,useMediaRecording.Z)((_ref7=>{let{state,actions}=_ref7;return{status:state.status,file:state.file,isGif:state.isGif,isMuted:!state.hasAudio||state.isGif,countdown:state.countdown,duration:state.duration,isCountingDown:state.isCountingDown,hasVideo:state.hasVideo,videoEffect:state.videoEffect,hasMediaToInsert:Boolean(state.mediaBlobUrl),liveStream:state.liveStream,streamNode:state.streamNode,canvasStream:state.canvasStream,isProcessingTrim:state.isProcessingTrim,startRecording:actions.startRecording,stopRecording:actions.stopRecording,setFile:actions.setFile,setMediaBlobUrl:actions.setMediaBlobUrl,setDuration:actions.setDuration,setCountdown:actions.setCountdown,toggleRecordingMode:actions.toggleRecordingMode,getMediaStream:actions.getMediaStream,resetState:actions.resetState,resetStream:actions.resetStream,pauseRecording:actions.pauseRecording,resumeRecording:actions.resumeRecording,cancelTrim:actions.cancelTrim,canvasNode:state.canvasNode}})),videoNode=(0,useVideoTrim.Z)((_ref8=>{let{state:{videoNode}}=_ref8;return videoNode})),uploadWithPreview=(0,useUploadWithPreview.Z)(),speak=(0,useLiveRegion.Z)(),{allowedMimeTypes:{audio:allowedAudioMimeTypes}}=(0,app.ZR)(),onPause=(0,src.I4)((()=>{pauseRecording(),(0,tracking_src.L9)("media_recording_pause")}),[pauseRecording]),onResume=(0,src.I4)((()=>{resumeRecording(),(0,tracking_src.L9)("media_recording_resume")}),[resumeRecording]),onRetry=(0,src.I4)((async()=>{resetState(),await getMediaStream(),(0,tracking_src.L9)("media_recording_retry")}),[getMediaStream,resetState]),debouncedStartRecording=(0,src.y1)(startRecording,1e3*constants.x_),onStart=(0,src.I4)((()=>{speak((0,sprintf.Z)((0,i18n._n)("Starting recording in %d second","Starting recording in %d seconds",constants.x_,"web-stories"),constants.x_)),setDuration(0),setCountdown(constants.x_),debouncedStartRecording()}),[debouncedStartRecording,setCountdown,setDuration,speak]),[isInserting,setIsInserting]=(0,src.eJ)(!1),isRecording=["recording","stopping","stopped","paused"].includes(status),isPaused="paused"===status,onInsert=(0,src.I4)((async()=>{setIsInserting(!0),speak((0,i18n.__)("Inserting","web-stories"));const args={additionalData:{mediaSource:"recording",altText:(0,i18n.__)("Camera Capture","web-stories")}},{resource,posterFile}=await(0,getResourceFromLocalFile.Z)(file);if(args.resource={...resource,alt:(0,i18n.__)("Camera Capture","web-stories")},file.type.startsWith("video")){args.additionalData.isMuted=isMuted,args.additionalData.isGif=isGif,args.resource.length=duration,args.resource.lengthFormatted=(0,getVideoLengthDisplay.Z)(duration),args.resource.isOptimized=!0,args.resource.isMuted=isMuted,args.posterFile=posterFile;const{length,lengthFormatted}=(0,getVideoLength.Z)(videoNode);args.resource.length=length||duration,args.resource.lengthFormatted=length?lengthFormatted:(0,getVideoLengthDisplay.Z)(duration)}uploadWithPreview([file],!0,args),isRecording&&(setMediaBlobUrl(null),setFile(null)),(0,tracking_src.L9)("media_recording_capture",{type:isGif?"gif":"video",muted:isMuted,duration}),setIsInserting(!1),toggleRecordingMode()}),[speak,file,uploadWithPreview,isRecording,isGif,isMuted,duration,toggleRecordingMode,videoNode,setMediaBlobUrl,setFile]);(0,src.d4)((()=>{streamNode&&!streamNode.srcObject&&liveStream&&(streamNode.srcObject=liveStream),streamNode&&!liveStream&&(streamNode.srcObject=null)}),[streamNode,liveStream]);const{showSnackbar}=(0,useSnackbar.D)(),captureImage=(0,src.I4)((async()=>{const hasVideoEffect=videoEffect&&videoEffect!==constants.ut.NONE,inputStream=hasVideoEffect?canvasStream:streamNode;if(!inputStream)return;let blob;try{blob=hasVideoEffect?await(0,getCanvasBlob.Z)(canvasNode):await(0,getImageFromVideo.Z)(inputStream),setMediaBlobUrl((0,src_blob.Pv)(blob))}catch(e){(0,tracking_src.tz)("media_recording_capture",e.message),showSnackbar({message:(0,i18n.__)("There was an error taking a photo. Please try again.","web-stories"),dismissable:!0})}const imageFile=(0,blobToFile.Z)(blob,`image-capture-${(0,date_src.WU)(new Date,"Y-m-d-H-i")}.${constants.Yn}`,constants.RE);setFile(imageFile),resetStream()}),[resetStream,setFile,setMediaBlobUrl,showSnackbar,streamNode,canvasStream,videoEffect,canvasNode]),debouncedCaptureImage=(0,src.y1)(captureImage,1e3*constants.x_),onCapture=(0,src.I4)((()=>{speak((0,sprintf.Z)((0,i18n._n)("Taking photo in %d second","Taking photo in %d seconds",constants.x_,"web-stories"),constants.x_)),setCountdown(constants.x_),debouncedCaptureImage(),(0,tracking_src.L9)("media_recording_capture",{type:"image"})}),[debouncedCaptureImage,setCountdown,speak]),{actions:{uploadFile}}=(0,uploader.J)(),{updateCurrentPageProperties,backgroundElementId,setSelectedElementsById}=(0,app.rB)((_ref9=>{let{state:{currentPage},actions:{updateCurrentPageProperties,setSelectedElementsById}}=_ref9;return{backgroundElementId:currentPage?.elements.find((_ref10=>{let{isBackground}=_ref10;return isBackground}))?.id,updateCurrentPageProperties,setSelectedElementsById,currentPage}})),{setHighlights}=(0,highlights.QM)((_ref11=>{let{setHighlights}=_ref11;return{setHighlights}})),{convertToMp3}=(0,useFFmpeg.Z)(),onAudioInsert=async()=>{setIsInserting(!0),speak((0,i18n.__)("Inserting","web-stories"));const mp3File=await convertToMp3(file),resource=await uploadFile(mp3File,{mediaSource:"recording"},allowedAudioMimeTypes),backgroundAudio={resource:(0,objectPick.Z)(resource,Object.keys(propTypes.yE))};setSelectedElementsById({elementIds:[backgroundElementId]}),setHighlights({highlight:highlights.$q.PageBackgroundAudio}),updateCurrentPageProperties({properties:{backgroundAudio}}),setIsInserting(!1),toggleRecordingMode()};return"acquiring_media"===status?null:isProcessingTrim?(0,jsx_runtime.jsx)(RetryButton,{onClick:cancelTrim,children:(0,i18n.__)("Cancel trimming","web-stories")}):hasMediaToInsert?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(RetryButton,{onClick:onRetry,disabled:isInserting,children:(0,i18n.__)("Retry","web-stories")}),(0,jsx_runtime.jsx)(InsertButton,{onClick:hasVideo?onInsert:onAudioInsert,disabled:isInserting,children:isInserting?(0,i18n.__)("Inserting","web-stories"):hasVideo?(0,i18n.__)("Insert","web-stories"):(0,i18n.__)("Insert page background audio","web-stories")})]}):0===countdown?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isRecording&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PauseButton,{onClick:isPaused?onResume:onPause,"aria-label":isPaused?(0,i18n.__)("Resume Recording","web-stories"):(0,i18n.__)("Pause Recording","web-stories"),children:isPaused?(0,i18n.__)("Resume","web-stories"):(0,i18n.__)("Pause","web-stories")}),(0,jsx_runtime.jsx)(StopButton,{onClick:stopRecording,"aria-label":(0,i18n.__)("Stop Recording","web-stories"),children:(0,i18n.__)("Stop","web-stories")})]}),!isRecording&&!isCountingDown&&(hasVideo?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(RecordingButton,{onClick:onStart,children:[(0,jsx_runtime.jsx)(camera.Z,{width:24,height:24,"aria-hidden":!0}),(0,i18n.__)("Record Video","web-stories")]}),(0,jsx_runtime.jsxs)(CaptureButton,{onClick:onCapture,children:[(0,jsx_runtime.jsx)(photo_camera.Z,{width:24,height:24,"aria-hidden":!0}),(0,i18n.__)("Take a photo","web-stories")]})]}):(0,jsx_runtime.jsxs)(RecordingButton,{onClick:onStart,children:[(0,jsx_runtime.jsx)(mic.Z,{width:24,height:24,"aria-hidden":!0}),(0,i18n.__)("Record Audio","web-stories")]}))]}):null};var popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js");const durationIndicator_Wrapper=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).attrs({size:types.TextSize.Small}).withConfig({displayName:"durationIndicator__Wrapper",componentId:"sc-5z5bu3-0"})(["font-variant-numeric:tabular-nums;&:before{content:'';display:inline-block;width:10px;height:10px;margin-right:5px;border-radius:100%;background-color:",";}"],(_ref=>{let{theme}=_ref;return theme.colors.interactiveBg.negativeNormal}));function DurationIndicator(){const{duration,isRecording}=(0,useMediaRecording.Z)((_ref2=>{let{state}=_ref2;return{duration:state.duration,isRecording:["recording","paused"].includes(state.status)}}));return isRecording?(0,jsx_runtime.jsx)(tooltip.Z,{position:popup_constants.ug.Top,title:(0,sprintf.Z)((0,i18n._n)("Maximum duration is %d minute","Maximum duration is %d minutes",constants.A0,"web-stories"),String(constants.A0)),styleOverride:{maxWidth:"20em"},children:(0,jsx_runtime.jsx)(durationIndicator_Wrapper,{children:(0,getVideoLengthDisplay.Z)(duration)})}):null}DurationIndicator.displayName="DurationIndicator";const durationIndicator=DurationIndicator},"./packages/story-editor/src/components/mediaRecording/useMediaRecording.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_context__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/components/mediaRecording/context.js");const __WEBPACK_DEFAULT_EXPORT__=function useMediaRecording(selector){return(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.Sz)(_context__WEBPACK_IMPORTED_MODULE_1__.Z,selector??_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.yR)}},"./packages/story-editor/src/components/panels/design/textStyle/utils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{XE:()=>getHiddenPadding,g1:()=>applyHiddenPadding,yo:()=>removeHiddenPadding});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/story-editor/src/constants/index.ts");function applyHiddenPadding(element){return element?.padding?.hasHiddenPadding?element.padding:{...element.padding??{},hasHiddenPadding:!0,...["vertical","horizontal"].reduce(((padding,axis)=>(padding[axis]=(element?.padding?.[axis]||0)+_constants__WEBPACK_IMPORTED_MODULE_0__.ab[axis],padding)),{})}}function removeHiddenPadding(element){return element?.padding?.hasHiddenPadding?{...element.padding??{},hasHiddenPadding:!1,...["vertical","horizontal"].reduce(((padding,axis)=>(padding[axis]=(element?.padding?.[axis]||0)-_constants__WEBPACK_IMPORTED_MODULE_0__.ab[axis],padding)),{})}:element.padding}function getHiddenPadding(){let element=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},axis=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"horizontal";return element?.padding?.hasHiddenPadding?_constants__WEBPACK_IMPORTED_MODULE_0__.ab[axis]:0}},"./packages/story-editor/src/components/uploadDropTarget/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{YE:()=>dropTarget,DI:()=>message,Vm:()=>overlay});__webpack_require__("./node_modules/react/index.js");var styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),src=__webpack_require__("./packages/react/src/index.ts"),dragEvent=__webpack_require__("./packages/story-editor/src/utils/dragEvent.ts");const context=(0,src.kr)({});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const DropTargetComponent=styled_components_browser_esm.ZP.div.withConfig({displayName:"dropTarget__DropTargetComponent",componentId:"sc-12rok6t-0"})(["position:relative;width:100%;height:100%;"]),Content=styled_components_browser_esm.ZP.div.withConfig({displayName:"dropTarget__Content",componentId:"sc-12rok6t-1"})(["position:relative;width:100%;height:100%;"]),Glasspane=styled_components_browser_esm.ZP.div.withConfig({displayName:"dropTarget__Glasspane",componentId:"sc-12rok6t-2"})(["position:absolute;z-index:1000;top:0;left:0;width:100%;height:100%;"]);function disableDefaults(evt){evt.preventDefault(),evt.stopPropagation()}function UploadDropTarget(_ref){let{disabled=!1,label=null,labelledBy=null,onDrop=null,children}=_ref;const[isDragging,setIsDragging]=(0,src.eJ)(!1),onDragEnter=(0,src.I4)((e=>{const{dataTransfer}=e;(0,dragEvent.a)(e)&&(disableDefaults(e),disabled?dataTransfer.effectAllowed="none":(dataTransfer.effectAllowed="copy",setIsDragging(!0)))}),[disabled]),onDragLeave=(0,src.I4)((evt=>{disableDefaults(evt),setIsDragging(!1)}),[]),onDropHandler=(0,src.I4)((evt=>{disableDefaults(evt),setIsDragging(!1),!disabled&&onDrop&&onDrop([...evt.dataTransfer.files])}),[disabled,onDrop]);return(0,jsx_runtime.jsxs)(DropTargetComponent,{onDragEnter,onDrop:onDropHandler,onDragOver:disableDefaults,children:[isDragging&&(0,jsx_runtime.jsx)(Glasspane,{onDragEnter,onDragLeave,onDragOver:disableDefaults,onDrop:onDropHandler,"aria-label":label,"aria-labelledby":labelledBy}),(0,jsx_runtime.jsx)(context.Provider,{value:{isDragging},children:(0,jsx_runtime.jsx)(Content,{children})})]})}UploadDropTarget.displayName="UploadDropTarget";const dropTarget=UploadDropTarget;var src_mimeTypes=__webpack_require__("./packages/media/src/mimeTypes.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),translateToExclusiveList=__webpack_require__("./packages/i18n/src/translateToExclusiveList.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),arrow_cloud=__webpack_require__("./packages/design-system/src/icons/arrow_cloud.svg"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),polished_esm=__webpack_require__("./node_modules/polished/dist/polished.esm.js");const use=function useUploadDropTarget(selector){return(0,src.Sz)(context,selector??src.yR)},Overlay=styled_components_browser_esm.ZP.div.withConfig({displayName:"overlay__Overlay",componentId:"sc-u0s4sf-0"})(["position:absolute;z-index:999;top:0;left:0;width:100%;height:100%;background-color:",";"],(_ref=>{let{theme}=_ref;return(0,polished_esm.m4)(theme.colors.bg.primary,.6)}));function UploadDropTargetOverlayWithRef(props,ref){const{isDragging}=use((state=>({isDragging:state.isDragging})));return isDragging?(0,jsx_runtime.jsx)(Overlay,{ref,...props}):null}UploadDropTargetOverlayWithRef.displayName="UploadDropTargetOverlayWithRef";const overlay=(0,src.Gp)(UploadDropTargetOverlayWithRef),Container=(0,styled_components_browser_esm.ZP)(overlay).withConfig({displayName:"message__Container",componentId:"sc-1cdb29v-0"})(["display:flex;align-items:center;justify-content:center;"]),Box=styled_components_browser_esm.ZP.div.withConfig({displayName:"message__Box",componentId:"sc-1cdb29v-1"})(["width:100%;max-width:240px;padding:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;"]),Text=(0,styled_components_browser_esm.ZP)(typography_text.x.Paragraph).withConfig({displayName:"message__Text",componentId:"sc-1cdb29v-2"})(["color:",";margin-bottom:14px;margin-top:0px;"],(_ref=>{let{theme}=_ref;return theme.colors.standard.white})),Icon=(0,styled_components_browser_esm.ZP)(arrow_cloud.Z).withConfig({displayName:"message__Icon",componentId:"sc-1cdb29v-3"})(["height:52px;width:52px;color:",";"],(_ref2=>{let{theme}=_ref2;return theme.colors.standard.white}));function UploadDropTargetMessage(_ref3){let{message,...rest}=_ref3;const{allowedMimeTypes:{image:allowedImageMimeTypes,vector:allowedVectorMimeTypes,video:allowedVideoMimeTypes}}=(0,config.ZR)(),allowedMimeTypes=(0,src.Ye)((()=>[...allowedImageMimeTypes,...allowedVectorMimeTypes,...allowedVideoMimeTypes]),[allowedImageMimeTypes,allowedVideoMimeTypes,allowedVectorMimeTypes]),allowedFileTypes=(0,src.Ye)((()=>allowedMimeTypes.map((type=>(0,src_mimeTypes.E)(type))).flat()),[allowedMimeTypes]);let description=(0,i18n.__)("No file types are currently supported.","web-stories");return allowedFileTypes.length&&(description=(0,sprintf.Z)((0,i18n.__)("You can upload %s.","web-stories"),(0,translateToExclusiveList.Z)(allowedFileTypes))),(0,jsx_runtime.jsx)(Container,{...rest,children:(0,jsx_runtime.jsxs)(Box,{children:[(0,jsx_runtime.jsx)(Icon,{}),(0,jsx_runtime.jsx)(Text,{isBold:!0,size:types.TextSize.Medium,children:message}),(0,jsx_runtime.jsx)(Text,{size:types.TextSize.Small,children:description})]})})}UploadDropTargetMessage.displayName="UploadDropTargetMessage";const message=(0,src.X$)(UploadDropTargetMessage)},"./packages/story-editor/src/components/videoTrim/useVideoNode.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/constants/index.ts"),_utils_noop__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const __WEBPACK_DEFAULT_EXPORT__=function useVideoNode(videoData){const[currentTime,setCurrentTime]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(null),[startOffset,rawSetStartOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(null),[originalStartOffset,setOriginalStartOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(null),[endOffset,rawSetEndOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(null),[originalEndOffset,setOriginalEndOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(null),[maxOffset,setMaxOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(null),[videoNode,setVideoNode]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(null),[isDraggingHandles,setIsDraggingHandles]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.eJ)(!1),isPausedTracker=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.sO)(!1);(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.d4)((()=>{videoNode&&(isPausedTracker.current||(isDraggingHandles?videoNode.pause():(videoNode.currentTime=startOffset/1e3,videoNode.play().catch(_utils_noop__WEBPACK_IMPORTED_MODULE_2__.Z))))}),[videoNode,isDraggingHandles,startOffset]);const paused=videoNode?videoNode.paused:null;(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.d4)((()=>{isDraggingHandles||(isPausedTracker.current=paused)}),[paused,isDraggingHandles]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.d4)((()=>{videoData||(rawSetStartOffset(null),setOriginalStartOffset(null),setCurrentTime(null),rawSetEndOffset(null),setOriginalEndOffset(null),setMaxOffset(null))}),[videoData]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.d4)((()=>{if(videoNode&&videoData)return isFinite(videoNode.duration)&&null===startOffset?onLoadedMetadata({target:videoNode}):isFinite(videoNode.duration)?videoNode.addEventListener("loadedmetadata",onLoadedMetadata):(videoNode.currentTime=Number.MAX_SAFE_INTEGER,videoNode.addEventListener("timeupdate",onLoadedMetadata)),endOffset&&videoNode.addEventListener("timeupdate",onTimeUpdate),()=>{videoNode.removeEventListener("timeupdate",onTimeUpdate),videoNode.removeEventListener("timeupdate",onLoadedMetadata),videoNode.removeEventListener("loadedmetadata",onLoadedMetadata)};function restart(at){videoNode.currentTime=at/1e3,videoNode.play().catch(_utils_noop__WEBPACK_IMPORTED_MODULE_2__.Z)}function onLoadedMetadata(evt){if(!isFinite(evt.target.duration))return;const duration=Math.floor(1e3*evt.target.duration);rawSetStartOffset(videoData.start),setOriginalStartOffset(videoData.start),setCurrentTime(videoData.start),rawSetEndOffset(videoData.end??duration),setOriginalEndOffset(videoData.end??duration),setMaxOffset(duration),restart(videoData.start)}function onTimeUpdate(evt){if(!endOffset)return;const currentOffset=Math.floor(1e3*evt.target.currentTime);setCurrentTime(Math.min(currentOffset,endOffset)),currentOffset>endOffset&&!isPausedTracker.current&&restart(startOffset)}}),[startOffset,endOffset,videoData,videoNode]);const setStartOffset=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.I4)((offset=>{offset=Math.min(endOffset-_constants__WEBPACK_IMPORTED_MODULE_1__.Vo,offset),offset=Math.max(0,offset),rawSetStartOffset(offset),videoNode.currentTime=offset/1e3}),[videoNode,endOffset]),setEndOffset=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.I4)((offset=>{offset=Math.max(startOffset+_constants__WEBPACK_IMPORTED_MODULE_1__.Vo,offset),offset=Math.min(maxOffset,offset),rawSetEndOffset(offset),videoNode.currentTime=offset/1e3}),[videoNode,startOffset,maxOffset]);return{hasChanged:(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.Ye)((()=>startOffset!==originalStartOffset||endOffset!==originalEndOffset),[startOffset,originalStartOffset,endOffset,originalEndOffset]),currentTime,startOffset,endOffset,maxOffset,videoNode,setStartOffset,setEndOffset,setVideoNode,setIsDraggingHandles}}},"./packages/story-editor/src/utils/dragEvent.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function isDragType(e,type){return!!e?.dataTransfer?.types&&e.dataTransfer.types.includes(type)}function isDraggingFile(e){return isDragType(e,"Files")}__webpack_require__.d(__webpack_exports__,{B:()=>isDragType,a:()=>isDraggingFile})},"./packages/story-editor/src/utils/isTargetOutOfContainer.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=function isTargetOutOfContainer(target,container){const{left,right,top,bottom}=target.getBoundingClientRect(),containerRect=container.getBoundingClientRect();return left>containerRect.right||right<containerRect.left||bottom<containerRect.top||top>containerRect.bottom}},"./packages/story-editor/src/utils/keyboardOnlyOutline.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZP:()=>__WEBPACK_DEFAULT_EXPORT__,pz:()=>isKeyboardUser});__webpack_require__("./node_modules/react/index.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/react/src/index.ts"),styled_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const KEYBOARD_USER_CLASS="useskeyboard",KEYBOARD_USER_SELECTOR=`.${KEYBOARD_USER_CLASS}`,OutlineStyles=(0,styled_components__WEBPACK_IMPORTED_MODULE_3__.vJ)(["body:not(",") *:focus{outline:none !important;}"],KEYBOARD_USER_SELECTOR),ACCEPTED_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Digit1","Digit2","Digit3"],KeyboardOnlyOutline=()=>{const[usingKeyboard,setUsingKeyboard]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.eJ)(!1),handleKeydown=e=>{!usingKeyboard&&ACCEPTED_KEYS.includes(e.code)&&setUsingKeyboard(!0)},handleMousedown=()=>{usingKeyboard&&setUsingKeyboard(!1)};return(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.d4)((()=>(document.addEventListener("keydown",handleKeydown,!0),document.addEventListener("mousedown",handleMousedown,!0),function cleanup(){document.removeEventListener("keydown",handleKeydown,!0),document.removeEventListener("mousedown",handleMousedown,!0)}))),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.d4)((()=>{document.body.classList.toggle(KEYBOARD_USER_CLASS,usingKeyboard)}),[usingKeyboard]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(OutlineStyles,{})};function isKeyboardUser(){return document.body.classList.contains(KEYBOARD_USER_CLASS)}KeyboardOnlyOutline.displayName="KeyboardOnlyOutline";const __WEBPACK_DEFAULT_EXPORT__=KeyboardOnlyOutline},"./packages/story-editor/src/utils/useApplyTextAutoStyle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_rich_text__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/rich-text/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/elements/src/index.ts"),_app_pageCanvas__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/app/pageCanvas/index.ts"),_components_panels_design_textStyle_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/utils.js");const __WEBPACK_DEFAULT_EXPORT__=function useApplyTextAutoStyle(element,updater){const htmlFormatters=(0,_googleforcreators_rich_text__WEBPACK_IMPORTED_MODULE_0__.l5)(),{setColor}=htmlFormatters,calculateAccessibleTextColors=(0,_app_pageCanvas__WEBPACK_IMPORTED_MODULE_2__.J0)();return async()=>{const autoColor=await calculateAccessibleTextColors(element),{color:fgColor,backgroundColor}=autoColor;if(backgroundColor||fgColor){const highlightProps=backgroundColor?{backgroundColor:{color:backgroundColor},backgroundTextMode:_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.uG.HIGHLIGHT,padding:(0,_components_panels_design_textStyle_utils__WEBPACK_IMPORTED_MODULE_3__.g1)(element)}:null,content=fgColor?setColor(element.content,{color:fgColor}):element.content;updater({...highlightProps,content})}}}},"./packages/story-editor/src/utils/useElementPolygon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var sat__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/sat/SAT.js"),sat__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(sat__WEBPACK_IMPORTED_MODULE_0__),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/units/src/useUnits.ts"),_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/masks/src/index.ts"),_app_story_useStory__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/app/story/useStory.ts"),_app_canvas_useCanvas__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/app/canvas/useCanvas.ts");const __WEBPACK_DEFAULT_EXPORT__=function useElementPolygon(){const nodesById=(0,_app_canvas_useCanvas__WEBPACK_IMPORTED_MODULE_3__.Z)((_ref=>{let{state:{nodesById}}=_ref;return nodesById})),bgElement=(0,_app_story_useStory__WEBPACK_IMPORTED_MODULE_2__.Z)((_ref2=>{let{state}=_ref2;return state.currentPage?.elements?.find((_ref3=>{let{isBackground}=_ref3;return isBackground}))})),{getBoxWithBorder,getBox}=(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_4__.Z)((_ref4=>{let{actions:{getBox,getBoxWithBorder}}=_ref4;return{getBoxWithBorder,getBox}}));return element=>{const bgNode=nodesById[bgElement.id],{x:bgX,y:bgY,width:bgWidth,height:bgHeight}=bgNode.getBoundingClientRect(),bgPolygon=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Box)(new(sat__WEBPACK_IMPORTED_MODULE_0___default().Vector)(bgX,bgY),bgWidth,bgHeight).toPolygon(),elementYOffset=-getBox(bgElement).y;if(element.isBackground)return bgPolygon;const{id,rotationAngle}=element;if(!nodesById[id])return null;const box=(0,_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__.e5)(element)?getBoxWithBorder(element):getBox(element),center=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Vector)(bgPolygon.pos.x+box.x+box.width/2,bgPolygon.pos.y+elementYOffset+box.y+box.height/2),polygon=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Box)(center,box.width,box.height).toPolygon(),offset=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Vector)(-box.width/2,-box.height/2);return polygon.setOffset(offset),polygon.setAngle(rotationAngle*Math.PI/180),polygon}}},"./packages/story-editor/src/utils/useElementsWithLinks.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/elements/src/index.ts"),_app_story__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/app/story/index.ts"),_app_canvas__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/app/canvas/index.ts");const __WEBPACK_DEFAULT_EXPORT__=function useElementsWithLinks(){const{pageAttachmentContainer}=(0,_app_canvas__WEBPACK_IMPORTED_MODULE_3__.$P)((state=>({pageAttachmentContainer:state.state.pageAttachmentContainer}))),{hasLinksInAttachmentArea,hasInvalidLinkSelected,hasPageAttachment,hasElementsInAttachmentArea}=(0,_app_story__WEBPACK_IMPORTED_MODULE_2__.rB)((_ref=>{let{state}=_ref;const elementsWithLinks=state.currentPage?.elements.filter(_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.Zy.linkable)||[],hasPageAttachment=Boolean(state.currentPage?.pageAttachment?.url?.length);return{hasInvalidLinkSelected:Boolean(pageAttachmentContainer&&hasPageAttachment&&state.selectedElements.filter(_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.Zy.linkable).some((element=>(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.CQ)(element)))),hasLinksInAttachmentArea:Boolean(pageAttachmentContainer&&elementsWithLinks.some((element=>(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.CQ)(element,!0)))),hasElementsInAttachmentArea:Boolean(pageAttachmentContainer&&hasPageAttachment&&state.selectedElements.some((element=>(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.CQ)(element,!1)))),hasPageAttachment}}));return{hasLinksInAttachmentArea,hasInvalidLinkSelected,isElementInAttachmentArea:(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.I4)((element=>!!pageAttachmentContainer&&(!!hasPageAttachment&&(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.CQ)(element,!1))),[pageAttachmentContainer,hasPageAttachment]),hasElementsInAttachmentArea}}},"./packages/story-editor/src/utils/useShapeMask.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/masks/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/elements/src/index.ts"),_app__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/app/index.js"),_components_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/components/canvas/useInsertElement.ts"),_objectPick__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/utils/objectPick.ts");const __WEBPACK_DEFAULT_EXPORT__=element=>{const{updateElementById}=(0,_app__WEBPACK_IMPORTED_MODULE_3__.rB)((_ref=>{let{actions}=_ref;return{updateElementById:actions.updateElementById,combineElements:actions.combineElements}})),insertElement=(0,_components_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_4__.Z)(),{isMedia}=(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_2__.Do)(element.type);return{hasShapeMask:isMedia&&element?.mask?.type!==_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__.sn.RECTANGLE,removeShapeMask:(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.I4)((()=>{if(!element)return;const shapeProps=(0,_objectPick__WEBPACK_IMPORTED_MODULE_5__.Z)(element,["x","y","width","height","scale","rotationAngle"]);insertElement("shape",{...shapeProps,mask:{type:element.mask.type}}),updateElementById({elementId:element.id,properties:{mask:{type:_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__.sn.RECTANGLE}}})}),[element,insertElement,updateElementById])}}}}]);