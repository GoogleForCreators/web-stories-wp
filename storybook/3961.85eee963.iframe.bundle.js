"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[3961],{"./packages/design-system/src/components/keyboard/gridview/useGridViewKeys.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>gridview_useGridViewKeys});__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var src=__webpack_require__("./packages/react/src/index.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx");function focusOnPage(page){const button=page?.querySelector("button, a");button&&button.focus()}function getArrowDir(key,pos,neg,isRTL){const rtlDir=isRTL?-1:1;return key===pos?rtlDir:key===neg?-1*rtlDir:0}function getGridColumnAndRowCount(grid,pageCount){let prevX,columns=0;for(const el of grid.children){const{x}=el.getBoundingClientRect();if(void 0!==prevX&&x<prevX)break;prevX=x,columns++}return{rows:Math.ceil(pageCount/columns),columns}}function getRow(index,numColumns){return Math.ceil((index+1)/numColumns)}function getColumn(index,numColumns){return index%numColumns+1}function getIndex({row,column,numRows,numColumns,numItems}){if(row>numRows||row<=0||column>numColumns||column<=0)return-1;const index=numColumns*(row-1)+(column-1);return index>=numItems?numItems-1:index}const gridview_useGridViewKeys=function useGridViewKeys({currentItemId,items,containerRef,gridRef,itemRefs,isRTL,arrangeItem}){const[focusedItemId,setFocusedItemId]=(0,src.J0)(null),itemIds=(0,src.Kr)((()=>items.map((({id})=>id))),[items]);(0,src.vJ)((()=>{setFocusedItemId(currentItemId)}),[currentItemId]),(0,keyboard._h)(containerRef,{key:["up","down","left","right"]},(({key})=>{switch(key){case"ArrowLeft":case"ArrowRight":{const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;const nextIndex=(null!==focusedItemId?itemIds.indexOf(focusedItemId):-1)+dir;if(nextIndex<0||nextIndex===itemIds.length)return;const itemId=itemIds[nextIndex];setFocusedItemId(itemId);const item=itemRefs?.current?.[itemId];focusOnPage(item);break}case"ArrowUp":case"ArrowDown":{if(!gridRef.current)return;const{rows:numRows,columns:numColumns}=getGridColumnAndRowCount(gridRef.current,itemIds.length),currentIndex=null!==focusedItemId?itemIds.indexOf(focusedItemId):-1,dir="ArrowDown"===key?1:-1,nextIndex=getIndex({row:getRow(currentIndex,numColumns)+dir,column:getColumn(currentIndex,numColumns),numRows,numColumns,numItems:itemIds.length});if(nextIndex<0)return;const itemId=itemIds[nextIndex];setFocusedItemId(itemId);const item=itemRefs?.current?.[itemId];focusOnPage(item);break}}}),[focusedItemId,isRTL,itemIds,itemRefs,gridRef,currentItemId]),(0,keyboard._h)(containerRef,{key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(e=>{const{key,shiftKey}=e;let nextIndex,canArrange=!1;switch(e.preventDefault(),key){case"ArrowLeft":case"ArrowRight":{const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;const currentIndex=null!==focusedItemId?itemIds.indexOf(focusedItemId):-1;nextIndex=currentIndex,shiftKey?nextIndex=dir<0?0:itemIds.length-1:nextIndex+=dir,canArrange=nextIndex!==currentIndex&&nextIndex>=0&&nextIndex<=itemIds.length-1;break}case"ArrowUp":case"ArrowDown":{if(!gridRef.current)return;const{rows:numRows,columns:numColumns}=getGridColumnAndRowCount(gridRef.current,itemIds.length),currentIndex=null!==focusedItemId?itemIds.indexOf(focusedItemId):-1,dir="ArrowDown"===key?1:-1;if(nextIndex=getIndex({row:getRow(currentIndex,numColumns)+dir,column:getColumn(currentIndex,numColumns),numRows,numColumns,numItems:itemIds.length}),nextIndex<0)return;break}}canArrange&&void 0!==nextIndex&&arrangeItem&&focusedItemId&&arrangeItem(focusedItemId,nextIndex)}),[currentItemId,itemIds,isRTL,gridRef,itemRefs,focusedItemId,arrangeItem])}},"./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./packages/react/src/index.ts")),styled_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),uuid__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/design-system/node_modules/uuid/dist/esm-browser/v4.js"),_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/i18n/src/i18n.ts"),_theme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/theme/helpers/visuallyHidden.ts"),_theme__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/design-system/src/theme/constants/index.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const TAU=2*Math.PI,AriaOnlyAlert=styled_components__WEBPACK_IMPORTED_MODULE_3__.Ay.span.withConfig({displayName:"loadingSpinner__AriaOnlyAlert",componentId:"sc-10eor9p-0"})(["",""],_theme__WEBPACK_IMPORTED_MODULE_4__.Q),Container=styled_components__WEBPACK_IMPORTED_MODULE_3__.Ay.div.withConfig({displayName:"loadingSpinner__Container",componentId:"sc-10eor9p-1"})(["position:relative;height:","px;width:","px;color:",";"],(({animationSize})=>animationSize),(({animationSize})=>animationSize),(({theme})=>theme.colors.interactiveBg.brandNormal)),Circle=styled_components__WEBPACK_IMPORTED_MODULE_3__.Ay.div.withConfig({displayName:"loadingSpinner__Circle",componentId:"sc-10eor9p-2"})(["position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) ",";height:","px;width:","px;background-color:",";border-radius:",";animation-name:",";animation-fill-mode:both;animation-duration:","s;animation-iteration-count:infinite;animation-timing-function:",";"],(({$position:{x,y}})=>`translate(${x}px, ${y}px)`),(({circleSize})=>circleSize),(({circleSize})=>circleSize),(({theme})=>theme.colors.interactiveBg.brandNormal),(({theme})=>theme.borders.radius.round),(({circleIndex,numCircles})=>(0,styled_components__WEBPACK_IMPORTED_MODULE_3__.i7)(["0%{opacity:1}","{opacity:1}","{opacity:0.3}","{opacity:1}"],100*circleIndex/numCircles+"%",100*(circleIndex+1)/numCircles+"%",100*(circleIndex+1)/numCircles+1+"%")),.85,_theme__WEBPACK_IMPORTED_MODULE_5__.U.inOutQuad);const __WEBPACK_DEFAULT_EXPORT__=function LoadingSpinner({animationSize=95,circleSize=12,loadingMessage=(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_6__.__)("Loading","web-stories"),numCircles=11,...props}){const ids=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.Kr)((()=>Array.from({length:numCircles}).fill(1).map((()=>(0,uuid__WEBPACK_IMPORTED_MODULE_7__.A)()))),[numCircles]);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(Container,_extends({animationSize},props),loadingMessage&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(AriaOnlyAlert,{role:"status"},loadingMessage),ids.map(((id,index)=>{const angle=((index,numCircles)=>TAU*index/numCircles)(index,numCircles),position=((angle,animationSize)=>{const radius=animationSize/2,x=Math.sin(angle)*radius,y=-Math.cos(angle)*radius;return{x:x.toFixed(1),y:y.toFixed(1)}})(angle,animationSize);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(Circle,{key:id,circleIndex:index,circleSize,numCircles,$position:position})})))}},"./packages/media/src/formatMsToHMS.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _formatDuration__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/media/src/formatDuration.ts");const __WEBPACK_DEFAULT_EXPORT__=function formatMsToHMS(ms){if(!ms)return"00:00:00";let seconds=ms/1e3;const hours=Math.floor(seconds/3600);seconds%=3600;const minutes=Math.floor(seconds/60);return seconds%=60,`${(0,_formatDuration__WEBPACK_IMPORTED_MODULE_0__.A)(hours)}:${(0,_formatDuration__WEBPACK_IMPORTED_MODULE_0__.A)(minutes)}:${(0,_formatDuration__WEBPACK_IMPORTED_MODULE_0__.A)(seconds)}`}},"./packages/story-editor/src/app/highlights/styles.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var polished__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),styled_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/design-system/src/theme/theme.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts");const flash=(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.i7)(["50%{background-color:",";}"],(0,polished__WEBPACK_IMPORTED_MODULE_1__.B3)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.w.colors.standard.white,.3)),FLASH=(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.AH)(["background-color:",";animation:"," 0.3s ease-in-out 2;"],(0,polished__WEBPACK_IMPORTED_MODULE_1__.B3)(_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_2__.w.colors.standard.white,0),flash),__WEBPACK_DEFAULT_EXPORT__={OUTLINE:(0,styled_components__WEBPACK_IMPORTED_MODULE_0__.AH)(["",";"],_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_3__.g),FLASH}},"./packages/story-editor/src/app/story/utils/isEmptyStory.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/elements/src/index.ts");const __WEBPACK_DEFAULT_EXPORT__=pages=>{if(!(1===pages.length))return!1;if(!(1===pages[0].elements?.length))return!1;if(!pages[0].elements[0].isDefaultBackground)return!1;const hasPageAttachment=pages[0].pageAttachment?.url;if(hasPageAttachment)return!1;return!(!("color"in pages[0].backgroundColor)||!(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.bN)(_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.jt.color,pages[0].backgroundColor.color))}},"./packages/story-editor/src/components/canvas/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>canvas_canvas,dr:()=>useInsertElement.A,On:()=>canvas_useInsertTextSet});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),src=__webpack_require__("./packages/react/src/index.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),constants=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./packages/story-editor/src/constants/index.ts")),directionAware=__webpack_require__("./packages/story-editor/src/components/directionAware/index.js"),floatingMenu_constants=__webpack_require__("./packages/story-editor/src/components/floatingMenu/constants.js"),menu=__webpack_require__("./packages/story-editor/src/components/floatingMenu/menu.js");const floatingMenu_layer=function FloatingMenuLayer(){const{setMoveableMount,isEyedropperActive,floatingMenuPosition,displayFloatingMenu}=(0,app.yu)((({actions,state})=>({setMoveableMount:actions.setMoveableMount,isEyedropperActive:state.isEyedropperActive,floatingMenuPosition:state.floatingMenuPosition,displayFloatingMenu:state.displayFloatingMenu}))),{workspaceWidth,workspaceHeight}=(0,app.gK)((({state:{workspaceWidth,workspaceHeight}})=>({workspaceWidth,workspaceHeight}))),{selectedElementType,selectionIdentifier}=(0,app.P3)((({state:{selectedElements}})=>({selectedElementType:1!==selectedElements.length||selectedElements[0].isBackground?selectedElements.length>1?floatingMenu_constants.$7.MULTIPLE:floatingMenu_constants.$7.NONE:selectedElements[0]?.type,selectionIdentifier:selectedElements.map((({id})=>id)).join("")}))),isAnythingTransforming=(0,app.Gy)((({state})=>state.isAnythingTransforming)),[moveable,setMoveable]=(0,src.J0)(null),menuRef=(0,src.li)(),workspaceSize=(0,src.li)(),[isDismissed,setDismissed]=(0,src.J0)(!1),handleDismiss=(0,src.hb)((()=>setDismissed(!0)),[]);(0,src.vJ)((()=>setDismissed(!1)),[selectionIdentifier]),(0,src.vJ)((()=>(setMoveableMount((()=>setMoveable)),()=>setMoveableMount(null))),[setMoveableMount]),(0,src.vJ)((()=>{setDismissed(!!isEyedropperActive)}),[isEyedropperActive]),(0,src.vJ)((()=>{workspaceSize.current={width:workspaceWidth,height:workspaceHeight}}),[workspaceWidth,workspaceHeight]);const hasMenu=(0,floatingMenu_constants.iN)(selectedElementType)&&!isDismissed&&moveable&&!(!1===displayFloatingMenu);return(0,src.vJ)((()=>{const menu=menuRef.current;if(!menu||!moveable)return;const updatePosition=()=>{const frameRect=moveable.getRect(),{width,height}=workspaceSize.current;if(floatingMenuPosition===floatingMenu_constants.Vd.TOP)menu.style.left=`clamp(0px, ${width/2}px - (var(--width) / 2), ${width}px - var(--width))`,menu.style.top=`clamp(0px, ${constants.uF}px, ${height}px - var(--height))`;else{const centerX=frameRect.left+frameRect.width/2;menu.style.left=`clamp(0px, ${centerX}px - (var(--width) / 2), ${width}px - var(--width))`;const bottomX=frameRect.top+frameRect.height+constants.Bt;menu.style.top=`clamp(0px, ${bottomX}px, ${height}px - var(--height))`}};updatePosition();const observer=new MutationObserver(updatePosition),node=document.querySelector(".moveable-control-box");return observer.observe(node,{attributes:!0,subtree:!0,attributeFilter:["style"]}),()=>observer.disconnect()}),[moveable,hasMenu,floatingMenuPosition]),!!hasMenu&&react.createElement(directionAware.A,null,react.createElement(menu.A,{ref:menuRef,handleDismiss,selectedElementType,selectionIdentifier,visuallyHidden:isAnythingTransforming}))};var mediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/index.js"),keyboard=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.find.js"),__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx")),moveable_src=__webpack_require__("./packages/moveable/src/index.ts"),elements_src=__webpack_require__("./packages/elements/src/index.ts"),zIndex=(__webpack_require__("./packages/story-editor/src/propTypes.js"),__webpack_require__("./packages/story-editor/src/constants/zIndex.ts")),useVideoTrim=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoTrim.js"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),getVideoLengthDisplay=__webpack_require__("./packages/media/src/getVideoLengthDisplay.ts"),useLayout=__webpack_require__("./packages/story-editor/src/app/layout/useLayout.ts"),useFocusTrapping=__webpack_require__("./packages/story-editor/src/utils/useFocusTrapping.js");var getMediaSizePositionProps=__webpack_require__("./packages/media/src/getMediaSizePositionProps.ts"),preloadVideo=__webpack_require__("./packages/media/src/preloadVideo.ts"),seekVideo=__webpack_require__("./packages/media/src/seekVideo.ts");const CACHE=new Map;const videoTrim_generateVideoStrip=async function generateVideoStrip(element,resource,stripWidth,stripHeight){const{width:frameWidth,height:frameHeight,scale,focalX,focalY,flip}=element,{src,length}=resource,cacheKey=JSON.stringify([src,stripWidth,stripHeight,scale,focalX,focalY,flip,frameWidth,frameHeight]);if(CACHE.has(cacheKey))return CACHE.get(cacheKey);const stripFrameHeight=stripHeight,stripFrameWidth=stripFrameHeight/frameHeight*frameWidth,frameCount=Math.ceil(stripWidth/stripFrameWidth),actualStripFrameWidth=stripWidth/frameCount,actualFrameWidth=actualStripFrameWidth/stripFrameWidth*frameWidth,{width:videoWidth,height:videoHeight,offsetX,offsetY}=(0,getMediaSizePositionProps.A)(resource,actualFrameWidth,frameHeight,scale,flip?.horizontal?100-focalX:focalX,flip?.vertical?100-focalY:focalY),frameDistance=length/(frameCount-1),video=await(0,preloadVideo.A)(src);video.width=videoWidth,video.height=videoHeight,await(0,seekVideo.A)(video,1e-6);const canvas=document.createElement("canvas");canvas.width=stripWidth,canvas.height=stripHeight;const ctx=canvas.getContext("2d");if(!ctx)return Promise.resolve(null);let timeOffset=0,frame=0;const grabFrame=async()=>{await(0,seekVideo.A)(video,timeOffset);const dx=frame*actualStripFrameWidth;return(flip.vertical||flip.horizontal)&&(ctx.translate(dx+actualStripFrameWidth/2,stripFrameHeight/2),ctx.scale(flip.horizontal?-1:1,flip.vertical?-1:1),ctx.translate(-(dx+actualStripFrameWidth/2),-stripFrameHeight/2)),ctx.drawImage(video,offsetX,offsetY,actualFrameWidth,frameHeight,dx,0,actualStripFrameWidth,stripFrameHeight),ctx.setTransform(1,0,0,1,0,0),frame+=1,frame===frameCount?Promise.resolve():(timeOffset+=frameDistance,grabFrame())};return grabFrame().then((()=>{const finalStrip=canvas.toDataURL();return CACHE.set(cacheKey,finalStrip),finalStrip}))};const videoTrim_useRailBackground=function useRailBackground(isReady,videoData,railWidth){const[railBackgroundImage,setRailBackgroundImage]=(0,src.J0)(null);return(0,src.vJ)((()=>{if(!isReady)return;const{element,resource}=videoData;videoTrim_generateVideoStrip(element,resource,railWidth,36).then(setRailBackgroundImage)}),[isReady,videoData,railWidth]),railBackgroundImage};var noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const Thumb=styled_components_browser_esm.Ay.button.withConfig({displayName:"slider__Thumb",componentId:"sc-50zvue-0"})(["position:absolute;padding:0;"]);function getPageX(evt){return evt.pageX||evt.clientX}const slider=function Slider({railWidth,min,max,step,minorStep=null,value=0,onChange=noop.l,getValueText=null,onPointerDown=noop.l,onNudge=noop.l,...rest}){const ref=(0,src.li)(),handlePointerDown=(0,src.hb)((downEvent=>{downEvent.preventDefault(),downEvent.stopPropagation(),ref.current.focus(),onPointerDown?.();const handlePointerMove=event=>{const deltaX=getPageX(event)-getPageX(downEvent);onChange(value+deltaX/railWidth*(max-min)),event.preventDefault(),event.stopPropagation()},handlePointerUp=()=>{document.removeEventListener("pointermove",handlePointerMove),document.removeEventListener("pointerup",handlePointerUp)};return document.addEventListener("pointermove",handlePointerMove),document.addEventListener("pointerup",handlePointerUp),handlePointerUp}),[value,max,min,onChange,railWidth,onPointerDown]),handleNudge=(0,src.hb)((delta=>{onChange(value+delta),onNudge?.()}),[onChange,onNudge,value]);(0,keyboard._h)(ref,"left",(()=>handleNudge(-step)),[handleNudge,step]),(0,keyboard._h)(ref,"shift+left",(()=>handleNudge(-minorStep)),[handleNudge,minorStep]),(0,keyboard._h)(ref,"right",(()=>handleNudge(step)),[handleNudge,step]),(0,keyboard._h)(ref,"shift+right",(()=>handleNudge(minorStep)),[handleNudge,minorStep]);const sliderStyle={left:`${((value-min)/(max-min)*railWidth).toFixed(2)}px`};return react.createElement(Thumb,_extends({ref,onPointerDown:handlePointerDown,style:sliderStyle,role:"slider","aria-valuemin":min,"aria-valuemax":max,"aria-valuenow":value,"aria-valuetext":getValueText?.(value)},rest))};function currentTime_extends(){return currentTime_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},currentTime_extends.apply(this,arguments)}const StyledSlider=(0,styled_components_browser_esm.Ay)(slider).withConfig({displayName:"currentTime__StyledSlider",componentId:"sc-tf91kz-0"})(["top:-3px;bottom:-3px;width:6px;margin-left:-3px;border-radius:6px;border-width:0;background-color:",";box-shadow:0px 1px 2px rgba(60,64,67,0.3),0px 1px 3px 1px rgba(60,64,67,0.15);"],(({theme})=>theme.colors.interactiveBg.primaryNormal));const currentTime=function CurrentTime(props){const currentTime=(0,useVideoTrim.A)((({state:{currentTime}})=>currentTime));return react.createElement(StyledSlider,currentTime_extends({"aria-label":(0,i18n.__)("Current time","web-stories"),value:currentTime,disabled:!0},props))};var typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts");const Menu=styled_components_browser_esm.Ay.aside.withConfig({displayName:"trimmerComponents__Menu",componentId:"sc-1vmlktu-0"})(["display:flex;justify-content:center;align-items:flex-start;height:","px;gap:14px;"],40),RailWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"trimmerComponents__RailWrapper",componentId:"sc-1vmlktu-1"})(["display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-end;"]),Rail=styled_components_browser_esm.Ay.div.withConfig({displayName:"trimmerComponents__Rail",componentId:"sc-1vmlktu-2"})(["position:relative;width:","px;height:","px;border-radius:4px;border:1px solid ",";background-color:",";"],(({width})=>width),36,(({theme})=>theme.colors.standard.white),(({theme})=>theme.colors.standard.white));function Duration({children}){return react.createElement(typography_text.E.Span,{size:types.$.XSmall},children)}const Handle=(0,styled_components_browser_esm.Ay)(slider).withConfig({displayName:"trimmerComponents__Handle",componentId:"sc-1vmlktu-3"})(["top:6px;bottom:6px;width:6px;margin-left:-3px;border-radius:6px;background-color:",";border:1px solid ",";box-shadow:0px 1px 2px rgba(60,64,67,0.3),0px 1px 3px 1px rgba(60,64,67,0.15);cursor:col-resize;&:focus{border-color:",";}&:focus-visible{outline:none !important;}"],(({theme})=>theme.colors.bg.primary),(({theme})=>theme.colors.border.defaultNormal),(({theme})=>theme.colors.border.focus)),SVG=styled_components_browser_esm.Ay.svg.withConfig({displayName:"trimmerComponents__SVG",componentId:"sc-1vmlktu-4"})(["position:absolute;top:-1px;"]),ButtonWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"trimmerComponents__ButtonWrapper",componentId:"sc-1vmlktu-5"})(["flex-grow:1;flex-basis:100px;display:flex;justify-content:",";"],(({isStart})=>isStart?"flex-end":"flex-start"));function Scrim({width,isLeftAligned=!1}){const floatStyle=isLeftAligned?{left:"-1px"}:{right:"-1px"},path=isLeftAligned?`M 4 0 h ${width} a 4 4 0 0 0 -4 4 v 28 a 4 4 0 0 0 4 4 h -${width} a 4 4 0 0 1 -4 -4 v -28 a 4 4 0 0 1 4 -4 Z`:`M 0 0 h ${width} a 4 4 0 0 1 4 4 v 28 a 4 4 0 0 1 -4 4 h -${width} a 4 4 0 0 0 4 -4 v -28 a 4 4 0 0 0 -4 -4 Z`;return react.createElement(SVG,{style:{width:`${width+4}px`,...floatStyle},viewBox:`0 0 ${width+4} 36`},react.createElement("path",{stroke:"transparent",fill:"black",fillOpacity:"0.5",d:path}))}function videoTrimmer_extends(){return videoTrimmer_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},videoTrimmer_extends.apply(this,arguments)}const videoTrimmer=function VideoTrimmer(){const{startOffset,endOffset,maxOffset,setStartOffset,setEndOffset,hasChanged,performTrim,setIsDraggingHandles,toggleTrimMode,videoData}=(0,useVideoTrim.A)((({state:{startOffset,endOffset,maxOffset,hasChanged,videoData},actions:{setStartOffset,setEndOffset,performTrim,toggleTrimMode,setIsDraggingHandles}})=>({startOffset,endOffset,maxOffset,setStartOffset,setEndOffset,hasChanged,performTrim,setIsDraggingHandles,toggleTrimMode,videoData}))),{workspaceWidth,pageWidth}=(0,useLayout.A)((({state:{workspaceWidth,pageWidth}})=>({workspaceWidth,pageWidth}))),debouncedNudge=(0,src.YQ)((()=>setIsDraggingHandles(!1)),1e3),menu=(0,src.li)(null);(0,useFocusTrapping.A)({ref:menu});const setCancelRef=(0,src.hb)((node=>{node&&node.focus()}),[]),railWidth=Math.min(pageWidth,workspaceWidth-260),isReady=pageWidth&&maxOffset&&videoData,railBackgroundImage=videoTrim_useRailBackground(isReady,videoData,railWidth),menuProps={ref:menu,"aria-label":(0,i18n.__)("Video trimmer","web-stories")};if(!isReady)return react.createElement(Menu,menuProps);const sliderProps={min:0,max:maxOffset,step:100,minorStep:10,onPointerDown:()=>setIsDraggingHandles(!0),onPointerUp:()=>setIsDraggingHandles(!1),onNudge:()=>{setIsDraggingHandles(!0),debouncedNudge()}};return react.createElement(Menu,menuProps,react.createElement(ButtonWrapper,{isStart:!0},react.createElement(button_button.$,{variant:button_constants.Ak.Rectangle,type:button_constants.VQ.Secondary,size:button_constants.Mp.Small,onClick:toggleTrimMode,ref:setCancelRef},(0,i18n.__)("Cancel","web-stories"))),react.createElement(RailWrapper,null,react.createElement(Rail,{width:railWidth,style:{backgroundImage:railBackgroundImage?`url(${railBackgroundImage})`:void 0}},react.createElement(Scrim,{isLeftAligned:!0,width:startOffset/maxOffset*railWidth}),react.createElement(Scrim,{width:(maxOffset-endOffset)/maxOffset*railWidth}),react.createElement(currentTime,videoTrimmer_extends({railWidth},sliderProps)),react.createElement(Handle,videoTrimmer_extends({railWidth,value:startOffset,"aria-label":(0,i18n.__)("Start offset","web-stories"),onChange:val=>setStartOffset(val)},sliderProps)),react.createElement(Handle,videoTrimmer_extends({railWidth,value:endOffset,"aria-label":(0,i18n.__)("End offset","web-stories"),onChange:val=>setEndOffset(val)},sliderProps))),react.createElement(Duration,null,(0,getVideoLengthDisplay.A)(Math.ceil((endOffset-startOffset)/1e3)))),react.createElement(ButtonWrapper,null,react.createElement(button_button.$,{variant:button_constants.Ak.Rectangle,type:button_constants.VQ.Primary,size:button_constants.Mp.Small,onClick:performTrim,disabled:!hasChanged},(0,i18n.__)("Trim","web-stories"))))};var useUnits=__webpack_require__("./packages/units/src/useUnits.ts"),animation_src=__webpack_require__("./packages/animation/src/index.ts"),element_library_src=__webpack_require__("./packages/element-library/src/index.js"),useCORSProxy=__webpack_require__("./packages/story-editor/src/utils/useCORSProxy.ts");function editElement_extends(){return editElement_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},editElement_extends.apply(this,arguments)}const Z_INDEX_CANVAS={FLOAT_PANEL:11},Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"editElement__Wrapper",componentId:"sc-1w8k2uc-0"})([""," "," "," pointer-events:initial;"],element_library_src.AV,element_library_src.WZ,element_library_src.TH),editElement=(0,src.ph)((0,src.Rf)((function EditElement({element,editWrapper,onResize},ref){const{id,type}=element,{getBox,getBoxWithBorder}=(0,useUnits.A)((state=>({getBox:state.actions.getBox,getBoxWithBorder:state.actions.getBoxWithBorder}))),{getProxiedUrl}=(0,useCORSProxy.A)(),{isRTL,styleConstants:{topOffset}={}}=(0,app.UK)(),{actions:{maybeEnqueueFontStyle}}=(0,app.Ln)(),{updateElementById,deleteSelectedElements}=(0,app.P3)((state=>({updateElementById:state.actions.updateElementById,deleteSelectedElements:state.actions.deleteSelectedElements}))),{isTrimMode,resource,setVideoNode}=(0,useVideoTrim.A)((({state:{isTrimMode,videoData},actions:{setVideoNode}})=>({isTrimMode,setVideoNode,resource:videoData?.resource}))),[localProperties,setLocalProperties]=(0,src.J0)(null),{Edit}=(0,elements_src.zh)(type),elementWithLocal=localProperties?{...element,...localProperties}:element,editBox="text"===type?getBoxWithBorder(elementWithLocal):getBox(elementWithLocal);return react.createElement(Wrapper,editElement_extends({"aria-labelledby":`layer-${id}`},editBox,{ref}),react.createElement(Edit,{element:elementWithLocal,box:editBox,editWrapper,onResize,setLocalProperties,getProxiedUrl,isRTL,topOffset,isTrimMode,resource,setVideoNode,updateElementById,deleteSelectedElements,maybeEnqueueFontStyle,zIndexCanvas:Z_INDEX_CANVAS,scaleMin:animation_src.UD,scaleMax:animation_src.oQ}))})));var generatePatternStyles=__webpack_require__("./packages/patterns/src/generatePatternStyles.ts"),src_constants=__webpack_require__("./packages/units/src/constants.ts"),theme_constants=__webpack_require__("./packages/design-system/src/theme/constants/index.ts");const NAVIGATION_BUTTON_WIDTH=theme_constants.i.ICON_SIZE,NAVIGATION_BUTTON_GUTTER=NAVIGATION_BUTTON_WIDTH+8,FOOTER_BOTTOM_MARGIN=16,KEYBOARD_SHORTCUTS_WIDTH=theme_constants.i.ICON_SIZE+6+2,MAX_MENU_WIDTH=2*(theme_constants.i.LARGE_BUTTON_SIZE+2)+2*KEYBOARD_SHORTCUTS_WIDTH+16+16;const footer_useFooterHeight=function useFooterHeight(){const{carouselState}=(0,app.gK)((({state:{carouselState}})=>({carouselState})));return carouselState===constants.Wc.Closed?52:136};var layout=__webpack_require__("./packages/story-editor/src/app/layout/index.ts");const canvas_usePinchToZoom=function usePinchToZoom({containerRef}){const{zoomLevel,setZoomLevel}=(0,layout.g)((({state:{zoomLevel},actions:{setZoomLevel}})=>({zoomLevel,setZoomLevel}))),handleZoom=(0,src.YQ)((level=>setZoomLevel(level)),25);(0,src.Nf)((()=>{if(!containerRef.current)return;const clampZoomLevel=value=>Math.min(3,Math.max(.25,value-value%.25)),onWheel=e=>{const{ctrlKey,deltaY}=e,node=containerRef.current.childNodes[0];if(ctrlKey&&node.contains(e.target)&&deltaY){handleZoom(clampZoomLevel(deltaY>0?zoomLevel-.25:zoomLevel+.25)),e.preventDefault()}},preventDefault=e=>{containerRef.current.childNodes[0].contains(e.target)&&e.preventDefault()},handleGestureChange=e=>{const node=containerRef.current.childNodes[0],{scale}=e;if(node.contains(e.target)&&scale){handleZoom(clampZoomLevel(scale<1?zoomLevel-.25:zoomLevel+.25)),e.preventDefault()}};return document.addEventListener("wheel",onWheel,{passive:!1}),document.addEventListener("gesturestart",preventDefault),document.addEventListener("gestureend",preventDefault),document.addEventListener("gesturechange",handleGestureChange),()=>{document.removeEventListener("wheel",onWheel,{passive:!1}),document.removeEventListener("gesturestart",preventDefault),document.removeEventListener("gestureend",preventDefault),document.removeEventListener("gesturechange",handleGestureChange)}}),[containerRef,handleZoom,zoomLevel])};function layout_extends(){return layout_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},layout_extends.apply(this,arguments)}const PAGE_NAV_WIDTH=theme_constants.i.LARGE_BUTTON_SIZE+8,PAGE_NAV_GAP=20,LayerGrid=styled_components_browser_esm.Ay.section.withConfig({displayName:"layout__LayerGrid",componentId:"sc-1n0mp4m-0"})(["pointer-events:",";position:absolute;top:0;left:0;right:0;bottom:0;"," display:grid;grid:'h h h h h h h' ","px '. . . t . . .' minmax(","px,1fr) 'p b . c . f n' var(--viewport-height-px) '. . . . . . .' 1fr 'w w w w w w w' ","px '. . . . . . .' ","px / 1fr var(--page-nav-width) var(--page-nav-gap) var(--viewport-width-px) var(--page-nav-gap) var(--page-nav-width) 1fr;height:100%;"],(({pointerEvents})=>pointerEvents),(({zIndex})=>"number"==typeof zIndex?`z-index: ${zIndex};`:""),constants.uF,constants.h1,(({footerHeight})=>footerHeight),FOOTER_BOTTOM_MARGIN),Area=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__Area",componentId:"sc-1n0mp4m-1"})(["pointer-events:",";grid-area:",";overflow:",";position:relative;width:100%;height:100%;",";"],(({pointerEvents})=>pointerEvents),(({area})=>area),(({showOverflow})=>showOverflow?"visible":"hidden"),(({zIndex})=>void 0!==zIndex?`z-index: ${zIndex}`:null)),PageAreaContainer=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"c"}).withConfig({displayName:"layout__PageAreaContainer",componentId:"sc-1n0mp4m-2"})(["position:relative;display:flex;justify-content:",";align-items:",";overflow:",";",""],(({hasHorizontalOverflow})=>hasHorizontalOverflow?"flex-start":"center"),(({hasVerticalOverflow})=>hasVerticalOverflow?"flex-start":"center"),(({showOverflow})=>showOverflow?"visible":"var(--overflow-x) var(--overflow-y)"),(({isControlled,hasVerticalOverflow,hasHorizontalOverflow,showOverflow})=>isControlled&&`\n      overflow: ${showOverflow?"visible":"hidden"};\n      width: calc(\n        100% - ${hasVerticalOverflow?theme_constants.i.SCROLLBAR_WIDTH:0}px\n      );\n      height: calc(\n        100% - ${hasHorizontalOverflow?theme_constants.i.SCROLLBAR_WIDTH:0}px\n      );\n    `)),PageTitleContainer=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"t"}).withConfig({displayName:"layout__PageTitleContainer",componentId:"sc-1n0mp4m-3"})(["position:relative;display:flex;justify-content:center;align-items:center;"]),Layer=(0,src.Rf)((function Layer({children,...rest},ref){const footerHeight=footer_useFooterHeight();return react.createElement(LayerGrid,layout_extends({ref,footerHeight},rest),children)})),PaddedPage=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__PaddedPage",componentId:"sc-1n0mp4m-4"})(["padding:calc(0.5 * var(--page-padding-px));"]),PageClip=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__PageClip",componentId:"sc-1n0mp4m-5"})(["",""],(({hasHorizontalOverflow,hasVerticalOverflow})=>(hasHorizontalOverflow||hasVerticalOverflow)&&`\n      overflow: hidden;\n      width: ${hasHorizontalOverflow?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${theme_constants.i.SCROLLBAR_WIDTH}px)`};\n      flex-basis: ${hasHorizontalOverflow?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${theme_constants.i.SCROLLBAR_WIDTH}px)`};\n      height: ${hasVerticalOverflow?"calc(var(--fullbleed-height-px) + var(--page-padding-px))":`calc(var(--viewport-height-px) - ${theme_constants.i.SCROLLBAR_WIDTH}px)`};\n      flex-shrink: 0;\n      flex-grow: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    `)),FullbleedContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__FullbleedContainer",componentId:"sc-1n0mp4m-6"})([""," overflow:visible;position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;border-radius:5px;",";",""],(({background})=>(0,generatePatternStyles.A)(background)),(({isControlled})=>isControlled&&"\n      left: var(--scroll-left-px);\n      top: var(--scroll-top-px);\n    "),(({isBackgroundSelected,theme})=>isBackgroundSelected&&`\n      &:before {\n        content: '';\n        position: absolute;\n        top: -4px;\n        left: -4px;\n        right: -4px;\n        bottom: -4px;\n        border: ${theme.colors.border.selection} 1px solid;\n        border-radius: ${theme.borders.radius.medium};\n      }\n    `)),PageAreaWithoutOverflow=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__PageAreaWithoutOverflow",componentId:"sc-1n0mp4m-7"})(["overflow:",";position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;"],(({showOverflow})=>showOverflow?"initial":"hidden")),PageAreaSafeZone=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__PageAreaSafeZone",componentId:"sc-1n0mp4m-8"})(["width:var(--page-width-px);height:var(--page-height-px);overflow:visible;position:relative;"]),HeadArea=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"h"}).withConfig({displayName:"layout__HeadArea",componentId:"sc-1n0mp4m-9"})([""]),NavArea=((0,styled_components_browser_esm.Ay)(Area).attrs({area:"m"}).withConfig({displayName:"layout__MenuArea",componentId:"sc-1n0mp4m-10"})([""]),(0,styled_components_browser_esm.Ay)(Area).withConfig({displayName:"layout__NavArea",componentId:"sc-1n0mp4m-11"})(["display:flex;align-items:center;justify-content:center;"])),NavPrevArea=(0,styled_components_browser_esm.Ay)(NavArea).attrs({area:"b"}).withConfig({displayName:"layout__NavPrevArea",componentId:"sc-1n0mp4m-12"})([""]),NavNextArea=(0,styled_components_browser_esm.Ay)(NavArea).attrs({area:"f"}).withConfig({displayName:"layout__NavNextArea",componentId:"sc-1n0mp4m-13"})([""]),PageBeforeArea=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"p"}).withConfig({displayName:"layout__PageBeforeArea",componentId:"sc-1n0mp4m-14"})([""]),PageAfterArea=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"n"}).withConfig({displayName:"layout__PageAfterArea",componentId:"sc-1n0mp4m-15"})([""]),PageMenuArea=styled_components_browser_esm.Ay.div.withConfig({displayName:"layout__PageMenuArea",componentId:"sc-1n0mp4m-16"})(["grid-area:c;position:absolute;right:calc(-24px + var(--page-padding-px));top:calc(0.5 * var(--page-padding-px));min-height:calc(100% - var(--page-padding-px));"]),FooterArea=(0,styled_components_browser_esm.Ay)(Area).attrs({area:"w",showOverflow:!0}).withConfig({displayName:"layout__FooterArea",componentId:"sc-1n0mp4m-17"})([""]);const PageArea=(0,src.Rf)((function PageArea({children,fullbleedRef:_fullbleedRef=null,fullBleedContainerLabel=(0,i18n.__)("Fullbleed area","web-stories"),overlay=[],background,isControlled=!1,className="",showOverflow=!1,isBackgroundSelected=!1,pageAreaRef=(0,src._3)(),withSafezone=!0,...rest},ref){const internalFullblledRef=(0,src.li)(),fullbleedRef=_fullbleedRef||internalFullblledRef,{hasVerticalOverflow,hasHorizontalOverflow,zoomSetting,scrollLeft,scrollTop}=(0,app.gK)((({state:{hasVerticalOverflow,hasHorizontalOverflow,zoomSetting,scrollLeft,scrollTop}})=>({hasVerticalOverflow,hasHorizontalOverflow,zoomSetting,scrollLeft,scrollTop}))),scroll=(0,src.li)();scroll.current={top:scrollTop,left:scrollLeft},(0,src.vJ)((()=>{isControlled||(fullbleedRef.current.scrollTop=scroll.current.top,fullbleedRef.current.scrollLeft=scroll.current.left)}),[isControlled,zoomSetting,fullbleedRef]);const paddedRef=(0,src.li)(null);return canvas_usePinchToZoom({containerRef:paddedRef}),react.createElement(PageAreaContainer,layout_extends({showOverflow,isControlled,hasHorizontalOverflow,hasVerticalOverflow,className,"data-scroll-container":!0},rest),react.createElement(PageClip,{hasHorizontalOverflow,hasVerticalOverflow},react.createElement(PaddedPage,{ref:paddedRef},react.createElement(FullbleedContainer,{"aria-label":fullBleedContainerLabel,role:"region",ref:fullbleedRef,"data-testid":"fullbleed",background,isControlled,isBackgroundSelected},react.createElement(PageAreaWithoutOverflow,{ref:pageAreaRef,showOverflow},withSafezone?react.createElement(PageAreaSafeZone,{ref,"data-testid":"safezone"},children):children,overlay)))))}));var useFocusCanvas=__webpack_require__("./packages/story-editor/src/components/canvas/useFocusCanvas.ts"),classnames=__webpack_require__("./packages/story-editor/node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),transform_src=__webpack_require__("./packages/transform/src/index.ts"),masks_src=__webpack_require__("./packages/masks/src/index.ts"),objectWithout=__webpack_require__("./packages/story-editor/src/utils/objectWithout.ts"),useSnapping=__webpack_require__("./packages/story-editor/src/components/canvas/utils/useSnapping.js");const utils_useUpdateSelectionRectangle=function useUpdateSelectionRectangle(moveableRef,dependencies=[]){(0,src.vJ)((()=>{let mounted=!0;const update=()=>{mounted&&moveableRef.current?.updateRect?.()};update();const timeout=setTimeout(update);return()=>{mounted=!1,clearTimeout(timeout)}}),dependencies)};const canvas_useWindowResizeHandler=function useWindowResizeHandler(ref){(0,src.vJ)((()=>{const handleUpdateMoveable=()=>ref.current?.updateRect();return window.addEventListener("resize",handleUpdateMoveable),()=>{window.removeEventListener("resize",handleUpdateMoveable)}}),[ref])};var dropTargets=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),isTargetOutOfContainer=__webpack_require__("./packages/story-editor/src/utils/isTargetOutOfContainer.ts");const utils_useElementOutOfCanvas=function useElementOutOfCanvas(){const{deleteSelectedElements}=(0,app.P3)((state=>({deleteSelectedElements:state.actions.deleteSelectedElements}))),{clearTransforms}=(0,app.Gy)((state=>({clearTransforms:state.actions.clearTransforms}))),{fullbleedContainer}=(0,app.yu)((({state:{fullbleedContainer}})=>({fullbleedContainer})));return{handleElementOutOfCanvas:target=>!!(0,isTargetOutOfContainer.A)(target,fullbleedContainer)&&(deleteSelectedElements(),clearTransforms(),!0)}};var localStore=__webpack_require__("./packages/design-system/src/utils/localStore.ts"),useSnackbar=__webpack_require__("./packages/design-system/src/contexts/snackbar/useSnackbar.ts"),SAT=__webpack_require__("./node_modules/sat/SAT.js"),SAT_default=__webpack_require__.n(SAT),useElementPolygon=__webpack_require__("./packages/story-editor/src/utils/useElementPolygon.js");const utils_useFullbleedMediaAsBackground=function useFullbleedMediaAsBackground(){const[isBackgroundSnackbarMessageDismissed,setIsBackgroundSnackbarMessageDismissed]=(0,src.J0)(localStore.x.getItemByKey(localStore.$.BACKGROUND_IS_SET_DIALOG_DISMISSED)),{setBackgroundElement,isDefaultBackground}=(0,app.P3)((state=>({setBackgroundElement:state.actions.setBackgroundElement,isDefaultBackground:state.state.currentPage?.elements[0]?.isDefaultBackground}))),{fullbleedContainer}=(0,app.yu)((({state:{fullbleedContainer}})=>({fullbleedContainer}))),{clearTransforms}=(0,app.Gy)((state=>({clearTransforms:state.actions.clearTransforms}))),{showSnackbar}=(0,useSnackbar.d)(),getElementPolygon=(0,useElementPolygon.A)();return{handleFullbleedMediaAsBackground:selectedElement=>{if(isDefaultBackground&&elements_src.YO.includes(selectedElement.type)){const elPolygon=getElementPolygon(selectedElement),fullbleedBox=fullbleedContainer.getBoundingClientRect(),bgPolygon=new(SAT_default().Box)(new(SAT_default().Vector)(fullbleedBox.x+2,fullbleedBox.y+2),fullbleedBox.width-4,fullbleedBox.height-4).toPolygon(),response=new(SAT_default().Response);SAT_default().testPolygonPolygon(elPolygon,bgPolygon,response),response.bInA&&setBackgroundElement({elementId:selectedElement.id}),isBackgroundSnackbarMessageDismissed||(showSnackbar({message:(0,i18n.__)("Full bleed images and videos are automatically set as background. Double click to scale and position at any time.","web-stories"),dismissible:!0}),localStore.x.setItemByKey(localStore.$.BACKGROUND_IS_SET_DIALOG_DISMISSED,!0),setIsBackgroundSnackbarMessageDismissed(!0)),clearTransforms()}}}};const useDrag=function useSingleSelectionDrag({setIsDragging,resetMoveable,selectedElement,setTransformStyle,frame}){const{isDropSource,handleDrag,handleDrop,setDraggingResource}=(0,dropTargets.h)((({actions:{handleDrag,handleDrop,isDropSource,setDraggingResource}})=>({handleDrag,handleDrop,setDraggingResource,isDropSource}))),{handleElementOutOfCanvas}=utils_useElementOutOfCanvas(),{handleFullbleedMediaAsBackground}=utils_useFullbleedMediaAsBackground(),{updateSelectedElements}=(0,app.P3)((state=>({updateSelectedElements:state.actions.updateSelectedElements}))),{editorToDataX,editorToDataY}=(0,useUnits.A)((({actions:{editorToDataX,editorToDataY}})=>({editorToDataX,editorToDataY}))),resetDragging=(0,src.T0)((target=>{setIsDragging(!1),setDraggingResource(null),resetMoveable(target)}),[setIsDragging,setDraggingResource,resetMoveable]);return{onDrag:({target,beforeTranslate,clientX,clientY})=>{setIsDragging(!0),isDropSource(selectedElement.type)&&setDraggingResource(selectedElement.resource),frame.translate=beforeTranslate,setTransformStyle(target,frame),isDropSource(selectedElement.type)&&handleDrag(selectedElement.resource,clientX,clientY,selectedElement.id)},throttleDrag:0,onDragStart:({set})=>{set(frame.translate)},onDragEnd:({target,isDrag})=>{if(!isDrag)return!1;if(handleElementOutOfCanvas(target))return setIsDragging(!1),void setDraggingResource(null);const roundToZero=num=>Math.abs(num)<=1?0:num,[deltaX,deltaY]=frame.translate;let properties={};0===deltaX&&0===deltaY||(properties={x:roundToZero(selectedElement.x+editorToDataX(deltaX)),y:roundToZero(selectedElement.y+editorToDataY(deltaY))},updateSelectedElements({properties}),isDropSource(selectedElement.type)&&handleDrop(selectedElement.resource,selectedElement.id)),resetDragging(target),handleFullbleedMediaAsBackground({...selectedElement,...properties})}}},EMPTY_HANDLES=[],VERTICAL_HANDLES=["n","s"],HORIZONTAL_HANDLES=["e","w"],DIAGONAL_HANDLES=["nw","ne","sw","se"];function getRenderDirections({vertical,horizontal,diagonal}){return[...vertical?VERTICAL_HANDLES:EMPTY_HANDLES,...horizontal?HORIZONTAL_HANDLES:EMPTY_HANDLES,...diagonal?DIAGONAL_HANDLES:EMPTY_HANDLES]}const useResize=function useSingleSelectionResize({resetMoveable,selectedElement,setTransformStyle,frame,isEditMode,pushTransform,classNames,forceLockRatio}){const{updateSelectedElements}=(0,app.P3)((state=>({updateSelectedElements:state.actions.updateSelectedElements}))),{handleElementOutOfCanvas}=utils_useElementOutOfCanvas(),{handleFullbleedMediaAsBackground}=utils_useFullbleedMediaAsBackground(),{editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}=(0,useUnits.A)((({actions:{editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}})=>({editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}))),{lockAspectRatio:elementLockRatio,type,border}=selectedElement,isText="text"===type,[isResizingFromCorner,setIsResizingFromCorner]=(0,src.J0)(!0),lockAspectRatio=!isText&&(forceLockRatio||elementLockRatio)||isText&&isResizingFromCorner,{resizeRules,updateForResizeEvent}=(0,elements_src.zh)(type),minWidth=dataToEditorX(resizeRules.minWidth),minHeight=dataToEditorY(resizeRules.minHeight),aspectRatio=selectedElement.width/selectedElement.height,{left=0,right=0,top=0,bottom=0}=border||{},visuallyHideHandles=selectedElement.width<=resizeRules.minWidth||selectedElement.height<=resizeRules.minHeight;return{onResize:({target,direction,width,height,drag})=>{let newWidth=width-(left+right),newHeight=height-(top+bottom),updates=null;lockAspectRatio?(newWidth<minWidth&&(newWidth=minWidth,newHeight=newWidth/aspectRatio),newHeight<minHeight&&(newHeight=minHeight,newWidth=minHeight*aspectRatio)):(newHeight=Math.max(newHeight,minHeight),newWidth=Math.max(newWidth,minWidth)),updateForResizeEvent&&(updates=updateForResizeEvent(selectedElement,direction,editorToDataX(newWidth,!1),editorToDataY(newHeight,!1))),updates&&updates.height&&(newHeight=dataToEditorY(updates.height)),updates&&updates.marginOffset&&(target.querySelector(".syncMargin").style.margin=-dataToEditorY(updates.marginOffset)/2+"px 0");const frameWidth=newWidth+left+right,frameHeight=newHeight+top+bottom;target.style.width=`${frameWidth}px`,target.style.height=`${frameHeight}px`,frame.direction=direction,frame.resize=[frameWidth,frameHeight],frame.translate=drag.beforeTranslate,frame.updates=updates,setTransformStyle(target,frame)},onResizeStart:({setOrigin,dragStart,direction})=>{setOrigin(["%","%"]),dragStart&&dragStart.set(frame.translate);const newResizingMode=0!==direction[0]&&0!==direction[1];isResizingFromCorner!==newResizingMode&&isText&&setIsResizingFromCorner(newResizingMode),isEditMode&&pushTransform(selectedElement.id,frame)},onResizeEnd:({target})=>{if(handleElementOutOfCanvas(target))return;const[editorWidth,editorHeight]=frame.resize;let properties={};if(0!==editorWidth&&0!==editorHeight){const{direction}=frame,[deltaX,deltaY]=frame.translate,newWidth=editorToDataX(editorWidth-(left+right)),newHeight=editorToDataY(editorHeight-(top+bottom));properties={width:newWidth,height:newHeight,x:selectedElement.x+editorToDataX(deltaX),y:selectedElement.y+editorToDataY(deltaY)},updateForResizeEvent&&Object.assign(properties,updateForResizeEvent(selectedElement,direction,newWidth,newHeight)),updateSelectedElements({properties})}setIsResizingFromCorner(!0),resetMoveable(target),handleFullbleedMediaAsBackground({...selectedElement,...properties})},keepRatio:lockAspectRatio,renderDirections:getRenderDirections(resizeRules),className:classnames_default()(classNames,{"visually-hide-handles":visuallyHideHandles})}};const utils_normalizeRotationDegrees=function normalizeRotationDegrees(degrees){return(degrees%360+360)%360};const useRotate=function useSingleSelectionRotate({selectedElement,isEditMode,pushTransform,frame,setTransformStyle,resetMoveable,throttleRotation}){const{updateSelectedElements}=(0,app.P3)((state=>({updateSelectedElements:state.actions.updateSelectedElements}))),{handleElementOutOfCanvas}=utils_useElementOutOfCanvas();return{throttleRotate:throttleRotation?30:0,onRotate:({target,beforeRotate})=>{frame.rotate=utils_normalizeRotationDegrees(beforeRotate),setTransformStyle(target,frame)},onRotateEnd:({target})=>{if(handleElementOutOfCanvas(target))return;const properties={rotationAngle:Math.round(frame.rotate)};updateSelectedElements({properties}),resetMoveable(target)},onRotateStart:({set})=>{isEditMode&&pushTransform(selectedElement.id,frame),set(frame.rotate)}}};function singleSelectionMoveable_extends(){return singleSelectionMoveable_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},singleSelectionMoveable_extends.apply(this,arguments)}const singleSelectionMoveable=(0,src.Rf)((function SingleSelectionMoveable({selectedElement,targetEl,pushEvent,isEditMode,...props},ref){const moveable=(0,src.li)(null),[isDragging,setIsDragging]=(0,src.J0)(!1),nodesById=(0,app.yu)((({state})=>state.nodesById)),getBox=(0,useUnits.A)((({actions})=>actions.getBox)),pushTransform=(0,transform_src.Gy)((({actions})=>actions.pushTransform)),{zoomSetting,scrollLeft,scrollTop}=(0,app.gK)((({state})=>({zoomSetting:state.zoomSetting,scrollLeft:state.scrollLeft,scrollTop:state.scrollTop}))),{isBackground,isLocked,isHidden}=selectedElement,actionsEnabled=!isBackground&&!isLocked&&!isHidden,latestEvent=(0,src.li)(),backgroundElementId=(0,app.P3)((({state})=>state.currentPage?.elements[0]?.id)),isShiftPressed=(0,keyboard.A3)("shift");canvas_useWindowResizeHandler(moveable),(0,src.vJ)((()=>{latestEvent.current=pushEvent}),[pushEvent]),(0,src.vJ)((()=>{moveable.current&&moveable.current.updateRect()}),[scrollLeft,scrollTop]),utils_useUpdateSelectionRectangle(moveable,[zoomSetting]),(0,src.vJ)((()=>{moveable.current&&(latestEvent.current&&targetEl.contains(latestEvent.current.target)&&actionsEnabled&&moveable.current.moveable.dragStart(latestEvent.current),moveable.current.updateRect())}),[targetEl,moveable,actionsEnabled]),(0,src.vJ)((()=>{moveable.current&&moveable.current.updateRect()}));const box=getBox(selectedElement),frame=(0,src.Kr)((()=>({translate:[0,0],rotate:box.rotationAngle,resize:[0,0],updates:null})),[box.rotationAngle]),{border}=selectedElement,{left=0,right=0,top=0,bottom=0}=border||{},setTransformStyle=(target,newFrame=frame)=>{frame.translate=newFrame.translate,frame.direction=newFrame.direction,frame.resize=newFrame.resize,frame.updates=newFrame.updates,frame.rotate=newFrame.rotate,target.style.transform=`translate(${frame.translate[0]}px, ${frame.translate[1]}px) rotate(${frame.rotate}deg)`,frame.resize[0]&&(target.style.width=`${frame.resize[0]}px`),frame.resize[1]&&(target.style.height=`${frame.resize[1]}px`);let frameForEl={...frame};if((frame.resize[0]||frame.resize[1])&&(0,masks_src.Fn)(selectedElement)){const elWidth=frame.resize[0]-(left+right),elHeight=frame.resize[1]-(top+bottom);frameForEl={...frame,resize:[elWidth,elHeight]}}pushTransform(selectedElement.id,frameForEl)},resetMoveable=(0,src.T0)((target=>{moveable.current&&(frame.direction=[0,0],frame.translate=[0,0],frame.resize=[0,0],frame.updates=null,pushTransform(selectedElement.id,null),target.style.transform="",target.style.width="",target.style.height="",moveable.current.updateRect())}),[frame,pushTransform,selectedElement.id]),canSnap=!isEditMode,hideHandles=isDragging,classNames=classnames_default()("default-moveable",{"hide-handles":hideHandles,"type-text":"text"===selectedElement.type,immoveable:isLocked||isHidden}),_dragProps=useDrag({setIsDragging,resetMoveable,selectedElement,setTransformStyle,frame}),dragProps=isEditMode?{onDrag:()=>!1,onDragEnd:()=>!1,onDragStart:()=>!1}:_dragProps,resizeProps=useResize({resetMoveable,selectedElement,setTransformStyle,frame,isEditMode,pushTransform,classNames,forceLockRatio:isShiftPressed}),rotateProps=useRotate({selectedElement,isEditMode,pushTransform,frame,setTransformStyle,resetMoveable,throttleRotation:isShiftPressed}),otherNodes=Object.values((0,objectWithout.A)(nodesById,[selectedElement.id,backgroundElementId])),snapProps=(0,useSnapping.A)({otherNodes,canSnap:canSnap&&actionsEnabled,isDragging}),isResizable=actionsEnabled&&!hideHandles&&!0!==selectedElement.lockDimensions,isRotatable=actionsEnabled&&!hideHandles&&!1!==selectedElement.supportsRotation;return react.createElement(moveable_src.uW,singleSelectionMoveable_extends({},props,{className:classNames,zIndex:0,ref:(0,src.jn)(moveable,ref),target:targetEl,edge:!0,draggable:actionsEnabled,resizable:isResizable,rotatable:isRotatable},dragProps,resizeProps,rotateProps,snapProps,{origin:!1,pinchable:!0}))})),LayerWithGrayout=(0,moveable_src.rs)((0,styled_components_browser_esm.Ay)(Layer).withConfig({displayName:"editLayer__LayerWithGrayout",componentId:"sc-1j9iuj3-0"})(["background-color:",";"],(({grayout,theme})=>grayout?theme.colors.opacity.overlayDark:"transparent"))),EditPageArea=(0,moveable_src.rs)(PageArea);function EditLayerForElement({element,showOverflow}){const ref=(0,src.li)(null),pageAreaRef=(0,src.li)(null),{editModeGrayout}=(0,elements_src.zh)(element.type),{isTrimMode}=(0,useVideoTrim.A)((({state:{isTrimMode}})=>({isTrimMode}))),{clearEditing,onMoveableMount}=(0,app.yu)((state=>({clearEditing:state.actions.clearEditing,onMoveableMount:state.state.onMoveableMount}))),focusCanvas=(0,useFocusCanvas.A)(),[editWrapper,setEditWrapper]=(0,src.J0)(null);(0,keyboard._h)(ref,{key:"esc",editable:!0},(()=>clearEditing()),[clearEditing]),(0,src.vJ)((()=>()=>focusCanvas(!1)),[focusCanvas]);const moveable=(0,src.li)(null),setRef=(0,src.hb)((moveableRef=>{moveable.current=moveableRef,onMoveableMount?.(moveableRef)}),[onMoveableMount]),onResize=(0,src.hb)((()=>{moveable.current&&moveable.current.updateRect()}),[]),{hasEditModeMoveable}=(0,elements_src.zh)(element.type);return react.createElement(LayerWithGrayout,{ref,"aria-label":(0,i18n._x)("Edit layer","compound noun","web-stories"),"data-testid":"editLayer",grayout:editModeGrayout,zIndex:zIndex.Vg,onPointerDown:evt=>{evt.target!==ref.current&&evt.target!==pageAreaRef.current||clearEditing()}},react.createElement(EditPageArea,{ref:pageAreaRef,fullBleedContainerLabel:(0,i18n.__)("Fullbleed area (Edit layer)","web-stories"),isControlled:!0,showOverflow,overflow:showOverflow?"visible":"hidden"},react.createElement(editElement,{editWrapper:hasEditModeMoveable&&editWrapper,onResize,element,ref:setEditWrapper})),hasEditModeMoveable&&editWrapper&&react.createElement(singleSelectionMoveable,{selectedElement:element,targetEl:editWrapper,isEditMode:!0,ref:setRef}),isTrimMode&&react.createElement(FooterArea,{showOverflow:!0},react.createElement(videoTrimmer,null)))}const editLayer=(0,src.ph)((function EditLayer(){const{currentPage}=(0,app.P3)((state=>({currentPage:state.state.currentPage}))),{editingElement:editingElementId,showOverflow=!0}=(0,app.yu)((({state:{editingElement,editingElementState:{showOverflow}={}}})=>({editingElement,showOverflow}))),editingElement=editingElementId&&currentPage&&currentPage.elements.find((element=>element.id===editingElementId));return editingElement?react.createElement(EditLayerForElement,{element:editingElement,showOverflow}):null}));__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js");var _path,_path2,prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),displayElement=__webpack_require__("./packages/story-editor/src/components/canvas/displayElement.js"),popup=__webpack_require__("./packages/design-system/src/components/popup/popup.tsx"),popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),useElementsWithLinks=__webpack_require__("./packages/story-editor/src/utils/useElementsWithLinks.ts");function defaultIcon_extends(){return defaultIcon_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},defaultIcon_extends.apply(this,arguments)}const SvgDefaultIcon=({title,titleId,...props})=>react.createElement("svg",defaultIcon_extends({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,_path||(_path=react.createElement("path",{fillOpacity:.1,d:"M12 0c6.6 0 12 5.4 12 12s-5.4 12-12 12S0 18.6 0 12 5.4 0 12 0"})),_path2||(_path2=react.createElement("path",{d:"M13.8 14.6c.1.1.2.3.2.5s-.1.3-.2.5L12.3 17c-.7.7-1.7 1.1-2.7 1.1s-1.9-.4-2.7-1.1c-.7-.7-1.1-1.7-1.1-2.7s.4-1.9 1.1-2.7l1.5-1.5c.2 0 .3-.1.5-.1s.3.1.5.2c.1.1.2.3.2.5s-.1.4-.2.5l-1.5 1.5c-.5.5-.7 1.1-.7 1.7s.3 1.3.7 1.7c.5.5 1.1.7 1.7.7s1.3-.3 1.7-.7l1.5-1.5c.3-.3.7-.3 1 0M17 7c-.7-.7-1.7-1.1-2.7-1.1s-1.9.4-2.7 1.1l-1.5 1.5c0 .1-.1.3-.1.4 0 .2.1.3.2.5.1.1.3.2.5.2s.3-.1.5-.2l1.5-1.5c.5-.5 1.1-.7 1.7-.7s1.3.3 1.7.7c.5.5.7 1.1.7 1.7s-.3 1.3-.7 1.7l-1.5 1.5c-.1.1-.2.3-.2.5s.1.3.2.5c.1.1.3.2.5.2s.3-.1.5-.2l1.5-1.5c.7-.7 1.1-1.7 1.1-2.7-.1-1-.5-1.9-1.2-2.6m-7.9 7.2c0 .2.1.3.2.5.1.1.3.2.5.2s.4-.1.5-.2l4.5-4.5c.1-.1.2-.3.2-.5s-.1-.4-.2-.5c-.3-.2-.8-.2-1 .1l-4.5 4.5c-.1.1-.2.3-.2.4"}))),defaultIcon=(0,react.memo)(SvgDefaultIcon);var arrowBar_path;function arrowBar_extends(){return arrowBar_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},arrowBar_extends.apply(this,arguments)}const SvgArrowBar=({title,titleId,...props})=>react.createElement("svg",arrowBar_extends({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 8","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,arrowBar_path||(arrowBar_path=react.createElement("path",{d:"M18 7.7c-.2 0-.5-.1-.7-.2l-7.3-4-7.3 4c-.7.4-1.6.2-2-.6-.4-.7-.1-1.6.6-2l8-4.4q.75-.3 1.5 0l8 4.4c.7.4 1 1.3.6 2-.4.5-.9.8-1.4.8"}))),arrowBar=(0,react.memo)(SvgArrowBar),pageAttachment_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageAttachment__Wrapper",componentId:"sc-1bseqmx-0"})(["position:absolute;display:flex;align-items:center;justify-content:flex-end;flex-direction:column;bottom:0;height:20%;width:100%;color:",";z-index:3;"],(({theme})=>theme.colors.standard.white)),Guideline=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageAttachment__Guideline",componentId:"sc-1bseqmx-1"})(["mix-blend-mode:difference;position:absolute;height:1px;bottom:20%;width:100%;background-image:",";background-position:top;background-size:16px 0.5px;background-repeat:repeat-x;z-index:3;"],(({theme})=>`linear-gradient(to right, ${theme.colors.standard.black} 50%, ${theme.colors.standard.white} 0%)`)),ArrowBar=(0,styled_components_browser_esm.Ay)(arrowBar).withConfig({displayName:"pageAttachment__ArrowBar",componentId:"sc-1bseqmx-2"})(["display:block;cursor:pointer;margin-bottom:10px;filter:drop-shadow(0px 2px 6px rgba(0,0,0,0.3));width:20px;height:8px;"]),OutlinkChip=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageAttachment__OutlinkChip",componentId:"sc-1bseqmx-3"})(["height:","px;display:flex;position:relative;padding:","px ","px;margin:0 0 20px;max-width:calc(100% - 64px);border-radius:30px;place-items:center;box-shadow:0px 4px 10px rgba(0,0,0,0.15);background:",";"],(({$factor})=>$factor(36)),(({$factor})=>$factor(10)),(({$factor})=>$factor(6)),(({bgColor})=>bgColor)),TextWrapper=styled_components_browser_esm.Ay.span.withConfig({displayName:"pageAttachment__TextWrapper",componentId:"sc-1bseqmx-4"})(["font-family:Roboto,sans-serif;font-size:","px;line-height:18px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;position:relative;padding-inline-start:6px;padding-inline-end:8px;height:16px;letter-spacing:0.3px;font-weight:700;max-width:210px;color:",";"],(({$factor})=>$factor(16)),(({fgColor})=>fgColor)),Tooltip=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageAttachment__Tooltip",componentId:"sc-1bseqmx-5"})(["background-color:",";color:",";width:200px;padding:8px;font-size:14px;border-radius:4px;text-align:center;"],(({theme})=>theme.colors.standard.black),(({theme})=>theme.colors.standard.white)),LinkImage=styled_components_browser_esm.Ay.img.withConfig({displayName:"pageAttachment__LinkImage",componentId:"sc-1bseqmx-6"})(["height:24px;width:24px;vertical-align:middle;border-radius:50%;border:0 none;object-fit:contain;"]),spacing={x:8};const canvas_pageAttachment=function PageAttachment({pageAttachment={}}){const{displayLinkGuidelines,pageAttachmentContainer,setPageAttachmentContainer}=(0,app.yu)((state=>({displayLinkGuidelines:state.state.displayLinkGuidelines,pageAttachmentContainer:state.state.pageAttachmentContainer,setPageAttachmentContainer:state.actions.setPageAttachmentContainer}))),{dataToEditorY}=(0,useUnits.A)((({actions:{dataToEditorY}})=>({dataToEditorY}))),{hasInvalidLinkSelected}=(0,useElementsWithLinks.A)(),{ctaText,url,icon,theme}=pageAttachment,bgColor=theme===constants.RS.DARK?"#000000":"#FFFFFF",fgColor=theme===constants.RS.DARK?"#FFFFFF":"#000000";return react.createElement(react.Fragment,null,(displayLinkGuidelines||hasInvalidLinkSelected)&&react.createElement(Guideline,null),react.createElement(pageAttachment_Wrapper,{role:"presentation",ref:setPageAttachmentContainer},url?.length>0&&react.createElement(react.Fragment,null,react.createElement(ArrowBar,{fill:bgColor}),react.createElement(OutlinkChip,{bgColor,$factor:dataToEditorY},icon?react.createElement(LinkImage,{src:icon,alt:(0,i18n.__)("Site Icon","web-stories"),decoding:"async",crossOrigin:"anonymous"}):react.createElement(defaultIcon,{fill:fgColor,width:dataToEditorY(24),height:dataToEditorY(24)}),react.createElement(TextWrapper,{fgColor,$factor:dataToEditorY},ctaText||(0,i18n.__)("Learn more","web-stories"))),pageAttachmentContainer&&hasInvalidLinkSelected&&react.createElement(popup.A,{anchor:{current:pageAttachmentContainer},isOpen:!0,placement:popup_constants.W.Left,spacing},react.createElement(Tooltip,null,(0,i18n.__)("Links can not reside below the dashed line when a page attachment is present. Your viewers will not be able to click on the link.","web-stories"))))))};var icons_arrowBar_path;function icons_arrowBar_extends(){return icons_arrowBar_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},icons_arrowBar_extends.apply(this,arguments)}const arrowBar_SvgArrowBar=({title,titleId,...props})=>react.createElement("svg",icons_arrowBar_extends({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 8","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,icons_arrowBar_path||(icons_arrowBar_path=react.createElement("path",{d:"M18 7.7c-.2 0-.5-.1-.7-.2l-7.3-4-7.3 4c-.7.4-1.6.2-2-.6-.4-.7-.1-1.6.6-2l8-4.4q.75-.3 1.5 0l8 4.4c.7.4 1 1.3.6 2-.4.5-.9.8-1.4.8"}))),icons_arrowBar=(0,react.memo)(arrowBar_SvgArrowBar),shoppingPageAttachment_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"shoppingPageAttachment__Wrapper",componentId:"sc-7unzl7-0"})(["position:absolute;display:flex;align-items:center;justify-content:flex-end;flex-direction:column;bottom:0;height:20%;width:100%;color:",";z-index:3;"],(({theme})=>theme.colors.standard.white)),InnerWrap=styled_components_browser_esm.Ay.div.withConfig({displayName:"shoppingPageAttachment__InnerWrap",componentId:"sc-7unzl7-1"})(["position:relative;width:100%;height:100%;"]),Inner=styled_components_browser_esm.Ay.div.withConfig({displayName:"shoppingPageAttachment__Inner",componentId:"sc-7unzl7-2"})(["position:absolute;bottom:0;width:100%;",";display:flex;flex-direction:column;align-items:center;"],(({$hasGradient})=>$hasGradient&&"background: linear-gradient(0, rgba(0, 0, 0, 0.15), transparent) !important")),ArrowWrap=styled_components_browser_esm.Ay.div.withConfig({displayName:"shoppingPageAttachment__ArrowWrap",componentId:"sc-7unzl7-3"})(["width:","px;min-height:","px;border-radius:50%;background:",";display:flex;align-items:center;justify-content:center;"],(({$factor})=>$factor(32)),(({$factor})=>$factor(32)),(({bgColor})=>bgColor)),shoppingPageAttachment_ArrowBar=(0,styled_components_browser_esm.Ay)(icons_arrowBar).withConfig({displayName:"shoppingPageAttachment__ArrowBar",componentId:"sc-7unzl7-4"})(["display:block;cursor:pointer;filter:drop-shadow(0px 2px 6px rgba(0,0,0,0.3));width:","px;height:","px;"],(({$factor})=>$factor(20)),(({$factor})=>$factor(8))),shoppingPageAttachment_OutlinkChip=styled_components_browser_esm.Ay.div.withConfig({displayName:"shoppingPageAttachment__OutlinkChip",componentId:"sc-7unzl7-5"})(["height:","px;display:flex;position:relative;padding:","px ","px;margin:0 0 ","px;max-width:calc(100% - 64px);border-radius:30px;place-items:center;background:",";"],(({$factor})=>$factor(36)),(({$factor})=>$factor(10)),(({$factor})=>$factor(6)),(({$factor})=>$factor(20)),(({bgColor})=>bgColor)),shoppingPageAttachment_TextWrapper=styled_components_browser_esm.Ay.span.withConfig({displayName:"shoppingPageAttachment__TextWrapper",componentId:"sc-7unzl7-6"})(["font-family:Roboto,sans-serif;font-size:","px;line-height:18px;text-overflow:ellipsis;white-space:nowrap;position:relative;padding-inline-start:6px;padding-inline-end:8px;height:","px;letter-spacing:0.3px;font-weight:700;max-width:210px;color:",";"],(({$factor})=>$factor(16)),(({$factor})=>$factor(16)),(({fgColor})=>fgColor));const shoppingPageAttachment=function shoppingPageAttachment_PageAttachment({ctaText,theme}){const arrowColor=theme===constants.RS.DARK?"#FFFFFF":"#000000",fgColor=theme===constants.RS.DARK?"#000000":"#FFFFFF",{dataToEditorY}=(0,useUnits.A)((({actions:{dataToEditorY}})=>({dataToEditorY})));return react.createElement(shoppingPageAttachment_Wrapper,{role:"presentation",tabIndex:-1},react.createElement(InnerWrap,null,react.createElement(Inner,{$hasGradient:theme!==constants.RS.DARK},react.createElement(ArrowWrap,{bgColor:fgColor,$factor:dataToEditorY},react.createElement(shoppingPageAttachment_ArrowBar,{fill:arrowColor,$factor:dataToEditorY})),react.createElement(shoppingPageAttachment_OutlinkChip,{$factor:dataToEditorY},react.createElement(shoppingPageAttachment_TextWrapper,{fgColor,$factor:dataToEditorY},ctaText||(0,i18n.__)("Shop Now","web-stories"))))))};const mediaCaptions_parseTimestamp=function parseTimestamp(timestamp){const match=/^(?:(\d{2,}):)?(\d{2}):(\d{2})\.(\d{3})$/.exec(timestamp);return match?3600*(match[1]?Number.parseInt(match[1]):0)+60*Number.parseInt(match[2])+Number.parseInt(match[3])+Number.parseInt(match[4])/1e3:null},CueWrapper=styled_components_browser_esm.Ay.span.withConfig({displayName:"cue__CueWrapper",componentId:"sc-h5j1x4-0"})(["text-align:center;height:",";"],(({$height})=>`${$height}px`)),CueEl=styled_components_browser_esm.Ay.span.withConfig({displayName:"cue__CueEl",componentId:"sc-h5j1x4-1"})(["color:",";"],(({$isFutureCue,theme})=>$isFutureCue?theme.colors.fg.black:theme.colors.fg.white)),Section=styled_components_browser_esm.Ay.span.withConfig({displayName:"cue__Section",componentId:"sc-h5j1x4-2"})(["margin:0 10px 10px;padding:6px 12px;vertical-align:middle;border-radius:15px;background:rgba(11,11,11,0.6);color:rgba(255,255,255,1);display:inline-block;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;line-height:1.4;word-break:break-word;word-wrap:break-word;overflow-wrap:break-word;"]);const mediaCaptions_cue=function Cue({cue,videoTime,height}){const html=cue.getCueAsHTML();return react.createElement(CueWrapper,{$height:height},react.createElement(Section,null,html.childNodes.map((node=>{if("timestamp"===node.target)return null;{let timestamp=null;"timestamp"===node.previousSibling?.target&&(timestamp=mediaCaptions_parseTimestamp(node.previousSibling.data));const isFutureCue=timestamp>videoTime;return node.nodeType===Node.TEXT_NODE?null!==timestamp?react.createElement("span",null,react.createElement(CueEl,{$isFutureCue:isFutureCue},node.textContent)):react.createElement(CueEl,null,node.textContent):null!==timestamp?react.createElement("span",null,react.createElement(CueEl,{$isFutureCue:isFutureCue,dangerouslySetInnerHTML:{__html:node.innerHTML}})):react.createElement(CueEl,{dangerouslySetInnerHTML:{__html:node.innerHTML}})}}))))},Track=styled_components_browser_esm.Ay.div.withConfig({displayName:"trackRenderer__Track",componentId:"sc-7rx40r-0"})(["width:100%;height:100%;display:grid;align-content:end;font-size:",";"],(({$fontSize})=>`${$fontSize}px`));const trackRenderer=function TrackRenderer({elementId,trackIndex}){const{pageWidth,pageHeight}=(0,app.gK)((({state:{pageWidth,pageHeight}})=>({pageWidth,pageHeight}))),fontSize=.04*pageWidth,height=.3*pageHeight,[track,setTrack]=(0,src.J0)(null),[videoTime,setVideoTime]=(0,src.J0)(0),[cues,setCues]=(0,src.J0)([]),updateCues=(0,src.hb)((()=>{const activeCues=track?.activeCues?[...track.activeCues]:[];setCues(activeCues)}),[track]);return(0,src.vJ)((()=>{updateCues(),setVideoTime(0);const mediaEl=document.getElementById(elementId);if(!mediaEl)return;const mediaTrack=mediaEl.textTracks?.[trackIndex];return mediaTrack?(mediaTrack.mode="hidden",updateCues(),setTrack(mediaTrack),mediaEl.addEventListener("timeupdate",(()=>{setVideoTime(mediaEl.currentTime)})),mediaTrack.addEventListener("cuechange",updateCues),()=>{mediaTrack.removeEventListener("cuechange",updateCues)}):void 0}),[trackIndex,updateCues,elementId,pageWidth,pageHeight]),cues&&track?react.createElement(Track,{$fontSize:fontSize},cues.map(((cue,index)=>react.createElement(mediaCaptions_cue,{key:index,cue,videoTime,height})))):null},CaptionsLayer=(0,styled_components_browser_esm.Ay)(Layer).withConfig({displayName:"mediaCaptionsLayer__CaptionsLayer",componentId:"sc-11mx67a-0"})([""]),CaptionsPageArea=(0,styled_components_browser_esm.Ay)(PageArea).withConfig({displayName:"mediaCaptionsLayer__CaptionsPageArea",componentId:"sc-11mx67a-1"})(["position:absolute;pointer-events:none;"]),CaptionsCanvas=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaCaptionsLayer__CaptionsCanvas",componentId:"sc-11mx67a-2"})(["background:transparent;border-radius:5px;position:absolute;z-index:2;transform:translateZ(0);top:0;left:0;bottom:0;right:0;cursor:default;"]);const mediaCaptionsLayer=function MediaCaptionsLayer(){const{isEditing}=(0,app.yu)((({state:{isEditing}})=>({isEditing}))),{currentPageId,backgroundAudio,videoElement}=(0,app.P3)((({state})=>{const{selectedElements,currentPage}=state;let backgroundAudio=null,videoElement=null;if(1===selectedElements.length&&currentPage){const selectedElement=selectedElements[0],{isBackground,type,tracks}=selectedElement,{backgroundAudio:currentPageBackgroundAudio}=currentPage;isBackground&&currentPageBackgroundAudio&&currentPageBackgroundAudio?.tracks?.length>0&&(backgroundAudio=currentPageBackgroundAudio),"video"===type&&tracks?.length>0&&(videoElement=selectedElement)}return{currentPageId:currentPage?.id,backgroundAudio,videoElement}})),[mediaTrackCount,setMediaTrackCount]=(0,src.J0)(0),[mediaElementId,setMediaElementId]=(0,src.J0)("");return(0,src.vJ)((()=>{if(setMediaTrackCount(0),setMediaElementId(""),backgroundAudio)return setMediaElementId(`page-${currentPageId}-background-audio`),void setMediaTrackCount(backgroundAudio?.tracks?.length);!isEditing&&videoElement&&(setMediaElementId(`video-${videoElement.id}`),setMediaTrackCount(videoElement.tracks.length))}),[videoElement,backgroundAudio,currentPageId,isEditing]),mediaTrackCount?react.createElement(CaptionsLayer,null,react.createElement(CaptionsPageArea,{withSafezone:!1,showOverflow:!0},react.createElement(CaptionsCanvas,null,Array.from({length:mediaTrackCount}).map(((_,index)=>react.createElement(trackRenderer,{key:index,elementId:mediaElementId,trackIndex:index})))))):null},DisplayPageArea=(0,styled_components_browser_esm.Ay)(PageArea).withConfig({displayName:"displayLayer__DisplayPageArea",componentId:"sc-13e1aq-0"})(["position:absolute;"]);function DisplayPage({pageElements,editingElement}){return pageElements?pageElements.map((element=>{if(editingElement===element.id)return null;if(element.isHidden)return null;const siblingCount=pageElements.filter((({type})=>type===element.type)).length-1;return react.createElement(displayElement.A,{key:element.id,element,isAnimatable:!0,siblingCount})})):null}function DisplayPageAnimationController({resetAnimationState}){const{animationState,pageId}=(0,app.P3)((({state})=>({animationState:state.animationState,pageId:state.currentPage?.id}))),WAAPIAnimationMethods=(0,animation_src.oB)((({actions})=>actions.WAAPIAnimationMethods));return(0,src.vJ)((()=>{switch(animationState){case animation_src.TR.PlayingSelected:case animation_src.TR.Playing:return void WAAPIAnimationMethods.play();case animation_src.TR.Reset:return void WAAPIAnimationMethods.reset();case animation_src.TR.Scrubbing:case animation_src.TR.Paused:return void WAAPIAnimationMethods.pause();default:return}}),[animationState,WAAPIAnimationMethods]),(0,src.vJ)((()=>resetAnimationState),[resetAnimationState,pageId]),null}function StoryAnimations({children}){const{isAnimationPlaying,currentPageAnimations,currentPageElements,selectedElements,updateAnimationState}=(0,app.P3)((({state,actions})=>({isAnimationPlaying:state.animationState===animation_src.TR.PlayingSelected,currentPageAnimations:state.currentPage?.animations||constants.qW,currentPageElements:state.currentPage?.elements||constants.qW,selectedElements:state.selectedElements,updateAnimationState:actions.updateAnimationState}))),resetAnimationState=(0,src.hb)((()=>{updateAnimationState({animationState:animation_src.TR.Reset})}),[updateAnimationState]),animatedElements=(0,src.Kr)((()=>selectedElements.map((el=>el.id))),[selectedElements]);return react.createElement(animation_src.S,{animations:currentPageAnimations,elements:currentPageElements,onWAAPIFinish:resetAnimationState,selectedElementIds:isAnimationPlaying?animatedElements:constants.qW},react.createElement(DisplayPageAnimationController,{resetAnimationState}),children)}DisplayPageAnimationController.propTypes={resetAnimationState:prop_types_default().func};const displayLayer=(0,src.ph)((function DisplayLayer(){const{backgroundColor,isBackgroundSelected,pageAttachment,shoppingAttachment,hasProducts}=(0,app.P3)((({state})=>({hasCurrentPage:Boolean(state.currentPage),backgroundColor:state.currentPage?.backgroundColor,isBackgroundSelected:state.selectedElements?.[0]?.isBackground,pageAttachment:state.currentPage?.pageAttachment||{},shoppingAttachment:state.currentPage?.shoppingAttachment||{},hasProducts:state.currentPage?.elements?.some((({type,product})=>type===elements_src.bV.PRODUCT&&product?.productId))}))),currentPageElements=(0,app.P3)((({state})=>state.currentPage?.elements||constants.qW)),boundingBoxTrackingRef=(0,app.yR)(app.DN.PAGE_CONTAINER),{editingElement,setPageContainer,setFullbleedContainer}=(0,app.yu)((({state:{editingElement},actions:{setPageContainer,setFullbleedContainer}})=>({editingElement,setPageContainer,setFullbleedContainer}))),Overlay=(0,src.Kr)((()=>hasProducts?react.createElement(shoppingPageAttachment,shoppingAttachment):react.createElement(canvas_pageAttachment,{pageAttachment})),[hasProducts,pageAttachment,shoppingAttachment]);return react.createElement(StoryAnimations,null,react.createElement(Layer,{"data-testid":"DisplayLayer",pointerEvents:"none","aria-label":(0,i18n._x)("Display layer","compound noun","web-stories")},react.createElement(DisplayPageArea,{ref:(0,src.jn)(setPageContainer,boundingBoxTrackingRef),fullbleedRef:setFullbleedContainer,background:backgroundColor,isBackgroundSelected,fullBleedContainerLabel:(0,i18n.__)("Fullbleed area (Display layer)","web-stories"),overlay:Overlay,isControlled:!0},react.createElement(DisplayPage,{pageElements:currentPageElements,editingElement})),react.createElement(mediaCaptionsLayer,null)))}));var outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),useLiveRegion=__webpack_require__("./packages/design-system/src/utils/useLiveRegion.ts"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),getKeyboardMovement=__webpack_require__("./packages/design-system/src/utils/getKeyboardMovement.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),highlights=__webpack_require__("./packages/story-editor/src/app/highlights/index.ts"),useHighlights=__webpack_require__("./packages/story-editor/src/app/highlights/useHighlights.ts"),story=__webpack_require__("./packages/story-editor/src/app/story/index.ts");const utils_getLayerArrangementProps=function getLayerArrangementProps(key,shift,selectedElements,elements){if(!selectedElements||selectedElements.length>1)return{};let position=null;if("ArrowUp"===key&&(position=shift?constants.lH.Front:constants.lH.Forward),"ArrowDown"===key&&(position=shift?constants.lH.Back:constants.lH.Backward),!position)return{};const{id,groupId}=selectedElements[0],currentPosition=elements.findIndex((({id:elId})=>elId===id));if(groupId){const isLastInGroup=elements[currentPosition-1]?.groupId!==groupId,isFirstInGroup=elements[currentPosition+1]?.groupId!==groupId;if(isLastInGroup&&position===constants.lH.Backward||isFirstInGroup&&position===constants.lH.Forward)return{position:currentPosition,groupId:null}}else{if(elements[currentPosition-1]?.groupId&&position===constants.lH.Backward)return{position:currentPosition,groupId:elements[currentPosition-1].groupId};if(elements[currentPosition+1]?.groupId&&position===constants.lH.Forward)return{position:currentPosition,groupId:elements[currentPosition+1].groupId}}return{position}};var canvas=__webpack_require__("./packages/story-editor/src/app/canvas/index.ts");const canvas_useCanvasKeys=function useCanvasKeys(ref){const{selectedElementIds,selectedElements,arrangeSelection,deleteSelectedElements,duplicateElementsById,updateSelectedElements,setSelectedElementsById,currentPage,currentPageNumber,animationState,updateAnimationState,currentPageProductIds,pageElements}=(0,story.P3)((({state:{selectedElementIds,selectedElements,currentPage,currentPageNumber,animationState},actions:{arrangeSelection,deleteSelectedElements,duplicateElementsById,updateSelectedElements,setSelectedElementsById,updateAnimationState}})=>({currentPage,currentPageNumber,selectedElementIds,selectedElements,arrangeSelection,deleteSelectedElements,duplicateElementsById,updateSelectedElements,setSelectedElementsById,animationState,updateAnimationState,currentPageProductIds:currentPage?.elements?.filter(elements_src.V7.product).map((({product})=>product?.productId)),pageElements:currentPage?.elements}))),showSnackbar=(0,useSnackbar.d)((({showSnackbar})=>showSnackbar)),{setHighlights}=(0,useHighlights.A)((({setHighlights})=>({setHighlights}))),{isEditing,getNodeForElement,setEditingElement}=(0,canvas.yu)((({state:{isEditing},actions:{getNodeForElement,setEditingElement}})=>({isEditing,getNodeForElement,setEditingElement}))),selectedElementIdsRef=(0,src.li)(null);selectedElementIdsRef.current=selectedElementIds,(0,src.vJ)((()=>{const container=ref.current;if(!container)return;const doc=container.ownerDocument;if(!doc)return;const handler=()=>{setTimeout((()=>{if(doc.activeElement===doc.body){const currentSelectedIds=selectedElementIdsRef.current,selectedFrame=1===currentSelectedIds?.length?getNodeForElement(currentSelectedIds[0]):null,sel=window.getSelection();if(""!==sel?.toString())return;selectedFrame?selectedFrame.focus({preventScroll:!0}):container.focus({preventScroll:!0})}}),300)};return doc.addEventListener("focusout",handler,!0),()=>{doc.removeEventListener("focusout",handler,!0)}}),[ref,getNodeForElement]),(0,keyboard.pP)("delete",(()=>deleteSelectedElements()),[deleteSelectedElements]),(0,keyboard.pP)({key:["mod+a"]},(()=>{if(!currentPage)return;const elementIds=currentPage.elements.map((({id})=>id));setSelectedElementsById({elementIds})}),[currentPage,setSelectedElementsById]),(0,keyboard.pP)({key:["up","down","left","right"],shift:!0},(({key,shiftKey})=>{if(isEditing||!selectedElements?.length)return;const{isLocked}=selectedElements[0];if(elements_src.V7.backgroundable(selectedElements[0])&&selectedElements[0].isBackground||isLocked)return;const{dx,dy}=(0,getKeyboardMovement.A)(key,shiftKey);updateSelectedElements({properties:({x,y})=>({x:x+dx,y:y+dy})})}),[updateSelectedElements,isEditing,selectedElements]),(0,keyboard.pP)({key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(evt=>{const{key,shiftKey}=evt;if(evt.preventDefault(),1===selectedElements?.length&&pageElements){const{position,groupId}=utils_getLayerArrangementProps(key,shiftKey,selectedElements,pageElements);(position||groupId)&&arrangeSelection({position,groupId})}}),[arrangeSelection,selectedElements,pageElements]),(0,keyboard.pP)({key:"enter",clickable:!1},(()=>{if(1!==selectedElements.length)return;const{type,id,isLocked}=selectedElements[0],{hasEditMode,hasEditModeIfLocked}=(0,elements_src.zh)(type);!hasEditMode||!hasEditModeIfLocked&&isLocked||setEditingElement(id)}),[selectedElements,setEditingElement]);const cloneHandler=(0,src.hb)((()=>{if(0!==selectedElements.length){for(const el of selectedElements)if(elements_src.V7.product(el)){const{product}=el,{productId,productTitle,productImages}=product;productId&&currentPageProductIds?.includes(productId)&&showSnackbar({message:(0,sprintf.A)((0,i18n.__)('Product "%s" already exists on the page.',"web-stories"),productTitle),thumbnail:productImages?.[0]?.url?{src:productImages[0].url,alt:productImages[0].alt}:void 0})}duplicateElementsById({elementIds:selectedElements.map((element=>element.id))})}}),[duplicateElementsById,selectedElements,currentPageProductIds,showSnackbar]);(0,keyboard.pP)("clone",(()=>cloneHandler()),[cloneHandler]);const isPlaying=[animation_src.TR.Playing,animation_src.TR.PlayingSelected].includes(animationState);(0,keyboard.pP)({key:["mod+enter"]},(evt=>{evt.preventDefault(),1!==currentPageNumber&&(updateAnimationState({animationState:isPlaying?animation_src.TR.Reset:animation_src.TR.Playing}),(0,tracking_src.sx)("canvas_play_animations",{status:isPlaying?"stop":"play"}))}),[isPlaying,updateAnimationState,currentPageNumber]),(0,keyboard.pP)({key:["mod+k"]},(evt=>{evt.preventDefault(),!selectedElements.length||elements_src.V7.backgroundable(selectedElements[0])&&selectedElements[0].isBackground||setHighlights({elements:selectedElements,highlight:highlights.xP.Link})}),[setHighlights,selectedElements])};var pagepreview=__webpack_require__("./packages/story-editor/src/components/footer/pagepreview/index.js");const ExtraPageWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"extraPages__ExtraPageWrapper",componentId:"sc-12b8j4d-0"})(["display:flex;overflow:hidden;justify-content:",";align-items:center;height:100%;"],(({isPrevious})=>isPrevious?"flex-end":"flex-start")),ExtraPageList=styled_components_browser_esm.Ay.ol.withConfig({displayName:"extraPages__ExtraPageList",componentId:"sc-12b8j4d-1"})(["display:flex;flex-direction:",";width:","px;margin:0;padding:0 ","px;gap:","px;"],(({isPrevious})=>isPrevious?"row-reverse":"row"),(({listWidth})=>listWidth),32,32),ExtraPage=styled_components_browser_esm.Ay.li.withConfig({displayName:"extraPages__ExtraPage",componentId:"sc-12b8j4d-2"})(["display:block;width:","px;height:100%;border-radius:4px;background-color:white;opacity:",";transition:opacity 0.2s ease;&:hover{opacity:1;}",""],(({extraPageWidth})=>extraPageWidth-32),(({$distance})=>.6-.15*$distance),(({$inert})=>$inert&&"pointer-events: none;")),ExtraPagePreview=(0,styled_components_browser_esm.Ay)(pagepreview.A).withConfig({displayName:"extraPages__ExtraPagePreview",componentId:"sc-12b8j4d-3"})(["cursor:pointer;"]);function range(from,to){return from<to?Array.from(Array(to-from)).map(((k,v)=>v+from)):[]}const extraPages=(0,src.ph)((function ExtraPages({isPrevious=!1}){const{currentPageIndex,pages,setCurrentPage}=(0,app.P3)((({state:{pages,currentPageIndex},actions:{setCurrentPage}})=>({currentPageIndex,pages,setCurrentPage}))),{hasExtraPages,extraPageWidth,extraPageCount}=(0,app.gK)((({state:{hasExtraPages,extraPageWidth,extraPageCount}})=>({hasExtraPages,extraPageWidth,extraPageCount}))),isAnythingTransforming=(0,transform_src.Gy)((({state:{isAnythingTransforming}})=>isAnythingTransforming)),pageCount=pages?.length;if(!pageCount)return null;const pagesToShow=function getPagesToShow({isPrevious,hasExtraPages,currentPageIndex,extraPageCount,pageCount}){if(!hasExtraPages)return[];if(isPrevious)return range(Math.max(0,currentPageIndex-extraPageCount),currentPageIndex).reverse();return range(currentPageIndex+1,Math.min(pageCount,currentPageIndex+extraPageCount+2))}({isPrevious,hasExtraPages,currentPageIndex,extraPageCount,pageCount});if(0===pagesToShow.length)return null;const listWidth=pagesToShow.length*extraPageWidth,extraPageHeight=(extraPageWidth-32)/src_constants.iZ;return react.createElement(ExtraPageWrapper,{isPrevious},react.createElement(ExtraPageList,{isPrevious,listWidth,extraPageHeight},pagesToShow.map(((pageNum,index)=>{return react.createElement(ExtraPage,{key:pageNum,extraPageWidth,$inert:isAnythingTransforming,$distance:index},react.createElement(ExtraPagePreview,{page:pages[pageNum],onClick:(pageId=pages[pageNum].id,()=>setCurrentPage({pageId})),"aria-label":(0,sprintf.A)((0,i18n.__)("Go to page %s","web-stories"),pageNum+1),width:extraPageWidth-32}));var pageId}))))}));var utils=__webpack_require__("./packages/design-system/src/components/keyboard/utils.ts"),polished_esm=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),url=__webpack_require__("./packages/url/src/url.ts"),external_link=__webpack_require__("./packages/design-system/src/icons/external_link.svg"),tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js"),elementLink=__webpack_require__("./packages/story-editor/src/components/elementLink/index.js");const StyledTooltip=(0,styled_components_browser_esm.Ay)(tooltip.A).withConfig({displayName:"frame__StyledTooltip",componentId:"sc-1fjzoyw-0"})(["box-shadow:0px 6px 10px ",";align-items:center;p{display:flex;max-width:100%;}"],(({theme})=>(0,polished_esm.B3)(theme.colors.standard.black,.1))),IconWrapper=styled_components_browser_esm.Ay.span.withConfig({displayName:"frame__IconWrapper",componentId:"sc-1fjzoyw-1"})(["background-color:",";width:24px;height:24px;border-radius:50%;overflow:hidden;margin-right:8px;display:inline-block;"],(({theme})=>theme.colors.fg.secondary)),BrandIcon=styled_components_browser_esm.Ay.img.withConfig({displayName:"frame__BrandIcon",componentId:"sc-1fjzoyw-2"})(["width:100%;height:100%;border:none;"]),LinkDesc=styled_components_browser_esm.Ay.span.withConfig({displayName:"frame__LinkDesc",componentId:"sc-1fjzoyw-3"})(["padding-top:2px;flex:1;max-width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),ExternalLink=(0,styled_components_browser_esm.Ay)(external_link.A).withConfig({displayName:"frame__ExternalLink",componentId:"sc-1fjzoyw-4"})(["width:24px;"]);const elementLink_frame=function WithLink({element,active,children,anchorRef}){const link=(0,elementLink.f)(element),tooltipContent=link?.url&&active?react.createElement(react.Fragment,null,link?.icon&&react.createElement(IconWrapper,null,react.createElement(BrandIcon,{src:link.icon,alt:(0,i18n.__)("Site Icon","web-stories"),decoding:"async",crossOrigin:"anonymous"})),react.createElement(LinkDesc,null,link.desc||(0,url.rM)(link.url)),react.createElement(ExternalLink,null)):null;return react.createElement(StyledTooltip,{forceAnchorRef:anchorRef,placement:popup_constants.W.Top,title:tooltipContent},children)};var pill_path;function pill_extends(){return pill_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},pill_extends.apply(this,arguments)}const SvgPill=({title,titleId,...props})=>react.createElement("svg",pill_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 12","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,pill_path||(pill_path=react.createElement("path",{fill:"currentColor",d:"M11.49 5.755 6.24.505a1.16 1.16 0 0 0-.823-.338H1.334A1.17 1.17 0 0 0 .167 1.333v4.084c0 .32.128.612.344.828l5.25 5.25c.21.21.502.338.823.338s.612-.128.822-.344l4.083-4.083a1.14 1.14 0 0 0 .345-.823c0-.32-.134-.618-.345-.828ZM2.208 3.083a.874.874 0 1 1 0-1.75.874.874 0 1 1 0 1.75"}))),pill=(0,react.memo)(SvgPill),frame_StyledTooltip=(0,styled_components_browser_esm.Ay)(tooltip.A).withConfig({displayName:"frame__StyledTooltip",componentId:"sc-uvs0u9-0"})(["align-items:center;p{display:flex;max-width:100%;color:#fff;font-family:'Poppins',sans-serif;font-weight:700;font-size:14px;line-height:24px;padding:0;}background-color:rgba(125,125,125,0.75);border-radius:18px;padding-inline-start:6px;padding-inline-end:12px;cursor:pointer;height:36px;"]),PillImage=styled_components_browser_esm.Ay.span.withConfig({displayName:"frame__PillImage",componentId:"sc-uvs0u9-1"})(["width:24px;height:24px;display:flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,0.6);border-radius:100%;flex-shrink:0;margin-inline-end:4px;"]);function TooltipTitle({productTagText}){return react.createElement(react.Fragment,null,react.createElement(PillImage,null,react.createElement(pill,{width:14,height:14,"aria-hidden":!0})),productTagText)}const shopping_frame=function WithProductPill({element,active,children,anchorRef}){const{actions:{maybeEnqueueFontStyle}}=(0,app.Ln)(),{locale:{locale}}=(0,app.UK)(),elementType=element.type;if((0,src.vJ)((()=>{elementType===elements_src.bV.PRODUCT&&maybeEnqueueFontStyle([{font:{family:"Poppins",service:"fonts.google.com",weights:[700],styles:["regular"],variants:[[0,700]]},fontWeight:700}])}),[elementType,maybeEnqueueFontStyle]),elementType!==elements_src.bV.PRODUCT)return children;const{productPrice,productPriceCurrency,productTitle}=element.product,productTagText=productPrice&&productPriceCurrency&&locale?new Intl.NumberFormat(locale,{style:"currency",currency:productPriceCurrency}).format(productPrice):productTitle;return react.createElement(frame_StyledTooltip,{forceAnchorRef:anchorRef,placement:popup_constants.W.Right,hasTail:!1,title:active?react.createElement(TooltipTitle,{productTagText}):null},children)},utils_useDoubleClick=(onSingleClick,onDoubleClick,ms=200)=>{const[target,setTarget]=(0,src.J0)(null),[lastEvent,setLastEvent]=(0,src.J0)(null),getHandler=(0,src.hb)((newTarget=>evt=>{if(evt.stopPropagation(),target!==newTarget)return target&&onSingleClick(evt,target),setTarget(newTarget),void setLastEvent(evt);onDoubleClick(evt,target),setTarget(null)}),[onSingleClick,onDoubleClick,target]);return(0,src.vJ)((()=>{if(!target)return;const int=setTimeout((()=>{setTarget(null),lastEvent&&target&&onSingleClick(lastEvent,target)}),ms);return()=>{clearTimeout(int)}}),[target,lastEvent,onSingleClick,ms]),getHandler};var usePerformanceTracking=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),editLayerFocusManager=__webpack_require__("./packages/story-editor/src/components/canvas/editLayerFocusManager/index.js");function frameElement_extends(){return frameElement_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},frameElement_extends.apply(this,arguments)}const frameElement_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"frameElement__Wrapper",componentId:"sc-80q0sm-0"})([""," "," "," outline:1px solid transparent;transition:outline-color 0.5s;&:focus,&:active{outline-color:",";}"," ",""],element_library_src.AV,element_library_src.WZ,element_library_src.TH,(({theme,hasMask})=>hasMask?"transparent":theme.colors.border.selection),(({isLocked,hasMask,theme})=>!isLocked&&!hasMask&&`\n    &:hover {\n      outline-color: ${theme.colors.border.selection};\n    }\n  `),(({isClickable})=>!isClickable&&"pointer-events: none;")),EmptyFrame=styled_components_browser_esm.Ay.div.withConfig({displayName:"frameElement__EmptyFrame",componentId:"sc-80q0sm-1"})(["position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"]),FRAME_ELEMENT_MESSAGE=(0,sprintf.A)((0,i18n.__)("To exit the canvas area, press Escape. Press Tab to move to the next group or element. To enter floating menu, press %s.","web-stories"),(0,utils.KV)("ctrl+alt+p"));const frameElement=(0,src.ph)((function FrameElement({id}){const speak=(0,useLiveRegion.A)(),{enterFocusGroup,setFocusGroupCleanup}=(0,editLayerFocusManager.in)((({enterFocusGroup,setFocusGroupCleanup})=>({enterFocusGroup,setFocusGroupCleanup}))),[isTransforming,setIsTransforming]=(0,src.J0)(!1),focusGroupRef=(0,editLayerFocusManager.ec)(editLayerFocusManager.wn.ELEMENT_SELECTION),{setNodeForElement,handleSelectElement,isEditing,setEditingElement,setEditingElementWithState}=(0,app.yu)((({state,actions})=>({setNodeForElement:actions.setNodeForElement,handleSelectElement:actions.handleSelectElement,isEditing:state.isEditing,setEditingElement:actions.setEditingElement,setEditingElementWithState:actions.setEditingElementWithState}))),{isSelected,isOnlySelectedElement,isActive,isBackground,element}=(0,app.P3)((({state})=>{const isSelected=state.selectedElementIds.includes(id),isOnlySelectedElement=isSelected&&1===state.selectedElementIds.length,isActive=isOnlySelectedElement&&!isTransforming&&!isEditing;return{isSelected,isBackground:state.currentPage?.elements[0].id===id,element:state.currentPage?.elements.find((el=>el.id===id)),isOnlySelectedElement,isActive}})),{type,flip,isLocked,isHidden}=element,isClickable=(!isLocked||isSelected)&&!isHidden,{Frame,isMaskable,Controls}=(0,elements_src.zh)(type),elementRef=(0,src.li)(),combinedFocusGroupRef=(0,src.jn)(elementRef,focusGroupRef),[hovering,setHovering]=(0,src.J0)(!1),{isRTL,styleConstants:{topOffset}={}}=(0,app.UK)(),{draggingResource,activeDropTargetId,isDropSource,registerDropTarget,unregisterDropTarget}=(0,app.hS)((({state:{draggingResource,activeDropTargetId},actions:{isDropSource,registerDropTarget,unregisterDropTarget}})=>({draggingResource,activeDropTargetId,isDropSource,registerDropTarget,unregisterDropTarget}))),isLinkActive=(0,app.Gy)((({state})=>!isSelected&&hovering&&!state.isAnythingTransforming))&&!isLocked,getBoxWithBorder=(0,useUnits.A)((({actions})=>actions.getBoxWithBorder));(0,src.Nf)((()=>{setNodeForElement(id,elementRef.current)}),[id,setNodeForElement]);const boxWithBorder=getBoxWithBorder(element);(0,transform_src.Ap)(id,(transform=>{const target=elementRef.current;void 0!==transform?.dropTargets?.hover&&(target.style.opacity=transform.dropTargets.hover?0:1),setIsTransforming(null!==transform)}));const{isMedia}=(0,elements_src.zh)(type),handleMediaDoubleClick=(0,src.hb)((evt=>{isSelected||handleSelectElement(id,evt),setEditingElement(id)}),[id,setEditingElement,handleSelectElement,isSelected]),handleMediaClick=utils_useDoubleClick(noop.l,handleMediaDoubleClick),handleFocus=(0,src.hb)((evt=>{isSelected||handleSelectElement(id,evt),isBackground||speak(FRAME_ELEMENT_MESSAGE)}),[handleSelectElement,id,isBackground,isSelected,speak]),{clearTransforms}=(0,app.Gy)((state=>({clearTransforms:state.actions.clearTransforms}))),handleMouseDown=(0,src.hb)((evt=>{isSelected||(handleSelectElement(id,evt),clearTransforms()),elementRef.current.focus({preventScroll:!0}),isBackground||evt.stopPropagation()}),[handleSelectElement,id,isBackground,isSelected,clearTransforms]);(0,usePerformanceTracking.A)({node:elementRef.current,eventData:{...constants.Zy.SELECT_ELEMENT,label:element.type},eventType:"pointerdown"}),(0,keyboard._h)(elementRef,{key:["ctrl+alt+p"]},(()=>{enterFocusGroup({groupId:editLayerFocusManager.wn.EDIT_ELEMENT})}),[enterFocusGroup]),(0,src.vJ)((()=>{isSelected&&setFocusGroupCleanup({groupId:editLayerFocusManager.wn.EDIT_ELEMENT,cleanup:()=>elementRef.current?.focus()})}),[setFocusGroupCleanup,isSelected]);const layerName=(0,elements_src.Hi)(element),elementLabel=element.isLocked?(0,sprintf.A)((0,i18n.__)("Locked element: %s","web-stories"),layerName):(0,sprintf.A)((0,i18n.__)("Element: %s","web-stories"),layerName);return react.createElement(shopping_frame,{element,active:isLinkActive,anchorRef:elementRef},react.createElement(elementLink_frame,{element,active:isLinkActive,anchorRef:elementRef},Controls&&react.createElement(Controls,{isTransforming,box:boxWithBorder,elementRef,element,isRTL,topOffset,isActive}),react.createElement(frameElement_Wrapper,frameElement_extends({ref:combinedFocusGroupRef,"data-element-id":id},boxWithBorder,{tabIndex:-1,role:"button","aria-label":elementLabel,hasMask:isMaskable,isClickable,"data-testid":"frameElement",onMouseDown:handleMouseDown,onFocus:handleFocus,onPointerEnter:()=>setHovering(!0),onPointerLeave:()=>setHovering(!1),onClick:isMedia?handleMediaClick(id):null}),react.createElement(masks_src.we,{element,fill:!0,flip,draggingResource,activeDropTargetId,isDropSource,registerDropTarget,unregisterDropTarget,isSelected},Frame?react.createElement(Frame,{wrapperRef:elementRef,element,box:boxWithBorder,isOnlySelectedElement,setEditingElementWithState}):react.createElement(EmptyFrame,null)))))}));__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.some.js");const multiSelectionMoveable_useDrag=function useMultiSelectionDrag({targetList,frames,setTransformStyle,onGroupEventStart,onGroupEventEnd,isDragging,setIsDragging}){const{draggingResource}=(0,dropTargets.h)((({state:{draggingResource}})=>({draggingResource}))),{nodesById,handleSelectElement}=(0,app.yu)((({state:{nodesById},actions:{handleSelectElement}})=>({nodesById,handleSelectElement}))),eventTracker=(0,src.li)({}),hideHandles=isDragging||Boolean(draggingResource);return{onDragGroup:({events})=>{events.forEach((({target,beforeTranslate},i)=>{const sFrame=frames[i],{element}=targetList[i];sFrame.translate=beforeTranslate,setTransformStyle(element,target,sFrame)}))},onDragGroupEnd:({targets,inputEvent})=>{setIsDragging(!1),(inputEvent=>{if((0,moveable_src.hW)(eventTracker.current,inputEvent))return!1;const clickedElement=Object.keys(nodesById).find((id=>nodesById[id].contains(inputEvent.target)));return clickedElement&&setTimeout((()=>{handleSelectElement(clickedElement,inputEvent)}),0),!0})(inputEvent)||onGroupEventEnd({targets})},onDragGroupStart:({events,inputEvent})=>{(evt=>{const{timeStamp,clientX,clientY}=evt;eventTracker.current={timeStamp,clientX,clientY}})(inputEvent),isDragging||setIsDragging(!0),onGroupEventStart({events,isDrag:!0})},className:"default-moveable "+(hideHandles?"hide-handles":""),resizable:!hideHandles,rotatable:!hideHandles}};const multiSelectionMoveable_useResize=function useResize_useResize({onGroupEventEnd,targetList,setTransformStyle,frames}){const{editorToDataX,editorToDataY,dataToEditorY,dataToEditorX}=(0,useUnits.A)((state=>({editorToDataX:state.actions.editorToDataX,editorToDataY:state.actions.editorToDataY,dataToEditorY:state.actions.dataToEditorY,dataToEditorX:state.actions.dataToEditorX})));return{onResizeGroup:({events})=>{events.forEach((({target,direction,width,height,drag},i)=>{const sFrame=frames[i],{element,updateForResizeEvent}=targetList[i],{border,type}=element,{resizeRules}=(0,elements_src.zh)(type),minWidth=dataToEditorX(resizeRules.minWidth),minHeight=dataToEditorY(resizeRules.minHeight),{left=0,right=0,top=0,bottom=0}=border||{};let newWidth=width-(left+right),newHeight=height-(top+bottom);const aspectRatio=element.width/element.height;newWidth<minWidth&&(newWidth=minWidth,newHeight=newWidth/aspectRatio),newHeight<minHeight&&(newHeight=minHeight,newWidth=minHeight*aspectRatio);let updates=null;updateForResizeEvent&&(updates=updateForResizeEvent(element,direction,editorToDataX(newWidth),editorToDataY(newHeight))),updates&&updates.height&&(newHeight=dataToEditorY(updates.height));const frameWidth=newWidth+left+right,frameHeight=newHeight+top+bottom;target.style.width=`${frameWidth}px`,target.style.height=`${frameHeight}px`,sFrame.direction=direction,sFrame.resize=[frameWidth,frameHeight],sFrame.translate=drag.beforeTranslate,sFrame.updates=updates,setTransformStyle(element,target,sFrame)}))},onResizeGroupStart:({events})=>{events.forEach(((ev,i)=>{const frame=frames[i];ev.setOrigin(["%","%"]),ev.dragStart&&ev.dragStart.set(frame.translate)}))},onResizeGroupEnd:({targets})=>{onGroupEventEnd({targets,isResize:!0})}}};const multiSelectionMoveable_useRotate=function useRotate_useRotate({onGroupEventStart,setTransformStyle,onGroupEventEnd,targetList,frames}){return{onRotateGroup:({events})=>{events.forEach((({target,beforeRotate,drag},i)=>{const sFrame=frames[i],{element}=targetList[i];sFrame.rotate=utils_normalizeRotationDegrees(beforeRotate),sFrame.translate=drag.beforeTranslate,setTransformStyle(element,target,sFrame)}))},onRotateGroupEnd:({targets})=>{onGroupEventEnd({targets,isRotate:!0})},onRotateGroupStart:({events})=>{onGroupEventStart({events,isRotate:!0})},throttleRotate:(0,keyboard.A3)("shift")?30:0}};function multiSelectionMoveable_extends(){return multiSelectionMoveable_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},multiSelectionMoveable_extends.apply(this,arguments)}const CORNER_HANDLES=["nw","ne","sw","se"],multiSelectionMoveable=(0,src.Rf)((function MultiSelectionMoveable({selectedElements,...props},ref){const moveable=(0,src.li)(),[isDragging,setIsDragging]=(0,src.J0)(!1),isAnyLayerLocked=selectedElements.some((el=>el.isLocked)),actionsEnabled=!isAnyLayerLocked,{updateElementsById,deleteElementsById,backgroundElement}=(0,app.P3)((state=>({updateElementsById:state.actions.updateElementsById,deleteElementsById:state.actions.deleteElementsById,backgroundElement:state.state.currentPage.elements[0]??{}}))),{nodesById,fullbleedContainer}=(0,app.yu)((({state:{nodesById,fullbleedContainer}})=>({fullbleedContainer,nodesById}))),{editorToDataX,editorToDataY}=(0,useUnits.A)((state=>({editorToDataX:state.actions.editorToDataX,editorToDataY:state.actions.editorToDataY}))),{zoomSetting,scrollLeft,scrollTop}=(0,app.gK)((({state:{zoomSetting,scrollLeft,scrollTop}})=>({zoomSetting,scrollLeft,scrollTop}))),{actions:{pushTransform}}=(0,transform_src.Gy)();canvas_useWindowResizeHandler(moveable),(0,src.vJ)((()=>{moveable.current&&moveable.current.updateRect()}),[selectedElements,moveable,nodesById,scrollLeft,scrollTop]),utils_useUpdateSelectionRectangle(moveable,[zoomSetting]);const targetList=selectedElements.map((element=>({element,node:nodesById[element.id],updateForResizeEvent:(0,elements_src.zh)(element.type).updateForResizeEvent}))),setTransformStyle=(element,target,frame)=>{const{id,border}=element;target.style.transform=`translate(${frame.translate[0]}px, ${frame.translate[1]}px) rotate(${frame.rotate}deg)`;const{left=0,right=0,top=0,bottom=0}=border||{};let frameForEl={...frame};if((frame.resize[0]||frame.resize[1])&&(0,masks_src.Fn)(element)){const elWidth=frame.resize[0]-(left+right),elHeight=frame.resize[1]-(top+bottom);frameForEl={...frame,resize:[elWidth,elHeight]}}pushTransform(id,frameForEl)},frames=targetList?targetList.map((({element})=>({translate:[0,0],rotate:element.rotationAngle,direction:[0,0],resize:[0,0],updates:null}))):[],onGroupEventStart=({events,isDrag,isRotate})=>{events.forEach(((ev,i)=>{const sFrame=frames[i];isDrag?ev.set(sFrame.translate):isRotate&&ev.set(sFrame.rotate)}))},onGroupEventEnd=({targets,isRotate,isResize})=>{const updates={},toRemove=[];targets.forEach(((target,i)=>{const{element,updateForResizeEvent}=targetList[i];if((0,isTargetOutOfContainer.A)(target,fullbleedContainer))return void toRemove.push(element.id);const frame=frames[i],{direction}=frame,roundToZero=num=>Math.abs(num)<=1?0:num,properties={x:roundToZero(element.x+editorToDataX(frame.translate[0])),y:roundToZero(element.y+editorToDataY(frame.translate[1]))};isRotate&&(properties.rotationAngle=frame.rotate);const[editorWidth,editorHeight]=frame.resize;if(isResize&&(0!==editorWidth&&0!==editorHeight)){const{border}=element,{left=0,right=0,top=0,bottom=0}=border||{},newWidth=editorToDataX(editorWidth-(left+right)),newHeight=editorToDataY(editorHeight-(top+bottom));properties.width=newWidth,properties.height=newHeight,updateForResizeEvent&&Object.assign(properties,updateForResizeEvent(element,direction,newWidth,newHeight))}updates[element.id]=properties})),updateElementsById({elementIds:Object.keys(updates),properties:currentProperties=>updates[currentProperties.id]}),toRemove.length>0&&deleteElementsById({elementIds:toRemove}),targetList.forEach((({element,node},i)=>{frames[i].direction=[0,0],frames[i].translate=[0,0],frames[i].resize=[0,0],frames[i].updates=null,node.style.transform="",node.style.width="",node.style.height="",pushTransform(element.id,null)})),moveable.current&&moveable.current.updateRect()},otherNodes=Object.values((0,objectWithout.A)(nodesById,[...selectedElements.map((element=>element.id)),backgroundElement.id])),snapProps=(0,useSnapping.A)({canSnap:!0,otherNodes}),dragProps=multiSelectionMoveable_useDrag({targetList,frames,setTransformStyle,onGroupEventStart,onGroupEventEnd,isDragging,setIsDragging}),resizeProps=multiSelectionMoveable_useResize({onGroupEventEnd,targetList,setTransformStyle,frames}),rotateProps=multiSelectionMoveable_useRotate({onGroupEventStart,setTransformStyle,onGroupEventEnd,targetList,frames}),combinedRef=(0,src.jn)(moveable,ref);if(targetList.some((({node})=>void 0===node)))return null;const classNames=classnames_default()("default-moveable",{"hide-handles":isDragging,immoveable:isAnyLayerLocked});return react.createElement(moveable_src.uW,multiSelectionMoveable_extends({},props,{className:classNames,ref:combinedRef,zIndex:0,target:targetList.map((({node})=>node)),renderDirections:CORNER_HANDLES},dragProps,{draggable:actionsEnabled,resizable:actionsEnabled,rotatable:actionsEnabled},rotateProps,resizeProps,snapProps))}));function selection_extends(){return selection_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},selection_extends.apply(this,arguments)}const selection=function Selection(props){const isBackground=(0,app.P3)((({state})=>state.selectedElements[0]?.id===state.currentPage?.elements?.[0]?.id)),{selectedElements,isAnimating}=(0,app.P3)((state=>({selectedElements:state.state.selectedElements,isAnimating:[animation_src.TR.Playing,animation_src.TR.PlayingSelected,animation_src.TR.Scrubbing].includes(state.state.animationState)}))),{editingElement,lastSelectionEvent,nodesById,onMoveableMount}=(0,app.yu)((({state:{editingElement,lastSelectionEvent,nodesById,onMoveableMount}})=>({editingElement,lastSelectionEvent,nodesById,onMoveableMount})));if(0===selectedElements.length)return null;if(isBackground)return null;const isVideoPlaceholder=selectedElements[0]?.resource?.isPlaceholder;if(isVideoPlaceholder)return null;if(editingElement||isAnimating)return null;if(1===selectedElements.length){const selectedElement=selectedElements[0],target=nodesById[selectedElement.id];return target?react.createElement(singleSelectionMoveable,selection_extends({selectedElement,targetEl:target,pushEvent:lastSelectionEvent},props,onMoveableMount&&{ref:onMoveableMount})):null}return react.createElement(multiSelectionMoveable,selection_extends({selectedElements},props,onMoveableMount&&{ref:onMoveableMount}))};var arrow_left_large=__webpack_require__("./packages/design-system/src/icons/arrow_left_large.svg");const pagenav_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"pagenav__Wrapper",componentId:"sc-j8q0gt-0"})(["display:flex;align-items:center;color:",";& > *{pointer-events:initial;}"],(({theme})=>theme.colors.fg.white)),FlippableArrow=(0,styled_components_browser_esm.Ay)(arrow_left_large.A).withConfig({displayName:"pagenav__FlippableArrow",componentId:"sc-j8q0gt-1"})(["transform:rotate(","turn);"],(({$isLeft})=>$isLeft?0:.5));const pagenav=function PageNav({isNext=!0}){const{pages,currentPageIndex,setCurrentPage}=(0,app.P3)((({state:{pages,currentPageIndex},actions:{setCurrentPage}})=>({pages,currentPageIndex,setCurrentPage}))),{isRTL}=(0,app.UK)(),buttonRef=(0,src.li)(null),cancelMouseDown=(0,src.hb)((evt=>evt.stopPropagation()),[]),handleClick=(0,src.hb)((()=>{const newPage=isNext?pages[currentPageIndex+1]:pages[currentPageIndex-1];newPage&&setCurrentPage({pageId:newPage.id})}),[setCurrentPage,currentPageIndex,isNext,pages]),{hasPageNavigation}=(0,app.gK)((({state:{hasPageNavigation}})=>({hasPageNavigation})));if((0,usePerformanceTracking.A)({node:buttonRef.current,eventData:constants.Zy.PAGE_NAVIGATION}),!hasPageNavigation)return!1;const displayNav=isNext&&currentPageIndex<pages.length-1||!isNext&&currentPageIndex>0,isLeft=isRTL===isNext;return react.createElement(pagenav_Wrapper,null,react.createElement(button_button.$,{ref:buttonRef,variant:button_constants.Ak.Square,type:button_constants.VQ.Tertiary,size:button_constants.Mp.Medium,"aria-disabled":!displayNav,"aria-label":isNext?(0,i18n.__)("Next Page","web-stories"):(0,i18n.__)("Previous Page","web-stories"),onClick:handleClick,onMouseDown:cancelMouseDown},react.createElement(FlippableArrow,{$isLeft:isLeft})))},FramesPageArea=(0,styled_components_browser_esm.Ay)(PageArea).withConfig({displayName:"framesLayer__FramesPageArea",componentId:"sc-5ltl4w-0"})(["pointer-events:initial;"]),marginRatio=constants.Jg/src_constants.bj*100,FocusContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"framesLayer__FocusContainer",componentId:"sc-5ltl4w-1"})(["grid-row:2 / -1;grid-column:1 / -1;margin:5px;",";"],outline.Q),FOCUS_CONTAINER_MESSAGE=(0,i18n.__)("Canvas Area. To navigate into the page, press Enter.","web-stories"),framesLayer_FRAME_ELEMENT_MESSAGE=(0,i18n.__)("To exit the canvas area, press Escape. Press Tab to move to the next group or element.","web-stories"),DesignSpaceGuidelineBorder=styled_components_browser_esm.Ay.div.withConfig({displayName:"framesLayer__DesignSpaceGuidelineBorder",componentId:"sc-5ltl4w-2"})(["border:1px solid ",";left:","%;right:","%;top:0;bottom:0;position:absolute;pointer-events:none;z-index:1;visibility:",";"],(({theme})=>theme.colors.border.negativePress),marginRatio,marginRatio,(({isVisible})=>isVisible?"visible":"hidden"));function DesignSpaceGuideline(){const setDesignSpaceGuideline=(0,app.yu)((({actions})=>actions.setDesignSpaceGuideline)),{isAnythingTransforming}=(0,app.Gy)((({state})=>({isAnythingTransforming:state.isAnythingTransforming})));return react.createElement(DesignSpaceGuidelineBorder,{ref:setDesignSpaceGuideline,isVisible:isAnythingTransforming})}function FramesNavAndSelection({children}){const framesLayerRef=(0,src.li)(null),onOpenMenu=(0,app.lS)((state=>state.onOpenMenu));return(0,keyboard._h)(framesLayerRef,"mod+alt+shift+m",(evt=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"tab"})),onOpenMenu(evt)})),react.createElement(Layer,{ref:framesLayerRef,"data-testid":"FramesLayer",pointerEvents:"initial",tabIndex:"-1","aria-label":(0,i18n.__)("Frames layer","web-stories")},children,react.createElement(PageBeforeArea,null,react.createElement(extraPages,{isPrevious:!0})),react.createElement(PageAfterArea,null,react.createElement(extraPages,null)),react.createElement(NavPrevArea,null,react.createElement(pagenav,{isNext:!1})),react.createElement(NavNextArea,null,react.createElement(pagenav,null)),react.createElement(selection,{onContextMenu:onOpenMenu}))}function FrameElements(){const elementIds=(0,app.P3)((({state})=>state.currentPage?.elements?.map((el=>el.id))||constants.qW)),isAnimating=(0,app.P3)((({state})=>[animation_src.TR.Playing,animation_src.TR.Scrubbing].includes(state.animationState))),onOpenMenu=(0,app.lS)((state=>state.onOpenMenu)),{setScrollOffset}=(0,app.gK)((({actions:{setScrollOffset}})=>({setScrollOffset}))),onScroll=(0,src.hb)((evt=>setScrollOffset({left:evt.target.scrollLeft,top:evt.target.scrollTop})),[setScrollOffset]);return!isAnimating&&react.createElement(FramesPageArea,{fullBleedContainerLabel:(0,i18n.__)("Fullbleed area (Frames layer)","web-stories"),onContextMenu:onOpenMenu,onScroll},elementIds.map((id=>react.createElement(frameElement,{key:id,id}))),react.createElement(DesignSpaceGuideline,null))}const framesLayer=(0,src.ph)((function FramesLayer(){const canvasRef=(0,src.li)(),speak=(0,useLiveRegion.A)(),{enterFocusGroup,setFocusGroupCleanup}=(0,editLayerFocusManager.in)((({enterFocusGroup,setFocusGroupCleanup})=>({enterFocusGroup,setFocusGroupCleanup})));return(0,keyboard.pP)({key:"mod+option+2",editable:!0},(()=>{enterFocusGroup({groupId:editLayerFocusManager.wn.ELEMENT_SELECTION})}),[enterFocusGroup]),canvas_useCanvasKeys(canvasRef),(0,keyboard._h)(canvasRef,{key:["enter"]},(()=>{enterFocusGroup({groupId:editLayerFocusManager.wn.ELEMENT_SELECTION}),speak(framesLayer_FRAME_ELEMENT_MESSAGE)}),[enterFocusGroup,speak]),(0,react.useEffect)((()=>{setFocusGroupCleanup({groupId:editLayerFocusManager.wn.ELEMENT_SELECTION,cleanup:()=>canvasRef.current?.focus()})}),[setFocusGroupCleanup]),react.createElement(FramesNavAndSelection,null,react.createElement(FocusContainer,{role:"region","data-testid":"canvas-focus-container",ref:canvasRef,"aria-label":FOCUS_CONTAINER_MESSAGE,tabIndex:0}),react.createElement(FrameElements,null))}));var checklist=__webpack_require__("./packages/story-editor/src/components/checklist/index.js"),keyboardShortcutsMenuContext=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/keyboardShortcutsMenuContext/index.ts"),CSSTransition=__webpack_require__("./node_modules/react-transition-group/esm/CSSTransition.js"),arrow_left=__webpack_require__("./packages/design-system/src/icons/arrow_left.svg");const context=(0,src.q6)({state:{pageThumbWidth:0,pageThumbHeight:0,pageThumbMargin:0,carouselWidth:0,hasOverflow:!1,pages:[],pageIds:[],numPages:0,currentPageId:null,canScrollBack:!1,canScrollForward:!1,showSkeleton:!1},actions:{scrollBack:noop.l,scrollForward:noop.l,clickPage:noop.l,rearrangePages:noop.l,setListRef:noop.l,setPageRef:noop.l}});const carouselContext_useCarousel=function useCarousel(selector=src.D_){return(0,src.i7)(context,selector)};var idleCallback=__webpack_require__("./packages/story-editor/src/utils/idleCallback.ts");const carouselContext_useCarouselSizing=function useCarouselSizing({availableSpace,numPages}){return(0,src.Kr)((()=>{const isWideCarousel=availableSpace>=400,spaceForCarousel=availableSpace-2*NAVIGATION_BUTTON_GUTTER,pageThumbWidth=isWideCarousel?45:36,pageThumbHeight=isWideCarousel?80:64,pageAndMargin=pageThumbWidth+16,showablePages=Math.floor((spaceForCarousel-16)/pageAndMargin),hasOverflow=showablePages<numPages;return{pageThumbWidth,pageThumbHeight,pageThumbMargin:16,carouselWidth:Math.min(showablePages,numPages)*(pageThumbWidth+16)+16,showablePages,hasOverflow}}),[availableSpace,numPages])};var config=__webpack_require__("./packages/story-editor/src/app/config/index.ts");const carouselContext_useCarouselScroll=function useCarouselScroll({listElement,carouselWidth,hasOverflow,showablePages,pageThumbWidth,pageThumbMargin}){const[ratio,setRatio]=(0,src.J0)(0),{isRTL}=(0,config.UK)(),{carouselState}=(0,layout.g)((({state:{carouselState}})=>({carouselState}))),{currentPageIndex}=(0,story.P3)((({state:{currentPageId,pages}})=>({currentPageIndex:pages.findIndex((({id})=>id===currentPageId))}))),scroll=(0,src.hb)((offset=>{listElement&&(isRTL&&(offset*=-1),listElement.scrollBy?listElement.scrollBy({left:offset,behavior:"smooth"}):listElement.scrollLeft+=offset)}),[listElement,isRTL]),scrollByPx=carouselWidth,canScrollBack=hasOverflow&&!(0===ratio),canScrollForward=hasOverflow&&!(isRTL?-1===ratio:1===ratio),scrollForward=(0,src.hb)((()=>scroll(scrollByPx)),[scroll,scrollByPx]),scrollBack=(0,src.hb)((()=>scroll(-scrollByPx)),[scroll,scrollByPx]);(0,src.Nf)((()=>{if(!hasOverflow||!listElement)return;const handleScroll=()=>{const{offsetWidth,scrollLeft,scrollWidth}=listElement;setRatio(scrollLeft/(scrollWidth-offsetWidth))};return listElement.addEventListener("scroll",handleScroll,{passive:!0}),()=>listElement.removeEventListener("scroll",handleScroll)}),[listElement,hasOverflow]);const getOffsetFromIndex=(0,src.hb)((index=>(pageThumbWidth+pageThumbMargin)*index),[pageThumbWidth,pageThumbMargin]),firstScroll=(0,src.li)(!0);return(0,src.vJ)((()=>{carouselState===constants.Wc.Closed&&(firstScroll.current=!0)}),[carouselState]),(0,src.Nf)((()=>{if(!hasOverflow||!listElement)return;const{scrollLeft}=listElement,minVisiblePageIndex=Math.max(0,currentPageIndex-showablePages+1),maxVisiblePageIndex=currentPageIndex,minOffset=getOffsetFromIndex(minVisiblePageIndex),maxOffset=getOffsetFromIndex(maxVisiblePageIndex);if(scrollLeft>=minOffset&&scrollLeft<=maxOffset)return;const targetLeft=scrollLeft<minOffset?minOffset:maxOffset,retry=setInterval((()=>{if(listElement.scrollWidth-listElement.offsetWidth<targetLeft)return;const scrollBehavior=firstScroll.current?"auto":"smooth";firstScroll.current=!1,listElement.scrollTo({left:targetLeft,top:0,behavior:scrollBehavior}),clearInterval(retry)}),100);return()=>clearInterval(retry)}),[listElement,hasOverflow,currentPageIndex,showablePages,getOffsetFromIndex]),{canScrollBack,canScrollForward,scrollForward,scrollBack}};function getArrowDir(key,pos,neg,isRTL){const rtlDir=isRTL?-1:1;return key===pos?rtlDir:key===neg?-rtlDir:0}const carouselContext_useCarouselKeys=function useCarouselKeys({listElement,pageRefs}){const{isRTL}=(0,config.UK)(),{addPageAt,arrangePage,currentPage,currentPageId,deletePage,pages,setCurrentPage}=(0,story.P3)((({state:{pages,currentPage,currentPageId},actions:{addPageAt,arrangePage,deletePage,setCurrentPage}})=>({addPageAt,arrangePage,currentPage,currentPageId,deletePage,pages,setCurrentPage}))),pageIds=(0,src.Kr)((()=>pages.map((({id})=>id))),[pages]);(0,keyboard.A0)(listElement,[listElement]),(0,keyboard._h)(listElement,{key:["up","down","left","right"]},(({key})=>{const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;if(!currentPageId)return;const nextIndex=pageIds.indexOf(currentPageId)+dir;if(nextIndex>=0&&nextIndex<pageIds.length){const pageId=pageIds[nextIndex];setCurrentPage({pageId});const thumbnail=pageRefs.current&&pageRefs.current[pageId],button=thumbnail?.querySelector("button");button&&button.focus()}}),[currentPageId,isRTL,pageIds,setCurrentPage,pageRefs,listElement]),(0,keyboard._h)(listElement,{key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(evt=>{const{key,shiftKey}=evt;evt.preventDefault();const dir=getArrowDir(key,"ArrowRight","ArrowLeft",isRTL);if(0===dir)return;if(!currentPageId)return;const index=pageIds.indexOf(currentPageId);let newPos=index+dir;shiftKey&&(newPos=dir<0?0:pageIds.length-1),newPos!==index&&newPos>=0&&newPos<pageIds.length&&arrangePage({pageId:currentPageId,position:newPos})}),[arrangePage,currentPageId,isRTL,pageIds,setCurrentPage]),(0,keyboard._h)(listElement,"delete",(()=>{deletePage({pageId:currentPageId});const currentElement=document.activeElement,setFocusWhenActiveElementChanges=()=>{if(document.activeElement!==currentElement&&listElement){const focusableOption=listElement.querySelector('[role="option"][tabindex="0"]');if(focusableOption)return void focusableOption.focus()}setTimeout(setFocusWhenActiveElementChanges,100)};setFocusWhenActiveElementChanges()}),[currentPageId,deletePage,listElement]),(0,keyboard._h)(listElement,"clone",(()=>{if(!currentPage)return;const index=pageIds.indexOf(currentPage.id);addPageAt({page:(0,elements_src.hi)(currentPage),position:index+1})}),[addPageAt,currentPage,pageIds])};const carouselProvider=function CarouselProvider({availableSpace,children}){const{pages,currentPageId,setCurrentPage,arrangePage}=(0,story.P3)((({state:{pages,currentPageId},actions:{setCurrentPage,arrangePage}})=>({pages,currentPageId,setCurrentPage,arrangePage}))),[listElement,setListElement]=(0,src.J0)(null),pageRefs=(0,src.li)({}),numPages=pages.length,pageIds=(0,src.Kr)((()=>pages.map((({id})=>id))),[pages]),[showSkeleton,setShowSkeleton]=(0,src.J0)(!0);(0,src.vJ)((()=>{const id=(0,idleCallback.B)((()=>setShowSkeleton(!1)),{timeout:5e3});return()=>(0,idleCallback.G)(id)}),[]);const{pageThumbWidth,pageThumbHeight,pageThumbMargin,carouselWidth,hasOverflow,showablePages}=carouselContext_useCarouselSizing({availableSpace,numPages}),{canScrollBack,canScrollForward,scrollBack,scrollForward}=carouselContext_useCarouselScroll({listElement,carouselWidth,hasOverflow,showablePages,pageThumbWidth,pageThumbMargin});carouselContext_useCarouselKeys({listElement,pageRefs});const setPageRef=(0,src.hb)(((page,el)=>{pageRefs.current[page.id]=el}),[]),clickPage=(0,src.hb)((page=>setCurrentPage({pageId:page.id})),[setCurrentPage]),rearrangePages=(0,src.hb)((({position:oldPos},{position:newPos})=>{const pageId=pageIds[oldPos];arrangePage({pageId,position:newPos}),setCurrentPage({pageId})}),[pageIds,arrangePage,setCurrentPage]),value={state:{pageThumbWidth,pageThumbHeight,pageThumbMargin,carouselWidth,hasOverflow,pages,pageIds,numPages,currentPageId,canScrollBack,canScrollForward,showSkeleton},actions:{scrollBack,scrollForward,clickPage,rearrangePages,setListRef:setListElement,setPageRef}};return react.createElement(context.Provider,{value},children)},carouselScroll_FlippableArrow=(0,styled_components_browser_esm.Ay)(arrow_left.A).withConfig({displayName:"carouselScroll__FlippableArrow",componentId:"sc-1npfzcu-0"})(["transform:rotate(","turn);"],(({$isLeft})=>$isLeft?0:.5));function CarouselScrollButton({isNext=!1}){const{hasOverflow,canScrollBack,canScrollForward,scrollBack,scrollForward}=carouselContext_useCarousel((({state:{hasOverflow,canScrollBack,canScrollForward},actions:{scrollBack,scrollForward}})=>({hasOverflow,canScrollBack,canScrollForward,scrollBack,scrollForward}))),{isRTL}=(0,app.UK)();if(!hasOverflow)return null;const canScroll=isNext?canScrollForward:canScrollBack,onClick=isNext?scrollForward:scrollBack,label=isNext?(0,i18n.__)("Scroll Forward","web-stories"):(0,i18n.__)("Scroll Back","web-stories"),isLeft=isRTL===isNext;return react.createElement(button_button.$,{variant:button_constants.Ak.Square,type:button_constants.VQ.Plain,size:button_constants.Mp.Small,disabled:!canScroll,onClick,"aria-label":label},react.createElement(carouselScroll_FlippableArrow,{$isLeft:isLeft}))}function CarouselScrollForward(){return react.createElement(CarouselScrollButton,{isNext:!0})}function CarouselScrollBack(){return react.createElement(CarouselScrollButton,null)}const reorderable_context=(0,src.q6)({state:{},actions:{}});const reorderable_useReordering=function useReordering(onPositionChange,numChildren){const[isReordering,setIsReordering]=(0,src.J0)(!1),[currentSeparator,setCurrentSeparator]=(0,src.J0)(null),[currentPosition,setCurrentPosition]=(0,src.J0)(null),[dragTarget,setDragTarget]=(0,src.J0)(null),speak=(0,useLiveRegion.A)("assertive"),handleStartReordering=(0,src.hb)((({position:currentPos,data={},onStartReordering=noop.l})=>evt=>{const isModified=evt.shiftKey||evt.metaKey||evt.ctrlKey||evt.altKey,isLeftButton=0===evt.button;!isModified&&isLeftButton&&(onStartReordering(),setCurrentPosition({position:currentPos,data}),setDragTarget(evt.target))}),[]),separator=(0,src.li)(null);return(0,src.vJ)((()=>{separator.current=currentSeparator}),[currentSeparator]),(0,src.vJ)((()=>{if(!dragTarget)return;const onRelease=evt=>{if(evt.preventDefault(),null!==separator.current){const newPosition=separator.current,position=newPosition.position>currentPosition.position?newPosition.position-1:newPosition.position;onPositionChange(currentPosition,{...separator.current,position},evt)}setDragTarget(null)},onMove=()=>setIsReordering(!0),onAbort=evt=>{"Escape"===evt.key&&(setDragTarget(null),evt.stopPropagation())};return dragTarget.ownerDocument.addEventListener("pointerup",onRelease),dragTarget.ownerDocument.addEventListener("keydown",onAbort,!0),dragTarget.addEventListener("pointermove",onMove),()=>{setCurrentSeparator(null),setIsReordering(!1),dragTarget.removeEventListener("pointermove",onMove),dragTarget.ownerDocument.removeEventListener("pointerup",onRelease),dragTarget.ownerDocument.removeEventListener("keydown",onAbort,!0)}}),[dragTarget,currentPosition,setCurrentSeparator,setIsReordering,onPositionChange]),(0,src.vJ)((()=>{if(isReordering&&currentSeparator){const position=numChildren-currentSeparator.position,message=(0,sprintf.A)((0,i18n.__)("Reordering. Press Escape to abort. Release mouse to drop in position %d.","web-stories"),String(position));speak(message)}}),[isReordering,currentSeparator,numChildren,speak]),{isReordering,currentSeparator,setCurrentSeparator,handleStartReordering,currentPosition}},Scroller=styled_components_browser_esm.Ay.div.withConfig({displayName:"reorderableScroller__Scroller",componentId:"sc-lvxibs-0"})(["z-index:3;opacity:0;position:sticky;"]),HorizontalScroller=(0,styled_components_browser_esm.Ay)(Scroller).withConfig({displayName:"reorderableScroller__HorizontalScroller",componentId:"sc-lvxibs-1"})(["padding-left:","px;height:100%;",""],(({size})=>size),(({direction,size})=>-1===direction?`\n        left: 0px;\n        margin-right: -${size}px;\n        `:`\n        right: 0px;\n        margin-left: -${size}px;\n        `)),VerticalScroller=(0,styled_components_browser_esm.Ay)(Scroller).withConfig({displayName:"reorderableScroller__VerticalScroller",componentId:"sc-lvxibs-2"})(["padding-top:","px;width:100%;",""],(({size})=>size),(({direction,size})=>-1===direction?`\n        top: 0px;\n        margin-bottom: -${size}px;\n        `:`\n        bottom: 0px;\n        margin-top: -${size}px;\n        `));const reorderableScroller=(0,src.ph)((function ReorderableScroller({direction,size}){const{state:{canScrollEnd,canScrollStart,mode},actions:{startScroll}}=(0,src.NT)(reorderable_context),[isHovering,setIsHovering]=(0,src.J0)(!1),handlePointerEnter=(0,src.hb)((()=>setIsHovering(!0)),[]),handlePointerLeave=(0,src.hb)((()=>setIsHovering(!1)),[]);(0,src.vJ)((()=>{if(isHovering)return startScroll(direction)}),[direction,startScroll,isHovering]);const isVisible=-1===direction&&canScrollStart||1===direction&&canScrollEnd;if((0,src.vJ)((()=>{isVisible||setIsHovering(!1)}),[isVisible]),!isVisible)return null;const ScrollerElement="horizontal"===mode?HorizontalScroller:VerticalScroller;return react.createElement(ScrollerElement,{size,direction,onPointerEnter:handlePointerEnter,onPointerLeave:handlePointerLeave,mode})}));const reorderable_useScroll=function useScroll(mode="horizontal",isReordering,scrollTarget,size){const[hasScrollAbove,setHasScrollAbove]=(0,src.J0)(!1),[hasScrollBelow,setHasScrollBelow]=(0,src.J0)(!1),[scrollDirection,setScrollDirection]=(0,src.J0)(0),updateScrollMarkers=(0,src.T0)((()=>{const node=scrollTarget.current;if(node)if("horizontal"===mode){const possibleScroll=node.scrollWidth-node.clientWidth;possibleScroll<=0?(setHasScrollAbove(!1),setHasScrollBelow(!1)):(setHasScrollAbove(node.scrollLeft>0),setHasScrollBelow(node.scrollLeft<possibleScroll))}else{const possibleScroll=node.scrollHeight-node.clientHeight;possibleScroll<=0?(setHasScrollAbove(!1),setHasScrollBelow(!1)):(setHasScrollAbove(node.scrollTop>0),setHasScrollBelow(node.scrollTop<possibleScroll))}}),[mode,scrollTarget]),startScroll=(0,src.hb)((dir=>(setScrollDirection(dir),()=>setScrollDirection(0))),[setScrollDirection]),canScrollStart=isReordering&&hasScrollAbove,canScrollEnd=isReordering&&hasScrollBelow;return(0,src.vJ)((()=>{if(0===scrollDirection||!(canScrollStart&&scrollDirection<0||canScrollEnd&&scrollDirection>0))return;let mounted=!0;const update=()=>{const scrollStep=Math.max(Math.min(.2*size,10),0);"horizontal"===mode?scrollTarget.current.scrollLeft+=scrollDirection*scrollStep:scrollTarget.current.scrollTop+=scrollDirection*scrollStep,updateScrollMarkers(),mounted&&window.requestAnimationFrame(update)};return update(),()=>{mounted=!1}}),[scrollDirection,updateScrollMarkers,canScrollStart,canScrollEnd,size,mode,scrollTarget]),(0,src.vJ)((()=>updateScrollMarkers()),[isReordering,updateScrollMarkers]),{startScroll,canScrollEnd,canScrollStart}};function reorderable_extends(){return reorderable_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},reorderable_extends.apply(this,arguments)}const ReorderableContainer=styled_components_browser_esm.Ay.div.attrs({role:"listbox"}).withConfig({displayName:"reorderable__ReorderableContainer",componentId:"sc-plmujd-0"})(["display:flex;"]),reorderable=(0,src.Rf)((function Reorderable({children,onPositionChange,getItemSize,scrollSize=null,mode="horizontal",...props},forwardedRef){const ref=(0,src.li)(null),containerRef=forwardedRef||ref,{isReordering,currentSeparator,setCurrentSeparator,handleStartReordering,currentPosition}=reorderable_useReordering(onPositionChange,children.length),{startScroll,canScrollEnd,canScrollStart}=reorderable_useScroll(mode,isReordering,containerRef,getItemSize()),state={state:{isReordering,currentSeparator,containerRef,mode,canScrollEnd,canScrollStart,currentPosition},actions:{setCurrentSeparator,handleStartReordering,startScroll}},scrollerSize=scrollSize||getItemSize();return react.createElement(reorderable_context.Provider,{value:state},react.createElement(ReorderableContainer,reorderable_extends({ref:containerRef},props),react.createElement(reorderableScroller,{direction:-1,size:scrollerSize}),children,react.createElement(reorderableScroller,{direction:1,size:scrollerSize})))}));const reorderable_useReorderable=function useReorderable(selector){return(0,src.i7)(reorderable_context,selector??src.D_)};function reorderableItem_extends(){return reorderableItem_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},reorderableItem_extends.apply(this,arguments)}const Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"reorderableItem__Container",componentId:"sc-5aswet-0"})(["z-index:1;"]);const reorderableItem=function ReorderableItem({children,position,onStartReordering,disabled,data,...props}){const handleStartReordering=reorderable_useReorderable((({actions})=>actions.handleStartReordering));return react.createElement(Container,reorderableItem_extends({},disabled?null:{onPointerDown:handleStartReordering({position,onStartReordering,data})},props),children)},nestedOffsetCalcFunc=evt=>evt.offsetY<35/1.7;function reorderableSeparator_extends(){return reorderableSeparator_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},reorderableSeparator_extends.apply(this,arguments)}const reorderableSeparator_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"reorderableSeparator__Wrapper",componentId:"sc-1tnz6qo-0"})(["opacity:0;position:relative;z-index:",";&:hover{opacity:",";}"],(({isReordering,isNested})=>isReordering?isNested?3:2:-1),(({isReordering})=>isReordering?1:0)),Line=styled_components_browser_esm.Ay.div.withConfig({displayName:"reorderableSeparator__Line",componentId:"sc-1tnz6qo-1"})(["height:4px;margin:0 0 -4px;background:",";width:100%;"," width:",""],(({theme})=>theme.colors.accent.secondary),(({isNested})=>isNested&&"margin-left: 30px;"),(({isNested})=>isNested?"calc(100% - 30px)":"100%"));const reorderableSeparator=function ReorderableSeparator({position,groupId=null,isNested=!1,nestedOffset=!1,nestedOffsetCalcFunc=noop.l,children=null,...props}){const separatorRef=(0,src.li)(null),[isTempNested,setIsTempNested]=(0,src.J0)(!1),{isReordering,setCurrentSeparator}=reorderable_useReorderable((({state,actions})=>{const currentPosition=state.currentPosition?.position,isNextToCurrentItem=currentPosition===position||currentPosition===position-1;return{isReordering:state.isReordering&&!isNextToCurrentItem,isNextToCurrentItem,setCurrentSeparator:actions.setCurrentSeparator}})),handlePointerEnter=(0,src.hb)((()=>{isReordering&&setCurrentSeparator({position,data:{groupId}})}),[setCurrentSeparator,isReordering,position,groupId]);return null===children&&(children=react.createElement(Line,{isNested:isNested||isTempNested})),react.createElement(reorderableSeparator_Wrapper,reorderableSeparator_extends({onPointerOver:handlePointerEnter,onPointerMove:evt=>{nestedOffset&&setIsTempNested(nestedOffsetCalcFunc(evt.nativeEvent))},ref:separatorRef,isReordering,isNested:isNested||isTempNested},props),children)},carouselPage_Line=styled_components_browser_esm.Ay.div.withConfig({displayName:"carouselPage__Line",componentId:"sc-mvqls9-0"})(["background:",";height:","px;width:","px;margin:0px;"],(({theme})=>theme.colors.border.selection),(({$height})=>$height),4),ItemContainer=styled_components_browser_esm.Ay.li.attrs({role:"presentation"}).withConfig({displayName:"carouselPage__ItemContainer",componentId:"sc-mvqls9-1"})(["display:flex;position:relative;margin:0;padding:0;"]),PageSeparator=(0,styled_components_browser_esm.Ay)(reorderableSeparator).withConfig({displayName:"carouselPage__PageSeparator",componentId:"sc-mvqls9-2"})(["position:absolute;bottom:0;left:","px;width:","px;height:","px;display:flex;justify-content:center;",":first-of-type &:first-of-type,",":last-of-type &:last-of-type{width:","px;}",":first-of-type &:first-of-type{left:","px;justify-content:flex-start;}",":first-of-type &:last-of-type{left:","px;}",":last-of-type &:last-of-type{justify-content:flex-end;}"],(({$width})=>$width/2),(({$width,margin})=>$width+margin),(({$height})=>$height),ItemContainer,ItemContainer,(({$width,margin})=>($width+margin+4)/2),ItemContainer,(({margin})=>(margin-4)/2),ItemContainer,(({$width,margin})=>margin+$width/2),ItemContainer),ReorderablePage=(0,styled_components_browser_esm.Ay)(reorderableItem).withConfig({displayName:"carouselPage__ReorderablePage",componentId:"sc-mvqls9-3"})(["display:flex;z-index:1;margin-right:","px;margin-left:","px;"],(({margin})=>margin),(({margin,position})=>0===position?margin:0));const carouselPage=function CarouselPage({pageId,index}){const{pageThumbWidth,pageThumbHeight,pageThumbMargin,clickPage,setPageRef,page,isCurrentPage,hasMultiplePages}=carouselContext_useCarousel((({state:{pageThumbWidth,pageThumbHeight,pageThumbMargin,numPages,pages,currentPageId},actions:{clickPage,setPageRef}})=>({pageThumbWidth,pageThumbHeight,pageThumbMargin,clickPage,setPageRef,page:pages.find((({id})=>id===pageId)),isCurrentPage:pageId===currentPageId,hasMultiplePages:numPages>1})));return page&&page.id?react.createElement(ItemContainer,{ref:el=>setPageRef(page,el),"data-testid":`carousel-page-preview-${pageId}`},0===index&&react.createElement(PageSeparator,{position:0,$width:pageThumbWidth,$height:pageThumbHeight,margin:pageThumbMargin},react.createElement(carouselPage_Line,{$height:pageThumbHeight})),react.createElement(ReorderablePage,{position:index,margin:pageThumbMargin},react.createElement(pagepreview.A,{tabIndex:isCurrentPage&&hasMultiplePages?0:-1,onClick:()=>clickPage(page),role:"option","data-page-id":page.id,label:isCurrentPage?(0,sprintf.A)((0,i18n.__)("Page %s (current page)","web-stories"),index+1):(0,sprintf.A)((0,i18n.__)("Go to page %s","web-stories"),index+1),isActive:isCurrentPage,page,width:pageThumbWidth,height:pageThumbHeight,isInteractive:hasMultiplePages})),react.createElement(PageSeparator,{position:index+1,$width:pageThumbWidth,$height:pageThumbHeight,margin:pageThumbMargin},react.createElement(carouselPage_Line,{$height:pageThumbHeight}))):null};var isHexColorString=__webpack_require__("./packages/patterns/src/isHexColorString.ts"),getSolidFromHex=__webpack_require__("./packages/patterns/src/getSolidFromHex.ts");const EmptyPage=styled_components_browser_esm.Ay.li.attrs({role:"presentation"}).withConfig({displayName:"skeletonPage__EmptyPage",componentId:"sc-3wwzc9-0"})(["display:block;position:relative;flex:0 0;margin:0;padding:0;border-radius:4px;"]);const skeletonPage=function SkeletonPage({pageId,index}){const{pageThumbWidth,pageThumbHeight,pageThumbMargin,hasPage,bgColor}=carouselContext_useCarousel((({state:{pageThumbWidth,pageThumbHeight,pageThumbMargin,pages}})=>{let bgColor=null;const page=pages.find((({id})=>id===pageId));if(page){bgColor=page.backgroundColor;const bgElement=page.elements[0];bgElement&&elements_src.V7.media(bgElement)&&bgElement.resource.baseColor&&(0,isHexColorString.A)(bgElement.resource.baseColor)&&(bgColor=(0,getSolidFromHex.A)(bgElement.resource.baseColor.replace("#","")))}return{pageThumbWidth,pageThumbHeight,pageThumbMargin,hasPage:Boolean(page&&page.id),bgColor}}));return hasPage?react.createElement(EmptyPage,{style:{flexBasis:`${pageThumbWidth}px`,height:`${pageThumbHeight}px`,marginLeft:`${0===index?pageThumbMargin:0}px`,marginRight:`${pageThumbMargin}px`,...(0,generatePatternStyles.A)(bgColor)},"data-testid":`carousel-page-preview-skeleton-${pageId}`}):null},PageList=(0,styled_components_browser_esm.Ay)(reorderable).attrs({role:"listbox","aria-orientation":"horizontal",mode:"horizontal"}).withConfig({displayName:"carouselList__PageList",componentId:"sc-1oa14z5-0"})(["grid-area:carousel;flex-direction:row;align-items:center;justify-content:center;overflow-x:hidden;overflow-y:hidden;width:","px;list-style:none;padding:4px 0;margin:-4px 0;",";::-webkit-scrollbar-thumb{border:6px solid transparent !important;}"],(({$width})=>$width),(({hasOverflow})=>hasOverflow&&(0,styled_components_browser_esm.AH)(["overflow-x:visible;overflow-x:overlay;justify-content:flex-start;"])));const carouselList=function CarouselList(){const{pageThumbWidth,carouselWidth,hasOverflow,pageIds,rearrangePages,setListRef,showSkeleton}=carouselContext_useCarousel((({state:{pageThumbWidth,carouselWidth,hasOverflow,pageIds,showSkeleton},actions:{rearrangePages,setListRef}})=>({pageThumbWidth,carouselWidth,hasOverflow,pageIds,rearrangePages,setListRef,showSkeleton}))),Page=showSkeleton?skeletonPage:carouselPage;return react.createElement(PageList,{mode:"horizontal",$width:carouselWidth,ref:setListRef,hasOverflow,"aria-label":(0,i18n.__)("Pages List","web-stories"),onPositionChange:rearrangePages,getItemSize:()=>pageThumbWidth},pageIds.map(((pageId,index)=>react.createElement(Page,{key:pageId,pageId,index}))))};var chevron_down_small=__webpack_require__("./packages/design-system/src/icons/chevron_down_small.svg"),chevron_up_small=__webpack_require__("./packages/design-system/src/icons/chevron_up_small.svg");const iconCss=(0,styled_components_browser_esm.AH)(["width:32px;margin:-8px;"]),IconDown=(0,styled_components_browser_esm.Ay)(chevron_down_small.A).withConfig({displayName:"carouselDrawerIcon__IconDown",componentId:"sc-b03fdn-0"})(["",""],iconCss),IconUp=(0,styled_components_browser_esm.Ay)(chevron_up_small.A).withConfig({displayName:"carouselDrawerIcon__IconUp",componentId:"sc-b03fdn-1"})(["",""],iconCss);const carouselDrawerIcon=function CarouselDrawerIcon({state}){return[constants.Wc.Open,constants.Wc.Closing].includes(state)?react.createElement(IconDown,null):react.createElement(IconUp,null)},carouselDrawer_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"carouselDrawer__Wrapper",componentId:"sc-1dxh28m-0"})(["display:flex;justify-content:center;"]),StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"carouselDrawer__StyledButton",componentId:"sc-1dxh28m-1"})(["white-space:nowrap;gap:8px;"]);const carouselDrawer=function CarouselDrawer(){const{carouselState,openCarousel,closeCarousel}=(0,app.gK)((({state:{carouselState},actions:{openCarousel,closeCarousel}})=>({carouselState,openCarousel,closeCarousel}))),{currentPageNumber,pageCount}=(0,app.P3)((({state:{currentPageNumber,pages}})=>({currentPageNumber,pageCount:pages.length}))),onClick=(0,src.hb)((()=>{carouselState===constants.Wc.Open?closeCarousel():carouselState===constants.Wc.Closed&&openCarousel()}),[carouselState,openCarousel,closeCarousel]);return react.createElement(carouselDrawer_Wrapper,null,react.createElement(StyledButton,{"aria-label":(0,i18n.__)("Toggle page carousel","web-stories"),onClick,variant:button_constants.Ak.Rectangle,size:button_constants.Mp.Small,type:button_constants.VQ.Tertiary},(0,sprintf.A)((0,i18n._n)("%1$d of %2$d page","%1$d of %2$d pages",pageCount,"web-stories"),currentPageNumber,pageCount),react.createElement(carouselDrawerIcon,{state:carouselState})))},carouselLayout_Wrapper=styled_components_browser_esm.Ay.section.withConfig({displayName:"carouselLayout__Wrapper",componentId:"sc-iaovfa-0"})(["position:relative;display:grid;grid:'. d d d d d .' 32px '. . . . . . .' ","px '. p . c . n .' auto / 1fr ","px ","px auto ","px ","px 1fr;width:100%;height:auto;z-index:",";&.carousel-enter{top:","px;&.carousel-enter-active{top:0;transition:","ms ease-out;transition-property:top;}}&.carousel-exit{top:0;&.carousel-exit-active{top:","px;transition:","ms ease-out;transition-property:top;}}"],(({isCollapsed})=>isCollapsed?2:8),NAVIGATION_BUTTON_WIDTH,8,8,NAVIGATION_BUTTON_WIDTH,zIndex.GM,(({thumbHeight})=>thumbHeight+6),constants.CE,(({thumbHeight})=>thumbHeight+6),constants.CE),carouselLayout_Area=styled_components_browser_esm.Ay.div.withConfig({displayName:"carouselLayout__Area",componentId:"sc-iaovfa-1"})(["grid-area:",";display:flex;align-items:center;justify-content:center;flex-direction:column;"],(({area})=>area));const carouselLayout=function CarouselLayout(){const{carouselState}=(0,app.gK)((({state:{carouselState}})=>({carouselState}))),{numPages,pageThumbHeight}=carouselContext_useCarousel((({state:{numPages,pageThumbHeight}})=>({numPages,pageThumbHeight}))),nodeRef=(0,src.li)();if(numPages<=0)return null;const isCollapsed=carouselState===constants.Wc.Closed,isOpenOrOpening=[constants.Wc.Open,constants.Wc.Opening].includes(carouselState);return react.createElement(CSSTransition.A,{in:isOpenOrOpening,classNames:"carousel",containerRef:!0,nodeRef,timeout:constants.CE},react.createElement(carouselLayout_Wrapper,{ref:nodeRef,"aria-label":(0,i18n.__)("Page Carousel","web-stories"),isCollapsed,thumbHeight:pageThumbHeight},react.createElement(carouselLayout_Area,{area:"d"},react.createElement(carouselDrawer,null)),!isCollapsed&&react.createElement(react.Fragment,null,react.createElement(carouselLayout_Area,{area:"p"},react.createElement(CarouselScrollBack,null)),react.createElement(carouselLayout_Area,{area:"c"},react.createElement(carouselList,null)),react.createElement(carouselLayout_Area,{area:"n"},react.createElement(CarouselScrollForward,null)))))},carouselContainer_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"carouselContainer__Wrapper",componentId:"sc-1dsu28u-0"})(["height:auto;width:100%;align-self:flex-end;"]);const carouselContainer=(0,src.ph)((function CarouselContainer(){const ref=(0,src.li)(),[carouselWidth,setCarouselWidth]=(0,src.J0)(0);return(0,src.pO)(ref,(({width})=>setCarouselWidth(width)),[]),react.createElement(carouselProvider,{availableSpace:carouselWidth},react.createElement(carouselContainer_Wrapper,{ref},react.createElement(carouselLayout,null)))}));var dropdown=__webpack_require__("./packages/design-system/src/components/dropDown/dropdown.tsx");const selectButtonCSS=(0,styled_components_browser_esm.AH)(["width:80px;height:36px;padding:0 10px;border-width:1px;border-style:solid;border-color:",";background-color:",";transition:background-color ",";&:hover,&:focus,&:active{border-color:",";background-color:",";}span{height:100%;padding:0;display:flex;align-items:center;}svg{margin:0 -10px;}"],(({theme})=>theme.colors.border.defaultNormal),(({theme})=>theme.colors.bg.primary),button_constants.QB,(({theme})=>theme.colors.bg.secondary),(({theme})=>theme.colors.bg.tertiary)),ZOOM_OPTIONS=[{label:(0,i18n._x)("100%","zoom level","web-stories"),value:1},{label:(0,i18n._x)("200%","zoom level","web-stories"),value:2},{label:(0,i18n._x)("Fill","zoom level","web-stories"),value:constants.gw.Fill},{label:(0,i18n._x)("Fit","zoom level","web-stories"),value:constants.gw.Fit}];const zoomSelector=function ZoomSelector(){const{zoomSetting,zoomLevel,setZoomSetting,setZoomLevel}=(0,layout.g)((({state:{zoomSetting,zoomLevel},actions:{setZoomSetting,setZoomLevel}})=>({zoomSetting,zoomLevel,setZoomSetting,setZoomLevel}))),placeholder=(0,src.Kr)((()=>{const option=ZOOM_OPTIONS.find((({value})=>zoomSetting===constants.gw.Fixed?value===zoomLevel:value===zoomSetting));return option?option.label:(0,sprintf.A)((0,i18n._x)("%d%%","zoom level","web-stories"),Math.round(100*zoomLevel))}),[zoomSetting,zoomLevel]),handleSetZoom=(0,src.hb)(((_event,value)=>{Object.values(constants.gw).includes(value)?setZoomSetting(value):setZoomLevel(value)}),[setZoomSetting,setZoomLevel]);return react.createElement(dropdown.A,{ariaLabel:(0,i18n.__)("Zoom Level","web-stories"),placeholder,options:ZOOM_OPTIONS,placement:popup_constants.W.TopStart,onMenuItemClick:handleSetZoom,selectedValue:zoomSetting,popupFillWidth:!1,selectButtonStylesOverride:selectButtonCSS,className:"zoom-selector-dropdown"})};var box4=__webpack_require__("./packages/design-system/src/icons/box4.svg"),modal=__webpack_require__("./packages/design-system/src/components/modal/modal.tsx"),toggleButton=__webpack_require__("./packages/story-editor/src/components/toggleButton/index.js"),slider_slider=__webpack_require__("./packages/design-system/src/components/slider/slider.tsx"),useGridViewKeys=__webpack_require__("./packages/design-system/src/components/keyboard/gridview/useGridViewKeys.ts"),cross=__webpack_require__("./packages/design-system/src/icons/cross.svg");const gridView_Container=styled_components_browser_esm.Ay.section.withConfig({displayName:"gridView__Container",componentId:"sc-ytsaos-0"})(["display:flex;flex-direction:column;height:100%;width:100%;padding:32px;"]),TopRow=styled_components_browser_esm.Ay.header.withConfig({displayName:"gridView__TopRow",componentId:"sc-ytsaos-1"})(["display:flex;justify-content:space-between;align-items:center;margin-bottom:36px;@media ","{margin-bottom:72px;}@media ","{margin-bottom:112px;}"],(({theme})=>theme.breakpoint.desktop),(({theme})=>theme.breakpoint.wide)),gridView_Wrapper=(0,styled_components_browser_esm.Ay)(reorderable).withConfig({displayName:"gridView__Wrapper",componentId:"sc-ytsaos-2"})(["position:relative;overflow-y:auto;overflow-y:overlay;overflow-x:hidden;flex-grow:1;display:flex;flex-direction:column;pointer-events:all;padding:4px;"]),Grid=styled_components_browser_esm.Ay.div.withConfig({displayName:"gridView__Grid",componentId:"sc-ytsaos-3"})(["position:relative;display:grid;grid-template-columns:",";grid-template-rows:repeat(auto-fill,","px);grid-gap:","px;justify-content:center;align-items:flex-start;flex-grow:1;"],(({pageWidth})=>`repeat(auto-fit, minmax(${pageWidth}px, max-content))`),(({pageHeight})=>pageHeight),(({gapWidth})=>gapWidth)),NoButton=styled_components_browser_esm.Ay.div.withConfig({displayName:"gridView__NoButton",componentId:"sc-ytsaos-4"})(["flex:0 0 56px;"]),ClickableButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"gridView__ClickableButton",componentId:"sc-ytsaos-5"})(["pointer-events:all;"]),ClickableSlider=(0,styled_components_browser_esm.Ay)(slider_slider.A).withConfig({displayName:"gridView__ClickableSlider",componentId:"sc-ytsaos-6"})(["pointer-events:all;width:366px;"]),gridView_PageSeparator=(0,styled_components_browser_esm.Ay)(reorderableSeparator).withConfig({displayName:"gridView__PageSeparator",componentId:"sc-ytsaos-7"})(["position:absolute;bottom:0;left:","px;width:","px;height:","px;display:flex;justify-content:center;align-items:center;",""],(({width})=>width/2),(({width,margin})=>width+margin),(({height})=>height),(({before,width,margin})=>before&&`\n      left: -${(width+2*margin)/2}px;\n    `)),gridView_Line=styled_components_browser_esm.Ay.div.withConfig({displayName:"gridView__Line",componentId:"sc-ytsaos-8"})(["background:",";height:","px;width:2px;margin:0px;"],(({theme})=>theme.colors.border.selection),(({height})=>height)),gridView_ItemContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"gridView__ItemContainer",componentId:"sc-ytsaos-9"})(["display:flex;flex-direction:row;position:relative;"]);const gridView=function GridView({onClose}){const{pages,currentPageId,currentPageIndex,setCurrentPage,arrangePage}=(0,app.P3)((({state:{pages,currentPageIndex,currentPageId},actions:{setCurrentPage,arrangePage}})=>({pages,currentPageIndex,currentPageId,setCurrentPage,arrangePage}))),{isRTL}=(0,app.UK)(),[pagesPerRow,setPagesPerRow]=(0,src.J0)(4),[availableWidth,setAvailableWidth]=(0,src.J0)(null),wrapperRef=(0,src.li)();(0,src.pO)(wrapperRef,(({width})=>setAvailableWidth(width)),[]);const rawPageWidth=(availableWidth-20*(pagesPerRow-1))/pagesPerRow,pageWidth=12*Math.floor(rawPageWidth/12),actualPageWidths=pageWidth*pagesPerRow,pageGridGap=Math.floor((availableWidth-actualPageWidths)/(pagesPerRow-1)),pageHeight=pageWidth/src_constants.yK,handleClickPage=page=>()=>setCurrentPage({pageId:page.id}),gridRef=(0,src.li)(),pageRefs=(0,src.li)({}),arrangeItem=(0,src.hb)(((focusedPageId,nextIndex)=>{arrangePage({pageId:focusedPageId,position:nextIndex})}),[arrangePage]);(0,useGridViewKeys.A)({containerRef:wrapperRef,gridRef,itemRefs:pageRefs,isRTL,currentItemId:currentPageId,items:pages,arrangeItem});const dividerLineHeight=Math.min(pageHeight-24,64);return react.createElement(gridView_Container,{"aria-label":(0,i18n.__)("Grid View","web-stories")},react.createElement(TopRow,null,react.createElement(ClickableButton,{variant:button_constants.Ak.Square,type:button_constants.VQ.Tertiary,size:button_constants.Mp.Medium,onClick:onClose,"aria-label":(0,i18n.__)("Close","web-stories")},react.createElement(cross.A,null)),react.createElement(ClickableSlider,{min:4,max:12,majorStep:1,minorStep:1,value:pagesPerRow,handleChange:newValue=>setPagesPerRow(newValue),"aria-label":(0,i18n.__)("Pages per row","web-stories"),popupZIndexOverride:zIndex.PK}),react.createElement(NoButton,null)),react.createElement(gridView_Wrapper,{"aria-label":(0,i18n.__)("Grid View Pages List","web-stories"),ref:wrapperRef,onPositionChange:({position:oldPos},{position:newPos})=>{const pageId=pages[oldPos].id;arrangePage({pageId,position:newPos}),setCurrentPage({pageId})},mode:"grid",getItemSize:()=>pageHeight,scrollSize:64},react.createElement(Grid,{pageWidth,pageHeight,gapWidth:pageGridGap,ref:gridRef},pages.map(((page,index)=>{const isCurrentPage=index===currentPageIndex,isInteractive=pages.length>1;return react.createElement(gridView_ItemContainer,{key:page.id,ref:el=>{pageRefs.current[page.id]=el}},react.createElement(gridView_PageSeparator,{position:index,width:pageWidth,height:pageHeight,margin:pageGridGap,before:!0},react.createElement(gridView_Line,{height:dividerLineHeight})),react.createElement(reorderableItem,{position:index},react.createElement(pagepreview.A,{label:isCurrentPage?(0,sprintf.A)((0,i18n.__)("Page %s (current page)","web-stories"),index+1):(0,sprintf.A)((0,i18n.__)("Page %s","web-stories"),index+1),tabIndex:isCurrentPage&&isInteractive?0:-1,isActive:isCurrentPage&&isInteractive,page,width:pageWidth,height:pageHeight,onClick:handleClickPage(page),isInteractive,gridRef,role:"option"})),react.createElement(gridView_PageSeparator,{position:index+1,width:pageWidth,height:pageHeight,margin:pageGridGap},react.createElement(gridView_Line,{height:dividerLineHeight})))})))))},Box=styled_components_browser_esm.Ay.div.withConfig({displayName:"gridViewButton__Box",componentId:"sc-1gc0r0y-0"})(["display:flex;justify-content:center;align-items:center;"]);const gridViewButton=function GridViewButton(){const[isGridViewOpen,setIsGridViewOpen]=(0,src.J0)(!1),toggleModal=(0,src.hb)((()=>{setIsGridViewOpen((prevIsOpen=>{const newIsOpen=!prevIsOpen;return(0,tracking_src.sx)("grid_view_toggled",{status:newIsOpen?"open":"closed"}),newIsOpen}))}),[setIsGridViewOpen]);return react.createElement(react.Fragment,null,react.createElement(Box,null,react.createElement(tooltip.A,{title:(0,i18n.__)("Grid View","web-stories"),placement:popup_constants.W.Top,hasTail:!0},react.createElement(toggleButton.f,{isOpen:isGridViewOpen,onClick:toggleModal,"aria-owns":"gridview_modal",MainIcon:box4.A,"aria-label":(0,i18n.__)("Grid View","web-stories"),label:(0,i18n.__)("Grid View","web-stories")}))),react.createElement(modal.A,{isOpen:isGridViewOpen,onClose:toggleModal,contentLabel:(0,i18n.__)("Grid View","web-stories"),popupId:"gridview_modal",overlayStyles:{alignItems:"stretch",backgroundColor:"#131516"},contentStyles:{pointerEvents:"none",flex:1}},react.createElement(gridView,{onClose:toggleModal})))};var panel=__webpack_require__("./packages/story-editor/src/components/panels/panel/index.js"),useSidebar=__webpack_require__("./packages/story-editor/src/components/sidebar/useSidebar.js"),chevron_down=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.every.js"),__webpack_require__("./packages/design-system/src/icons/chevron_down.svg")),group=__webpack_require__("./packages/design-system/src/icons/group.svg"),visibility_off=__webpack_require__("./packages/design-system/src/icons/visibility_off.svg"),lock_closed=__webpack_require__("./packages/design-system/src/icons/lock_closed.svg");const layer_useGroupSelection=function useGroupSelection(groupId){const{toggleLayer,groupLayers,selectedElementIds}=(0,app.P3)((({state,actions})=>({groupLayers:state.currentPage.elements.filter((el=>el.groupId===groupId)),selectedElementIds:state.selectedElementIds,toggleLayer:actions.toggleLayer}))),setRenamableLayer=(0,app.yu)((({actions})=>actions.setRenamableLayer));return{isSelected:groupLayers.every((gl=>selectedElementIds.includes(gl.id))),handleClick:(0,src.hb)((evt=>{evt.preventDefault(),evt.stopPropagation(),toggleLayer({elementId:groupLayers[0].id,metaKey:evt.metaKey,shiftKey:evt.shiftKey,withLinked:!0});2===evt.detail&&setRenamableLayer({elementId:groupId})}),[toggleLayer,groupLayers,setRenamableLayer,groupId])}};var visibility=__webpack_require__("./packages/design-system/src/icons/visibility.svg"),trash=__webpack_require__("./packages/design-system/src/icons/trash.svg"),page_plus=__webpack_require__("./packages/design-system/src/icons/page_plus.svg"),lock_open=__webpack_require__("./packages/design-system/src/icons/lock_open.svg"),v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),generateGroupName=__webpack_require__("./packages/story-editor/src/utils/generateGroupName.ts");const layerIdContext=(0,src.q6)(""),ActionButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:button_constants.VQ.Plain,tabIndex:-1}).withConfig({displayName:"layerAction__ActionButton",componentId:"sc-xw5sxy-0"})(["position:relative;aspect-ratio:1;width:20px;padding:0;svg{position:absolute;width:32px;height:auto;top:50%;left:50%;transform:translate(-50%,-50%);}&&{transition:revert;background:var(--background-color);}:disabled{color:",";}:hover{color:var( --selected-hover-color,"," );}& + &{margin-left:4px;}*{pointer-events:none;}:focus{","}"],(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.colors.fg.secondary),(({theme})=>outline.g(theme.colors.border.focus,"var(--background-color)")));function preventReorder(e){e.stopPropagation(),e.preventDefault()}const layerAction=(0,src.ph)((function LayerAction({label,handleClick,children,disabled=!1,isActive=!0,trackingData=null}){const buttonRef=(0,src.li)(null);(0,usePerformanceTracking.A)({node:trackingData?buttonRef.current:null,eventData:trackingData});const layerId=(0,src.NT)(layerIdContext);return isActive?react.createElement(tooltip.A,{title:label,hasTail:!0,isDelayed:!0},react.createElement(ActionButton,{"aria-label":label,"aria-describedby":layerId,onPointerDown:preventReorder,disabled,onClick:handleClick,ref:buttonRef},children)):null}));const groupLayerActions=(0,src.ph)((function GroupLayerActions({groupId}){const{groups,updateGroupById,deleteGroupAndElementsById,updateElementsById,duplicateGroupById,groupLayers}=(0,app.P3)((({actions,state})=>({groups:state.currentPage.groups,updateGroupById:actions.updateGroupById,deleteGroupAndElementsById:actions.deleteGroupAndElementsById,updateElementsById:actions.updateElementsById,duplicateGroupById:actions.duplicateGroupById,groupLayers:state.currentPage.elements.filter((el=>el.groupId===groupId))}))),group=groups?.[groupId]||{name:"",isLocked:!1,isCollapsed:!1},allLayersHidden=groupLayers.every((layer=>layer.isHidden)),visibilityTitle=allLayersHidden?(0,i18n.__)("Show Group","web-stories"):(0,i18n.__)("Hide Group","web-stories"),lockTitle=group.isLocked?(0,i18n.__)("Unlock Group","web-stories"):(0,i18n.__)("Lock Group","web-stories"),{name,isLocked,isCollapsed}=group,handleHideGroup=(0,src.hb)((()=>{updateElementsById({elementIds:groupLayers.map((layer=>layer.id)),properties:{isHidden:!allLayersHidden}})}),[allLayersHidden,groupLayers,updateElementsById]),handleLockGroup=(0,src.hb)((()=>{updateGroupById({groupId,properties:{isLocked:!isLocked}}),updateElementsById({elementIds:groupLayers.map((layer=>layer.id)),properties:{isLocked:!isLocked}})}),[groupId,groupLayers,isLocked,updateElementsById,updateGroupById]),handleDuplicateGroup=(0,src.hb)((()=>{const newGroupId=(0,v4.A)(),newGroupName=(0,generateGroupName.A)(groups,name);duplicateGroupById({oldGroupId:groupId,groupId:newGroupId,name:newGroupName,isLocked,isCollapsed})}),[duplicateGroupById,name,isLocked,isCollapsed,groupId,groups]),handleDeleteGroup=(0,src.hb)((()=>deleteGroupAndElementsById({groupId})),[groupId,deleteGroupAndElementsById]),VisibilityIcon=allLayersHidden?visibility_off.A:visibility.A;return react.createElement(react.Fragment,null,react.createElement(layerAction,{label:(0,i18n.__)("Delete Group","web-stories"),handleClick:handleDeleteGroup},react.createElement(trash.A,null)),react.createElement(layerAction,{label:(0,i18n.__)("Duplicate Group","web-stories"),handleClick:handleDuplicateGroup},react.createElement(page_plus.A,null)),react.createElement(layerAction,{label:visibilityTitle,handleClick:handleHideGroup},react.createElement(VisibilityIcon,null)),react.createElement(layerAction,{label:lockTitle,handleClick:handleLockGroup},isLocked?react.createElement(lock_closed.A,null):react.createElement(lock_open.A,null)))}));var input=__webpack_require__("./packages/design-system/src/components/input/input.tsx");const fadeOutCss=(0,styled_components_browser_esm.AH)(["background-color:var(--background-color);::before{position:absolute;content:'';width:32px;height:100%;top:0;left:0;transform:translateX(-100%);background:linear-gradient( to right,var(--background-color-opaque),var(--background-color) );pointer-events:none;}"]),ActionsContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerComponents__ActionsContainer",componentId:"sc-sxidj-0"})(["position:absolute;display:none;align-items:center;height:100%;top:0;right:0;padding-right:6px;column-gap:6px;",""],fadeOutCss),LayerContainer=styled_components_browser_esm.Ay.div.attrs({"data-testid":"layer-option"}).withConfig({displayName:"layerComponents__LayerContainer",componentId:"sc-sxidj-1"})(["position:relative;height:","px;width:100%;overflow:hidden;--background-color:",";--background-color-opaque:",";:is(:hover,:focus-within) ","{display:inline-flex;}"],35,(({theme})=>theme.colors.bg.secondary),(({theme})=>(0,polished_esm.B3)(theme.colors.bg.secondary,0)),ActionsContainer),LayerButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:button_constants.VQ.Plain,tabIndex:-1,role:"option"}).withConfig({displayName:"layerComponents__LayerButton",componentId:"sc-sxidj-2"})(["position:relative;display:grid;grid-template-columns:auto 1fr;gap:12px;border:0;padding:0;background:transparent;height:100%;width:100%;overflow:hidden;align-items:center;user-select:none;border-radius:0;padding-left:","px;transition:revert;"," :hover{background:",";}:hover,:hover + *{--background-color:",";--background-color-opaque:",";}:active{background:",";}:active,:active + *{--background-color:",";--background-color-opaque:",";}"],(({isNested})=>isNested?30:12),(({isSelected,theme})=>isSelected&&(0,styled_components_browser_esm.AH)(["background:",";&,& + *{--background-color:",";--background-color-opaque:",";--selected-hover-color:",";}"],theme.colors.interactiveBg.tertiaryPress,theme.colors.interactiveBg.tertiaryPress,(0,polished_esm.B3)(theme.colors.interactiveBg.tertiaryPress,0),theme.colors.interactiveBg.tertiaryHover)),(({theme})=>theme.colors.interactiveBg.tertiaryHover),(({theme})=>theme.colors.interactiveBg.tertiaryHover),(({theme})=>(0,polished_esm.B3)(theme.colors.interactiveBg.tertiaryHover,0)),(({theme})=>theme.colors.interactiveBg.tertiaryPress),(({theme})=>theme.colors.interactiveBg.tertiaryPress),(({theme})=>(0,polished_esm.B3)(theme.colors.interactiveBg.tertiaryPress,0))),LayerInputWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerComponents__LayerInputWrapper",componentId:"sc-sxidj-3"})(["display:grid;grid-template-columns:23px 1fr;gap:12px;height:100%;width:100%;padding-left:","px;padding-right:10px;:hover{background:",";}:hover,:hover + *{--background-color:",";--background-color-opaque:",";}"],(({isNested})=>isNested?30:12),(({theme})=>theme.colors.interactiveBg.tertiaryHover),(({theme})=>theme.colors.interactiveBg.tertiaryHover),(({theme})=>(0,polished_esm.B3)(theme.colors.interactiveBg.tertiaryHover,0))),LayerDescription=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerComponents__LayerDescription",componentId:"sc-sxidj-4"})(["position:relative;width:100%;overflow:hidden;display:flex;align-items:center;margin-left:0;text-align:left;color:",";"],(({theme})=>theme.colors.fg.primary)),LayerText=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).attrs({size:types.$.Small}).withConfig({displayName:"layerComponents__LayerText",componentId:"sc-sxidj-5"})(["color:inherit;white-space:nowrap;text-overflow:' ';overflow:hidden;max-width:100%;",";"],(({isHidden})=>isHidden&&(0,styled_components_browser_esm.AH)(["opacity:0.3;"]))),LayerIconWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerComponents__LayerIconWrapper",componentId:"sc-sxidj-6"})(["",";"],(({isHidden})=>isHidden&&(0,styled_components_browser_esm.AH)(["opacity:0.3;"]))),FadeOutWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerComponents__FadeOutWrapper",componentId:"sc-sxidj-7"})(["display:flex;align-items:center;justify-content:flex-start;position:absolute;right:0;aspect-ratio:1;",""],fadeOutCss),layerComponents_IconWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerComponents__IconWrapper",componentId:"sc-sxidj-8"})(["display:flex;align-items:center;justify-content:flex-start;width:32px;aspect-ratio:1;svg{position:relative;display:block;width:100%;color:",";}"],(({theme})=>theme.colors.fg.secondary)),HiddenIconWrapper=(0,styled_components_browser_esm.Ay)(layerComponents_IconWrapper).withConfig({displayName:"layerComponents__HiddenIconWrapper",componentId:"sc-sxidj-9"})(["margin-right:-6px;"]),LayerContentContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerComponents__LayerContentContainer",componentId:"sc-sxidj-10"})(["margin-right:8px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),LayerInput=(0,styled_components_browser_esm.Ay)(input.A).withConfig({displayName:"layerComponents__LayerInput",componentId:"sc-sxidj-11"})(["overflow:visible;div{height:100%;}"]),LayerInputForm=(0,styled_components_browser_esm.Ay)(LayerDescription).attrs({as:"form"}).withConfig({displayName:"layerComponents__LayerInputForm",componentId:"sc-sxidj-12"})(["overflow:visible;"]),stopPropagation=evt=>evt.stopPropagation();const layerForm=(0,src.ph)((function LayerForm({layerName,handleNewLayerName}){const[newLayerName,setNewLayerName]=(0,src.J0)(layerName),setRenamableLayer=(0,app.yu)((({actions})=>actions.setRenamableLayer));(0,src.vJ)((()=>{setNewLayerName(layerName)}),[layerName]);const updateLayerName=()=>{setRenamableLayer(null);const trimmedLayerName=newLayerName.trim();trimmedLayerName&&handleNewLayerName(trimmedLayerName)};return react.createElement(LayerInputForm,{onSubmit:evt=>{evt.preventDefault(),updateLayerName()}},react.createElement(LayerInput,{tabIndex:-1,"aria-label":(0,i18n.__)("Layer Name","web-stories"),value:newLayerName,onChange:evt=>{setNewLayerName(evt.target.value)},onKeyDown:evt=>{"Escape"===evt.key&&(setNewLayerName(layerName),setRenamableLayer(null))},onBlur:updateLayerName,onPointerDown:stopPropagation,hasFocus:!0}),react.createElement("button",{hidden:!0}))}));const layer_layer=(0,src.ph)((function layer_Layer({id,handleNewLayerName,layerName,handleClick,isSelected,LayerIcon,hasLayerLockIcon,hasLayerHiddenIcon,LayerLockIcon,LayerVisibilityIcon,actions,hasActions=!0,isNested=!1,skipLayer=!1,trackingData=null}){const renamableLayer=(0,app.yu)((({state})=>state.renamableLayer)),layerRef=(0,src.li)(null);if((0,usePerformanceTracking.A)({node:trackingData?layerRef.current:null,eventData:trackingData}),skipLayer)return null;const layerId=`layer-${id}`,isRenameable=renamableLayer?.elementId===id;return react.createElement(LayerContainer,null,isRenameable?react.createElement(LayerInputWrapper,{isNested},react.createElement(LayerIcon,null),react.createElement(layerForm,{handleNewLayerName,layerName})):react.createElement(layerIdContext.Provider,{value:layerId},react.createElement(LayerButton,{ref:layerRef,id:layerId,onClick:handleClick,isSelected,isNested},react.createElement(LayerIconWrapper,{isHidden:hasLayerHiddenIcon},react.createElement(LayerIcon,null)),react.createElement(LayerDescription,null,react.createElement(LayerContentContainer,null,react.createElement(LayerText,{isHidden:hasLayerHiddenIcon},layerName)),(hasLayerHiddenIcon||hasLayerLockIcon)&&react.createElement(FadeOutWrapper,null,hasLayerHiddenIcon&&react.createElement(HiddenIconWrapper,null,hasLayerHiddenIcon&&react.createElement(LayerVisibilityIcon,null)),(hasLayerHiddenIcon||hasLayerLockIcon)&&react.createElement(layerComponents_IconWrapper,null,hasLayerLockIcon&&react.createElement(LayerLockIcon,null))))),hasActions&&react.createElement(ActionsContainer,null,actions)))})),GroupIconsWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"groupLayer__GroupIconsWrapper",componentId:"sc-gchq7p-0"})(["display:flex;align-items:center;justify-content:flex-start;width:48px;svg{position:relative;display:block;width:100%;color:",";}transform:translateX(-12px);margin-right:-12px;"],(({theme})=>theme.colors.fg.secondary)),ChevronDown=(0,styled_components_browser_esm.Ay)(chevron_down.A).withConfig({displayName:"groupLayer__ChevronDown",componentId:"sc-gchq7p-1"})(["min-width:32px;min-height:32px;"]),ChevronRight=(0,styled_components_browser_esm.Ay)(chevron_down.A).withConfig({displayName:"groupLayer__ChevronRight",componentId:"sc-gchq7p-2"})(["min-width:32px;min-height:32px;transform:rotate(-90deg);"]);const groupLayer=(0,src.ph)((function GroupLayer({groupId}){const{groups,updateGroupById,groupLayers}=(0,app.P3)((({actions,state})=>({groups:state.currentPage.groups,updateGroupById:actions.updateGroupById,groupLayers:state.currentPage.elements.filter((el=>el.groupId===groupId))}))),{name="",isLocked=!1,isCollapsed=!1}=groups?.[groupId]||{},{isSelected,handleClick}=layer_useGroupSelection(groupId),handleGroupArrowClick=(0,src.hb)((()=>{updateGroupById({groupId,properties:{isCollapsed:!isCollapsed}})}),[isCollapsed,groupId,updateGroupById]),GroupLayerIcon=(0,src.hb)((()=>react.createElement(GroupIconsWrapper,null,isCollapsed?react.createElement(ChevronRight,{onClick:handleGroupArrowClick}):react.createElement(ChevronDown,{onClick:handleGroupArrowClick}),react.createElement(group.A,null))),[handleGroupArrowClick,isCollapsed]),allLayersHidden=groupLayers.every((layer=>layer.isHidden));return react.createElement(layer_layer,{id:groupId,handleNewLayerName:newLayerName=>updateGroupById({groupId,properties:{name:newLayerName}}),layerName:name,handleClick,hasLayerHiddenIcon:allLayersHidden,isSelected,LayerIcon:GroupLayerIcon,LayerVisibilityIcon:()=>allLayersHidden&&react.createElement(visibility_off.A,null),hasLayerLockIcon:isLocked,LayerLockIcon:lock_closed.A,actions:react.createElement(groupLayerActions,{groupId})})})),LayerSeparator=(0,styled_components_browser_esm.Ay)(reorderableSeparator).withConfig({displayName:"reorderableGroupLayer__LayerSeparator",componentId:"sc-zozo8e-0"})(["height:","px;margin:-","px 0;padding:","px 0;"],35,17.5,17.5),reorderableGroupLayer=(0,src.ph)((function ReorderableGroup({id,position,handleStartReordering}){return react.createElement(react.Fragment,null,react.createElement(LayerSeparator,{groupId:null,position:position+1}),react.createElement(reorderableItem,{position,data:{group:id},onStartReordering:handleStartReordering({id})},react.createElement(groupLayer,{groupId:id})))}));var lock_filled_closed=__webpack_require__("./packages/design-system/src/icons/lock_filled_closed.svg");const layer_useLayerSelection=function useLayerSelection(layer){const{id:elementId}=layer,{isSelected,toggleLayer}=(0,app.P3)((({state,actions})=>({isSelected:state.selectedElementIds.includes(elementId),toggleLayer:actions.toggleLayer}))),setRenamableLayer=(0,app.yu)((({actions})=>actions.setRenamableLayer));return{isSelected,handleClick:(0,src.hb)((evt=>{evt.preventDefault(),evt.stopPropagation(),toggleLayer({elementId,metaKey:evt.metaKey,shiftKey:evt.shiftKey,withLinked:!1});2===evt.detail&&setRenamableLayer({elementId})}),[toggleLayer,elementId,setRenamableLayer])}};var useShapeMask=__webpack_require__("./packages/story-editor/src/utils/useShapeMask.js");const MaskedIconWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"shapeMaskWrapper__MaskedIconWrapper",componentId:"sc-1blxy5z-0"})(["position:relative;clip-path:url(#",");"],(({maskId})=>maskId));const shapeMaskWrapper=function ShapeMaskWrapper({element,children}){const{hasShapeMask}=(0,useShapeMask.A)(element);return hasShapeMask?react.createElement(MaskedIconWrapper,{maskId:(0,masks_src.t7)(element,"frame")},children):children};var remove_mask=__webpack_require__("./packages/design-system/src/icons/remove_mask.svg");const elementLayerActions=(0,src.ph)((function ElementLayerActions({element}){const{hasDuplicateMenu}=(0,elements_src.zh)(element.type),{duplicateElementsById,updateElementById,deleteElementById}=(0,app.P3)((({actions})=>({duplicateElementsById:actions.duplicateElementsById,deleteElementById:actions.deleteElementById,updateElementById:actions.updateElementById}))),{hasShapeMask,removeShapeMask}=(0,useShapeMask.A)(element),removeMaskTitle=(0,i18n.__)("Unmask","web-stories"),isNested=Boolean(element.groupId),{isLocked,isHidden}=element,lockTitle=(0,src.Kr)((()=>isNested?isLocked?(0,i18n.__)("Group is Locked","web-stories"):(0,i18n.__)("Group is Unlocked","web-stories"):isLocked?(0,i18n.__)("Unlock Layer","web-stories"):(0,i18n.__)("Lock Layer","web-stories")),[isLocked,isNested]),visibilityTitle=isHidden?(0,i18n.__)("Show Layer","web-stories"):(0,i18n.__)("Hide Layer","web-stories"),handleDeleteElement=(0,src.hb)((()=>deleteElementById({elementId:element.id})),[deleteElementById,element.id]),handleDuplicateElement=(0,src.hb)((()=>duplicateElementsById({elementIds:[element.id]})),[duplicateElementsById,element.id]),handleLockElement=(0,src.hb)((()=>updateElementById({elementId:element.id,properties:{isLocked:!isLocked}})),[element.id,isLocked,updateElementById]),handleHideElement=(0,src.hb)((()=>updateElementById({elementId:element.id,properties:{isHidden:!isHidden}})),[element.id,isHidden,updateElementById]),LockIcon=isLocked?lock_closed.A:lock_open.A,VisibilityIcon=isHidden?visibility_off.A:visibility.A;return react.createElement(react.Fragment,null,react.createElement(layerAction,{isActive:hasShapeMask,label:removeMaskTitle,handleClick:removeShapeMask},react.createElement(remove_mask.A,null)),react.createElement(layerAction,{label:(0,i18n.__)("Delete Layer","web-stories"),handleClick:handleDeleteElement,trackingData:{...constants.Zy.DELETE_ELEMENT,label:element.type}},react.createElement(trash.A,null)),react.createElement(layerAction,{isActive:hasDuplicateMenu,label:(0,i18n.__)("Duplicate Layer","web-stories"),handleClick:handleDuplicateElement},react.createElement(page_plus.A,null)),react.createElement(layerAction,{label:visibilityTitle,handleClick:handleHideElement},react.createElement(VisibilityIcon,null)),react.createElement(layerAction,{label:lockTitle,disabled:isNested,handleClick:handleLockElement},isNested?react.createElement(lock_filled_closed.A,null):react.createElement(LockIcon,null)))})),elementLayer_LayerIconWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"elementLayer__LayerIconWrapper",componentId:"sc-ndwsm1-0"})(["display:flex;align-items:center;justify-content:flex-start;color:",";:hover{background:",";}:hover,:hover + *{--background-color:",";--background-color-opaque:",";}"],(({theme})=>theme.colors.fg.primary),(({theme})=>theme.colors.interactiveBg.tertiaryHover),(({theme})=>theme.colors.interactiveBg.tertiaryHover),(({theme})=>(0,polished_esm.B3)(theme.colors.interactiveBg.tertiaryHover,0)));const elementLayer=(0,src.ph)((function ElementLayer({element}){const layerName=(0,elements_src.Hi)(element),{LayerIcon}=(0,elements_src.zh)(element.type),{isSelected,handleClick}=layer_useLayerSelection(element),{id,isDefaultBackground,isBackground,type}=element,{updateElementById,currentPageBackgroundColor,groups}=(0,app.P3)((({actions,state})=>({updateElementById:actions.updateElementById,groups:state.currentPage?.groups||{},currentPageBackgroundColor:!isDefaultBackground||state.currentPage?.backgroundColor}))),{getProxiedUrl}=(0,useCORSProxy.A)(),isNested=Boolean(element.groupId),group=groups[element.groupId],CompoundLayerIcon=(0,src.hb)((()=>react.createElement(elementLayer_LayerIconWrapper,null,react.createElement(shapeMaskWrapper,{element},react.createElement(LayerIcon,{element,getProxiedUrl,currentPageBackgroundColor})))),[currentPageBackgroundColor,element,getProxiedUrl]),hasLayerHiddenIcon=element.isHidden,hasLayerLockIcon=Boolean(isBackground||element.isLocked),LayerLockIcon=(0,src.hb)((()=>isBackground||isNested?react.createElement(lock_filled_closed.A,null):react.createElement(lock_closed.A,null)),[isBackground,isNested]);return react.createElement(layer_layer,{id,handleNewLayerName:newLayerName=>updateElementById({elementId:element.id,properties:{layerName:newLayerName}}),layerName,handleClick,isSelected,LayerIcon:CompoundLayerIcon,hasLayerLockIcon,hasLayerHiddenIcon,LayerLockIcon,LayerVisibilityIcon:()=>element.isHidden&&react.createElement(visibility_off.A,null),hasActions:!isBackground,actions:react.createElement(elementLayerActions,{element}),isNested,skipLayer:group?.isCollapsed,trackingData:{...constants.Zy.SELECT_ELEMENT,label:type}})})),reorderableElementLayer_LayerSeparator=(0,styled_components_browser_esm.Ay)(reorderableSeparator).withConfig({displayName:"reorderableElementLayer__LayerSeparator",componentId:"sc-1ed8ff9-0"})(["height:","px;margin:-","px 0;padding:","px 0;"],35,17.5,17.5),ReorderableLayer=(0,src.ph)((function ReorderableLayer({id,position,nestedOffset,nestedOffsetCalcFunc,handleStartReordering}){const element=(0,app.P3)((({state})=>state.currentPage?.elements.find((el=>el.id===id))));return element?react.createElement(src.FK,{key:id},react.createElement(reorderableElementLayer_LayerSeparator,{groupId:element.groupId,nestedOffset:Boolean(nestedOffset),nestedOffsetCalcFunc,position:position+1,isNested:element.groupId}),react.createElement(reorderableItem,{position,onStartReordering:handleStartReordering(element),disabled:element.isBackground},react.createElement(elementLayer,{element}))):null})),reorderableElementLayer=ReorderableLayer;function reorderableLayer_extends(){return reorderableLayer_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},reorderableLayer_extends.apply(this,arguments)}const reorderableLayer=function ReorderableElement({isGroup,isFirstElementAfterGroup=!1,...rest}){const setSelectedElementsById=(0,app.P3)((({actions})=>actions.setSelectedElementsById)),focusCanvas=(0,useFocusCanvas.A)(),renamableLayer=(0,app.yu)((({state})=>state.renamableLayer)),props={...rest,handleStartReordering:(0,src.hb)((element=>()=>{setSelectedElementsById({elementIds:[element.id]}),renamableLayer&&focusCanvas()}),[setSelectedElementsById,focusCanvas,renamableLayer])};return isGroup?react.createElement(reorderableGroupLayer,props):react.createElement(reorderableElementLayer,reorderableLayer_extends({nestedOffset:isFirstElementAfterGroup,nestedOffsetCalcFunc},props))};__webpack_require__("./node_modules/core-js/modules/esnext.array.group.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.flat-map.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.difference.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.intersection.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-disjoint-from.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-subset-of.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.is-superset-of.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.symmetric-difference.v2.js"),__webpack_require__("./node_modules/core-js/modules/esnext.set.union.v2.js");const layer_useLayers=function useLayers(){const{elements,arrangeElement,arrangeGroup}=(0,app.P3)((({state,actions})=>({elements:state.currentPage?.elements||[],arrangeElement:actions.arrangeElement,arrangeGroup:actions.arrangeGroup}))),elementLayers=(0,src.Kr)((()=>elements.map((({id,groupId,layerName},position)=>({id,groupId,layerName,position})))),[elements]);elementLayers.reverse();const layers=(0,src.Kr)((()=>{const groupIds=new Set;return elementLayers.flatMap(((element,index,list)=>{const elementLayer={isGroup:!1,isFirstElementAfterGroup:index>0&&Boolean(list[index-1].groupId),id:element.id,position:element.position};if(!(element.groupId&&!groupIds.has(element.groupId)))return elementLayer;groupIds.add(element.groupId);return[{isGroup:!0,id:element.groupId,position:element.position,name:element.groupId},elementLayer]}))}),[elementLayers]);return{layers,handleDragPosition:(0,src.hb)(((oldPosObj,newPosObj,evt)=>{const{position:oldPos}=oldPosObj,{position:newPos,data:{groupId:newGroupId}}=newPosObj,offsetTopHalf=nestedOffsetCalcFunc(evt),oldPosElement=elementLayers.find((e=>e.position===oldPos)),elementAboveNewPos=elementLayers.find((e=>e.position===(newPos<=2?1:newPos+1)));let groupId=newGroupId;offsetTopHalf&&elementAboveNewPos?.groupId&&(groupId=elementAboveNewPos.groupId),oldPosObj.data?.group?newPosObj.data?.groupId||arrangeGroup({groupId:oldPosObj.data.group,position:newPos}):arrangeElement({elementId:oldPosElement.id,position:newPos,groupId})}),[arrangeElement,arrangeGroup,elementLayers])}};function layerList_extends(){return layerList_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},layerList_extends.apply(this,arguments)}const ReorderableLayerList=(0,styled_components_browser_esm.Ay)(reorderable).attrs({"aria-orientation":"vertical","aria-label":(0,i18n.__)("Layers List","web-stories")}).withConfig({displayName:"layerList__ReorderableLayerList",componentId:"sc-1ykjl19-0"})(["flex-direction:column;width:100%;height:100%;align-items:stretch;user-select:",";overflow-y:auto;padding-bottom:4px;"],(({hasUserSelect})=>hasUserSelect?"none":"initial"));const layerList=function LayerList(){const onOpenMenu=(0,app.lS)((value=>value.onOpenMenu)),{layers,handleDragPosition}=layer_useLayers();return 0===layers.length?null:react.createElement(ReorderableLayerList,{onContextMenu:onOpenMenu,onPositionChange:handleDragPosition,mode:"vertical",getItemSize:()=>35},layers.map((layer=>react.createElement(reorderableLayer,layerList_extends({key:layer.id},layer)))))},layerPanel_Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"layerPanel__Container",componentId:"sc-1ogzglc-0"})(["filter:drop-shadow(0px -4px 8px rgba(0,0,0,0.2));max-height:","px;background-color:",";"],(({maxHeight})=>maxHeight),(({theme})=>theme.colors.bg.secondary));const layerPanel=(0,src.ph)((function LayerPanel(){const sidebarContentHeight=(0,useSidebar.A)((({state})=>state.sidebarContentHeight));return react.createElement(layerPanel_Container,{maxHeight:sidebarContentHeight},react.createElement(panel.wq,{padding:"0"},react.createElement(layerList,null)))}));var secondaryPopup=__webpack_require__("./packages/story-editor/src/components/secondaryPopup/index.js");const layers_Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"layers__Container",componentId:"sc-12gh0kb-0"})(["background-color:",";overflow:auto;z-index:",";"],(({theme})=>theme.colors.bg.secondary),zIndex.GM),StyledNavigationWrapper=(0,styled_components_browser_esm.Ay)(secondaryPopup._B).withConfig({displayName:"layers__StyledNavigationWrapper",componentId:"sc-12gh0kb-1"})(["width:260px;"]);const layers_layers=function Layers(){const numElements=(0,app.P3)((({state})=>state.currentPage?.elements?.length)),[isOpen,setIsOpen]=(0,src.J0)(!1),ref=(0,src.li)(),{renamableLayer}=(0,app.yu)((({state})=>({renamableLayer:state.renamableLayer})));return(0,src.vJ)((()=>{renamableLayer&&setIsOpen(!0)}),[renamableLayer]),react.createElement(react.Fragment,null,react.createElement(secondaryPopup.Ay,{isOpen,placement:popup_constants.W.Right,ariaLabel:(0,i18n.__)("Layers Panel","web-stories")},react.createElement(StyledNavigationWrapper,{alignRight:!0,ref,isOpen},react.createElement(layers_Container,null,react.createElement(layerPanel,null)))),react.createElement(toggleButton.f,{hasMenuList:!0,isOpen,notificationCount:numElements,copy:(0,i18n.__)("Layers","web-stories"),onClick:()=>setIsOpen((state=>!state)),"aria-label":(0,sprintf.A)((0,i18n.__)("Layers (%d)","web-stories"),numElements)}))};var box_with_dots=__webpack_require__("./packages/design-system/src/icons/box_with_dots.svg"),styles=__webpack_require__("./packages/story-editor/src/app/highlights/styles.js");const toolbarToggle_StyledButton=(0,styled_components_browser_esm.Ay)(toggleButton.f).withConfig({displayName:"toolbarToggle__StyledButton",componentId:"sc-1hbzga5-0"})(["",""],(({isHighlighted})=>isHighlighted&&(0,styled_components_browser_esm.AH)([""," ",""],styles.A.OUTLINE,styles.A.FLASH))),LOCAL_STORAGE_KEY=localStore.$.ELEMENT_TOOLBAR_SETTINGS;const toolbarToggle=function ToolbarToggle(){const{displayFloatingMenu,setDisplayFloatingMenu}=(0,app.yu)((({state,actions})=>({displayFloatingMenu:state.displayFloatingMenu,setDisplayFloatingMenu:actions.setDisplayFloatingMenu}))),{highlight,resetHighlight}=(0,highlights.N)((state=>({highlight:state[highlights.xP.ElementToolbarToggle],resetHighlight:state.onFocusOut})));return displayFloatingMenu?null:react.createElement(tooltip.A,{title:(0,i18n.__)("Show element toolbar","web-stories"),placement:popup_constants.W.Top,hasTail:!0},react.createElement(toolbarToggle_StyledButton,{ref:node=>{node&&highlight?.focus&&highlight?.showEffect&&node.focus()},onClick:()=>{const local=localStore.x.getItemByKey(LOCAL_STORAGE_KEY)||{};localStore.x.setItemByKey(LOCAL_STORAGE_KEY,{...local,isDisplayed:!0}),setDisplayFloatingMenu(!0)},"aria-label":(0,i18n.__)("Show element toolbar","web-stories"),label:(0,i18n.__)("Show element toolbar","web-stories"),isOpen:!1,isHighlighted:highlight?.showEffect,onAnimationEnd:()=>resetHighlight(),MainIcon:box_with_dots.A}))},primaryMenu_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"primaryMenu__Wrapper",componentId:"sc-1n6k8y9-0"})(["display:flex;align-items:flex-end;justify-content:flex-end;width:100%;height:100%;z-index:",";"],zIndex.GM),MenuItems=styled_components_browser_esm.Ay.div.withConfig({displayName:"primaryMenu__MenuItems",componentId:"sc-1n6k8y9-1"})(["position:relative;display:flex;flex-direction:row;align-items:center;margin-right:","px;gap:","px;"],16,8);const primaryMenu=function PrimaryMenu(){return react.createElement(primaryMenu_Wrapper,null,react.createElement(MenuItems,{id:"primary-menu-items"},react.createElement(toolbarToggle,null),react.createElement(zoomSelector,null),react.createElement(gridViewButton,null),react.createElement(layers_layers,null)))};var icons_keyboard=__webpack_require__("./packages/design-system/src/icons/keyboard.svg"),keyboardOnlyOutline=__webpack_require__("./packages/story-editor/src/utils/keyboardOnlyOutline.js"),shortcutMenu=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/shortcutMenu.js"),keyboardShortcutsMenu_constants=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/constants.js");const keyboardShortcutsMenu_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"keyboardShortcutsMenu__Wrapper",componentId:"sc-1nngfyy-0"})(["z-index:",";"],zIndex.GM);const keyboardShortcutsMenu=function KeyboardShortcutsMenu(){const anchorRef=(0,src.li)(),wrapperRef=(0,src.li)(),{close,toggle,isOpen}=(0,keyboardShortcutsMenuContext.R)((({actions:{close,toggle},state:{isOpen}})=>({close,toggle,isOpen})));return(0,src.vJ)((()=>{(0,keyboardOnlyOutline.Ho)()&&!isOpen&&anchorRef?.current?.focus?.()}),[isOpen]),(0,keyboard.pP)(keyboardShortcutsMenu_constants.l,toggle,[toggle]),(0,src.g$)(wrapperRef,close,[close]),react.createElement(directionAware.A,null,react.createElement(keyboardShortcutsMenu_Wrapper,{ref:wrapperRef},react.createElement(secondaryPopup.Ay,{popupId:"keyboard_shortcut_menu",isOpen,ariaLabel:(0,i18n.__)("Keyboard Shortcuts","web-stories")},react.createElement(shortcutMenu.A,{toggleMenu:toggle})),react.createElement(toggleButton.f,{ref:anchorRef,isOpen,"aria-owns":"keyboard_shortcut_menu",onClick:toggle,"aria-label":(0,i18n.__)("Keyboard Shortcuts","web-stories"),label:(0,i18n.__)("Keyboard Shortcuts","web-stories"),MainIcon:icons_keyboard.A,shortcut:"mod+/"})))};var global_styles=__webpack_require__("./packages/design-system/src/theme/global/styles.ts"),helpCenter=__webpack_require__("./packages/story-editor/src/app/helpCenter/index.ts"),helpCenter_constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),helpCenter_navigator=__webpack_require__("./packages/story-editor/src/components/helpCenter/navigator/index.js"),TransitionGroup=__webpack_require__("./node_modules/react-transition-group/esm/TransitionGroup.js"),helpCenter_menu=__webpack_require__("./packages/story-editor/src/components/helpCenter/menu/index.js"),quickTip=__webpack_require__("./packages/story-editor/src/components/helpCenter/quickTip/index.js");function companion_extends(){return companion_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},companion_extends.apply(this,arguments)}const companion=(0,src.ph)((function Companion({tipKey,onTipSelect,isLeftToRightTransition,readTips,components}){const{state:{tips}}=(0,app.S7)(),TIP_MAP={...tips,[helpCenter_constants.OS[0]]:helpCenter_constants.OS[1]},tip=tipKey&&TIP_MAP[tipKey];return react.createElement(TransitionGroup.A,null,tip?react.createElement(quickTip.x,companion_extends({key:tipKey,isDone:tipKey===helpCenter_constants.OS[0],transitionKey:tipKey,isLeftToRightTransition},tip)):react.createElement(helpCenter_menu.W,{key:"menu",readTips,onTipSelect,components}))}));var toggle=__webpack_require__("./packages/story-editor/src/components/helpCenter/toggle/index.js"),helpCenter_utils=__webpack_require__("./packages/story-editor/src/components/helpCenter/utils.js");const helpCenter_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"helpCenter__Wrapper",componentId:"sc-12zoy5g-0"})(["z-index:",";"],zIndex.GM),HelpCenter=({components})=>{const ref=(0,src.li)(null),{state,actions}=(0,helpCenter.S)();return(0,src.vJ)((()=>{state.isOpen&&(0,helpCenter_utils.W)()}),[state.isOpen]),(0,story.r2)(story.IM.onReplaceBackgroundMedia,(0,src.hb)((()=>{actions.openToUnreadTip(helpCenter_constants.Rk.ADD_BACKGROUND_MEDIA)}),[actions])),(0,story.r2)(story.IM.onReplaceForegroundMedia,(0,src.hb)((()=>{actions.openToUnreadTip(helpCenter_constants.Rk.CROP_SELECTED_ELEMENTS)}),[actions])),react.createElement(directionAware.A,null,react.createElement(react.Fragment,null,react.createElement(global_styles.P,null),react.createElement(helpCenter_Wrapper,{ref},react.createElement(secondaryPopup.Ay,{popupId:helpCenter_constants.DE,isOpen:state.isOpen,ariaLabel:(0,i18n.__)("Help Center","web-stories")},react.createElement(helpCenter_navigator.A,{isOpen:state.isOpen,onNext:actions.goToNext,onPrev:actions.goToPrev,onAllTips:actions.goToMenu,onClose:actions.close,hasBottomNavigation:state.hasBottomNavigation,isNextDisabled:state.isNextDisabled,isPrevDisabled:state.isPrevDisabled},react.createElement(companion,{readTips:state.readTips,tipKey:state.navigationFlow[state.navigationIndex],onTipSelect:actions.goToTip,isLeftToRightTransition:state.isLeftToRightTransition,components}))),react.createElement(toggle.l,{isOpen:state.isOpen,onClick:actions.toggle,notificationCount:state.unreadTipsCount,popupId:helpCenter_constants.DE}))))},secondaryMenu_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"secondaryMenu__Wrapper",componentId:"sc-4921wn-0"})(["display:flex;align-items:flex-end;justify-content:flex-start;width:100%;height:100%;"]),secondaryMenu_MenuItems=styled_components_browser_esm.Ay.div.withConfig({displayName:"secondaryMenu__MenuItems",componentId:"sc-4921wn-1"})(["position:relative;display:flex;flex-direction:row;align-items:center;margin-left:","px;gap:","px;"],16,8),POPUPS_HELP_CENTER="help_center",POPUPS_CHECKLIST="checklist",POPUPS_KEYBOARD_SHORTCUTS="keyboard_shortcuts";const secondaryMenu=function SecondaryMenu({menu}){const expandedPopupRef=(0,src.li)(""),{close:closeHelpCenter,isHelpCenterOpen}=(0,app.S7)((({actions:{close},state:{isOpen:isHelpCenterOpen}})=>({close,isHelpCenterOpen}))),{close:closeChecklist,open:openChecklist,isChecklistOpen}=(0,checklist.qc)((({actions:{close,open},state:{isOpen:isChecklistOpen}})=>({close,open,isChecklistOpen}))),{close:closeKeyboardShortcutsMenu,isKeyboardShortcutsMenuOpen}=(0,keyboardShortcutsMenuContext.R)((({actions:{close},state:{isOpen:isKeyboardShortcutsMenuOpen}})=>({close,isKeyboardShortcutsMenuOpen}))),{handleResetReviewChecklist,reviewChecklistRequested}=(0,checklist.Em)((({actions:{handleResetReviewChecklist},state:{reviewChecklistRequested}})=>({reviewChecklistRequested,handleResetReviewChecklist}))),isActiveTrimOrEdit=(0,app.yu)((({state:{editingElementState:{isTrimMode},isEditing}})=>isTrimMode||isEditing)),setPopupRef=(0,src.hb)(((newPopup="")=>{expandedPopupRef.current=newPopup}),[]);return(0,src.vJ)((()=>{isChecklistOpen&&expandedPopupRef.current!==POPUPS_CHECKLIST&&(closeHelpCenter(),closeKeyboardShortcutsMenu(),setPopupRef(POPUPS_CHECKLIST))}),[closeHelpCenter,closeKeyboardShortcutsMenu,isChecklistOpen,setPopupRef]),(0,src.vJ)((()=>{isHelpCenterOpen&&expandedPopupRef.current!==POPUPS_HELP_CENTER&&(closeChecklist(),closeKeyboardShortcutsMenu(),setPopupRef(POPUPS_HELP_CENTER))}),[closeChecklist,closeKeyboardShortcutsMenu,isHelpCenterOpen,setPopupRef]),(0,src.vJ)((()=>{isKeyboardShortcutsMenuOpen&&expandedPopupRef.current!==POPUPS_KEYBOARD_SHORTCUTS&&(closeChecklist(),closeHelpCenter(),setPopupRef(POPUPS_KEYBOARD_SHORTCUTS))}),[closeChecklist,closeHelpCenter,isKeyboardShortcutsMenuOpen,setPopupRef]),(0,src.vJ)((()=>{reviewChecklistRequested&&(setPopupRef(),handleResetReviewChecklist(),openChecklist())}),[reviewChecklistRequested,handleResetReviewChecklist,openChecklist,setPopupRef]),(0,src.vJ)((()=>{isActiveTrimOrEdit&&expandedPopupRef.current&&(setPopupRef(),closeChecklist(),closeHelpCenter())}),[closeChecklist,closeHelpCenter,isActiveTrimOrEdit,setPopupRef]),react.createElement(secondaryMenu_Wrapper,null,react.createElement(secondaryMenu_MenuItems,null,react.createElement(HelpCenter,{components:menu?.helpCenter}),menu?.checklist&&react.createElement(checklist.bY,{items:menu.checklist}),react.createElement(keyboardShortcutsMenu,null)))},footerLayout_Wrapper=styled_components_browser_esm.Ay.section.withConfig({displayName:"footerLayout__Wrapper",componentId:"sc-gme2s1-0"})(["position:relative;display:grid;grid:'secondary carousel primary' auto / 1fr minmax(auto,calc(100% - ","px)) 1fr;width:100%;max-width:100%;height:100%;"],3*MAX_MENU_WIDTH),footerLayout_Area=styled_components_browser_esm.Ay.div.withConfig({displayName:"footerLayout__Area",componentId:"sc-gme2s1-1"})(["grid-area:",";display:flex;align-items:flex-end;justify-content:center;z-index:",";"],(({area})=>area),(({zIndex="auto"})=>zIndex));const footerLayout=function FooterLayout({footer,zIndex}){return react.createElement(directionAware.A,null,react.createElement(footerLayout_Wrapper,{"aria-label":(0,i18n.__)("Workspace Footer","web-stories")},react.createElement(footerLayout_Area,{area:"carousel"},react.createElement(carouselContainer,null)),react.createElement(footerLayout_Area,{area:"primary",zIndex},react.createElement(primaryMenu,null)),react.createElement(footerLayout_Area,{area:"secondary",zIndex},react.createElement(secondaryMenu,{menu:footer?.secondaryMenu}))))},Outer=styled_components_browser_esm.Ay.section.withConfig({displayName:"footer__Outer",componentId:"sc-124zhi3-0"})(["height:100%;"]),footer_Inner=(0,styled_components_browser_esm.Ay)(Outer).withConfig({displayName:"footer__Inner",componentId:"sc-124zhi3-1"})(["margin-right:","px;"],(({marginRight})=>marginRight));const footer_footer=(0,src.ph)((function Footer({footer,zIndex}){const ref=(0,src.li)(),[workspaceWidth,setWorkspaceWidth]=(0,src.J0)(0);(0,src.pO)(ref,(({width})=>setWorkspaceWidth(width)),[]);const margin=(0,src.Kr)((()=>workspaceWidth>=1e3?8:0),[workspaceWidth]);return react.createElement(checklist.Ye,null,react.createElement(keyboardShortcutsMenuContext.N,null,react.createElement(Outer,{ref},react.createElement(footer_Inner,{marginRight:margin},react.createElement(footerLayout,{footer,zIndex})))))}));var contextMenu=__webpack_require__("./packages/design-system/src/components/contextMenu/contextMenu.tsx"),utils_noop=__webpack_require__("./packages/design-system/src/utils/noop.ts"),components_separator=__webpack_require__("./packages/design-system/src/components/contextMenu/components/separator.tsx"),components_button=__webpack_require__("./packages/design-system/src/components/contextMenu/components/button.tsx"),icon=__webpack_require__("./packages/design-system/src/components/contextMenu/components/icon.tsx"),icons=__webpack_require__("./packages/design-system/src/icons/index.ts"),app_history=__webpack_require__("./packages/story-editor/src/app/history/index.ts"),useInsertElement=__webpack_require__("./packages/story-editor/src/components/canvas/useInsertElement.ts"),textPresets=__webpack_require__("./packages/story-editor/src/components/library/panes/text/textPresets.ts");const ACTIONS={ADD_ANIMATION:{trackingEventName:"add_animation",text:(0,i18n.__)("Add animation","web-stories")},ADD_LINK:{trackingEventName:"add_link",text:(0,i18n.__)("Add link","web-stories")},ADD_CAPTIONS:{trackingEventName:"add_captions",text:(0,i18n.__)("Add captions","web-stories")},AUTO_STYLE_TEXT:{trackingEventName:"auto_style_text",text:(0,i18n.__)("Adaptive text colors","web-stories")},CHANGE_BACKGROUND_COLOR:{trackingEventName:"change_background_color",text:(0,i18n.__)("Change background color","web-stories")},CHANGE_TEXT_COLOR:{trackingEventName:"change_text_color",text:(0,i18n.__)("Change color","web-stories")},CHANGE_COLOR:{trackingEventName:"change_color",text:(0,i18n.__)("Change color","web-stories")},RESET_ELEMENT:{trackingEventName:"reset_element",text:(0,i18n.__)("Reset element","web-stories")},CHANGE_FONT:{trackingEventName:"change_font",text:(0,i18n.__)("Edit text","web-stories")},INSERT_BACKGROUND_MEDIA:{trackingEventName:"insert_background_media",text:(0,i18n.__)("Insert background media","web-stories")},INSERT_TEXT:{trackingEventName:"insert_text",text:(0,i18n.__)("Insert text","web-stories")},REPLACE_BACKGROUND_MEDIA:{trackingEventName:"replace_background_media",text:(0,i18n.__)("Replace background","web-stories")},REPLACE_MEDIA:{trackingEventName:"replace_media",text:(0,i18n.__)("Replace media","web-stories")},TRIM_VIDEO:{trackingEventName:"trim_video",text:(0,i18n.__)("Trim video","web-stories")},INSERT_AUDIO_STICKER:{trackingEventName:"insert_audio_sticker",text:(0,i18n.__)("Insert audio sticker","web-stories")}},RESET_PROPERTIES_ANIMATION="animation",RESET_PROPERTIES_OVERLAY="overlay",RESET_PROPERTIES_STYLES="styles",RESET_DEFAULTS_TEXT_BORDER_RADIUS={locked:!0,topLeft:2,topRight:2,bottomLeft:2,bottomRight:2},RESET_DEFAULTS_STANDARD_BORDER_RADIUS=0;const utils_getResetProperties=(selectedElement,selectedElementAnimations=[])=>{if(!selectedElement)return[];const resetProperties=[];return selectedElement?.overlay&&resetProperties.push(RESET_PROPERTIES_OVERLAY),selectedElementAnimations?.length&&resetProperties.push(RESET_PROPERTIES_ANIMATION),(selectedElement?.opacity<100||!function isBorderRadiusDefault(element){return element?.type===elements_src.bV.TEXT&&element?.borderRadius?element.borderRadius.locked&&element.borderRadius.topLeft===RESET_DEFAULTS_TEXT_BORDER_RADIUS.topLeft:!element?.borderRadius||element.borderRadius===RESET_DEFAULTS_STANDARD_BORDER_RADIUS}(selectedElement)||selectedElement?.border)&&resetProperties.push(RESET_PROPERTIES_STYLES),resetProperties};var color_bucket=__webpack_require__("./packages/design-system/src/icons/color_bucket.svg"),useApplyTextAutoStyle=__webpack_require__("./packages/story-editor/src/utils/useApplyTextAutoStyle.js");const quickActions_useTextActions=function useTextActions({selectedElement,updater,commonActions,actionProps}){const applyTextAutoStyle=(0,useApplyTextAutoStyle.A)(selectedElement,(properties=>updater({elementIds:[selectedElement?.id],properties})));return(0,src.Kr)((()=>[{Icon:color_bucket.A,label:ACTIONS.AUTO_STYLE_TEXT.text,onClick:()=>{applyTextAutoStyle(),(0,tracking_src.sx)("quick_action",{name:ACTIONS.AUTO_STYLE_TEXT.trackingEventName,element:"text"})},...actionProps},...commonActions]),[actionProps,applyTextAutoStyle,commonActions])};var settings=__webpack_require__("./packages/design-system/src/icons/settings.svg"),mic=__webpack_require__("./packages/design-system/src/icons/mic.svg"),mic_off=__webpack_require__("./packages/design-system/src/icons/mic_off.svg"),camera=__webpack_require__("./packages/design-system/src/icons/camera.svg"),camera_off=__webpack_require__("./packages/design-system/src/icons/camera_off.svg"),background_blur=__webpack_require__("./packages/design-system/src/icons/background_blur.svg"),background_blur_off=__webpack_require__("./packages/design-system/src/icons/background_blur_off.svg"),picture_swap=__webpack_require__("./packages/design-system/src/icons/picture_swap.svg"),captions=__webpack_require__("./packages/design-system/src/icons/captions.svg"),circle_speed=__webpack_require__("./packages/design-system/src/icons/circle_speed.svg"),eraser=__webpack_require__("./packages/design-system/src/icons/eraser.svg"),scissors=__webpack_require__("./packages/design-system/src/icons/scissors.svg"),mediaRecording_constants=__webpack_require__("./packages/story-editor/src/components/mediaRecording/constants.js"),updateProperties=__webpack_require__("./packages/story-editor/src/components/style/updateProperties.js");const quickActions_useElementReset=function useElementReset(){const showSnackbar=(0,useSnackbar.d)((({showSnackbar})=>showSnackbar)),{selectedElementAnimations,updateElementsById}=(0,story.P3)((({state:{selectedElementAnimations},actions:{updateElementsById}})=>({selectedElementAnimations,updateElementsById}))),{undo}=(0,app_history.W6)((({actions:{undo}})=>({undo}))),undoRef=(0,src.li)(undo);undoRef.current=undo;const handleResetProperties=(0,src.hb)(((elementType,elementId,properties)=>{const newProperties={};properties.includes(RESET_PROPERTIES_OVERLAY)&&(newProperties.overlay=null),properties.includes(RESET_PROPERTIES_ANIMATION)&&updateElementsById({elementIds:[elementId],properties:currentProperties=>(0,updateProperties.A)(currentProperties,{animation:{...selectedElementAnimations?.[0],delete:!0}},!0)}),properties.includes(RESET_PROPERTIES_STYLES)&&(newProperties.opacity=100,newProperties.border=null,newProperties.borderRadius=null),elementType===elements_src.RJ.Text&&(newProperties.borderRadius=RESET_DEFAULTS_TEXT_BORDER_RADIUS),updateElementsById({elementIds:[elementId],properties:currentProperties=>(0,updateProperties.A)(currentProperties,newProperties,!0)})}),[selectedElementAnimations,updateElementsById]);return(0,src.hb)((({elementId,resetProperties,elementType})=>{handleResetProperties(elementType,elementId,resetProperties),showSnackbar({actionLabel:(0,i18n.__)("Undo","web-stories"),dismissible:!1,message:(0,i18n.__)("Element properties have been reset","web-stories"),onAction:()=>{undoRef.current(),(0,tracking_src.sx)("quick_action",{name:`undo_${ACTIONS.RESET_ELEMENT.trackingEventName}`,element:elementType,isBackground:!0})},actionHelpText:(0,sprintf.A)((0,i18n.__)("Press %s to undo the last change","web-stories"),(0,utils.KV)("mod+z"))})}),[handleResetProperties,showSnackbar])},quickActionIconAttrs={width:24,height:24},StyledSettings=(0,styled_components_browser_esm.Ay)(settings.A).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__StyledSettings",componentId:"sc-1770zw4-0"})([""]),Mic=(0,styled_components_browser_esm.Ay)(mic.A).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__Mic",componentId:"sc-1770zw4-1"})([""]),MicOff=(0,styled_components_browser_esm.Ay)(mic_off.A).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__MicOff",componentId:"sc-1770zw4-2"})([""]),Video=(0,styled_components_browser_esm.Ay)(camera.A).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__Video",componentId:"sc-1770zw4-3"})([""]),VideoOff=(0,styled_components_browser_esm.Ay)(camera_off.A).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__VideoOff",componentId:"sc-1770zw4-4"})([""]),BackgroundBlur=(0,styled_components_browser_esm.Ay)(background_blur.A).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__BackgroundBlur",componentId:"sc-1770zw4-5"})([""]),BackgroundBlurOff=(0,styled_components_browser_esm.Ay)(background_blur_off.A).attrs(quickActionIconAttrs).withConfig({displayName:"useMediaActions__BackgroundBlurOff",componentId:"sc-1770zw4-6"})([""]);const quickActions_useMediaActions=function useMediaActions({actionProps,selectedElement,handleFocusPanel,resetProperties,commonActions}){const{capabilities:{hasUploadMediaAction}}=(0,config.UK)(),dispatchStoryEvent=(0,story._b)(),{toggleRecordingMode,toggleVideo,toggleAudio,hasVideo,hasAudio,videoEffect,setVideoEffect,toggleSettings,audioInput,videoInput,isReady,isProcessing,isAdjustingTrim,isProcessingTrim,startTrim}=(0,mediaRecording.be)((({state,actions})=>({hasAudio:state.hasAudio,hasVideo:state.hasVideo,videoEffect:state.videoEffect,audioInput:state.audioInput,videoInput:state.videoInput,isReady:!("ready"!==state.inputStatus||state.file?.type?.startsWith("image")||state.isCountingDown||"ready"!==state.status&&"idle"!==state.status),isProcessing:state.isProcessing,isAdjustingTrim:state.isAdjustingTrim,isProcessingTrim:state.isProcessingTrim,toggleRecordingMode:actions.toggleRecordingMode,toggleVideo:actions.toggleVideo,toggleAudio:actions.toggleAudio,toggleSettings:actions.toggleSettings,muteAudio:actions.muteAudio,unMuteAudio:actions.unMuteAudio,startTrim:actions.startTrim,setVideoEffect:actions.setVideoEffect}))),showClearAction=resetProperties.length>0,foregroundImageActions=(0,src.Kr)((()=>{const actions=[];return hasUploadMediaAction&&actions.push({Icon:picture_swap.A,label:ACTIONS.REPLACE_MEDIA.text,onClick:()=>{dispatchStoryEvent(story.IM.onReplaceForegroundMedia),(0,tracking_src.sx)("quick_action",{name:ACTIONS.REPLACE_MEDIA.trackingEventName,element:selectedElement?.type})},wrapWithMediaPicker:!0,...actionProps}),[...actions,...commonActions]}),[hasUploadMediaAction,commonActions,actionProps,dispatchStoryEvent,selectedElement?.type]),{handleFocusAnimationPanel,handleFocusCaptionsPanel}=(0,src.Kr)((()=>({handleFocusAnimationPanel:handleFocusPanel(highlights.xP.Animation),handleFocusCaptionsPanel:handleFocusPanel(highlights.xP.Captions)})),[handleFocusPanel]),videoActions=(0,src.Kr)((()=>{const[baseActions,clearActions]=showClearAction?[foregroundImageActions.slice(0,foregroundImageActions.length-1),foregroundImageActions.slice(-1)]:[foregroundImageActions,[]];return[...baseActions,{Icon:captions.A,label:ACTIONS.ADD_CAPTIONS.text,onClick:evt=>{handleFocusCaptionsPanel()(evt),(0,tracking_src.sx)("quick_action",{name:ACTIONS.ADD_CAPTIONS.trackingEventName,element:selectedElement?.type})},...actionProps},...clearActions]}),[actionProps,foregroundImageActions,handleFocusCaptionsPanel,selectedElement?.type,showClearAction]),handleElementReset=quickActions_useElementReset(),backgroundElementMediaActions=(0,src.Kr)((()=>{const baseActions=[{Icon:circle_speed.A,label:ACTIONS.ADD_ANIMATION.text,onClick:evt=>{handleFocusAnimationPanel()(evt),(0,tracking_src.sx)("quick_action",{name:ACTIONS.ADD_ANIMATION.trackingEventName,element:selectedElement?.type,isBackground:!0})},...actionProps}];hasUploadMediaAction&&baseActions.unshift({Icon:picture_swap.A,label:ACTIONS.REPLACE_BACKGROUND_MEDIA.text,onClick:()=>{dispatchStoryEvent(story.IM.onReplaceBackgroundMedia),(0,tracking_src.sx)("quick_action",{name:ACTIONS.REPLACE_BACKGROUND_MEDIA.trackingEventName,element:selectedElement?.type,isBackground:!0})},wrapWithMediaPicker:!0,...actionProps});const clearAction={Icon:eraser.A,label:ACTIONS.RESET_ELEMENT.text,onClick:()=>{handleElementReset({elementId:selectedElement?.id,resetProperties,elementType:elements_src.bV.IMAGE}),(0,tracking_src.sx)("quick_action",{name:ACTIONS.RESET_ELEMENT.trackingEventName,element:selectedElement?.type,isBackground:!0})},separator:"top",...actionProps};return showClearAction?[...baseActions,clearAction]:baseActions}),[actionProps,dispatchStoryEvent,handleElementReset,handleFocusAnimationPanel,hasUploadMediaAction,resetProperties,selectedElement?.id,selectedElement?.type,showClearAction]),mediaRecordingActions=(0,src.Kr)((()=>[{Icon:cross.A,label:(0,i18n.__)("Close","web-stories"),onClick:()=>{(0,tracking_src.sx)("media_recording_mode_toggled",{status:"closed"}),toggleRecordingMode()},...actionProps},{Icon:StyledSettings,label:(0,i18n.__)("Options","web-stories"),onClick:()=>{(0,tracking_src.sx)("media_recording_open_settings"),toggleSettings()},disabled:!isReady,separator:"top",...actionProps},audioInput&&{Icon:hasAudio?Mic:MicOff,label:hasAudio?(0,i18n.__)("Disable Audio","web-stories"):(0,i18n.__)("Enable Audio","web-stories"),onClick:()=>{(0,tracking_src.sx)("media_recording_audio_toggled",{status:hasAudio?"muted":"unmuted"}),toggleAudio()},disabled:!isReady||!hasVideo,...actionProps},videoInput&&{Icon:hasVideo?Video:VideoOff,label:hasVideo?(0,i18n.__)("Disable Video","web-stories"):(0,i18n.__)("Enable Video","web-stories"),onClick:()=>{(0,tracking_src.sx)("media_recording_video_toggled",{status:hasVideo?"off":"on"}),toggleVideo()},disabled:!isReady||!hasAudio,...actionProps},videoInput&&{Icon:videoEffect===mediaRecording_constants.R4.BLUR?BackgroundBlur:BackgroundBlurOff,label:videoEffect===mediaRecording_constants.R4.BLUR?(0,i18n.__)("Disable Background Blur","web-stories"):(0,i18n.__)("Enable Background Blur","web-stories"),onClick:()=>{(0,tracking_src.sx)("media_recording_background_blur_px",{value:videoEffect===mediaRecording_constants.R4.BLUR?0:mediaRecording_constants.qO});const newVideoEffect=videoEffect===mediaRecording_constants.R4.BLUR?mediaRecording_constants.R4.NONE:mediaRecording_constants.R4.BLUR;setVideoEffect(newVideoEffect)},disabled:!isReady||!hasVideo,...actionProps},{Icon:scissors.A,label:(0,i18n.__)("Trim Video","web-stories"),onClick:()=>{(0,tracking_src.sx)("media_recording_trim_start"),startTrim()},disabled:!isProcessing||isAdjustingTrim||!hasVideo||isProcessingTrim,...actionProps}].filter(Boolean)),[actionProps,isReady,audioInput,hasAudio,hasVideo,videoInput,videoEffect,isProcessing,isAdjustingTrim,isProcessingTrim,toggleRecordingMode,toggleSettings,toggleAudio,toggleVideo,setVideoEffect,startTrim]);return{backgroundElementMediaActions,foregroundImageActions,mediaRecordingActions,videoActions}};var icons_link=__webpack_require__("./packages/design-system/src/icons/link.svg");const quickActions_useForegroundActions=function useForegroundActions({actionProps,selectedElement,handleFocusPanel,resetProperties}){const{currentPageNumber}=(0,story.P3)((({state:{currentPageNumber}})=>({currentPageNumber}))),handleElementReset=quickActions_useElementReset(),showClearAction=resetProperties.length>0;return(0,src.Kr)((()=>{const handleFocusAnimationPanel=handleFocusPanel(highlights.xP.Animation),handleFocusLinkPanel=handleFocusPanel(highlights.xP.Link),commonActions=[];return currentPageNumber>1&&commonActions.push({Icon:circle_speed.A,label:ACTIONS.ADD_ANIMATION.text,onClick:evt=>{handleFocusAnimationPanel()(evt),(0,tracking_src.sx)("quick_action",{name:ACTIONS.ADD_ANIMATION.trackingEventName,element:selectedElement?.type})},...actionProps}),commonActions.push({Icon:icons_link.A,label:ACTIONS.ADD_LINK.text,onClick:evt=>{handleFocusLinkPanel()(evt),(0,tracking_src.sx)("quick_action",{name:ACTIONS.ADD_LINK.trackingEventName,element:selectedElement?.type})},...actionProps}),showClearAction&&commonActions.push({Icon:eraser.A,label:ACTIONS.RESET_ELEMENT.text,onClick:()=>{handleElementReset({elementId:selectedElement?.id,resetProperties,elementType:selectedElement?.type}),(0,tracking_src.sx)("quick_action",{name:ACTIONS.RESET_ELEMENT.trackingEventName,element:selectedElement?.type})},separator:"top",...actionProps}),commonActions}),[handleFocusPanel,currentPageNumber,actionProps,showClearAction,selectedElement?.type,selectedElement?.id,resetProperties,handleElementReset])},{Bucket,LetterTPlus,Media,AudioSticker}=icons,quickActions_useQuickActions=()=>{const{backgroundElement,selectedElementAnimations,selectedElements,updateElementsById}=(0,story.P3)((({state:{currentPage,currentPageNumber,selectedElementAnimations,selectedElements},actions:{updateElementsById}})=>({backgroundElement:currentPage?.elements.find((element=>element.isBackground)),currentPageNumber,selectedElementAnimations,selectedElements,updateElementsById}))),{undo}=(0,app_history.W6)((({actions:{undo}})=>({undo}))),{setHighlights}=(0,highlights.N)((({setHighlights})=>({setHighlights}))),{isInRecordingMode}=(0,mediaRecording.be)((({state})=>({isInRecordingMode:state.isInRecordingMode})));(0,src.li)(undo).current=undo;const selectedElement=selectedElements?.[0],handleMouseDown=(0,src.hb)((ev=>{ev.stopPropagation()}),[]),handleFocusPanel=(0,src.hb)((highlight=>elementId=>ev=>{ev.preventDefault(),setHighlights({elementId:elementId||selectedElement?.id,highlight})}),[setHighlights,selectedElement]),resetProperties=(0,src.Kr)((()=>utils_getResetProperties(selectedElement,selectedElementAnimations)),[selectedElement,selectedElementAnimations]),handleFocusMediaPanel=(0,src.Kr)((()=>{const panelToFocus=(selectedElements?.[0]?.resource?.id?.toString()||"").startsWith("media/")?highlights.xP.Media3p:highlights.xP.Media;return handleFocusPanel(panelToFocus)}),[handleFocusPanel,selectedElements]),{handleFocusPageBackground}=(0,src.Kr)((()=>({handleFocusPageBackground:handleFocusPanel(highlights.xP.PageBackground)})),[handleFocusPanel]),insertElement=(0,useInsertElement.A)(),actionMenuProps=(0,src.Kr)((()=>({tooltipPlacement:popup_constants.W.Right,onMouseDown:handleMouseDown})),[handleMouseDown]),hasAudioAnywhere=(0,story.P3)((({state})=>state.story?.backgroundAudio||state.pages?.some((page=>page.backgroundAudio||page.elements.filter((element=>element.type===elements_src.RJ.Video)).some((element=>!element.resource.isMuted)))))),noElementSelectedActions=(0,src.Kr)((()=>{const actions=[{Icon:Bucket,label:ACTIONS.CHANGE_BACKGROUND_COLOR.text,onClick:evt=>{handleFocusPageBackground(backgroundElement?.id)(evt),(0,tracking_src.sx)("quick_action",{name:ACTIONS.CHANGE_BACKGROUND_COLOR.trackingEventName,element:"none"})},...actionMenuProps},{Icon:Media,label:ACTIONS.INSERT_BACKGROUND_MEDIA.text,onClick:evt=>{handleFocusMediaPanel()(evt),(0,tracking_src.sx)("quick_action",{name:ACTIONS.INSERT_BACKGROUND_MEDIA.trackingEventName,element:"none"})},separator:"top",...actionMenuProps},{Icon:LetterTPlus,label:ACTIONS.INSERT_TEXT.text,onClick:()=>{setHighlights({highlight:highlights.xP.StylePane}),insertElement("text",textPresets.C),(0,tracking_src.sx)("quick_action",{name:ACTIONS.INSERT_TEXT.trackingEventName,element:"none"})},...actionMenuProps}];return hasAudioAnywhere&&actions.push({Icon:AudioSticker,label:ACTIONS.INSERT_AUDIO_STICKER.text,onClick:()=>{insertElement("audioSticker",constants.XK)},...actionMenuProps}),actions}),[actionMenuProps,backgroundElement,handleFocusMediaPanel,handleFocusPageBackground,setHighlights,insertElement,hasAudioAnywhere]),foregroundCommonActions=quickActions_useForegroundActions({actionProps:actionMenuProps,selectedElement,handleFocusPanel,resetProperties}),textActions=quickActions_useTextActions({selectedElement,updater:updateElementsById,commonActions:foregroundCommonActions,actionProps:actionMenuProps}),{backgroundElementMediaActions,foregroundImageActions,mediaRecordingActions,videoActions}=quickActions_useMediaActions({selectedElement,handleFocusPanel,resetProperties,commonActions:foregroundCommonActions});if(isInRecordingMode)return mediaRecordingActions;if(selectedElements.length>1)return[];const isBackgroundElementMedia=Boolean(backgroundElement&&backgroundElement?.resource),noElementsSelected=0===selectedElements.length,isBackgroundSelected=selectedElements?.[0]?.isBackground;if(noElementsSelected||isBackgroundSelected&&!isBackgroundElementMedia)return noElementSelectedActions;if(isBackgroundSelected&&isBackgroundElementMedia)return backgroundElementMediaActions;switch(selectedElements?.[0]?.type){case elements_src.RJ.Image:case elements_src.RJ.Gif:return foregroundImageActions;case elements_src.RJ.Shape:case elements_src.RJ.Sticker:return foregroundCommonActions;case elements_src.RJ.Text:return textActions;case elements_src.RJ.Video:return videoActions;default:return[]}};var translateToExclusiveList=__webpack_require__("./packages/i18n/src/translateToExclusiveList.ts"),src_mimeTypes=__webpack_require__("./packages/media/src/mimeTypes.ts"),resourceList=__webpack_require__("./packages/media/src/resourceList.ts"),media=__webpack_require__("./packages/story-editor/src/app/media/index.js"),useFFmpeg=__webpack_require__("./packages/story-editor/src/app/media/utils/useFFmpeg.ts");function mediaPicker_extends(){return mediaPicker_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},mediaPicker_extends.apply(this,arguments)}const mediaPicker=({render,...props})=>{const{allowedMimeTypes:{image:allowedImageMimeTypes,vector:allowedVectorMimeTypes,video:allowedVideoMimeTypes},MediaUpload}=(0,config.UK)(),{selectedElements,updateElementsById}=(0,story.P3)((({state:{selectedElements},actions:{updateElementsById}})=>({selectedElements,updateElementsById}))),{resetWithFetch,postProcessingResource,optimizeVideo,optimizeGif,canTranscodeResource}=(0,media.HZ)((({state:{canTranscodeResource},actions:{resetWithFetch,postProcessingResource,optimizeVideo,optimizeGif}})=>({canTranscodeResource,resetWithFetch,postProcessingResource,optimizeVideo,optimizeGif}))),{isTranscodingEnabled}=(0,useFFmpeg.A)(),{showSnackbar}=(0,useSnackbar.d)();let allowedMimeTypes=(0,src.Kr)((()=>[...allowedImageMimeTypes,...allowedVectorMimeTypes,...allowedVideoMimeTypes]),[allowedImageMimeTypes,allowedVectorMimeTypes,allowedVideoMimeTypes]);const allowedFileTypes=(0,src.Kr)((()=>allowedMimeTypes.flatMap((type=>(0,src_mimeTypes.n)(type)))),[allowedMimeTypes]);isTranscodingEnabled&&(allowedMimeTypes=allowedMimeTypes.concat(media.sX));const transcodableMimeTypes=media.sX.filter((x=>!allowedVideoMimeTypes.includes(x)));let onSelectErrorMessage=(0,i18n.__)("No file types are currently supported.","web-stories");allowedFileTypes.length&&(onSelectErrorMessage=(0,sprintf.A)((0,i18n.__)("Please choose only %s to insert into page.","web-stories"),(0,translateToExclusiveList.A)(allowedFileTypes)));const insertMediaElement=(0,src.hb)(((resource,thumbnailURL)=>{resourceList.A.set(resource.id,{url:thumbnailURL,type:"cached"}),updateElementsById({elementIds:[selectedElements?.[0]?.id],properties:{type:resource.type,resource}})}),[selectedElements,updateElementsById]),handleMediaSelect=(0,src.hb)((resource=>{try{isTranscodingEnabled&&canTranscodeResource(resource)&&(transcodableMimeTypes.includes(resource.mimeType)&&optimizeVideo({resource}),"image/gif"===resource.mimeType&&optimizeGif({resource})),insertMediaElement(resource,resource.sizes?.medium?.sourceUrl||resource.src),postProcessingResource(resource)}catch(e){showSnackbar({message:e.message,dismissable:!0})}}),[isTranscodingEnabled,canTranscodeResource,insertMediaElement,postProcessingResource,transcodableMimeTypes,optimizeVideo,optimizeGif,showSnackbar]);return react.createElement(MediaUpload,mediaPicker_extends({title:(0,i18n.__)("Replace media","web-stories"),buttonInsertText:(0,i18n.__)("Replace media","web-stories"),onSelect:handleMediaSelect,onClose:resetWithFetch,type:allowedMimeTypes,onSelectErrorMessage,render:open=>render({onClick:open})},props))};var plus_outline=__webpack_require__("./packages/design-system/src/icons/plus_outline.svg");function pageMenuButton_extends(){return pageMenuButton_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},pageMenuButton_extends.apply(this,arguments)}const pageMenuButton_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"pageMenuButton__StyledButton",componentId:"sc-x8fz92-0"})(["margin-top:12px;"]);const PageMenuButton=(0,src.Rf)((function PageMenuButtonWithRef({children,title,shortcut,...rest},forwardedRef){return react.createElement(tooltip.A,{title,shortcut,placement:popup_constants.W.Right,hasTail:!0},react.createElement(pageMenuButton_StyledButton,pageMenuButton_extends({variant:button_constants.Ak.Square,type:button_constants.VQ.Secondary,size:button_constants.Mp.Small,ref:forwardedRef},rest),children))}));PageMenuButton.propTypes={children:prop_types_default().node,title:prop_types_default().string,shortcut:prop_types_default().string};const pageMenuButton=PageMenuButton;var stop_outline=__webpack_require__("./packages/design-system/src/icons/stop_outline.svg"),play_outline=__webpack_require__("./packages/design-system/src/icons/play_outline.svg");const animationToggle=function AnimationToggle(){const{animationState,updateAnimationState,isFirstPage}=(0,app.P3)((({state:{animationState,currentPageNumber},actions:{updateAnimationState}})=>({animationState,updateAnimationState,isFirstPage:1===currentPageNumber}))),isPlaying=[animation_src.TR.Playing,animation_src.TR.PlayingSelected].includes(animationState),tooltip=isFirstPage?(0,i18n.__)("Animations Disabled","web-stories"):isPlaying?(0,i18n.__)("Stop","web-stories"):(0,i18n.__)("Play","web-stories"),label=isFirstPage?(0,i18n.__)("Page Animations Disabled","web-stories"):isPlaying?(0,i18n.__)("Stop Page Animations","web-stories"):(0,i18n.__)("Play Page Animations","web-stories"),shortcut=isFirstPage?null:"mod+enter",Icon=isPlaying?stop_outline.A:play_outline.A,toggleAnimationState=(0,src.hb)((()=>{updateAnimationState({animationState:isPlaying?animation_src.TR.Reset:animation_src.TR.Playing}),(0,tracking_src.sx)("canvas_play_animations",{status:isPlaying?"stop":"play"})}),[isPlaying,updateAnimationState]);return react.createElement(pageMenuButton,{title:tooltip,shortcut,onClick:toggleAnimationState,"aria-label":label,disabled:isFirstPage},react.createElement(Icon,null))},pageMenu_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageMenu__Wrapper",componentId:"sc-m9u2n8-0"})(["margin-top:auto;padding:0 4px;pointer-events:all;"]);const pageMenu=(0,src.ph)((function PageMenu(){const{currentPage,numberOfPages,deleteCurrentPage,addPage,hasVisibleAnimations}=(0,app.P3)((({state:{currentPage,pages},actions:{deleteCurrentPage,addPage}})=>({currentPage,numberOfPages:pages.length,deleteCurrentPage,addPage,hasVisibleAnimations:currentPage?.animations?.some((animation=>animation.targets.some((id=>!currentPage.elements.find((element=>element.id===id))?.isHidden))))}))),addPageButtonRef=(0,src.li)(null),deletePageButtonRef=(0,src.li)(null);(0,usePerformanceTracking.A)({node:addPageButtonRef.current,eventData:constants.Zy.PAGE_ADD}),(0,usePerformanceTracking.A)({node:deletePageButtonRef.current,eventData:constants.Zy.PAGE_DELETE});const handleDeletePage=(0,src.hb)((()=>deleteCurrentPage()),[deleteCurrentPage]),handleAddPage=(0,src.hb)((()=>addPage({page:(0,elements_src.a3)()})),[addPage]),handleDuplicatePage=(0,src.hb)((()=>addPage({page:(0,elements_src.hi)(currentPage)})),[addPage,currentPage]),disableDeleteButton=numberOfPages<=1;return currentPage?react.createElement(pageMenu_Wrapper,{role:"group","aria-label":(0,i18n.__)("Page actions","web-stories")},hasVisibleAnimations&&react.createElement(animationToggle,null),react.createElement(pageMenuButton,{ref:addPageButtonRef,title:(0,i18n.__)("New Page","web-stories"),onClick:handleAddPage,"aria-label":(0,i18n.__)("Add New Page","web-stories")},react.createElement(plus_outline.A,null)),react.createElement(pageMenuButton,{title:(0,i18n.__)("Duplicate Page","web-stories"),onClick:handleDuplicatePage,"aria-label":(0,i18n.__)("Duplicate Page","web-stories")},react.createElement(page_plus.A,null)),react.createElement(pageMenuButton,{ref:deletePageButtonRef,title:(0,i18n.__)("Delete Page","web-stories"),disabled:disableDeleteButton,onClick:handleDeletePage,"aria-label":(0,i18n.__)("Delete Page","web-stories")},react.createElement(trash.A,null))):null}));function pageSideMenu_extends(){return pageSideMenu_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},pageSideMenu_extends.apply(this,arguments)}const MenusWrapper=styled_components_browser_esm.Ay.section.withConfig({displayName:"pageSideMenu__MenusWrapper",componentId:"sc-sll2i1-0"})(["position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:space-between;z-index:",";pointer-events:none;min-height:100%;",""],(({$zIndex})=>$zIndex),(({isZoomed,theme})=>isZoomed&&`\n    min-height: initial;\n    background-color: ${(0,polished_esm.B3)(theme.colors.standard.black,.45)};\n    border-radius: ${theme.borders.radius.small};\n    padding: 8px;\n    margin-left: -24px;\n  `)),Divider=styled_components_browser_esm.Ay.div.withConfig({displayName:"pageSideMenu__Divider",componentId:"sc-sll2i1-1"})(["width:20px;height:1px;margin:13px auto 1px;background-color:",";"],(({theme})=>theme.colors.divider.primary)),StyledContextMenu=(0,styled_components_browser_esm.Ay)(contextMenu.A).withConfig({displayName:"pageSideMenu__StyledContextMenu",componentId:"sc-sll2i1-2"})(["pointer-events:all;"]);const pageSideMenu=function PageSideMenu(){const{zoomSetting}=(0,app.gK)((({state:{zoomSetting}})=>({zoomSetting}))),quickActions=quickActions_useQuickActions(),{isInRecordingMode}=(0,mediaRecording.be)((({state:{isInRecordingMode}})=>({isInRecordingMode}))),isZoomed=zoomSetting!==constants.gw.Fit;return react.createElement(MenusWrapper,{"aria-label":(0,i18n.__)("Page side menu","web-stories"),isZoomed,$zIndex:isInRecordingMode?zIndex.VT:zIndex.ll},quickActions.length?react.createElement(StyledContextMenu,{isInline:!0,isAlwaysVisible:!0,isIconMenu:!0,disableControlledTabNavigation:!0,"data-testid":"Element quick actions","aria-label":(0,i18n.__)("Group of available options for selected element","web-stories"),onMouseDown:e=>{e.stopPropagation()}},quickActions.map((({Icon,label,onClick,separator,tooltipPlacement,wrapWithMediaPicker,...quickAction})=>{const action=(externalOnClick=utils_noop.l)=>react.createElement(src.FK,{key:label},"top"===separator&&react.createElement(components_separator.A,null),react.createElement(tooltip.A,{placement:tooltipPlacement,title:label},react.createElement(components_button.A,pageSideMenu_extends({"aria-label":label,onClick:evt=>{onClick(evt),externalOnClick(evt)}},quickAction),react.createElement(icon.A,{title:label},react.createElement(Icon,null)))),"bottom"===separator&&react.createElement(components_separator.A,null));return wrapWithMediaPicker?react.createElement(mediaPicker,{key:label,render:({onClick:openMediaPicker})=>action(openMediaPicker)}):action()}))):null,!isInRecordingMode&&react.createElement(react.Fragment,null,isZoomed&&react.createElement(Divider,null),react.createElement(pageMenu,null)))};const navLayer=(0,src.ph)((function NavLayer({header,footer}){return react.createElement(checklist.Pi,{hasChecklist:Boolean(footer?.secondaryMenu?.checklist)},react.createElement(Layer,{pointerEvents:"none",onMouseDown:evt=>evt.stopPropagation()},react.createElement(HeadArea,{pointerEvents:"initial",zIndex:zIndex.mD},header),react.createElement(directionAware.A,null,react.createElement(PageMenuArea,null,react.createElement(pageSideMenu,null))),react.createElement(FooterArea,{pointerEvents:"initial"},react.createElement(footer_footer,{footer,zIndex:zIndex.mD}))))})),LassoMode_OFF=0,LassoMode_ON=1,LassoMode_MAYBE=2,selectionCanvas_Container=(0,moveable_src.rs)(styled_components_browser_esm.Ay.div.withConfig({displayName:"selectionCanvas__Container",componentId:"sc-qsqc5z-0"})(["position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;user-select:none;"])),Lasso=styled_components_browser_esm.Ay.div.withConfig({displayName:"selectionCanvas__Lasso",componentId:"sc-qsqc5z-1"})(["display:none;position:absolute;border:1px dotted ",";z-index:1;"],(({theme})=>theme.colors.border.selection));const selectionCanvas=function SelectionCanvas({children}){const currentPageElements=(0,app.P3)((({state})=>state.currentPage?.elements||constants.qW)),{selectedElements,clearSelection,setSelectedElementsById}=(0,app.P3)((({state:{selectedElements},actions:{clearSelection,setSelectedElementsById}})=>({selectedElements,clearSelection,setSelectedElementsById}))),{isEditing,nodesById,clearEditing}=(0,app.yu)((({state:{isEditing,nodesById},actions:{clearEditing}})=>({isEditing,nodesById,clearEditing}))),overlayRef=(0,src.li)(null),lassoRef=(0,src.li)(null),startRef=(0,src.li)([0,0]),endRef=(0,src.li)([0,0]),lassoModeRef=(0,src.li)(LassoMode_OFF),getLassoBox=(0,src.hb)((()=>{const[x1,y1]=startRef.current,[x2,y2]=endRef.current;return[Math.min(x1,x2),Math.min(y1,y2),Math.abs(x1-x2),Math.abs(y1-y2)]}),[]),updateLasso=(0,src.hb)((()=>{const lasso=lassoRef.current;if(!lasso)return;const lassoMode=lassoModeRef.current,[x,y,w,h]=getLassoBox();let offsetX=0,offsetY=0;for(let offsetNode=overlayRef.current;offsetNode;offsetNode=offsetNode.offsetParent)offsetX+=offsetNode.offsetLeft,offsetY+=offsetNode.offsetTop;const relativeX=x-offsetX,relativeY=y-offsetY;lasso.style.left=`${relativeX}px`,lasso.style.top=`${relativeY}px`,lasso.style.width=`${w}px`,lasso.style.height=`${h}px`,lasso.style.display=lassoMode===LassoMode_ON?"block":"none"}),[getLassoBox]),onMouseDown=(0,src.hb)((evt=>{nodesById[currentPageElements[0]?.id]?.contains(evt.target)||(selectedElements.length&&clearSelection(),isEditing&&clearEditing()),startRef.current=[evt.pageX,evt.pageY],endRef.current=[evt.pageX,evt.pageY],lassoModeRef.current=LassoMode_MAYBE,updateLasso()}),[clearEditing,clearSelection,currentPageElements,isEditing,nodesById,selectedElements.length,updateLasso]),onMouseMove=(0,src.hb)((evt=>{if(lassoModeRef.current===LassoMode_OFF)return;const[x1,y1]=startRef.current,x2=evt.pageX,y2=evt.pageY;endRef.current[0]=x2,endRef.current[1]=y2,updateLasso(),Math.abs(x1-x2)+Math.abs(y1-y2)>10&&(lassoModeRef.current=LassoMode_ON)}),[updateLasso]),getElementPolygon=(0,useElementPolygon.A)(),selectIntersection=(0,src.hb)((({x:lx,y:ly,width:lw,height:lh})=>{const lassoP=new(SAT_default().Box)(new(SAT_default().Vector)(lx,ly),lw,lh).toPolygon(),newSelectedElementIds=currentPageElements.filter((({isBackground,isLocked,isHidden})=>!isBackground&&!isLocked&&!isHidden)).map((({id,...rest})=>{const elementP=getElementPolygon({id,...rest});return SAT_default().testPolygonPolygon(lassoP,elementP)?id:null})).filter((id=>id));setSelectedElementsById({elementIds:newSelectedElementIds,withLinked:!0})}),[currentPageElements,setSelectedElementsById,getElementPolygon]),onMouseUp=(0,src.hb)((()=>{if(lassoModeRef.current===LassoMode_ON){const[lx,ly,lwidth,lheight]=getLassoBox();clearSelection(),clearEditing(),selectIntersection({x:lx,y:ly,width:lwidth,height:lheight})}lassoModeRef.current=LassoMode_OFF,updateLasso()}),[clearEditing,clearSelection,getLassoBox,selectIntersection,updateLasso]);return(0,src.vJ)((()=>(document.addEventListener("mouseup",onMouseUp),()=>{document.removeEventListener("mouseup",onMouseUp)})),[onMouseUp]),(0,src.vJ)(updateLasso),react.createElement(selectionCanvas_Container,{onMouseDown,onMouseMove,"data-fix-caret":!0},children,react.createElement(moveable_src.Ox,{ref:overlayRef},react.createElement(Lasso,{ref:lassoRef})))};var uploadDropTarget=__webpack_require__("./packages/story-editor/src/components/uploadDropTarget/index.js"),useUploadWithPreview=__webpack_require__("./packages/story-editor/src/components/canvas/useUploadWithPreview.js");const MESSAGE_ID="edit-story-canvas-upload-message";const canvasUploadDropTarget=function CanvasUploadDropTarget({children}){const uploadWithPreview=(0,useUploadWithPreview.A)(),onDropHandler=(0,src.hb)((files=>{files&&files.length>0&&uploadWithPreview(files)}),[uploadWithPreview]);return react.createElement(uploadDropTarget._G,{onDrop:onDropHandler,labelledBy:MESSAGE_ID},children,react.createElement(uploadDropTarget.Mj,null,react.createElement(Layer,null,react.createElement(PageArea,{overlay:react.createElement(uploadDropTarget.X4,{id:MESSAGE_ID,message:(0,i18n.__)("Upload to media library and add to the page.","web-stories")})}))))};__webpack_require__("./node_modules/core-js/modules/esnext.json.parse.js");var dragEvent=__webpack_require__("./packages/story-editor/src/utils/dragEvent.ts");const canvasElementDropzone_Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"canvasElementDropzone__Container",componentId:"sc-8cm35g-0"})(["width:100%;height:100%;"]);const canvasElementDropzone=function CanvasElementDropzone({children}){const insertElement=(0,useInsertElement.A)(),{activeDropTargetId}=(0,dropTargets.h)((state=>({activeDropTargetId:state.state.activeDropTargetId}))),{pageContainer}=(0,app.yu)((state=>({pageContainer:state.state.pageContainer}))),{editorToDataX,editorToDataY}=(0,useUnits.A)((state=>({editorToDataX:state.actions.editorToDataX,editorToDataY:state.actions.editorToDataY}))),onDropHandler=(0,src.hb)((e=>{if((0,dragEvent.d)(e,"resource/media")&&!activeDropTargetId){const{resource,offset:{x:offsetX,y:offsetY,w:offsetWidth,h:offsetHeight}}=JSON.parse(e.dataTransfer.getData("resource/media")),{x,y}=pageContainer.getBoundingClientRect();insertElement(resource.type,{resource,x:editorToDataX(e.clientX-x-offsetX),y:editorToDataY(e.clientY-y-offsetY),width:editorToDataX(offsetWidth),height:editorToDataY(offsetHeight)}),e.stopPropagation(),e.preventDefault()}}),[activeDropTargetId,pageContainer,insertElement,editorToDataX,editorToDataY]),onDragOverHandler=(0,src.hb)((e=>{(0,dragEvent.d)(e,"resource/media")&&!activeDropTargetId&&(e.stopPropagation(),e.preventDefault())}),[activeDropTargetId]);return react.createElement(canvasElementDropzone_Container,{onDrop:onDropHandler,onDragOver:onDragOverHandler},children)};var circular=__webpack_require__("./packages/design-system/src/components/circularProgress/circular.tsx"),useEyeDropperApi=__webpack_require__("./packages/story-editor/src/components/eyedropper/useEyeDropperApi.js");const utils_getColorFromPixelData=function getColorFromPixelData(pixelData,x,y,width){const colorIndices=((x,y,width)=>{const red=4*(Math.floor(y)*width+Math.floor(x));return[red,red+1,red+2,red+3]})(x,y,width),[redIndex,greenIndex,blueIndex,alphaIndex]=colorIndices;return{r:pixelData[redIndex],g:pixelData[greenIndex],b:pixelData[blueIndex],a:pixelData[alphaIndex]/255}},EyedropperBackground=(0,styled_components_browser_esm.Ay)(Layer).withConfig({displayName:"eyedropperLayer__EyedropperBackground",componentId:"sc-nf74gq-0"})(["background:",";cursor:not-allowed;z-index:2;"],(({theme})=>theme.colors.opacity.black64)),eyedropperLayer_DisplayPageArea=(0,styled_components_browser_esm.Ay)(PageArea).withConfig({displayName:"eyedropperLayer__DisplayPageArea",componentId:"sc-nf74gq-1"})(["position:absolute;"]),EyedropperCanvas=styled_components_browser_esm.Ay.div.withConfig({displayName:"eyedropperLayer__EyedropperCanvas",componentId:"sc-nf74gq-2"})(["background:transparent;border-radius:5px;position:absolute;z-index:2;transform:translateZ(0);top:0;left:0;bottom:0;right:0;cursor:default;"]),ColorInfo=styled_components_browser_esm.Ay.div.withConfig({displayName:"eyedropperLayer__ColorInfo",componentId:"sc-nf74gq-3"})(["text-transform:uppercase;margin-top:30px;padding:9px;min-width:102px;text-align:center;"]),Circle=styled_components_browser_esm.Ay.div.withConfig({displayName:"eyedropperLayer__Circle",componentId:"sc-nf74gq-4"})(["transform:translateY(20px);background:",";border:2px solid black;border-radius:50%;overflow:hidden;width:","px;height:","px;"],(({theme})=>theme.colors.bg.primary),198,200),Magnifier=styled_components_browser_esm.Ay.div.withConfig({displayName:"eyedropperLayer__Magnifier",componentId:"sc-nf74gq-5"})(["position:absolute;top:0;left:0;transform:translateY(-2000px);pointer-events:none;"]),Center=styled_components_browser_esm.Ay.div.withConfig({displayName:"eyedropperLayer__Center",componentId:"sc-nf74gq-6"})(["position:absolute;top:0;left:0;right:0;bottom:0;z-index:3;background:",";cursor:not-allowed;display:flex;justify-content:center;align-items:center;"],(({theme})=>theme.colors.opacity.black64)),CanvasImage=styled_components_browser_esm.Ay.img.withConfig({displayName:"eyedropperLayer__CanvasImage",componentId:"sc-nf74gq-7"})(["width:100%;"]);const eyedropperLayer=function EyedropperLayer(){const{fullbleedContainer,isEyedropperActive,eyedropperCallback,eyedropperImg,eyedropperPixelData,setIsEyedropperActive,setEyedropperImg,setEyedropperPixelData}=(0,app.yu)((({state:{fullbleedContainer,isEyedropperActive,eyedropperCallback,eyedropperImg,eyedropperPixelData},actions:{setIsEyedropperActive,setEyedropperImg,setEyedropperPixelData}})=>({fullbleedContainer,isEyedropperActive,eyedropperCallback,eyedropperImg,eyedropperPixelData,setIsEyedropperActive,setEyedropperImg,setEyedropperPixelData}))),{isEyeDropperApiSupported}=(0,useEyeDropperApi.A)({}),{pageWidth}=(0,app.gK)((({state:{pageWidth}})=>({pageWidth}))),fullHeight=pageWidth/src_constants.yK,img=eyedropperImg,imgRef=(0,src.li)(),magnifier=(0,src.li)(),magnifierInfo=(0,src.li)(),magnifierColor=(0,src.li)(),eyedropperCanvas=(0,src.li)(),closeEyedropper=()=>{setIsEyedropperActive(!1),setEyedropperImg(null),setEyedropperPixelData(null)};return(0,src.g$)(eyedropperCanvas,closeEyedropper,[isEyedropperActive,img]),(0,keyboard.pP)("esc",closeEyedropper),isEyeDropperApiSupported?null:isEyedropperActive&&!img?react.createElement(react.Fragment,null,react.createElement(Center,{onClick:closeEyedropper},react.createElement(circular.A,null))):isEyedropperActive&&img?react.createElement(EyedropperBackground,{"data-testid":"eyedropperLayer",onMouseMove:e=>{const{left,top,width,height}=fullbleedContainer.getBoundingClientRect(),x=(e.clientX-left)*(pageWidth/width),y=(e.clientY-top)*(fullHeight/height);if(x<0||y<0||x>width||y>height)return void(magnifierInfo.current.style.display="none");magnifierInfo.current.style.display="block",magnifierInfo.current.style.transform=`translate(${x-100}px, ${y}px)`,((x,y)=>{const canvas=magnifier.current;if(canvas){const ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.msImageSmoothingEnabled=!1,ctx.clearRect(0,0,200,200),ctx.drawImage(imgRef.current,Math.round(x-3.5),Math.round(y-3.5),7,7,0,0,200,200),ctx.beginPath(),ctx.rect(Math.round(100)-14.285714285714286,Math.round(100)-14.285714285714286,28.571428571428573,28.571428571428573),ctx.stroke()}})(x,y);const rgbaObject=utils_getColorFromPixelData(eyedropperPixelData,x,y,width),{r,g,b,a}=rgbaObject,hex=(0,polished_esm.B3)(r,g,b,a);magnifierColor.current.style.background=`rgba(${r},${g},${b},${a})`,magnifierColor.current.style.color=(0,polished_esm.W0)(hex,"#333","#EDEDED",!1),magnifierColor.current.innerText=hex}},react.createElement(eyedropperLayer_DisplayPageArea,{withSafezone:!1,showOverflow:!0},react.createElement(EyedropperCanvas,{ref:eyedropperCanvas,onClick:e=>{const{left,top,width,height}=fullbleedContainer.getBoundingClientRect(),x=(e.clientX-left)*(pageWidth/width),y=(e.clientY-top)*(fullHeight/height),rgbaObject=utils_getColorFromPixelData(eyedropperPixelData,x,y,pageWidth);eyedropperCallback(rgbaObject)}},react.createElement(CanvasImage,{ref:imgRef,src:img,alt:""}),react.createElement(Magnifier,{ref:magnifierInfo},react.createElement(Circle,null,react.createElement("canvas",{ref:magnifier,width:200,height:200})),react.createElement(ColorInfo,{ref:magnifierColor}))))):null};var contextMenu_constants=__webpack_require__("./packages/design-system/src/components/contextMenu/constants.ts"),icons_media=__webpack_require__("./packages/design-system/src/icons/media.svg"),theme=__webpack_require__("./packages/design-system/src/theme/theme.ts"),colors=__webpack_require__("./packages/design-system/src/theme/colors.ts"),useStory=__webpack_require__("./packages/story-editor/src/app/story/useStory.ts"),isEmptyStory=__webpack_require__("./packages/story-editor/src/app/story/utils/isEmptyStory.ts");const emptyStateLayer_DisplayPageArea=(0,styled_components_browser_esm.Ay)(PageArea).withConfig({displayName:"emptyStateLayer__DisplayPageArea",componentId:"sc-1ypjr32-0"})(["position:absolute;z-index:1;"]),EmptyStateMessage=styled_components_browser_esm.Ay.div.withConfig({displayName:"emptyStateLayer__EmptyStateMessage",componentId:"sc-1ypjr32-1"})(["display:flex;flex-direction:column;align-items:center;padding:20px;text-align:center;svg{pointer-events:none;}p{margin-top:14px;}"]),emptyStateLayer_StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"emptyStateLayer__StyledButton",componentId:"sc-1ypjr32-2"})(["pointer-events:initial;"]);const emptyStateLayer=function EmptyStateLayer(){const{isRTL}=(0,app.UK)(),{isMenuOpen,onOpenMenu}=(0,app.lS)((({isMenuOpen,onOpenMenu})=>({isMenuOpen,onOpenMenu}))),{pages}=(0,useStory.A)((({state:{pages}})=>({pages}))),{isAnythingTransforming}=(0,transform_src.Gy)((state=>({isAnythingTransforming:state.state.isAnythingTransforming})));return!(0,isEmptyStory.A)(pages)||isAnythingTransforming?null:react.createElement(Layer,{onContextMenu:onOpenMenu,pointerEvents:"none","aria-label":(0,i18n.__)("Empty state layer","web-stories")},react.createElement(emptyStateLayer_DisplayPageArea,{withSafezone:!1},react.createElement(EmptyStateMessage,null,react.createElement(emptyStateLayer_StyledButton,{type:button_constants.VQ.Secondary,variant:button_constants.Ak.Circle,onClick:e=>{const bb=e.target.getBoundingClientRect();e.clientX=bb.left-(isRTL?-1:1)*contextMenu_constants.o/2+bb.width/2;e.clientY=bb.top-132+bb.height,onOpenMenu(e)},"aria-haspopup":"true","aria-label":(0,i18n.__)("Add content","web-stories"),"aria-describedby":"emptystate-message","aria-expanded":isMenuOpen},react.createElement(icons_media.A,null)),react.createElement(styled_components_browser_esm.NP,{theme:{...theme.w,colors:colors.B}},react.createElement(typography_text.E.Paragraph,{id:"emptystate-message",size:types.$.Small},(0,i18n.__)("Add an image, video or template to get started","web-stories"))))))};var stylis_rtl=__webpack_require__("./node_modules/stylis-plugin-rtl/dist/stylis-rtl.js"),useConfig=__webpack_require__("./packages/story-editor/src/app/config/useConfig.ts"),videoTrimContext=__webpack_require__("./packages/story-editor/src/components/videoTrim/videoTrimContext.js"),useVideoNode=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoNode.js");const recordingProvider=function VideoRecordingTrimProvider({children,onTrim,videoData}){const{hasChanged,currentTime,startOffset,endOffset,maxOffset,videoNode,setStartOffset,setEndOffset,setVideoNode,setIsDraggingHandles}=(0,useVideoNode.A)(videoData),performTrim=(0,src.hb)((()=>{onTrim({start:startOffset,end:endOffset}),(0,tracking_src.sx)("recording_video_trim",{start_offset:startOffset,end_offset:endOffset})}),[endOffset,startOffset,onTrim]),value={state:{videoData,hasChanged,isTrimMode:!0,currentTime,startOffset,endOffset,maxOffset,videoNode},actions:{performTrim,setVideoNode,setStartOffset,setEndOffset,setIsDraggingHandles,toggleTrimMode:()=>onTrim()}};return react.createElement(videoTrimContext.A.Provider,{value},children)};Object.defineProperty(stylis_rtl.Ay,"name",{value:"stylisRTLPlugin"});const mediaRecordingLayer_DisplayPageArea=(0,styled_components_browser_esm.Ay)(PageArea).withConfig({displayName:"mediaRecordingLayer__DisplayPageArea",componentId:"sc-18wneqt-0"})(["position:absolute;"]),mediaRecordingLayer_LayerWithGrayout=(0,moveable_src.rs)((0,styled_components_browser_esm.Ay)(Layer).withConfig({displayName:"mediaRecordingLayer__LayerWithGrayout",componentId:"sc-18wneqt-1"})(["background-color:",";z-index:",";"],(({theme})=>theme.colors.opacity.overlayExtraDark),zIndex.Gu)),StyledFooter=(0,styled_components_browser_esm.Ay)(FooterArea).withConfig({displayName:"mediaRecordingLayer__StyledFooter",componentId:"sc-18wneqt-2"})(["display:flex;align-items:start;flex-direction:row;justify-content:center;z-index:",";"],zIndex.Gu);const mediaRecordingLayer=function MediaRecordingLayer(){const{isRTL}=(0,useConfig.A)(),{status,inputStatus,audioInput,videoInput,hasVideo,isAdjustingTrim,trimData,originalMediaBlobUrl,duration,updateMediaDevices,getMediaStream,resetStream,onTrim,videoEffect}=(0,mediaRecording.be)((({state,actions})=>({status:state.status,inputStatus:state.inputStatus,audioInput:state.audioInput,videoInput:state.videoInput,hasVideo:state.hasVideo,isAdjustingTrim:state.isAdjustingTrim,trimData:state.trimData,originalMediaBlobUrl:state.originalMediaBlobUrl,duration:state.duration,videoEffect:state.videoEffect,updateMediaDevices:actions.updateMediaDevices,getMediaStream:actions.getMediaStream,resetStream:actions.resetStream,onTrim:actions.onTrim}))),isReady="ready"===inputStatus||"ready"===status;(0,src.vJ)((()=>{!async function run(){resetStream(),await getMediaStream()}()}),[audioInput,videoInput,hasVideo,videoEffect]),(0,src.vJ)((()=>{isReady&&updateMediaDevices()}),[isReady,updateMediaDevices]);const videoData=(0,src.Kr)((()=>isAdjustingTrim?{element:{width:480*src_constants.yK,height:480,scale:1,focalX:50,focalY:50,flip:{}},resource:{src:originalMediaBlobUrl,length:duration},...trimData}:null),[isAdjustingTrim,trimData,originalMediaBlobUrl,duration]);return react.createElement(styled_components_browser_esm.ID,{stylisPlugins:isRTL?[stylis_rtl.Ay]:[]},react.createElement(recordingProvider,{onTrim,videoData},react.createElement(mediaRecordingLayer_LayerWithGrayout,{"aria-label":(0,i18n.__)("Media Recording layer","web-stories")},react.createElement(PageTitleContainer,null,react.createElement(mediaRecording.i$,null)),react.createElement(mediaRecordingLayer_DisplayPageArea,{withSafezone:!1,showOverflow:!0},react.createElement(mediaRecording.Iu,null)),react.createElement(StyledFooter,{showOverflow:!0},isAdjustingTrim?react.createElement(videoTrimmer,null):react.createElement(mediaRecording.wi,null))),react.createElement(mediaRecording.bB,null)))},Background=styled_components_browser_esm.Ay.section.attrs({"aria-label":(0,i18n.__)("Canvas","web-stories"),"data-fix-caret":!0}).withConfig({displayName:"canvasLayout__Background",componentId:"sc-1ciyn0c-0"})(["background-color:",";width:100%;height:100%;position:relative;user-select:none;"],(({theme})=>theme.colors.bg.primary));const canvasLayout=(0,src.ph)((function CanvasLayout({header,footer}){const boundingBoxTrackingRef=(0,app.yR)(app.DN.CANVAS_CONTAINER),setCanvasContainer=(0,app.yu)((state=>state.actions.setCanvasContainer)),backgroundRef=(0,src.li)(null),setBackgroundRef=(0,src.jn)(backgroundRef,setCanvasContainer,boundingBoxTrackingRef);!function useLayoutParams(containerRef){const{setWorkspaceSize}=(0,app.gK)((({actions:{setWorkspaceSize}})=>({setWorkspaceSize}))),footerHeight=footer_useFooterHeight();(0,src.pO)(containerRef,(({width,height})=>{const availableHeight=height-constants.uF-constants.h1-footerHeight-FOOTER_BOTTOM_MARGIN;setWorkspaceSize({width,height,availableHeight})}),[setWorkspaceSize,footerHeight])}(backgroundRef);const layoutParamsCss=function useLayoutParamsCssVars(){const{pageWidth,pageHeight,pagePadding,viewportWidth,viewportHeight,hasPageNavigation,hasVerticalOverflow,hasHorizontalOverflow,scrollLeft,scrollTop}=(0,app.gK)((({state:{pageWidth,pageHeight,pagePadding,viewportWidth,viewportHeight,hasPageNavigation,hasVerticalOverflow,hasHorizontalOverflow,scrollLeft,scrollTop}})=>({pageWidth,pageHeight,pagePadding,viewportWidth,viewportHeight,hasPageNavigation,hasVerticalOverflow,hasHorizontalOverflow,scrollLeft,scrollTop}))),fullHeight=pageWidth/src_constants.yK;return{"--page-nav-width":`${hasPageNavigation?PAGE_NAV_WIDTH:0}px`,"--page-nav-gap":`${hasPageNavigation?PAGE_NAV_GAP:0}px`,"--page-width-px":`${pageWidth}px`,"--page-height-px":`${pageHeight}px`,"--page-padding-px":`${pagePadding}px`,"--fullbleed-height-px":`${fullHeight}px`,"--viewport-width-px":`${viewportWidth}px`,"--viewport-height-px":`${viewportHeight}px`,"--overflow-x":hasHorizontalOverflow?"scroll":"visible","--overflow-y":hasVerticalOverflow?"scroll":"auto","--scroll-left-px":-scrollLeft+"px","--scroll-top-px":-scrollTop+"px"}}(),{pageWidth,pageHeight}=(0,app.gK)((({state:{pageWidth,pageHeight}})=>({pageWidth,pageHeight}))),{isInRecordingMode}=(0,mediaRecording.be)((({state:{isInRecordingMode}})=>({isInRecordingMode}))),hasDimensions=0!==pageWidth&&0!==pageHeight;return react.createElement(styled_components_browser_esm.ID,{stylisPlugins:[]},react.createElement(editLayerFocusManager.Ay,null,react.createElement(Background,{ref:setBackgroundRef,style:layoutParamsCss},react.createElement(canvasUploadDropTarget,null,react.createElement(canvasElementDropzone,null,react.createElement(selectionCanvas,null,hasDimensions&&!isInRecordingMode&&react.createElement(displayLayer,null),hasDimensions&&!isInRecordingMode&&react.createElement(framesLayer,null),react.createElement(navLayer,{header,footer})),react.createElement(editLayer,null),!isInRecordingMode&&react.createElement(react.Fragment,null,react.createElement(eyedropperLayer,null),react.createElement(emptyStateLayer,null),react.createElement(floatingMenu_layer,null)),isInRecordingMode&&react.createElement(mediaRecordingLayer,null))))))}));const canvas_canvas=function Canvas({header,footer}){return react.createElement(canvasLayout,{header,footer})};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.reduce.js");var rich_text_src=__webpack_require__("./packages/rich-text/src/index.ts"),pageCanvas=__webpack_require__("./packages/story-editor/src/app/pageCanvas/index.ts");const canvas_useInsertTextSet=function useInsertTextSet(shouldUseSmartColor=!1){const insertElement=(0,useInsertElement.A)(),calculateAccessibleTextColors=(0,pageCanvas.zN)(),{setSelectedElementsById}=(0,story.P3)((({actions:{setSelectedElementsById}})=>({setSelectedElementsById}))),insertTextSet=(0,src.T0)((async(toAdd,applySmartColor=shouldUseSmartColor)=>{const htmlFormatters=(0,rich_text_src.$d)(),{setColor}=htmlFormatters,addedElements=[],hasPredefinedColor=toAdd.some((element=>element.content?.includes("color:")));let textElementsContrasts=[],firstValidColor=null;const white={r:255,g:255,b:255},black={r:0,g:0,b:0},whiteScrim={...white,a:.3},blackScrim={...black,a:.3};let preferredScrimColor,scrimsCount,useScrim;if(applySmartColor&&!hasPredefinedColor){textElementsContrasts=await Promise.all(toAdd.map((element=>"text"===element.type?calculateAccessibleTextColors(element):null))),firstValidColor=textElementsContrasts.find((c=>c));const allColorsEqual=textElementsContrasts.every((contrast=>null===contrast||contrast.color?.r===firstValidColor.color?.r&&contrast.color?.g===firstValidColor.color?.g&&contrast.color?.b===firstValidColor.color?.b&&contrast.color?.a===firstValidColor.color?.a));scrimsCount=textElementsContrasts.reduce(((acc,contrast)=>contrast?.backgroundColor?acc+1:acc),0);const blackScrims=textElementsContrasts.reduce(((acc,contrast)=>0===contrast?.backgroundColor?.r&&0===contrast?.backgroundColor?.g&&0===contrast?.backgroundColor?.b?acc+1:acc),0);if(preferredScrimColor=scrimsCount-blackScrims>0?blackScrim:whiteScrim,useScrim=scrimsCount>0||!1===allColorsEqual,useScrim){const{textSetHeight,textSetWidth}=toAdd[0],getMinDim=dim=>Math.min.apply(null,toAdd.map((e=>e[dim]))),scrim={x:getMinDim("x")-24,y:getMinDim("y")-24,width:textSetWidth+48,height:textSetHeight+48,backgroundColor:{color:preferredScrimColor},type:"shape"};addedElements.push(insertElement(elements_src.bV.SHAPE,scrim))}}toAdd.forEach(((element,index)=>{const toInsert=(0,objectWithout.A)(element,["id","normalizedOffsetX","normalizedOffsetY","textSetWidth","textSetHeight"]);if(applySmartColor&&!hasPredefinedColor){const scrimContrastingTextColor=0===preferredScrimColor.r?white:black,autoColor=useScrim?{color:scrimContrastingTextColor}:textElementsContrasts[index];"text"===element.type&&autoColor.color&&(toInsert.content=setColor(toInsert.content,autoColor)),"shape"===element.type&&firstValidColor.color&&(element.border?toInsert.border.color=firstValidColor:toInsert.backgroundColor=firstValidColor)}addedElements.push(insertElement(element.type,toInsert))})),setSelectedElementsById({elementIds:addedElements.map((({id})=>id))})}),[calculateAccessibleTextColors,shouldUseSmartColor,insertElement,setSelectedElementsById]),insertTextSetByOffset=(0,src.hb)(((elements,{offsetX,offsetY})=>{if(!elements.length)return;const positionedTextSet=elements.map((element=>{const x=element.normalizedOffsetX+offsetX,y=element.normalizedOffsetY+offsetY,{width,height}=element;return x>src_constants.bj||x+width<0||y>src_constants._b||y+height<-src_constants.vT?null:{...element,x,y}})).filter((el=>el));insertTextSet(positionedTextSet,!1)}),[insertTextSet]);return{insertTextSet,insertTextSetByOffset}}},"./packages/story-editor/src/components/canvas/utils/useSnapping.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.some.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/units/src/constants.ts"),_dropTargets__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),_app__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/app/index.js");const __WEBPACK_DEFAULT_EXPORT__=function useSnapping({canSnap,otherNodes,snappingOffsetX=null,isDragging}){const canvasRect=(0,_app__WEBPACK_IMPORTED_MODULE_4__.fX)(_app__WEBPACK_IMPORTED_MODULE_4__.DN.CANVAS_CONTAINER),pageRect=(0,_app__WEBPACK_IMPORTED_MODULE_4__.fX)(_app__WEBPACK_IMPORTED_MODULE_4__.DN.PAGE_CONTAINER),designSpaceGuideline=(0,_app__WEBPACK_IMPORTED_MODULE_4__.yu)((({state})=>state.designSpaceGuideline)),{pageWidth,pageHeight}=(0,_app__WEBPACK_IMPORTED_MODULE_4__.gK)((({state:{pageWidth,pageHeight}})=>({pageWidth,pageHeight}))),{activeDropTargetId,isDropTargetingDisabled}=(0,_dropTargets__WEBPACK_IMPORTED_MODULE_3__.h)((({state})=>({activeDropTargetId:state.activeDropTargetId,isDropTargetingDisabled:state.isDropTargetingDisabled}))),triggerOnboarding=(0,_app__WEBPACK_IMPORTED_MODULE_4__.OB)((({SAFE_ZONE})=>SAFE_ZONE));canSnap=canSnap&&!isDropTargetingDisabled&&!activeDropTargetId;const handleSnap=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.hb)((({elements})=>{const isSnappingDesignSpace=elements.flat().some((({center,element})=>element===designSpaceGuideline&&!center));isDragging&&isSnappingDesignSpace&&triggerOnboarding()}),[isDragging,designSpaceGuideline,triggerOnboarding]);if(!canvasRect||!pageRect)return{};const canvasOffsetX=snappingOffsetX||canvasRect.x,offsetX=Math.ceil(pageRect.x-canvasOffsetX),offsetY=Math.floor(pageRect.y-canvasRect.y),verticalGuidelines=canSnap?[offsetX,offsetX+pageWidth/2,offsetX+pageWidth]:[],fullBleedOffset=(pageWidth/_googleforcreators_units__WEBPACK_IMPORTED_MODULE_5__.yK-pageHeight)/2,snapDirections={left:!0,top:!0,right:!0,bottom:!0,center:!0,middle:!0};return{snappable:canSnap,snapGap:canSnap,snapDirections,elementSnapDirections:snapDirections,isDisplaySnapDigit:!1,onSnap:handleSnap,horizontalGuidelines:canSnap?[offsetY-fullBleedOffset,offsetY,offsetY+pageHeight/2,offsetY+pageHeight,offsetY+pageHeight+fullBleedOffset]:[],verticalGuidelines,elementGuidelines:canSnap?[...otherNodes,designSpaceGuideline]:[]}}},"./packages/story-editor/src/components/elementLink/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>createLink,f:()=>getLinkFromElement});var _googleforcreators_elements__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/elements/src/index.ts");function getLinkFromElement(element){return element.link||null}function createLink({url="",needsProxy=!1,rel=[],type=_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_0__.J.Regular,pageId=null,...rest}={}){return{needsProxy,url,rel,type,pageId,...rest}}},"./packages/story-editor/src/components/helpCenter/menu/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>Menu});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts");const Panel=styled_components_browser_esm.Ay.div.withConfig({displayName:"header__Panel",componentId:"sc-1aci6do-0"})(["padding:24px 0 16px 0;border-bottom:1px solid ",";"],(({theme})=>theme.colors.bg.tertiary)),Heading=styled_components_browser_esm.Ay.h1.withConfig({displayName:"header__Heading",componentId:"sc-1aci6do-1"})([""," color:",";line-height:32px;margin:0 0 8px 0;"],expandPresetStyles.x((({label},{Medium})=>label[Medium])),(({theme})=>theme.colors.fg.primary));function Header(){return react.createElement(Panel,null,react.createElement(Heading,{as:"h2"},(0,i18n.__)("Web Stories Help Center","web-stories")),react.createElement(typography_text.E.Paragraph,{size:types.$.XSmall},(0,i18n.__)("Discover tips & resources to help you get the most out of your Web Stories.","web-stories")))}__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),arrow_left=__webpack_require__("./packages/design-system/src/icons/arrow_left.svg"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),utils=__webpack_require__("./packages/story-editor/src/components/helpCenter/utils.js"),app=__webpack_require__("./packages/story-editor/src/app/index.js");const tips_Panel=styled_components_browser_esm.Ay.div.withConfig({displayName:"tips__Panel",componentId:"sc-1bvshes-0"})(["padding:24px 0;"]),StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"tips__StyledButton",componentId:"sc-1bvshes-1"})([""," display:flex;justify-content:space-between;width:100%;padding:6px 0;"],expandPresetStyles.x((({label},{Small})=>label[Small]))),ButtonText=styled_components_browser_esm.Ay.span.withConfig({displayName:"tips__ButtonText",componentId:"sc-1bvshes-2"})(["vertical-align:middle;text-align:left;",""],(({unread,theme})=>unread&&(0,styled_components_browser_esm.AH)(["&::before{content:' ';display:inline-block;height:10px;width:10px;margin-right:16px;border-radius:",";background-color:",";}"],theme.borders.radius.round,theme.colors.accent.primary))),ArrowWrap=styled_components_browser_esm.Ay.div.withConfig({displayName:"tips__ArrowWrap",componentId:"sc-1bvshes-3"})(["width:32px;margin:-9px;transform-origin:50% 50%;transform:",";"],(({$isRTL})=>$isRTL?"none":"rotate(180deg)")),StyledArrow=(0,styled_components_browser_esm.Ay)(arrow_left.A).withConfig({displayName:"tips__StyledArrow",componentId:"sc-1bvshes-4"})(["width:100%;"]);function Tip({children,onClick,unread=!0}){const{isRTL}=(0,config.UK)();return react.createElement(StyledButton,{size:button_constants.Mp.Small,onClick},react.createElement(ButtonText,{unread},children),react.createElement(ArrowWrap,{$isRTL:isRTL},react.createElement(StyledArrow,null)))}function Tips({onTipSelect=noop.l,readTips}){const{state:{tips}}=(0,app.S7)(),tipsIterable=Object.entries(tips);return react.createElement(tips_Panel,null,tipsIterable.map((([key,tip])=>react.createElement(Tip,{unread:!readTips[key],key,onClick:()=>{(0,utils.W)(),onTipSelect(key)}},tip.title))))}var theme_constants=__webpack_require__("./packages/design-system/src/theme/constants/index.ts"),scheduledTransition=__webpack_require__("./packages/story-editor/src/components/transition/scheduledTransition.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const DURATION=1.2*constants.xt,enterStyles=(0,styled_components_browser_esm.AH)(["opacity:1;transform:none;"]),exitStyles=(0,styled_components_browser_esm.AH)(["position:absolute;bottom:0;opacity:0.6;transform:scale(0.96);"]),transitionStyles={entering:enterStyles,entered:enterStyles,exiting:exitStyles,exited:exitStyles},Manager=styled_components_browser_esm.Ay.div.withConfig({displayName:"transitioner__Manager",componentId:"sc-aat78p-0"})(["position:relative;color:",";opacity:0.6;transform-origin:50% 50%;transform:scale(0.96);transition:transform ","ms ",",opacity ","ms ",";z-index:",";",";"],(({theme})=>theme.colors.fg.primary),DURATION,theme_constants.U.default,DURATION,theme_constants.U.default,constants.Mu.MENU,(({state})=>transitionStyles[state]));function Transitioner({children,...props}){return react.createElement(scheduledTransition.x,_extends({},props,{timeout:DURATION,mountOnEnter:!0,unmountOnExit:!0}),(state=>react.createElement(Manager,{state},children)))}const Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"menu__Container",componentId:"sc-ztoh5v-0"})(["padding:0 ","px;max-height:60vh;overflow-y:scroll;*{user-select:text;}"],constants.hE);function Menu({onTipSelect=noop.l,readTips,components,...transitionProps}){const Footer=components?.Footer;return react.createElement(Transitioner,transitionProps,react.createElement(Container,{"data-testid":"help_center_container"},react.createElement(Header,null),react.createElement(Tips,{readTips,onTipSelect}),Footer&&react.createElement(Footer,null)))}},"./packages/story-editor/src/components/helpCenter/navigator/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>helpCenter_navigator});var react=__webpack_require__("./node_modules/react/index.js"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),src=__webpack_require__("./packages/react/src/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),fullSize=__webpack_require__("./packages/design-system/src/theme/helpers/fullSize.ts"),constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),secondaryPopup=__webpack_require__("./packages/story-editor/src/components/secondaryPopup/index.js"),theme_constants=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js"),__webpack_require__("./packages/design-system/src/theme/constants/index.ts")),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),arrow_left=__webpack_require__("./packages/design-system/src/icons/arrow_left.svg"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),utils=__webpack_require__("./packages/story-editor/src/components/helpCenter/utils.js");const secondaryTextStyle=(0,styled_components_browser_esm.AH)(["color:",";"],(({theme})=>theme.colors.fg.secondary)),AllTips=styled_components_browser_esm.Ay.span.withConfig({displayName:"bottomNavigation__AllTips",componentId:"sc-yk08yc-0"})(["",""],secondaryTextStyle),BottomNavBar=(0,styled_components_browser_esm.Ay)(secondaryPopup.jq).withConfig({displayName:"bottomNavigation__BottomNavBar",componentId:"sc-yk08yc-1"})(["position:absolute;bottom:0;transition:transform ","ms ",";z-index:2;",""],constants.xt,theme_constants.U.default,(({isHidden})=>isHidden&&(0,styled_components_browser_esm.AH)(["transform:translateY(100%);"]))),BottomNavButtons=styled_components_browser_esm.Ay.div.withConfig({displayName:"bottomNavigation__BottomNavButtons",componentId:"sc-yk08yc-2"})(["display:flex;padding:0 16px;white-space:nowrap;"]),ArrowWrap=styled_components_browser_esm.Ay.div.withConfig({displayName:"bottomNavigation__ArrowWrap",componentId:"sc-yk08yc-3"})([""," margin:-5px -16px;"," svg{display:block;}"],secondaryTextStyle,(({$isRTL})=>$isRTL&&(0,styled_components_browser_esm.AH)(["transform:rotate(180deg);"]))),onCondition=condition=>fn=>{condition&&fn()};function BottomNavigation({onAllTips,onPrev,onNext,hasBottomNavigation,isNextDisabled,isPrevDisabled}){const{isRTL}=(0,config.UK)(),prevButtonRef=(0,src.li)(null),nextButtonRef=(0,src.li)(null),[local,setLocal]=(0,src.J0)({isPrevDisabled,isNextDisabled});return(0,src.vJ)((()=>{[isPrevDisabled&&document.activeElement===prevButtonRef.current,isNextDisabled&&document.activeElement===nextButtonRef.current].forEach((condition=>onCondition(condition)(utils.W))),setLocal({isPrevDisabled,isNextDisabled})}),[isPrevDisabled,isNextDisabled]),react.createElement(BottomNavBar,{"aria-hidden":!hasBottomNavigation,isHidden:!hasBottomNavigation},react.createElement(BottomNavButtons,null,react.createElement(secondaryPopup.ir,{onClick:()=>{(0,utils.W)(),onAllTips()},type:button_constants.VQ.Plain,size:button_constants.Mp.Small,disabled:!hasBottomNavigation},react.createElement(ArrowWrap,{$isRTL:isRTL},react.createElement(arrow_left.A,null)),react.createElement(AllTips,null,(0,i18n.__)("All Tips","web-stories")))),react.createElement(BottomNavButtons,null,react.createElement(secondaryPopup.ir,{ref:prevButtonRef,onClick:onPrev,type:button_constants.VQ.Plain,size:button_constants.Mp.Small,disabled:!hasBottomNavigation||local.isPrevDisabled},(0,i18n.__)("Previous","web-stories")),react.createElement(secondaryPopup.ir,{ref:nextButtonRef,onClick:onNext,type:button_constants.VQ.Plain,size:button_constants.Mp.Small,disabled:!hasBottomNavigation||local.isNextDisabled},(0,i18n.__)("Next","web-stories"))))}var noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const Layout=styled_components_browser_esm.Ay.div.withConfig({displayName:"navigator__Layout",componentId:"sc-3xgugm-0"})([""," contain:content;"],fullSize.N),Content=styled_components_browser_esm.Ay.div.withConfig({displayName:"navigator__Content",componentId:"sc-3xgugm-1"})([""]),ContentInner=styled_components_browser_esm.Ay.div.withConfig({displayName:"navigator__ContentInner",componentId:"sc-3xgugm-2"})(["position:relative;"]);const helpCenter_navigator=(0,src.ph)((function Navigator({children,isOpen,onClose,onNext,onPrev,onAllTips,hasBottomNavigation,isNextDisabled,isPrevDisabled}){const innerRef=(0,src.li)(null),layoutRef=(0,src.li)(null);return(0,src.vJ)((()=>function removeInnerElementFromLayoutFlow(innerEl,outerEl){if(!innerEl||!outerEl)return noop.l;const{height}=innerEl.getBoundingClientRect();outerEl.style.height=`${height}px`,innerEl.style.position="absolute",innerEl.style.bottom=0,innerEl.style.content="contain";let id=requestAnimationFrame((()=>{id=requestAnimationFrame((()=>{outerEl.style.transition=`height ${constants.xt}ms ${theme_constants.U.default}`}))}));return()=>cancelAnimationFrame(id)}(innerRef.current,layoutRef.current)),[]),(0,src.pO)(innerRef,(({height})=>{layoutRef.current&&(layoutRef.current.style.height=`${height}px`)}),[]),react.createElement(secondaryPopup._B,{isOpen},react.createElement(secondaryPopup.IS,{onClose,label:(0,i18n.__)("Quick Tips","web-stories"),popupId:constants.DE}),react.createElement(Layout,{ref:layoutRef},react.createElement(Content,{ref:innerRef},react.createElement(ContentInner,null,children))),react.createElement(BottomNavigation,{onNext,onPrev,onAllTips,hasBottomNavigation,isNextDisabled,isPrevDisabled}))}))},"./packages/story-editor/src/components/helpCenter/quickTip/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>QuickTip});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js")),translateWithMarkup=__webpack_require__("./packages/i18n/src/translateWithMarkup.tsx"),expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),centerContent=__webpack_require__("./packages/design-system/src/theme/helpers/centerContent.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),typography_link=__webpack_require__("./packages/design-system/src/components/typography/link/index.tsx"),visuallyHidden=__webpack_require__("./packages/design-system/src/components/visuallyHidden.ts"),secondaryPopup=__webpack_require__("./packages/story-editor/src/components/secondaryPopup/index.js"),constants=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),theme_constants=__webpack_require__("./packages/design-system/src/theme/constants/index.ts"),scheduledTransition=__webpack_require__("./packages/story-editor/src/components/transition/scheduledTransition.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const DELAY=80,DURATION=constants.xt-DELAY,Opacity=styled_components_browser_esm.Ay.div.withConfig({displayName:"transitioner__Opacity",componentId:"sc-cc5d3w-0"})([""]),enterStyles=()=>(0,styled_components_browser_esm.AH)(["transition-delay:","ms;transform:none;","{opacity:1;}"],DELAY,Opacity),exitStyles=({isLeftToRightTransition})=>(0,styled_components_browser_esm.AH)(["position:absolute;bottom:0;","{opacity:0;}",""],Opacity,isLeftToRightTransition?(0,styled_components_browser_esm.AH)(["transform:translateX(-100%);"]):(0,styled_components_browser_esm.AH)(["transform:translateX(100%);"])),transitionStyles={entering:enterStyles,entered:enterStyles,exiting:exitStyles,exited:exitStyles},Manager=styled_components_browser_esm.Ay.div.withConfig({displayName:"transitioner__Manager",componentId:"sc-cc5d3w-1"})(["position:relative;color:",";background-color:",";transition:transform ","ms ",";transform-origin:50% 50%;z-index:",";"," ","{opacity:0.6;transition:opacity ","ms ",";}",";"],(({theme})=>theme.colors.fg.primary),(({theme})=>theme.colors.bg.primary),DURATION,theme_constants.U.default,constants.Mu.QUICK_TIP,(({isLeftToRightTransition})=>isLeftToRightTransition?(0,styled_components_browser_esm.AH)(["transform:translateX(100%);"]):(0,styled_components_browser_esm.AH)(["transform:translateX(-100%);"])),Opacity,DURATION,theme_constants.U.default,(({state,...props})=>transitionStyles[state]?.(props)));function Transitioner({children,isLeftToRightTransition,...props}){return react.createElement(scheduledTransition.x,_extends({},props,{timeout:{enter:DURATION+DELAY,exit:DURATION},mountOnEnter:!0,unmountOnExit:!0}),(state=>react.createElement(Manager,{state,isLeftToRightTransition},react.createElement(Opacity,null,children))))}var _circle,_path,_path2;function doneCheckmark_extends(){return doneCheckmark_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},doneCheckmark_extends.apply(this,arguments)}const SvgDoneCheckmark=({title,titleId,...props})=>react.createElement("svg",doneCheckmark_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 135 136","aria-labelledby":titleId},props),title?react.createElement("title",{id:titleId},title):null,_circle||(_circle=react.createElement("circle",{cx:67.5,cy:68.5,r:67.5,fill:"currentColor"})),_path||(_path=react.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M67.5 93.146c13.889 0 25.148-11.259 25.148-25.147 0-13.889-11.26-25.147-25.147-25.147-13.889 0-25.148 11.258-25.148 25.147s11.26 25.147 25.148 25.147"})),_path2||(_path2=react.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M81.698 57.64a1.5 1.5 0 0 1 .037 2.12l-17.93 18.563a1.5 1.5 0 0 1-2.157 0l-7.383-7.643a1.5 1.5 0 1 1 2.158-2.084l6.304 6.526 16.85-17.445a1.5 1.5 0 0 1 2.121-.037",clipRule:"evenodd"}))),doneCheckmark=(0,react.memo)(SvgDoneCheckmark);function quickTip_extends(){return quickTip_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},quickTip_extends.apply(this,arguments)}const Panel=styled_components_browser_esm.Ay.div.withConfig({displayName:"quickTip__Panel",componentId:"sc-1kyj87z-0"})(["width:100%;padding-bottom:","px;*{user-select:text;}"],secondaryPopup.BN),Overflow=styled_components_browser_esm.Ay.div.withConfig({displayName:"quickTip__Overflow",componentId:"sc-1kyj87z-1"})(["position:relative;width:100%;max-height:70vh;padding:","px;strong{font-weight:700;}"],constants.hE),Video=styled_components_browser_esm.Ay.video.withConfig({displayName:"quickTip__Video",componentId:"sc-1kyj87z-2"})(["height:180px;margin-bottom:","px;max-width:100%;"],constants.hE),Title=styled_components_browser_esm.Ay.h1.withConfig({displayName:"quickTip__Title",componentId:"sc-1kyj87z-3"})([""," color:",";line-height:32px;margin:0 0 8px 0;"],expandPresetStyles.x((({label},{Medium})=>label[Medium])),(({theme})=>theme.colors.fg.primary)),Paragraph=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"quickTip__Paragraph",componentId:"sc-1kyj87z-4"})(["& + &{margin-top:8px;}"]),DoneContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"quickTip__DoneContainer",componentId:"sc-1kyj87z-5"})([""," height:180px;margin-bottom:","px;color:#f4f2ef;svg{display:block;path{color:#4285f4;}}"],centerContent.F,constants.hE);function QuickTip({title,description,isLeftToRightTransition=!0,figureSrc,figureSrcImg,figureAlt,href,isDone=!1,...transitionProps}){const{cdnURL}=(0,app.UK)();return react.createElement(Transitioner,quickTip_extends({},transitionProps,{isLeftToRightTransition}),react.createElement(Panel,null,react.createElement(Overflow,null,Boolean(figureSrc)&&react.createElement(Video,{controls:!1,autoPlay:!0,loop:!0,muted:!0,noControls:!0,preload:"true",crossOrigin:"anonymous"},react.createElement("source",{src:`${cdnURL}${figureSrc}.webm`,type:"video/webm"}),react.createElement("source",{src:`${cdnURL}${figureSrc}.mp4`,type:"video/mp4"})),figureSrcImg&&react.createElement(Video,{as:"img",alt:figureAlt,src:`${cdnURL}${figureSrcImg}.png`,crossOrigin:"anonymous"}),isDone&&react.createElement(DoneContainer,null,react.createElement(doneCheckmark,{height:135,width:135})),react.createElement(Title,null,title),description.map(((paragraph,i)=>react.createElement(Paragraph,{key:`${title}-${i}`,size:types.$.Small},react.createElement(translateWithMarkup.A,{mapping:{a:react.createElement(typography_link.N,{size:types.$.Small,rel:"noreferrer noopener",target:"_blank",href}),screenreader:react.createElement(visuallyHidden.s,null)}},paragraph)))))))}},"./packages/story-editor/src/components/helpCenter/toggle/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>Toggle});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/i18n/src/sprintf.ts"),_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/i18n/src/i18n.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/design-system/src/icons/question_mark_outline.svg"),_toggleButton__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/components/toggleButton/index.js"),_utils_noop__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/utils/noop.ts");function Toggle({isOpen=!1,popupId="",onClick=_utils_noop__WEBPACK_IMPORTED_MODULE_2__.l,notificationCount=0}){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_toggleButton__WEBPACK_IMPORTED_MODULE_1__.f,{"aria-owns":popupId,"aria-label":notificationCount>0?(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_3__.A)((0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_4__._n)("Help Center: %s unread notification","Help Center: %s unread notifications",notificationCount,"web-stories"),notificationCount):(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_4__.__)("Help Center","web-stories"),onClick,isOpen,label:(0,_googleforcreators_i18n__WEBPACK_IMPORTED_MODULE_4__.__)("Help","web-stories"),MainIcon:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_5__.A,notificationCount})}},"./packages/story-editor/src/components/helpCenter/utils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>forceFocusCompanion});var _app_helpCenter_constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/story-editor/src/app/helpCenter/constants.ts");function forceFocusCompanion(){document.querySelector(_app_helpCenter_constants__WEBPACK_IMPORTED_MODULE_0__.Gk)?.focus()}},"./packages/story-editor/src/components/keyboardShortcutsMenu/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>TOP_MARGIN,l:()=>TOGGLE_SHORTCUTS_MENU});const TOP_MARGIN=16,TOGGLE_SHORTCUTS_MENU="mod+/"},"./packages/story-editor/src/components/keyboardShortcutsMenu/keyboardShortcutsMenuContext/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>provider,R:()=>useKeyboardShortcutsMenu});var react=__webpack_require__("./node_modules/react/index.js"),src=__webpack_require__("./packages/react/src/index.ts"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const context=(0,src.q6)({state:{isOpen:!1},actions:{toggle:noop.l,close:noop.l}});const provider=function KeyboardShortcutsMenuProvider({children}){const[isOpen,setIsOpen]=(0,src.J0)(!1),toggle=(0,src.hb)((e=>{e.preventDefault(),(0,tracking_src.sx)("shortcuts_menu_toggled",{status:isOpen?"closed":"open"}),setIsOpen((prevIsOpen=>!prevIsOpen))}),[isOpen]),close=(0,src.hb)((()=>{isOpen&&((0,tracking_src.sx)("shortcuts_menu_toggled",{status:"closed"}),setIsOpen(!1))}),[isOpen]),contextValue=(0,src.Kr)((()=>({state:{isOpen},actions:{toggle,close}})),[close,isOpen,toggle]);return react.createElement(context.Provider,{value:contextValue},children)};function useKeyboardShortcutsMenu(selector=src.D_){return(0,src.i7)(context,selector)}},"./packages/story-editor/src/components/keyboardShortcutsMenu/shortcutMenu.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>shortcutMenu});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),src=__webpack_require__("./packages/react/src/index.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),outline=__webpack_require__("./packages/design-system/src/theme/helpers/outline.ts"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),cross=__webpack_require__("./packages/design-system/src/icons/cross.svg"),src_constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),headline=__webpack_require__("./packages/design-system/src/components/typography/headline/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),translateWithMarkup=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./packages/i18n/src/translateWithMarkup.tsx")),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),utils=__webpack_require__("./packages/design-system/src/components/keyboard/utils.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const isMacOS=(0,utils.fi)(),LargeKey=props=>react.createElement("kbd",_extends({className:"large-key"},props)),ShiftKeyWrapper=props=>isMacOS?react.createElement("kbd",props):react.createElement(LargeKey,props),shortcuts={header:{label:(0,i18n.__)("Keyboard Shortcuts","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"/"))},landmarks:[{label:(0,i18n.__)("Element","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,(0,utils.KV)("alt")),react.createElement("kbd",null,"1"))},{label:(0,i18n.__)("Workspace","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,(0,utils.KV)("alt")),react.createElement("kbd",null,"2"))},{label:(0,i18n.__)("Design panels","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,(0,utils.KV)("alt")),react.createElement("kbd",null,"3"))}],sections:[{title:(0,i18n.__)("Basics","web-stories"),commands:[{label:(0,i18n.__)("Undo","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"Z"))},{label:(0,i18n.__)("Redo","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement(ShiftKeyWrapper,null,(0,utils.KV)("shift")),react.createElement("kbd",null,"Z"))},{label:(0,i18n.__)("Save","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"S"))},{label:(0,i18n.__)("Play / Stop","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,(0,utils.KV)("enter")))}]},{title:(0,i18n.__)("Text","web-stories"),commands:[{label:(0,i18n.__)("Insert/edit link","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"K"))},{label:(0,i18n.__)("Bold","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"B"))},{label:(0,i18n.__)("Italic","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"I"))},{label:(0,i18n.__)("Underline","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"U"))}]},{title:(0,i18n.__)("Element","web-stories"),commands:[{label:(0,i18n.__)("Copy","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"C"))},{label:(0,i18n.__)("Cut","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"X"))},{label:(0,i18n.__)("Duplicate","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"D"))},{label:(0,i18n.__)("Paste","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"V"))},{label:(0,i18n.__)("Copy Styles","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,(0,utils.KV)("alt")),react.createElement("kbd",null,"O"))},{label:(0,i18n.__)("Paste Styles","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,(0,utils.KV)("alt")),react.createElement("kbd",null,"P"))},{label:(0,i18n.__)("Select all","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"A"))},{label:(0,i18n.__)("Select multiple","web-stories"),shortcut:react.createElement("kbd",null,react.createElement(translateWithMarkup.A,{mapping:{lkbd:react.createElement(LargeKey,null),shortcut:react.createElement(keyboard.rm,{shortcut:"shift"})}},(0,sprintf.A)((0,i18n.__)("<lkbd>%s</lkbd> <span>+ click</span>","web-stories"),(0,utils.KV)("shift"))))},{label:(0,i18n.__)("Move forward or back","web-stories"),shortcut:react.createElement("kbd",null,react.createElement(translateWithMarkup.A,{mapping:{kbd:react.createElement("kbd",null),lkbd:react.createElement(LargeKey,null)}},(0,sprintf.A)((0,i18n.__)("<lkbd>%1$s</lkbd> <kbd>%2$s</kbd> <span>or</span> <kbd>%3$s</kbd>","web-stories"),(0,utils.KV)("mod"),(0,utils.KV)("up"),(0,utils.KV)("down"))))},{label:(0,i18n.__)("Move to front or back","web-stories"),shortcut:react.createElement("kbd",null,react.createElement(translateWithMarkup.A,{mapping:{kbd:react.createElement("kbd",null),lkbd:react.createElement(LargeKey,null)}},(0,sprintf.A)((0,i18n.__)("<lkbd>%1$s</lkbd> <lkbd>%2$s</lkbd> <kbd>%3$s</kbd> <span>or</span> <kbd>%4$s</kbd>","web-stories"),(0,utils.KV)("mod"),(0,utils.KV)("shift"),(0,utils.KV)("up"),(0,utils.KV)("down"))))},{label:(0,i18n.__)("Enter crop/edit mode","web-stories"),shortcut:react.createElement("kbd",null,react.createElement(translateWithMarkup.A,{mapping:{kbd:react.createElement("kbd",null)}},(0,sprintf.A)((0,i18n.__)("<kbd>%s</kbd> <span>or double-click</span>","web-stories"),(0,utils.KV)("enter"))))},{label:(0,i18n.__)("Delete","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("delete")))},{disabled:!0,label:(0,i18n.__)("Insert/edit link","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",null,"A"))},{label:(0,i18n.__)("Disable snapping and drop targeting","web-stories"),shortcut:react.createElement("kbd",null,react.createElement(translateWithMarkup.A,{mapping:{lkbd:react.createElement(LargeKey,null)}},(0,sprintf.A)((0,i18n.__)("<span>Hold</span> <lkbd>%s</lkbd>","web-stories"),(0,utils.KV)("mod"))))},{label:(0,i18n.__)("Access floating toolbar","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("ctrl")),react.createElement("kbd",{className:"large-key"},(0,utils.KV)("alt")),react.createElement("kbd",null,"P"))},{label:(0,i18n.__)("Open context menu","web-stories"),shortcut:react.createElement("kbd",null,react.createElement("kbd",{className:"large-key"},(0,utils.KV)("mod")),react.createElement("kbd",{className:"large-key"},(0,utils.KV)("alt")),react.createElement("kbd",{className:"large-key"},(0,utils.KV)("shift")),react.createElement("kbd",null,"M"))},{label:(0,i18n.__)("Move element 1px","web-stories"),shortcut:react.createElement("kbd",null,react.createElement(translateWithMarkup.A,{mapping:{lkbd:react.createElement(LargeKey,null),shortcut:react.createElement(keyboard.rm,{shortcut:"shift"})}},(0,sprintf.A)((0,i18n.__)("<lkbd>%s</lkbd> <span>+ arrow keys</span>","web-stories"),(0,utils.KV)("shift"))))}]}]},header=shortcuts.header,landmarks=shortcuts.landmarks.filter((o=>!o.disabled)),sections=shortcuts.sections.map((section=>({...section,commands:section.commands.filter((o=>!o.disabled))})));var expandPresetStyles=__webpack_require__("./packages/design-system/src/theme/helpers/expandPresetStyles.ts");function shortcutLabel_extends(){return shortcutLabel_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},shortcutLabel_extends.apply(this,arguments)}const Wrapper=styled_components_browser_esm.Ay.dd.withConfig({displayName:"shortcutLabel__Wrapper",componentId:"sc-6tlmvo-0"})(["display:block;margin:0;kbd{"," display:flex;justify-content:",";align-items:center;margin:0;padding:0;color:",";background-color:transparent;& > kbd{display:flex;justify-content:center;align-items:center;padding:0 5px;height:24px;width:24px;border-radius:",";border:1px solid ",";color:",";}& > kbd.large-key{width:auto;}kbd + kbd{margin-left:2px;}kbd + span{margin-left:4px;}span + kbd{margin-left:4px;}}"],expandPresetStyles.x((({paragraph},{XSmall})=>paragraph[XSmall])),(({alignment})=>alignment),(({theme})=>theme.colors.fg.secondary),(({theme})=>theme.borders.radius.medium),(({theme})=>theme.colors.border.defaultNormal),(({theme})=>theme.colors.fg.primary));const shortcutLabel=function ShortCutLabel({keys,alignment="center",...rest}){return react.createElement(Wrapper,shortcutLabel_extends({alignment},rest),keys)};function headerShortcut_extends(){return headerShortcut_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},headerShortcut_extends.apply(this,arguments)}const List=styled_components_browser_esm.Ay.dl.withConfig({displayName:"headerShortcut__List",componentId:"sc-1egg06k-0"})(["margin:24px;display:flex;flex-shrink:0;"]),Item=styled_components_browser_esm.Ay.dt.withConfig({displayName:"headerShortcut__Item",componentId:"sc-1egg06k-1"})(["margin:0 12px 0 0;"]);const headerShortcut=function HeaderShortcut(props){const{label,shortcut}=header;return react.createElement(List,null,react.createElement(Item,null,react.createElement(headline.$,headerShortcut_extends({as:"h2",size:types.$.XSmall},props),label)),react.createElement(shortcutLabel,{keys:shortcut}))};var typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts");const LandmarksWrapper=styled_components_browser_esm.Ay.dl.withConfig({displayName:"landmarkShortcuts__LandmarksWrapper",componentId:"sc-k7r8e2-0"})(["background-color:",";margin:0;padding:16px 24px;display:flex;justify-content:space-between;user-select:text;"],(({theme})=>theme.colors.bg.secondary)),Landmark=styled_components_browser_esm.Ay.div.withConfig({displayName:"landmarkShortcuts__Landmark",componentId:"sc-k7r8e2-1"})(["display:flex;flex-direction:column;"]),Label=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).attrs({size:types.$.XSmall}).withConfig({displayName:"landmarkShortcuts__Label",componentId:"sc-k7r8e2-2"})(["text-align:center;margin-top:8px;white-space:nowrap;display:inline-block;"]);const landmarkShortcuts=function LandmarkShortcuts(){return react.createElement(LandmarksWrapper,null,landmarks.map((({label,shortcut})=>react.createElement(Landmark,{key:label},react.createElement(shortcutLabel,{keys:shortcut}),react.createElement("dt",null,react.createElement(Label,null,label))))))},Header=(0,styled_components_browser_esm.Ay)(headline.$).attrs({as:"h3",size:types.$.XXSmall}).withConfig({displayName:"shortcutMenuSection__Header",componentId:"sc-xssjcb-0"})(["margin-top:24px;color:",";"],(({theme})=>theme.colors.fg.primary)),shortcutMenuSection_List=styled_components_browser_esm.Ay.dl.withConfig({displayName:"shortcutMenuSection__List",componentId:"sc-xssjcb-1"})(["display:grid;grid-template-columns:1fr;row-gap:12px;align-items:center;margin:12px 0 0;"]),ListRow=styled_components_browser_esm.Ay.div.withConfig({displayName:"shortcutMenuSection__ListRow",componentId:"sc-xssjcb-2"})(["display:grid;grid-template-columns:1fr 1fr;grid-template-rows:auto;column-gap:5px;align-items:center;dd{grid-column:1;grid-row:1;}dt{grid-column:2;grid-row:1;}"]),shortcutMenuSection_Label=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).attrs({size:types.$.Small}).withConfig({displayName:"shortcutMenuSection__Label",componentId:"sc-xssjcb-3"})(["display:inline-block;color:",";"],(({theme})=>theme.colors.fg.secondary));const shortcutMenuSection=function ShortcutMenuSection({title,commands}){const headerId=`header-${(0,v4.A)()}`;return react.createElement(react.Fragment,null,react.createElement(Header,{id:headerId},title),react.createElement(shortcutMenuSection_List,{title},commands.map((({label,shortcut})=>react.createElement(ListRow,{key:label},react.createElement(shortcutLabel,{keys:shortcut,alignment:"left"}),react.createElement("dt",null,react.createElement(shortcutMenuSection_Label,null,label)))))))},ContentWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"regularShortcuts__ContentWrapper",componentId:"sc-fl8s7-0"})(["display:flex;flex-direction:column;margin:0 24px 24px;*{user-select:text;}"]);const regularShortcuts=function RegularShortcuts(){return react.createElement(ContentWrapper,null,sections.map((({title,commands})=>react.createElement(shortcutMenuSection,{key:title,title,commands}))))};var keyboardShortcutsMenu_constants=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/constants.js"),keyboardShortcutsMenuContext=__webpack_require__("./packages/story-editor/src/components/keyboardShortcutsMenu/keyboardShortcutsMenuContext/index.ts");const Container=styled_components_browser_esm.Ay.div.withConfig({displayName:"shortcutMenu__Container",componentId:"sc-m0xcqa-0"})(["position:absolute;left:0;bottom:0;width:352px;border-radius:",";background-color:",";border:","px solid ",";"],(({theme})=>theme.borders.radius.small),(({theme})=>theme.colors.bg.primary),1,(({theme})=>theme.colors.border.defaultNormal)),EXTRA_SPACE=src_constants.ah+src_constants.uF+keyboardShortcutsMenu_constants.E-2,FlexContent=styled_components_browser_esm.Ay.div.withConfig({displayName:"shortcutMenu__FlexContent",componentId:"sc-m0xcqa-1"})(["display:flex;flex-direction:column;max-height:calc( 100vh - ","px - ","px );"],EXTRA_SPACE,(({bottomOffset})=>bottomOffset)),CloseContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"shortcutMenu__CloseContainer",componentId:"sc-m0xcqa-2"})(["position:absolute;right:4px;top:4px;"]),ScrollableContent=styled_components_browser_esm.Ay.div.withConfig({displayName:"shortcutMenu__ScrollableContent",componentId:"sc-m0xcqa-3"})(["overflow:auto;flex-shrink:1;",";"],outline.Q),HEADER_ID=`kb-header-${(0,v4.A)()}`;const shortcutMenu=function ShortcutMenu(){const anchorRef=(0,src.li)(),containerRef=(0,src.li)(),{close,toggle,isOpen}=(0,keyboardShortcutsMenuContext.R)((({actions,state})=>({toggle:actions.toggle,close:actions.close,isOpen:state.isOpen}))),[bottomOffset,setBottomOffset]=(0,src.J0)(0);return(0,src.Nf)((()=>{const node=containerRef.current;if(!node)return;const calc=()=>{const nodeRect=node.getBoundingClientRect(),docRect=node.ownerDocument.documentElement.getBoundingClientRect();setBottomOffset(docRect.height-nodeRect.y-nodeRect.height)};return calc(),setTimeout(calc),window.addEventListener("resize",calc),()=>window.removeEventListener("resize",calc)}),[]),(0,src.vJ)((()=>{isOpen&&anchorRef.current&&anchorRef.current.focus()}),[isOpen]),(0,keyboard._h)(containerRef,keyboardShortcutsMenu_constants.l,toggle,[toggle]),(0,keyboard._h)(containerRef,"esc",close),react.createElement(Container,{ref:containerRef},react.createElement(CloseContainer,null,react.createElement(button_button.$,{ref:anchorRef,type:constants.VQ.Plain,size:constants.Mp.Small,variant:constants.Ak.Circle,onClick:close,"aria-label":(0,i18n.__)("Close Menu","web-stories")},react.createElement(cross.A,null))),react.createElement(FlexContent,{bottomOffset},react.createElement(headerShortcut,{id:HEADER_ID}),react.createElement(ScrollableContent,{role:"presentation",tabIndex:0},react.createElement(landmarkShortcuts,null),react.createElement(regularShortcuts,null))))}},"./packages/story-editor/src/components/library/panes/shared/libraryMoveable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/react/src/index.ts"),styled_components__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./packages/units/src/dimensions.ts"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/moveable/src/index.ts"),_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/transform/src/index.ts"),_constants__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/constants/index.ts"),_dropTargets__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),_app_layout__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/story-editor/src/app/layout/index.ts"),_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/story-editor/src/components/canvas/useInsertElement.ts"),_canvas__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/story-editor/src/components/canvas/index.js"),_utils_isTargetOutOfContainer__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./packages/story-editor/src/utils/isTargetOutOfContainer.ts"),_canvas_utils_useSnapping__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./packages/story-editor/src/components/canvas/utils/useSnapping.js"),_app__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./packages/story-editor/src/app/index.js"),_utils_objectWithout__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./packages/story-editor/src/utils/objectWithout.ts"),_utils_noop__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),_shopping_constants__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/constants.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const TargetBox=styled_components__WEBPACK_IMPORTED_MODULE_13__.Ay.div.withConfig({displayName:"libraryMoveable__TargetBox",componentId:"sc-jgbz52-0"})(["position:absolute;width:100%;height:100%;top:0;z-index:1;cursor:pointer;"]);const __WEBPACK_DEFAULT_EXPORT__=function LibraryMoveable({type,elementProps={},handleDrag,handleDragEnd,onClick=_utils_noop__WEBPACK_IMPORTED_MODULE_14__.l,cloneElement,cloneProps,elements=[],active=!1}){const CloneElement=cloneElement,[isDragging,setIsDragging]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.J0)(!1),[didManuallyReset,setDidManuallyReset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.J0)(!1),[hover,setHover]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.J0)(!1),cloneRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.li)(null),targetBoxRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.li)(null),targetBoxSize=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.li)(null),overlayRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.li)(null),moveable=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.li)(null),pageSize=(0,_app_layout__WEBPACK_IMPORTED_MODULE_6__.g)((({state:{pageWidth,pageHeight}})=>({width:pageWidth,height:pageHeight}))),{setZoomSetting}=(0,_app_layout__WEBPACK_IMPORTED_MODULE_6__.g)((({actions:{setZoomSetting}})=>({setZoomSetting}))),insertElement=(0,_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_7__.A)(),{backgroundElement}=(0,_app__WEBPACK_IMPORTED_MODULE_10__.P3)((state=>({backgroundElement:state.state.currentPage?.elements?.[0]??{}}))),{fullbleedContainer,nodesById,pageContainer}=(0,_app__WEBPACK_IMPORTED_MODULE_10__.yu)((state=>({fullbleedContainer:state.state.fullbleedContainer,pageContainer:state.state.pageContainer,nodesById:state.state.nodesById}))),{activeDropTargetId,setDraggingResource}=(0,_dropTargets__WEBPACK_IMPORTED_MODULE_5__.h)((({state:{activeDropTargetId},actions:{setDraggingResource}})=>({activeDropTargetId,setDraggingResource}))),{clearTransforms,pushTransform}=(0,_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__.Gy)((state=>({clearTransforms:state.actions.clearTransforms,pushTransform:state.actions.pushTransform}))),frame={translate:[0,0]},{insertTextSetByOffset}=(0,_canvas__WEBPACK_IMPORTED_MODULE_8__.On)(),eventTracker=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.li)({}),resetMoveable=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.hb)((()=>{targetBoxRef.current&&cloneRef.current&&(targetBoxRef.current.style.transform=null,cloneRef.current.style.transform=null,cloneRef.current.style.opacity=0,setIsDragging(!1),clearTransforms(),setDraggingResource(null))}),[setDraggingResource,clearTransforms]);(0,_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_15__._h)(isDragging?document.body:{current:null},"esc",(()=>{setDidManuallyReset(!0),resetMoveable()}),[isDragging,resetMoveable]);const getTargetOffset=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.hb)((()=>{let offsetX=0,offsetY=0;for(let offsetNode=overlayRef.current;offsetNode;offsetNode=offsetNode.offsetParent)offsetX+=offsetNode.offsetLeft,offsetY+=offsetNode.offsetTop;return{offsetX,offsetY}}),[overlayRef]);(0,_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_12__.A)({node:targetBoxRef.current,eventData:{..._constants__WEBPACK_IMPORTED_MODULE_4__.Zy.INSERT_ELEMENT,label:type},eventType:"pointerdown"});const{offsetX:snappingOffsetX}=getTargetOffset(),snapProps=(0,_canvas_utils_useSnapping__WEBPACK_IMPORTED_MODULE_9__.A)({isDragging:!0,canSnap:!0,otherNodes:Object.values((0,_utils_objectWithout__WEBPACK_IMPORTED_MODULE_11__.A)(nodesById,[backgroundElement.id])),snappingOffsetX});return react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(TargetBox,{ref:targetBoxRef,onPointerOver:()=>setHover(!0),onPointerOut:()=>setHover(!1)}),(isDragging||active||hover)&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.Ox,{ref:overlayRef,zIndex:1,pointerEvents:"none",render:()=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(CloneElement,_extends({ref:cloneRef},cloneProps))}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.uW,_extends({ref:moveable,className:"default-moveable hide-handles",target:targetBoxRef.current,edge:!0,draggable:!0,origin:!1,pinchable:!0,onDragStart:({set,inputEvent})=>{inputEvent.stopPropagation(),setDidManuallyReset(!1),set(frame.translate),setIsDragging(!0),(evt=>{const{timeStamp,clientX,clientY}=evt;eventTracker.current={timeStamp,clientX,clientY}})(inputEvent),setZoomSetting(_constants__WEBPACK_IMPORTED_MODULE_4__.gw.Fit);const{offsetX,offsetY}=getTargetOffset(),targetBox=targetBoxRef.current.getBoundingClientRect();targetBoxSize.current={width:targetBox.width,height:targetBox.height},targetBoxRef.current.style.width=`${cloneProps.width}px`,targetBoxRef.current.style.height=`${cloneProps.height}px`;const x1=targetBox.left-offsetX,y1=targetBox.top-offsetY;cloneRef.current.style.left=`${x1}px`,cloneRef.current.style.top=`${y1}px`,moveable.current&&moveable.current.updateRect()},onDrag:({beforeTranslate,inputEvent})=>{if(pushTransform(null,{drag:beforeTranslate}),didManuallyReset)return!1;frame.translate=beforeTranslate,cloneRef.current&&(0,_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.hW)(eventTracker.current,inputEvent)&&(1===cloneRef.current.style.opacity||activeDropTargetId?activeDropTargetId&&(cloneRef.current.style.opacity=0):cloneRef.current.style.opacity=1,cloneRef.current.style.transform=`translate(${beforeTranslate[0]}px, ${beforeTranslate[1]}px)`,targetBoxRef.current.style.transform=`translate(${beforeTranslate[0]}px, ${beforeTranslate[1]}px)`),handleDrag?.(inputEvent)},onDragEnd:({inputEvent})=>{if(didManuallyReset)return!1;if(targetBoxRef.current.style.width=`${targetBoxSize.current.width}px`,targetBoxRef.current.style.height=`${targetBoxSize.current.height}px`,!(0,_googleforcreators_moveable__WEBPACK_IMPORTED_MODULE_2__.hW)(eventTracker.current,inputEvent))return resetMoveable(),onClick(),!1;if(activeDropTargetId&&handleDragEnd)handleDragEnd();else if(!(0,_utils_isTargetOutOfContainer__WEBPACK_IMPORTED_MODULE_16__.A)(cloneRef.current,fullbleedContainer)){const{x,y,width:w,height:h}=cloneRef.current.getBoundingClientRect(),{x:pageX,y:pageY}=pageContainer.getBoundingClientRect();"textSet"===type?insertTextSetByOffset(elements,{offsetX:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.z0)(x-pageX,pageSize.width),offsetY:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.GC)(y-pageY,pageSize.height)}):insertElement(type,"product"===type?{...elementProps,width:_shopping_constants__WEBPACK_IMPORTED_MODULE_18__.x,height:_shopping_constants__WEBPACK_IMPORTED_MODULE_18__.c,x:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.z0)(x-pageX,pageSize.width),y:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.GC)(y-pageY,pageSize.height)}:{...elementProps,x:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.z0)(x-pageX,pageSize.width),y:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.GC)(y-pageY,pageSize.height),width:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.z0)(w,pageSize.width),height:(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_17__.GC)(h,pageSize.height)})}resetMoveable()}},snapProps))))}},"./packages/story-editor/src/components/library/panes/shopping/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>PRODUCT_HEIGHT,x:()=>PRODUCT_WIDTH});const PRODUCT_WIDTH=25,PRODUCT_HEIGHT=25},"./packages/story-editor/src/components/library/panes/shopping/productList.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>productList});var react=__webpack_require__("./node_modules/react/index.js"),src=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.some.js"),__webpack_require__("./packages/react/src/index.ts")),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types);function useProductNavigation({isMenuFocused,products=[]}){const currentRowsRef=(0,src.li)([]),[currentFocusIndex,setCurrentFocusIndex]=(0,src.J0)(0);(0,src.vJ)((()=>{const el=currentRowsRef.current[`row-${currentFocusIndex}`];el&&isMenuFocused&&!el.contains(document.activeElement)&&el.focus()}),[currentFocusIndex,isMenuFocused]);return{handleListNav:(0,src.hb)((evt=>{const{key}=evt;"ArrowUp"===key?(evt.preventDefault(),setCurrentFocusIndex((index=>Math.max(0,index-1)))):"ArrowDown"===key&&(evt.preventDefault(),setCurrentFocusIndex((index=>Math.min(products.length-1,index+1))))}),[products]),currentRowsRef,setCurrentFocusIndex}}useProductNavigation.propTypes={isMenuFocused:prop_types_default().bool,products:prop_types_default().arrayOf(prop_types_default().object)};const shopping_useProductNavigation=useProductNavigation;var typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),libraryMoveable=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/libraryMoveable.js"),shopping_constants=__webpack_require__("./packages/story-editor/src/components/library/panes/shopping/constants.js");const imgPlaceholder=(0,styled_components_browser_esm.AH)(["display:block;margin-right:10px;border-radius:4px;background-color:",";width:41px;height:41px;"],(({theme})=>theme.colors.interactiveBg.disable)),StyledImgPlaceHolder=styled_components_browser_esm.Ay.div.withConfig({displayName:"productImage__StyledImgPlaceHolder",componentId:"sc-17w7h9b-0"})(["",""],imgPlaceholder),ProductImageWrap=styled_components_browser_esm.Ay.div.withConfig({displayName:"productImage__ProductImageWrap",componentId:"sc-17w7h9b-1"})(["position:relative;"]),StyledImage=styled_components_browser_esm.Ay.img.withConfig({displayName:"productImage__StyledImage",componentId:"sc-17w7h9b-2"})([""," object-fit:cover;"],imgPlaceholder),StyledImageClone=styled_components_browser_esm.Ay.img.withConfig({displayName:"productImage__StyledImageClone",componentId:"sc-17w7h9b-3"})(["opacity:0;position:absolute;object-fit:cover;border-radius:4px;width:","px;height:","px;"],shopping_constants.x,shopping_constants.c);function ProductImage({product}){const imageSrc=product?.productImages[0]?.url||"";return imageSrc?react.createElement(StyledImage,{alt:product?.productImages[0]?.alt,src:imageSrc,loading:"lazy",decoding:"async",draggable:!1,crossOrigin:"anonymous"}):react.createElement(StyledImgPlaceHolder,null)}const productImage=function DraggableProductImage({product,draggable}){const src=product?.productImages[0]?.url||"";return react.createElement(ProductImageWrap,null,react.createElement(ProductImage,{product}),draggable&&src&&react.createElement(libraryMoveable.A,{type:"product",elementProps:{product},cloneElement:StyledImageClone,cloneProps:{loading:"lazy",decoding:"async",crossOrigin:"anonymous",src}}))};var checkmark=__webpack_require__("./packages/design-system/src/icons/checkmark.svg"),cross=__webpack_require__("./packages/design-system/src/icons/cross.svg"),button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),plus_filled=__webpack_require__("./packages/design-system/src/icons/plus_filled.svg"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const Checkmark=(0,styled_components_browser_esm.Ay)(checkmark.A).withConfig({displayName:"productButton__Checkmark",componentId:"sc-8ap58c-0"})(["width:16px !important;height:16px !important;border-radius:100%;color:",";background-color:",";"],(({theme})=>theme.colors.interactiveBg.disable),(({theme})=>theme.colors.fg.positive)),Cross=(0,styled_components_browser_esm.Ay)(cross.A).withConfig({displayName:"productButton__Cross",componentId:"sc-8ap58c-1"})(["width:16px !important;height:16px !important;border-radius:100%;color:",";background-color:",";"],(({theme})=>theme.colors.interactiveBg.disable),(({theme})=>theme.colors.fg.negative)),StyledButton=(0,styled_components_browser_esm.Ay)(button_button.$).withConfig({displayName:"productButton__StyledButton",componentId:"sc-8ap58c-2"})(["","{display:none;}&:hover ",",&:focus-within ",",&:active ","{display:none;}&:hover ",",&:focus-within ",",&:active ","{display:block;}"],Cross,Checkmark,Checkmark,Checkmark,Cross,Cross,Cross),StyledActionsContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"productButton__StyledActionsContainer",componentId:"sc-8ap58c-3"})(["margin-right:10px;"]),DISABLED_PRODUCT_TEXT=(0,sprintf.A)((0,i18n._n)("Only %d item can be added per page.","Only %d items can be added per page.",constants.Wk,"web-stories"),constants.Wk),DISABLED_PRODUCT_IMAGE_TEXT=(0,i18n.__)("Products without images cannot be added.","web-stories"),TooltipWrapper=({hasImage,disabled,children})=>hasImage?disabled?react.createElement(tooltip.A,{hasTail:!0,title:DISABLED_PRODUCT_TEXT},children):children:react.createElement(tooltip.A,{hasTail:!0,title:DISABLED_PRODUCT_IMAGE_TEXT},children);const productButton=function ProductButton({product,onClick,onFocus,isOnPage,canAddMore}){const ADD_PRODUCT_TEXT=(0,sprintf.A)((0,i18n.__)("Add %s","web-stories"),product?.productTitle),hasImage=Boolean(product?.productImages?.length),REMOVE_PRODUCT_TEXT=(0,sprintf.A)((0,i18n.__)("Remove %s","web-stories"),product?.productTitle),disabled=!isOnPage&&!canAddMore;let ariaLabel="";return ariaLabel=hasImage?isOnPage?REMOVE_PRODUCT_TEXT:disabled?DISABLED_PRODUCT_TEXT:ADD_PRODUCT_TEXT:DISABLED_PRODUCT_IMAGE_TEXT,react.createElement(TooltipWrapper,{hasImage,disabled},react.createElement(StyledActionsContainer,null,react.createElement(StyledButton,{"aria-label":ariaLabel,"aria-disabled":!hasImage||disabled,onClick:hasImage&&!disabled?()=>{onClick(product,isOnPage)}:noop.l,type:button_constants.VQ.Tertiary,size:button_constants.Mp.Small,variant:button_constants.Ak.Square,onFocus},isOnPage?react.createElement(react.Fragment,null,react.createElement(Checkmark,null),react.createElement(Cross,null)):react.createElement(plus_filled.A,null))))};var config=__webpack_require__("./packages/story-editor/src/app/config/index.ts");const StyledPrice=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.XSmall}).withConfig({displayName:"productPrice__StyledPrice",componentId:"sc-1b0ir4w-0"})(["color:",";"],(({theme})=>theme.colors.fg.tertiary));const productPrice=function ProductPrice({price,currency}){const{locale:{locale}}=(0,config.UK)();return price&&currency&&locale?react.createElement(StyledPrice,null,new Intl.NumberFormat(locale,{style:"currency",currency}).format(price)):null},StyledDescription=styled_components_browser_esm.Ay.div.withConfig({displayName:"product__StyledDescription",componentId:"sc-1bhc150-0"})(["padding-left:12px;"]),StyledTitle=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"product__StyledTitle",componentId:"sc-1bhc150-1"})(["color:",";"],(({theme})=>theme.colors.fg.primary));const shopping_product=function Product({product,onClick,onFocus,isOnPage,canAddMore}){return react.createElement(react.Fragment,null,react.createElement(productButton,{product,isOnPage,canAddMore,onClick,onFocus}),react.createElement(productImage,{product,draggable:!isOnPage&&canAddMore}),react.createElement(StyledDescription,null,react.createElement(StyledTitle,{isBold:!0},product?.productTitle),react.createElement(productPrice,{price:product?.productPrice,currency:product?.productPriceCurrency})))},StyledListItem=styled_components_browser_esm.Ay.div.withConfig({displayName:"productList__StyledListItem",componentId:"sc-16x13t7-0"})(["display:flex;width:100%;padding:5px 0;align-items:center;border-bottom:1px solid ",";transition:background-color ease-in-out 300ms;"],(({theme})=>theme.colors.divider.tertiary));const productList=function ProductList({products=[],onPageProducts=[],onClick,isMenuFocused=!0}){const{handleListNav,currentRowsRef,setCurrentFocusIndex}=shopping_useProductNavigation({isMenuFocused,products});(0,src.vJ)((()=>{isMenuFocused||setCurrentFocusIndex(0)}),[isMenuFocused,setCurrentFocusIndex]);const canAddMore=onPageProducts.length<constants.Wk;return react.createElement("div",{"aria-label":(0,i18n.__)("Products list","web-stories"),role:"list",onKeyDown:handleListNav},products.map(((product,index)=>react.createElement(StyledListItem,{role:"listitem",key:product?.productId,tabIndex:-1,ref:el=>currentRowsRef.current[`row-${index}`]=el},react.createElement(shopping_product,{product,canAddMore,isOnPage:onPageProducts.some((item=>item.product.productId===product?.productId)),onClick,onFocus:evt=>{((evt,index)=>{currentRowsRef.current[`row-${index}`]&&"focus"===evt.type&&setCurrentFocusIndex(index)})(evt,index)}})))))}},"./packages/story-editor/src/components/mediaRecording/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{By:()=>AUDIO_FILE_TYPE,FD:()=>PHOTO_FILE_TYPE,K_:()=>VIDEO_FILE_TYPE,O8:()=>SETTINGS_POPUP_ZINDEX,Ob:()=>MAX_RECORDING_DURATION_IN_SECONDS,R4:()=>VIDEO_EFFECTS,aj:()=>VIDEO_MIME_TYPE,dN:()=>AUDIO_MIME_TYPE,qO:()=>BACKGROUND_BLUR_PX,uG:()=>COUNTDOWN_TIME_IN_SECONDS,ub:()=>MAX_RECORDING_DURATION_IN_MINUTES,z$:()=>PHOTO_MIME_TYPE});const MAX_RECORDING_DURATION_IN_SECONDS=120,MAX_RECORDING_DURATION_IN_MINUTES=2,COUNTDOWN_TIME_IN_SECONDS=3,BACKGROUND_BLUR_PX=3,VIDEO_MIME_TYPE="video/mp4",VIDEO_FILE_TYPE="mp4",AUDIO_MIME_TYPE="audio/mpeg",AUDIO_FILE_TYPE="mp3",PHOTO_MIME_TYPE="image/jpeg",PHOTO_FILE_TYPE="jpeg",SETTINGS_POPUP_ZINDEX=11,VIDEO_EFFECTS={NONE:"none",BLUR:"blur"}},"./packages/story-editor/src/components/mediaRecording/context.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=(0,__webpack_require__("./packages/react/src/index.ts").q6)({state:{},actions:{}})},"./packages/story-editor/src/components/mediaRecording/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{i$:()=>durationIndicator,wi:()=>footer,Iu:()=>mediaRecording,j0:()=>provider,bB:()=>settingsModal,be:()=>useMediaRecording.A});var useMediaRecording=__webpack_require__("./packages/story-editor/src/components/mediaRecording/useMediaRecording.js"),react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts");const countdown_Number=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({as:"div"}).withConfig({displayName:"countdown__Number",componentId:"sc-14vheov-0"})(["position:absolute;top:0;left:0;bottom:0;right:0;display:flex;align-items:center;justify-content:center;font-size:70px;font-weight:bold;color:",";"],(({theme})=>theme.colors.standard.white));const countdown=function Countdown(){const{countdown}=(0,useMediaRecording.A)((({state})=>({countdown:state.countdown})));return countdown>0?react.createElement(countdown_Number,null,countdown):null};var polished_esm=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),constants=__webpack_require__("./packages/story-editor/src/components/mediaRecording/constants.js");const ProgressIndicator=styled_components_browser_esm.Ay.progress.withConfig({displayName:"progressBar__ProgressIndicator",componentId:"sc-oxcipv-0"})(["appearance:none;border:none;width:100%;height:8px;position:absolute;top:0;left:0;right:0;background-color:",";border-top-left-radius:5px;border-top-right-radius:5px;&::-webkit-progress-bar{background-color:",";border-top-left-radius:5px;border-top-right-radius:5px;}&::-webkit-progress-value{background-color:",";border-top-left-radius:5px;}&::-moz-progress-bar{background-color:",";border-top-left-radius:5px;}"],(({theme})=>(0,polished_esm.B3)(theme.colors.fg.primary,.3)),(({theme})=>(0,polished_esm.B3)(theme.colors.fg.primary,.3)),(({theme})=>theme.colors.fg.primary),(({theme})=>theme.colors.fg.primary));const progressBar=function ProgressBar(){const{duration,isRecording}=(0,useMediaRecording.A)((({state})=>({duration:state.duration,isRecording:["recording","paused"].includes(state.status)})));return isRecording?react.createElement(ProgressIndicator,{value:duration,max:constants.Ob}):null};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js");var i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),src=__webpack_require__("./packages/react/src/index.ts"),useVideoTrim=__webpack_require__("./packages/story-editor/src/components/videoTrim/useVideoTrim.js"),noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts"),camera=__webpack_require__("./packages/design-system/src/icons/camera.svg"),gif=__webpack_require__("./packages/design-system/src/icons/gif.svg"),components_form=__webpack_require__("./packages/story-editor/src/components/form/index.js");const Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"videoMode__Wrapper",componentId:"sc-y6q7x7-0"})(["position:absolute;z-index:2;top:20px;right:20px;width:70px;"]),StyledSwitch=(0,styled_components_browser_esm.Ay)(components_form.dO).withConfig({displayName:"videoMode__StyledSwitch",componentId:"sc-y6q7x7-1"})(["background:",";"],(({theme})=>theme.colors.bg.tertiary)),CameraIcon=(0,styled_components_browser_esm.Ay)(camera.A).attrs({title:(0,i18n.__)("Use as video","web-stories")}).withConfig({displayName:"videoMode__CameraIcon",componentId:"sc-y6q7x7-2"})(["flex:1;"]),GifIcon=(0,styled_components_browser_esm.Ay)(gif.A).attrs({title:(0,i18n.__)("Use as GIF","web-stories")}).withConfig({displayName:"videoMode__GifIcon",componentId:"sc-y6q7x7-3"})(["flex:1;"]);const videoMode=function VideoMode({value,onChange}){return react.createElement(Wrapper,null,react.createElement(StyledSwitch,{groupLabel:(0,i18n.__)("Video Mode","web-stories"),name:"video-mode-switch",value,onLabel:react.createElement(CameraIcon,null),offLabel:react.createElement(GifIcon,null),onChange}))};var play_filled=__webpack_require__("./packages/design-system/src/icons/play_filled.svg"),stop_filled=__webpack_require__("./packages/design-system/src/icons/stop_filled.svg"),keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts");const Controls=styled_components_browser_esm.Ay.div.withConfig({displayName:"playPauseButton__Controls",componentId:"sc-bvqqpx-0"})(["position:absolute;z-index:2;"]),ButtonWrapper=styled_components_browser_esm.Ay.button.attrs({tabIndex:-1}).withConfig({displayName:"playPauseButton__ButtonWrapper",componentId:"sc-bvqqpx-1"})(["cursor:pointer;pointer-events:initial;width:","px;height:","px;overflow:hidden;background:transparent;border:none;padding:0;"],82,82),iconCss=(0,styled_components_browser_esm.AH)(["width:","px;height:","px;color:",";filter:drop-shadow( 0px 0px 10px "," );"],72,72,(({theme})=>theme.colors.standard.white),(({theme})=>(0,polished_esm.B3)(theme.colors.bg.primary,.4))),Play=(0,styled_components_browser_esm.Ay)(play_filled.A).withConfig({displayName:"playPauseButton__Play",componentId:"sc-bvqqpx-2"})(["",";"],iconCss),Pause=(0,styled_components_browser_esm.Ay)(stop_filled.A).withConfig({displayName:"playPauseButton__Pause",componentId:"sc-bvqqpx-3"})(["",";"],iconCss);const playPauseButton=function PlayPauseButton({videoRef}){const{isRTL}=(0,config.UK)(),[showControls,setShowControls]=(0,src.J0)(!0),[isPlaying,setIsPlaying]=(0,src.J0)(!0);(0,src.vJ)((()=>{const videoNode=videoRef?.current,onVideoEnd=()=>{videoNode&&(videoNode.currentTime=0),setIsPlaying(!1)};return videoNode?.addEventListener("ended",onVideoEnd),()=>videoNode?.removeEventListener("ended",onVideoEnd)}),[videoRef]),(0,src.vJ)((()=>{const videoNode=videoRef?.current;if(!videoNode)return;const onVideoPlay=()=>setIsPlaying(!0),onVideoPause=()=>setIsPlaying(!1),onTimeUpdate=({target:{paused}})=>setIsPlaying(!paused);return videoNode.addEventListener("play",onVideoPlay),videoNode.addEventListener("pause",onVideoPause),videoNode.addEventListener("timeupdate",onTimeUpdate),()=>{videoNode.removeEventListener("play",onVideoPlay),videoNode.removeEventListener("pause",onVideoPause),videoNode.removeEventListener("timeupdate",onTimeUpdate)}}),[videoRef]);const handlePlayPause=evt=>{evt.stopPropagation();const videoNode=videoRef?.current;videoNode&&(isPlaying?(videoNode.pause(),setShowControls(!0)):videoNode.play().catch(noop.l))};(0,keyboard._h)(videoRef,{key:["space"]},handlePlayPause,[handlePlayPause]);const nodeRef=(0,src.li)(),buttonLabel=isPlaying?(0,i18n.__)("Click to pause","web-stories"):(0,i18n.__)("Click to play","web-stories"),Icon=isPlaying?Pause:Play;return react.createElement(Controls,null,showControls&&react.createElement(ButtonWrapper,{ref:nodeRef,"aria-label":buttonLabel,"aria-pressed":isPlaying,key:"wrapper",onClick:handlePlayPause},react.createElement(Icon,{$isRTL:isRTL})))};var types=__webpack_require__("./packages/design-system/src/theme/types.ts");const MessageWrap=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaRecording__MessageWrap",componentId:"sc-tmkrsc-0"})(["display:flex;flex-direction:column;align-items:center;align-content:center;padding:20px;height:100%;justify-content:center;text-align:center;user-select:text;"]),MessageHeading=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.XLarge}).withConfig({displayName:"mediaRecording__MessageHeading",componentId:"sc-tmkrsc-1"})(["margin:0 0 14px;"]),MessageText=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"mediaRecording__MessageText",componentId:"sc-tmkrsc-2"})(["margin:0 0 14px;"]),components_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaRecording__Wrapper",componentId:"sc-tmkrsc-3"})(["background-color:",";border-radius:5px;position:absolute;transform:translateZ(0);top:0;left:0;bottom:0;right:0;cursor:default;"],(({theme})=>theme.colors.standard.white)),VideoWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaRecording__VideoWrapper",componentId:"sc-tmkrsc-4"})(["width:100%;height:100%;background:#000;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;"]),Photo=styled_components_browser_esm.Ay.img.withConfig({displayName:"mediaRecording__Photo",componentId:"sc-tmkrsc-5"})(["display:block;width:100%;height:100%;object-fit:cover;border-radius:5px;"]),Video=styled_components_browser_esm.Ay.video.attrs({autoPlay:!0,disablePictureInPicture:!0}).withConfig({displayName:"mediaRecording__Video",componentId:"sc-tmkrsc-6"})(["display:block;position:absolute;z-index:1;width:100%;height:100%;object-fit:cover;border-radius:5px;",";"],(({$isProcessing})=>$isProcessing&&"filter: blur(5px)")),Canvas=styled_components_browser_esm.Ay.canvas.withConfig({displayName:"mediaRecording__Canvas",componentId:"sc-tmkrsc-7"})(["display:block;position:absolute;z-index:2;width:100%;height:100%;object-fit:cover;border-radius:5px;",";"],(({$isProcessing})=>$isProcessing&&"filter: blur(5px)"));__webpack_require__("./node_modules/core-js/modules/esnext.array-buffer.detached.js"),__webpack_require__("./node_modules/core-js/modules/esnext.array-buffer.transfer.js"),__webpack_require__("./node_modules/core-js/modules/esnext.array-buffer.transfer-to-fixed-length.js");const AudioWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"audio__AudioWrapper",componentId:"sc-yvjjwu-0"})(["background:",";border-radius:5px;width:100%;height:100%;"],(({theme})=>theme.colors.bg.secondary));const AudioAnalyser=({source})=>{const[data,setData]=(0,src.J0)([]),raf=(0,src.li)(),audioContextRef=(0,src.li)(),analyserRef=(0,src.li)(),prevRafTime=(0,src.li)();return analyserRef.current||(audioContextRef.current=new window.AudioContext,analyserRef.current=audioContextRef.current.createAnalyser()),(0,src.vJ)((()=>{if(0===source.getAudioTracks().length)return noop.l;const audioNode=audioContextRef.current.createMediaStreamSource(source);audioNode.connect(analyserRef.current);const tick=time=>{if(void 0!==prevRafTime.current){const dataArray=new Uint8Array(analyserRef.current.frequencyBinCount);analyserRef.current.getByteTimeDomainData(dataArray),setData(dataArray)}prevRafTime.current=time,raf.current=requestAnimationFrame(tick)};return raf.current=requestAnimationFrame(tick),()=>{cancelAnimationFrame(raf.current),analyserRef.current.disconnect(),audioNode.disconnect()}}),[source]),react.createElement(AudioVisualiser,{data})},AudioVisualiser=({data})=>{const ref=(0,src.li)(),canvas=ref.current;if(canvas){canvas.style.width="100%",canvas.style.height="100%",canvas.width=canvas.offsetWidth,canvas.height=canvas.offsetHeight;const height=canvas.height,width=canvas.width,context=canvas.getContext("2d"),sliceWidth=Number(width)/data.length;context.lineWidth=2,context.strokeStyle="#FFF",context.clearRect(0,0,width,height),context.beginPath(),context.moveTo(0,height/2);let x=0;for(const item of data){const y=item/255*height;context.lineTo(x,y),x+=sliceWidth}context.lineTo(x,height/2),context.stroke()}return react.createElement("canvas",{ref})},audio=function Audio({liveStream}){return react.createElement(AudioWrapper,null,react.createElement(AudioAnalyser,{source:liveStream}))},mediaRecording_blur=(context,amount)=>{if(amount<=0)return context;const{height,width}=context.canvas,imageData=context.getImageData(0,0,width,height),{data}=imageData,wm=width-1,hm=height-1,rad1=amount+1,mulSum=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1][amount],shgSum=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18][amount],r=[],g=[],b=[],a=[],vmin=[],vmax=[];let p,p1,p2,pa,iterations=3;for(;iterations-- >0;){let yw=0,yi=0;for(let y=0;y<height;y++){let rsum=data[yw]*rad1,gsum=data[yw+1]*rad1,bsum=data[yw+2]*rad1,asum=data[yw+3]*rad1;for(let i=1;i<=amount;i++)p=yw+((i>wm?wm:i)<<2),rsum+=data[p++],gsum+=data[p++],bsum+=data[p++],asum+=data[p];for(let x=0;x<width;x++)r[yi]=rsum,g[yi]=gsum,b[yi]=bsum,a[yi]=asum,0===y&&(vmin[x]=((p=x+rad1)<wm?p:wm)<<2,vmax[x]=(p=x-amount)>0?p<<2:0),p1=yw+vmin[x],p2=yw+vmax[x],rsum+=data[p1++]-data[p2++],gsum+=data[p1++]-data[p2++],bsum+=data[p1++]-data[p2++],asum+=data[p1]-data[p2],yi++;yw+=width<<2}for(let x=0;x<width;x++){let yp=x,rsum=r[yp]*rad1,gsum=g[yp]*rad1,bsum=b[yp]*rad1,asum=a[yp]*rad1;for(let i=1;i<=amount;i++)yp+=i>hm?0:width,rsum+=r[yp],gsum+=g[yp],bsum+=b[yp],asum+=a[yp];yi=x<<2;for(let y=0;y<height;y++)data[yi+3]=pa=asum*mulSum>>>shgSum,pa>0?(pa=255/pa,data[yi]=(rsum*mulSum>>>shgSum)*pa,data[yi+1]=(gsum*mulSum>>>shgSum)*pa,data[yi+2]=(bsum*mulSum>>>shgSum)*pa):data[yi]=data[yi+1]=data[yi+2]=0,0===x&&(vmin[y]=((p=y+rad1)<hm?p:hm)*width,vmax[y]=(p=y-amount)>0?p*width:0),p1=x+vmin[y],p2=x+vmax[y],rsum+=r[p1]-r[p2],gsum+=g[p1]-g[p2],bsum+=b[p1]-b[p2],asum+=a[p1]-a[p2],yi+=width<<2}}return context.putImageData(imageData,0,0),context};const playbackMedia=function PlaybackMedia(){const{mediaBlob,mediaBlobUrl,originalMediaBlobUrl,liveStream,hasVideo,hasAudio,videoEffect,isGif,isImageCapture,isAdjustingTrim,toggleIsGif,streamNode,setStreamNode,isProcessingTrim,setCanvasStream,setCanvasNode}=(0,useMediaRecording.A)((({state,actions})=>({mediaBlob:state.mediaBlob,mediaBlobUrl:state.mediaBlobUrl,originalMediaBlobUrl:state.originalMediaBlobUrl,liveStream:state.liveStream,hasVideo:state.hasVideo,hasAudio:state.hasAudio,videoEffect:state.videoEffect,isGif:state.isGif,streamNode:state.streamNode,isImageCapture:Boolean(state.file?.type?.startsWith("image")),isAdjustingTrim:state.isAdjustingTrim,toggleIsGif:actions.toggleIsGif,setStreamNode:actions.setStreamNode,isProcessingTrim:state.isProcessingTrim,setCanvasStream:actions.setCanvasStream,setCanvasNode:actions.setCanvasNode}))),setVideoNode=(0,useVideoTrim.A)((({actions:{setVideoNode}})=>setVideoNode)),isMuted=!hasAudio||isGif,hasVideoEffect=videoEffect&&videoEffect!==constants.R4.NONE,onToggleVideoMode=(0,src.hb)((()=>{toggleIsGif(),videoRef.current&&videoRef.current.play().catch(noop.l)}),[toggleIsGif]),rafRef=(0,src.li)(),canvasRef=(0,src.li)(),videoRef=(0,src.li)(),updateVideoNode=(0,src.hb)((node=>{setVideoNode(node),videoRef.current=node}),[setVideoNode]),selfieSegmentation=(0,src.li)(),onSelfieSegmentationResults=results=>{const canvas=canvasRef.current;if(!canvas||!results.image||0===results.image.width)return;const context=canvasRef.current.getContext("2d"),canvasBlur="filter"in CanvasRenderingContext2D.prototype;context.save(),canvasBlur?(context.globalCompositeOperation="copy",context.filter=`blur(${constants.qO}px)`,context.drawImage(results.segmentationMask,0,0,canvas.width,canvas.height),context.globalCompositeOperation="source-in",context.filter="none",context.drawImage(results.image,0,0,canvas.width,canvas.height),context.globalCompositeOperation="destination-over",context.filter=`blur(${constants.qO}px)`,context.drawImage(results.image,0,0,canvas.width,canvas.height)):(context.drawImage(results.image,0,0,canvas.width,canvas.height),mediaRecording_blur(context,constants.qO),context.globalCompositeOperation="destination-out",context.drawImage(results.segmentationMask,0,0,canvas.width,canvas.height),context.globalCompositeOperation="destination-over",context.drawImage(results.image,0,0,canvas.width,canvas.height)),context.restore()};(0,src.vJ)((()=>{hasVideoEffect&&!selfieSegmentation.current&&(async()=>{const{SelfieSegmentation}=await __webpack_require__.e(8886).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@mediapipe/selfie_segmentation/selfie_segmentation.js",23));selfieSegmentation.current=new SelfieSegmentation({locateFile:file=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`}),selfieSegmentation.current.setOptions({modelSelection:1}),await selfieSegmentation.current.initialize()})()}),[hasVideoEffect]),(0,src.vJ)((()=>{!async function run(){if(hasVideoEffect&&canvasRef.current){canvasRef.current.getContext("2d"),setCanvasNode(canvasRef.current);const canvasStreamRaw=canvasRef.current.captureStream(),liveStreamAudio=liveStream.getAudioTracks();liveStreamAudio.length>0&&canvasStreamRaw.addTrack(liveStreamAudio[0]),setCanvasStream(canvasStreamRaw)}if(videoEffect===constants.R4.BLUR&&selfieSegmentation.current){selfieSegmentation.current.onResults(onSelfieSegmentationResults);const sendFrame=async()=>{if(streamNode&&streamNode.videoWidth&&canvasRef.current)try{await selfieSegmentation.current.send({image:streamNode})}catch(e){}canvasRef.current&&(rafRef.current=requestAnimationFrame(sendFrame))};streamNode&&hasVideoEffect&&await sendFrame()}}()}),[videoEffect,hasVideoEffect,streamNode,setCanvasStream,setCanvasNode]);const hasPlayButton=!isGif&&!isProcessingTrim||isAdjustingTrim,mediaSrc=isAdjustingTrim?originalMediaBlobUrl:mediaBlobUrl,hasVideoModeSwitch=mediaBlobUrl&&hasVideo&&!isAdjustingTrim&&!isProcessingTrim;return(0,src.vJ)((()=>(mediaBlobUrl&&rafRef.current&&cancelAnimationFrame(rafRef.current),()=>{rafRef.current&&cancelAnimationFrame(rafRef.current)})),[mediaBlobUrl]),isImageCapture?react.createElement(VideoWrapper,null,react.createElement(Photo,{decoding:"async",src:mediaBlobUrl,alt:(0,i18n.__)("Image capture","web-stories")})):react.createElement(react.Fragment,null,hasVideoModeSwitch&&react.createElement(videoMode,{value:!isGif,onChange:onToggleVideoMode}),react.createElement(VideoWrapper,null,mediaBlobUrl&&(hasVideo?react.createElement(react.Fragment,null,react.createElement(Video,{ref:updateVideoNode,src:mediaSrc,muted:isMuted,loop:isGif||isAdjustingTrim,$isProcessing:isProcessingTrim,tabIndex:0}),hasPlayButton&&react.createElement(playPauseButton,{videoRef})):react.createElement("audio",{controls:"controls",src:mediaBlobUrl})),!mediaBlob&&!mediaBlobUrl&&liveStream&&(hasVideo?react.createElement(react.Fragment,null,react.createElement(Video,{ref:setStreamNode,muted:!0,onLoadedMetadata:()=>{canvasRef.current&&(canvasRef.current.width=streamNode.videoWidth,canvasRef.current.height=streamNode.videoHeight)}}),hasVideoEffect&&react.createElement(Canvas,{ref:canvasRef,width:640,height:480})):react.createElement(audio,{liveStream}))))};var theme=__webpack_require__("./packages/design-system/src/theme/theme.ts"),colors=__webpack_require__("./packages/design-system/src/theme/colors.ts"),exclamation_triangle=__webpack_require__("./packages/design-system/src/icons/exclamation_triangle.svg"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts");const StyledHeading=(0,styled_components_browser_esm.Ay)(MessageHeading).withConfig({displayName:"errorDialog__StyledHeading",componentId:"sc-mbe9k2-0"})(["display:flex;align-items:center;"]);function ErrorMessage({error,hasVideo}){let errorMessage=error?.message;return window.isSecureContext?"NotAllowedError"===error?.name?errorMessage=(0,i18n.__)("Permission denied","web-stories"):hasVideo&&"NotFoundError"!==error?.name&&"OverConstrainedError"!==error?.name||(errorMessage=(0,i18n.__)("No camera found","web-stories")):errorMessage=(0,i18n.__)("Requires a secure browsing context (HTTPS)","web-stories"),react.createElement(MessageWrap,null,react.createElement(styled_components_browser_esm.NP,{theme:{...theme.w,colors:colors.B}},react.createElement(StyledHeading,null,react.createElement(exclamation_triangle.A,{size:32,height:32,"aria-hidden":!0}),(0,i18n.__)("Error","web-stories")),react.createElement(MessageText,null,(0,i18n.__)("Could not initialize recording.","web-stories")),errorMessage&&react.createElement(MessageText,null,(0,sprintf.A)((0,i18n.__)("Reason: %s","web-stories"),errorMessage))))}const errorDialog=function ErrorDialog(){const{error,hasVideo}=(0,useMediaRecording.A)((({state})=>({error:state.error,hasVideo:Boolean(state.videoInput)})));return react.createElement(components_Wrapper,null,react.createElement(ErrorMessage,{error,hasVideo}))};const permissionsDialog=function PermissionsDialog(){return react.createElement(components_Wrapper,null,react.createElement(MessageWrap,null,react.createElement(styled_components_browser_esm.NP,{theme:{...theme.w,colors:colors.B}},react.createElement(MessageHeading,null,(0,i18n.__)("Media Recording","web-stories")),react.createElement(MessageText,null,(0,i18n.__)("To get started, you need to allow access to your camera and microphone.","web-stories")))))};var useLiveRegion=__webpack_require__("./packages/design-system/src/utils/useLiveRegion.ts"),loadingSpinner=__webpack_require__("./packages/design-system/src/components/loadingSpinner/loadingSpinner.tsx");const processingOverlay_Wrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"processingOverlay__Wrapper",componentId:"sc-ksu3mm-0"})(["position:absolute;left:0;top:0;height:100%;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;background-color:rgba(0 0 0 / 0.5);gap:2em;padding:3em;"]);const processingOverlay=function ProcessingOverlay(){const speak=(0,useLiveRegion.A)();return(0,src.vJ)((()=>{speak((0,i18n.__)("Video trimming in progress. Please wait up to a few minutes depending on output video length.","web-stories"))}),[speak]),react.createElement(processingOverlay_Wrapper,null,react.createElement(loadingSpinner.A,null),react.createElement(typography_text.E.Paragraph,null,(0,i18n.__)("Video trimming in progress. Please wait up to a few minutes depending on output video length.","web-stories")))};const mediaRecording=function MediaRecording(){const{status,error,needsPermissions,isProcessingTrim}=(0,useMediaRecording.A)((({state})=>({status:state.status,error:state.error,needsPermissions:("idle"===state.status||"acquiring_media"===state.status)&&!state.videoInput,isProcessingTrim:state.isProcessingTrim})));return"failed"===status||Boolean(error)?react.createElement(errorDialog,null):needsPermissions?react.createElement(permissionsDialog,null):react.createElement(react.Fragment,null,react.createElement(components_Wrapper,null,react.createElement(playbackMedia,null),isProcessingTrim&&react.createElement(processingOverlay,null)),react.createElement(progressBar,null),react.createElement(countdown,null))};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.find.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.for-each.js");var use_media_recorder=__webpack_require__("./node_modules/@wmik/use-media-recorder/index.js"),use_media_recorder_default=__webpack_require__.n(use_media_recorder),localStore=__webpack_require__("./packages/design-system/src/utils/localStore.ts"),useSnackbar=__webpack_require__("./packages/design-system/src/contexts/snackbar/useSnackbar.ts"),blobToFile=__webpack_require__("./packages/media/src/blobToFile.ts"),src_blob=__webpack_require__("./packages/media/src/blob.ts"),date_src=__webpack_require__("./packages/date/src/index.ts"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),context=__webpack_require__("./packages/story-editor/src/components/mediaRecording/context.js"),formatMsToHMS=__webpack_require__("./packages/media/src/formatMsToHMS.ts"),useFFmpeg=__webpack_require__("./packages/story-editor/src/app/media/utils/useFFmpeg.ts");const mediaRecording_useTrim=function useTrim({setDuration,onTrimmed,file,isRecording}){const[trimData,setTrimData]=(0,src.J0)({start:0,end:null}),[isAdjustingTrim,setIsAdjustingTrim]=(0,src.J0)(!1),[isProcessingTrim,setIsProcessingTrim]=(0,src.J0)(!1),{trimVideo}=(0,useFFmpeg.A)(),hasCancelledTrim=(0,src.li)(),onTrim=(0,src.hb)((async newTrimData=>{if(setIsAdjustingTrim(!1),newTrimData){hasCancelledTrim.current=!1,setIsProcessingTrim(!0);const start=(0,formatMsToHMS.A)(newTrimData.start),end=(0,formatMsToHMS.A)(newTrimData.end),result=await trimVideo(file,start,end);if(hasCancelledTrim.current)return;setTrimData(newTrimData),setIsProcessingTrim(!1),onTrimmed(result),setDuration(newTrimData.end-newTrimData.start)}}),[file,onTrimmed,setDuration,trimVideo]),startTrim=(0,src.hb)((()=>setIsAdjustingTrim(!0)),[]),resetTrim=(0,src.hb)((()=>{setIsAdjustingTrim(!1),setTrimData({start:0,end:null})}),[]),cancelTrim=(0,src.hb)((()=>{hasCancelledTrim.current=!0,setIsProcessingTrim(!1)}),[]);return(0,src.vJ)((()=>{isRecording&&resetTrim()}),[isRecording,resetTrim]),{trimData,isAdjustingTrim,isProcessingTrim,onTrim,startTrim,resetTrim,cancelTrim}};const provider=function MediaRecordingProvider({children}){const[isInRecordingMode,setIsInRecordingMode]=(0,src.J0)(!1),[isSettingsOpen,setIsSettingsOpen]=(0,src.J0)(!1),[isProcessing,setIsProcessing]=(0,src.J0)(!1),[streamNode,setStreamNode]=(0,src.J0)(null),[canvasStream,setCanvasStream]=(0,src.J0)(null),[canvasNode,setCanvasNode]=(0,src.J0)(null),[countdown,setCountdown]=(0,src.J0)(0),[duration,setDuration]=(0,src.J0)(0),[isGif,setIsGif]=(0,src.J0)(!1),[hasVideo,setHasVideo]=(0,src.J0)(!0),[hasAudio,setHasAudio]=(0,src.J0)(!0),[videoInput,setVideoInput]=(0,src.J0)(localStore.x.getItemByKey(localStore.$.MEDIA_RECORDING_VIDEO_INPUT)),[audioInput,setAudioInput]=(0,src.J0)(localStore.x.getItemByKey(localStore.$.MEDIA_RECORDING_AUDIO_INPUT)),[videoEffect,setVideoEffect]=(0,src.J0)(localStore.x.getItemByKey(localStore.$.MEDIA_RECORDING_VIDEO_EFFECT)),[mediaDevices,setMediaDevices]=(0,src.J0)([]),[file,setFile]=(0,src.J0)(null),[originalFile,setOriginalFile]=(0,src.J0)(null);(0,src.vJ)((()=>{mediaDevices.length&&(setVideoInput(mediaDevices.find((device=>device.deviceId===videoInput))?.deviceId||mediaDevices.find((device=>"videoinput"===device.kind))?.deviceId),setAudioInput(mediaDevices.find((device=>device.deviceId===audioInput))?.deviceId||mediaDevices.find((device=>"audioinput"===device.kind))?.deviceId))}),[audioInput,mediaDevices,videoInput]);const[mediaBlobUrl,setMediaBlobUrl]=(0,src.J0)(),[originalMediaBlobUrl,setOriginalMediaBlobUrl]=(0,src.J0)(),{showSnackbar}=(0,useSnackbar.d)(),onStop=(0,src.hb)((blob=>{try{const recordedBlob=(0,src_blob.gO)(blob);setOriginalMediaBlobUrl(recordedBlob),setMediaBlobUrl(recordedBlob);const recordedFile=function createFile(blob,hasVideo){const FILE_TYPE=hasVideo?constants.K_:constants.By,MIME_TYPE=hasVideo?constants.aj:constants.dN,captureType=hasVideo?"webcam":"audio";return(0,blobToFile.A)(blob,`${captureType}-capture-${(0,date_src.GP)(new Date,"Y-m-d-H-i")}.${FILE_TYPE}`,MIME_TYPE)}(blob,hasVideo);setOriginalFile(recordedFile),setFile(recordedFile)}catch(e){(0,tracking_src.Oz)("media_recording_capture",e.message),showSnackbar({message:(0,i18n.__)("There was an error recording a video. Please try again.","web-stories"),dismissable:!0})}}),[showSnackbar,hasVideo]),mediaRecorder=use_media_recorder_default()({recordScreen:!1,mediaStreamConstraints:{audio:!!hasAudio&&(!audioInput||{deviceId:audioInput}),video:!!hasVideo&&(!videoInput||{deviceId:videoInput})},onStop}),canvasRecorder=use_media_recorder_default()({recordScreen:!1,customMediaStream:canvasStream,onStop}),currentRecorder=videoEffect&&"none"!==videoEffect&&hasVideo?{...mediaRecorder,inputStatus:mediaRecorder.status,status:canvasRecorder.status,startRecording:canvasRecorder.startRecording,pauseRecording:canvasRecorder.pauseRecording,resumeRecording:canvasRecorder.resumeRecording,stopRecording:canvasRecorder.stopRecording,mediaBlob:canvasRecorder.mediaBlob,clearMediaBlob:canvasRecorder.clearMediaBlob,getMediaStream:async()=>{canvasRecorder.clearMediaStream(),await mediaRecorder.getMediaStream()}}:{...mediaRecorder,inputStatus:mediaRecorder.status},{error,inputStatus,status,mediaBlob,stopRecording:originalStopRecording,startRecording,liveStream,getMediaStream,clearMediaStream,clearMediaBlob,muteAudio,unMuteAudio,pauseRecording,resumeRecording}=currentRecorder,isRecording="recording"===status,onTrimmed=(0,src.hb)((trimmedFile=>{setMediaBlobUrl((0,src_blob.gO)(trimmedFile)),setFile(trimmedFile)}),[]),{trimData,isAdjustingTrim,isProcessingTrim,startTrim,onTrim,resetTrim,cancelTrim}=mediaRecording_useTrim({setDuration,onTrimmed,file:originalFile,isRecording});(0,src.vJ)((()=>{"NotFoundError"!==error?.name&&"NotReadableError"!==error?.name&&"OverConstrainedError"!==error?.name||(setHasVideo(!1),setVideoInput(null))}),[error]);const speak=(0,useLiveRegion.A)(),stopRecording=(0,src.hb)((()=>{setIsProcessing(!0),originalStopRecording(),speak((0,i18n.__)("Recording stopped","web-stories"))}),[originalStopRecording,speak]),updateMediaDevices=(0,src.hb)((async()=>{if(navigator.mediaDevices)try{const devices=await navigator.mediaDevices.enumerateDevices();setMediaDevices(devices.filter((device=>"audiooutput"!==device.kind)).filter((device=>device.label)))}catch(err){}}),[]);(0,src.vJ)((()=>{if(navigator.mediaDevices)return navigator.mediaDevices.addEventListener("devicechange",updateMediaDevices),()=>{navigator.mediaDevices.removeEventListener("devicechange",updateMediaDevices)}}),[]);const toggleVideo=(0,src.hb)((()=>{setHasVideo(!hasVideo)}),[hasVideo]),toggleAudio=(0,src.hb)((()=>{setHasAudio(!hasAudio),hasAudio?muteAudio():unMuteAudio()}),[hasAudio,muteAudio,unMuteAudio]),previousBlobUrl=(0,src.ZC)(mediaBlobUrl);(0,src.vJ)((()=>{previousBlobUrl&&previousBlobUrl!==mediaBlobUrl&&previousBlobUrl!==originalMediaBlobUrl&&(0,src_blob.eW)(previousBlobUrl)}),[mediaBlobUrl,previousBlobUrl,originalMediaBlobUrl]),(0,src.vJ)((()=>{let timeout;return duration>=0&&isRecording&&(timeout=setTimeout((()=>setDuration((seconds=>seconds+1))),1e3)),()=>clearTimeout(timeout)}),[duration,isRecording]),(0,src.vJ)((()=>{let timeout;return countdown>0&&(timeout=setTimeout((()=>setCountdown(countdown-1)),1e3)),()=>clearTimeout(timeout)}),[countdown]),(0,src.vJ)((()=>{duration>constants.Ob&&stopRecording()}),[duration,stopRecording]);const resetStream=(0,src.hb)((()=>{liveStream&&liveStream.getTracks().forEach((track=>track.stop())),canvasRecorder.liveStream&&canvasRecorder.liveStream.getTracks().forEach((track=>track.stop())),clearMediaBlob(),clearMediaStream(),canvasRecorder.clearMediaStream()}),[clearMediaBlob,clearMediaStream,liveStream,canvasRecorder]),resetState=(0,src.hb)((()=>{setFile(null),setIsGif(!1),setMediaBlobUrl(null),setCountdown(0),setIsProcessing(!1),setDuration(0),resetTrim(),resetStream()}),[resetStream,resetTrim]),toggleRecordingMode=(0,src.hb)((()=>{setIsInRecordingMode((state=>!state)),"recording"===canvasRecorder.status?stopRecording():(resetState(),!0===isInRecordingMode&&canvasRecorder.clearMediaStream())}),[resetState,canvasRecorder,isInRecordingMode,stopRecording]),toggleSettings=(0,src.hb)((()=>setIsSettingsOpen((state=>!state))),[]),toggleIsGif=(0,src.hb)((()=>setIsGif((state=>!state))),[]),isCountingDown=countdown>0,wasCountingDown=(0,src.ZC)(isCountingDown),value=(0,src.Kr)((()=>({state:{isInRecordingMode,hasVideo,hasAudio,mediaDevices,audioInput,videoInput,videoEffect,isSettingsOpen,error,inputStatus,status,mediaBlob,mediaBlobUrl,originalMediaBlobUrl,liveStream,file,isGif,duration,countdown,isProcessing,isCountingDown:isCountingDown||wasCountingDown,trimData,isAdjustingTrim,streamNode,isProcessingTrim,canvasStream,canvasNode},actions:{toggleRecordingMode,setMediaBlobUrl,toggleVideo,toggleAudio,toggleSettings,toggleIsGif,setAudioInput,setVideoInput,setVideoEffect,updateMediaDevices,stopRecording,startRecording,getMediaStream,clearMediaStream,clearMediaBlob,setFile,muteAudio,unMuteAudio,setDuration,setCountdown,resetState,resetStream,onTrim,startTrim,setStreamNode,pauseRecording,resumeRecording,cancelTrim,setCanvasStream,setCanvasNode}})),[isInRecordingMode,hasVideo,hasAudio,mediaDevices,audioInput,videoInput,videoEffect,isSettingsOpen,error,inputStatus,status,mediaBlob,mediaBlobUrl,originalMediaBlobUrl,liveStream,file,isGif,duration,countdown,isCountingDown,wasCountingDown,isProcessing,trimData,isAdjustingTrim,streamNode,isProcessingTrim,toggleRecordingMode,toggleVideo,toggleAudio,toggleSettings,toggleIsGif,updateMediaDevices,stopRecording,startRecording,getMediaStream,clearMediaStream,clearMediaBlob,muteAudio,unMuteAudio,resetState,resetStream,onTrim,startTrim,setStreamNode,pauseRecording,resumeRecording,cancelTrim,canvasStream,setCanvasStream,canvasNode,setCanvasNode]);return react.createElement(context.A.Provider,{value},children)};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var dropdown=__webpack_require__("./packages/design-system/src/components/dropDown/dropdown.tsx"),dialog=__webpack_require__("./packages/story-editor/src/components/dialog/index.js");const Row=styled_components_browser_esm.Ay.div.withConfig({displayName:"settingsModal__Row",componentId:"sc-1xjwc1a-0"})(["margin-bottom:16px;"]),Label=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({as:"label",size:types.$.Small}).withConfig({displayName:"settingsModal__Label",componentId:"sc-1xjwc1a-1"})(["display:inline-block;margin-bottom:8px;"]);const settingsModal=function SettingsModal(){const{mediaDevices,hasAudio,videoInput,audioInput,videoEffect,isSettingsOpen,setAudioInput,setVideoInput,setVideoEffect,clearMediaStream,clearMediaBlob,toggleSettings}=(0,useMediaRecording.A)((({state,actions})=>({mediaDevices:state.mediaDevices,hasAudio:state.hasAudio,videoInput:state.videoInput,audioInput:state.audioInput,videoEffect:state.videoEffect,isSettingsOpen:state.isSettingsOpen,setAudioInput:actions.setAudioInput,setVideoInput:actions.setVideoInput,setVideoEffect:actions.setVideoEffect,clearMediaStream:actions.clearMediaStream,clearMediaBlob:actions.clearMediaBlob,toggleSettings:actions.toggleSettings}))),[localVideoInput,setLocalVideoInput]=(0,src.J0)(videoInput),[localAudioInput,setLocalAudioInput]=(0,src.J0)(audioInput),[localVideoEffect,setLocalVideoEffect]=(0,src.J0)(videoEffect);(0,src.vJ)((()=>setLocalVideoInput(videoInput)),[videoInput]),(0,src.vJ)((()=>setLocalAudioInput(audioInput)),[audioInput]);const onSaveChanges=(0,src.hb)((()=>{toggleSettings(),setVideoInput(localVideoInput),localStore.x.setItemByKey(localStore.$.MEDIA_RECORDING_VIDEO_INPUT,localVideoInput),setAudioInput(localAudioInput),localStore.x.setItemByKey(localStore.$.MEDIA_RECORDING_AUDIO_INPUT,localAudioInput),setVideoEffect(localVideoEffect),localStore.x.setItemByKey(localStore.$.MEDIA_RECORDING_VIDEO_EFFECT,localVideoEffect),videoInput===localVideoInput&&audioInput===localAudioInput&&videoEffect===localVideoEffect||((0,tracking_src.sx)("media_recording_settings_changed"),clearMediaStream(),clearMediaBlob())}),[audioInput,clearMediaBlob,clearMediaStream,localAudioInput,localVideoInput,localVideoEffect,setAudioInput,setVideoInput,setVideoEffect,toggleSettings,videoInput,videoEffect]),videoInputs=mediaDevices.filter((device=>"videoinput"===device.kind)).map((({deviceId,label})=>({value:deviceId,label}))),audioInputs=mediaDevices.filter((device=>"audioinput"===device.kind)).map((({deviceId,label})=>({value:deviceId,label}))),videoEffects=[{value:constants.R4.NONE,label:(0,i18n.__)("None","web-stories")},{value:constants.R4.BLUR,label:(0,i18n.__)("Background blur","web-stories")}],onChangeVideoInput=(0,src.hb)(((_event,value)=>setLocalVideoInput(value)),[]),onChangeAudioInput=(0,src.hb)(((evt,value)=>setLocalAudioInput(value)),[]),onChangeVideoEffect=(0,src.hb)(((_event,value)=>setLocalVideoEffect(value)),[]),onClose=(0,src.hb)((()=>{toggleSettings(),setLocalVideoInput(videoInput),setLocalAudioInput(audioInput)}),[audioInput,toggleSettings,videoInput]);return react.createElement(dialog.A,{onClose,isOpen:isSettingsOpen,contentLabel:(0,i18n.__)("Media Recording Options","web-stories"),title:(0,i18n.__)("Options","web-stories"),onPrimary:onSaveChanges,primaryText:(0,i18n.__)("Save","web-stories"),secondaryText:(0,i18n.__)("Cancel","web-stories")},react.createElement(Row,null,react.createElement(typography_text.E.Paragraph,null,(0,i18n.__)("Choose the camera and microphone to use for the recording.","web-stories"))),videoInputs.length>0&&react.createElement(Row,null,react.createElement(Label,{htmlFor:"camera"},(0,i18n.__)("Camera","web-stories")),react.createElement(dropdown.A,{id:"camera",ariaLabel:(0,i18n.__)("Video Input","web-stories"),placeholder:(0,i18n.__)("Select Video Input","web-stories"),options:videoInputs,onMenuItemClick:onChangeVideoInput,selectedValue:localVideoInput,popupZIndex:constants.O8})),audioInputs.length>0&&react.createElement(Row,null,react.createElement(Label,{htmlFor:"microphone"},(0,i18n.__)("Microphone","web-stories")),react.createElement(dropdown.A,{id:"microphone",ariaLabel:(0,i18n.__)("Audio Input","web-stories"),placeholder:(0,i18n.__)("Select Audio Input","web-stories"),options:audioInputs,onMenuItemClick:onChangeAudioInput,selectedValue:localAudioInput,disabled:!hasAudio,popupZIndex:constants.O8})),videoInputs.length>0&&react.createElement(Row,null,react.createElement(Label,{htmlFor:"video-effect"},(0,i18n.__)("Video Effect","web-stories")),react.createElement(dropdown.A,{id:"video-effect",ariaLabel:(0,i18n.__)("Video Effect","web-stories"),placeholder:(0,i18n.__)("Select Video Effect","web-stories"),options:videoEffects,onMenuItemClick:onChangeVideoEffect,selectedValue:localVideoEffect,popupZIndex:constants.O8})))};var button_button=__webpack_require__("./packages/design-system/src/components/button/button.tsx"),button_constants=__webpack_require__("./packages/design-system/src/components/button/constants.ts"),photo_camera=__webpack_require__("./packages/design-system/src/icons/photo_camera.svg"),mic=__webpack_require__("./packages/design-system/src/icons/mic.svg"),getVideoLengthDisplay=__webpack_require__("./packages/media/src/getVideoLengthDisplay.ts"),getVideoLength=__webpack_require__("./packages/media/src/getVideoLength.ts"),getCanvasBlob=__webpack_require__("./packages/media/src/getCanvasBlob.ts"),getImageFromVideo=__webpack_require__("./packages/media/src/getImageFromVideo.ts"),propTypes=__webpack_require__("./packages/media/src/types/propTypes.ts"),getResourceFromLocalFile=__webpack_require__("./packages/story-editor/src/app/media/utils/getResourceFromLocalFile.ts"),useUploadWithPreview=__webpack_require__("./packages/story-editor/src/components/canvas/useUploadWithPreview.js"),uploader=__webpack_require__("./packages/story-editor/src/app/uploader/index.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),highlights=__webpack_require__("./packages/story-editor/src/app/highlights/index.ts"),objectPick=__webpack_require__("./packages/story-editor/src/utils/objectPick.ts");const BaseButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:button_constants.VQ.Primary,size:button_constants.Mp.Small}).withConfig({displayName:"footer__BaseButton",componentId:"sc-cffjy6-0"})([""]),RecordingButton=(0,styled_components_browser_esm.Ay)(BaseButton).withConfig({displayName:"footer__RecordingButton",componentId:"sc-cffjy6-1"})(["margin-right:20px;padding-top:12px;padding-bottom:12px;svg{margin:-9px 10px -9px 0;}"]),PauseButton=(0,styled_components_browser_esm.Ay)(BaseButton).attrs({type:button_constants.VQ.Secondary}).withConfig({displayName:"footer__PauseButton",componentId:"sc-cffjy6-2"})(["margin-right:20px;padding-top:12px;padding-bottom:12px;"]),StopButton=(0,styled_components_browser_esm.Ay)(BaseButton).withConfig({displayName:"footer__StopButton",componentId:"sc-cffjy6-3"})(["padding-top:12px;padding-bottom:12px;background-color:",";border-color:",";color:",";&:active,&:hover,&:focus{background-color:",";border-color:",";}"],(({theme})=>theme.colors.interactiveBg.negativeNormal),(({theme})=>theme.colors.interactiveBg.negativeNormal),(({theme})=>theme.colors.gray[5]),(({theme})=>theme.colors.interactiveBg.negativeHover),(({theme})=>theme.colors.interactiveBg.negativeHover)),CaptureButton=(0,styled_components_browser_esm.Ay)(BaseButton).attrs({type:button_constants.VQ.Quaternary}).withConfig({displayName:"footer__CaptureButton",componentId:"sc-cffjy6-4"})(["background-color:",";padding-top:12px;padding-bottom:12px;svg{margin:-9px 10px -9px 0;}"],(({theme})=>theme.colors.opacity.overlayDark)),InsertButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:button_constants.VQ.Primary,size:button_constants.Mp.Small}).withConfig({displayName:"footer__InsertButton",componentId:"sc-cffjy6-5"})([""]),RetryButton=(0,styled_components_browser_esm.Ay)(button_button.$).attrs({type:button_constants.VQ.Plain,size:button_constants.Mp.Small}).withConfig({displayName:"footer__RetryButton",componentId:"sc-cffjy6-6"})(["margin-right:20px;"]);const footer=function Footer(){const{status,file,isGif,isMuted,hasMediaToInsert,countdown,duration,isCountingDown,setMediaBlobUrl,setDuration,setCountdown,startRecording,stopRecording,setFile,toggleRecordingMode,getMediaStream,resetState,resetStream,streamNode,canvasStream,liveStream,hasVideo,videoEffect,pauseRecording,resumeRecording,isProcessingTrim,cancelTrim,canvasNode}=(0,useMediaRecording.A)((({state,actions})=>({status:state.status,file:state.file,isGif:state.isGif,isMuted:!state.hasAudio||state.isGif,countdown:state.countdown,duration:state.duration,isCountingDown:state.isCountingDown,hasVideo:state.hasVideo,videoEffect:state.videoEffect,hasMediaToInsert:Boolean(state.mediaBlobUrl),liveStream:state.liveStream,streamNode:state.streamNode,canvasStream:state.canvasStream,isProcessingTrim:state.isProcessingTrim,startRecording:actions.startRecording,stopRecording:actions.stopRecording,setFile:actions.setFile,setMediaBlobUrl:actions.setMediaBlobUrl,setDuration:actions.setDuration,setCountdown:actions.setCountdown,toggleRecordingMode:actions.toggleRecordingMode,getMediaStream:actions.getMediaStream,resetState:actions.resetState,resetStream:actions.resetStream,pauseRecording:actions.pauseRecording,resumeRecording:actions.resumeRecording,cancelTrim:actions.cancelTrim,canvasNode:state.canvasNode}))),videoNode=(0,useVideoTrim.A)((({state:{videoNode}})=>videoNode)),uploadWithPreview=(0,useUploadWithPreview.A)(),speak=(0,useLiveRegion.A)(),{allowedMimeTypes:{audio:allowedAudioMimeTypes}}=(0,app.UK)(),onPause=(0,src.hb)((()=>{pauseRecording(),(0,tracking_src.sx)("media_recording_pause")}),[pauseRecording]),onResume=(0,src.hb)((()=>{resumeRecording(),(0,tracking_src.sx)("media_recording_resume")}),[resumeRecording]),onRetry=(0,src.hb)((async()=>{resetState(),await getMediaStream(),(0,tracking_src.sx)("media_recording_retry")}),[getMediaStream,resetState]),debouncedStartRecording=(0,src.YQ)(startRecording,1e3*constants.uG),onStart=(0,src.hb)((()=>{speak((0,sprintf.A)((0,i18n._n)("Starting recording in %d second","Starting recording in %d seconds",constants.uG,"web-stories"),constants.uG)),setDuration(0),setCountdown(constants.uG),debouncedStartRecording()}),[debouncedStartRecording,setCountdown,setDuration,speak]),[isInserting,setIsInserting]=(0,src.J0)(!1),isRecording=["recording","stopping","stopped","paused"].includes(status),isPaused="paused"===status,onInsert=(0,src.hb)((async()=>{setIsInserting(!0),speak((0,i18n.__)("Inserting…","web-stories"));const args={additionalData:{mediaSource:"recording",altText:(0,i18n.__)("Camera Capture","web-stories")}},{resource,posterFile}=await(0,getResourceFromLocalFile.A)(file);if(args.resource={...resource,alt:(0,i18n.__)("Camera Capture","web-stories")},file.type.startsWith("video")){args.additionalData.isMuted=isMuted,args.additionalData.isGif=isGif,args.resource.length=duration,args.resource.lengthFormatted=(0,getVideoLengthDisplay.A)(duration),args.resource.isOptimized=!0,args.resource.isMuted=isMuted,args.posterFile=posterFile;const{length,lengthFormatted}=(0,getVideoLength.A)(videoNode);args.resource.length=length||duration,args.resource.lengthFormatted=length?lengthFormatted:(0,getVideoLengthDisplay.A)(duration)}uploadWithPreview([file],!0,args),isRecording&&(setMediaBlobUrl(null),setFile(null)),(0,tracking_src.sx)("media_recording_capture",{type:isGif?"gif":"video",muted:isMuted,duration}),setIsInserting(!1),toggleRecordingMode()}),[speak,file,uploadWithPreview,isRecording,isGif,isMuted,duration,toggleRecordingMode,videoNode,setMediaBlobUrl,setFile]);(0,src.vJ)((()=>{streamNode&&!streamNode.srcObject&&liveStream&&(streamNode.srcObject=liveStream),streamNode&&!liveStream&&(streamNode.srcObject=null)}),[streamNode,liveStream]);const{showSnackbar}=(0,useSnackbar.d)(),captureImage=(0,src.hb)((async()=>{const hasVideoEffect=videoEffect&&videoEffect!==constants.R4.NONE,inputStream=hasVideoEffect?canvasStream:streamNode;if(!inputStream)return;let blob;try{blob=hasVideoEffect?await(0,getCanvasBlob.A)(canvasNode):await(0,getImageFromVideo.A)(inputStream),setMediaBlobUrl((0,src_blob.gO)(blob))}catch(e){(0,tracking_src.Oz)("media_recording_capture",e.message),showSnackbar({message:(0,i18n.__)("There was an error taking a photo. Please try again.","web-stories"),dismissable:!0})}const imageFile=(0,blobToFile.A)(blob,`image-capture-${(0,date_src.GP)(new Date,"Y-m-d-H-i")}.${constants.FD}`,constants.z$);setFile(imageFile),resetStream()}),[resetStream,setFile,setMediaBlobUrl,showSnackbar,streamNode,canvasStream,videoEffect,canvasNode]),debouncedCaptureImage=(0,src.YQ)(captureImage,1e3*constants.uG),onCapture=(0,src.hb)((()=>{speak((0,sprintf.A)((0,i18n._n)("Taking photo in %d second","Taking photo in %d seconds",constants.uG,"web-stories"),constants.uG)),setCountdown(constants.uG),debouncedCaptureImage(),(0,tracking_src.sx)("media_recording_capture",{type:"image"})}),[debouncedCaptureImage,setCountdown,speak]),{actions:{uploadFile}}=(0,uploader.k)(),{updateCurrentPageProperties,backgroundElementId,setSelectedElementsById}=(0,app.P3)((({state:{currentPage},actions:{updateCurrentPageProperties,setSelectedElementsById}})=>({backgroundElementId:currentPage?.elements.find((({isBackground})=>isBackground))?.id,updateCurrentPageProperties,setSelectedElementsById,currentPage}))),{setHighlights}=(0,highlights.N)((({setHighlights})=>({setHighlights}))),{convertToMp3}=(0,useFFmpeg.A)(),onAudioInsert=async()=>{setIsInserting(!0),speak((0,i18n.__)("Inserting…","web-stories"));const mp3File=await convertToMp3(file),resource=await uploadFile(mp3File,{mediaSource:"recording"},allowedAudioMimeTypes),backgroundAudio={resource:(0,objectPick.A)(resource,Object.keys(propTypes.vj))};setSelectedElementsById({elementIds:[backgroundElementId]}),setHighlights({highlight:highlights.xP.PageBackgroundAudio}),updateCurrentPageProperties({properties:{backgroundAudio}}),setIsInserting(!1),toggleRecordingMode()};return"acquiring_media"===status?null:isProcessingTrim?react.createElement(RetryButton,{onClick:cancelTrim},(0,i18n.__)("Cancel trimming","web-stories")):hasMediaToInsert?react.createElement(react.Fragment,null,react.createElement(RetryButton,{onClick:onRetry,disabled:isInserting},(0,i18n.__)("Retry","web-stories")),react.createElement(InsertButton,{onClick:hasVideo?onInsert:onAudioInsert,disabled:isInserting},isInserting?(0,i18n.__)("Inserting…","web-stories"):hasVideo?(0,i18n.__)("Insert","web-stories"):(0,i18n.__)("Insert page background audio","web-stories"))):0===countdown?react.createElement(react.Fragment,null,isRecording&&react.createElement(react.Fragment,null,react.createElement(PauseButton,{onClick:isPaused?onResume:onPause,"aria-label":isPaused?(0,i18n.__)("Resume Recording","web-stories"):(0,i18n.__)("Pause Recording","web-stories")},isPaused?(0,i18n.__)("Resume","web-stories"):(0,i18n.__)("Pause","web-stories")),react.createElement(StopButton,{onClick:stopRecording,"aria-label":(0,i18n.__)("Stop Recording","web-stories")},(0,i18n.__)("Stop","web-stories"))),!isRecording&&!isCountingDown&&(hasVideo?react.createElement(react.Fragment,null,react.createElement(RecordingButton,{onClick:onStart},react.createElement(camera.A,{width:24,height:24,"aria-hidden":!0}),(0,i18n.__)("Record Video","web-stories")),react.createElement(CaptureButton,{onClick:onCapture},react.createElement(photo_camera.A,{width:24,height:24,"aria-hidden":!0}),(0,i18n.__)("Take a photo","web-stories"))):react.createElement(RecordingButton,{onClick:onStart},react.createElement(mic.A,{width:24,height:24,"aria-hidden":!0}),(0,i18n.__)("Record Audio","web-stories")))):null};var popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js");const durationIndicator_Wrapper=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).attrs({size:types.$.Small}).withConfig({displayName:"durationIndicator__Wrapper",componentId:"sc-5z5bu3-0"})(["font-variant-numeric:tabular-nums;&:before{content:'';display:inline-block;width:10px;height:10px;margin-right:5px;border-radius:100%;background-color:",";}"],(({theme})=>theme.colors.interactiveBg.negativeNormal));const durationIndicator=function DurationIndicator(){const{duration,isRecording}=(0,useMediaRecording.A)((({state})=>({duration:state.duration,isRecording:["recording","paused"].includes(state.status)})));return isRecording?react.createElement(tooltip.A,{position:popup_constants.W.Top,title:(0,sprintf.A)((0,i18n._n)("Maximum duration is %d minute","Maximum duration is %d minutes",constants.ub,"web-stories"),String(constants.ub)),styleOverride:{maxWidth:"20em"}},react.createElement(durationIndicator_Wrapper,null,(0,getVideoLengthDisplay.A)(duration))):null}},"./packages/story-editor/src/components/mediaRecording/useMediaRecording.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_context__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/components/mediaRecording/context.js");const __WEBPACK_DEFAULT_EXPORT__=function useMediaRecording(selector){return(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.i7)(_context__WEBPACK_IMPORTED_MODULE_1__.A,selector??_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.D_)}},"./packages/story-editor/src/components/panels/design/textStyle/utils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ei:()=>removeHiddenPadding,io:()=>getHiddenPadding,oB:()=>applyHiddenPadding});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/story-editor/src/constants/index.ts");function applyHiddenPadding(element){return element?.padding?.hasHiddenPadding?element.padding:{...element.padding,hasHiddenPadding:!0,...["vertical","horizontal"].reduce(((padding,axis)=>(padding[axis]=(element?.padding?.[axis]||0)+_constants__WEBPACK_IMPORTED_MODULE_0__.n_[axis],padding)),{})}}function removeHiddenPadding(element){return element?.padding?.hasHiddenPadding?{...element.padding,hasHiddenPadding:!1,...["vertical","horizontal"].reduce(((padding,axis)=>(padding[axis]=(element?.padding?.[axis]||0)-_constants__WEBPACK_IMPORTED_MODULE_0__.n_[axis],padding)),{})}:element.padding}function getHiddenPadding(element={},axis="horizontal"){return element?.padding?.hasHiddenPadding?_constants__WEBPACK_IMPORTED_MODULE_0__.n_[axis]:0}},"./packages/story-editor/src/components/uploadDropTarget/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_G:()=>dropTarget,X4:()=>message,Mj:()=>overlay});var react=__webpack_require__("./node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),src=__webpack_require__("./packages/react/src/index.ts"),dragEvent=__webpack_require__("./packages/story-editor/src/utils/dragEvent.ts");const context=(0,src.q6)({}),DropTargetComponent=styled_components_browser_esm.Ay.div.withConfig({displayName:"dropTarget__DropTargetComponent",componentId:"sc-12rok6t-0"})(["position:relative;width:100%;height:100%;"]),Content=styled_components_browser_esm.Ay.div.withConfig({displayName:"dropTarget__Content",componentId:"sc-12rok6t-1"})(["position:relative;width:100%;height:100%;"]),Glasspane=styled_components_browser_esm.Ay.div.withConfig({displayName:"dropTarget__Glasspane",componentId:"sc-12rok6t-2"})(["position:absolute;z-index:1000;top:0;left:0;width:100%;height:100%;"]);function disableDefaults(evt){evt.preventDefault(),evt.stopPropagation()}const dropTarget=function UploadDropTarget({disabled=!1,label=null,labelledBy=null,onDrop=null,children}){const[isDragging,setIsDragging]=(0,src.J0)(!1),onDragEnter=(0,src.hb)((e=>{const{dataTransfer}=e;(0,dragEvent.e)(e)&&(disableDefaults(e),disabled?dataTransfer.effectAllowed="none":(dataTransfer.effectAllowed="copy",setIsDragging(!0)))}),[disabled]),onDragLeave=(0,src.hb)((evt=>{disableDefaults(evt),setIsDragging(!1)}),[]),onDropHandler=(0,src.hb)((evt=>{disableDefaults(evt),setIsDragging(!1),!disabled&&onDrop&&onDrop([...evt.dataTransfer.files])}),[disabled,onDrop]);return react.createElement(DropTargetComponent,{onDragEnter,onDrop:onDropHandler,onDragOver:disableDefaults},isDragging&&react.createElement(Glasspane,{onDragEnter,onDragLeave,onDragOver:disableDefaults,onDrop:onDropHandler,"aria-label":label,"aria-labelledby":labelledBy}),react.createElement(context.Provider,{value:{isDragging}},react.createElement(Content,null,children)))};__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.flat-map.js");var src_mimeTypes=__webpack_require__("./packages/media/src/mimeTypes.ts"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),translateToExclusiveList=__webpack_require__("./packages/i18n/src/translateToExclusiveList.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),arrow_cloud=__webpack_require__("./packages/design-system/src/icons/arrow_cloud.svg"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),config=__webpack_require__("./packages/story-editor/src/app/config/index.ts"),polished_esm=__webpack_require__("./node_modules/polished/dist/polished.esm.js");const use=function useUploadDropTarget(selector){return(0,src.i7)(context,selector??src.D_)};function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const Overlay=styled_components_browser_esm.Ay.div.withConfig({displayName:"overlay__Overlay",componentId:"sc-u0s4sf-0"})(["position:absolute;z-index:999;top:0;left:0;width:100%;height:100%;background-color:",";"],(({theme})=>(0,polished_esm.B3)(theme.colors.bg.primary,.6)));const overlay=(0,src.Rf)((function UploadDropTargetOverlayWithRef(props,ref){const{isDragging}=use((state=>({isDragging:state.isDragging})));return isDragging?react.createElement(Overlay,_extends({ref},props)):null})),Container=(0,styled_components_browser_esm.Ay)(overlay).withConfig({displayName:"message__Container",componentId:"sc-1cdb29v-0"})(["display:flex;align-items:center;justify-content:center;"]),Box=styled_components_browser_esm.Ay.div.withConfig({displayName:"message__Box",componentId:"sc-1cdb29v-1"})(["width:100%;max-width:240px;padding:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;"]),Text=(0,styled_components_browser_esm.Ay)(typography_text.E.Paragraph).withConfig({displayName:"message__Text",componentId:"sc-1cdb29v-2"})(["color:",";margin-bottom:14px;margin-top:0px;"],(({theme})=>theme.colors.standard.white)),Icon=(0,styled_components_browser_esm.Ay)(arrow_cloud.A).withConfig({displayName:"message__Icon",componentId:"sc-1cdb29v-3"})(["height:52px;width:52px;color:",";"],(({theme})=>theme.colors.standard.white));const message=(0,src.ph)((function UploadDropTargetMessage({message,...rest}){const{allowedMimeTypes:{image:allowedImageMimeTypes,vector:allowedVectorMimeTypes,video:allowedVideoMimeTypes}}=(0,config.UK)(),allowedMimeTypes=(0,src.Kr)((()=>[...allowedImageMimeTypes,...allowedVectorMimeTypes,...allowedVideoMimeTypes]),[allowedImageMimeTypes,allowedVideoMimeTypes,allowedVectorMimeTypes]),allowedFileTypes=(0,src.Kr)((()=>allowedMimeTypes.flatMap((type=>(0,src_mimeTypes.n)(type)))),[allowedMimeTypes]);let description=(0,i18n.__)("No file types are currently supported.","web-stories");return allowedFileTypes.length&&(description=(0,sprintf.A)((0,i18n.__)("You can upload %s.","web-stories"),(0,translateToExclusiveList.A)(allowedFileTypes))),react.createElement(Container,rest,react.createElement(Box,null,react.createElement(Icon,null),react.createElement(Text,{isBold:!0,size:types.$.Medium},message),react.createElement(Text,{size:types.$.Small},description)))}))},"./packages/story-editor/src/components/videoTrim/useVideoNode.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/constants/index.ts"),_utils_noop__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const __WEBPACK_DEFAULT_EXPORT__=function useVideoNode(videoData){const[currentTime,setCurrentTime]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(null),[startOffset,rawSetStartOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(null),[originalStartOffset,setOriginalStartOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(null),[endOffset,rawSetEndOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(null),[originalEndOffset,setOriginalEndOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(null),[maxOffset,setMaxOffset]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(null),[videoNode,setVideoNode]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(null),[isDraggingHandles,setIsDraggingHandles]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.J0)(!1),isPausedTracker=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.li)(!1);(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.vJ)((()=>{videoNode&&(isPausedTracker.current||(isDraggingHandles?videoNode.pause():(videoNode.currentTime=startOffset/1e3,videoNode.play().catch(_utils_noop__WEBPACK_IMPORTED_MODULE_2__.l))))}),[videoNode,isDraggingHandles,startOffset]);const paused=videoNode?videoNode.paused:null;(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.vJ)((()=>{isDraggingHandles||(isPausedTracker.current=paused)}),[paused,isDraggingHandles]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.vJ)((()=>{videoData||(rawSetStartOffset(null),setOriginalStartOffset(null),setCurrentTime(null),rawSetEndOffset(null),setOriginalEndOffset(null),setMaxOffset(null))}),[videoData]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.vJ)((()=>{if(videoNode&&videoData)return isFinite(videoNode.duration)&&null===startOffset?onLoadedMetadata({target:videoNode}):isFinite(videoNode.duration)?videoNode.addEventListener("loadedmetadata",onLoadedMetadata):(videoNode.currentTime=Number.MAX_SAFE_INTEGER,videoNode.addEventListener("timeupdate",onLoadedMetadata)),endOffset&&videoNode.addEventListener("timeupdate",onTimeUpdate),()=>{videoNode.removeEventListener("timeupdate",onTimeUpdate),videoNode.removeEventListener("timeupdate",onLoadedMetadata),videoNode.removeEventListener("loadedmetadata",onLoadedMetadata)};function restart(at){videoNode.currentTime=at/1e3,videoNode.play().catch(_utils_noop__WEBPACK_IMPORTED_MODULE_2__.l)}function onLoadedMetadata(evt){if(!isFinite(evt.target.duration))return;const duration=Math.floor(1e3*evt.target.duration);rawSetStartOffset(videoData.start),setOriginalStartOffset(videoData.start),setCurrentTime(videoData.start),rawSetEndOffset(videoData.end??duration),setOriginalEndOffset(videoData.end??duration),setMaxOffset(duration),restart(videoData.start)}function onTimeUpdate(evt){if(!endOffset)return;const currentOffset=Math.floor(1e3*evt.target.currentTime);setCurrentTime(Math.min(currentOffset,endOffset)),currentOffset>endOffset&&!isPausedTracker.current&&restart(startOffset)}}),[startOffset,endOffset,videoData,videoNode]);const setStartOffset=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.hb)((offset=>{offset=Math.min(endOffset-_constants__WEBPACK_IMPORTED_MODULE_1__.Pt,offset),offset=Math.max(0,offset),rawSetStartOffset(offset),videoNode.currentTime=offset/1e3}),[videoNode,endOffset]),setEndOffset=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.hb)((offset=>{offset=Math.max(startOffset+_constants__WEBPACK_IMPORTED_MODULE_1__.Pt,offset),offset=Math.min(maxOffset,offset),rawSetEndOffset(offset),videoNode.currentTime=offset/1e3}),[videoNode,startOffset,maxOffset]);return{hasChanged:(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.Kr)((()=>startOffset!==originalStartOffset||endOffset!==originalEndOffset),[startOffset,originalStartOffset,endOffset,originalEndOffset]),currentTime,startOffset,endOffset,maxOffset,videoNode,setStartOffset,setEndOffset,setVideoNode,setIsDraggingHandles}}},"./packages/story-editor/src/utils/dragEvent.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function isDragType(e,type){return!!e?.dataTransfer?.types&&e.dataTransfer.types.includes(type)}function isDraggingFile(e){return isDragType(e,"Files")}__webpack_require__.d(__webpack_exports__,{d:()=>isDragType,e:()=>isDraggingFile})},"./packages/story-editor/src/utils/isTargetOutOfContainer.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=function isTargetOutOfContainer(target,container){const{left,right,top,bottom}=target.getBoundingClientRect(),containerRect=container.getBoundingClientRect();return left>containerRect.right||right<containerRect.left||bottom<containerRect.top||top>containerRect.bottom}},"./packages/story-editor/src/utils/keyboardOnlyOutline.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__,Ho:()=>isKeyboardUser});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/react/src/index.ts"),styled_components__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js");const KEYBOARD_USER_CLASS="useskeyboard",KEYBOARD_USER_SELECTOR=`.${KEYBOARD_USER_CLASS}`,OutlineStyles=(0,styled_components__WEBPACK_IMPORTED_MODULE_2__.DU)(["body:not(",") *:focus{outline:none !important;}"],KEYBOARD_USER_SELECTOR),ACCEPTED_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Digit1","Digit2","Digit3"];function isKeyboardUser(){return document.body.classList.contains(KEYBOARD_USER_CLASS)}const __WEBPACK_DEFAULT_EXPORT__=()=>{const[usingKeyboard,setUsingKeyboard]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.J0)(!1),handleKeydown=e=>{!usingKeyboard&&ACCEPTED_KEYS.includes(e.code)&&setUsingKeyboard(!0)},handleMousedown=()=>{usingKeyboard&&setUsingKeyboard(!1)};return(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.vJ)((()=>(document.addEventListener("keydown",handleKeydown,!0),document.addEventListener("mousedown",handleMousedown,!0),function cleanup(){document.removeEventListener("keydown",handleKeydown,!0),document.removeEventListener("mousedown",handleMousedown,!0)}))),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_1__.vJ)((()=>{document.body.classList.toggle(KEYBOARD_USER_CLASS,usingKeyboard)}),[usingKeyboard]),react__WEBPACK_IMPORTED_MODULE_0__.createElement(OutlineStyles,null)}},"./packages/story-editor/src/utils/useApplyTextAutoStyle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_rich_text__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/rich-text/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/elements/src/index.ts"),_app_pageCanvas__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/app/pageCanvas/index.ts"),_components_panels_design_textStyle_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/components/panels/design/textStyle/utils.js");const __WEBPACK_DEFAULT_EXPORT__=function useApplyTextAutoStyle(element,updater){const htmlFormatters=(0,_googleforcreators_rich_text__WEBPACK_IMPORTED_MODULE_0__.$d)(),{setColor}=htmlFormatters,calculateAccessibleTextColors=(0,_app_pageCanvas__WEBPACK_IMPORTED_MODULE_2__.zN)();return async()=>{const autoColor=await calculateAccessibleTextColors(element),{color:fgColor,backgroundColor}=autoColor;if(backgroundColor||fgColor){const highlightProps=backgroundColor?{backgroundColor:{color:backgroundColor},backgroundTextMode:_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.xu.HIGHLIGHT,padding:(0,_components_panels_design_textStyle_utils__WEBPACK_IMPORTED_MODULE_3__.oB)(element)}:null,content=fgColor?setColor(element.content,{color:fgColor}):element.content;updater({...highlightProps,content})}}}},"./packages/story-editor/src/utils/useElementPolygon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var sat__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/sat/SAT.js"),sat__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(sat__WEBPACK_IMPORTED_MODULE_0__),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/units/src/useUnits.ts"),_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/masks/src/index.ts"),_app_story_useStory__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/story-editor/src/app/story/useStory.ts"),_app_canvas_useCanvas__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/app/canvas/useCanvas.ts");const __WEBPACK_DEFAULT_EXPORT__=function useElementPolygon(){const nodesById=(0,_app_canvas_useCanvas__WEBPACK_IMPORTED_MODULE_3__.A)((({state:{nodesById}})=>nodesById)),bgElement=(0,_app_story_useStory__WEBPACK_IMPORTED_MODULE_2__.A)((({state})=>state.currentPage?.elements?.find((({isBackground})=>isBackground)))),{getBoxWithBorder,getBox}=(0,_googleforcreators_units__WEBPACK_IMPORTED_MODULE_4__.A)((({actions:{getBox,getBoxWithBorder}})=>({getBoxWithBorder,getBox})));return element=>{const bgNode=nodesById[bgElement.id],{x:bgX,y:bgY,width:bgWidth,height:bgHeight}=bgNode.getBoundingClientRect(),bgPolygon=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Box)(new(sat__WEBPACK_IMPORTED_MODULE_0___default().Vector)(bgX,bgY),bgWidth,bgHeight).toPolygon(),elementYOffset=-getBox(bgElement).y;if(element.isBackground)return bgPolygon;const{id,rotationAngle}=element;if(!nodesById[id])return null;const box=(0,_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__.Fn)(element)?getBoxWithBorder(element):getBox(element),center=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Vector)(bgPolygon.pos.x+box.x+box.width/2,bgPolygon.pos.y+elementYOffset+box.y+box.height/2),polygon=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Box)(center,box.width,box.height).toPolygon(),offset=new(sat__WEBPACK_IMPORTED_MODULE_0___default().Vector)(-box.width/2,-box.height/2);return polygon.setOffset(offset),polygon.setAngle(rotationAngle*Math.PI/180),polygon}}},"./packages/story-editor/src/utils/useElementsWithLinks.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.some.js");var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/elements/src/index.ts"),_app_story__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/app/story/index.ts"),_app_canvas__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/story-editor/src/app/canvas/index.ts");const __WEBPACK_DEFAULT_EXPORT__=function useElementsWithLinks(){const{pageAttachmentContainer}=(0,_app_canvas__WEBPACK_IMPORTED_MODULE_6__.yu)((state=>({pageAttachmentContainer:state.state.pageAttachmentContainer}))),{hasLinksInAttachmentArea,hasInvalidLinkSelected,hasPageAttachment,hasElementsInAttachmentArea}=(0,_app_story__WEBPACK_IMPORTED_MODULE_5__.P3)((({state})=>{const elementsWithLinks=state.currentPage?.elements.filter(_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_4__.V7.linkable)||[],hasPageAttachment=Boolean(state.currentPage?.pageAttachment?.url?.length);return{hasInvalidLinkSelected:Boolean(pageAttachmentContainer&&hasPageAttachment&&state.selectedElements.filter(_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_4__.V7.linkable).some((element=>(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_4__.Bx)(element)))),hasLinksInAttachmentArea:Boolean(pageAttachmentContainer&&elementsWithLinks.some((element=>(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_4__.Bx)(element,!0)))),hasElementsInAttachmentArea:Boolean(pageAttachmentContainer&&hasPageAttachment&&state.selectedElements.some((element=>(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_4__.Bx)(element,!1)))),hasPageAttachment}}));return{hasLinksInAttachmentArea,hasInvalidLinkSelected,isElementInAttachmentArea:(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_3__.hb)((element=>!!pageAttachmentContainer&&(!!hasPageAttachment&&(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_4__.Bx)(element,!1))),[pageAttachmentContainer,hasPageAttachment]),hasElementsInAttachmentArea}}},"./packages/story-editor/src/utils/useShapeMask.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/masks/src/index.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/elements/src/index.ts"),_app__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/story-editor/src/app/index.js"),_components_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/components/canvas/useInsertElement.ts"),_objectPick__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/utils/objectPick.ts");const __WEBPACK_DEFAULT_EXPORT__=element=>{const{updateElementById}=(0,_app__WEBPACK_IMPORTED_MODULE_3__.P3)((({actions})=>({updateElementById:actions.updateElementById,combineElements:actions.combineElements}))),insertElement=(0,_components_canvas_useInsertElement__WEBPACK_IMPORTED_MODULE_4__.A)(),{isMedia}=(0,_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_2__.zh)(element.type);return{hasShapeMask:isMedia&&element?.mask?.type!==_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__.E_.RECTANGLE,removeShapeMask:(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.hb)((()=>{if(!element)return;const shapeProps=(0,_objectPick__WEBPACK_IMPORTED_MODULE_5__.A)(element,["x","y","width","height","scale","rotationAngle"]);insertElement("shape",{...shapeProps,mask:{type:element.mask.type}}),updateElementById({elementId:element.id,properties:{mask:{type:_googleforcreators_masks__WEBPACK_IMPORTED_MODULE_1__.E_.RECTANGLE}}})}),[element,insertElement,updateElementById])}}}}]);