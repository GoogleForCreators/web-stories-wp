"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[7748],{"./packages/story-editor/src/components/library/panes/media/common/mediaGallery.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>mediaGallery});var react=__webpack_require__("./node_modules/react/index.js"),react_src=(__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js"),__webpack_require__("./packages/react/src/index.ts")),dist=__webpack_require__("./packages/story-editor/node_modules/react-photo-album/dist/index.mjs"),constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),polished_esm=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),loadingBar=__webpack_require__("./packages/design-system/src/components/loadingBar/loadingBar.tsx"),esm=__webpack_require__("./packages/story-editor/node_modules/react-blurhash/dist/esm/index.js"),v4=__webpack_require__("./packages/story-editor/node_modules/uuid/dist/esm-browser/v4.js"),noop=__webpack_require__("./packages/design-system/src/utils/noop.ts"),dots_fill_small=__webpack_require__("./packages/design-system/src/icons/dots_fill_small.svg"),popup=__webpack_require__("./packages/design-system/src/components/popup/popup.tsx"),popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),menu=__webpack_require__("./packages/design-system/src/components/menu/menu.tsx"),app=__webpack_require__("./packages/story-editor/src/app/index.js"),shared=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/index.js"),dropDownKeyEvents=__webpack_require__("./packages/story-editor/src/components/panels/utils/dropDownKeyEvents.js"),tracking_src=__webpack_require__("./packages/tracking/src/index.ts"),useSnackbar=__webpack_require__("./packages/design-system/src/contexts/snackbar/useSnackbar.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),api=__webpack_require__("./packages/story-editor/src/app/api/index.ts"),app_media=__webpack_require__("./packages/story-editor/src/app/media/index.js"),story=__webpack_require__("./packages/story-editor/src/app/story/index.ts"),dialog=__webpack_require__("./packages/story-editor/src/components/dialog/index.js");const deleteDialog=function DeleteDialog({mediaId,type,onClose}){const{actions:{deleteMedia}}=(0,api.M1)(),{showSnackbar}=(0,useSnackbar.d)(),{deleteMediaElement}=(0,app_media.HZ)((({actions:{deleteMediaElement}})=>({deleteMediaElement}))),{deleteElementsByResourceId}=(0,story.P3)((state=>({deleteElementsByResourceId:state.actions.deleteElementsByResourceId}))),onDelete=(0,react_src.hb)((async()=>{onClose();try{await deleteMedia(mediaId),deleteMediaElement({id:mediaId}),deleteElementsByResourceId({id:mediaId})}catch(err){(0,tracking_src.Oz)("local_media_deletion",err.message),showSnackbar({message:(0,i18n.__)("Failed to delete media item.","web-stories"),dismissible:!0})}}),[deleteMedia,deleteMediaElement,deleteElementsByResourceId,mediaId,onClose,showSnackbar]),imageDialogTitle=(0,i18n.__)("Delete Image?","web-stories"),videoDialogTitle=(0,i18n.__)("Delete Video?","web-stories"),imageDialogDescription=(0,i18n.__)("You are about to permanently delete this image from your site. The image will appear broken in any content that uses it.","web-stories"),videoDialogDescription=(0,i18n.__)("You are about to permanently delete this video from your site. The video will appear broken in any content that uses it.","web-stories");return react.createElement(dialog.A,{isOpen:!0,onClose,title:"image"===type?imageDialogTitle:videoDialogTitle,secondaryText:(0,i18n.__)("Cancel","web-stories"),onPrimary:onDelete,primaryText:(0,i18n.__)("Delete","web-stories"),maxWidth:512},react.createElement(typography_text.E.Paragraph,{size:types.$.Small},"image"===type?imageDialogDescription:videoDialogDescription),react.createElement(typography_text.E.Paragraph,{size:types.$.Small,isBold:!0},(0,i18n.__)("This action can not be undone.","web-stories")))};var date_src=__webpack_require__("./packages/date/src/index.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),getSmallestUrlForWidth=__webpack_require__("./packages/media/src/getSmallestUrlForWidth.ts"),textArea=__webpack_require__("./packages/design-system/src/components/textArea/textArea.tsx");const styledMediaThumbnail=(0,styled_components_browser_esm.AH)(["display:flex;width:","px;margin-right:28px;"],152),Image=styled_components_browser_esm.Ay.img.withConfig({displayName:"mediaEditDialog__Image",componentId:"sc-ctku7j-0"})(["",""],styledMediaThumbnail),Video=styled_components_browser_esm.Ay.video.withConfig({displayName:"mediaEditDialog__Video",componentId:"sc-ctku7j-1"})(["",""],styledMediaThumbnail),DialogBody=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaEditDialog__DialogBody",componentId:"sc-ctku7j-2"})(["display:flex;justify-content:left;align-items:flex-start;"]),MetadataTextContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaEditDialog__MetadataTextContainer",componentId:"sc-ctku7j-3"})(["display:flex;flex-direction:column;margin:0 4px;"]),DateText=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).withConfig({displayName:"mediaEditDialog__DateText",componentId:"sc-ctku7j-4"})(["margin-bottom:8px;"]),AssistiveTextArea=(0,styled_components_browser_esm.Ay)(textArea.A).withConfig({displayName:"mediaEditDialog__AssistiveTextArea",componentId:"sc-ctku7j-5"})(["margin:20px 0 4px;"]),imageDialogTitle=(0,i18n.__)("Edit Image","web-stories"),videoDialogTitle=(0,i18n.__)("Edit Video","web-stories"),imageInputTitle=(0,i18n.__)("Assistive text","web-stories"),videoInputTitle=(0,i18n.__)("Video description","web-stories"),imageDialogDescription=(0,i18n.__)("Describe the appearance and function of the image. Leave empty if the image is purely decorative.","web-stories"),videoDialogDescription=(0,i18n.__)("For indexability and accessibility. Include any burned-in text inside the video.","web-stories");const mediaEditDialog=function MediaEditDialog({resource,onClose}){const{id,src,creationDate,width,height,type,alt,poster,mimeType}=resource,{actions:{updateMedia}}=(0,api.M1)(),{updateMediaElement}=(0,app_media.HZ)((({actions:{updateMediaElement}})=>({updateMediaElement}))),{showSnackbar}=(0,useSnackbar.d)(),[altText,setAltText]=(0,react_src.J0)(alt),parsedDate=(0,date_src.ay)(creationDate),handleAltTextChange=(0,react_src.hb)((evt=>{setAltText(evt.target.value)}),[]),updateMediaItem=(0,react_src.hb)((async()=>{try{await updateMedia(id,{altText}),updateMediaElement({id,data:{alt:altText}}),onClose()}catch(err){(0,tracking_src.Oz)("local_media_edit",err.message),showSnackbar({message:(0,i18n.__)("Failed to update, please try again.","web-stories"),dismissible:!0})}}),[altText,id,onClose,showSnackbar,updateMedia,updateMediaElement]),isImage="image"===type;return react.createElement(dialog.A,{isOpen:!0,onClose,title:isImage?imageDialogTitle:videoDialogTitle,secondaryText:(0,i18n.__)("Cancel","web-stories"),onPrimary:updateMediaItem,primaryText:(0,i18n.__)("Save","web-stories")},react.createElement(DialogBody,null,"image"===type?react.createElement(Image,{src:(0,getSmallestUrlForWidth.A)(152,resource),alt,loading:"lazy",crossOrigin:"anonymous",decoding:"async"}):react.createElement(Video,{key:src,crossOrigin:"anonymous",poster,preload:"metadata",muted:!0},react.createElement("source",{src,type:mimeType})),react.createElement(MetadataTextContainer,null,(0,date_src.fn)(parsedDate)&&react.createElement(DateText,{size:types.$.XSmall},(0,sprintf.A)((0,i18n.__)("Uploaded: %s","web-stories"),(0,date_src.Yq)(creationDate))),react.createElement(typography_text.E.Span,{size:types.$.Small},(0,sprintf.A)((0,i18n.__)("%1$d x %2$d pixels","web-stories"),width,height)),react.createElement(AssistiveTextArea,{value:altText,"aria-label":isImage?imageInputTitle:videoInputTitle,type:"text",placeholder:isImage?imageInputTitle:videoInputTitle,onChange:handleAltTextChange}),react.createElement(typography_text.E.Paragraph,{size:types.$.Small},isImage?imageDialogDescription:videoDialogDescription))))},MoreButton=(0,styled_components_browser_esm.Ay)(shared.rA).withConfig({displayName:"dropDownMenu__MoreButton",componentId:"sc-1eq0xdj-0"})(["top:4px;right:4px;"]),DropDownContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"dropDownMenu__DropDownContainer",componentId:"sc-1eq0xdj-1"})(["margin-top:10px;"]),MenuContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"dropDownMenu__MenuContainer",componentId:"sc-1eq0xdj-2"})(["z-index:1;"]),menuStylesOverride=(0,styled_components_browser_esm.AH)(["min-width:160px;margin-top:0;li{display:block;}"]),MENU_OPTIONS_EDIT="edit",MENU_OPTIONS_DELETE="delete";const dropDownMenu=function DropDownMenu({resource,display,isMenuOpen,onMenuOpen,onMenuCancelled,onMenuSelected,setParentActive=noop.l}){const groups=[{options:[{label:(0,i18n.__)("Edit meta data","web-stories"),value:MENU_OPTIONS_EDIT},{label:(0,i18n.__)("Delete from library","web-stories"),value:MENU_OPTIONS_DELETE}]}],[showDeleteDialog,setShowDeleteDialog]=(0,react_src.J0)(!1),[showEditDialog,setShowEditDialog]=(0,react_src.J0)(!1),moreButtonRef=(0,react_src.li)(),onClose=(0,react_src.hb)((()=>{onMenuCancelled(),moreButtonRef.current?.focus(),setParentActive()}),[onMenuCancelled,setParentActive]),{canTranscodeResource}=(0,app.HZ)((({state:{canTranscodeResource}})=>({canTranscodeResource}))),onDeleteDialogClose=(0,react_src.hb)((()=>{setShowDeleteDialog(!1),onClose()}),[setShowDeleteDialog,onClose]),onEditDialogClose=(0,react_src.hb)((()=>{setShowEditDialog(!1),onClose()}),[setShowEditDialog,onClose]),listId=(0,react_src.Kr)((()=>`list-${(0,v4.A)()}`),[]),buttonId=(0,react_src.Kr)((()=>`button-${(0,v4.A)()}`),[]);return canTranscodeResource(resource)&&react.createElement(MenuContainer,null,moreButtonRef.current&&react.createElement(dropDownKeyEvents.A,{target:moreButtonRef.current}),react.createElement(MoreButton,{ref:moreButtonRef,onClick:onMenuOpen,"aria-label":(0,i18n.__)("More","web-stories"),"aria-pressed":isMenuOpen,"aria-haspopup":!0,"aria-expanded":isMenuOpen,"aria-owns":isMenuOpen?listId:null,id:buttonId,$display:display,tabIndex:display||isMenuOpen?0:-1},react.createElement(dots_fill_small.A,null)),(display||isMenuOpen)&&react.createElement(popup.A,{anchor:moreButtonRef,placement:popup_constants.W.BottomStart,isOpen:isMenuOpen},react.createElement(DropDownContainer,null,react.createElement(menu.A,{parentId:buttonId,listId,handleMenuItemSelect:(evt,value)=>{switch(onMenuSelected(),value){case MENU_OPTIONS_EDIT:setShowEditDialog(!0);break;case MENU_OPTIONS_DELETE:setShowDeleteDialog(!0)}},groups,onDismissMenu:onClose,hasMenuRole:!0,menuStylesOverride}))),showDeleteDialog&&react.createElement(deleteDialog,{mediaId:resource.id,type:resource.type,onClose:onDeleteDialogClose}),showEditDialog&&react.createElement(mediaEditDialog,{resource,onClose:onEditDialogClose}))};var tooltip=__webpack_require__("./packages/story-editor/src/components/tooltip/index.js"),utils_noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const StyledText=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).withConfig({displayName:"attribution__StyledText",componentId:"sc-dg18hp-0"})(["color:",";"],(({theme,active})=>(0,polished_esm.B3)(theme.colors.standard.white,active?1:.6))),Link=styled_components_browser_esm.Ay.a.withConfig({displayName:"attribution__Link",componentId:"sc-dg18hp-1"})(["display:block;position:absolute;left:0;bottom:0;width:100%;padding:8px;background-color:",";text-overflow:ellipsis;overflow:hidden;white-space:nowrap;text-decoration:none;"],(({theme,active})=>(0,polished_esm.B3)(theme.colors.bg.primary,active?.8:.6))),common_attribution=({author,url})=>{const[active,setActive]=(0,react_src.J0)(!1),makeActive=()=>setActive(!0),makeInactive=()=>setActive(!1);return react.createElement(Link,{title:author,active,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,href:url,target:"_blank",rel:"noreferrer"},react.createElement(StyledText,{size:types.$.XSmall},author))};var resourceList=__webpack_require__("./packages/media/src/resourceList.ts"),muted=__webpack_require__("./packages/design-system/src/icons/muted.svg"),libraryMoveable=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/libraryMoveable.js"),dropTargets=__webpack_require__("./packages/story-editor/src/components/dropTargets/index.js"),insertionOverlay=__webpack_require__("./packages/story-editor/src/components/library/panes/shared/insertionOverlay.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const styledTiles=(0,styled_components_browser_esm.AH)(["width:100%;cursor:pointer;transition:0.2s transform,0.15s opacity;border-radius:4px;opacity:0;object-fit:cover;"]),innerElement_Image=styled_components_browser_esm.Ay.img.withConfig({displayName:"innerElement__Image",componentId:"sc-qkk7ov-0"})(["",""],styledTiles),innerElement_Video=styled_components_browser_esm.Ay.video.withConfig({displayName:"innerElement__Video",componentId:"sc-qkk7ov-1"})([""," ",""],styledTiles,(({showWithoutDelay})=>showWithoutDelay?"opacity: 1;":"")),DurationWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"innerElement__DurationWrapper",componentId:"sc-qkk7ov-2"})(["position:absolute;bottom:8px;left:8px;background:",";border-radius:100px;height:18px;padding:0 6px;"],(({theme})=>theme.colors.opacity.black64)),MuteWrapper=styled_components_browser_esm.Ay.div.withConfig({displayName:"innerElement__MuteWrapper",componentId:"sc-qkk7ov-3"})(["position:absolute;bottom:8px;right:8px;height:24px;width:24px;background:",";color:",";border-radius:100px;"],(({theme})=>theme.colors.opacity.black64),(({theme})=>theme.colors.fg.primary)),Duration=(0,styled_components_browser_esm.Ay)(typography_text.E.Span).attrs({size:types.$.XSmall}).withConfig({displayName:"innerElement__Duration",componentId:"sc-qkk7ov-4"})(["color:",";display:block;"],(({theme})=>theme.colors.fg.primary)),CloneImg=styled_components_browser_esm.Ay.img.withConfig({displayName:"innerElement__CloneImg",componentId:"sc-qkk7ov-5"})(["opacity:0;width:",";height:",";position:absolute;"],(({width})=>`${width}px`),(({height})=>`${height}px`));const innerElement=(0,react_src.ph)((function InnerElement({type,src,resource,alt,width,height,onClick,onLoad=noop.l,showVideoDetail,mediaElement,active,isMuted}){const newVideoPosterRef=(0,react_src.li)(null),hasSetResourceTracker=(0,react_src.li)(null),{handleDrag,handleDrop}=(0,dropTargets.h)((({state,actions})=>({handleDrag:actions.handleDrag,handleDrop:actions.handleDrop,dropTargets:state.dropTargets,activeDropTargetId:state.activeDropTargetId})),((prev,curr)=>{if(hasSetResourceTracker.current)return!1;if(null===hasSetResourceTracker.current)return hasSetResourceTracker.current=!1,!1;if(prev?.dropTargets&&curr?.dropTargets){const prevIds=Object.keys(prev.dropTargets),currentIds=Object.keys(curr.dropTargets);if(prevIds.join()!==currentIds.join())return!1}return prev?.activeDropTargetId===curr?.activeDropTargetId})),{setDraggingResource}=(0,dropTargets.h)((({actions:{setDraggingResource}})=>({setDraggingResource})));let media;(0,react_src.vJ)((()=>{resource.poster&&(newVideoPosterRef.current=resource.poster)}),[resource.poster]);const{lengthFormatted,poster,mimeType}=resource,displayPoster=poster??newVideoPosterRef.current,thumbnailURL=displayPoster||(0,getSmallestUrlForWidth.A)(width,resource),commonProps={width,height,alt,crossOrigin:"anonymous"},commonImageProps={...commonProps,onLoad:()=>{mediaElement.current&&(mediaElement.current.style.opacity=1),onLoad()},loading:"lazy",decoding:"async",draggable:!1},cloneProps={...commonImageProps,onLoad:void 0},imageProps={...commonImageProps,src:thumbnailURL},videoProps={...commonProps,title:alt,alt:null,loop:type===app_media.cM.Gif,muted:!0,preload:"metadata",poster:displayPoster,showWithoutDelay:active};if(type===app_media.cM.Image||type===app_media.cM.Sticker?(media=react.createElement(innerElement_Image,_extends({key:src},imageProps,{ref:mediaElement})),cloneProps.src=thumbnailURL):[app_media.cM.Video,app_media.cM.Gif].includes(type)&&(media=react.createElement(react.Fragment,null,poster&&!active?react.createElement(innerElement_Image,_extends({key:src},imageProps,{ref:mediaElement})):react.createElement(innerElement_Video,_extends({key:src},videoProps,{ref:mediaElement}),type===app_media.cM.Gif?resource.output.src&&react.createElement("source",{src:resource.output.src,type:resource.output.mimeType}):react.createElement("source",{src:(0,getSmallestUrlForWidth.A)(width,resource),type:mimeType})),type===app_media.cM.Video&&showVideoDetail&&lengthFormatted&&react.createElement(DurationWrapper,null,react.createElement(Duration,null,lengthFormatted)),type===app_media.cM.Video&&showVideoDetail&&isMuted&&react.createElement(MuteWrapper,null,react.createElement(muted.A,null))),cloneProps.src=poster),!media)throw new Error("Invalid media element type.");const imageURL=type===app_media.cM.Image?thumbnailURL:poster;return react.createElement(react.Fragment,null,media,active&&react.createElement(insertionOverlay.A,{showIcon:!1}),react.createElement(libraryMoveable.A,{active,handleDrag:event=>{hasSetResourceTracker.current||(resourceList.A.set(resource.id,{url:thumbnailURL,type:"cached"}),setDraggingResource(resource),hasSetResourceTracker.current=!0),handleDrag(resource,event.clientX,event.clientY)},handleDragEnd:()=>{handleDrop(resource),hasSetResourceTracker.current=!1},type:resource.type,elementProps:{resource},onClick:onClick(imageURL),cloneElement:CloneImg,cloneProps}))}));var keyboard=__webpack_require__("./packages/design-system/src/components/keyboard/keyboard.tsx"),plus_filled_small=__webpack_require__("./packages/design-system/src/icons/plus_filled_small.svg"),getElementProperties=__webpack_require__("./packages/story-editor/src/components/canvas/utils/getElementProperties.ts"),useStory=__webpack_require__("./packages/story-editor/src/app/story/useStory.ts"),useRovingTabIndex=__webpack_require__("./packages/story-editor/src/utils/useRovingTabIndex/index.js"),useFocusCanvas=__webpack_require__("./packages/story-editor/src/components/canvas/useFocusCanvas.ts");const insertionMenu_DropDownContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"insertionMenu__DropDownContainer",componentId:"sc-xjd4tf-0"})(["margin-top:10px;min-width:160px;"]),insertionMenu_MenuContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"insertionMenu__MenuContainer",componentId:"sc-xjd4tf-1"})(["z-index:1;"]),insertionMenu_menuStylesOverride=(0,styled_components_browser_esm.AH)(["min-width:160px;margin-top:0;li{display:block;}"]),insertionMenu_MENU_OPTIONS_INSERT="insert",insertionMenu_MENU_OPTIONS_ADD_BACKGROUND="addBackground";const insertionMenu=function InsertionMenu({resource,display,onInsert,width,index,isLocal=!1,setParentActive=noop.l,setParentInactive=noop.l}){const insertButtonRef=(0,react_src.li)(),[isMenuOpen,setIsMenuOpen]=(0,react_src.J0)(!1),onMenuOpen=(0,react_src.hb)((e=>{e.stopPropagation(),setIsMenuOpen(!0)}),[]),onMenuCancelled=(0,react_src.hb)((()=>{setIsMenuOpen(!1),insertButtonRef.current?.focus(),setParentActive()}),[setParentActive]),{currentBackgroundId,combineElements}=(0,useStory.A)((state=>({currentBackgroundId:state.state.currentPage?.elements?.[0]?.id,combineElements:state.actions.combineElements}))),{type,poster}=resource,groups=[{options:[{label:["image","gif"].includes(type)?(0,i18n.__)("Insert image","web-stories"):(0,i18n.__)("Insert video","web-stories"),value:insertionMenu_MENU_OPTIONS_INSERT},{label:(0,i18n.__)("Add as background","web-stories"),value:insertionMenu_MENU_OPTIONS_ADD_BACKGROUND}]}];(0,useRovingTabIndex.A)({ref:insertButtonRef},[],3);const focusCanvas=(0,useFocusCanvas.A)();(0,keyboard._h)(isLocal?null:insertButtonRef,"tab",focusCanvas,[focusCanvas]);const listId=(0,react_src.Kr)((()=>`list-${(0,v4.A)()}`),[]),buttonId=(0,react_src.Kr)((()=>`button-${(0,v4.A)()}`),[]);return react.createElement(insertionMenu_MenuContainer,null,react.createElement(shared.rA,{ref:insertButtonRef,onClick:onMenuOpen,"aria-label":(0,i18n.__)("Open insertion menu","web-stories"),"aria-pressed":isMenuOpen,"aria-haspopup":!0,"aria-expanded":isMenuOpen,"aria-owns":isMenuOpen?listId:null,id:buttonId,$display:display,tabIndex:0===index?0:-1},react.createElement(plus_filled_small.A,null)),isMenuOpen&&react.createElement(popup.A,{anchor:insertButtonRef,placement:popup_constants.W.BottomStart,isOpen:isMenuOpen},react.createElement(insertionMenu_DropDownContainer,null,react.createElement(menu.A,{parentId:buttonId,listId,handleMenuItemSelect:(evt,value)=>{const thumbnailUrl=poster||(0,getSmallestUrlForWidth.A)(width,resource),newElement=(0,getElementProperties.A)(resource.type,{resource});switch(setIsMenuOpen(!1),value){case insertionMenu_MENU_OPTIONS_INSERT:onInsert(resource,thumbnailUrl);break;case insertionMenu_MENU_OPTIONS_ADD_BACKGROUND:combineElements({firstElement:newElement,secondId:currentBackgroundId})}setParentInactive()},groups,onDismissMenu:onMenuCancelled,hasMenuRole:!0,menuStylesOverride:insertionMenu_menuStylesOverride}))))};function mediaElement_extends(){return mediaElement_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},mediaElement_extends.apply(this,arguments)}const AUTOPLAY_PREVIEW_VIDEO_DELAY_MS=600,Container=styled_components_browser_esm.Ay.div.attrs((props=>({style:{width:props.width+"px",height:props.height+"px",margin:props.margin,backgroundColor:"transparent",color:"inherit",border:"none",padding:0}}))).withConfig({displayName:"mediaElement__Container",componentId:"sc-n7038j-0"})([""]),InnerContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"mediaElement__InnerContainer",componentId:"sc-n7038j-1"})(["position:relative;display:flex;margin-bottom:10px;background-color:",";"],(({theme,$baseColor})=>$baseColor||(0,polished_esm.B3)(theme.colors.standard.black,.3))),BlurhashContainer=(0,styled_components_browser_esm.Ay)(esm.Q).withConfig({displayName:"mediaElement__BlurhashContainer",componentId:"sc-n7038j-2"})(["position:absolute !important;top:0;left:0;"]);function Element({index,resource,width:requestedWidth,height:requestedHeight,margin,onInsert,providerType,canEditMedia}){const{id:resourceId,src,type,width:originalWidth,height:originalHeight,alt,isMuted,baseColor,blurHash}=resource,{isCurrentResourceProcessing,isCurrentResourceUploading}=(0,app_media.HZ)((({state})=>({isCurrentResourceProcessing:state.isCurrentResourceProcessing,isCurrentResourceUploading:state.isCurrentResourceUploading}))),oRatio=originalWidth&&originalHeight?originalWidth/originalHeight:1,width=requestedWidth||requestedHeight/oRatio,height=requestedHeight||width/oRatio,mediaElement=(0,react_src.li)(),[showVideoDetail,setShowVideoDetail]=(0,react_src.J0)(!0),[active,setActive]=(0,react_src.J0)(!1),[isMenuOpen,setIsMenuOpen]=(0,react_src.J0)(!1),[isLoaded,setLoaded]=(0,react_src.J0)(!1),makeActive=(0,react_src.hb)((()=>setActive(!0)),[]),makeInactive=(0,react_src.hb)((()=>setActive(!1)),[]),onMenuOpen=(0,react_src.hb)((()=>setIsMenuOpen(!0)),[]),onMenuCancelled=(0,react_src.hb)((()=>setIsMenuOpen(!1)),[]),onMenuSelected=(0,react_src.hb)((()=>{setIsMenuOpen(!1),setActive(!1)}),[]),[hoverTimer,setHoverTimer]=(0,react_src.J0)(null),activeRef=(0,react_src.li)(active);activeRef.current=active,(0,react_src.vJ)((()=>{if(![app_media.cM.Video,app_media.cM.Gif].includes(type))return;const resetHoverTime=()=>{null!==hoverTimer&&(clearTimeout(hoverTimer),setHoverTimer(null))};if(!isMenuOpen)if(active){if(setShowVideoDetail(!1),mediaElement.current&&null===hoverTimer){const timer=setTimeout((()=>{activeRef.current&&src&&mediaElement.current.play().catch(utils_noop.l)}),AUTOPLAY_PREVIEW_VIDEO_DELAY_MS);setHoverTimer(timer)}}else setShowVideoDetail(!0),resetHoverTime(),mediaElement.current&&mediaElement.current?.pause&&src&&(mediaElement.current.pause(),mediaElement.current.currentTime=0);return resetHoverTime}),[isMenuOpen,active,type,src,hoverTimer,setHoverTimer,activeRef]);const onClick=(0,react_src.hb)((thumbnailUrl=>()=>{onInsert(resource,thumbnailUrl)}),[onInsert,resource]),attribution=active&&resource.attribution?.author?.displayName&&resource.attribution?.author?.url&&react.createElement(common_attribution,{author:resource.attribution.author.displayName,url:resource.attribution.author.url}),ref=(0,react_src.li)(),onLoad=(0,react_src.hb)((()=>setLoaded(!0)),[]),isPlaceholder=!isLoaded&&!active;return react.createElement(Container,{ref,"data-testid":`mediaElement-${type}`,"data-id":resourceId,className:"mediaElement",width,height,margin,onPointerEnter:makeActive,onFocus:makeActive,onPointerLeave:makeInactive,onBlur:makeInactive,tabIndex:"-1"},react.createElement(InnerContainer,{$baseColor:isPlaceholder&&baseColor},react.createElement(innerElement,{type,src,mediaElement,resource,alt,isMuted,width,height,onClick,onLoad,showVideoDetail,active}),attribution,isPlaceholder&&blurHash&&react.createElement(BlurhashContainer,{hash:blurHash,width,height,punch:1}),(!src||isCurrentResourceProcessing(resourceId)||isCurrentResourceUploading(resourceId))&&react.createElement(loadingBar.G,{loadingMessage:(0,i18n.__)("Uploading media…","web-stories")}),react.createElement(insertionMenu,{resource,display:active,onInsert,width,index,isLocal:"local"===providerType,setParentActive:makeActive,setParentInactive:makeInactive}),"local"===providerType&&canEditMedia&&react.createElement(dropDownMenu,{resource,display:active,isMenuOpen,onMenuOpen,onMenuCancelled,onMenuSelected,setParentActive:makeActive})))}const mediaElement=(0,react_src.ph)((function MediaElement({providerType="local",canEditMedia=!1,...props}){const{isCurrentResourceProcessing,isCurrentResourceUploading}=(0,app_media.HZ)((({state})=>({isCurrentResourceProcessing:state.isCurrentResourceProcessing,isCurrentResourceUploading:state.isCurrentResourceUploading}))),{id:resourceId}=props.resource;return isCurrentResourceProcessing(resourceId)||isCurrentResourceUploading(resourceId)?react.createElement(tooltip.A,{title:(0,i18n.__)("Uploading media…","web-stories")},react.createElement(Element,mediaElement_extends({},props,{providerType,canEditMedia}))):react.createElement(Element,mediaElement_extends({},props,{providerType,canEditMedia}))}));var styles=__webpack_require__("./packages/story-editor/src/components/library/panes/media/common/styles.js");const ROW_CONSTRAINTS={maxPhotos:2},ContainerRenderer=({children,containerRef})=>react.createElement(styles.WW,{ref:containerRef},children),RowRenderer=({children})=>children;const mediaGallery=function MediaGallery({resources,uploadingResources=[],onInsert,providerType,canEditMedia=!1}){const photos=[...uploadingResources.map((resource=>({key:`uploading-${resource.id}`,src:resource.src,width:resource.width,height:resource.height,resource}))),...resources.map((resource=>({key:resource.id,src:resource.src,width:resource.width,height:resource.height,resource})))].map(((photo,index)=>({...photo,index}))),imageRenderer=(0,react_src.hb)((({photo,layout})=>react.createElement(mediaElement,{key:photo.key,index:photo.index,margin:"0px 0px 8px 0px",resource:photo.resource,width:layout.width,height:layout.height,onInsert,providerType,canEditMedia})),[providerType,onInsert,canEditMedia]);return react.createElement("div",null,react.createElement(dist.A,{layout:"rows",photos,renderPhoto:imageRenderer,renderRowContainer:RowRenderer,renderContainer:ContainerRenderer,targetRowHeight:110,rowConstraints:ROW_CONSTRAINTS,spacing:8,defaultContainerWidth:constants.gH}))}}}]);