"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[5776],{"./packages/design-system/src/components/loadingBar/loadingBar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>LoadingBar});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-compiler-runtime/dist/index.js"),react_transition_group__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react-transition-group/esm/CSSTransition.js"),styled_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/react/src/index.ts"),_theme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/design-system/src/theme/helpers/visuallyHidden.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const LOADING_INDICATOR_CLASS="loading-indicator",AriaOnlyAlert=styled_components__WEBPACK_IMPORTED_MODULE_3__.Ay.span.withConfig({displayName:"loadingBar__AriaOnlyAlert",componentId:"sc-11l744v-0"})(["",""],_theme__WEBPACK_IMPORTED_MODULE_4__.Q),gradientAnimation=(0,styled_components__WEBPACK_IMPORTED_MODULE_3__.i7)(["0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}"]),UploadingIndicator=styled_components__WEBPACK_IMPORTED_MODULE_3__.Ay.div.withConfig({displayName:"loadingBar__UploadingIndicator",componentId:"sc-11l744v-1"})(["height:4px;background:",";background-size:400% 400%;position:absolute;bottom:0px;border-radius:",";animation:"," 4s ease infinite;&.","{&.appear{width:0;}&.appear-done{width:100%;transition:1s ease-out;transition-property:width;}}"],(({theme})=>theme.colors.gradient.loading),(({theme})=>`0px 0px ${theme.borders.radius.small} ${theme.borders.radius.small}`),gradientAnimation,LOADING_INDICATOR_CLASS);function LoadingBar(t0){const $=(0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(14);let loadingMessage,rest;$[0]!==t0?(({loadingMessage,...rest}=t0),$[0]=t0,$[1]=loadingMessage,$[2]=rest):(loadingMessage=$[1],rest=$[2]);const nodeRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.li)(null);let t1,t2,t3,t4;return $[3]!==loadingMessage?(t1=loadingMessage&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(AriaOnlyAlert,{role:"status"},loadingMessage),$[3]=loadingMessage,$[4]=t1):t1=$[4],$[5]!==nodeRef||$[6]!==rest?(t2=react__WEBPACK_IMPORTED_MODULE_0__.createElement(UploadingIndicator,_extends({ref:nodeRef},rest)),$[5]=nodeRef,$[6]=rest,$[7]=t2):t2=$[7],$[8]!==nodeRef||$[9]!==t2?(t3=react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_transition_group__WEBPACK_IMPORTED_MODULE_5__.A,{nodeRef,in:!0,appear:!0,timeout:0,className:LOADING_INDICATOR_CLASS},t2),$[8]=nodeRef,$[9]=t2,$[10]=t3):t3=$[10],$[11]!==t1||$[12]!==t3?(t4=react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,t1,t3),$[11]=t1,$[12]=t3,$[13]=t4):t4=$[13],t4}},"./packages/design-system/src/icons/gear_with_gauge.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _rect,_path,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const SvgGearWithGauge=({title,titleId,...props})=>react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 32","aria-labelledby":titleId},props),title?react__WEBPACK_IMPORTED_MODULE_0__.createElement("title",{id:titleId},title):null,_rect||(_rect=react__WEBPACK_IMPORTED_MODULE_0__.createElement("rect",{width:32,height:32,fill:"currentColor",fillOpacity:.64,rx:16})),_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M21.564 15.406a5 5 0 0 1 0 1.192c-.053.446.132.9.522 1.122l.408.231a1 1 0 0 1 .368 1.377l-.513.873a1 1 0 0 1-1.355.363l-.45-.254c-.382-.217-.858-.15-1.214.108q-.505.367-1.087.618c-.412.177-.716.563-.716 1.012v.452a1 1 0 0 1-1 1h-1.054a1 1 0 0 1-1-1v-.453c0-.449-.304-.835-.717-1.012a5.6 5.6 0 0 1-1.085-.616c-.357-.26-.833-.327-1.216-.11l-.448.254a1 1 0 0 1-1.355-.363l-.514-.873a1 1 0 0 1 .369-1.377l.404-.23c.392-.222.576-.678.524-1.126a5 5 0 0 1 0-1.188c.052-.448-.132-.904-.524-1.127l-.404-.229a1 1 0 0 1-.369-1.376l.514-.874a1 1 0 0 1 1.355-.363l.447.254c.384.217.86.15 1.216-.11a5.6 5.6 0 0 1 1.086-.617c.413-.177.716-.562.716-1.011V9.5a1 1 0 0 1 1-1h1.054a1 1 0 0 1 1 1v.453c0 .449.304.835.717 1.012q.581.25 1.085.616c.357.26.833.327 1.217.11l.446-.254a1 1 0 0 1 1.356.363l.513.874a1 1 0 0 1-.368 1.376l-.404.23c-.393.222-.577.678-.524 1.126M12.5 16a3.5 3.5 0 0 1 7 0 .5.5 0 0 0 1 0 4.5 4.5 0 1 0-9 0 .5.5 0 0 0 1 0m5.601-1.46a.5.5 0 0 0-.707-.707l-1.188 1.188a1 1 0 1 0 .745.669z",clipRule:"evenodd"}))),__WEBPACK_DEFAULT_EXPORT__=(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(SvgGearWithGauge)},"./packages/design-system/src/theme/helpers/visuallyHidden.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>visuallyHidden});const visuallyHidden=(0,__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js").AH)(["position:absolute;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;"])},"./packages/story-editor/src/app/pageCanvas/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Vz:()=>pageCanvasProvider,zN:()=>pageCanvas_useCalculateAccessibleTextColors,R5:()=>pageCanvas_usePageCanvas});var react=__webpack_require__("./node_modules/react/index.js"),src=__webpack_require__("./packages/react/src/index.ts"),contrastUtils=__webpack_require__("./packages/story-editor/src/utils/contrastUtils.ts"),useIdleTaskQueue=__webpack_require__("./packages/story-editor/src/utils/useIdleTaskQueue.ts"),story=__webpack_require__("./packages/story-editor/src/app/story/index.ts"),constants=__webpack_require__("./packages/story-editor/src/constants/index.ts"),storyPageToNode=__webpack_require__("./packages/story-editor/src/app/pageCanvas/utils/storyPageToNode.tsx");const utils_storyPageToCanvas=async function storyPageToCanvas(page,{width=400,...options}){const htmlToImage=await __webpack_require__.e(4622).then(__webpack_require__.bind(__webpack_require__,"./node_modules/html-to-image/es/index.js")),[node,cleanup]=await(0,storyPageToNode.A)(page,width,{renderFullHeightThumb:!0}),canvas=await htmlToImage.toCanvas(node,{...options});return cleanup(),canvas};var noop=__webpack_require__("./packages/story-editor/src/utils/noop.ts");const context=(0,src.q6)({actions:{calculateAccessibleTextColors:async()=>Promise.resolve({}),generateDeferredPageCanvas:()=>noop.l,generateDeferredCurrentPageCanvas:noop.l},state:{pageCanvasMap:{}}});var src_constants=__webpack_require__("./packages/units/src/constants.ts"),dimensions=__webpack_require__("./packages/units/src/dimensions.ts"),element_library_src=__webpack_require__("./packages/element-library/src/index.ts");const pageCanvas_getPixelDataFromCanvas=function getPixelDataFromCanvas(canvas,attrs){const ctx=canvas.getContext("2d"),safeZoneDiff=(canvas.width/src_constants.yK-canvas.width/src_constants.iZ)/2,box=(0,dimensions.YH)({...attrs,height:attrs.height?attrs.height:(0,element_library_src.ru)(attrs,attrs.width)},canvas.width,canvas.height-2*safeZoneDiff),{x,y:origY,width,height}=box,y=origY+safeZoneDiff;return ctx.getImageData(x,y,width,height).data};var objectWithout=__webpack_require__("./packages/story-editor/src/utils/objectWithout.ts");const INITIAL_STATE={},reducer={setPageCanvas:(map,action)=>{const{pageId,canvas}=action.payload;return{...map,[pageId]:canvas}},clearPageCanvas:(map,action)=>{const{pageId}=action.payload;return(0,objectWithout.A)(map,[pageId])}};const pageCanvas_usePageCanvasMap=function usePageCanvasMap(){return(0,src.Fm)(INITIAL_STATE,reducer)};const pageCanvas_usePageSnapshot=function usePageSnapshot(){const[snapShot,_setSnapshot]=(0,src.J0)(null),snapshotRef=(0,src.li)(snapShot);snapshotRef.current=snapShot;const getSnapshotCanvas=(0,src.hb)((page=>page.backgroundColor===snapshotRef.current?.backgroundColor&&(0,src.bN)(page.elements,snapshotRef.current?.elements)?snapshotRef.current.canvas:null),[]);return{setSnapshot:(0,src.hb)((({page:page_0,canvas})=>{_setSnapshot({elements:page_0.elements,backgroundColor:page_0.backgroundColor,canvas})}),[]),getSnapshotCanvas}};var dist=__webpack_require__("./node_modules/react-compiler-runtime/dist/index.js");const pageCanvasCacheValidator=(0,src.ph)((function PageCanvasCacheValidator(t0){const $=(0,dist.c)(12),{pageId,clearPageCanvasCache}=t0;let t1;$[0]!==pageId?(t1=t2=>{const{state}=t2;return(0,objectWithout.A)(state.pages.find((t3=>{const{id}=t3;return id===pageId})),["animations"])},$[0]=pageId,$[1]=t1):t1=$[1];const page=(0,story.P3)(t1);let t2,t3,t4,t5;return $[2]!==clearPageCanvasCache||$[3]!==page.id?(t2=()=>{clearPageCanvasCache({pageId:page.id})},$[2]=clearPageCanvasCache,$[3]=page.id,$[4]=t2):t2=$[4],$[5]!==clearPageCanvasCache||$[6]!==page?(t3=[page,clearPageCanvasCache],$[5]=clearPageCanvasCache,$[6]=page,$[7]=t3):t3=$[7],(0,src.vJ)(t2,t3),$[8]!==clearPageCanvasCache||$[9]!==pageId?(t4=()=>()=>clearPageCanvasCache({pageId}),t5=[clearPageCanvasCache,pageId],$[8]=clearPageCanvasCache,$[9]=pageId,$[10]=t4,$[11]=t5):(t4=$[10],t5=$[11]),(0,src.vJ)(t4,t5),null}));const getPageWithoutSelection=function pageWithoutSelection(page,selection){return{...page,elements:page.elements.filter((({id})=>!selection.includes(id)))}};const pageCanvasProvider=function PageCanvasProvider({children}){const queueIdleTask=(0,useIdleTaskQueue.A)(),[pageCanvasMap,actions]=pageCanvas_usePageCanvasMap(),{getSnapshotCanvas,setSnapshot}=pageCanvas_usePageSnapshot(),pageIds=(0,story.P3)((({state})=>state.pages.map((({id})=>id)))),{currentPage,singleElementSelection}=(0,story.P3)((({state:state_0})=>({singleElementSelection:1===state_0.selectedElementIds?.length?state_0.selectedElementIds:constants.qW,currentPage:state_0.currentPage}))),values={currentPageValue:currentPage,pageCanvasMapValue:pageCanvasMap,singleElementSelectionValue:singleElementSelection},valuesRef=(0,src.li)(values);valuesRef.current=values;const generateDeferredPageCanvas=(0,src.hb)((([taskId,page])=>queueIdleTask({taskId,task:async()=>{try{const canvas=await utils_storyPageToCanvas(page,{});actions.setPageCanvas({pageId:page.id,canvas})}catch{actions.setPageCanvas({pageId:page.id,canvas:null})}}})),[queueIdleTask,actions]),generateDeferredCurrentPageCanvas=(0,src.hb)((()=>{const{currentPageValue,pageCanvasMapValue}=valuesRef.current;void 0===pageCanvasMapValue[currentPageValue.id]&&generateDeferredPageCanvas([currentPageValue.id,currentPageValue])}),[generateDeferredPageCanvas]),getSelectionExclusionCanvas=(0,src.hb)((async(page_0,selection)=>{const pageWithoutSelection=getPageWithoutSelection(page_0,selection);let canvas_1=getSnapshotCanvas(pageWithoutSelection);return canvas_1||(canvas_1=await utils_storyPageToCanvas(pageWithoutSelection,{}),setSnapshot({page:pageWithoutSelection,canvas:canvas_1})),canvas_1}),[setSnapshot,getSnapshotCanvas]),getCanvas=(0,src.hb)((async page_1=>{const{pageCanvasMapValue:pageCanvasMapValue_0}=valuesRef.current;let canvas_2=pageCanvasMapValue_0[page_1.id];return canvas_2||(canvas_2=await utils_storyPageToCanvas(page_1,{}),actions.setPageCanvas({pageId:page_1.id,canvas:canvas_2})),canvas_2}),[actions]),calculateAccessibleTextColors=(0,src.hb)((async element=>{const{currentPageValue:currentPageValue_0,singleElementSelectionValue}=valuesRef.current;let canvas_3;canvas_3=singleElementSelectionValue.includes(element.id)?await getSelectionExclusionCanvas(currentPageValue_0,singleElementSelectionValue):await getCanvas(currentPageValue_0);const{fontSize}=element,pixelData=pageCanvas_getPixelDataFromCanvas(canvas_3,element);return(0,contrastUtils.$W)(pixelData,fontSize)}),[getSelectionExclusionCanvas,getCanvas]);return react.createElement(context.Provider,{value:{state:{pageCanvasMap},actions:{calculateAccessibleTextColors,generateDeferredPageCanvas,generateDeferredCurrentPageCanvas}}},pageIds.map((pageId=>react.createElement(pageCanvasCacheValidator,{key:pageId,pageId,clearPageCanvasCache:actions.clearPageCanvas}))),children)};function _temp(t0){const{actions}=t0;return actions.calculateAccessibleTextColors}const pageCanvas_useCalculateAccessibleTextColors=function useCalculateAccessibleTextColors(){return(0,src.i7)(context,_temp)};const pageCanvas_usePageCanvas=function usePageCanvas(t0){const selector=void 0===t0?src.D_:t0;return(0,src.i7)(context,selector)}},"./packages/story-editor/src/app/pageCanvas/utils/storyPageToNode.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-compiler-runtime/dist/index.js"),_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/design-system/src/theme/theme.ts"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./packages/units/src/unitsProvider.tsx"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./packages/units/src/constants.ts"),styled_components__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_googleforcreators_patterns__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/patterns/src/generatePatternStyles.ts"),_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/transform/src/index.ts"),_font__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/app/font/index.ts"),_components_canvas_displayElement__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/components/canvas/displayElement.js");const StoryPage=styled_components__WEBPACK_IMPORTED_MODULE_6__.Ay.div.withConfig({displayName:"storyPageToNode__StoryPage",componentId:"sc-iucwgc-0"})(["display:block;position:relative;padding:0;border:0;background-color:transparent;height:","px;width:","px;flex:none;outline:0;"],(({height})=>height),(({width})=>width)),PreviewWrapper=styled_components__WEBPACK_IMPORTED_MODULE_6__.Ay.div.withConfig({displayName:"storyPageToNode__PreviewWrapper",componentId:"sc-iucwgc-1"})(["height:100%;position:relative;overflow:hidden;background-color:",";border-radius:4px;",""],(({theme})=>theme.colors.standard.white),(({background})=>(0,_googleforcreators_patterns__WEBPACK_IMPORTED_MODULE_7__.A)(background))),FullHeight=styled_components__WEBPACK_IMPORTED_MODULE_6__.Ay.div.withConfig({displayName:"storyPageToNode__FullHeight",componentId:"sc-iucwgc-2"})(["position:absolute;top:","px;bottom:","px;right:0;left:0;"],(({yOffset})=>yOffset),(({yOffset})=>yOffset)),PageWithDependencies=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.Rf)((function PageWithDependencies(t0,ref){const $=(0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(19),{page,width,height,renderFullHeightThumb:t1,containerHeight}=t0,renderFullHeightThumb=void 0!==t1&&t1;let t2;$[0]!==height||$[1]!==width?(t2={width,height},$[0]=height,$[1]=width,$[2]=t2):t2=$[2];const t3=renderFullHeightThumb?containerHeight:height,t4=page.backgroundColor,t5=renderFullHeightThumb?(containerHeight-height)/2:0;let t6,t7,t8,t9,t10;return $[3]!==page.elements?(t6=page.elements.map(_temp),$[3]=page.elements,$[4]=t6):t6=$[4],$[5]!==t5||$[6]!==t6?(t7=react__WEBPACK_IMPORTED_MODULE_0__.createElement(FullHeight,{yOffset:t5},t6),$[5]=t5,$[6]=t6,$[7]=t7):t7=$[7],$[8]!==page.backgroundColor||$[9]!==t7?(t8=react__WEBPACK_IMPORTED_MODULE_0__.createElement(PreviewWrapper,{background:t4},t7),$[8]=page.backgroundColor,$[9]=t7,$[10]=t8):t8=$[10],$[11]!==ref||$[12]!==t3||$[13]!==t8||$[14]!==width?(t9=react__WEBPACK_IMPORTED_MODULE_0__.createElement(StoryPage,{ref,height:t3,width},t8),$[11]=ref,$[12]=t3,$[13]=t8,$[14]=width,$[15]=t9):t9=$[15],$[16]!==t2||$[17]!==t9?(t10=react__WEBPACK_IMPORTED_MODULE_0__.createElement(styled_components__WEBPACK_IMPORTED_MODULE_6__.NP,{theme:_googleforcreators_design_system__WEBPACK_IMPORTED_MODULE_8__.w},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_font__WEBPACK_IMPORTED_MODULE_4__.pK,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__.gS,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_googleforcreators_units__WEBPACK_IMPORTED_MODULE_9__.A,{pageSize:t2},t9)))),$[16]=t2,$[17]=t9,$[18]=t10):t10=$[18],t10}));const __WEBPACK_DEFAULT_EXPORT__=async function storyPageToNode(page,width,opts={}){const{renderFullHeightThumb=!1}=opts,height=width*(1/_googleforcreators_units__WEBPACK_IMPORTED_MODULE_10__.iZ),containerHeight=width*(1/_googleforcreators_units__WEBPACK_IMPORTED_MODULE_10__.yK),bufferRoot=document.createElement("div");bufferRoot.style.cssText=`\n     contain: strict;\n     position: absolute;\n     top: 0;\n     left: 0;\n     width: ${width}px;\n     height: ${containerHeight}px;\n     opacity: 0;\n     transform: translate(-100%, -100%);\n     pointer-events: none;\n   `;const node=await new Promise((resolve=>{(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.XX)(react__WEBPACK_IMPORTED_MODULE_0__.createElement(PageWithDependencies,{ref:htmlNode=>{htmlNode&&resolve(htmlNode)},page,width,height,containerHeight,renderFullHeightThumb}),bufferRoot)}));return document.body.appendChild(bufferRoot),[node,()=>{(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.xJ)(bufferRoot),document.body.removeChild(bufferRoot)}]};function _temp(element){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_canvas_displayElement__WEBPACK_IMPORTED_MODULE_5__.A,{key:element.id,previewMode:!0,element})}},"./packages/story-editor/src/components/canvas/displayElement.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>displayElement});var react=__webpack_require__("./node_modules/react/index.js"),dist=__webpack_require__("./node_modules/react-compiler-runtime/dist/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),src=__webpack_require__("./packages/react/src/index.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),generatePatternStyles=__webpack_require__("./packages/patterns/src/generatePatternStyles.ts"),useUnits=__webpack_require__("./packages/units/src/useUnits.ts"),calcRotatedResizeOffset=__webpack_require__("./packages/units/src/calcRotatedResizeOffset.ts"),animation_src=__webpack_require__("./packages/animation/src/index.ts"),transform_src=__webpack_require__("./packages/transform/src/index.ts"),elements_src=__webpack_require__("./packages/elements/src/index.ts"),element_library_src=__webpack_require__("./packages/element-library/src/index.ts"),masks_src=__webpack_require__("./packages/masks/src/index.ts"),useCORSProxy=(__webpack_require__("./packages/story-editor/src/propTypes.js"),__webpack_require__("./packages/story-editor/src/utils/useCORSProxy.ts")),app=__webpack_require__("./packages/story-editor/src/app/index.js"),esm=__webpack_require__("./packages/story-editor/node_modules/react-blurhash/dist/esm/index.js"),hideOnError=__webpack_require__("./packages/story-editor/src/components/hideOnError.tsx");const placeholderStyles=(0,styled_components_browser_esm.AH)(["position:absolute !important;top:0;left:0;height:100%;width:100%;"]),BlurhashContainer=(0,styled_components_browser_esm.Ay)(esm.Q).withConfig({displayName:"renderResourcePlaceholder__BlurhashContainer",componentId:"sc-m9r2np-0"})(["",""],placeholderStyles),BaseColorContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"renderResourcePlaceholder__BaseColorContainer",componentId:"sc-m9r2np-1"})([""," background-color:",";"],placeholderStyles,(({$baseColor})=>$baseColor));const canvas_renderResourcePlaceholder=function renderResourcePlaceholder({blurHash,baseColor}){return blurHash?react.createElement(hideOnError.w,null,react.createElement(BlurhashContainer,{hash:blurHash,punch:1,height:"100%",width:"100%"})):baseColor?react.createElement(BaseColorContainer,{$baseColor:baseColor}):null};function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const Wrapper=styled_components_browser_esm.Ay.div.attrs((({previewMode,x,y,width,height,rotationAngle})=>previewMode?{style:{position:"absolute",zIndex:1,left:`${x}px`,top:`${y}px`,width:`${width}px`,height:`${height}px`,transform:`rotate(${rotationAngle}deg)`}}:{})).withConfig({displayName:"displayElement__Wrapper",componentId:"sc-1uos4dq-0"})([""," "," "," contain:layout;transition:opacity 0.15s cubic-bezier(0,0,0.54,1);",""],(({previewMode})=>!previewMode&&element_library_src.AV),(({previewMode})=>!previewMode&&element_library_src.WZ),(({previewMode})=>!previewMode&&element_library_src.TH),(({isBackground,theme})=>isBackground&&(0,styled_components_browser_esm.AH)(["border-radius:",";overflow:hidden;"],theme.borders.radius.small))),BackgroundOverlay=styled_components_browser_esm.Ay.div.withConfig({displayName:"displayElement__BackgroundOverlay",componentId:"sc-1uos4dq-1"})(["position:absolute;width:100%;height:100%;top:0;left:0;"]),ReplacementContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"displayElement__ReplacementContainer",componentId:"sc-1uos4dq-2"})(["transition:opacity 0.25s cubic-bezier(0,0,0.54,1);pointer-events:none;opacity:",";height:100%;"],(({hasReplacement})=>hasReplacement?1:0));function AnimationWrapper(t0){const $=(0,dist.c)(4),{children,id,isAnimatable}=t0;let t1;return $[0]!==children||$[1]!==id||$[2]!==isAnimatable?(t1=isAnimatable?react.createElement(animation_src.OB,{target:id},children):children,$[0]=children,$[1]=id,$[2]=isAnimatable,$[3]=t1):t1=$[3],t1}AnimationWrapper.propTypes={isAnimatable:prop_types_default().bool.isRequired,children:prop_types_default().arrayOf(prop_types_default().node),id:prop_types_default().string};const displayElement=(0,src.ph)((function DisplayElement({element,previewMode,isAnimatable=!1,siblingCount=0}){const{getBox,getBoxWithBorder,dataToEditorX}=(0,useUnits.A)((state=>({getBox:state.actions.getBox,getBoxWithBorder:state.actions.getBoxWithBorder,dataToEditorX:state.actions.dataToEditorX}))),{getProxiedUrl}=(0,useCORSProxy.A)(),{cdnURL}=(0,app.UK)(),{actions:{maybeEnqueueFontStyle}}=(0,app.Ln)(),[replacement,setReplacement]=(0,src.J0)(null),hasReplacement=Boolean(replacement),{id,opacity,type,isBackground,overlay,border,flip,rotationAngle}=element,{isCurrentResourceProcessing,isCurrentResourceUploading}=(0,app.HZ)((({state:state_0})=>elements_src.bV.IMAGE===type?{isCurrentResourceProcessing:state_0.isCurrentResourceProcessing,isCurrentResourceUploading:state_0.isCurrentResourceUploading}:{})),replacementElement=hasReplacement?{...element,type:replacement.resource.type,resource:replacement.resource,scale:replacement.scale,focalX:replacement.focalX,focalY:replacement.focalY,flip:isBackground?replacement.flip:flip,overlay:isBackground?replacement.overlay:overlay}:null;let Replacement;if(replacement?.resource.type){Replacement=(0,elements_src.zh)(replacement.resource.type).Display}const wrapperRef=(0,src.li)(null),{left=0,right=0,top=0,bottom=0}=border||{};(0,transform_src.Ap)(id,(transform=>{const target=wrapperRef.current;if(null===transform)target.style.transform="",target.style.width="",target.style.height="";else{const{translate=[0,0],rotate,resize,dropTargets}=transform;let dx=0,dy=0;if(resize&&0!==resize[0]&&0!==resize[1]&&(target.style.width=`${resize[0]}px`,target.style.height=`${resize[1]}px`,(0,masks_src.Fn)(element))){const[_dx,_dy]=(0,calcRotatedResizeOffset.A)(rotationAngle,0,left+right,0,top+bottom);dx=_dx,dy=_dy}target.style.transform=`translate(${translate[0]-dx}px, ${translate[1]-dy}px) rotate(${rotate}deg)`,void 0!==dropTargets?.hover&&(target.style.opacity=dropTargets.hover?0:1),void 0!==dropTargets?.replacement&&setReplacement(dropTargets.replacement||null)}}));const bgOverlayRef=(0,src.li)(null);if((0,element_library_src.Tw)({id,targetRef:bgOverlayRef,resetOnNullTransform:!1}),element.isHidden)return null;const{Display}=(0,elements_src.zh)(type),box=getBox(element),boxWithBorder=getBoxWithBorder(element),responsiveBorder=(0,masks_src.H2)(border,previewMode,dataToEditorX);return react.createElement(Wrapper,_extends({ref:wrapperRef,"data-element-id":id,isBackground:element.isBackground,previewMode},previewMode?box:boxWithBorder),react.createElement(AnimationWrapper,{id,isAnimatable},react.createElement(masks_src.xC,{element,fill:!0,style:{opacity:void 0!==opacity?opacity/100:null},previewMode,responsiveBorder},react.createElement(Display,{element,previewMode,box,getProxiedUrl,isCurrentResourceProcessing,isCurrentResourceUploading,maybeEnqueueFontStyle,siblingCount,renderResourcePlaceholder:canvas_renderResourcePlaceholder,cdnUrl:cdnURL})),!previewMode&&react.createElement(ReplacementContainer,{hasReplacement},replacementElement&&react.createElement(masks_src.xC,{element:replacementElement,fill:!0,style:{opacity:opacity?opacity/100:null},previewMode},react.createElement(Replacement,{element:replacementElement,box,getProxiedUrl,isCurrentResourceProcessing,isCurrentResourceUploading,maybeEnqueueFontStyle}))),isBackground&&overlay&&!hasReplacement&&react.createElement(BackgroundOverlay,{ref:bgOverlayRef,style:(0,generatePatternStyles.A)(overlay)})))}))},"./packages/story-editor/src/components/footer/pagepreview/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-compiler-runtime/dist/index.js"),styled_components__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),polished__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/polished/dist/polished.esm.js"),prop_types__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_14__),_googleforcreators_patterns__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./packages/patterns/src/generatePatternStyles.ts"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./packages/units/src/constants.ts"),_googleforcreators_units__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./packages/units/src/unitsProvider.tsx"),_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/transform/src/index.ts"),_propTypes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/story-editor/src/propTypes.js"),_app_pageCanvas__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/story-editor/src/app/pageCanvas/index.ts"),_canvas_displayElement__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./packages/story-editor/src/components/canvas/displayElement.js"),_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./packages/story-editor/src/utils/usePerformanceTracking.ts"),_constants__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./packages/story-editor/src/constants/index.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const Page=styled_components__WEBPACK_IMPORTED_MODULE_9__.Ay.button.withConfig({displayName:"pagepreview__Page",componentId:"sc-f0c590-0"})(["display:block;position:relative;cursor:",";padding:0;border:0;background-color:transparent;height:","px;width:","px;flex:none;outline:0;&::after{content:'';display:block;position:absolute;left:-4px;right:-4px;top:-4px;bottom:-4px;pointer-events:none;border-style:solid;border-width:1px;border-radius:8px;border-color:",";}",""],(({isInteractive})=>isInteractive?"pointer":"default"),(({height})=>height),(({width})=>width),(({isActive,isInteractive,theme})=>isInteractive&&isActive?theme.colors.border.defaultActive:"transparent"),(({isInteractive,isActive,theme})=>isInteractive&&(0,styled_components__WEBPACK_IMPORTED_MODULE_9__.AH)(["&:focus::after{border-color:",";}"],(0,polished__WEBPACK_IMPORTED_MODULE_10__.B3)(theme.colors.border.selection,isActive?1:.7)))),PageOffset=styled_components__WEBPACK_IMPORTED_MODULE_9__.Ay.div.withConfig({displayName:"pagepreview__PageOffset",componentId:"sc-f0c590-1"})(["position:relative;top:","px;"],(({$top})=>$top)),PreviewWrapper=styled_components__WEBPACK_IMPORTED_MODULE_9__.Ay.div.withConfig({displayName:"pagepreview__PreviewWrapper",componentId:"sc-f0c590-2"})(["height:100%;position:relative;overflow:hidden;background-color:white;border-radius:4px;",""],(({background})=>(0,_googleforcreators_patterns__WEBPACK_IMPORTED_MODULE_11__.A)(background))),Image=styled_components__WEBPACK_IMPORTED_MODULE_9__.Ay.img.withConfig({displayName:"pagepreview__Image",componentId:"sc-f0c590-3"})(["position:absolute;width:100%;left:0;top:50%;transform:translateY(-50%);"]);function PagePreview(t0){const $=(0,react_compiler_runtime__WEBPACK_IMPORTED_MODULE_1__.c)(40);let label,page,props;$[0]!==t0?(({page,label,...props}=t0),$[0]=t0,$[1]=label,$[2]=page,$[3]=props):(label=$[1],page=$[2],props=$[3]);const{backgroundColor}=page,{width,isActive}=props,height=Math.round(width/_googleforcreators_units__WEBPACK_IMPORTED_MODULE_12__.iZ),fullHeight=Math.round(width/_googleforcreators_units__WEBPACK_IMPORTED_MODULE_12__.yK),pageYOffset=(fullHeight-height)/2;let t1;$[4]!==page.id?(t1=t2=>{const{state,actions}=t2;return{pageCanvas:state.pageCanvasMap[page.id],generateDeferredPageCanvas:actions.generateDeferredPageCanvas}},$[4]=page.id,$[5]=t1):t1=$[5];const{pageCanvas,generateDeferredPageCanvas}=(0,_app_pageCanvas__WEBPACK_IMPORTED_MODULE_5__.R5)(t1),[pageNode,setPageNode]=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.J0)();let t2,t3;$[6]!==setPageNode?(t2=node=>node&&setPageNode(node),$[6]=setPageNode,$[7]=t2):t2=$[7],$[8]===Symbol.for("react.memo_cache_sentinel")?(t3=[],$[8]=t3):t3=$[8];const setPageRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.hb)(t2,t3);let t4,t5,t6,t7;$[9]!==generateDeferredPageCanvas||$[10]!==isActive||$[11]!==page||$[12]!==pageCanvas?(t4=()=>{isActive||pageCanvas||generateDeferredPageCanvas([page.id,page])},t5=[page,pageCanvas,isActive,generateDeferredPageCanvas],$[9]=generateDeferredPageCanvas,$[10]=isActive,$[11]=page,$[12]=pageCanvas,$[13]=t4,$[14]=t5):(t4=$[13],t5=$[14]),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.vJ)(t4,t5),$[15]!==pageCanvas?(t6=()=>pageCanvas?.toDataURL("image/png"),t7=[pageCanvas],$[15]=pageCanvas,$[16]=t6,$[17]=t7):(t6=$[16],t7=$[17]);const pageImage=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_2__.Kr)(t6,t7);let t8,t9,t10,t11,t12,t13;return $[18]!==pageNode?(t8={node:pageNode,eventData:_constants__WEBPACK_IMPORTED_MODULE_8__.Zy.PAGE_PREVIEW_CLICK},$[18]=pageNode,$[19]=t8):t8=$[19],(0,_utils_usePerformanceTracking__WEBPACK_IMPORTED_MODULE_7__.A)(t8),$[20]!==height||$[21]!==width?(t9={width,height},$[20]=height,$[21]=width,$[22]=t9):t9=$[22],$[23]!==label||$[24]!==page.elements||$[25]!==pageImage||$[26]!==pageYOffset?(t10=pageImage?react__WEBPACK_IMPORTED_MODULE_0__.createElement(Image,{draggable:"false",src:pageImage,alt:label,decoding:"async"}):react__WEBPACK_IMPORTED_MODULE_0__.createElement(PageOffset,{$top:pageYOffset},page.elements.map(_temp)),$[23]=label,$[24]=page.elements,$[25]=pageImage,$[26]=pageYOffset,$[27]=t10):t10=$[27],$[28]!==backgroundColor||$[29]!==t10?(t11=react__WEBPACK_IMPORTED_MODULE_0__.createElement(PreviewWrapper,{background:backgroundColor},t10),$[28]=backgroundColor,$[29]=t10,$[30]=t11):t11=$[30],$[31]!==fullHeight||$[32]!==label||$[33]!==props||$[34]!==setPageRef||$[35]!==t11?(t12=react__WEBPACK_IMPORTED_MODULE_0__.createElement(_googleforcreators_transform__WEBPACK_IMPORTED_MODULE_3__.gS,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(Page,_extends({ref:setPageRef,"aria-label":label,height:fullHeight},props),t11)),$[31]=fullHeight,$[32]=label,$[33]=props,$[34]=setPageRef,$[35]=t11,$[36]=t12):t12=$[36],$[37]!==t12||$[38]!==t9?(t13=react__WEBPACK_IMPORTED_MODULE_0__.createElement(_googleforcreators_units__WEBPACK_IMPORTED_MODULE_13__.A,{pageSize:t9},t12),$[37]=t12,$[38]=t9,$[39]=t13):t13=$[39],t13}function _temp(element){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_canvas_displayElement__WEBPACK_IMPORTED_MODULE_6__.A,{key:element.id,previewMode:!0,element})}PagePreview.propTypes={page:_propTypes__WEBPACK_IMPORTED_MODULE_4__.Ed.page.isRequired,label:prop_types__WEBPACK_IMPORTED_MODULE_14___default().string,width:prop_types__WEBPACK_IMPORTED_MODULE_14___default().number.isRequired,isInteractive:prop_types__WEBPACK_IMPORTED_MODULE_14___default().bool,isActive:prop_types__WEBPACK_IMPORTED_MODULE_14___default().bool,tabIndex:prop_types__WEBPACK_IMPORTED_MODULE_14___default().number};const __WEBPACK_DEFAULT_EXPORT__=PagePreview},"./packages/story-editor/src/components/hideOnError.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>HideOnError});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts");class HideOnError extends _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.uA{constructor(props){super(props),this.state={error:null}}static getDerivedStateFromError(error){return{error}}render(){const{error}=this.state;return error?null:this.props.children}}},"./packages/story-editor/src/components/thumbnail/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AW:()=>LayerThumbnail,zF:()=>overflowThumbnail,rT:()=>THUMBNAIL_DIMENSIONS,RO:()=>THUMBNAIL_TYPES,Vz:()=>thumbnail});var i18n=__webpack_require__("./packages/i18n/src/i18n.ts");const THUMBNAIL_DIMENSIONS={WIDTH:54,HEIGHT:96,NESTED_ICON:32,THUMBNAIL_SHAPE:36},THUMBNAIL_TYPES={VIDEO:"VIDEO",IMAGE:"IMAGE",TEXT:"TEXT",SHAPE:"SHAPE",PAGE:"PAGE"},DEFAULT_LOADING_MESSAGE=(0,i18n.__)("Loading","web-stories");var react=__webpack_require__("./node_modules/react/index.js"),loadingBar=__webpack_require__("./packages/design-system/src/components/loadingBar/loadingBar.tsx"),exclamation_outline=__webpack_require__("./packages/design-system/src/icons/exclamation_outline.svg"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js");const Container=styled_components_browser_esm.Ay.button.withConfig({displayName:"thumbnail__Container",componentId:"sc-jiqsnn-0"})((({theme,$isError,$isOverflow})=>(0,styled_components_browser_esm.AH)(["position:relative;display:flex;align-items:center;justify-content:center;width:","px;height:","px;padding:0;outline:none;border:none;border-radius:",";background-color:",";cursor:pointer;.","{display:none;}&:hover{.","{display:flex;}}"," &:focus,&:focus-within{.","{display:flex;}.","{background-color:",";border:1px solid ",";}}"],THUMBNAIL_DIMENSIONS.WIDTH,THUMBNAIL_DIMENSIONS.HEIGHT,theme.borders.radius.small,$isOverflow?theme.colors.interactiveBg.secondaryNormal:"transparent","thumbnail-show-hover-focus","thumbnail-show-hover-focus",$isError&&(0,styled_components_browser_esm.AH)([".","{border:1px solid ",";background-color:",";}&:hover .","{background-color:",";}"],"thumbnail-scrim",theme.colors.border.negativeNormal,theme.colors.opacity.black24,"thumbnail-scrim",theme.colors.opacity.black24),"thumbnail-show-hover-focus","thumbnail-scrim",theme.colors.opacity.black64,theme.colors.border[$isError?"negativeNormal":"focus"])));Container.propTypes={$isError:prop_types_default().bool};const Background=styled_components_browser_esm.Ay.div.withConfig({displayName:"thumbnail__Background",componentId:"sc-jiqsnn-1"})((({theme,$isShape,$isPage})=>(0,styled_components_browser_esm.AH)(["width:100%;height:100%;display:flex;border-radius:",";& > img,& > video{width:100%;height:100%;object-fit:cover;border-radius:",";}& > div{display:flex;height:100%;margin:0 auto;align-items:center;justify-content:center;align-self:center;color:",";}"," ",""],theme.borders.radius.small,theme.borders.radius.small,theme.colors.fg.primary,$isShape&&(0,styled_components_browser_esm.AH)(["& > div{width:","px;height:","px;& > div{width:100%;height:100%;}}"],THUMBNAIL_DIMENSIONS.THUMBNAIL_SHAPE,THUMBNAIL_DIMENSIONS.THUMBNAIL_SHAPE),$isPage&&(0,styled_components_browser_esm.AH)([".pagePreviewOverrides{border-color:transparent;&::after{content:none;border:none;}}& > div > div{width:100%;}"]))));Background.propTypes={$isPage:prop_types_default().bool,$isShape:prop_types_default().bool};const NestedIconContainer=styled_components_browser_esm.Ay.div.withConfig({displayName:"thumbnail__NestedIconContainer",componentId:"sc-jiqsnn-2"})((({theme,$isError})=>(0,styled_components_browser_esm.AH)(["display:flex;position:absolute;top:0;width:100%;height:100%;align-items:center;justify-content:center;z-index:5;& > div{margin:auto;width:","px;}svg{width:100%;height:auto;","}"],THUMBNAIL_DIMENSIONS.NESTED_ICON,$isError&&(0,styled_components_browser_esm.AH)(["color:",";"],theme.colors.fg.negative))));NestedIconContainer.propTypes={$isError:prop_types_default().bool};const Scrim=styled_components_browser_esm.Ay.div.withConfig({displayName:"thumbnail__Scrim",componentId:"sc-jiqsnn-3"})((({theme,$showDefaultBackground})=>(0,styled_components_browser_esm.AH)(["position:absolute;box-sizing:border-box;top:0;width:100%;height:100%;border:1px solid transparent;border-radius:",";z-index:2;",";&:hover{background-color:",";}"],theme.borders.radius.small,$showDefaultBackground&&(0,styled_components_browser_esm.AH)(["background-color:",";"],theme.colors.opacity.black24),theme.colors.opacity.black64)));function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}Scrim.propTypes={$showDefaultBackground:prop_types_default().bool};const includeDefaultScrimBackground=[THUMBNAIL_TYPES.SHAPE,THUMBNAIL_TYPES.TEXT],thumbnail=({displayBackground,isError,onClick,type,isLoading,loadingMessage=DEFAULT_LOADING_MESSAGE,children,...rest})=>react.createElement(Container,_extends({as:onClick?"button":"div",onClick,$isError:isError},rest),isLoading&&react.createElement(loadingBar.G,{loadingMessage}),!isError&&!isLoading&&children&&react.createElement(NestedIconContainer,{className:"thumbnail-show-hover-focus"},children),isError&&react.createElement(NestedIconContainer,{$isError:isError},react.createElement(exclamation_outline.A,null)),react.createElement(Scrim,{$showDefaultBackground:includeDefaultScrimBackground.indexOf(type)>-1,className:"thumbnail-scrim"}),react.createElement(Background,{$isShape:type===THUMBNAIL_TYPES.SHAPE,$isPage:type===THUMBNAIL_TYPES.PAGE},displayBackground));var sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts");function overflowThumbnail_extends(){return overflowThumbnail_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},overflowThumbnail_extends.apply(null,arguments)}const overflowThumbnail=({overflowCount,...rest})=>react.createElement(Container,overflowThumbnail_extends({$isOverflow:!0,as:"div"},rest),react.createElement(typography_text.E.Paragraph,{size:types.$.Medium},(0,sprintf.A)((0,i18n.__)("+ %s","web-stories"),overflowCount)));var dist=__webpack_require__("./node_modules/react-compiler-runtime/dist/index.js"),src=__webpack_require__("./packages/elements/src/index.ts"),useCORSProxy=__webpack_require__("./packages/story-editor/src/utils/useCORSProxy.ts"),app=__webpack_require__("./packages/story-editor/src/app/index.js");const LayerThumbnail=t0=>{const $=(0,dist.c)(11),{page}=t0,t1=page?.type;let t2;$[0]!==t1?(t2=(0,src.zh)(t1),$[0]=t1,$[1]=t2):t2=$[1];const{LayerIcon}=t2,{getProxiedUrl}=(0,useCORSProxy.A)(),{isDefaultBackground}=page;let t3;$[2]!==isDefaultBackground?(t3=t4=>{const{state}=t4;return!isDefaultBackground||state.currentPage?.backgroundColor},$[2]=isDefaultBackground,$[3]=t3):t3=$[3];const currentPageBackgroundColor=(0,app.P3)(t3);let props,t4;return $[4]!==currentPageBackgroundColor||$[5]!==getProxiedUrl||$[6]!==page?(props={element:page,getProxiedUrl,currentPageBackgroundColor},"video"===page?.type&&(props.showVideoPreviewAsBackup=!0),$[4]=currentPageBackgroundColor,$[5]=getProxiedUrl,$[6]=page,$[7]=props):props=$[7],$[8]!==LayerIcon||$[9]!==props?(t4=react.createElement(LayerIcon,props),$[8]=LayerIcon,$[9]=props,$[10]=t4):t4=$[10],t4}},"./packages/story-editor/src/propTypes.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ed:()=>_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.Ed,Gn:()=>PageSizePropType});var prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),_googleforcreators_animation__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/animation/src/index.ts"),_googleforcreators_media__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/media/src/types/propTypes.ts"),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/elements/src/index.ts");const PageSizePropType=prop_types__WEBPACK_IMPORTED_MODULE_2___default().shape({width:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,height:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,containerHeight:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number});_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.Ed.story=prop_types__WEBPACK_IMPORTED_MODULE_2___default().shape({storyId:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,title:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,status:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,author:prop_types__WEBPACK_IMPORTED_MODULE_2___default().shape({id:prop_types__WEBPACK_IMPORTED_MODULE_2___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,prop_types__WEBPACK_IMPORTED_MODULE_2___default().string]),name:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired}),slug:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,date:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,modified:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,excerpt:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,featuredMedia:prop_types__WEBPACK_IMPORTED_MODULE_2___default().shape({id:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number.isRequired,url:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,width:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number.isRequired,height:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number.isRequired,isExternal:prop_types__WEBPACK_IMPORTED_MODULE_2___default().bool,needsProxy:prop_types__WEBPACK_IMPORTED_MODULE_2___default().bool}),password:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,currentStoryStyles:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object,autoAdvance:prop_types__WEBPACK_IMPORTED_MODULE_2___default().bool,defaultPageDuration:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,backgroundAudio:prop_types__WEBPACK_IMPORTED_MODULE_2___default().shape({resource:_googleforcreators_media__WEBPACK_IMPORTED_MODULE_3__.Y3})}),_googleforcreators_elements__WEBPACK_IMPORTED_MODULE_1__.Ed.size=prop_types__WEBPACK_IMPORTED_MODULE_2___default().exact({width:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number.isRequired,height:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number.isRequired});prop_types__WEBPACK_IMPORTED_MODULE_2___default().shape(_googleforcreators_animation__WEBPACK_IMPORTED_MODULE_0__.zd)},"./packages/story-editor/src/utils/contrastUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$W:()=>getAccessibleTextColorsFromPixels,bE:()=>calculateLuminanceFromStyleColor,kg:()=>checkContrastFromLuminances,wI:()=>calculateLuminanceFromRGB});var _ap_cx_hues__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@ap.cx/hues/dist/hues.umd.js");function calculateLuminanceFromRGB(rgb){const{r,g,b,a=1}=rgb;return _ap_cx_hues__WEBPACK_IMPORTED_MODULE_0__.relativeLuminance({r:r/255,g:g/255,b:b/255,a})}function calculateLuminanceFromStyleColor(styleColor){const rgb=_ap_cx_hues__WEBPACK_IMPORTED_MODULE_0__.str2rgba(styleColor);return _ap_cx_hues__WEBPACK_IMPORTED_MODULE_0__.relativeLuminance(rgb)}function checkContrastFromLuminances(luminanceA,luminanceB,fontSize){const ratio=_ap_cx_hues__WEBPACK_IMPORTED_MODULE_0__.contrast(luminanceA,luminanceB);return{ratio,WCAG_AA:_ap_cx_hues__WEBPACK_IMPORTED_MODULE_0__.aa(ratio,fontSize)}}function calculateContrast(rgb1,rgb2,fontSize){return checkContrastFromLuminances(calculateLuminanceFromRGB({r:rgb1[0],g:rgb1[1],b:rgb1[2]}),calculateLuminanceFromRGB({r:rgb2[0],g:rgb2[1],b:rgb2[2]}),fontSize)}function getAccessibleTextColorsFromPixels(pixelData,fontSize){const white=[255,255,255,255],black=[0,0,0,255],colors=[],whiteRgb={r:255,g:255,b:255,a:1},blackRgb={r:0,g:0,b:0,a:1};for(let i=0;i<pixelData.length;i+=4)colors.push([pixelData[i],pixelData[i+1],pixelData[i+2],pixelData[i+3]]);const contrasts=colors.map((c=>calculateContrast(black,c,fontSize)));if(!contrasts.some((({WCAG_AA})=>!WCAG_AA)))return{color:blackRgb};const altContrasts=colors.map((c=>calculateContrast(white,c,fontSize)));if(!altContrasts.some((({WCAG_AA})=>!WCAG_AA)))return{color:whiteRgb};return contrasts.reduce(((a,c)=>a+c.ratio),0)<altContrasts.reduce(((a,c)=>a+c.ratio),0)?{color:blackRgb,backgroundColor:{...whiteRgb,a:.7}}:{color:whiteRgb,backgroundColor:{...blackRgb,a:.7}}}},"./packages/story-editor/src/utils/idleCallback.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>requestIdleCallback,G:()=>cancelIdleCallback});const requestIdleCallback=window.requestIdleCallback||((callback,options={})=>{const timeout=options.timeout||1,start=performance.now();return setTimeout((()=>{callback({get didTimeout(){return void 0===options.timeout&&performance.now()-start-1>timeout},timeRemaining:()=>Math.max(0,performance.now()-start+1)})}),1)}),cancelIdleCallback=window.cancelIdleCallback||(id=>{clearTimeout(id)})},"./packages/story-editor/src/utils/useIdleTaskQueue.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_idleCallback__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/story-editor/src/utils/idleCallback.ts");const __WEBPACK_DEFAULT_EXPORT__=function useIdleTaskQueue(){const taskQueueRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.li)([]),isTaskQueueRunningRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.li)(!1),currentTaskRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.li)({taskId:null,task:null}),runTaskQueue=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.hb)((()=>{if(isTaskQueueRunningRef.current=!0,!taskQueueRef.current.length)return void(isTaskQueueRunningRef.current=!1);const{taskId,task}=taskQueueRef.current.shift(),idleCallbackId=(0,_idleCallback__WEBPACK_IMPORTED_MODULE_1__.B)((()=>{"function"==typeof task&&task().then((()=>{currentTaskRef.current={taskId:null,task:null},runTaskQueue()}))}));currentTaskRef.current={taskId,task:idleCallbackId}}),[]),clearQueuedTask=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.hb)((id=>{taskQueueRef.current=taskQueueRef.current.filter((({taskId:taskId_0})=>taskId_0!==id));const{taskId:taskId_1,task:task_0}=currentTaskRef.current;id===taskId_1&&"number"==typeof task_0&&((0,_idleCallback__WEBPACK_IMPORTED_MODULE_1__.G)(task_0),currentTaskRef.current={taskId:null,task:null},runTaskQueue())}),[runTaskQueue]);return(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.hb)((({taskId:taskId_2,task:task_1})=>(taskId_2&&clearQueuedTask(taskId_2),taskQueueRef.current.push({taskId:taskId_2,task:task_1}),isTaskQueueRunningRef.current||runTaskQueue(),()=>{taskId_2&&clearQueuedTask(taskId_2)})),[runTaskQueue,clearQueuedTask])}},"./packages/story-editor/src/utils/usePerformanceTracking.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/react/src/index.ts"),_googleforcreators_tracking__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/tracking/src/index.ts");const OBSERVED_EVENTS=["click","pointerdown","pointerup"];const __WEBPACK_DEFAULT_EXPORT__=function usePerformanceTracking({node,eventData,eventType="click"}){const performanceObserverRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.li)(),tracesRef=(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.li)({}),supportsPerformanceObserving="undefined"!=typeof PerformanceObserver&&PerformanceObserver.supportedEntryTypes.includes("event");!performanceObserverRef.current&&supportsPerformanceObserving&&(performanceObserverRef.current=new PerformanceObserver((entries=>{for(const entry of entries.getEntries())OBSERVED_EVENTS.includes(entry.name)&&tracesRef.current[entry.startTime]?.category&&!tracesRef.current[entry.startTime]?.isReported&&(tracesRef.current[entry.startTime].isReported=!0,(0,_googleforcreators_tracking__WEBPACK_IMPORTED_MODULE_1__.w6)(tracesRef.current[entry.startTime].category,entry.duration,tracesRef.current[entry.startTime].label,entry.name))})),performanceObserverRef.current.observe({entryTypes:["event"]})),(0,_googleforcreators_react__WEBPACK_IMPORTED_MODULE_0__.vJ)((()=>{if(!node||!supportsPerformanceObserving)return;const{label="",category}=eventData,el=node,traceEvent=e=>{tracesRef.current[e.timeStamp]={category,label,time:e.timeStamp}};return el.addEventListener(eventType,traceEvent),()=>{el.removeEventListener(eventType,traceEvent)}}),[eventData,node,eventType,supportsPerformanceObserving])}}}]);